<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author"><meta name="description" content="王平安个人博客,pingan8787,前端开发,人工智能,AI,深度学习,前端框架vue,angular,react,nodejs,python,numpy,pandas,anaconda,Tensorflow,高等数学,概率论,统计学神经网络,"><title>63-【JavaScript】JavaScript中常见设计模式 · pingan8787</title><meta name="description" content="Author
王平安



E-mail
&amp;#112;&amp;#105;&amp;#x6e;&amp;#103;&amp;#97;&amp;#x6e;&amp;#x38;&amp;#x37;&amp;#56;&amp;#55;&amp;#64;&amp;#x71;&amp;#x71;&amp;#46;&amp;#99;&amp;#111;&amp;#x6d;


博  客
www.pingan8787.com


微  信"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script type="text/javascript" src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js"></script><script type="text/javascript" src="https://hm.baidu.com/hm.js?de7c89214c05d551ef3ec12341cd0b9e"></script><meta name="generator" content="Hexo 5.4.0"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;border-radius:15px;"><h3 title=""><a href="/">pingan8787</a></h3></div></div><ul class="my_tages_ul clearfix"><li class="my_tages_li next pagbuttons"><a class="btn" target="_blank" rel="noopener" href="http://www.pingan8787.com/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/"> 前端开发</a></li><li class="my_tages_li next pagbuttons"><a class="btn btn" target="_blank" rel="noopener" href="http://www.pingan8787.com/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/"> 人工智能</a></li><li class="my_tages_li next pagbuttons"><a class="btn btn" target="_blank" rel="noopener" href="http://www.pingan8787.com/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/"> 深度学习</a></li></ul><ul class="my_icon"><li class="my_icon_li"><a target="_blank" rel="noopener" href="https://github.com/pingan8787" title="github"><img src="http://images.pingan8787.com/assets/icon_26_github.png" alt="github"></a></li><li class="my_icon_li"><a target="_blank" rel="noopener" href="https://www.yuque.com/wangpingan/cute-frontend" title="语雀"><img src="http://images.pingan8787.com/assets/icon_26_yuque.png" alt="语雀"></a></li><li class="my_icon_li"><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/cute-javascript" title="知乎"><img src="http://images.pingan8787.com/icon_zhihu.png" alt="知乎"></a></li><li class="my_icon_li"><a target="_blank" rel="noopener" href="https://juejin.im/user/586fc337a22b9d0058807d53/posts" title="掘金"><img src="http://images.pingan8787.com/icon_juejin.png" alt="掘金"></a></li><li class="my_icon_li"><a target="_blank" rel="noopener" href="https://segmentfault.com/blog/pingan8787" title="思否"><img src="http://images.pingan8787.com/icon_sf.png" alt="思否"></a></li><li class="my_icon_li"><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_36380426" title="CSDN"><img src="http://images.pingan8787.com/icon_csdn.png" alt="CSDN"></a></li><li class="my_icon_li"><a target="_blank" rel="noopener" href="https://www.jianshu.com/u/2ec5d94afd60" title="简书"><img src="http://images.pingan8787.com/icon_jianshu.png" alt="简书"></a></li></ul><div style="text-align:center;"><wb:follow-button uid="1689651205" type="red_1" style="margin-top:10px;width:67px;height:24px;display: inline-block;"></wb:follow-button></div><ul class="social-links"></ul><div class="footer"><a target="_blank" href="/"><span>博客作者：</span></a><a href="https://github.com/pingan8787" target="_blank"> pingan8787（leo）</a><div class="by_farbox"> <a href="https://beian.miit.gov.cn/" target="_blank">备案编号：闽ICP备17012095号-1</a></div></div></div><s></s><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/leo">关于Leo</a></li><li><a href="/production">作品</a></li><li><a href="/Catalog">目录</a></li><li><a href="http://js.pingan8787.com" target="_blank">Cute-JavaScript</a></li><li><a href="https://github.com/pingan8787" target="_blank">Github</a></li></div><!--.information//.back_btn
  //li
    //if is_post()
      //a.fa.fa-chevron-left(onclick="window.history.go(-1)") 
    //else
      //a.fa.fa-chevron-left(onclick="window.history.go(-1)",style="display:none;") 
//.avatar
//  img(src= url_for('images/logo@2x.png'))--></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>63-【JavaScript】JavaScript中常见设计模式</a></h3></div><div class="post-content"><hr>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#112;&#105;&#x6e;&#103;&#97;&#x6e;&#x38;&#x37;&#56;&#55;&#64;&#x71;&#x71;&#46;&#99;&#111;&#x6d;">&#112;&#105;&#x6e;&#103;&#97;&#x6e;&#x38;&#x37;&#56;&#55;&#64;&#x71;&#x71;&#46;&#99;&#111;&#x6d;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章</td>
<td><a target="_blank" rel="noopener" href="https://0x9.me/KMrv3">https://0x9.me/KMrv3</a></td>
</tr>
</tbody></table>
<hr>
<p>开发中，我们或多或少地接触了设计模式，但是很多时候不知道自己使用了哪种设计模式或者说该使用何种设计模式。本文意在梳理常见设计模式的特点，从而对它们有比较清晰的认知。   </p>
<h3 id="JavaScript-中常见设计模式"><a href="#JavaScript-中常见设计模式" class="headerlink" title="JavaScript 中常见设计模式"></a>JavaScript 中常见设计模式</h3><ul>
<li><a href="#单例模式">单例模式</a></li>
<li><a href="#策略模式">策略模式</a></li>
<li><a href="#代理模式">代理模式</a></li>
<li><a href="#迭代器模式">迭代器模式</a></li>
<li><a href="#发布-订阅模式">发布-订阅模式</a></li>
<li><a href="#命令模式">命令模式</a></li>
<li><a href="#组合模式">组合模式</a></li>
<li><a href="#模板方法模式">模板方法模式</a></li>
<li><a href="#享元模式">享元模式</a></li>
<li><a href="#职责链模式">职责链模式</a></li>
<li><a href="#中介者模式">中介者模式</a></li>
<li><a href="#装饰者模式">装饰者模式</a></li>
<li><a href="#状态模式">状态模式</a></li>
<li><a href="#适配者模式">适配者模式</a></li>
</ul>
<h3 id="各设计模式关键词"><a href="#各设计模式关键词" class="headerlink" title="各设计模式关键词"></a>各设计模式关键词</h3><p>看完了上述设计模式后，把它们的关键词特点罗列出来，以后提到某种设计模式，进而联想相应的关键词和例子，从而心中有数。   </p>
<table>
<thead>
<tr>
<th>设计模式</th>
<th>特点</th>
<th>案例</th>
</tr>
</thead>
<tbody><tr>
<td>单例模式</td>
<td>一个类只能构造出唯一实例</td>
<td>创建菜单对象</td>
</tr>
<tr>
<td>策略模式</td>
<td>根据不同参数可以命中不同的策略</td>
<td>动画库里的算法函数</td>
</tr>
<tr>
<td>代理模式</td>
<td>代理对象和本体对象具有一致的接口</td>
<td>图片预加载</td>
</tr>
<tr>
<td>迭代器模式</td>
<td>能获取聚合对象的顺序和元素</td>
<td>each([1, 2, 3], cb)</td>
</tr>
<tr>
<td>发布-订阅模式</td>
<td>PubSub</td>
<td>瀑布流库</td>
</tr>
<tr>
<td>命令模式</td>
<td>不同对象间约定好相应的接口</td>
<td>按钮和命令的分离</td>
</tr>
<tr>
<td>组合模式</td>
<td>组合模式在对象间形成一致对待的树形结构</td>
<td>扫描文件夹</td>
</tr>
<tr>
<td>模板方法模式</td>
<td>父类中定好执行顺序</td>
<td>咖啡和茶</td>
</tr>
<tr>
<td>享元模式</td>
<td>减少创建实例的个数</td>
<td>男女模具试装</td>
</tr>
<tr>
<td>职责链模式</td>
<td>通过请求第一个条件，会持续执行后续的条件，直到返回结果为止</td>
<td>if else 优化</td>
</tr>
<tr>
<td>中介者模式</td>
<td>对象和对象之间借助第三方中介者进行通信</td>
<td>测试结束告知结果</td>
</tr>
<tr>
<td>装饰者模式</td>
<td>动态地给函数赋能</td>
<td>天冷了穿衣服，热了脱衣服</td>
</tr>
<tr>
<td>状态模式</td>
<td>每个状态建立一个类，状态改变会产生不同行为</td>
<td>电灯换挡</td>
</tr>
<tr>
<td>适配者模式</td>
<td>一种数据结构改成另一种数据结构</td>
<td>枚举值接口变更</td>
</tr>
</tbody></table>
<h2 id="1-单例模式"><a href="#1-单例模式" class="headerlink" title="1.单例模式 "></a><a name="单例模式">1.单例模式 </a></h2><h3 id="两个条件"><a href="#两个条件" class="headerlink" title="两个条件"></a>两个条件</h3><ul>
<li>确保只有一个实例</li>
<li>可以全局访问</li>
</ul>
<h3 id="适用"><a href="#适用" class="headerlink" title="适用"></a>适用</h3><p>适用于弹框的实现，全局缓存  </p>
<h3 id="实现单例模式"><a href="#实现单例模式" class="headerlink" title="实现单例模式"></a>实现单例模式</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> singleton = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name</span><br><span class="line">  <span class="built_in">this</span>.instance = <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">singleton.prototype.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>.name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">singleton.getInstance = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">this</span>.instance) &#123; <span class="comment">// 关键语句</span></span><br><span class="line">    <span class="built_in">this</span>.instance = <span class="keyword">new</span> singleton(name)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>.instance</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// test</span></span><br><span class="line"><span class="keyword">const</span> a = singleton.getInstance(<span class="string">&#x27;a&#x27;</span>) <span class="comment">// 通过 getInstance 来获取实例</span></span><br><span class="line"><span class="keyword">const</span> b = singleton.getInstance(<span class="string">&#x27;b&#x27;</span>)</span><br><span class="line"><span class="built_in">console</span>.log(a === b)</span><br></pre></td></tr></table></figure>
<h3 id="JavaScript-中的单例模式"><a href="#JavaScript-中的单例模式" class="headerlink" title="JavaScript 中的单例模式"></a>JavaScript 中的单例模式</h3><p>因为 JavaScript 是无类的语言，而且 JS 中的全局对象符合单例模式两个条件。很多时候我们把全局对象当成单例模式来使用，  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="弹框层的实践"><a href="#弹框层的实践" class="headerlink" title="弹框层的实践"></a>弹框层的实践</h3><p>实现弹框的一种做法是先创建好弹框，然后使之隐藏，这样子的话会浪费部分不必要的 DOM 开销，我们可以在需要弹框的时候再进行创建，同时结合单例模式实现只有一个实例，从而节省部分 DOM 开销。下列为登入框部分代码：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> createLoginLayer = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> div = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">  div.innerHTML = <span class="string">&#x27;登入浮框&#x27;</span></span><br><span class="line">  div.style.display = <span class="string">&#x27;none&#x27;</span></span><br><span class="line">  <span class="built_in">document</span>.appendChild(div)</span><br><span class="line">  <span class="keyword">return</span> div</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使单例模式和创建弹框代码解耦  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getSingle = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> result</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> result || result = fn.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> createSingleLoginLayer = getSingle(createLoginLayer)</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">&#x27;loginBtn&#x27;</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  createSingleLoginLayer()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="2-策略模式"><a href="#2-策略模式" class="headerlink" title="2.策略模式"></a><a name="策略模式">2.策略模式</a></h2><blockquote>
<p>定义：根据不同参数可以命中不同的策略 </p>
</blockquote>
<h3 id="JavaScript-中的策略模式"><a href="#JavaScript-中的策略模式" class="headerlink" title="JavaScript 中的策略模式"></a>JavaScript 中的策略模式</h3><p>观察如下获取年终奖的 demo，根据不同的参数（level）获得不同策略方法(规则)，这是策略模式在 JS 比较经典的运用之一。  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> strategy = &#123;</span><br><span class="line">  <span class="string">&#x27;S&#x27;</span>: <span class="function"><span class="keyword">function</span>(<span class="params">salary</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> salary * <span class="number">4</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&#x27;A&#x27;</span>: <span class="function"><span class="keyword">function</span>(<span class="params">salary</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> salary * <span class="number">3</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&#x27;B&#x27;</span>: <span class="function"><span class="keyword">function</span>(<span class="params">salary</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> salary * <span class="number">2</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> calculateBonus = <span class="function"><span class="keyword">function</span>(<span class="params">level, salary</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> strategy[level](salary)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">calculateBonus(<span class="string">&#x27;A&#x27;</span>, <span class="number">10000</span>) <span class="comment">// 30000</span></span><br></pre></td></tr></table></figure>
<p>在函数是一等公民的 JS 中，策略模式的使用常常隐藏在高阶函数中，稍微变换下上述 demo 的形式如下，可以发现我们平时已经在使用它了，恭喜我们又掌握了一种设计模式。  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> S = <span class="function"><span class="keyword">function</span>(<span class="params">salary</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> salary * <span class="number">4</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> A = <span class="function"><span class="keyword">function</span>(<span class="params">salary</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> salary * <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> B = <span class="function"><span class="keyword">function</span>(<span class="params">salary</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> salary * <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> calculateBonus = <span class="function"><span class="keyword">function</span>(<span class="params">func, salary</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> func(salary)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">calculateBonus(A, <span class="number">10000</span>) <span class="comment">// 30000</span></span><br></pre></td></tr></table></figure>
<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ul>
<li>能减少大量的 if 语句</li>
<li>复用性好</li>
</ul>
<hr>
<h2 id="3-代理模式"><a href="#3-代理模式" class="headerlink" title="3.代理模式"></a><a name="代理模式">3.代理模式</a></h2><p>情景：小明追女生 A  </p>
<ul>
<li>非代理模式：小明 =花=&gt; 女生A  </li>
<li>代理模式：小明 =花=&gt; 让女生A的好友B帮忙 =花=&gt; 女生A  </li>
</ul>
<h3 id="代理模式的特点"><a href="#代理模式的特点" class="headerlink" title="代理模式的特点"></a>代理模式的特点</h3><ul>
<li>代理对象和本体对象具有一致的接口，对使用者友好  </li>
</ul>
<p>代理模式的种类有很多，在 JS 中最常用的为虚拟代理和缓存代理。  </p>
<h4 id="虚拟代理实现图片预加载"><a href="#虚拟代理实现图片预加载" class="headerlink" title="虚拟代理实现图片预加载"></a>虚拟代理实现图片预加载</h4><p>下面这段代码运用代理模式来实现图片预加载，可以看到通过代理模式巧妙地将创建图片与预加载逻辑分离，并且在未来如果不需要预加载，只要改成请求本体代替请求代理对象就行。  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myImage = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> imgNode = <span class="built_in">document</span>.createElement(<span class="string">&#x27;img&#x27;</span>)</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(imgNode)</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">setSrc</span>: <span class="function"><span class="keyword">function</span>(<span class="params">src</span>) </span>&#123;</span><br><span class="line">      imgNode.src = src</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> proxyImage = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> img = <span class="keyword">new</span> Image()</span><br><span class="line">  img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// http 图片加载完毕后才会执行</span></span><br><span class="line">    myImage.setSrc(<span class="built_in">this</span>.src)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">setSrc</span>: <span class="function"><span class="keyword">function</span>(<span class="params">src</span>) </span>&#123;</span><br><span class="line">      myImage.setSrc(<span class="string">&#x27;loading.jpg&#x27;</span>) <span class="comment">// 本地 loading 图片</span></span><br><span class="line">      img.src = src</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line">proxyImage.setSrc(<span class="string">&#x27;http://loaded.jpg&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>缓存代理实现乘积计算  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mult = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="number">1</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l; l = <span class="built_in">arguments</span>[i++];) &#123;</span><br><span class="line">    a = a * l</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> a</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> proxyMult = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> cache = &#123;&#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> tag = <span class="built_in">Array</span>.prototype.join.call(<span class="built_in">arguments</span>, <span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (cache[tag]) &#123;</span><br><span class="line">      <span class="keyword">return</span> cache[tag]</span><br><span class="line">    &#125;</span><br><span class="line">    cache[tag] = mult.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>)</span><br><span class="line">    <span class="keyword">return</span> cache[tag]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line">proxyMult(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>) <span class="comment">// 24</span></span><br></pre></td></tr></table></figure>

<h3 id="小-tip"><a href="#小-tip" class="headerlink" title="小 tip"></a>小 tip</h3><p>在开发时候不要先去猜测是否需要使用代理模式，如果发现直接使用某个对象不方便时，再来优化不迟。  </p>
<hr>
<h2 id="4-迭代器模式"><a href="#4-迭代器模式" class="headerlink" title="4.迭代器模式"></a><a name="迭代器模式">4.迭代器模式</a></h2><blockquote>
<p>定义：能访问到聚合对象的顺序与元素  </p>
</blockquote>
<h3 id="实现一个内部迭代器"><a href="#实现一个内部迭代器" class="headerlink" title="实现一个内部迭代器"></a>实现一个内部迭代器</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">each</span>(<span class="params">arr, fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">    fn(i, arr[i])</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">each([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="function"><span class="keyword">function</span>(<span class="params">i, n</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(i) <span class="comment">// 0 1 2</span></span><br><span class="line">  <span class="built_in">console</span>.log(n) <span class="comment">// 1 2 3</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>可以看出内部迭代器在调用的时候非常简单，使用者不用关心迭代器内部实现的细节，但这也是内部迭代器的缺点。比如要比较两数组是否相等，只能在其回调函数中作文章了，代码如下：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> compare = <span class="function"><span class="keyword">function</span>(<span class="params">arr1, arr2</span>) </span>&#123;</span><br><span class="line">  each(arr1, <span class="function"><span class="keyword">function</span>(<span class="params">i, n</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (arr2[i] !== n) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;两数组不等&#x27;</span>)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;两数组相等&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arr1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">const</span> arr2 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">compare(arr1, arr2) <span class="comment">// 两数组相等</span></span><br></pre></td></tr></table></figure>
<h3 id="实现一个外部迭代器"><a href="#实现一个外部迭代器" class="headerlink" title="实现一个外部迭代器"></a>实现一个外部迭代器</h3><p>相较于内部迭代器，外部迭代器将遍历的权利转移到外部，因此在调用的时候拥有了更多的自由性，不过缺点是调用方式较复杂。  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> iterator = <span class="function"><span class="keyword">function</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> current = <span class="number">0</span></span><br><span class="line">  <span class="keyword">const</span> next = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    current = current + <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> done = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> current &gt;= arr.length</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> value = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> arr[current]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    next,</span><br><span class="line">    done,</span><br><span class="line">    value,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arr1 = [<span class="number">1</span>, <span class="number">2</span> ,<span class="number">3</span>]</span><br><span class="line"><span class="keyword">const</span> arr2 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">const</span> iterator1 = iterator(arr1)</span><br><span class="line"><span class="keyword">const</span> iterator2 = iterator(arr2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> compare = <span class="function"><span class="keyword">function</span>(<span class="params">iterator1, iterator2</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">while</span> (!iterator1.done() &amp;&amp; !iterator2.done()) &#123;</span><br><span class="line">    <span class="keyword">if</span> (iterator1.value() !== iterator2.value()) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;两数组不等&#x27;</span>)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    iterator1.next() <span class="comment">// 外部迭代器将遍历的权利转移到外部</span></span><br><span class="line">    iterator2.next()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;两数组相等&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">compare(iterator1, iterator2)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="5-发布订阅模式"><a href="#5-发布订阅模式" class="headerlink" title="5.发布订阅模式"></a><a name="发布订阅模式">5.发布订阅模式</a></h2><p>事件发布/订阅模式 (PubSub) 在异步编程中帮助我们完成更松的解耦，甚至在 MVC、MVVC 的架构中以及设计模式中也少不了发布-订阅模式的参与。<br>优点：在异步编程中实现更深的解耦<br>缺点：如果过多的使用发布订阅模式，会增加维护的难度  </p>
<h3 id="实现一个发布订阅模式"><a href="#实现一个发布订阅模式" class="headerlink" title="实现一个发布订阅模式"></a>实现一个发布订阅模式</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Event = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.obj = &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Event.prototype.on = <span class="function"><span class="keyword">function</span>(<span class="params">eventType, fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">this</span>.obj[eventType]) &#123;</span><br><span class="line">    <span class="built_in">this</span>.obj[eventType] = []</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.obj[eventType].push(fn)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Event.prototype.emit = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> eventType = <span class="built_in">Array</span>.prototype.shift.call(<span class="built_in">arguments</span>)</span><br><span class="line">  <span class="keyword">var</span> arr = <span class="built_in">this</span>.obj[eventType]</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">    arr[i].apply(arr[i], <span class="built_in">arguments</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ev = <span class="keyword">new</span> Event()</span><br><span class="line"></span><br><span class="line">ev.on(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123; <span class="comment">// 订阅函数</span></span><br><span class="line">  <span class="built_in">console</span>.log(a) <span class="comment">// 1</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">ev.emit(<span class="string">&#x27;click&#x27;</span>, <span class="number">1</span>)          <span class="comment">// 发布函数</span></span><br></pre></td></tr></table></figure>

<h3 id="订阅函数逻辑一定要优先于发布函数吗"><a href="#订阅函数逻辑一定要优先于发布函数吗" class="headerlink" title="订阅函数逻辑一定要优先于发布函数吗"></a>订阅函数逻辑一定要优先于发布函数吗</h3><p>考虑以下场景：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(<span class="string">&#x27;&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 异步订阅函数逻辑</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在其他地方执行发布函数，此时并不能保证执行发布函数的时候，订阅函数已经执行</span></span><br></pre></td></tr></table></figure>
<p>我们需要实现这样的逻辑：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ev = <span class="keyword">new</span> Event()</span><br><span class="line">ev.emit(<span class="string">&#x27;click&#x27;</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">ev.on(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(a) <span class="comment">// 1</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>目标明确后，来着手实现它：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Event = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.obj = &#123;&#125;</span><br><span class="line">  <span class="built_in">this</span>.cacheList = []</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Event.prototype.on = <span class="function"><span class="keyword">function</span>(<span class="params">eventType, fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">this</span>.obj[eventType]) &#123;</span><br><span class="line">    <span class="built_in">this</span>.obj[eventType] = []</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.obj[eventType].push(fn)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.cacheList.length; i++) &#123;</span><br><span class="line">    <span class="built_in">this</span>.cacheList[i]()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Event.prototype.emit = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> arg = <span class="built_in">arguments</span></span><br><span class="line">  <span class="keyword">const</span> that = <span class="built_in">this</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">cache</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> eventType = <span class="built_in">Array</span>.prototype.shift.call(arg)</span><br><span class="line">    <span class="keyword">var</span> arr = that.obj[eventType]</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">      arr[i].apply(arr[i], arg)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.cacheList.push(cache)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上代码实现思路就是把原本在 <code>emit</code> 里触发的函数存到 <code>cacheList</code>，再转交到 <code>on</code> 中触发。从而实现了发布函数先于订阅函数执行。  </p>
<hr>
<h2 id="6-命令模式"><a href="#6-命令模式" class="headerlink" title="6.命令模式"></a><a name="命令模式">6.命令模式</a></h2><p>命令模式与策略模式有些类似，在 JavaScript 中它们都是隐式的。<br>重要性：较低  </p>
<h3 id="JavaScript-中的命令模式"><a href="#JavaScript-中的命令模式" class="headerlink" title="JavaScript 中的命令模式"></a>JavaScript 中的命令模式</h3><p>命令模式在 JavaScript 中也比较简单，下面代码中对按钮和命令进行了抽离，因此可以复杂项目中可以使用命令模式将界面的代码和功能的代码交付给不同的人去写。  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> setCommand = <span class="function"><span class="keyword">function</span>(<span class="params">button, command</span>) </span>&#123;</span><br><span class="line">  button.onClick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    command.excute()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------------  上面的界面逻辑由A完成，下面的由B完成</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> menu = &#123;</span><br><span class="line">  <span class="attr">updateMenu</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;更新菜单&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> UpdateCommand = <span class="function"><span class="keyword">function</span>(<span class="params">receive</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">excute</span>: receive.updateMenu,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> updateCommand = UpdateCommand(menu) <span class="comment">// 创建命令</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> button1 = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;button1&#x27;</span>)</span><br><span class="line">setCommand(button1, updateCommand)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="7-组合模式"><a href="#7-组合模式" class="headerlink" title="7.组合模式"></a><a name="组合模式">7.组合模式</a></h2><ul>
<li>组合模式在对象间形成树形结构;  </li>
<li>组合模式中基本对象和组合对象被一致对待;  </li>
<li>无须关心对象有多少层，调用时只需在根部进行调用;  </li>
</ul>
<h3 id="demo1-——-宏命令"><a href="#demo1-——-宏命令" class="headerlink" title="demo1 —— 宏命令"></a>demo1 —— 宏命令</h3><p>想象我们现在手上有个万能遥控器，当我们回家，按一下开关，下列事情将被执行:  </p>
<ol>
<li>煮咖啡</li>
<li>打开电视、打开音响</li>
<li>打开空调、打开电脑</li>
</ol>
<p>我们把任务划分为 3 类，效果图如下：<br><img src="https://camo.githubusercontent.com/a44e97b789bd6e25d1aa13b15b12239c0566b015/687474703a2f2f6f71687473637573302e626b742e636c6f7564646e2e636f6d2f39633837636538333535313566336439623630613836613066323838393764392e6a70672d343030" alt="任务划分"><br>接着看看结合了命令模式和组合模式的具体实现：    </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> MacroCommand = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">lists</span>: [],</span><br><span class="line">    <span class="attr">add</span>: <span class="function"><span class="keyword">function</span>(<span class="params">task</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.lists.push(task)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">excute</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// ①：组合对象调用这里的 excute，</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.lists.length; i++) &#123;</span><br><span class="line">        <span class="built_in">this</span>.lists[i].excute()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> command1 = MacroCommand() <span class="comment">// 基本对象</span></span><br><span class="line"></span><br><span class="line">command1.add(&#123;</span><br><span class="line">  <span class="attr">excute</span>: <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;煮咖啡&#x27;</span>) <span class="comment">// ②：基本对象调用这里的 excute，</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> command2 = MacroCommand() <span class="comment">// 组合对象</span></span><br><span class="line"></span><br><span class="line">command2.add(&#123;</span><br><span class="line">  <span class="attr">excute</span>: <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;打开电视&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">command2.add(&#123;</span><br><span class="line">  <span class="attr">excute</span>: <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;打开音响&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> command3 = MacroCommand()</span><br><span class="line"></span><br><span class="line">command3.add(&#123;</span><br><span class="line">  <span class="attr">excute</span>: <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;打开空调&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">command3.add(&#123;</span><br><span class="line">  <span class="attr">excute</span>: <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;打开电脑&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> macroCommand = MacroCommand()</span><br><span class="line">macroCommand.add(command1)</span><br><span class="line">macroCommand.add(command2)</span><br><span class="line">macroCommand.add(command3)</span><br><span class="line"></span><br><span class="line">macroCommand.excute()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 煮咖啡</span></span><br><span class="line"><span class="comment">// 打开电视</span></span><br><span class="line"><span class="comment">// 打开音响</span></span><br><span class="line"><span class="comment">// 打开空调</span></span><br><span class="line"><span class="comment">// 打开电脑</span></span><br></pre></td></tr></table></figure>

<p>可以看出在组合模式中基本对象和组合对象被一致对待，所以要保证基本对象(叶对象)和组合对象具有一致方法。  </p>
<h3 id="demo2-——-扫描文件夹"><a href="#demo2-——-扫描文件夹" class="headerlink" title="demo2 —— 扫描文件夹"></a>demo2 —— 扫描文件夹</h3><p>扫描文件夹时，文件夹下面可以为另一个文件夹也可以为文件，我们希望统一对待这些文件夹和文件，这种情形适合使用组合模式。  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Folder = <span class="function"><span class="keyword">function</span>(<span class="params">folder</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.folder = folder</span><br><span class="line">  <span class="built_in">this</span>.lists = []</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Folder.prototype.add = <span class="function"><span class="keyword">function</span>(<span class="params">resource</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.lists.push(resource)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Folder.prototype.scan = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;开始扫描文件夹：&#x27;</span>, <span class="built_in">this</span>.folder)</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, folder; folder = <span class="built_in">this</span>.lists[i++];) &#123;</span><br><span class="line">    folder.scan()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> File = <span class="function"><span class="keyword">function</span>(<span class="params">file</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.file = file</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">File.prototype.add = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="built_in">Error</span>(<span class="string">&#x27;文件下不能添加其它文件夹或文件&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">File.prototype.scan = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;开始扫描文件：&#x27;</span>, <span class="built_in">this</span>.file)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> folder = <span class="keyword">new</span> Folder(<span class="string">&#x27;根文件夹&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> folder1 = <span class="keyword">new</span> Folder(<span class="string">&#x27;JS&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> folder2 = <span class="keyword">new</span> Folder(<span class="string">&#x27;life&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> file1 = <span class="keyword">new</span> File(<span class="string">&#x27;深入React技术栈.pdf&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> file2 = <span class="keyword">new</span> File(<span class="string">&#x27;JavaScript权威指南.pdf&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> file3 = <span class="keyword">new</span> File(<span class="string">&#x27;小王子.pdf&#x27;</span>)</span><br><span class="line"></span><br><span class="line">folder1.add(file1)</span><br><span class="line">folder1.add(file2)</span><br><span class="line"></span><br><span class="line">folder2.add(file3)</span><br><span class="line"></span><br><span class="line">folder.add(folder1)</span><br><span class="line">folder.add(folder2)</span><br><span class="line"></span><br><span class="line">folder.scan()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 开始扫描文件夹： 根文件夹</span></span><br><span class="line"><span class="comment">// 开始扫描文件夹： JS</span></span><br><span class="line"><span class="comment">// 开始扫描文件： 深入React技术栈.pdf</span></span><br><span class="line"><span class="comment">// 开始扫描文件： JavaScript权威指南.pdf</span></span><br><span class="line"><span class="comment">// 开始扫描文件夹： life</span></span><br><span class="line"><span class="comment">// 开始扫描文件： 小王子.pdf</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="8-模板方法模式"><a href="#8-模板方法模式" class="headerlink" title="8.模板方法模式"></a><a name="模板方法模式">8.模板方法模式</a></h2><blockquote>
<p>定义：在继承的基础上，在父类中定义好执行的算法。  </p>
</blockquote>
<h3 id="泡茶和泡咖啡"><a href="#泡茶和泡咖啡" class="headerlink" title="泡茶和泡咖啡"></a>泡茶和泡咖啡</h3><p>来对比下泡茶和泡咖啡过程中的异同   </p>
<table>
<thead>
<tr>
<th>步骤</th>
<th>泡茶</th>
<th>泡咖啡</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>烧开水</td>
<td>烧开水</td>
</tr>
<tr>
<td>2</td>
<td>浸泡茶叶</td>
<td>冲泡咖啡</td>
</tr>
<tr>
<td>3</td>
<td>倒入杯子</td>
<td>倒入杯子</td>
</tr>
<tr>
<td>4</td>
<td>加柠檬</td>
<td>加糖</td>
</tr>
</tbody></table>
<p>可以清晰地看出仅仅在步骤 2 和 4 上有细微的差别，下面着手实现：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Drinks = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">Drinks.prototype.firstStep = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;烧开水&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Drinks.prototype.secondStep = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">Drinks.prototype.thirdStep = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;倒入杯子&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Drinks.prototype.fourthStep = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">Drinks.prototype.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 模板方法模式核心：在父类上定义好执行算法</span></span><br><span class="line">  <span class="built_in">this</span>.firstStep()</span><br><span class="line">  <span class="built_in">this</span>.secondStep()</span><br><span class="line">  <span class="built_in">this</span>.thirdStep()</span><br><span class="line">  <span class="built_in">this</span>.fourthStep()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Tea = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">Tea.prototype = <span class="keyword">new</span> Drinks</span><br><span class="line"></span><br><span class="line">Tea.prototype.secondStep = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;浸泡茶叶&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Tea.prototype.fourthStep = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;加柠檬&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Coffee = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">Coffee.prototype = <span class="keyword">new</span> Drinks</span><br><span class="line"></span><br><span class="line">Coffee.prototype.secondStep = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;冲泡咖啡&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Coffee.prototype.fourthStep = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;加糖&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> tea = <span class="keyword">new</span> Tea()</span><br><span class="line">tea.init()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 烧开水</span></span><br><span class="line"><span class="comment">// 浸泡茶叶</span></span><br><span class="line"><span class="comment">// 倒入杯子</span></span><br><span class="line"><span class="comment">// 加柠檬</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> coffee = <span class="keyword">new</span> Coffee()</span><br><span class="line">coffee.init()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 烧开水</span></span><br><span class="line"><span class="comment">// 冲泡咖啡</span></span><br><span class="line"><span class="comment">// 倒入杯子</span></span><br><span class="line"><span class="comment">// 加糖</span></span><br></pre></td></tr></table></figure>

<h3 id="钩子"><a href="#钩子" class="headerlink" title="钩子"></a>钩子</h3><p>假如客人不想加佐料(糖、柠檬)怎么办，这时可以引人钩子来实现之，实现逻辑如下：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">Drinks.prototype.ifNeedFlavour = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 加上钩子</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Drinks.prototype.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 模板方法模式核心：在父类上定义好执行算法</span></span><br><span class="line">  <span class="built_in">this</span>.firstStep()</span><br><span class="line">  <span class="built_in">this</span>.secondStep()</span><br><span class="line">  <span class="built_in">this</span>.thirdStep()</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">this</span>.ifNeedFlavour()) &#123; <span class="comment">// 默认是 true，也就是要加调料</span></span><br><span class="line">    <span class="built_in">this</span>.fourthStep()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">const</span> Coffee = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">Coffee.prototype = <span class="keyword">new</span> Drinks()</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">Coffee.prototype.ifNeedFlavour = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">window</span>.confirm(<span class="string">&#x27;是否需要佐料吗？&#x27;</span>) <span class="comment">// 弹框选择是否佐料</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="9-享元模式"><a href="#9-享元模式" class="headerlink" title="9.享元模式"></a><a name="享元模式">9.享元模式</a></h2><p>享元模式是一种优化程序性能的模式，本质为减少对象创建的个数。  </p>
<p>以下情况可以使用享元模式：  </p>
<ul>
<li>有大量相似的对象，占用了大量内存  </li>
<li>对象中大部分状态可以抽离为外部状态  </li>
</ul>
<h3 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h3><p>某商家有 50 种男款内衣和 50 种款女款内衣，要展示它们  </p>
<p>方案一：造 50 个塑料男模和 50 个塑料女模，让他们穿上展示，代码如下：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Model = <span class="function"><span class="keyword">function</span>(<span class="params">gender, underwear</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.gender = gender</span><br><span class="line">  <span class="built_in">this</span>.underwear = underwear</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Model.prototype.takephoto = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.gender&#125;</span>穿着<span class="subst">$&#123;<span class="built_in">this</span>.underwear&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; <span class="number">51</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">const</span> maleModel = <span class="keyword">new</span> Model(<span class="string">&#x27;male&#x27;</span>, <span class="string">`第<span class="subst">$&#123;i&#125;</span>款衣服`</span>)</span><br><span class="line">  maleModel.takephoto()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; <span class="number">51</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">const</span> female = <span class="keyword">new</span> Model(<span class="string">&#x27;female&#x27;</span>, <span class="string">`第<span class="subst">$&#123;i&#125;</span>款衣服`</span>)</span><br><span class="line">  female.takephoto()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>方案二：造 1 个塑料男模特 1 个塑料女模特，分别试穿 50 款内衣  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Model = <span class="function"><span class="keyword">function</span>(<span class="params">gender</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.gender = gender</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Model.prototype.takephoto = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.sex&#125;</span>穿着<span class="subst">$&#123;<span class="built_in">this</span>.underwear&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> maleModel = <span class="keyword">new</span> Model(<span class="string">&#x27;male&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> femaleModel = <span class="keyword">new</span> Model(<span class="string">&#x27;female&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; <span class="number">51</span>; i++) &#123;</span><br><span class="line">  maleModel.underwear = <span class="string">`第<span class="subst">$&#123;i&#125;</span>款衣服`</span></span><br><span class="line">  maleModel.takephoto()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; <span class="number">51</span>; i++) &#123;</span><br><span class="line">  femaleModel.underwear = <span class="string">`第<span class="subst">$&#123;i&#125;</span>款衣服`</span></span><br><span class="line">  femaleModel.takephoto()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对比发现：方案一创建了 100 个对象，方案二只创建了 2 个对象，在该 demo 中，gender(性别) 是内部对象，underwear(穿着) 是外部对象。  </p>
<p>当然在方案二的 demo 中，还可以进一步改善：  </p>
<ul>
<li>一开始就通过构造函数显示地创建实例，可用工场模式将其升级成可控生成</li>
<li>在实例上手动添加 underwear 不是很优雅，可以在外部单独在写个 manager 函数<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Model = <span class="function"><span class="keyword">function</span>(<span class="params">gender</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.gender = gender</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Model.prototype.takephoto = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.gender&#125;</span>穿着<span class="subst">$&#123;<span class="built_in">this</span>.underwear&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> modelFactory = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 优化第一点</span></span><br><span class="line">  <span class="keyword">const</span> modelGender = &#123;&#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">createModel</span>: <span class="function"><span class="keyword">function</span>(<span class="params">gender</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (modelGender[gender]) &#123;</span><br><span class="line">        <span class="keyword">return</span> modelGender[gender]</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> modelGender[gender] = <span class="keyword">new</span> Model(gender)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;())</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> modelManager = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> modelObj = &#123;&#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">add</span>: <span class="function"><span class="keyword">function</span>(<span class="params">gender, i</span>) </span>&#123;</span><br><span class="line">      modelObj[i] = &#123;</span><br><span class="line">        <span class="attr">underwear</span>: <span class="string">`第<span class="subst">$&#123;i&#125;</span>款衣服`</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> modelFactory.createModel(gender)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">copy</span>: <span class="function"><span class="keyword">function</span>(<span class="params">model, i</span>) </span>&#123; <span class="comment">// 优化第二点</span></span><br><span class="line">      model.underwear = modelObj[i].underwear</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;())</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; <span class="number">51</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">const</span> maleModel = modelManager.add(<span class="string">&#x27;male&#x27;</span>, i)</span><br><span class="line">  modelManager.copy(maleModel, i)</span><br><span class="line">  maleModel.takephoto()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; <span class="number">51</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">const</span> femaleModel = modelManager.add(<span class="string">&#x27;female&#x27;</span>, i)</span><br><span class="line">  modelManager.copy(femaleModel, i)</span><br><span class="line">  femaleModel.takephoto()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h2 id="10-职责链模式"><a href="#10-职责链模式" class="headerlink" title="10.职责链模式"></a><a name="职责链模式">10.职责链模式</a></h2><p>职责链模式：类似多米诺骨牌，通过请求第一个条件，会持续执行后续的条件，直到返回结果为止。<br><img src="https://camo.githubusercontent.com/cb2073f5e9c165843754e0b5984652c3291e88a6/687474703a2f2f6f71687473637573302e626b742e636c6f7564646e2e636f6d2f63626338633130626261653230326263643234336636623037303464653362612e6a70672d333030" alt="职责链模式"><br>重要性：4 星，在项目中能对 if-else 语句进行优化   </p>
<h3 id="场景-demo"><a href="#场景-demo" class="headerlink" title="场景 demo"></a>场景 demo</h3><p>场景：某电商针对已付过定金的用户有优惠政策，在正式购买后，已经支付过 500 元定金的用户会收到 100 元的优惠券，200 元定金的用户可以收到 50 元优惠券，没有支付过定金的用户只能正常购买。   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// orderType: 表示订单类型，1：500 元定金用户；2：200 元定金用户；3：普通购买用户</span></span><br><span class="line"><span class="comment">// pay：表示用户是否已经支付定金，true: 已支付；false：未支付</span></span><br><span class="line"><span class="comment">// stock: 表示当前用于普通购买的手机库存数量，已支付过定金的用户不受此限制</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> order = <span class="function"><span class="keyword">function</span>(<span class="params"> orderType, pay, stock </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ( orderType === <span class="number">1</span> ) &#123;</span><br><span class="line">    <span class="keyword">if</span> ( pay === <span class="literal">true</span> ) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;500 元定金预购，得到 100 元优惠券&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (stock &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;普通购买，无优惠券&#x27;</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;库存不够，无法购买&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( orderType === <span class="number">2</span> ) &#123;</span><br><span class="line">    <span class="keyword">if</span> ( pay === <span class="literal">true</span> ) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;200 元定金预购，得到 50 元优惠券&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (stock &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;普通购买，无优惠券&#x27;</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;库存不够，无法购买&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( orderType === <span class="number">3</span> ) &#123;</span><br><span class="line">    <span class="keyword">if</span> (stock &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;普通购买，无优惠券&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;库存不够，无法购买&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">order( <span class="number">3</span>, <span class="literal">true</span>, <span class="number">500</span> ) <span class="comment">// 普通购买，无优惠券</span></span><br></pre></td></tr></table></figure>

<p>下面用职责链模式改造代码：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> order500 = <span class="function"><span class="keyword">function</span>(<span class="params">orderType, pay, stock</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ( orderType === <span class="number">1</span> &amp;&amp; pay === <span class="literal">true</span> ) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;500 元定金预购，得到 100 元优惠券&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    order200(orderType, pay, stock)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> order200 = <span class="function"><span class="keyword">function</span>(<span class="params">orderType, pay, stock</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ( orderType === <span class="number">2</span> &amp;&amp; pay === <span class="literal">true</span> ) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;200 元定金预购，得到 50 元优惠券&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    orderCommon(orderType, pay, stock)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> orderCommon = <span class="function"><span class="keyword">function</span>(<span class="params">orderType, pay, stock</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (orderType === <span class="number">3</span> &amp;&amp; stock &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;普通购买，无优惠券&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;库存不够，无法购买&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">order500( <span class="number">3</span>, <span class="literal">true</span>, <span class="number">500</span> ) <span class="comment">// 普通购买，无优惠券</span></span><br></pre></td></tr></table></figure>

<p>改造后可以发现代码相对清晰了，但是链路代码和业务代码依然耦合在一起，进一步优化：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 业务代码</span></span><br><span class="line"><span class="keyword">const</span> order500 = <span class="function"><span class="keyword">function</span>(<span class="params">orderType, pay, stock</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ( orderType === <span class="number">1</span> &amp;&amp; pay === <span class="literal">true</span> ) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;500 元定金预购，得到 100 元优惠券&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;nextSuccess&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> order200 = <span class="function"><span class="keyword">function</span>(<span class="params">orderType, pay, stock</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ( orderType === <span class="number">2</span> &amp;&amp; pay === <span class="literal">true</span> ) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;200 元定金预购，得到 50 元优惠券&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;nextSuccess&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> orderCommon = <span class="function"><span class="keyword">function</span>(<span class="params">orderType, pay, stock</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (orderType === <span class="number">3</span> &amp;&amp; stock &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;普通购买，无优惠券&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;库存不够，无法购买&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 链路代码</span></span><br><span class="line"><span class="keyword">const</span> chain = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.fn = fn</span><br><span class="line">  <span class="built_in">this</span>.sucessor = <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">chain.prototype.setNext = <span class="function"><span class="keyword">function</span>(<span class="params">sucessor</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.sucessor = sucessor</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">chain.prototype.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="built_in">this</span>.fn.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>)</span><br><span class="line">  <span class="keyword">if</span> (result === <span class="string">&#x27;nextSuccess&#x27;</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.sucessor.init.apply(<span class="built_in">this</span>.sucessor, <span class="built_in">arguments</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> order500New = <span class="keyword">new</span> chain(order500)</span><br><span class="line"><span class="keyword">const</span> order200New = <span class="keyword">new</span> chain(order200)</span><br><span class="line"><span class="keyword">const</span> orderCommonNew = <span class="keyword">new</span> chain(orderCommon)</span><br><span class="line"></span><br><span class="line">order500New.setNext(order200New)</span><br><span class="line">order200New.setNext(orderCommonNew)</span><br><span class="line"></span><br><span class="line">order500New.init( <span class="number">3</span>, <span class="literal">true</span>, <span class="number">500</span> ) <span class="comment">// 普通购买，无优惠券</span></span><br></pre></td></tr></table></figure>

<p>重构后，链路代码和业务代码彻底地分离。假如未来需要新增 order300，那只需新增与其相关的函数而不必改动原有业务代码。<br>另外结合 AOP 还能简化上述链路代码：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 业务代码</span></span><br><span class="line"><span class="keyword">const</span> order500 = <span class="function"><span class="keyword">function</span>(<span class="params">orderType, pay, stock</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ( orderType === <span class="number">1</span> &amp;&amp; pay === <span class="literal">true</span> ) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;500 元定金预购，得到 100 元优惠券&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;nextSuccess&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> order200 = <span class="function"><span class="keyword">function</span>(<span class="params">orderType, pay, stock</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ( orderType === <span class="number">2</span> &amp;&amp; pay === <span class="literal">true</span> ) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;200 元定金预购，得到 50 元优惠券&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;nextSuccess&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> orderCommon = <span class="function"><span class="keyword">function</span>(<span class="params">orderType, pay, stock</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (orderType === <span class="number">3</span> &amp;&amp; stock &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;普通购买，无优惠券&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;库存不够，无法购买&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 链路代码</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.after = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> self = <span class="built_in">this</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> result = self.apply(self, <span class="built_in">arguments</span>)</span><br><span class="line">    <span class="keyword">if</span> (result === <span class="string">&#x27;nextSuccess&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> fn.apply(self, <span class="built_in">arguments</span>) <span class="comment">// 这里 return 别忘记了~</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> order = order500.after(order200).after(orderCommon)</span><br><span class="line"></span><br><span class="line">order( <span class="number">3</span>, <span class="literal">true</span>, <span class="number">500</span> ) <span class="comment">// 普通购买，无优惠券</span></span><br></pre></td></tr></table></figure>
<p>职责链模式比较重要，项目中能用到它的地方会有很多，用上它能解耦 1 个请求对象和 n 个目标对象的关系。   </p>
<hr>
<h2 id="11-中介者模式"><a href="#11-中介者模式" class="headerlink" title="11.中介者模式"></a><a name="中介者模式">11.中介者模式</a></h2><p>中介者模式：对象和对象之间借助第三方中介者进行通信。<br><img src="https://camo.githubusercontent.com/8411d6ad7b3c4e4f4fa3a14115f33428f5e4ab0f/687474703a2f2f6f71687473637573302e626b742e636c6f7564646e2e636f6d2f61653039353866383539393039373863343862336136616132636137366561312e6a70672d343030" alt="中介者模式">  </p>
<h3 id="场景-demo-1"><a href="#场景-demo-1" class="headerlink" title="场景 demo"></a>场景 demo</h3><p>一场测试结束后，公布结果：告知解答出题目的人挑战成功，否则挑战失败。    </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> player = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name</span><br><span class="line">  playerMiddle.add(name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">player.prototype.win = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  playerMiddle.win(<span class="built_in">this</span>.name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">player.prototype.lose = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  playerMiddle.lose(<span class="built_in">this</span>.name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> playerMiddle = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 将就用下这个 demo，这个函数当成中介者</span></span><br><span class="line">  <span class="keyword">const</span> players = []</span><br><span class="line">  <span class="keyword">const</span> winArr = []</span><br><span class="line">  <span class="keyword">const</span> loseArr = []</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">add</span>: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">      players.push(name)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">win</span>: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">      winArr.push(name)</span><br><span class="line">      <span class="keyword">if</span> (winArr.length + loseArr.length === players.length) &#123;</span><br><span class="line">        <span class="built_in">this</span>.show()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">lose</span>: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">      loseArr.push(name)</span><br><span class="line">      <span class="keyword">if</span> (winArr.length + loseArr.length === players.length) &#123;</span><br><span class="line">        <span class="built_in">this</span>.show()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">show</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> winner <span class="keyword">of</span> winArr) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(winner + <span class="string">&#x27;挑战成功;&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> loser <span class="keyword">of</span> loseArr) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(loser + <span class="string">&#x27;挑战失败;&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;())</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = <span class="keyword">new</span> player(<span class="string">&#x27;A 选手&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> b = <span class="keyword">new</span> player(<span class="string">&#x27;B 选手&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> c = <span class="keyword">new</span> player(<span class="string">&#x27;C 选手&#x27;</span>)</span><br><span class="line"></span><br><span class="line">a.win()</span><br><span class="line">b.win()</span><br><span class="line">c.lose()</span><br><span class="line"></span><br><span class="line"><span class="comment">// A 选手挑战成功;</span></span><br><span class="line"><span class="comment">// B 选手挑战成功;</span></span><br><span class="line"><span class="comment">// C 选手挑战失败;</span></span><br></pre></td></tr></table></figure>
<p>在这段代码中 A、B、C 之间没有直接发生关系，而是通过另外的 playerMiddle 对象建立链接，姑且将之当成是中介者模式了。  </p>
<hr>
<h2 id="12-装饰者模式"><a href="#12-装饰者模式" class="headerlink" title="12.装饰者模式"></a><a name="装饰者模式">12.装饰者模式</a></h2><p>装饰器模式：动态地给函数赋能。  </p>
<h3 id="JavaScript-的装饰者模式"><a href="#JavaScript-的装饰者模式" class="headerlink" title="JavaScript 的装饰者模式"></a>JavaScript 的装饰者模式</h3><p>生活中的例子：天气冷了，就添加衣服来保暖；天气热了，就将外套脱下；这个例子很形象地含盖了装饰器的神韵，随着天气的冷暖变化，衣服可以动态的穿上脱下。  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> wear = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;穿上第一件衣服&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> _wear1 = wear</span><br><span class="line"></span><br><span class="line">wear = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  _wear1()</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;穿上第二件衣服&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> _wear2 = wear</span><br><span class="line"></span><br><span class="line">wear = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  _wear2()</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;穿上第三件衣服&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">wear()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 穿上第一件衣服</span></span><br><span class="line"><span class="comment">// 穿上第二件衣服</span></span><br><span class="line"><span class="comment">// 穿上第三件衣服</span></span><br></pre></td></tr></table></figure>

<p>这种方式有以下缺点：1：临时变量会变得越来越多；2：this 指向有时会出错  </p>
<h3 id="AOP-装饰函数"><a href="#AOP-装饰函数" class="headerlink" title="AOP 装饰函数"></a>AOP 装饰函数</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 前置代码</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.before = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> self = <span class="built_in">this</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    fn.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>)</span><br><span class="line">    <span class="keyword">return</span> self.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 后置代码</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.after = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> self = <span class="built_in">this</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    self.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>)</span><br><span class="line">    <span class="keyword">return</span> fn.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用后置代码来实验下上面穿衣服的 demo，  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wear1 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;穿上第一件衣服&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> wear2 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;穿上第二件衣服&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> wear3 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;穿上第三件衣服&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> wear = wear1.after(wear2).after(wear3)</span><br><span class="line">wear()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 穿上第一件衣服</span></span><br><span class="line"><span class="comment">// 穿上第二件衣服</span></span><br><span class="line"><span class="comment">// 穿上第三件衣服</span></span><br></pre></td></tr></table></figure>

<p>但这样子有时会污染原生函数，可以做点通变  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> after = <span class="function"><span class="keyword">function</span>(<span class="params">fn, afterFn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    fn.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>)</span><br><span class="line">    afterFn.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> wear = after(after(wear1, wear2), wear3)</span><br><span class="line">wear()</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="13-状态模式"><a href="#13-状态模式" class="headerlink" title="13.状态模式"></a><a name="状态模式">13.状态模式</a></h2><p>状态模式：将事物内部的每个状态分别封装成类，内部状态改变会产生不同行为。  </p>
<p>优点：用对象代替字符串记录当前状态，状态易维护<br>缺点：需编写大量状态类对象  </p>
<h3 id="场景-demo-2"><a href="#场景-demo-2" class="headerlink" title="场景 demo"></a>场景 demo</h3><p>某某牌电灯，按一下按钮打开弱光，按两下按钮打开强光，按三下按钮关闭灯光。  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将状态封装成不同类</span></span><br><span class="line"><span class="keyword">const</span> weakLight = <span class="function"><span class="keyword">function</span>(<span class="params">light</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.light = light</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">weakLight.prototype.press = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;打开强光&#x27;</span>)</span><br><span class="line">  <span class="built_in">this</span>.light.setState(<span class="built_in">this</span>.light.strongLight)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> strongLight = <span class="function"><span class="keyword">function</span>(<span class="params">light</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.light = light</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">strongLight.prototype.press = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;关灯&#x27;</span>)</span><br><span class="line">  <span class="built_in">this</span>.light.setState(<span class="built_in">this</span>.light.offLight)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> offLight = <span class="function"><span class="keyword">function</span>(<span class="params">light</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.light = light</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">offLight.prototype.press = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;打开弱光&#x27;</span>)</span><br><span class="line">  <span class="built_in">this</span>.light.setState(<span class="built_in">this</span>.light.weakLight)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Light = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.weakLight = <span class="keyword">new</span> weakLight(<span class="built_in">this</span>)</span><br><span class="line">  <span class="built_in">this</span>.strongLight = <span class="keyword">new</span> strongLight(<span class="built_in">this</span>)</span><br><span class="line">  <span class="built_in">this</span>.offLight = <span class="keyword">new</span> offLight(<span class="built_in">this</span>)</span><br><span class="line">  <span class="built_in">this</span>.currentState = <span class="built_in">this</span>.offLight          <span class="comment">// 初始状态</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Light.prototype.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> btn = <span class="built_in">document</span>.createElement(<span class="string">&#x27;button&#x27;</span>)</span><br><span class="line">  btn.innerHTML = <span class="string">&#x27;按钮&#x27;</span></span><br><span class="line">  <span class="built_in">document</span>.body.append(btn)</span><br><span class="line">  <span class="keyword">const</span> self = <span class="built_in">this</span></span><br><span class="line">  btn.addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    self.currentState.press()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Light.prototype.setState = <span class="function"><span class="keyword">function</span>(<span class="params">state</span>) </span>&#123; <span class="comment">// 改变当前状态</span></span><br><span class="line">  <span class="built_in">this</span>.currentState = state</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> light = <span class="keyword">new</span> Light()</span><br><span class="line">light.init()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 打开弱光</span></span><br><span class="line"><span class="comment">// 打开强光</span></span><br><span class="line"><span class="comment">// 关灯</span></span><br></pre></td></tr></table></figure>

<h3 id="非面向对象实现的状态模式"><a href="#非面向对象实现的状态模式" class="headerlink" title="非面向对象实现的状态模式"></a>非面向对象实现的状态模式</h3><p>借助于 JavaScript 的委托机制，可以像如下实现状态模式：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="string">&#x27;weakLight&#x27;</span>: &#123;</span><br><span class="line">    <span class="attr">press</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;打开强光&#x27;</span>)</span><br><span class="line">      <span class="built_in">this</span>.currentState = obj.strongLight</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&#x27;strongLight&#x27;</span>: &#123;</span><br><span class="line">    <span class="attr">press</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;关灯&#x27;</span>)</span><br><span class="line">      <span class="built_in">this</span>.currentState = obj.offLight</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&#x27;offLight&#x27;</span>: &#123;</span><br><span class="line">    <span class="attr">press</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;打开弱光&#x27;</span>)</span><br><span class="line">      <span class="built_in">this</span>.currentState = obj.weakLight</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Light = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.currentState = obj.offLight</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Light.prototype.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> btn = <span class="built_in">document</span>.createElement(<span class="string">&#x27;button&#x27;</span>)</span><br><span class="line">  btn.innerHTML = <span class="string">&#x27;按钮&#x27;</span></span><br><span class="line">  <span class="built_in">document</span>.body.append(btn)</span><br><span class="line">  <span class="keyword">const</span> self = <span class="built_in">this</span></span><br><span class="line">  btn.addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    self.currentState.press.call(self) <span class="comment">// 通过 call 完成委托</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> light = <span class="keyword">new</span> Light()</span><br><span class="line">light.init()</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="14-适配者模式"><a href="#14-适配者模式" class="headerlink" title="14.适配者模式"></a><a name="适配者模式">14.适配者模式</a></h2><p>适配者模式：主要用于解决两个接口之间不匹配的问题。  </p>
<h3 id="demo-1"><a href="#demo-1" class="headerlink" title="demo"></a>demo</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 老接口</span></span><br><span class="line"><span class="keyword">const</span> zhejiangCityOld = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;hangzhou&#x27;</span>,</span><br><span class="line">      <span class="attr">id</span>: <span class="number">11</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;jinhua&#x27;</span>,</span><br><span class="line">      <span class="attr">id</span>: <span class="number">12</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;())</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(getZhejiangCityOld())</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新接口希望是下面形式</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">hangzhou</span>: <span class="number">11</span>,</span><br><span class="line">  <span class="attr">jinhua</span>: <span class="number">12</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这时候就可采用适配者模式</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">const</span> adaptor = (<span class="function"><span class="keyword">function</span>(<span class="params">oldCity</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> obj = &#123;&#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> city <span class="keyword">of</span> zhejiangCityOld) &#123;</span><br><span class="line">    obj[city.name] = city.id</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> obj</span><br><span class="line">&#125;())</span><br></pre></td></tr></table></figure>


<blockquote>
<p>原文地址 <a target="_blank" rel="noopener" href="https://juejin.im/post/5afe6430518825428630bc4d">JavaScript 中常见设计模式整理</a></p>
</blockquote>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-05-18</span><i class="fa fa-tag"></i><a class="tag" href="/tags/前端开发/" title="前端开发">前端开发 </a><a class="tag" href="/tags/JavaScript/" title="JavaScript">JavaScript </a></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,https://pingan8787.github.io/2018/05/18/63-【JavaScript】JavaScript中常见设计模式/,pingan8787,63-【JavaScript】JavaScript中常见设计模式,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2018/05/21/64-%E3%80%90%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E3%80%91%E4%BD%9C%E4%B8%BA%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E9%9C%80%E8%A6%81%E4%BA%86%E8%A7%A3%E7%9A%84%E5%BC%80%E6%BA%90%E5%8D%8F%E8%AE%AE%E7%9F%A5%E8%AF%86/" title="64-【前端开发】作为前端开发需要了解的开源协议知识">上一篇</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2018/05/17/62-%E3%80%90CSS%E3%80%91CSS%E7%BE%8E%E5%8C%96%E5%8D%95%E9%80%89%E6%A1%86%E5%A4%8D%E9%80%89%E6%A1%86%E5%92%8C%E5%BC%80%E5%85%B3%E6%8C%89%E9%92%AE/" title="62-【CSS】CSS美化单选框复选框和开关按钮">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>