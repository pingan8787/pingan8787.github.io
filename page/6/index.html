<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/6/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-177-【JavaScript】模块化方案总结" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/10/21/177-%E3%80%90JavaScript%E3%80%91%E6%A8%A1%E5%9D%97%E5%8C%96%E6%96%B9%E6%A1%88%E6%80%BB%E7%BB%93/" class="article-date">
  <time class="dt-published" datetime="2019-10-21T12:53:08.000Z" itemprop="datePublished">2019-10-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/10/21/177-%E3%80%90JavaScript%E3%80%91%E6%A8%A1%E5%9D%97%E5%8C%96%E6%96%B9%E6%A1%88%E6%80%BB%E7%BB%93/">177-【JavaScript】模块化方案总结</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/tJ2Y1INJjXxBgsOPypp-Fw">阅读原文</a></p>
</blockquote>
<p>本文包含两部分，第一部分通过简明的描述介绍什么是 <code>CommonJS</code>、<code>AMD</code>、<code>CMD</code>、<code>UMD</code>、<code>ES Module </code>以及它们的常见用法，第二部分则根据实际问题指出在正常的 <code>webpack</code> 构建过程中该如何指定打包配置中的模块化参数。</p>
<h3 id="JavaScript-模块化方案"><a href="#JavaScript-模块化方案" class="headerlink" title="JavaScript 模块化方案"></a>JavaScript 模块化方案</h3><p>模块化这个话题在 ES6 之前是不存在的，因此这也被诟病为早期 JavaScript 开发全局污染和依赖管理混乱问题的源头。这类历史渊源和发展概述在本文将不会提及，因此感兴趣可以自行搜索 JavaScript 发展史进行了解。</p>
<p>直接进入正题，我们来看看常见的模块化方案都有哪些以及他们都有哪些内容。</p>
<h3 id="1-CommonJS"><a href="#1-CommonJS" class="headerlink" title="1. CommonJS"></a>1. CommonJS</h3><p><code>CommonJS</code> 的一个模块就是一个脚本文件，通过执行该文件来加载模块。<code>CommonJS</code> 规范规定，每个模块内部，<code>module</code> 变量代表当前模块。这个变量是一个对象，它的 <code>exports</code> 属性（即 <code>module.exports</code>）是对外的接口。加载某个模块，其实是加载该模块的 <code>module.exports</code> 属性。</p>
<p>我们见过这样的模块引用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myModule = <span class="built_in">require</span>(<span class="string">&#x27;module&#x27;</span>);</span><br><span class="line">myModule.sayHello();</span><br></pre></td></tr></table></figure>

<p>这是因为我们把模块的方法定义在了模块的属性上：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// module.js</span></span><br><span class="line"><span class="built_in">module</span>.exports.sayHello = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Hello &#x27;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果这样写</span></span><br><span class="line"><span class="built_in">module</span>.exports = sayHello;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用则需要改为</span></span><br><span class="line"><span class="keyword">var</span> sayHello = <span class="built_in">require</span>(<span class="string">&#x27;module&#x27;</span>);</span><br><span class="line">sayHello();</span><br></pre></td></tr></table></figure>

<p><code>require</code> 命令<strong>第一次加载该脚本时就会执行整个脚本</strong>，然后在内存中生成一个对象（模块可以多次加载，但是在<strong>第一次加载时才会运行，结果被缓存</strong>），这个结果长成这样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="string">&#x27;...&#x27;</span>,</span><br><span class="line">  <span class="attr">exports</span>: &#123; ... &#125;,</span><br><span class="line">  <span class="attr">loaded</span>: <span class="literal">true</span>,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Node.js</code> 的模块机制实现就是参照了 <code>CommonJS</code> 的标准。但是 <code>Node.js</code> 额外做了一件事，即为每个模块提供了一个 <code>exports</code> 变量，以指向 <code>module.exports</code>，这相当于在每个模块最开始，写有这么一行代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">exports</span> = <span class="built_in">module</span>.exports;</span><br></pre></td></tr></table></figure>

<p>CommonJS 模块的特点：</p>
<ul>
<li><p>所有代码都运行在模块作用域，不会污染全局作用域。</p>
</li>
<li><p>独立性是模块的重要特点就，模块内部最好不与程序的其他部分直接交互。</p>
</li>
<li><p>模块可以多次加载，但是只会在第一次加载时运行一次，然后运行结果就被缓存了，以后再加载，就直接读取缓存结果。要想让模块再次运行，必须清除缓存。</p>
</li>
<li><p>模块加载的顺序，按照其在代码中出现的顺序。</p>
</li>
</ul>
<h3 id="2-AMD"><a href="#2-AMD" class="headerlink" title="2. AMD"></a>2. AMD</h3><p><code>CommonJS</code> 规范很好，但是不适用于浏览器环境，于是有了 <strong>AMD</strong> 和 <strong>CMD</strong> 两种方案。<strong>AMD</strong> 全称 <strong>Asynchronous Module Definition</strong>，即异步模块定义。它采用异步方式加载模块，模块的加载不影响它后面语句的运行。所有依赖这个模块的语句，都定义在一个回调函数中，等到加载完成之后，这个回调函数才会运行。除了和 <code>CommonJS</code> 同步加载方式不同之外，<strong>AMD</strong> 在模块的定义与引用上也有所不同。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">define(id?, dependencies?, factory);</span><br></pre></td></tr></table></figure>
<p>AMD 的模块引入由 define 方法来定义，在 define API 中：</p>
<ul>
<li><p><code>id</code>：模块名称，或者模块加载器请求的指定脚本的名字；</p>
</li>
<li><p><code>dependencies</code>：是个定义中模块所依赖模块的数组，默认为 <code>[&quot;require&quot;, &quot;exports&quot;, &quot;module&quot;]</code>，举个例子比较好理解，当我们创建一个名为 “<code>alpha</code>“ 的模块，使用了<code>require</code>，<code>exports</code>，和名为 “<code>beta</code>“ 的模块，需要如下书写（示例1）；</p>
</li>
<li><p><code>factory</code>：为模块初始化要执行的函数或对象。如果为函数，它应该只被执行一次。如果是对象，此对象应该为模块的输出值；</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例1</span></span><br><span class="line">define(<span class="string">&quot;alpha&quot;</span>, [<span class="string">&quot;require&quot;</span>, <span class="string">&quot;exports&quot;</span>, <span class="string">&quot;beta&quot;</span>], <span class="function"><span class="keyword">function</span> (<span class="params"><span class="built_in">require</span>, <span class="built_in">exports</span>, beta</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">exports</span>.verb = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> beta.verb();</span><br><span class="line">    <span class="comment">// 或者</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">require</span>(<span class="string">&quot;beta&quot;</span>).verb();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>如果模块定义不存在依赖，那么可以直接定义对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">define(&#123;</span><br><span class="line">  <span class="attr">add</span>: <span class="function"><span class="keyword">function</span>(<span class="params">x, y</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>而使用时我们依旧通过 require 关键字，它包含两个参数，第一个数组为要加载的模块，第二个参数为回调函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>([<span class="built_in">module</span>], callback);</span><br></pre></td></tr></table></figure>
<p>举个例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>([<span class="string">&#x27;math&#x27;</span>], <span class="function"><span class="keyword">function</span> (<span class="params">math</span>) </span>&#123;</span><br><span class="line">  math.add(<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="3-CMD"><a href="#3-CMD" class="headerlink" title="3. CMD"></a>3. CMD</h3><p>CMD 全称为 <strong>Common Module Definition</strong>，是 <code>Sea.js</code> 所推广的一个模块化方案的输出。在 CMD define 的入参中，虽然也支持包含 <strong>id</strong>, <strong>deps</strong> 以及 <strong>factory</strong> 三个参数的形式，但推荐的是接受 <code>factory</code> 一个入参，然后在入参执行时，填入三个参数 <code>require</code>、<code>exports</code> 和 <code>module</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params"><span class="built_in">require</span>, <span class="built_in">exports</span>, <span class="built_in">module</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="built_in">require</span>(<span class="string">&#x27;./a&#x27;</span>);</span><br><span class="line">  a.doSomething();</span><br><span class="line">  <span class="keyword">var</span> b = <span class="built_in">require</span>(<span class="string">&#x27;./b&#x27;</span>);</span><br><span class="line">  b.doSomething();</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>通过执行该构造方法，可以得到模块向外提供的接口。在与 AMD 比较上存在两个主要的不同点（来自玉伯回答）：</p>
<ul>
<li><p>对于依赖的模块，<code>AMD</code> 是提前执行，<code>CMD</code> 是延迟执行。不过 RequireJS 从 2.0 开始，也改成可以延迟执行（根据写法不同，处理方式不同）。CMD 推崇 as lazy as possible。</p>
</li>
<li><p>CMD 推崇依赖就近，AMD 推崇依赖前置。</p>
</li>
</ul>
<p>如果说的不清楚，那么我们直接看上面的代码用 AMD 该怎么写：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">define([<span class="string">&#x27;./a&#x27;</span>, <span class="string">&#x27;./b&#x27;</span>], <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  a.doSomething();</span><br><span class="line">  b.doSomething();</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="4-UMD"><a href="#4-UMD" class="headerlink" title="4. UMD"></a>4. UMD</h3><p>UMD，全称 <strong>Universal Module Definition</strong>，即通用模块规范。既然 <code>CommonJs</code> 和 AMD 风格一样流行，那么需要一个可以统一浏览器端以及非浏览器端的模块化方案的规范。</p>
<p>直接来看看官方给出的 jQuery 模块如何用 UMD 定义的代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">factory</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">&#x27;function&#x27;</span> &amp;&amp; define.amd) &#123;</span><br><span class="line">        <span class="comment">// AMD. Register as an anonymous module.</span></span><br><span class="line">        define([<span class="string">&#x27;jquery&#x27;</span>], factory);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">module</span> === <span class="string">&#x27;object&#x27;</span> &amp;&amp; <span class="built_in">module</span>.exports) &#123;</span><br><span class="line">        <span class="comment">// Node/CommonJS</span></span><br><span class="line">        <span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params"> root, jQuery </span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> ( jQuery === <span class="literal">undefined</span> ) &#123;</span><br><span class="line">                <span class="comment">// require(&#x27;jQuery&#x27;) returns a factory that requires window to</span></span><br><span class="line">                <span class="comment">// build a jQuery instance, we normalize how we use modules</span></span><br><span class="line">                <span class="comment">// that require this pattern but the window provided is a noop</span></span><br><span class="line">                <span class="comment">// if it&#x27;s defined (how jquery works)</span></span><br><span class="line">                <span class="keyword">if</span> ( <span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">&#x27;undefined&#x27;</span> ) &#123;</span><br><span class="line">                    jQuery = <span class="built_in">require</span>(<span class="string">&#x27;jquery&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    jQuery = <span class="built_in">require</span>(<span class="string">&#x27;jquery&#x27;</span>)(root);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            factory(jQuery);</span><br><span class="line">            <span class="keyword">return</span> jQuery;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Browser globals</span></span><br><span class="line">        factory(jQuery);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;(<span class="function"><span class="keyword">function</span> (<span class="params">$</span>) </span>&#123;</span><br><span class="line">    $.fn.jqueryPlugin = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="literal">true</span>; &#125;;</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>

<p>UMD的实现很简单：</p>
<ul>
<li><p>先判断是否支持 AMD（<code>define</code> 是否存在），存在则使用 AMD 方式加载模块；</p>
</li>
<li><p>再判断是否支持 <strong>Node.js</strong> 模块格式（<code>exports</code> 是否存在），存在则使用 <strong>Node.js</strong> 模块格式；</p>
</li>
<li><p>前两个都不存在，则将模块公开到全局（<code>window</code> 或<code> global</code>）；</p>
</li>
</ul>
<h3 id="5-ES-Modules"><a href="#5-ES-Modules" class="headerlink" title="5. ES Modules"></a>5. ES Modules</h3><p>当然，以上说的种种都是社区提供的方案，历史上，JavaScript 一直没有模块系统，直到 ES6 在语言标准的层面上，实现了它。其设计思想是尽量的静态化，使得编译时就能确定模块的依赖关系，以及输入和输出的变量。<strong>CommonJS</strong> 和 <strong>AMD</strong> 模块，都只能在运行时确定这些东西。比如，<code>CommonJS</code> 模块就是对象，输入时必须查找对象属性。而 ES Modules 不是对象，而是通过 export 命令显式指定输出的代码。</p>
<p>ES Modules 的模块化能力由 <code>export</code> 和 <code>import</code> 组成，<code>export</code> 命令用于规定模块的对外接口，<code>import</code>命令用于输入其他模块提供的功能。我们可以这样定义一个模块：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一种方式</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> firstName = <span class="string">&#x27;Michael&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> lastName = <span class="string">&#x27;Jackson&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> year = <span class="number">1958</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二种方式</span></span><br><span class="line"><span class="keyword">var</span> firstName = <span class="string">&#x27;Michael&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> lastName = <span class="string">&#x27;Jackson&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> year = <span class="number">1958</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; firstName, lastName, year &#125;;</span><br></pre></td></tr></table></figure>

<p>然后再这样引入他们：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; firstName, lastName, year &#125; <span class="keyword">from</span> <span class="string">&#x27;module&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; firstName <span class="keyword">as</span> newName &#125; <span class="keyword">from</span> <span class="string">&#x27;module&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> moduleA <span class="keyword">from</span> <span class="string">&#x27;module&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>除以上两种命令外，还有一个 <code>export default</code> 命令用于指定模块的默认输出（一个模块只能有一个默认输出）。如果使用了 <code>export default</code> 语法，在 <code>import</code> 时则可以任意命名。由于 <code>export default</code> 命令的本质是将后面的值，赋给 <code>default</code> 变量，所以也可以直接将一个值写在 <code>export default</code> 之后。当然，引用方式也存在多种：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="keyword">default</span> <span class="keyword">as</span> foo &#125; <span class="keyword">from</span> <span class="string">&#x27;module&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> foo <span class="keyword">from</span> <span class="string">&#x27;module&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>需要注意的是 Modules 会自动采用严格模式，且 import 命令具有提升效果，会提升到整个模块的头部，首先执行。</p>
<h3 id="webpack-打包输出配置"><a href="#webpack-打包输出配置" class="headerlink" title="webpack 打包输出配置"></a>webpack 打包输出配置</h3><p>说完理论，来看看实际项目中遇到的问题。当我们开发完一个 JavaScript 模块必然要经历打包的流程，而在 <code>webpack</code> 配置中，通过指定 <code>output</code> 选项就可以告诉 <code>webpack</code> 如何输出 <code>bundle</code>, <code>asset</code> 以及其他载入的内容。那么如何实现不同环境可兼容的构建呢？</p>
<ul>
<li><p><code>import</code>：通过 ES Modules 规范语法进入引入；</p>
</li>
<li><p>变量：作为一个全局变量，比如通过 <code>script</code> 标签来访问；</p>
</li>
<li><p><code>thi</code>s：通过 <code>this</code> 对象访问；</p>
</li>
<li><p><code>window</code>：在浏览器中通过 <code>window</code> 对象访问；</p>
</li>
<li><p><code>UMD</code>：在 <code>AMD</code> 或 <code>CommonJS</code> 通过 <code>require</code> 引入后访问；</p>
</li>
<li><p><code>output</code> 中有一个属性叫做 <code>libraryTarget</code>，被用来指定如何暴露你的模块的属性。你可以这样尝试赋值给一个变量或者指定对象的属性：</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加载完成后将模块赋值给一个指定变量（默认值）</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">libraryTarget</span>: <span class="string">&#x27;var&#x27;</span>,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 赋值为指定对象的一个属性，比如 `this` 或者 `window`</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">libraryTarget</span>: <span class="string">&quot;this&quot;</span>,</span><br><span class="line">  <span class="comment">// libraryTarget: &quot;window&quot;,</span></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 同样的，若是指定 commonjs，那么便可以将模块分配给 exports，这也意味着可以用于 CommonJS 环境：</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">libraryTarget</span>: <span class="string">&quot;commonjs&quot;</span>,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果需要更完整的模块化 <code>bundle</code>，以确保和各模块系统兼容，那么可以这样尝试：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 内容分配给 module.exports 对象，用于 CommonJS 环境</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">libraryTarget</span>: <span class="string">&#x27;commonjs2&#x27;</span>,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 暴露为 AMD 模块，通过特定属性引入</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">libraryTarget</span>: <span class="string">&#x27;amd&#x27;</span>,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 所有模块系统兼容的万金油，可以在 CommonJS, AMD 环境下运行，或将模块导出到 global 下的变量</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">libraryTarget</span>: <span class="string">&#x27;umd&#x27;</span>,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因此，如果只看 <code>output</code> 内容，那么我的一个 <code>webpack</code> 生产环境配置可以写成这样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="comment">// webpack 如何输出结果的相关选项</span></span><br><span class="line">    <span class="attr">path</span>: path.resolve(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;index.js&#x27;</span>,</span><br><span class="line">    <span class="attr">library</span>: <span class="string">&#x27;hijiangtao&#x27;</span>,</span><br><span class="line">    <span class="attr">umdNamedDefine</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">libraryTarget</span>: <span class="string">&#x27;umd&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://images.pingan8787.com/2019_07_12guild_page.png" alt="2019_07_12guild_page"></p>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#x70;&#x69;&#x6e;&#x67;&#97;&#x6e;&#x38;&#x37;&#x38;&#55;&#64;&#x71;&#113;&#46;&#x63;&#111;&#109;">&#x70;&#x69;&#x6e;&#x67;&#97;&#x6e;&#x38;&#x37;&#x38;&#55;&#64;&#x71;&#113;&#46;&#x63;&#111;&#109;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>JS小册</td>
<td>js.pingan8787.com</td>
</tr>
</tbody></table>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/10/21/177-%E3%80%90JavaScript%E3%80%91%E6%A8%A1%E5%9D%97%E5%8C%96%E6%96%B9%E6%A1%88%E6%80%BB%E7%BB%93/" data-id="ckts3ejtq004i4d9kgmjcew0f" data-title="177-【JavaScript】模块化方案总结" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-176-【HTML】HTML5的5个常用存储方式" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/10/11/176-%E3%80%90HTML%E3%80%91HTML5%E7%9A%845%E4%B8%AA%E5%B8%B8%E7%94%A8%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F/" class="article-date">
  <time class="dt-published" datetime="2019-10-11T13:58:21.000Z" itemprop="datePublished">2019-10-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/10/11/176-%E3%80%90HTML%E3%80%91HTML5%E7%9A%845%E4%B8%AA%E5%B8%B8%E7%94%A8%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F/">176-【HTML】HTML5的5个常用存储方式</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="一、介绍"><a href="#一、介绍" class="headerlink" title="一、介绍"></a>一、介绍</h2><p>在 HTML5 规范之前，存储主要是用 <code>cookies</code> 。<br><code>cookies</code> 的缺点有：   </p>
<ul>
<li><strong>在请求头上带着数据</strong>；</li>
<li>大小是 <code>4k</code> 之内；</li>
<li>主 <code>Domain</code> 污染；</li>
</ul>
<p><code>cookies</code> 的主要应用：</p>
<p>购物车、客户登录。</p>
<p>由于存在这么多缺点，因此我们需要解决以下问题：   </p>
<ul>
<li><p>解决 <code>4k</code> 的大小问题；</p>
</li>
<li><p>解决请求头常带存储信息的问题；</p>
</li>
<li><p>解决关系型存储的问题；</p>
</li>
<li><p>跨浏览器；</p>
</li>
</ul>
<h2 id="三、五种存储方式"><a href="#三、五种存储方式" class="headerlink" title="三、五种存储方式"></a>三、五种存储方式</h2><h3 id="1-本地存储-localstorage"><a href="#1-本地存储-localstorage" class="headerlink" title="1. 本地存储 localstorage"></a>1. 本地存储 localstorage</h3><ul>
<li><strong>存储方式</strong>：</li>
</ul>
<p>以键值对( <code>Key-Value </code>)的方式存储，永久存储，永不失效，除非手动删除。</p>
<ul>
<li><strong>大小</strong>：</li>
</ul>
<p>每个域名5M。</p>
<ul>
<li><strong>支持情况</strong>：</li>
</ul>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/34uGBxmCnto7TzbpZnGA5yGCqrOJyu2vib5SdR7mb0u6oAzF3nyTHNBdLDxjJ1xMh2EyfBb2QapsjicHdGEwmSrQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="1"></p>
<p>注意：IE9 <code>localStorage</code> 不支持本地文件，需要将项目署到服务器，才可以支持！</p>
<ul>
<li><strong>检测方法</strong>：</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="built_in">window</span>.localStorage)&#123;</span><br><span class="line"> alert(<span class="string">&#x27;This browser supports localStorage&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"> alert(<span class="string">&#x27;This browser does NOT support localStorage&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>常用API</strong>：</li>
</ul>
<p>取记录: <code>getItem</code>；</p>
<p>设置记录：<code>setIten</code>；</p>
<p>移除记录：<code>removeItem</code>；</p>
<p>取 <code>key </code>所对应的值：<code>key</code>；</p>
<p>清除记录：<code>clear</code>；</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/34uGBxmCnto7TzbpZnGA5yGCqrOJyu2v1WDAITbPXPicjIskPQK5pM8FhT8OAdXvFq2TsI2N9O9hDmrpR9pyxibQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="2"></p>
<ul>
<li><strong>存储的内容</strong>：</li>
</ul>
<p>数组，图片，json，样式，脚本。。。（只要是能序列化成字符串的内容都可以存储）。</p>
<h3 id="2-本地存储-sessionstorage"><a href="#2-本地存储-sessionstorage" class="headerlink" title="2. 本地存储 sessionstorage"></a>2. 本地存储 sessionstorage</h3><p>HTML5 的本地存储 API 中的 <code>localStorage</code> 与 <code>sessionStorage</code> 在使用方法上是相同的，区别在于 <code>sessionStorage</code> 在关闭页面后即被清空，而 <code>localStorage</code> 则会一直保存。</p>
<h3 id="3-离线缓存-application-cache"><a href="#3-离线缓存-application-cache" class="headerlink" title="3. 离线缓存 application cache"></a>3. 离线缓存 application cache</h3><p>本地缓存应用所需的文件。</p>
<ul>
<li><strong>使用方法</strong>：</li>
</ul>
<p>需要配置 <code>manifest</code> 文件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">HTML</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">manifest</span>=<span class="string">&quot;demo.appcache&quot;</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>Manifest</code> 文件：</li>
</ul>
<p><code>manifest</code> 文件是简单的文本文件，它告知浏览器被缓存的内容（以及不缓存的内容）。</p>
<p><code>manifest</code> 文件可分为三个部分：</p>
<p>1.1 <code>CACHE MANIFEST</code> - 在此标题下列出的文件将在首次下载后进行缓存；</p>
<p>1.2 <code>NETWORK</code> - 在此标题下列出的文件需要与服务器的连接，且不会被缓存；</p>
<p>1.3 <code>FALLBACK</code> - 在此标题下列出的文件规定当页面无法访问时的回退页面（比如 404 页面）；</p>
<ul>
<li><strong>完整demo</strong>：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CACHE MANIFEST</span><br><span class="line"># 2016-07-24 v1.0.0</span><br><span class="line">/theme.css</span><br><span class="line">/main.js</span><br><span class="line"></span><br><span class="line">NETWORK:</span><br><span class="line">login.jsp</span><br><span class="line"></span><br><span class="line">FALLBACK:</span><br><span class="line">/html/ /offline.html</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>服务器上</strong>：</li>
</ul>
<p><code>manifest</code> 文件需要配置正确的 <code>MIME-type</code> ，即 “<code>text/cache-manifest</code>”。</p>
<p>如 Tomcat:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;mime-mapping&gt;</span><br><span class="line">     &lt;extension&gt;manifest&lt;/extension&gt;</span><br><span class="line">     &lt;mime-type&gt;text/cache-manifest&lt;/mime-type&gt;</span><br><span class="line">&lt;/mime-mapping&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>常用API</strong>：</li>
</ul>
<p>核心是 <code>applicationCache</code> 对象，有个 <code>status</code> 属性，表示应用缓存的当前状态：</p>
<p>0（UNCACHED） :  无缓存， 即没有与页面相关的应用缓存</p>
<p>1（IDLE） : 闲置，即应用缓存未得到更新</p>
<p>2 （CHECKING） : 检查中，即正在下载描述文件并检查更新</p>
<p>3 （DOWNLOADING） : 下载中，即应用缓存正在下载描述文件中指定的资源</p>
<p>4 （UPDATEREADY） : 更新完成，所有资源都已下载完毕</p>
<p>5 （IDLE） :  废弃，即应用缓存的描述文件已经不存在了，因此页面无法再访问应用缓存</p>
<ul>
<li><strong>相关事件</strong>：</li>
</ul>
<p>表示应用缓存状态的改变。</p>
<p><code>checking</code> : 在浏览器为应用缓存查找更新时触发</p>
<p><code>error</code> : 在检查更新或下载资源期间发送错误时触发</p>
<p><code>noupdate</code> : 在检查描述文件发现文件无变化时触发</p>
<p><code>downloading</code> : 在开始下载应用缓存资源时触发</p>
<p><code>progress</code>：在文件下载应用缓存的过程中持续不断地下载地触发</p>
<p><code>updateready</code> : 在页面新的应用缓存下载完毕触发</p>
<p>cached : 在应用缓存完整可用时触发</p>
<ul>
<li><code>Application Cache</code> 的三个优势：</li>
</ul>
<p>① 离线浏览</p>
<p>② 提升页面载入速度</p>
<p>③ 降低服务器压力</p>
<ul>
<li>注意事项：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1. 浏览器对缓存数据的容量限制可能不太一样（某些浏览器设置的限制是每个站点 5MB）</span><br><span class="line"></span><br><span class="line">2. 如果manifest文件，或者内部列举的某一个文件不能正常下载，整个更新过程将视为失败，浏览器继续全部使用老的缓存</span><br><span class="line"></span><br><span class="line">3. 引用manifest的html必须与manifest文件同源，在同一个域下</span><br><span class="line"></span><br><span class="line">4. 浏览器会自动缓存引用manifest文件的HTML文件，这就导致如果改了HTML内容，也需要更新版本才能做到更新。</span><br><span class="line"></span><br><span class="line">5. manifest文件中CACHE则与NETWORK，FALLBACK的位置顺序没有关系，如果是隐式声明需要在最前面</span><br><span class="line"></span><br><span class="line">6. FALLBACK中的资源必须和manifest文件同源</span><br><span class="line"></span><br><span class="line">7. 更新完版本后，必须刷新一次才会启动新版本（会出现重刷一次页面的情况），需要添加监听版本事件。</span><br><span class="line"></span><br><span class="line">8. 站点中的其他页面即使没有设置manifest属性，请求的资源如果在缓存中也从缓存中访问</span><br><span class="line"></span><br><span class="line">9. 当manifest文件发生改变时，资源请求本身也会触发更新</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>离线缓存与传统浏览器缓存区别</strong>：</li>
</ul>
<ol>
<li><p>离线缓存是针对整个应用，浏览器缓存是单个文件</p>
</li>
<li><p>离线缓存断网了还是可以打开页面，浏览器缓存不行</p>
</li>
<li><p>离线缓存可以主动通知浏览器更新资源</p>
</li>
</ol>
<h3 id="4-Web-SQL"><a href="#4-Web-SQL" class="headerlink" title="4. Web SQL"></a>4. Web SQL</h3><p>关系数据库，通过SQL语句访问。</p>
<p><code>Web SQL</code> 数据库 API 并不是 HTML5 规范的一部分，但是它是一个独立的规范，引入了一组使用 SQL 操作客户端数据库的 APIs。</p>
<ul>
<li><strong>支持情况</strong>：</li>
</ul>
<p><code>Web SQL</code> 数据库可以在最新版的 Safari, Chrome 和 Opera 浏览器中工作。</p>
<ul>
<li><strong>核心方法</strong>：</li>
</ul>
<p>①<code>openDatabase</code>：这个方法使用现有的数据库或者新建的数据库创建一个数据库对象。</p>
<p>②<code>transaction</code>：这个方法让我们能够控制一个事务，以及基于这种情况执行提交或者回滚。</p>
<p>③<code>executeSql</code>：这个方法用于执行实际的 SQL 查询。</p>
<ul>
<li><strong>打开数据库</strong>：</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> db = openDatabase(<span class="string">&#x27;mydb&#x27;</span>, <span class="string">&#x27;1.0&#x27;</span>, <span class="string">&#x27;Test DB&#x27;</span>, <span class="number">2</span> * <span class="number">1024</span> * <span class="number">1024</span>,fn);</span><br><span class="line"><span class="comment">// openDatabase() 方法对应的五个参数</span></span><br><span class="line"><span class="comment">// 分别为：数据库名称、版本号、描述文本、数据库大小、创建回调</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>执行查询操作</strong>：</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> db = openDatabase(<span class="string">&#x27;mydb&#x27;</span>, <span class="string">&#x27;1.0&#x27;</span>, <span class="string">&#x27;Test DB&#x27;</span>, <span class="number">2</span> * <span class="number">1024</span> * <span class="number">1024</span>);</span><br><span class="line">db.transaction(<span class="function"><span class="keyword">function</span> (<span class="params">tx</span>) </span>&#123;  </span><br><span class="line">   tx.executeSql(<span class="string">&#x27;CREATE TABLE IF NOT EXISTS WIN (id unique, name)&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>插入数据</strong>：</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> db = openDatabase(<span class="string">&#x27;mydb&#x27;</span>, <span class="string">&#x27;1.0&#x27;</span>, <span class="string">&#x27;Test DB&#x27;</span>, <span class="number">2</span> * <span class="number">1024</span> * <span class="number">1024</span>);</span><br><span class="line">db.transaction(<span class="function"><span class="keyword">function</span> (<span class="params">tx</span>) </span>&#123;</span><br><span class="line">   tx.executeSql(<span class="string">&#x27;CREATE TABLE IF NOT EXISTS WIN (id unique, name)&#x27;</span>);</span><br><span class="line">   tx.executeSql(<span class="string">&#x27;INSERT INTO WIN (id, name) VALUES (1, &quot;winty&quot;)&#x27;</span>);</span><br><span class="line">   tx.executeSql(<span class="string">&#x27;INSERT INTO WIN (id, name) VALUES (2, &quot;LuckyWinty&quot;)&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>读取数据</strong>：</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">db.transaction(<span class="function"><span class="keyword">function</span> (<span class="params">tx</span>) </span>&#123;</span><br><span class="line">   tx.executeSql(<span class="string">&#x27;SELECT * FROM WIN&#x27;</span>, [], <span class="function"><span class="keyword">function</span> (<span class="params">tx, results</span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> len = results.rows.length, i;</span><br><span class="line">      msg = <span class="string">&quot;&lt;p&gt;查询记录条数: &quot;</span> + len + <span class="string">&quot;&lt;/p&gt;&quot;</span>;</span><br><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">&#x27;#status&#x27;</span>).innerHTML +=  msg;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i++)&#123;</span><br><span class="line">         alert(results.rows.item(i).name );</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">   &#125;, <span class="literal">null</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>由这些操作可以看出，基本上都是用SQL语句进行数据库的相关操作，如果你会MySQL的话，这个应该比较容易用。</p>
<h3 id="5-IndexedDB"><a href="#5-IndexedDB" class="headerlink" title="5. IndexedDB"></a>5. IndexedDB</h3><p>索引数据库 (IndexedDB) API（作为 HTML5 的一部分）对创建具有丰富本地存储数据的数据密集型的离线 HTML5 Web 应用程序很有用。</p>
<p>同时它还有助于本地缓存数据，使传统在线 Web 应用程序（比如移动 Web 应用程序）能够更快地运行和响应。</p>
<ul>
<li><strong>异步API</strong>：</li>
</ul>
<p>在 IndexedDB 大部分操作并不是我们常用的调用方法，返回结果的模式，而是请求——响应的模式，比如打开数据库的操作:</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/34uGBxmCnto7TzbpZnGA5yGCqrOJyu2vyYezL9lNFpqFLJQwibAseZSoE0CzApfbbZYeznRKRJFBSDDCRyxjdYg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="3"></p>
<p>这样，我们打开数据库的时候，实质上返回了一个DB对象，而这个对象就在result中。</p>
<p>由上图可以看出，除了 <code>result</code> 之外。还有几个重要的属性就是 <code>onerror</code> 、 <code>onsuccess</code> 、 <code>onupgradeneeded</code> （我们请求打开的数据库的版本号和已经存在的数据库版本号不一致的时候调用）。</p>
<p>这就类似于我们的 <code>ajax</code> 请求那样。我们发起了这个请求之后并不能确定它什么时候才请求成功，所以需要在回调中处理一些逻辑。</p>
<ul>
<li><strong>关闭与删除</strong>：</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">closeDB</span>(<span class="params">db</span>)</span>&#123;</span><br><span class="line">     db.close();</span><br><span class="line">&#125;<span class="function"><span class="keyword">function</span> <span class="title">deleteDB</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">     indexedDB.deleteDatabase(name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>数据存储</strong>：</li>
</ul>
<p>indexedDB 中没有表的概念，而是 <code>objectStore</code> ，一个数据库中可以包含多个<code>objectStore</code>，<code>objectStore</code>是一个灵活的数据结构，可以存放多种类型数据。</p>
<p>也就是说一个 <code>objectStore</code> 相当于一张表，里面存储的每条数据和一个键相关联。</p>
<p>我们可以使用每条记录中的某个指定字段作为键值（ <code>keyPath</code> ），也可以使用自动生成的递增数字作为键值（ <code>keyGenerator</code> ），也可以不指定。</p>
<p>选择键的类型不同， <code>objectStore</code> 可以存储的数据结构也有差异。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/10/11/176-%E3%80%90HTML%E3%80%91HTML5%E7%9A%845%E4%B8%AA%E5%B8%B8%E7%94%A8%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F/" data-id="ckts3ejtp004f4d9k2lrd6ak9" data-title="176-【HTML】HTML5的5个常用存储方式" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Webpack/" rel="tag">Webpack</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-175-【Webpack】一看就懂之webpack高级配置与优化" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/10/11/175-%E3%80%90Webpack%E3%80%91%E4%B8%80%E7%9C%8B%E5%B0%B1%E6%87%82%E4%B9%8Bwebpack%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE%E4%B8%8E%E4%BC%98%E5%8C%96/" class="article-date">
  <time class="dt-published" datetime="2019-10-11T13:56:18.000Z" itemprop="datePublished">2019-10-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/10/11/175-%E3%80%90Webpack%E3%80%91%E4%B8%80%E7%9C%8B%E5%B0%B1%E6%87%82%E4%B9%8Bwebpack%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE%E4%B8%8E%E4%BC%98%E5%8C%96/">175-【Webpack】一看就懂之webpack高级配置与优化</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/t9qWv_-DZK8mVfa-T0AFWQ">阅读原文</a></p>
</blockquote>
<h2 id="一、打包多页面应用"><a href="#一、打包多页面应用" class="headerlink" title="一、打包多页面应用"></a>一、打包多页面应用</h2><p>所谓打包多页面，就是同时打包出多个 html 页面，打包多页面也是使用 <code>html-webpack-plugin</code>，只不过，在引入插件的时候是创建多个插件对象，因为一个 <code>html-webpack-plugin</code> 插件对象只能打包出一个 html 页面。如:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">entry</span>: &#123;</span><br><span class="line">        <span class="attr">index</span>: <span class="string">&quot;./src/index.js&quot;</span>, <span class="comment">// 指定打包输出的chunk名为index</span></span><br><span class="line">        <span class="attr">foo</span>: <span class="string">&quot;./src/foo.js&quot;</span> <span class="comment">// 指定打包输出的chunk名为foo</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            <span class="attr">template</span>: <span class="string">&quot;./src/index.html&quot;</span>, <span class="comment">// 要打包输出哪个文件，可以使用相对路径</span></span><br><span class="line">            <span class="attr">filename</span>: <span class="string">&quot;index.html&quot;</span>, <span class="comment">// 打包输出后该html文件的名称</span></span><br><span class="line">            <span class="attr">chunks</span>: [<span class="string">&quot;index&quot;</span>] <span class="comment">// 数组元素为chunk名称，即entry属性值为对象的时候指定的名称，index页面只引入index.js</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            <span class="attr">template</span>: <span class="string">&quot;./src/index.html&quot;</span>, <span class="comment">// 要打包输出哪个文件，可以使用相对路径</span></span><br><span class="line">            <span class="attr">filename</span>: <span class="string">&quot;foo.html&quot;</span>, <span class="comment">// 打包输出后该html文件的名称</span></span><br><span class="line">            <span class="attr">chunks</span>: [<span class="string">&quot;foo&quot;</span>] <span class="comment">// 数组元素为chunk名称，即entry属性值为对象的时候指定的名称，foo页面只引入foo.js</span></span><br><span class="line">        &#125;),</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>打包多页面时，关键在于 <code>chunks</code> 属性的配置，因为在没有配置 <code>chunks</code> 属性的情况下，打包输出的 <code>index.html</code> 和 <code>foo.html</code> 都会同时引入 <code>index.js</code> 和<code> foo.js</code>。</p>
<p>所以必须配置 <code>chunks</code> 属性，来指定打包输出后的 html 文件中要引入的输出模块，数组的元素为 <code>entry</code> 属性值为对象的时候指定的 <code>chunk</code> 名，如上配置，才能实现，<code>index.html</code> 只引入 <code>index.js</code>，<code>foo.html</code> 只引入 <code>foo.js</code> 文件</p>
<h2 id="二、配置-source-map"><a href="#二、配置-source-map" class="headerlink" title="二、配置 source-map"></a>二、配置 source-map</h2><p>source-map 就是源码映射，主要是为了方便代码调试，因为我们打包上线后的代码会被压缩等处理，导致所有代码都被压缩成了一行，如果代码中出现错误，那么浏览器只会提示出错位置在第一行，这样我们无法真正知道出错地方在源码中的具体位置。webpack 提供了一个 devtool 属性来配置源码映射。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> foo = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">console</span>.lg(<span class="string">`console对象的方法名log写成了lg`</span>); <span class="comment">// 源文件第二行出错</span></span><br><span class="line"></span><br><span class="line">index.js:<span class="number">1</span> Uncaught <span class="built_in">TypeError</span>: <span class="built_in">console</span>.lg is not a <span class="function"><span class="keyword">function</span></span></span><br><span class="line"><span class="function">    <span class="title">at</span> <span class="title">Object</span>.&lt;<span class="title">anonymous</span>&gt; (<span class="params">index.js:<span class="number">1</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">at</span> <span class="title">o</span> (<span class="params">index.js:<span class="number">1</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">at</span> <span class="title">Object</span>.&lt;<span class="title">anonymous</span>&gt; (<span class="params">index.js:<span class="number">1</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">at</span> <span class="title">o</span> (<span class="params">index.js:<span class="number">1</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">at</span> <span class="title">index</span>.<span class="title">js</span>:1</span></span><br><span class="line"><span class="function">    <span class="title">at</span> <span class="title">index</span>.<span class="title">js</span>:1</span></span><br></pre></td></tr></table></figure>

<p>源码中出错的位置明明是第二行代码，而浏览器中提示的错误确实在第一行，所以如果代码很复杂的情况下，我们就无法找到出错的具体位置</p>
<p><code>devtool</code> 常见的有 6 种配置:</p>
<ul>
<li>1、source-map:</li>
</ul>
<p>这种模式会产生一个 .map 文件，出错了会提示具体的行和列，文件里面保留了打包后的文件与原始文件之间的映射关系，打包输出文件中会指向生成的 <code>.map</code> 文件，告诉 js 引擎源码在哪里，由于源码与 .map 文件分离，所以需要浏览器发送请求去获取 .map 文件,常用于生产环境，如:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//# sourceMappingURL=index.js.map</span></span><br></pre></td></tr></table></figure>

<ul>
<li>2、eval: </li>
</ul>
<p>这种模式打包速度最快，不会生成 <code>.map </code>文件，会使用 <code>eval </code>将模块包裹，在末尾加入 <code>sourceURL </code>，常用于开发环境，如:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//# sourceURL=webpack:///./src/index.js</span><br></pre></td></tr></table></figure>

<ul>
<li>3、eval-source-map: </li>
</ul>
<p>每个 module 会通过 <code>eval()</code> 来执行，并且生成一个 DataUrl 形式的 <code>SourceMap</code> (即 base64 编码形式内嵌到 eval 语句末尾), 但是不会生成 <code>.map</code> 文件，可以减少网络请求<em>，但是打包文件会非常大</em>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvaW5kZXguanM/YjYzNSJdLCJuYW1lcyI6WyJmb28iLCJjb25zb2xlIiwibGciXSwibWFwcGluZ3MiOiJBQUFBLElBQUlBLEdBQUcsR0FBRyxDQUFWO0FBQ0FDLE9BQU8sQ0FBQ0MsRUFBUix1RSxDQUFxQyIsImZpbGUiOiIuL3NyYy9pbmRleC5qcy5qcyIsInNvdXJjZXNDb250ZW50IjpbImxldCBmb28gPSAxO1xuY29uc29sZS5sZyhgY29uc29sZeWvueixoeeahOaWueazleWQjWxvZ+WGmeaIkOS6hmxnYCk7IC8vIOa6kOaWh+S7tuesrOS6jOihjOWHuumUmVxuIl0sInNvdXJjZVJvb3QiOiIifQ==</span></span><br><span class="line"><span class="comment">//# sourceURL=webpack-internal:///./src/index.js</span></span><br></pre></td></tr></table></figure>

<ul>
<li>4、cheap-source-map:</li>
</ul>
<p> 加上 cheap，就只会提示到第几行报错，少了列信息提示，同时不会对引入的库做映射，可以提高打包性能，但是会产生 <code>.map</code> 文件。</p>
<ul>
<li>5、cheap-module-source-map: </li>
</ul>
<p>和 cheap-source-map 相比，加上了 module，就会对引入的库做映射，并且也会产生 <code>.map</code> 文件，用于生产环境。</p>
<ul>
<li>6、cheap-module-eval-source-map: </li>
</ul>
<p>常用于开发环境，使用 <code>cheap</code> 模式可以大幅提高 <code>souremap</code> 生成的效率，加上 module 同时会对引入的库做映射，eval 提高打包构建速度，并且不会产生 .map 文件减少网络请求。</p>
<p>凡是带 eval 的模式都不能用于生产环境，因为其不会产生 .map 文件，会导致打包后的文件变得非常大。通常我们并不关心列信息，所以都会使用 cheap 模式，但是我们也还是需要对第三方库做映射，以便精准找到错误的位置。</p>
<h2 id="三、watch-和-watchOptions-配置"><a href="#三、watch-和-watchOptions-配置" class="headerlink" title="三、watch 和 watchOptions 配置"></a>三、watch 和 watchOptions 配置</h2><p>webpack 可以<strong>监听文件变化</strong>，当它们修改后会重新编译，如果需要开启该功能，那么需要将 <code>watch</code> 设置为 <code>true</code>，具体监听配置通过 <code>watchOptions</code> 进行相应的设置。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">watch</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">watchOptions</span>: &#123;</span><br><span class="line">        <span class="attr">poll</span>: <span class="number">1000</span>, <span class="comment">// 每隔一秒轮询一次文件是否发生变化</span></span><br><span class="line">        <span class="attr">aggregateTimeout</span>: <span class="number">1000</span>, <span class="comment">// 当第一个文件更改，会在重新构建前增加延迟。这个选项允许 webpack 将这段时间内进行的任何其他更改都聚合到一次重新构建里</span></span><br><span class="line">        <span class="attr">ignored</span>: <span class="regexp">/node_modules/</span> <span class="comment">// 排除一些文件的监听</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="四、三个常见小插件的使用"><a href="#四、三个常见小插件的使用" class="headerlink" title="四、三个常见小插件的使用"></a>四、三个常见小插件的使用</h2><ul>
<li>1、clean-webpack-plugin: </li>
</ul>
<p>其作用就是每次打包前先先将输出目录中的内容进行清空，然后再将打包输出的文件输出到输出目录中。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;CleanWebpackPlugin&#125; = <span class="built_in">require</span>(<span class="string">&quot;clean-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> CleanWebpackPlugin() <span class="comment">// 打包前清空输出目录</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要注意的是，<code>require(&quot;clean-webpack-plugin)</code> 的结果是一个对象而不是类，这个对象中的 <code>CleanWebpackPlugin</code> 属性才是一个类，我们就是用这个类去创建插件对象。</p>
<ul>
<li>2、copy-webpack-plugin: </li>
</ul>
<p>其作用就是打包的时候带上一些 <code>readMe.md</code>、<code>history.md</code> 等等一起输出到输出目录中。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> CopyWebpackPlugin([</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">from</span>: <span class="string">&quot;./readMe.md&quot;</span>, <span class="comment">// 将项目根目录下的readMe.md文件一起拷贝到输出目录中</span></span><br><span class="line">                <span class="attr">to</span>: <span class="string">&quot;&quot;</span> <span class="comment">// 属性值为空字符串则表示是输出目录</span></span><br><span class="line">            &#125;</span><br><span class="line">        ])</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="number">111</span></span><br><span class="line"></span><br><span class="line">* <span class="number">3</span>、BannerPlugin: </span><br><span class="line"></span><br><span class="line">其作用就是在打包输出的 js 文件的头部添加一些文字注释，比如版权说明等等，<span class="string">`BannerPlugin`</span> 是 <span class="string">`webpack`</span> 内置的插件，如:</span><br><span class="line"></span><br><span class="line"><span class="string">``</span><span class="string">`js</span></span><br><span class="line"><span class="string">module.exports = &#123;</span></span><br><span class="line"><span class="string">    plugins: [</span></span><br><span class="line"><span class="string">        new webpack.BannerPlugin(&quot;Copyright © 2019&quot;) // 在js文件头部添加版权说明</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="五、webpack-跨域问题"><a href="#五、webpack-跨域问题" class="headerlink" title="五、webpack 跨域问题"></a>五、webpack 跨域问题</h2><p>为什么 webpack 会存在跨域问题？因为 webpack 打包的是前端代码，其最终会被部署到前端服务器上，而前后端代码通常部署在不同的服务器上，即使是部署在同一个服务器上，所使用的端口也是不一样的，当前端代码通过 ajax 等手段向后端服务器获取数据的时候，由于前后端代码不在同一个域中，故存在跨域问题。</p>
<p>比如，我们通过 <code>webpack</code> 的 <code>devServer</code> 来运行部署我们的前端应用代码，<code>devServer</code> 启动在 <code>8080</code> 端口上，而前端应用代码中会通过 ajax 请求后端数据，后端服务器启动在 <code>3000</code> 端口上。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"><span class="comment">// xhr.open(&quot;get&quot;, &quot;http://localhost:3000/api/test&quot;); // 由于跨域问题无法直接访问到http://localhost:3000下的资源</span></span><br><span class="line">xhr.open(<span class="string">&quot;get&quot;</span>, <span class="string">&quot;/api/test&quot;</span>); <span class="comment">// 本来是要访问http://localhost:3000/api/test</span></span><br><span class="line">xhr.onreadystatechange = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (xhr.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(xhr.responseText);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">xhr.send();</span><br></pre></td></tr></table></figure>

<p>由于前端代码是运行在浏览器中的，如果在前端代码中直接通过 ajax 向<code>http://localhost:3000/api/test</code> 发起请求获取数据，那么由于浏览器同源策略的影响，会存在跨域的问题，所以必须访问 <code>/api/test</code>。但是这样访问又会出现 404 问题，因为其实访问的是 <code>http://localhost:8080/api/test</code>，<code>8080</code> 服务器上是没有该资源的，解决办法就是通过 devServer 配置一个代理服务器</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">devServer</span>: &#123;</span><br><span class="line">        <span class="attr">proxy</span>: &#123;</span><br><span class="line">            <span class="string">&quot;/api&quot;</span>: <span class="string">&quot;http://localhost:3000&quot;</span> <span class="comment">// 路径以/api开头则代理到localhost:3000上</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>访问 <code>http://localhost:8080/api/test </code></p>
<p>就会被代理到<a target="_blank" rel="noopener" href="http://localhost:3000/api/test">http://localhost:3000/api/test</a> 上，proxy 还支持路径的重写，如果 3000 端口服务器上并没有 /api/test 路径，只有 /test 路径，那么就可以对路径进行重写，将 /api 替换掉</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">devServer</span>: &#123;</span><br><span class="line">        <span class="attr">proxy</span>: &#123;</span><br><span class="line">            <span class="string">&quot;/api&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">target</span>: <span class="string">&quot;http://localhost:3000&quot;</span>,</span><br><span class="line">                <span class="attr">pathRewrite</span>: &#123;<span class="string">&quot;/api&quot;</span>: <span class="string">&quot;&quot;</span>&#125; <span class="comment">// 将/api替换掉</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">``</span><span class="string">``</span></span><br><span class="line"></span><br><span class="line">访问 <span class="string">`http://localhost:8080/api/test `</span></span><br><span class="line"></span><br><span class="line">就会被代理到 <span class="string">`http://localhost:3000/test`</span> 上</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">如果前端只是想 <span class="string">`mock`</span> 一些数据，并不需要真正的去访问后台服务器，那么我们可以通过 <span class="string">`devServer`</span> 提供的 <span class="string">`before`</span> 钩子函数获取到内置的服务器对象进行处理请求，这个内置的服务器对象就是 webpack 的 <span class="string">`devServer`</span> 即 <span class="string">`8080`</span> 端口的 <span class="string">`server`</span>，因为是在同一个服务器中请求数据所以也不会出现跨域问题。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">``</span><span class="string">`js</span></span><br><span class="line"><span class="string">before(app) &#123; // 此app即webpack的devServer</span></span><br><span class="line"><span class="string">            app.get(&quot;/api/test&quot;, (req, res, next) =&gt; &#123;</span></span><br><span class="line"><span class="string">                res.json(&#123;name: &quot;even&quot;&#125;);</span></span><br><span class="line"><span class="string">            &#125;)</span></span><br><span class="line"><span class="string">        &#125;</span></span><br></pre></td></tr></table></figure>

<p>我们还可以不通过 <code>webpack</code> 提供的 <code>devServer</code> 来启动 <code>webpack</code>，而是使用自己服务器来启动 <code>webapck。</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>); <span class="comment">// 引入webpack</span></span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">&quot;./webpack.config.js&quot;</span>); <span class="comment">// 引入配置文件</span></span><br><span class="line"><span class="keyword">const</span> compiler = webpack(config); <span class="comment">// 创建webpack的编译器</span></span><br><span class="line"><span class="keyword">const</span> middleWare = <span class="built_in">require</span>(<span class="string">&quot;webpack-dev-middleware&quot;</span>); <span class="comment">//引入webpack的中间件</span></span><br><span class="line">app.use(middleWare(compiler)); <span class="comment">// 将compiler编译器交给中间件处理</span></span><br><span class="line">app.get(<span class="string">&quot;/api/test&quot;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    res.json(&#123;<span class="attr">name</span>: <span class="string">&quot;lhb&quot;</span>&#125;);</span><br><span class="line">&#125;);</span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>

<p>通过自定义服务器启动 webpack，这样 webpack 中的前端代码请求数据就和服务器的资源在同一个域中了。</p>
<h2 id="六、resolve-配置"><a href="#六、resolve-配置" class="headerlink" title="六、resolve 配置"></a>六、resolve 配置</h2><p><code>resolve</code> 用于配置模块的解析相关参数的，其属性值为一个对象。</p>
<ul>
<li>1、modules: </li>
</ul>
<p>告诉 webpack 解析模块时应该搜索的目录，即 <code>require</code> 或 <code>import</code> 模块的时候，只写模块名的时候，到哪里去找，其属性值为数组，因为可配置多个模块搜索路径，其搜索路径必须为绝对路径，比如，<code>src</code> 目录下面有一个 <code>foo.js</code> 文件和 <code>index.js</code> 文件:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> foo = <span class="built_in">require</span>(<span class="string">&quot;./foo&quot;</span>); <span class="comment">// 必须写全foo.js模块的路径</span></span><br><span class="line"><span class="comment">// const foo = require(&quot;foo&quot;); // resolve.modules中配置了模块解析路径为.src目录，则可用只写foo即可搜索到foo.js模块</span></span><br><span class="line"><span class="built_in">console</span>.log(foo);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">resolve</span>: &#123;</span><br><span class="line">        <span class="attr">modules</span>: [path.resolve(__dirname, <span class="string">&quot;./src/&quot;</span>), <span class="string">&quot;node_modules&quot;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于 <code>resolve.modules</code> 中配置了<code> ./src</code> 目录作为模块的搜索目录，所以 <code>index.js</code> 中可以只写模块名即可搜索到<code> foo.js</code> 模块</p>
<ul>
<li>2、alias: </li>
</ul>
<p>用于给路径或者文件取别名，当 <code>import</code> 或者 <code>require</code> 的模块的路径非常长时，我们可以给该模块的路径或者整个路径名+文件名都设置成一个别名，然后直接引入别名即可找到该模块，比如，有一个模块位置非常深</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// const foo = require(&quot;./a/b/c/foo&quot;); // foo.js在./src/a/b/c/foo.js</span></span><br><span class="line"><span class="comment">// const foo = require(&quot;foo&quot;); // foo被映射成了./src/a/b/c/foo.js文件</span></span><br><span class="line"><span class="keyword">const</span> foo = <span class="built_in">require</span>(<span class="string">&quot;bar/foo.js&quot;</span>); <span class="comment">// bar被映射成了./src/a/b/c/路径</span></span><br><span class="line"><span class="built_in">console</span>.log(foo);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">resolve</span>: &#123;</span><br><span class="line">        <span class="attr">alias</span>: &#123;</span><br><span class="line">            <span class="string">&quot;foo&quot;</span>: path.resolve(__dirname, <span class="string">&quot;./src/a/b/c/foo.js&quot;</span>),</span><br><span class="line">            <span class="string">&quot;bar&quot;</span>: path.resolve(__dirname, <span class="string">&quot;./src/a/b/c/&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>需要注意的就是，<code>alias</code> 可以映射文件也可以映射路径</p>
<ul>
<li>3、mainFields: </li>
</ul>
<p>我们的 <code>package.json</code> 中可以有多个字段，用于决定优先使用哪个字段来导入模块，比如 <code>bootstrap</code> 模块中含有 js 也含有 css，其 <code>package.json </code>文件中 main 字段对应的是”<code>dist/js/bootstrap</code>“，style 字段中对应的是”<code>dist/css/bootstrap.css</code>“,我们可以通过设置 <code>mainFields</code> 字段来改变默认引入，如:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">resolve</span>: &#123;</span><br><span class="line">        <span class="attr">mainFields</span>: [<span class="string">&quot;style&quot;</span>, <span class="string">&quot;main&quot;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>4、extensions: </li>
</ul>
<p>用于设置引入模块的时候，如果没有写模块后缀名，webpack 会自动添加后缀去查找，<code>extensions </code>就是用于设置自动添加后缀的顺序，如:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">resolve</span>: &#123;</span><br><span class="line">        <span class="attr">extensions</span>: [<span class="string">&quot;js&quot;</span>, <span class="string">&quot;vue&quot;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果项目中引入了 foo 模块，<code>require(&quot;./foo&quot;)</code>,其会优先找 <code>./foo.js</code>, 如果没有找到 <code>./foo.js</code> 则会去找 <code>./foo.vue</code> 文件</p>
<h2 id="七、设置环境变量"><a href="#七、设置环境变量" class="headerlink" title="七、设置环境变量"></a>七、设置环境变量</h2><p>设置环境变量需要用到 webpack 提供的一个内置插件 <code>DefinePlugin</code> 插件，其作用是将一个字符串值设置为全局变量，如:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> webpack.DefinePlugin(&#123;</span><br><span class="line">            <span class="attr">DEV_MODE</span>: <span class="built_in">JSON</span>.stringify(<span class="string">&#x27;development&#x27;</span>) <span class="comment">// 将&#x27;development&#x27;设置为全局变量DEV_MODE</span></span><br><span class="line">        &#125;),</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样配置之后任何一个模块中都可以直接使用 <code>DEV_MODE</code> 变量了，并且其值为’<code>development</code>‘,与 <code>ProvidePlugin</code> 有点相似，<code>ProvidePlugin </code>是将一个模块注入到所有模块中，实现模块不需要引入即可直接使用。</p>
<h2 id="八、webpack-优化"><a href="#八、webpack-优化" class="headerlink" title="八、webpack 优化"></a>八、webpack 优化</h2><ul>
<li>1、noParse: </li>
</ul>
<p>该配置是作为 module 的一个属性值，即不解析某些模块，所谓不解析，就是不去分析某个模块中的依赖关系，即不去管某个文件是否 import(依赖)了某个文件，对于一些独立的库，比如 jquery，其根本不存在依赖关系，jquery 不会去引入其他的库(要根据自己对某个模块的了解去判断是否要解析该模块)，所以我们可以让 webpack 不去解析 jquery 的依赖关系，提高打包速度，如:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">noParse</span>:<span class="regexp">/jquery/</span>,<span class="comment">//不去解析jquery中的依赖库</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>noParse</code> 是 <code>module</code> 配置中的一个属性，其属性值为一个正则表达式，填入不被解析的模块名称。</p>
<p>为了更清楚的展示 <code>noParse</code> 的作用，假设我们在入口文件 <code>index.js</code> 中引入 <code>bar.js</code> 模块，同时这个 <code>bar.js</code> 模块中也引入了 <code>foo.js</code> 模块，<code>foo.js</code> 不再依赖其他模块了，那么在不使用 <code>noParse</code> 的情况下，webpack 打包的时候，会先去分析 <code>index.js</code> 模块，发现其引入了 <code>bar.js</code> 模块，然后接着分析 <code>bar.js</code> 模块，发现其引入了 <code>foo.js</code> 模块，接着分析 <code>foo.js</code> 模块。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Entrypoint index = index.js</span><br><span class="line">[./src/bar.js] 55 bytes &#123;index&#125; [built]</span><br><span class="line">[./src/foo.js] 21 bytes &#123;index&#125; [built]</span><br><span class="line">[./src/index.js] 81 bytes &#123;index&#125; [built]</span><br></pre></td></tr></table></figure>

<p>而此时如果使用了 <code>noParse: /bar/</code>，那么 webpack 打包的时候，会先去分析 <code>index.js</code> 模块，发现其引入了 <code>bar.js</code> 模块，但是由于 <code>noParse</code> 的作用，将不再继续解析 <code>bar.js</code> 模块了，即不会去分析 <code>bar.js</code> 中引入的 <code>foo.js</code> 模块了。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Entrypoint index = index.js</span><br><span class="line">[./src/bar.js] 55 bytes &#123;index&#125; [built]</span><br><span class="line">[./src/index.js] 81 bytes &#123;index&#125; [built]</span><br></pre></td></tr></table></figure>
<ul>
<li>2、exclude: </li>
</ul>
<p>在 <code>loader</code> 中使用 <code>exclude</code> 排除对某些目录中的文件处理，即引入指定目录下的文件时候，不使用对应的 <code>loader</code> 进行处理，<code>exclude</code> 是 <code>loader </code>配置中的一个属性，属性值为正则表达式，如:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/.js$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">                        <span class="attr">options</span>: &#123;</span><br><span class="line">                            <span class="attr">presets</span>: [<span class="string">&quot;@babel/preset-env&quot;</span>],</span><br><span class="line">                            <span class="attr">plugins</span>: [<span class="string">&quot;@babel/plugin-transform-runtime&quot;</span>]</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">                <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>3、使用 IgnorePlugin </li>
</ul>
<p>来忽略某个模块中某些目录中的模块引用，比如在引入某个模块的时候，该模块会引入大量的语言包，而我们不会用到那么多语言包，如果都打包进项目中，那么就会影响打包速度和最终包的大小，然后再引入需要使用的语言包即可，如:</p>
<p>项目根目录下有一个 time 包，其中有一个 lang 包，lang 包中包含了各种语言输出对应时间的 js 文件，time 包下的 index.js 会引入 lang 包下所有的 js 文件，那么当我们引入 time 模块的时候，就会将 lang 包下的所有 js 文件都打包进去，添加如下配置:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> webpack.IgnorePlugin(<span class="regexp">/lang/</span>, <span class="regexp">/time/</span>)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>引入 time 模块的时候，如果 time 模块中引入了其中的 lang 模块中的内容，那么就忽略掉，即不引入 lang 模块中的内容，需要注意的是，这 <code>/time/ </code>只是匹配文件夹和 time 模块的具体目录位置无关，即只要是引入了目录名为 time 中的内容就会生效。</p>
<ul>
<li>4、使用 HappyPack：</li>
</ul>
<p>由于在打包过程中有大量的文件需要交个 loader 进行处理，包括解析和转换等操作，而由于 js 是单线程的，所以这些文件只能一个一个地处理，而 HappyPack 的工作原理就是充分发挥 CPU 的多核功能，将任务分解给多个子进程去并发执行，子进程处理完后再将结果发送给主进程，happypack 主要起到一个任务劫持的作用，在创建 HappyPack 实例的时候要传入对应文件的 loader，即 use 部分，loader 配置中将使用经过 HappyPack 包装后的 loader 进行处理，如:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> HappyPack = <span class="built_in">require</span>(<span class="string">&quot;happypack&quot;</span>); <span class="comment">// 安装并引入happypack模块</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> HappyPack(&#123; <span class="comment">// 这里对处理css文件的loader进行包装</span></span><br><span class="line">            <span class="attr">id</span>: <span class="string">&quot;css&quot;</span>,<span class="comment">// 之前的loader根据具体的id进行引入</span></span><br><span class="line">            <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>,<span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">            <span class="attr">threads</span>: <span class="number">5</span> <span class="comment">// 设置开启的进程数</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/.css$/</span>, <span class="comment">// 匹配以.css结尾的文件</span></span><br><span class="line">                use: [<span class="string">&quot;happypack/loader?id=css&quot;</span>] <span class="comment">//根据happypack实例中配置的id引入包装后的laoder，这里的happyPack的h可以大写也可以小写</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>webpack 要打包的文件非常多的时候才需要使用 happypack 进行优化，因为开启多进程也是需要耗时间的，所以文件少的时候，使用 happypack 返回更耗时</p>
<ul>
<li>5、抽离公共模块: </li>
</ul>
<p>对于多入口情况，如果某个或某些模块，被两个以上文件所依赖，那么可以将这个模块单独抽离出来，不需要将这些公共的代码都打包进每个输出文件中，这样会造成代码的重复和流量的浪费，即如果有两个入口文件 index.js 和 other.js，它们都依赖了 foo.js，那么如果不抽离公共模块，那么 foo.js 中的代码都会打包进最终输出的 index.js 和 other.js 中去，即有两份 foo.js 了。抽离公共模块也很简单，直接在 optimization 中配置即可，如:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">     <span class="attr">splitChunks</span>: &#123; <span class="comment">// 分割代码块，即抽离公共模块</span></span><br><span class="line">         <span class="attr">cacheGroups</span>: &#123; <span class="comment">// 缓存组</span></span><br><span class="line">             <span class="attr">common</span>: &#123; <span class="comment">// 组名为common可自定义</span></span><br><span class="line">                    <span class="attr">chunks</span>: <span class="string">&quot;initial&quot;</span>,</span><br><span class="line">                    <span class="attr">minSize</span>: <span class="number">0</span>, <span class="comment">// 文件大小为0字节以上才抽离</span></span><br><span class="line">                    <span class="attr">minChunks</span>: <span class="number">2</span>, <span class="comment">// 被引用过两次才抽离</span></span><br><span class="line">                    <span class="attr">name</span>: <span class="string">&quot;common/foo&quot;</span>, <span class="comment">// 定义抽离出的文件的名称</span></span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样就会将公共的 foo.js 模块抽离到 common 目录下 foo.js 中了，但是如果我们也有多个文件依赖了第三方模块如 jquery，如果按以上配置，那么 jquery 也会被打包进 foo.js 中，会导致代码混乱，所以我们希望将 jquery 单独抽出来，即与 foo.js 分开，我们可以复制一份以上配置，并通过设置抽离代码权重的方式来实现，即优先抽离出 jquery，如:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">     <span class="attr">splitChunks</span>: &#123; <span class="comment">// 分割代码块，即抽离公共模块</span></span><br><span class="line">         <span class="attr">cacheGroups</span>: &#123; <span class="comment">// 缓存组</span></span><br><span class="line">             <span class="attr">common</span>: &#123; <span class="comment">// 组名为common可自定义</span></span><br><span class="line">                    <span class="attr">chunks</span>: <span class="string">&quot;initial&quot;</span>,</span><br><span class="line">                    <span class="attr">minSize</span>: <span class="number">0</span>, <span class="comment">// 文件大小为0字节以上才抽离</span></span><br><span class="line">                    <span class="attr">minChunks</span>: <span class="number">2</span>, <span class="comment">// 被引用过两次才抽离</span></span><br><span class="line">                    <span class="attr">name</span>: <span class="string">&quot;common/foo&quot;</span>, <span class="comment">// 定义抽离出的文件的名称</span></span><br><span class="line">             &#125;,</span><br><span class="line">             <span class="attr">verdor</span>: &#123;</span><br><span class="line">                    <span class="attr">test</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                    priority: <span class="number">1</span>, <span class="comment">// 设置打包权重，即优先抽离第三方模块</span></span><br><span class="line">                    <span class="attr">chunks</span>: <span class="string">&quot;initial&quot;</span>,</span><br><span class="line">                    <span class="attr">minSize</span>: <span class="number">0</span>, <span class="comment">// 文件大小为0字节以上才抽离</span></span><br><span class="line">                    <span class="attr">minChunks</span>: <span class="number">2</span>, <span class="comment">// 被引用过两次才抽离</span></span><br><span class="line">                    <span class="attr">name</span>: <span class="string">&quot;common/jquery&quot;</span>, <span class="comment">// 定义抽离出的文件的名称</span></span><br><span class="line">                &#125;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样就会在 common 目录下同时抽离出 foo.js 和 jquery.js 了，需要注意的是，代码的抽离必须是该模块没有被排除打包，即该模块会被打包进输出 bundle 中，如果第三方模块已经通过 externals 排除打包，则以上 vendor 配置无效。</p>
<ul>
<li>6、按需加载，</li>
</ul>
<p>即在需要使用的时候才打包输出，webpack 提供了 import() 方法，传入要动态加载的模块，来动态加载指定的模块，当 webpack 遇到 import()语句的时候，不会立即去加载该模块，而是在用到该模块的时候，再去加载，也就是说打包的时候会一起打包出来，但是在浏览器中加载的时候并不会立即加载，而是等到用到的时候再去加载，比如，点击按钮后才会加载某个模块，如:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> button = <span class="built_in">document</span>.createElement(<span class="string">&quot;button&quot;</span>);</span><br><span class="line">button.innerText = <span class="string">&quot;点我&quot;</span></span><br><span class="line">button.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function">() =&gt;</span> &#123; <span class="comment">// 点击按钮后加载foo.js</span></span><br><span class="line">    <span class="keyword">import</span>(<span class="string">&quot;./foo&quot;</span>).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123; <span class="comment">// import()返回的是一个Promise对象</span></span><br><span class="line">        <span class="built_in">console</span>.log(res);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(button);</span><br></pre></td></tr></table></figure>

<p>从中可以看到，<code>import()</code> 返回的是一个 <code>Promise</code> 对象，其主要就是利用 JSONP 实现动态加载，返回的 <code>res</code> 结果不同的<code> export</code> 方式会有不同，如果使用的 <code>module.exports</code> 输出，那么返回的<code> res</code> 就是 <code>module.exports</code> 输出的结果；如果使用的是 ES6 模块输出，即 <code>export default</code> 输出，那么返回的 res 结果就是 <code>res.default</code>，如:</p>
<p>// ES6模块输出，res结果为</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">default</span>: <span class="string">&quot;foo&quot;</span>, <span class="attr">__esModule</span>: <span class="literal">true</span>, <span class="built_in">Symbol</span>(<span class="built_in">Symbol</span>.toStringTag): <span class="string">&quot;Module&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>7、开启模块热更新: </li>
</ul>
<p>模块热更新可以做到在不刷新网页的情况下，更新修改的模块，只编译变化的模块，而不用全部模块重新打包，大大提高开发效率，在未开启热更新的情况下，每次修改了模块，都会重新打包。</p>
<p>要开启模块热更新，那么只需要在 devServer 配置中添加 hot:true 即可。当然仅仅开启模块热更新是不够的，我们需要做一些类似监听的操作，当监听的模块发生变化的时候，重新加载该模块并执行，如:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">devServer</span>: &#123;</span><br><span class="line">        <span class="attr">hot</span>: <span class="literal">true</span> <span class="comment">// 开启热更新</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">----------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> foo <span class="keyword">from</span> <span class="string">&quot;./foo&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(foo);</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">    <span class="built_in">module</span>.hot.accept(<span class="string">&quot;./foo&quot;</span>, <span class="function">() =&gt;</span> &#123; <span class="comment">// 监听到foo模块发生变化的时候</span></span><br><span class="line">        <span class="keyword">const</span> foo =  <span class="built_in">require</span>(<span class="string">&quot;./foo&quot;</span>); <span class="comment">// 重新引入该模块并执行</span></span><br><span class="line">        <span class="built_in">console</span>.log(foo);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果不使用 <code>module.hot.accept</code> 监听，那么当修改 foo 模块的时候还是会刷新页面的。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/10/11/175-%E3%80%90Webpack%E3%80%91%E4%B8%80%E7%9C%8B%E5%B0%B1%E6%87%82%E4%B9%8Bwebpack%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE%E4%B8%8E%E4%BC%98%E5%8C%96/" data-id="ckts3ejyb00mc4d9k53pvfwe7" data-title="175-【Webpack】一看就懂之webpack高级配置与优化" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Webpack/" rel="tag">Webpack</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-174-【CSS】Grid网格布局入门" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/09/20/174-%E3%80%90CSS%E3%80%91Grid%E7%BD%91%E6%A0%BC%E5%B8%83%E5%B1%80%E5%85%A5%E9%97%A8/" class="article-date">
  <time class="dt-published" datetime="2019-09-20T15:18:44.000Z" itemprop="datePublished">2019-09-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/09/20/174-%E3%80%90CSS%E3%80%91Grid%E7%BD%91%E6%A0%BC%E5%B8%83%E5%B1%80%E5%85%A5%E9%97%A8/">174-【CSS】Grid网格布局入门</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/zPShx9nyeABE36QaJKrXdA">阅读原文</a></p>
</blockquote>
<p>CSS Grid(网格) 布局使我们能够比以往任何时候都可以更灵活构建和控制自定义网格。Grid(网格) 布局使我们能够将网页分成具有简单属性的行和列。</p>
<p><img src="http://images.pingan8787.com/blog/20190920-1.jpg" alt="25-1.jpg"></p>
<p>它还能使我们在不改变任何HTML的情况下，使用 CSS 来定位和调整网格内的每个元素。它允许 HTML 纯粹作为内容的容器。</p>
<p>HTML 结构不再受限于样式表现，比如不要为了实现某种布局而多次嵌套，现在这些都可以让 CSS 来完成。</p>
<h2 id="定义一个网格"><a href="#定义一个网格" class="headerlink" title="定义一个网格"></a>定义一个网格</h2><p>Grid(网格) 模块为 <code>display</code> 属性提供了一个新的值：<code>grid</code>。当你将任何元素的 <code>display</code> 属性设置为<code> grid</code>时，那么这个元素就是一个 网格容器(grid container)，它的所有直接子元素就成了 网格项(grid items)。</p>
<p>让我们创建创建一个<code>3×3</code>的布局，做一个 Tic-Tac-Toe (井字游戏) 棋盘。首先，我们将写一些 HTML：</p>
<p>HTML 代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;game-board&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如您所见，<code>.game-board</code> div 是网格容器，而 <code>.box </code>div 是网格项。现在我们将通过 Grid 布局来实现 <code>3×3 </code>布局。</p>
<p><strong>CSS 代码：</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.game-board</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="attribute">display</span>: grid;</span><br><span class="line">    grid-template-rows: <span class="number">200px</span> <span class="number">200px</span> <span class="number">200px</span>;</span><br><span class="line">    grid-template-<span class="attribute">columns</span>: <span class="number">200px</span> <span class="number">200px</span> <span class="number">200px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这里，我还使用了其他两个属性。<code>grid-template-rows</code>属性允许我们指定网格中的行数及行的高度。那么你应该猜到另一个属性是干什么的了。</p>
<p><code>grid-template-columns</code> 属性允许我们指定网格中的列数及列的宽度。您可以指定任何单位的尺寸大小，包括像素，百分比和其他单<code>位fr</code>，我们将在下一步学习。</p>
<h2 id="fr-单位-等分"><a href="#fr-单位-等分" class="headerlink" title="fr 单位(等分)"></a>fr 单位(等分)</h2><p><code>fr </code>是为网格布局定义的一个新单位。它可以帮助你摆脱计算百分比，并将可用空间等分。</p>
<p>例如，如果在网格容器中设置这个规则：<code>grid-template-rows: 2fr 3fr</code>，那么你的网格容器将首先被分成 2 行。然后将数字部分加在一起，这里总和为 5， 即 5 等分。</p>
<p>就是说，我们将有 2 行：第一排占据垂直空间的 2/5 。第二排占垂直空间的 3/5 。</p>
<p>回到我们的 Tic-Tac-Toe 例子，我们使用 <code>fr</code> 代替 <code>px</code>。我们想要的是，应该有3行3列。所以，我们只需要用 3 个 <code>1fr</code> 替换 3 个 <code>200px</code> 即可：</p>
<p>CSS 代码:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.game-board</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="attribute">display</span>: grid;</span><br><span class="line">    grid-template-rows: <span class="number">1</span>fr <span class="number">1</span>fr <span class="number">1</span>fr;</span><br><span class="line">    grid-template-<span class="attribute">columns</span>: <span class="number">1</span>fr <span class="number">1</span>fr <span class="number">1</span>fr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注:</p>
<p>这里特别需要注意的是： <code>fr</code> 单位是等分可用空间，或者说剩余空间。看个例子</p>
<p>CSS 代码：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.game-board</span> </span><br><span class="line">&#123;</span><br><span class="line">    grid-gap:<span class="number">2px</span>;</span><br><span class="line">    <span class="attribute">display</span>: grid;</span><br><span class="line">    <span class="attribute">width</span>:<span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">height</span>:<span class="number">200px</span>;</span><br><span class="line">    grid-template-rows: <span class="number">100px</span> <span class="number">1</span>fr <span class="number">1</span>fr;</span><br><span class="line">    grid-template-<span class="attribute">columns</span>: <span class="number">1</span>fr <span class="number">50px</span> <span class="number">1</span>fr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>布局效果如图：</p>
<p><img src="http://images.pingan8787.com/blog/20190920-2.png" alt="25-2.png"></p>
<p>你会看到 <code>fr</code> 单位是将 总的尺寸 减去 单元格明确尺寸后，在等分剩余空间。 <code>grid-gap</code> 是间隔。</p>
<h2 id="repeat-函数"><a href="#repeat-函数" class="headerlink" title="repeat() 函数"></a>repeat() 函数</h2><p>在某些情况下，我们可能有很多的列和行。在 <code>grid-template</code> 属性中指定每一个值可能会很乏味。幸运的是，有一个 <code>repeat</code> 函数，就像任何一个循环重复多少次输出某个给定值。它有两个参数。第一个是迭代次数，第二个是要重复的值。我们用 <code>repeat</code> 函数重写上面的例子。</p>
<p>CSS 代码:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.game-board</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attribute">display</span>: grid;</span><br><span class="line">    grid-template-rows: <span class="built_in">repeat</span>(<span class="number">3</span>, <span class="number">1</span>fr);</span><br><span class="line">    grid-template-<span class="attribute">columns</span>: <span class="built_in">repeat</span>(<span class="number">3</span>, <span class="number">1</span>fr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>等价于：</p>
<p>CSS 代码:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.game-board</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="attribute">display</span>: grid;</span><br><span class="line">    grid-template-rows: <span class="number">1</span>fr <span class="number">1</span>fr <span class="number">1</span>fr;</span><br><span class="line">    grid-template-<span class="attribute">columns</span>: <span class="number">1</span>fr <span class="number">1</span>fr <span class="number">1</span>fr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="grid-template-属性"><a href="#grid-template-属性" class="headerlink" title="grid-template 属性"></a>grid-template 属性</h2><p><code>grid-template</code> 属性是 <code>grid-template-rows</code> 和<code> grid-template-columns</code> 的简写语法。这是它的语法：</p>
<p>CSS 代码:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grid-template: ro ws / co lu mns;</span><br></pre></td></tr></table></figure>

<p>我们上面的例子使用这个简写语法后，看起来非常整齐。</p>
<p>CSS 代码：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.game-board</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attribute">display</span>: grid;</span><br><span class="line">    grid-template: <span class="built_in">repeat</span>(<span class="number">3</span>, <span class="number">1</span>fr) / <span class="built_in">repeat</span>(<span class="number">3</span>, <span class="number">1</span>fr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看，只需使用 2 行代码，就可以使用网格布局创建 3×3 网格。</p>
<p>我们在加一些背景和间隔后，上面的例子看起来像这样：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">      <span class="selector-class">.game-board</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">width</span>: <span class="number">600px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">600px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">margin</span>: <span class="number">0</span> auto;</span></span><br><span class="line"><span class="css">        <span class="attribute">background-color</span>: <span class="number">#34495e</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">border</span>: <span class="number">6px</span> solid <span class="number">#2c3e50</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">display</span>: grid;</span></span><br><span class="line"><span class="css">        grid-template: <span class="built_in">repeat</span>(<span class="number">3</span>, <span class="number">1</span>fr) / <span class="built_in">repeat</span>(<span class="number">3</span>, <span class="number">1</span>fr);</span></span><br><span class="line"><span class="css">      &#125;</span></span><br><span class="line"><span class="css">      </span></span><br><span class="line"><span class="css">      <span class="selector-class">.box</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">border</span>: <span class="number">6px</span> solid <span class="number">#2c3e50</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">border-radius</span>: <span class="number">2px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">font-family</span>: Helvetica;</span></span><br><span class="line"><span class="css">        <span class="attribute">font-weight</span>: bold;</span></span><br><span class="line"><span class="css">        <span class="attribute">font-size</span>: <span class="number">4em</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">        <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="css">        <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="css">      &#125;</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;game-board&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span>X<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span>O<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span>O<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span>O<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span>X<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span>O<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span>O<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span>X<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span>X<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果图：</p>
<p><img src="http://images.pingan8787.com/blog/20190920-3.png" alt="25-3.png"></p>
<h2 id="网格线编号-网格单元格，网格轨道"><a href="#网格线编号-网格单元格，网格轨道" class="headerlink" title="网格线编号,网格单元格，网格轨道"></a>网格线编号,网格单元格，网格轨道</h2><p>网格线是存在于列和行每一侧的线。一组垂直线将空间垂直划分成列，而另一组水平线将空间水平划分成行。这意味着在我们之前的例子中，有四条垂直线和四条水平线包含它们之间的行和列。</p>
<p><img src="http://images.pingan8787.com/blog/20190920-4.png" alt="25-4.png"></p>
<p>在将网格项从一个位置跨越到另一个位置时，网格线变得非常有用。</p>
<p>网格轨道是两条线之间的空间。网格轨道可以是一行或一列。</p>
<p>网格单元格很像表格单元，是两条相邻垂直线和两条相邻水平线之间的空间。这是网格中最小的单位。</p>
<h2 id="定位网格项"><a href="#定位网格项" class="headerlink" title="定位网格项"></a>定位网格项</h2><p>我采取了前面的例子的网格，并用数字从1到9标记每个单元格，而不是X或O，下面是它的样子：</p>
<p><img src="http://images.pingan8787.com/blog/20190920-5.png" alt="25-5.png"></p>
<p>假设我想将第 6 个框移到第 2 个框的位置。没有CSS网格，不改变 HTML 的情况下，这几乎是一个不可能的任务，至少对我而言。（注，如果单纯这样的效果图，用FlexBox布局实现问题不大）但是如果我们使用网格模块，改变网格中网格项的位置是一件轻而易举的事情。要将第6个框移到第2个框的位置，我们必须确切知道第2个框在哪里。通过网格线编号的帮助，我们可以很容易地找到这个位置。第二个方框位于第2条列网格线之后，第3条列网格线之前，第1条行网格线之下，第2条行网格线之上。现在我们可以使用以下属性将这些网格线编号分配到第6个框中：</p>
<ul>
<li><p><code>grid-column-start</code>  </p>
</li>
<li><p><code>grid-column-end</code>  </p>
</li>
<li><p><code>grid-row-start</code>  </p>
</li>
<li><p><code>grid-row-end</code>  </p>
</li>
</ul>
<p>前两个属性对应于垂直网格线，也就是列网格线的开始和结束。最后两个属性是指水平网格线，也就是行网格线的开始和结束。让我们分配正确的网格线编号来移动第 6 个框。</p>
<p>CSS 代码:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span><span class="selector-pseudo">:nth-child</span>(<span class="number">6</span>)</span><br><span class="line">&#123;</span><br><span class="line">    grid-row-start: <span class="number">1</span>;</span><br><span class="line">    grid-row-end: <span class="number">2</span>;</span><br><span class="line">    grid-column-start: <span class="number">2</span>;</span><br><span class="line">    grid-column-end: <span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>还有两个简写属性用于将行和列的开始网格线和结束网格线设置在一起。</p>
<p>CSS 代码:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span><span class="selector-pseudo">:nth-child</span>(<span class="number">6</span>)</span><br><span class="line">&#123;</span><br><span class="line">    grid-row: <span class="number">1</span> / <span class="number">2</span>;</span><br><span class="line">    grid-column: <span class="number">2</span> / <span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此外，还有一个 <code>grid-area</code> 属性是所有四个上述属性的简写属性。它按以下顺序取值：</p>
<p>CSS 代码:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grid-area: &lt;row-start&gt; / &lt;column-start&gt; / &lt;row-end&gt; / &lt;column-end&gt;;</span><br></pre></td></tr></table></figure>

<p>现在我们的例子可以写成这样</p>
<p>CSS 代码:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span><span class="selector-pseudo">:nth-child</span>(<span class="number">6</span>)</span><br><span class="line">&#123;</span><br><span class="line">    grid-area: <span class="number">1</span> / <span class="number">2</span> / <span class="number">2</span> / <span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的代码行也可以进一步减少。正如您所看到的，这个框只占用一行和一个列，所以我们只需要指定行和列的起始线，而无需结束线的值。</p>
<p>CSS 代码:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span><span class="selector-pseudo">:nth-child</span>(<span class="number">6</span>)</span><br><span class="line">&#123;</span><br><span class="line">    grid-area: <span class="number">1</span> / <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果我们想要第6个框跨越两个框的区域呢？这很容易通过将 <code>column-end</code> 值加 1 的办法来完成。</p>
<p>CSS 代码:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span><span class="selector-pseudo">:nth-child</span>(<span class="number">6</span>)</span><br><span class="line">&#123;</span><br><span class="line">    grid-area: <span class="number">1</span> / <span class="number">2</span> / <span class="number">2</span> / <span class="number">4</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://images.pingan8787.com/blog/20190920-6.png" alt="25-6.png"></p>
<p>您也可以使用 <code>span</code> 关键字和占据的 轨道数量，来代替指定 <code>grid-row-end</code> 和<code>grid-column-end</code>的结束网格线编号。在这种情况下，第6个框是跨越 2 列和 1 行。</p>
<p>CSS 代码:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span><span class="selector-pseudo">:nth-child</span>(<span class="number">6</span>)</span><br><span class="line">&#123;</span><br><span class="line">    grid-area: <span class="number">1</span> / <span class="number">2</span> / <span class="number">2</span> / span <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="网格区域命名"><a href="#网格区域命名" class="headerlink" title="网格区域命名"></a>网格区域命名</h2><p><code>grid-area</code> 属性也可以用来命名网格的某一个部分，然后我们可以用 <code>grid-template-areas</code> 属性来定位。让我们创建一个简单的 <code>bread-and-butter</code> 布局，顶部有一个 <code>top</code>,<code> nav</code>，中间有 <code>main</code> 和 <code>aside</code>，下面是 <code>footer</code>。这是所需的HTML：</p>
<p>HTML 代码:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">header</span>&gt;</span><span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">nav</span>&gt;</span><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">main</span>&gt;</span><span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">aside</span>&gt;</span><span class="tag">&lt;/<span class="name">aside</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">footer</span>&gt;</span><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们需要使用 <code>grid-area</code> 属性来命名每个区域：</p>
<p>CSS 代码:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">header</span></span><br><span class="line">&#123;</span><br><span class="line">  grid-area: header;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#9b59b6</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-tag">nav</span></span><br><span class="line">&#123;</span><br><span class="line">  grid-area: nav;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#3498db</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-tag">main</span></span><br><span class="line">&#123;</span><br><span class="line">  grid-area: main;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#2ecc71</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-tag">aside</span></span><br><span class="line">&#123;</span><br><span class="line">  grid-area: aside;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f1c40f</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-tag">footer</span></span><br><span class="line">&#123;</span><br><span class="line">  grid-area: footer;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#1abc9c</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在我们将使用<code>grid-template-areas</code>属性来指定每个网格区域所占据的行和列。以下是我们如何做到的：</p>
<p>CSS 代码:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span></span><br><span class="line">&#123;</span><br><span class="line">      <span class="attribute">display</span>: grid;</span><br><span class="line">      grid-template-rows: <span class="number">1</span>fr <span class="number">5</span>fr <span class="number">1</span>fr;</span><br><span class="line">      grid-template-<span class="attribute">columns</span>: <span class="number">2</span>fr <span class="number">5</span>fr <span class="number">3</span>fr;</span><br><span class="line">      grid-template-areas:</span><br><span class="line">        <span class="string">&quot;header  header  header&quot;</span></span><br><span class="line">        <span class="string">&quot;nav     main    aside&quot;</span></span><br><span class="line">        <span class="string">&quot;footer  footer  footer&quot;</span>;</span><br><span class="line">      grid-gap: .<span class="number">75em</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>请注意，<code>header</code> 和 <code>footer</code> 单词重复三次。这表明，<code>header</code> 和 <code>footer</code> 横跨 3 列的宽度。你可以把它全部写在一行中，但是把每一行写在一个单独的行上很好，很干净。你可以看到我在这里使用了一个新的属性 <code>grid-gap</code>。它所做的只是在两个网格区域之间添加一个间距。你也可以使用 <code>grid-row-gap</code> 和 <code>grid-column-gap</code> 来为行和列指定不同的间距值。</p>
<p>CodePen上的这个例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">      <span class="selector-class">.container</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">display</span>: grid;</span></span><br><span class="line"><span class="css">        grid-template-rows: <span class="number">1</span>fr <span class="number">5</span>fr <span class="number">1</span>fr;</span></span><br><span class="line"><span class="css">        grid-template-<span class="attribute">columns</span>: <span class="number">2</span>fr <span class="number">5</span>fr <span class="number">3</span>fr;</span></span><br><span class="line"><span class="css">        grid-template-areas: <span class="string">&quot;header header header&quot;</span> <span class="string">&quot;nav    main   aside&quot;</span> <span class="string">&quot;footer footer footer&quot;</span>;</span></span><br><span class="line"><span class="css">        grid-gap: .<span class="number">75em</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">background-color</span>: <span class="number">#eee</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">width</span>: <span class="number">100vw</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">100vh</span>;</span></span><br><span class="line"><span class="css">      &#125;</span></span><br><span class="line"><span class="css">      </span></span><br><span class="line"><span class="css">      <span class="selector-tag">header</span> &#123;</span></span><br><span class="line"><span class="css">        grid-area: header;</span></span><br><span class="line"><span class="css">        <span class="attribute">background-color</span>: <span class="number">#9b59b6</span>;</span></span><br><span class="line"><span class="css">      &#125;</span></span><br><span class="line"><span class="css">      </span></span><br><span class="line"><span class="css">      <span class="selector-tag">nav</span> &#123;</span></span><br><span class="line"><span class="css">        grid-area: nav;</span></span><br><span class="line"><span class="css">        <span class="attribute">background-color</span>: <span class="number">#3498db</span>;</span></span><br><span class="line"><span class="css">      &#125;</span></span><br><span class="line"><span class="css">      </span></span><br><span class="line"><span class="css">      <span class="selector-tag">main</span> &#123;</span></span><br><span class="line"><span class="css">        grid-area: main;</span></span><br><span class="line"><span class="css">        <span class="attribute">background-color</span>: <span class="number">#2ecc71</span>;</span></span><br><span class="line"><span class="css">      &#125;</span></span><br><span class="line"><span class="css">      </span></span><br><span class="line"><span class="css">      <span class="selector-tag">aside</span> &#123;</span></span><br><span class="line"><span class="css">        grid-area: aside;</span></span><br><span class="line"><span class="css">        <span class="attribute">background-color</span>: <span class="number">#f1c40f</span>;</span></span><br><span class="line"><span class="css">      &#125;</span></span><br><span class="line"><span class="css">      </span></span><br><span class="line"><span class="css">      <span class="selector-tag">footer</span> &#123;</span></span><br><span class="line"><span class="css">        grid-area: footer;</span></span><br><span class="line"><span class="css">        <span class="attribute">background-color</span>: <span class="number">#1abc9c</span>;</span></span><br><span class="line"><span class="css">      &#125;</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">header</span>&gt;</span><span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">nav</span>&gt;</span><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">main</span>&gt;</span><span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">aside</span>&gt;</span><span class="tag">&lt;/<span class="name">aside</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">footer</span>&gt;</span><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>效果图：</p>
<p><img src="http://images.pingan8787.com/blog/20190920-7.png" alt="25-7.png"></p>
<p>浏览器支持<br>在写这篇文章的时候，CSS Grid 布局很多浏览器已经原生支持。根据 caniuse.com 的统计，所有主流浏览器都支持CSS Grid 布局，Internet Explorer 11 部分支持 -ms- 前缀， Opera Mini 根本不支持。</p>
<p><img src="http://images.pingan8787.com/blog/20190920-8.jpg" alt="25-8.jpg"></p>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>CSS网格布局允许我们更快地布局，并且更容易控制。在本教程中，我们学习了如何用CSS网格来定义布局，<code> fr</code>单位，repeat 函数和一些网格系统中特定的术语。我们还学习了如何使用网格线和网格命名区域在网格容器内定位网格项目。但这只是一个开始。在下一个教程中，我们将深入到CSS网格。</p>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#112;&#x69;&#x6e;&#103;&#97;&#x6e;&#56;&#55;&#56;&#55;&#64;&#113;&#x71;&#x2e;&#99;&#x6f;&#109;">&#112;&#x69;&#x6e;&#103;&#97;&#x6e;&#56;&#55;&#56;&#55;&#64;&#113;&#x71;&#x2e;&#99;&#x6f;&#109;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>ES小册</td>
<td>js.pingan8787.com</td>
</tr>
</tbody></table>
<h3 id="微信公众号"><a href="#微信公众号" class="headerlink" title="微信公众号"></a>微信公众号</h3><p><img src="http://images.pingan8787.com/2019_07_12guild_page.png" alt="bg">  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/09/20/174-%E3%80%90CSS%E3%80%91Grid%E7%BD%91%E6%A0%BC%E5%B8%83%E5%B1%80%E5%85%A5%E9%97%A8/" data-id="ckts3ejtn004a4d9kckhkfxm6" data-title="174-【CSS】Grid网格布局入门" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CSS/" rel="tag">CSS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-173-【CSS】有趣的CSS弹跳动画" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/09/20/173-%E3%80%90CSS%E3%80%91%E6%9C%89%E8%B6%A3%E7%9A%84CSS%E5%BC%B9%E8%B7%B3%E5%8A%A8%E7%94%BB/" class="article-date">
  <time class="dt-published" datetime="2019-09-20T15:17:25.000Z" itemprop="datePublished">2019-09-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/09/20/173-%E3%80%90CSS%E3%80%91%E6%9C%89%E8%B6%A3%E7%9A%84CSS%E5%BC%B9%E8%B7%B3%E5%8A%A8%E7%94%BB/">173-【CSS】有趣的CSS弹跳动画</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000019086915">阅读原文</a></p>
</blockquote>
<p>这是只用了一个 <code>div</code> 来做的小动画，纯粹利用 CSS3 的 <code>animation</code> 来完成，就像是一个正方形在地上弹跳，碰到地面的时候尖角还会压缩变圆，阴影的部分也会随着正方形升高而缩小，至于到底该怎么完成呢？让我们继续看下去。</p>
<h2 id="利用伪元素"><a href="#利用伪元素" class="headerlink" title="利用伪元素"></a>利用伪元素</h2><p>由于只使用了一个 <code>div</code> ，要同时达到正方形旋转与阴影缩放的效果，这里必须使用两个伪元素（ <code>before</code> 与 <code>after</code> ）来完成，严格来说，虽然只有一个 <code>div</code> ，但是却是把这个 <code>div</code> 当作外框，让伪元素 <code>before</code> 作为旋转的正方形，让伪元素after作为阴影。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">  <span class="attribute">position</span>:relative;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span>:before&#123;</span><br><span class="line">  content:<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="attribute">position</span>:absolute;</span><br><span class="line">  <span class="attribute">z-index</span>:<span class="number">2</span>;</span><br><span class="line">  <span class="attribute">top</span>:<span class="number">60px</span>;</span><br><span class="line">  <span class="attribute">left</span>:<span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">width</span>:<span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">height</span>:<span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">background</span>:<span class="number">#c00</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>:<span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">45deg</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span>:after&#123;</span><br><span class="line">  content:<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="attribute">position</span>:absolute;</span><br><span class="line">  <span class="attribute">z-index</span>:<span class="number">1</span>;</span><br><span class="line">  <span class="attribute">top</span>:<span class="number">128px</span>;</span><br><span class="line">  <span class="attribute">left</span>:<span class="number">52px</span>;</span><br><span class="line">  <span class="attribute">width</span>:<span class="number">44px</span>;</span><br><span class="line">  <span class="attribute">height</span>:<span class="number">3px</span>;</span><br><span class="line">  <span class="attribute">background</span>:<span class="number">#eaeaea</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>:<span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://images.pingan8787.com/blog/20190916-1.jpg" alt="24-1.jpg"></p>
<h2 id="CSS动画"><a href="#CSS动画" class="headerlink" title="CSS动画"></a>CSS动画</h2><p>画出正方形与阴影之后，再来就是要做动画了，为了避免太过复杂，这里我们先不要旋转，先单纯让正方形上下跳动，然后阴影会放大缩小，下面的示例的动画，又新增了20%与80%的keyframe，目的是为了让接触的时候角落才会变圆，不然就会变成刚开始移动时尖角就变圆，就会很怪异了。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span>:before&#123;</span><br><span class="line">  content:<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="attribute">position</span>:absolute;</span><br><span class="line">  <span class="attribute">z-index</span>:<span class="number">2</span>;</span><br><span class="line">  <span class="attribute">top</span>:<span class="number">60px</span>;</span><br><span class="line">  <span class="attribute">left</span>:<span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">width</span>:<span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">height</span>:<span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">background</span>:<span class="number">#c00</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>:<span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">45deg</span>);</span><br><span class="line">  -webkit-<span class="attribute">animation</span>:box .<span class="number">8s</span> infinite ; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@-webkit-keyframes</span> box&#123;</span><br><span class="line">  <span class="number">0%</span>&#123;</span><br><span class="line">    <span class="attribute">top</span>:<span class="number">50px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">20%</span>&#123;</span><br><span class="line">    <span class="attribute">border-radius</span>:<span class="number">2px</span>;  <span class="comment">/*从20%的地方才开始变形*/</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">50%</span>&#123;</span><br><span class="line">    <span class="attribute">top</span>:<span class="number">80px</span>; </span><br><span class="line">    <span class="attribute">border-bottom-right-radius</span>:<span class="number">25px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">80%</span>&#123;</span><br><span class="line">    <span class="attribute">border-radius</span>:<span class="number">2px</span>;  <span class="comment">/*到80%的地方恢复原状*/</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100%</span>&#123;</span><br><span class="line">    <span class="attribute">top</span>:<span class="number">50px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span>:after&#123;</span><br><span class="line">  content:<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="attribute">position</span>:absolute;</span><br><span class="line">  <span class="attribute">z-index</span>:<span class="number">1</span>;</span><br><span class="line">  <span class="attribute">top</span>:<span class="number">128px</span>;</span><br><span class="line">  <span class="attribute">left</span>:<span class="number">52px</span>;</span><br><span class="line">  <span class="attribute">width</span>:<span class="number">44px</span>;</span><br><span class="line">  <span class="attribute">height</span>:<span class="number">3px</span>;</span><br><span class="line">  <span class="attribute">background</span>:<span class="number">#eaeaea</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>:<span class="number">100%</span>;</span><br><span class="line">  -webkit-<span class="attribute">animation</span>:shadow .<span class="number">8s</span> infinite ; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@-webkit-keyframes</span> shadow&#123;</span><br><span class="line">  <span class="number">0%</span>,<span class="number">100%</span>&#123;</span><br><span class="line">    <span class="attribute">left</span>:<span class="number">54px</span>;</span><br><span class="line">    <span class="attribute">width</span>:<span class="number">40px</span>;</span><br><span class="line">    <span class="attribute">background</span>:<span class="number">#eaeaea</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">50%</span>&#123;</span><br><span class="line">    <span class="attribute">top</span>:<span class="number">126px</span>;</span><br><span class="line">    <span class="attribute">left</span>:<span class="number">50px</span>;   <span class="comment">/*让阴影保持在原位*/</span></span><br><span class="line">    <span class="attribute">width</span>:<span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">height</span>:<span class="number">7px</span>;</span><br><span class="line">    <span class="attribute">background</span>:<span class="number">#eee</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://images.pingan8787.com/blog/20190916-2.gif" alt="24-2.gif"></p>
<h2 id="加入旋转效果"><a href="#加入旋转效果" class="headerlink" title="加入旋转效果"></a>加入旋转效果</h2><p>了解原理之后，我们只要再加上旋转的属性，就可以达到弹跳起来的时候有旋转的效果，不过这里又有用到一个小技巧，就是落下的时候是90度转到45度，弹上去的时候从45旋转到0度，然后在这一瞬间从0度变成90度（100%到0%），如此一来我们就会产生错觉，感觉好像一直在旋转了。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@-webkit-keyframes</span> box&#123;</span><br><span class="line">  <span class="number">0%</span>&#123;</span><br><span class="line">    <span class="attribute">top</span>:<span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">90deg</span>); <span class="comment">/**/</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">20%</span>&#123;</span><br><span class="line">    <span class="attribute">border-radius</span>:<span class="number">2px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">50%</span>&#123;</span><br><span class="line">    <span class="attribute">top</span>:<span class="number">80px</span>; </span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">45deg</span>);</span><br><span class="line">    <span class="attribute">border-bottom-right-radius</span>:<span class="number">25px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">80%</span>&#123;</span><br><span class="line">    <span class="attribute">border-radius</span>:<span class="number">2px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100%</span>&#123;</span><br><span class="line">    <span class="attribute">top</span>:<span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">0deg</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://images.pingan8787.com/blog/20190916-3.gif" alt="24-3.gif"></p>
<p>举一反三，我们也可以把角度反转，就会往另外一边弹跳。</p>
<p><img src="http://images.pingan8787.com/blog/20190916-4.gif" alt="24-4.gif"></p>
<p>如果我们把动画里头添加linear，就会变成线性的连续方式喔。</p>
<p><img src="http://images.pingan8787.com/blog/20190916-5.gif" alt="24-5.gif"></p>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#112;&#x69;&#110;&#103;&#97;&#x6e;&#x38;&#x37;&#x38;&#x37;&#64;&#x71;&#x71;&#46;&#99;&#x6f;&#x6d;">&#112;&#x69;&#110;&#103;&#97;&#x6e;&#x38;&#x37;&#x38;&#x37;&#64;&#x71;&#x71;&#46;&#99;&#x6f;&#x6d;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>ES小册</td>
<td>js.pingan8787.com</td>
</tr>
</tbody></table>
<h3 id="微信公众号"><a href="#微信公众号" class="headerlink" title="微信公众号"></a>微信公众号</h3><p><img src="http://images.pingan8787.com/2019_07_12guild_page.png" alt="bg">  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/09/20/173-%E3%80%90CSS%E3%80%91%E6%9C%89%E8%B6%A3%E7%9A%84CSS%E5%BC%B9%E8%B7%B3%E5%8A%A8%E7%94%BB/" data-id="ckts3ejtn004d4d9khhuq9j51" data-title="173-【CSS】有趣的CSS弹跳动画" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CSS/" rel="tag">CSS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-172-【CSS】可能是最全面最易懂的解析前端浮动的文章" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/08/19/172-%E3%80%90CSS%E3%80%91%E5%8F%AF%E8%83%BD%E6%98%AF%E6%9C%80%E5%85%A8%E9%9D%A2%E6%9C%80%E6%98%93%E6%87%82%E7%9A%84%E8%A7%A3%E6%9E%90%E5%89%8D%E7%AB%AF%E6%B5%AE%E5%8A%A8%E7%9A%84%E6%96%87%E7%AB%A0/" class="article-date">
  <time class="dt-published" datetime="2019-08-19T13:12:19.000Z" itemprop="datePublished">2019-08-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/08/19/172-%E3%80%90CSS%E3%80%91%E5%8F%AF%E8%83%BD%E6%98%AF%E6%9C%80%E5%85%A8%E9%9D%A2%E6%9C%80%E6%98%93%E6%87%82%E7%9A%84%E8%A7%A3%E6%9E%90%E5%89%8D%E7%AB%AF%E6%B5%AE%E5%8A%A8%E7%9A%84%E6%96%87%E7%AB%A0/">172-【CSS】可能是最全面最易懂的解析前端浮动的文章</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p><a target="_blank" rel="noopener" href="https://juejin.im/post/5bbe1054f265da0af2138c5e">阅读原文</a></p>
</blockquote>
<h3 id="写在最前"><a href="#写在最前" class="headerlink" title="写在最前"></a>写在最前</h3><p>习惯性去谷歌翻译看了看 <code>float</code> 的解释：</p>
<p>其中有一句这样写的：</p>
<p><img src="http://images.pingan8787.com/20190819_float_01.png" alt="01"></p>
<blockquote>
<p>she relaxed, floating gently in the water</p>
</blockquote>
<p>瞬间浮想联翩，一个女神，轻轻地漂浮在水中。开心的拍打着水花，哇靠。。。</p>
<blockquote>
<p>不想了，人间不值得，步入正题吧，上面美妙的画面中，我们可以看到，女神还是挤占了水的空间，女神是浮动的。那么来，好了，编不下去了，直接开题吧。。。</p>
</blockquote>
<p>我觉得很多人连 <code>float</code> 是啥意识都不知道，要知道很多特性的原理是和其命名的单词或者字母有密切关联的，不是随便命名的。从名字中可以看到一些当初设计的初衷。</p>
<h3 id="找出问题是关键"><a href="#找出问题是关键" class="headerlink" title="找出问题是关键"></a>找出问题是关键</h3><p>问自己三个问题：</p>
<ul>
<li><p>第一 浮动会造成什么影响？</p>
</li>
<li><p>第二，如何解决这些因为浮动而造成的影响？</p>
</li>
<li><p>第三，<code>bfc</code> 原理？</p>
</li>
</ul>
<p>其实我个人理解，浮动造成的最核心的问题就是破坏了文档流，那么问题来了，<code>float</code> 破坏了文档流，为什么还要设计这个 <code>api</code> ，我查了一些资料最后才知道，这是因为当初设计 <code>float</code> 的目的是为了能实现文字能够环绕图片的排版功能，也就是我们有时会纳闷的一点：设置浮动后，还是会挤占容器中的文本内容。</p>
<p>比如看下面这段代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>float实现浮动<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">    <span class="selector-class">.z1</span>&#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">float</span>: left;</span></span><br><span class="line"><span class="css">        <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="css">        <span class="attribute">line-height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: skyblue;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.fu</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">width</span>: <span class="number">400px</span>;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;fu clearfix&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z1&quot;</span>&gt;</span>设置了float为left的图片<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z2&quot;</span>&gt;</span>你看，我没有被浮动哥哥挡住哦，这是一段神奇旅行，一天我遇上了白雪公主<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>效果图如下：</p>
<p><img src="http://images.pingan8787.com/20190819_float_02.png" alt="02"></p>
<p>看到这，是不是有些理解了。从上图会发现，即使图片浮动了，脱离了正常文档流，也覆盖在没有浮动的元素上了，但是其并没有将文本内容也覆盖掉，这也证实了 <code>float</code> 这个 <code>api</code> 在当初被设计出来的主要目的：<strong>实现文字环绕图片排版功能</strong>。</p>
<p>当想到这时，我突然意识到，其他布局模式是什么样子，然后进行了实验。去掉容器 z1 的 <code>float</code> 属性，增加了 <code>position</code> 属性，代码如下</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>absolute实现浮动<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">    <span class="selector-class">.z1</span>&#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="css">        <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="css">        <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: skyblue;</span></span><br><span class="line"><span class="css">        <span class="attribute">padding-top</span>: <span class="number">80px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">opacity</span>: <span class="number">0.8</span>;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.fu</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">width</span>: <span class="number">400px</span>;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;fu clearfix&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z1&quot;</span>&gt;</span>设置了positon为absolute的图片<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z2&quot;</span>&gt;</span>你看，我被absolute哥哥挡住哦，这是一段神奇旅行，一天我遇上了白雪公主<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果图如下：</p>
<p><img src="http://images.pingan8787.com/20190819_float_03.png" alt="03"></p>
<p>我们可以看到，设置 <code>absolute</code> 的容器，才是意义上的完全脱离正常文档流。覆盖在当前位置上的所有容器和文本内容之上。对比思考一下，会发现这又证明了 <code>float</code> 被设计出来的主要目的。如果能理解成这样，我觉得对于不同业务上该用什么方式清除 <code>float</code> ，或者说该用什么来代替 <code>float</code> ，将会有个很明确的方向。</p>
<p>其实你会发现， <code>absolute</code> 和 <code>float</code> 都不会去覆盖掉在他们之前的正常文档流，这应该和浏览器渲染机制有关系，会从上到下依次渲染内容，渲染成功后，就不会因为后续元素浮动而使其被覆盖住(不考虑使用 <code>fix</code> 等强行覆盖的情况)。</p>
<p>简易代码如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>清除float浮动<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">    <span class="selector-class">.z1</span>&#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="css">        <span class="attribute">float</span>: left;</span></span><br><span class="line"><span class="css">        <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: skyblue;</span></span><br><span class="line"><span class="css">        <span class="attribute">padding-top</span>: <span class="number">80px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">opacity</span>: <span class="number">0.5</span>;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z2</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: yellow</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z3</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: red;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z4</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: green;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z5</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: pink;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;fu&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z2&quot;</span>&gt;</span>没有设置任何浮动的容器，背景为黄色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z3&quot;</span>&gt;</span>没有设置任何浮动的容器，背景为红色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z1&quot;</span>&gt;</span>设置了浮动的元素，opacity为0.5<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z4&quot;</span>&gt;</span>没有设置任何浮动的容器，背景为绿色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z5&quot;</span>&gt;</span>没有设置任何浮动的容器，背景为粉色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果图如下：</p>
<p><img src="http://images.pingan8787.com/20190819_float_04.png" alt="04"></p>
<p>从图中的标注和说明我们可以清晰的知道，<code>float</code> 不会影响前面已经渲染好的文档，而会影响在其后面将要渲染的文档。那么问题来了，怎样才能消除因为z1的浮动而对 <code>z4</code> , <code>z5</code> 造成的影响呢？</p>
<p>首先我们要知道，<code>z1</code> 这个浮动造成了哪些影响，影响如下：  </p>
<ul>
<li>第一个影响：影响了 <code>z4</code>,<code>z5</code> 的布局。</li>
</ul>
<ul>
<li>第二个影响：影响了父容器的高度，正常父元素的高度是自适应的，高度为其包含的内容总高度，而内部元素的浮动造成了父容器高度塌陷。</li>
</ul>
<ul>
<li>第三个影响：父容器高度塌陷了，将会影响和父元素同级的文档布局。</li>
</ul>
<p>下面的代码可以完美的诠释这些影响：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>清除float浮动<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">    <span class="selector-class">.z1</span>&#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="css">        <span class="attribute">float</span>: left;</span></span><br><span class="line"><span class="css">        <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: skyblue;</span></span><br><span class="line"><span class="css">        <span class="attribute">padding-top</span>: <span class="number">80px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">opacity</span>: <span class="number">0.5</span>;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z2</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: yellow</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z3</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: red;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z4</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: green;</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z5</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: pink;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z6</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: black;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z7</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: blue;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.fu</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="comment">/* overflow: hidden; */</span></span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;fu&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z2&quot;</span>&gt;</span>没有设置任何浮动的容器, 背景为黄色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z3&quot;</span>&gt;</span>没有设置任何浮动的容器, 背景为红色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z1&quot;</span>&gt;</span>设置了浮动的元素, opacity为0.5<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z4&quot;</span>&gt;</span>没有设置任何浮动的容器, 背景为绿色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z5&quot;</span>&gt;</span>没有设置任何浮动的容器, 背景为粉色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z6&quot;</span>&gt;</span>和父级元素同级的容器, 没有设置任何浮动, 背景为绿色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z7&quot;</span>&gt;</span>和父级元素同级的容器, 没有设置任何浮动, 背景为绿色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果图如下：</p>
<p><img src="http://images.pingan8787.com/20190819_float_05.png" alt="05"></p>
<p>通过图中的标注我们可以很清晰看到上面提到的三个影响，那么影响也清晰的看到了，下面该如何去解决这些影响呢？</p>
<h3 id="解决思路很重要"><a href="#解决思路很重要" class="headerlink" title="解决思路很重要"></a>解决思路很重要</h3><p>要解决这三个影响，需要从两个方向思考：</p>
<ul>
<li><p>第一个方向：解决父元素给其同级的元素造成的影响，我比喻成解决外部矛盾。</p>
</li>
<li><p>第二个方向：解决父级元素内部的浮动元素对其同级元素的影响，我比喻成解决内部矛盾。</p>
</li>
</ul>
<p>俗话说的好，家丑不可外扬，那么来，现在就先解决外部矛盾，怎么解决呢，解决的思想，无非就是让父级元素的高度不再塌陷，把浮动元素的高度算进去。记住一个关键点，这时候，内部矛盾还是存在的。比如浮动元素和其后续的同级元素有高度重叠。</p>
<h4 id="解决外部矛盾"><a href="#解决外部矛盾" class="headerlink" title="解决外部矛盾"></a>解决外部矛盾</h4><h5 id="1-触发-bfc"><a href="#1-触发-bfc" class="headerlink" title="1. 触发 bfc"></a>1. 触发 bfc</h5><p>第一个是触发 <code>bfc</code>，为什么呢，因为触发 bfc 后，高度会包括浮动元素的高度。怎么触发呢，可以给父级元素设置<code> overflow:auto;</code> 对于其他的触发 <code>bfc</code> 方式，我就不说了，我主要说一下原理。代码如下</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>清除float浮动<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">    <span class="selector-class">.z1</span>&#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="css">        <span class="attribute">float</span>: left;</span></span><br><span class="line"><span class="css">        <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: skyblue;</span></span><br><span class="line"><span class="css">        <span class="attribute">padding-top</span>: <span class="number">80px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">opacity</span>: <span class="number">0.5</span>;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z2</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: yellow</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z3</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: red;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z4</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: green;</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z5</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: pink;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z6</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: black;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z7</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: blue;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.fu</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">overflow</span>: hidden;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;fu&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z2&quot;</span>&gt;</span>没有设置任何浮动的容器, 背景为黄色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z3&quot;</span>&gt;</span>没有设置任何浮动的容器, 背景为红色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z1&quot;</span>&gt;</span>设置了浮动的元素, opacity为0.5<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z4&quot;</span>&gt;</span>没有设置任何浮动的容器, 背景为绿色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z5&quot;</span>&gt;</span>没有设置任何浮动的容器, 背景为粉色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z6&quot;</span>&gt;</span>和父级元素同级的容器, 没有设置任何浮动, 背景为绿色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z7&quot;</span>&gt;</span>和父级元素同级的容器, 没有设置任何浮动, 背景为绿色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果图如下：</p>
<p><img src="http://images.pingan8787.com/20190819_float_06.png" alt="06"></p>
<p>图中可以很清晰的看出，触发父元素的 <code>bfc</code> 后，外部矛盾解决了，但是内部的矛盾还没有解决。那么现在就开始解决内部矛盾。怎么解决内部矛盾呢，也就是父元素内部的浮动元素的高度和后面的同级元素的高度有重叠呢。这个时候，我们先不着急解决内部矛盾，我们来看一下，另一种解决外部矛盾的方式。</p>
<h4 id="clear-原理"><a href="#clear-原理" class="headerlink" title="clear 原理"></a>clear 原理</h4><p>给父元素增加伪元素：代码如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>清除float浮动<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">    <span class="selector-class">.z1</span>&#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="css">        <span class="attribute">float</span>: left;</span></span><br><span class="line"><span class="css">        <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: skyblue;</span></span><br><span class="line"><span class="css">        <span class="attribute">padding-top</span>: <span class="number">80px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">opacity</span>: <span class="number">0.5</span>;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z2</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: yellow</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z3</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: red;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z4</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: green;</span></span><br><span class="line"><span class="css">        <span class="comment">/* clear: left */</span></span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z5</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: pink;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z6</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: black;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z7</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: blue;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.fu</span> &#123;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.clearfix</span>:after &#123;</span></span><br><span class="line"><span class="css">        display: block;</span></span><br><span class="line"><span class="css">        <span class="attribute">overflow</span>: hidden;</span></span><br><span class="line"><span class="css">        <span class="attribute">content</span>: <span class="string">&#x27;伪元素的内容哦&#x27;</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">clear</span>: both;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: slateblue;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;fu clearfix&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z2&quot;</span>&gt;</span>没有设置任何浮动的容器, 背景为黄色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z3&quot;</span>&gt;</span>没有设置任何浮动的容器, 背景为红色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z1&quot;</span>&gt;</span>设置了浮动的元素, opacity为0.5<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z4&quot;</span>&gt;</span>没有设置任何浮动的容器, 背景为绿色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z5&quot;</span>&gt;</span>没有设置任何浮动的容器, 背景为粉色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z6&quot;</span>&gt;</span>和父级元素同级的容器, 没有设置任何浮动, 背景为绿色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z7&quot;</span>&gt;</span>和父级元素同级的容器, 没有设置任何浮动, 背景为绿色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>很多人不清楚用伪元素清除浮动的原理是什么，为什么给父元素加这个伪元素，可以清除父元素的浮动。这里我故意在伪元素的 <code>content</code> 写了一些文本内容，同时加了背景色，有点像基佬色。。。</p>
<p>OK，先看整体效果图吧:</p>
<p><img src="http://images.pingan8787.com/20190819_float_07.png" alt="07"></p>
<p>不出意外，从上图可以看到，外部矛盾被解决了。这只是开始，大家眼睛盯好，继续看下面截图：</p>
<p><img src="http://images.pingan8787.com/20190819_float_08.png" alt="08"></p>
<p>从图中标注可以看出，为什么伪元素要设置 <code>display:block</code>，继续看下一个截图。</p>
<p><img src="http://images.pingan8787.com/20190819_float_09.png" alt="09"></p>
<p>从上图中可以知道，为什么 <code>height </code>要设置成 <code>0 </code>了。如果 <code>content </code>不是空字符串，那么就会在页面中显示内容。但其实清除浮动时， <code>content </code>都会写成空的字符串，如果 <code>content </code>里面只设置成 <code>&#39;&#39; </code>空的字符，那么 <code>height </code>也可以不写，包括 <code>overflow </code>也可以不写，写 <code>height </code>和 <code>overflow </code>都是为了代码的鲁棒性。不过有个很重要， <code>content </code>这个属性，必须要写，不写 <code>content </code>，是没法清除浮动的。</p>
<p>最重要的知识点要来了，请看两个截图：</p>
<p><img src="http://images.pingan8787.com/20190819_float_10.png" alt="10"></p>
<p>我故意让content显示出来，会发现伪元素清除浮动的核心原理其实是在给父元素增加块级容器，同时对块级容器设置clear属性，使其能够清除自身的浮动，从而正常按照块级容器排列方式那样排列在浮动元素的下面。同时，父元素的同级元素也会正常排列在伪元素形成的块级元素后面，而不受浮动影响。</p>
<p>下面是干掉clear属性后的截图：</p>
<p><img src="http://images.pingan8787.com/20190819_float_11.png" alt="11"></p>
<p>发现清除浮动失败了，其实可以看出，给父元素增加一个伪元素来清除浮动的本质，是通过<br>给父元素再加一个块级子容器，当然这个也就是父元素的最后一个块级子容器了。同时给这个块级子容器设置clear属性来清除其浮动，这样这个子容器就能排列在浮动元素的后面，同时也把父元素的高度撑起来了。那么父元素的同级元素也能正常排列了。所以这个子容器不能有高度和内容，不然会影响父元素的布局。</p>
<p>写到这，外部矛盾的解决方式和各自的原理已经说的很清楚了。那么内部矛盾怎么解决呢？<br>其实，解决内部矛盾的原理和解决外部矛盾的第二种方式的原理是一样的，通过给被浮动影响的第一个元素进行清除浮动，就可以使后面的元素也不会受到浮动影响了。代码如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>清除float浮动<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">    <span class="selector-class">.z1</span>&#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="css">        <span class="attribute">float</span>: left;</span></span><br><span class="line"><span class="css">        <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: skyblue;</span></span><br><span class="line"><span class="css">        <span class="attribute">padding-top</span>: <span class="number">80px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">opacity</span>: <span class="number">0.5</span>;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z2</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: yellow</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z3</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: red;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z4</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: green;</span></span><br><span class="line"><span class="css">        <span class="attribute">clear</span>:both;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z5</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: pink;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z6</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: black;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z7</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: blue;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;fu&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z2&quot;</span>&gt;</span>没有设置任何浮动的容器, 背景为黄色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z3&quot;</span>&gt;</span>没有设置任何浮动的容器, 背景为红色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z1&quot;</span>&gt;</span>设置了浮动的元素, opacity为0.5<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z4&quot;</span>&gt;</span>没有设置任何浮动的容器, 背景为绿色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z5&quot;</span>&gt;</span>没有设置任何浮动的容器, 背景为粉色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z6&quot;</span>&gt;</span>和父级元素同级的容器, 没有设置任何浮动, 背景为绿色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z7&quot;</span>&gt;</span>和父级元素同级的容器, 没有设置任何浮动, 背景为绿色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果图如下：</p>
<p><img src="http://images.pingan8787.com/20190819_float_12.png" alt="12"></p>
<p>给内部元素设置 <code>clear:both; </code>清除浮动后，会直接解决内部矛盾和外部矛盾。可能会有人想，如果 <code>z4 </code>容器后面又有一个浮动元素呢，这里我不想再解释了，因为可递归得出原理都是一样的，但是吧，我还是上个代码分析一下吧：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>清除float浮动<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">    <span class="selector-class">.z1</span>&#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="css">        <span class="attribute">float</span>: left;</span></span><br><span class="line"><span class="css">        <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: skyblue;</span></span><br><span class="line"><span class="css">        <span class="attribute">padding-top</span>: <span class="number">80px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">opacity</span>: <span class="number">0.5</span>;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z2</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: yellow</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z3</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: red;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z4</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: green;</span></span><br><span class="line"><span class="css">        <span class="attribute">clear</span>:both;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z5</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: pink;</span></span><br><span class="line"><span class="css">        <span class="comment">/* clear:both */</span></span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z6</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: black;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.z7</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">background</span>: blue;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.fu</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">overflow</span>: auto;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;fu&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z2&quot;</span>&gt;</span>没有设置任何浮动的容器, 背景为黄色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z3&quot;</span>&gt;</span>没有设置任何浮动的容器, 背景为红色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z1&quot;</span>&gt;</span>设置了浮动的元素, opacity为0.5<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z4&quot;</span>&gt;</span>没有设置任何浮动的容器, 背景为绿色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z1&quot;</span>&gt;</span>设置了浮动的元素, opacity为0.5<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z5&quot;</span>&gt;</span>没有设置任何浮动的容器, 背景为粉色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z6&quot;</span>&gt;</span>和父级元素同级的容器, 没有设置任何浮动, 背景为绿色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;z7&quot;</span>&gt;</span>和父级元素同级的容器, 没有设置任何浮动, 背景为绿色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>效果图如下几张截图：</p>
<ul>
<li>父元素没有清除浮动，外部矛盾，内部矛盾都存在</li>
</ul>
<p><img src="http://images.pingan8787.com/20190819_float_13.png" alt="13"></p>
<ul>
<li>父元素使用 <code>bfc</code> 清除浮动，外部矛盾解决，内部矛盾还存在</li>
</ul>
<p><img src="http://images.pingan8787.com/20190819_float_14.png" alt="14"></p>
<p>通过给父元素中的浮动元素后面的第一个同级块级元素设置clear清除浮动，内部矛盾解决，外部矛盾也解决。</p>
<p><img src="http://images.pingan8787.com/20190819_float_15.png" alt="15"></p>
<p>对于clear还有left和right，这个就不说了，api的事情，正常both就可以了。写到此，差不多要结束了。最后再总结一下吧：<br>不同业务中可能需要不同的清除浮动的方式，不论选择哪一种方式，都避不开外部矛盾和内部矛盾，你的业务需要保留内部矛盾，只解决外部矛盾，还是外部矛盾和内部矛盾都解决。这些得需要根据业务的特点来决定。其次，是使用bfc还是clear还是伪元素，使用bfc的话使用哪种方式去触发。这也是根据业务的特点来决定。<br>文末的可爱声明：如果转发或者引用，请贴上原链接，尊重一下熬夜完成的劳动成果😂。文章可能有一些错误，欢迎评论指出，也欢迎一起讨论。文章可能写的不够好，还请多多包涵。为了前端，我也是操碎了心，人生苦短，我学前端，多一点贡献，多一分开心~</p>
<p>作者：源码终结者<br>链接：<a target="_blank" rel="noopener" href="https://juejin.im/post/5bbe1054f265da0af2138c5e">https://juejin.im/post/5bbe1054f265da0af2138c5e</a><br>来源：掘金   </p>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#x70;&#105;&#110;&#x67;&#x61;&#110;&#56;&#55;&#56;&#55;&#64;&#113;&#x71;&#46;&#99;&#111;&#109;">&#x70;&#105;&#110;&#x67;&#x61;&#110;&#56;&#55;&#56;&#55;&#64;&#113;&#x71;&#46;&#99;&#111;&#109;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>ES小册</td>
<td>js.pingan8787.com</td>
</tr>
</tbody></table>
<h3 id="微信公众号"><a href="#微信公众号" class="headerlink" title="微信公众号"></a>微信公众号</h3><p><img src="http://images.pingan8787.com/2019_07_12guild_page.png" alt="bg">  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/08/19/172-%E3%80%90CSS%E3%80%91%E5%8F%AF%E8%83%BD%E6%98%AF%E6%9C%80%E5%85%A8%E9%9D%A2%E6%9C%80%E6%98%93%E6%87%82%E7%9A%84%E8%A7%A3%E6%9E%90%E5%89%8D%E7%AB%AF%E6%B5%AE%E5%8A%A8%E7%9A%84%E6%96%87%E7%AB%A0/" data-id="ckts3ejy900m94d9k2bgl7c0n" data-title="172-【CSS】可能是最全面最易懂的解析前端浮动的文章" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CSS/" rel="tag">CSS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-171-【Webpack】Webpack4入门手册——共18篇" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/08/14/171-%E3%80%90Webpack%E3%80%91Webpack4%E5%85%A5%E9%97%A8%E6%89%8B%E5%86%8C%E2%80%94%E2%80%94%E5%85%B118%E7%AF%87/" class="article-date">
  <time class="dt-published" datetime="2019-08-13T23:37:27.000Z" itemprop="datePublished">2019-08-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/08/14/171-%E3%80%90Webpack%E3%80%91Webpack4%E5%85%A5%E9%97%A8%E6%89%8B%E5%86%8C%E2%80%94%E2%80%94%E5%85%B118%E7%AF%87/">171-【Webpack】Webpack4入门手册——共18篇</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="Webpack4-入门手册（共-18-章）"><a href="#Webpack4-入门手册（共-18-章）" class="headerlink" title="Webpack4 入门手册（共 18 章）"></a>Webpack4 入门手册（共 18 章）</h2><p><img src="http://images.pingan8787.com/webpack_bg.png" alt="webpack_bg"></p>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><h3 id="1-背景"><a href="#1-背景" class="headerlink" title="1. 背景"></a>1. 背景</h3><p>最近和部门老大，一起在研究团队【EFT - 前端新手村】的建设，目的在于：<strong>帮助新人快速了解和融入公司团队</strong>，<strong>帮助零基础新人学习和入门前端开发</strong>并且<strong>达到公司业务开发水平</strong>。</p>
<p>本文也是属于【EFT - 前端新手村】的一部分，用来帮助新人快速入门 <code>Webpack4</code>，内容偏基础，当然也可以作为复习材料~~这里分享给各位小伙伴啦！</p>
<h3 id="2-文章概要"><a href="#2-文章概要" class="headerlink" title="2. 文章概要"></a>2. 文章概要</h3><p>我将从最基础的【项目初始化】开始介绍，到【处理 CSS / JS / 图片】，到【热更新，打包优化】等等，一一介绍和实践。</p>
<p>文章共分为 18 章，关于最基础的四个核心概念，可以到我整理的另一篇文章 <a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo-JavaScript/blob/master/Cute-Webpack/guide/README.md">《Webpack4 的四个核心概念》</a> 中学习。</p>
<h3 id="3-教程目录"><a href="#3-教程目录" class="headerlink" title="3. 教程目录"></a>3. 教程目录</h3><p><img src="http://images.pingan8787.com/Webpack4%E5%85%A5%E9%97%A8%E6%89%8B%E5%86%8C2.png" alt="教程目录"></p>
<h2 id="一、-项目初始化"><a href="#一、-项目初始化" class="headerlink" title="一、 项目初始化"></a>一、 项目初始化</h2><h3 id="1-初始化-demo"><a href="#1-初始化-demo" class="headerlink" title="1. 初始化 demo"></a>1. 初始化 demo</h3><p>新建并进入文件夹 <code>leo</code>:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir leo</span><br><span class="line"><span class="built_in">cd</span> leo</span><br></pre></td></tr></table></figure>

<p>然后本地安装 <code>webpack</code> 和 <code>webpack-cli</code> （<strong>在 Webpack 4.0以后需要单独安装</strong>）：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack webpack-cli --save-dev</span><br></pre></td></tr></table></figure>

<p>初始化项目结构：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="addition">+ ├─package.json</span></span><br><span class="line"><span class="addition">+ ├─dist          // 存放最终打包的文件</span></span><br><span class="line"><span class="addition">+ │  └─index.html</span></span><br><span class="line"><span class="addition">+ ├─src           // 存放入口文件等开发文件</span></span><br><span class="line"><span class="addition">+ │  └─index.js</span></span><br><span class="line"><span class="addition">+ ├─webpack.config.js  // webpack的配置文件</span></span><br></pre></td></tr></table></figure>

<p>安装 <code>lodash</code>：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install lodash --save-dev</span><br></pre></td></tr></table></figure>

<p><em><code>--save</code> 可以简写为<code>-S</code>, <code>--save-dev</code>可以简写为<code>-D</code>.</em></p>
<p>开发 <code>index.js</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">&#x27;lodash&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createElement</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> div = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">    div.innerHTML = _.join([<span class="string">&#x27;my&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;is&#x27;</span>, <span class="string">&#x27;leo&#x27;</span>], <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> div;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(createElement());</span><br></pre></td></tr></table></figure>

<p>开发 <code>webpack.config.js</code>：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;main.js&#x27;</span>,</span><br><span class="line">        <span class="attr">path</span>: path.resolve(__dirname, <span class="string">&#x27;dist&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-打包测试"><a href="#2-打包测试" class="headerlink" title="2. 打包测试"></a>2. 打包测试</h3><p>开始第一次打包任务：   </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">npx webpack</span><br><span class="line"></span><br><span class="line">// 输出：</span><br><span class="line"></span><br><span class="line">Hash: 030b37b6b9a0b4344437</span><br><span class="line">Version: webpack 4.39.1Time: 308ms</span><br><span class="line">Built at: 2019-08-07 08:10:21</span><br><span class="line">  Asset     Size  Chunks             Chunk Names</span><br><span class="line">main.js  552 KiB    main  [emitted]  main</span><br><span class="line">Entrypoint main = main.js</span><br><span class="line">[./node_modules/webpack/buildin/global.js] (webpack)/buildin/global.js 472 bytes &#123;main&#125; [built]</span><br><span class="line">[./node_modules/webpack/buildin/module.js] (webpack)/buildin/module.js 497 bytes &#123;main&#125; [built][./src/index.js] 225 bytes &#123;main&#125; [built]</span><br><span class="line">    + 1 hidden module</span><br></pre></td></tr></table></figure>

<p>打包成功后，生成的文件会保存在 <code>dist</code> 目录中。</p>
<p>现在在 <code>dist/index.html</code> 中引入打包后的 <code>main.js</code>，打开浏览器测试：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./main.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h2 id="二、-webpack-处理-CSS-模块"><a href="#二、-webpack-处理-CSS-模块" class="headerlink" title="二、 webpack 处理 CSS 模块"></a>二、 webpack 处理 CSS 模块</h2><p>这一部分，我们开始学着使用 <code>webpack</code> 去处理 <code>css</code> 相关的模块。</p>
<h3 id="1-修改代码"><a href="#1-修改代码" class="headerlink" title="1. 修改代码"></a>1. 修改代码</h3><p>在项目 <code>src</code> 目录中，新建 <code>style</code> 文件夹，并新建 <code>index.css</code> 文件：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  ├─package.json</span><br><span class="line">  ├─dist          // 存放最终打包的文件</span><br><span class="line">  │  └─index.html</span><br><span class="line">  ├─src           // 存放入口文件等开发文件</span><br><span class="line">  │  ├─index.js</span><br><span class="line"><span class="addition">+ │  └─style</span></span><br><span class="line"><span class="addition">+ │     └─index.css</span></span><br><span class="line">  ├─webpack.config.js  // webpack的配置文件</span><br></pre></td></tr></table></figure>

<p>接着在 <code>index.js</code> 的新建元素方法中，添加 <code>class</code> 为 <code>box</code>，这样新建的元素就带有 <code>box</code> 的 <code>class</code> 属性：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// src/index.js</span><br><span class="line"></span><br><span class="line">import _ from &#x27;lodash&#x27;;</span><br><span class="line">import &#x27;./style/index.css&#x27;;// 引入样式文件</span><br><span class="line"></span><br><span class="line">function createElement()&#123;</span><br><span class="line">  let div = document.createElement(&#x27;div&#x27;);</span><br><span class="line">  div.innerHTML = _.join([&#x27;my&#x27;, &#x27;name&#x27;, &#x27;is&#x27;, &#x27;leo&#x27;], &#x27;&#x27;);</span><br><span class="line"><span class="addition">+ div.className = &#x27;box&#x27;;</span></span><br><span class="line">  return div;</span><br><span class="line">&#125;</span><br><span class="line">document.body.appendChild(createElement());</span><br></pre></td></tr></table></figure>

<p>然后在 <code>index.css</code> 文件为 <code>box</code> ：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// <span class="attribute">src</span>/style/index<span class="selector-class">.css</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><strong>注意：</strong></p>
<p>这里使用 <code>import &#39;./style/index.css&#39;;</code> 引入我们的样式文件，是没办法解析使用，这时我们需要在 <code>webpack</code> 中使用到第三方 <code>loader</code> 插件，这里我们使用：   </p>
<ul>
<li><code>css-loader</code> ： 用于处理 <code>css</code> 文件，使得能在 js 文件中引入使用；</li>
<li><code>style-loader</code> ： 用于将 <code>css</code> 文件注入到 <code>index.html</code> 中的 <code>&lt;style&gt;</code> 标签上；</li>
</ul>
<h3 id="2-安装配置插件"><a href="#2-安装配置插件" class="headerlink" title="2. 安装配置插件"></a>2. 安装配置插件</h3><p>安装插件：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev style-loader css-loader</span><br></pre></td></tr></table></figure>

<p>再到 <code>webpack.config.js</code> 中添加 <code>css</code> 解析的 <code>loader</code> 配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">  <span class="attr">rules</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">      use: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>参数介绍：</p>
<p><code>test</code>：<strong>需要匹配的模块后缀名</strong>；<br><code>use</code>：对应<strong>处理的 loader 插件名称</strong>（处理顺序是从右往左）。</p>
<h3 id="3-打包测试"><a href="#3-打包测试" class="headerlink" title="3. 打包测试"></a>3. 打包测试</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">npx webpack</span><br><span class="line"></span><br><span class="line">// 输出：</span><br><span class="line"></span><br><span class="line">Hash: 28b3965aa1b6a0047536</span><br><span class="line">Version: webpack 4.39.1</span><br><span class="line">Time: 482msBuilt at: 2019-08-09 07:45:25  Asset     Size  Chunks             Chunk Names</span><br><span class="line">main.js  565 KiB    main  [emitted]  main</span><br><span class="line">Entrypoint main = main.js</span><br><span class="line">[./node_modules/_css-loader@3.2.0@css-loader/dist/cjs.js!./src/style/index.css] 190 bytes &#123;main&#125; [built]</span><br><span class="line">[./node_modules/webpack/buildin/global.js] (webpack)/buildin/global.js 472 bytes &#123;main&#125; [built][./node_modules/webpack/buildin/module.js] (webpack)/buildin/module.js 497 bytes &#123;main&#125; [built][./src/index.js] 303 bytes &#123;main&#125; [built]</span><br><span class="line">[./src/style/index.css] 447 bytes &#123;main&#125; [built]</span><br><span class="line">    + 3 hidden modules</span><br></pre></td></tr></table></figure>

<p>这时候可以看见 <code>index.html</code> 中，文本已经变成红色，并且 <code>css</code> 代码已经添加到 <code>&lt;style&gt;</code> 标签上。</p>
<p><img src="http://images.pingan8787.com/webpack01.png" alt="webpack01"></p>
<h2 id="三、-webpack-模块介绍和处理-sass"><a href="#三、-webpack-模块介绍和处理-sass" class="headerlink" title="三、 webpack 模块介绍和处理 sass"></a>三、 webpack 模块介绍和处理 sass</h2><p>在这一节中，我们会介绍 <code>webpack</code> 中的模块，并且介绍如何去处理 <code>sass</code> 文件。</p>
<h3 id="1-webpack-模块介绍"><a href="#1-webpack-模块介绍" class="headerlink" title="1. webpack 模块介绍"></a>1. webpack 模块介绍</h3><p>这里介绍的模块（module）是指 <code>webpack.config.js</code> 文件中的 <code>module</code> 配置，它决定了如何处理项目中的不同类型模块。</p>
<p>比如上一节介绍的，使用 <code>style-loader</code> 、 <code> css-loader</code> 两个插件去处理 <code>css</code> 文件。   </p>
<p><code>webpack</code> 模块支持如下语句：</p>
<ul>
<li>ES2015 <code>import</code> 语句；</li>
<li>CommonJS <code>require()</code> 语句；</li>
<li>AMD <code>define</code> 和 <code>require</code> 语句；</li>
<li><code>css/sass/less</code> 文件中 <code>@import</code> 语句；</li>
<li>样式 <code>(url(...))</code> 或者 HTML 文件 <code>(&lt;img src=...&gt;)</code> 中的图片链接 <code>(image url)</code>；</li>
</ul>
<p>这里建议使用 <code>ES2015</code> 的引入方法，毕竟这是标准。</p>
<blockquote>
<p>更多参数介绍，可访问中文官网的介绍:<br><a target="_blank" rel="noopener" href="https://www.webpackjs.com/configuration/">《webpack 配置选项》</a></p>
</blockquote>
<h3 id="2-常用模块"><a href="#2-常用模块" class="headerlink" title="2. 常用模块"></a>2. 常用模块</h3><h4 id="2-1-module-noParse"><a href="#2-1-module-noParse" class="headerlink" title="2.1 module.noParse"></a>2.1 module.noParse</h4><p>值的类型：<code>RegExp | [RegExp] | function</code></p>
<p>防止 <code>webpack</code> 解析那些符合匹配条件的文件，忽略的文件夹中不应该含有 <code>import</code>、<code>require</code>、<code>define</code>的调用，或任何其他导入机制，忽略的 <code>library</code> 可以<strong>提高构建效率</strong>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">  <span class="attr">noParse</span>: <span class="function"><span class="keyword">function</span>(<span class="params">content</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="regexp">/jquery|lodash/</span>.test(content);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-module-rules"><a href="#2-2-module-rules" class="headerlink" title="2.2 module.rules"></a>2.2 module.rules</h4><p>创建模块时，匹配请求的规则数组。按照规则为对应模块使用对应的 <code>loader</code>，或修改解析器（parser）。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">  <span class="attr">rules</span>: [</span><br><span class="line">    &#123; <span class="attr">test</span>: <span class="regexp">/\.css$/</span>, use: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>]&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>module.rules</code> 参数有：</li>
</ul>
<p><code>use</code>：为模块使用指定 <code>loader</code>，并且可以传入一个字符串数组，<strong>加载顺序从右往左</strong>。</p>
<ul>
<li><code>module.rules</code> 匹配条件有：</li>
</ul>
<p><code>&#123;test : Condition&#125;</code>：<strong>匹配</strong>特定条件，非必传，支持一个<strong>正则表达式</strong>或<strong>正则表达式数组</strong>；<br><code>&#123;include : Condition&#125;</code>：<strong>匹配</strong>特定条件，非必传，支持一个<strong>字符串</strong>或<strong>字符串数组</strong>；<br><code>&#123;exclude : Condition&#125;</code>：<strong>排除</strong>特定条件，非必传，支持一个<strong>字符串</strong>或<strong>字符串数组</strong>；<br><code>&#123;and : [Condition]&#125;</code>：必须匹配数组中的所有条件；<br><code>&#123;or : [Condition]&#125;</code>：匹配数组中任一条件；<br><code>&#123;not : [Condition]&#125;</code>：必须排除这个条件；   </p>
<blockquote>
<p>更多参数介绍，可访问中文官网的介绍:<br><a target="_blank" rel="noopener" href="https://www.webpackjs.com/configuration/module/#rule">《Rule》</a></p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">  <span class="attr">rules</span>: [</span><br><span class="line">    &#123; </span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.css$/</span>, </span><br><span class="line">      use: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>],</span><br><span class="line">      <span class="attr">include</span>: [</span><br><span class="line">        path.resolve(__dirname, <span class="string">&quot;app/style.css&quot;</span>),</span><br><span class="line">        path.resolve(__dirname, <span class="string">&quot;vendor/style.css&quot;</span>)</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="3-加载-Sass-文件"><a href="#3-加载-Sass-文件" class="headerlink" title="3. 加载 Sass 文件"></a>3. 加载 Sass 文件</h3><p>需要使用到 <code>sass-loader</code> 的插件，这里先安装：  </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install sass-loader node-sass --save-dev</span><br></pre></td></tr></table></figure>

<p>在 <code>src/style</code> 目录下添加 <code>leo.scss</code> 文件，并添加内容：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// leo<span class="selector-class">.scss</span></span><br><span class="line"></span><br><span class="line">$bg-<span class="attribute">color</span>: <span class="number">#ee3</span>;</span><br><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">    <span class="attribute">background-color</span>: $bg-color;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在 <code>src/index.js</code> 中引入 <code>leo.scss</code> 文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./style/leo.scss&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>再 <code>npx webpack</code> 重新打包，并打开 <code>dist/index.html</code> 可以看到背景颜色已经添加上去：</p>
<p><img src="http://images.pingan8787.com/webpack03.png" alt="webpack03"></p>
<h3 id="4-添加快捷打包命令"><a href="#4-添加快捷打包命令" class="headerlink" title="4. 添加快捷打包命令"></a>4. 添加快捷打包命令</h3><p>像 <code>npx webpack</code> 这个命令我们需要经常使用，对于这种命令，我们可以把它写成命令，方便每次使用。</p>
<p>我们在 <code>package.json</code> 的 <code>scripts</code> 中添加一个命令为 <code>build</code>，以后打包只要执行 <code>npm run build</code> 即可：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;build&quot;</span>: <span class="string">&quot;npx webpack -c webpack.config.js&quot;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>这里的 <code>-c webpack.config.js</code> 中，<code>-c</code> 后面跟着的是 <code>webpack</code> 配置文件的文件名，默认可以不写。  </p>
<h2 id="四、-webpack-开启-SourceMap-和添加-CSS3-前缀"><a href="#四、-webpack-开启-SourceMap-和添加-CSS3-前缀" class="headerlink" title="四、 webpack 开启 SourceMap 和添加 CSS3 前缀"></a>四、 webpack 开启 SourceMap 和添加 CSS3 前缀</h2><p>添加 <code>SourceMap</code> 是为了方便打包之后，我们在项目中调试样式，定位到样式在源文件的位置。</p>
<h3 id="1-开启-SourceMap"><a href="#1-开启-SourceMap" class="headerlink" title="1. 开启 SourceMap"></a>1. 开启 SourceMap</h3><p>在 <code>css-loader</code> 和 <code>sass-loader</code> 都可以通过设置 <code>options</code> 选项启用 <code>sourceMap</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="attr">rules</span>: [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">test</span>: <span class="regexp">/\.(sc|c|sa)ss$/</span>,</span><br><span class="line">    use: [</span><br><span class="line">      <span class="string">&quot;style-loader&quot;</span>, </span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">loader</span>:<span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">        <span class="attr">options</span>:&#123; <span class="attr">sourceMap</span>: <span class="literal">true</span> &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">loader</span>:<span class="string">&quot;sass-loader&quot;</span>,</span><br><span class="line">        <span class="attr">options</span>:&#123; <span class="attr">sourceMap</span>: <span class="literal">true</span> &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>再重新打包，看下 <code>index.html</code> 的样式，样式已经定位到源文件上了：</p>
<p><img src="http://images.pingan8787.com/webpack04.png" alt="webpack04"></p>
<p>这样我们在开发过程中，调试样式就方便很多了。</p>
<h3 id="2-为样式添加-CSS3-前缀"><a href="#2-为样式添加-CSS3-前缀" class="headerlink" title="2. 为样式添加 CSS3 前缀"></a>2. 为样式添加 CSS3 前缀</h3><p>这里我们用到 <code>PostCSS</code> 这个 <code>loader</code>，它是一个 CSS <strong>预处理工具</strong>，可以为 CSS3 的属性<strong>添加前缀</strong>，样式格式校验（<code>stylelint</code>），提前使用 <code>CSS</code> 新特性，实现 <code>CSS</code> 模块化，防止 <code>CSS</code> 样式冲突。</p>
<p>首先安装 <code>PostCSS</code>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install postcss-loader autoprefixer --save-dev</span><br></pre></td></tr></table></figure>

<p>另外还有：</p>
<ul>
<li><p><code>postcss-cssnext</code> 可以让我们使用 <code>CSS4 </code>的样式，并能配合 <code>autoprefixer</code> 进行浏览器部分兼容的补全，还支持嵌套语法。</p>
</li>
<li><p><code>precss</code> 类似 <code>scss</code> 语法，如果我们只需要使用嵌套，就可以用它替换 <code>scss</code>。</p>
</li>
<li><p><code>postcss-import</code> 让我们可以在<code>@import</code> CSS文件的时 <code>webpack</code> 能监听并编译。</p>
</li>
</ul>
<blockquote>
<p>更多参数介绍，可访问中文官网的介绍:<br><a target="_blank" rel="noopener" href="https://www.webpackjs.com/loaders/postcss-loader/">《postcss-loader》</a></p>
</blockquote>
<p>开始添加 <code>postcss-loader</code> 并设置 <code>autoprefixer</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="attr">rules</span>: [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">test</span>: <span class="regexp">/\.(sc|c|sa)ss$/</span>,</span><br><span class="line">    use: [</span><br><span class="line">      <span class="string">&quot;style-loader&quot;</span>, </span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">loader</span>:<span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">        <span class="attr">options</span>:&#123; <span class="attr">sourceMap</span>: <span class="literal">true</span> &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">loader</span>:<span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">        <span class="attr">options</span>: &#123;</span><br><span class="line">          <span class="attr">ident</span>: <span class="string">&quot;postcss&quot;</span>,</span><br><span class="line">          <span class="attr">sourceMap</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">plugins</span>: <span class="function"><span class="params">loader</span> =&gt;</span> [</span><br><span class="line">            <span class="built_in">require</span>(<span class="string">&#x27;autoprefixer&#x27;</span>)(),</span><br><span class="line">            <span class="comment">// 这里可以使用更多配置，如上面提到的 postcss-cssnext 等</span></span><br><span class="line">            <span class="comment">// require(&#x27;postcss-cssnext&#x27;)()</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">loader</span>:<span class="string">&quot;sass-loader&quot;</span>,</span><br><span class="line">        <span class="attr">options</span>:&#123; <span class="attr">sourceMap</span>: <span class="literal">true</span> &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>还需要在 <code>package.json</code> 中添加判断浏览器版本：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="attr">&quot;browserslist&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;&gt; 1%&quot;</span>, <span class="comment">// 全球浏览器使用率大于1%，最新两个版本并且是IE8以上的浏览器，加前缀 </span></span><br><span class="line">    <span class="string">&quot;last 2 versions&quot;</span>,</span><br><span class="line">    <span class="string">&quot;not ie &lt;= 8&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>为了做测试，我们修改 <code>src/style/leo.scss</code> 中 <code>.box</code> 的样式：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// <span class="attribute">src</span>/style/leo<span class="selector-class">.scss</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">    <span class="attribute">background-color</span>: $bg-color;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后重新打包，可以看见 CSS3 属性的前缀已经添加上去了：</p>
<p><img src="http://images.pingan8787.com/webpack05.png" alt="webpack05"></p>
<h2 id="五、-webpack-将-CSS-抽取成单独文件"><a href="#五、-webpack-将-CSS-抽取成单独文件" class="headerlink" title="五、 webpack 将 CSS 抽取成单独文件"></a>五、 webpack 将 CSS 抽取成单独文件</h2><p>在之前学习中，CSS 样式代码都是写到 <code>index.html</code> 的 <code>&lt;style&gt;</code> 标签中，这样样式代码多了以后，很不方便。</p>
<p>于是我们需要将这些样式打包成单独的 <code>CSS</code> 文件。</p>
<p>webpack4 开始使用 <code>mini-css-extract-plugin</code> 插件，而在 1-3 版本使用 <code>extract-text-webpack-plugin</code>。</p>
<blockquote>
<p>注意：抽取样式以后，就不能使用 <code>style-loader</code> 注入到 html 中。</p>
</blockquote>
<p>安装插件：   </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install mini-css-extract-plugin --save-dev</span><br></pre></td></tr></table></figure>

<p>引入插件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">&#x27;mini-css-extract-plugin&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>然后修改 <code>rules</code>，将 <code>style-loader</code>，替换成 <code>MiniCssExtractPlugin.loader</code> ，然后添加 <code>plugins</code> 配置项：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">  <span class="attr">rules</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.(sc|c|sa)ss$/</span>,</span><br><span class="line">      use: [</span><br><span class="line">        MiniCssExtractPlugin.loader, </span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">loader</span>:<span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">          <span class="attr">options</span>:&#123; <span class="attr">sourceMap</span>: <span class="literal">true</span> &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">loader</span>:<span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">ident</span>: <span class="string">&quot;postcss&quot;</span>,</span><br><span class="line">            <span class="attr">sourceMap</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">plugins</span>: <span class="function"><span class="params">loader</span> =&gt;</span> [<span class="built_in">require</span>(<span class="string">&#x27;autoprefixer&#x27;</span>)()]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">loader</span>:<span class="string">&quot;sass-loader&quot;</span>,</span><br><span class="line">          <span class="attr">options</span>:&#123; <span class="attr">sourceMap</span>: <span class="literal">true</span> &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">  <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;[name].css&#x27;</span>, <span class="comment">// 最终输出的文件名</span></span><br><span class="line">    <span class="attr">chunkFilename</span>: <span class="string">&#x27;[id].css&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>然后重新打包，这时候可以看到我们 <code>dist</code> 目录下就多了个 <code>main.css</code> 文件：</p>
<p><img src="http://images.pingan8787.com/webpack06.png" alt="webpack06"></p>
<p>因为现在已经将 CSS 都抽取成单独文件，所以在 <code>dist/index.html</code> 中，我们需要手动引入 <code>main.css</code> 了：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// index.html</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;main.css&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="六、-webpack-压缩-CSS-和-JS"><a href="#六、-webpack-压缩-CSS-和-JS" class="headerlink" title="六、 webpack 压缩 CSS 和 JS"></a>六、 webpack 压缩 CSS 和 JS</h2><p>为了缩小打包后包的体积，我们经常做优化的时候，将 CSS 和 JS 文件进行压缩，这里需要使用到不同的插件。</p>
<h3 id="1-压缩-CSS"><a href="#1-压缩-CSS" class="headerlink" title="1. 压缩 CSS"></a>1. 压缩 CSS</h3><p>使用 <code>optimize-css-assets-webpack-plugin</code> 压缩 CSS 的插件。  </p>
<p>安装插件：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install optimize-css-assets-webpack-plugin --save-dev</span><br></pre></td></tr></table></figure>

<p>使用插件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ... 省略</span></span><br><span class="line"><span class="keyword">const</span> OptimizeCssAssetsPlugin = <span class="built_in">require</span>(<span class="string">&#x27;optimize-css-assets-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ... 省略</span></span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="comment">// ... 省略</span></span><br><span class="line">    <span class="keyword">new</span> OptimizeCssAssetsPlugin(&#123;&#125;)</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重新打包，可以看到 <code>main.css</code> 已经被压缩成一行代码，即压缩成功~</p>
<h3 id="2-压缩-JS"><a href="#2-压缩-JS" class="headerlink" title="2. 压缩 JS"></a>2. 压缩 JS</h3><p>使用 <code>uglifyjs-webpack-plugin</code> 压缩 JS 的插件。  </p>
<p>安装插件：   </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install uglifyjs-webpack-plugin --save-dev</span><br></pre></td></tr></table></figure>

<p>引入插件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> UglifyJsPlugin = <span class="built_in">require</span>(<span class="string">&#x27;uglifyjs-webpack-plugin&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>使用插件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="comment">// ... 省略</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ... 省略</span></span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="comment">// ... 省略</span></span><br><span class="line">    <span class="keyword">new</span> OptimizeCssAssetsPlugin(&#123;&#125;),</span><br><span class="line">    <span class="keyword">new</span> UglifyJsPlugin(&#123;</span><br><span class="line">      <span class="attr">cache</span>: <span class="literal">true</span>, <span class="attr">parallel</span>: <span class="literal">true</span>, <span class="attr">sourceMap</span>: <span class="literal">true</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中 <code>UglifyJsPlugin</code> 的参数：  </p>
<p><code>cache</code>：当 JS 没有发生变化则不压缩；<br><code>parallel</code>：是否启用并行压缩；<br><code>sourceMap</code>：是否启用 sourceMap；  </p>
<p>然后重新打包，查看 <code>main.js</code>，已经被压缩了：</p>
<p><img src="http://images.pingan8787.com/webpack07.png" alt="webpack07"></p>
<h2 id="七、webpack-为文件名添加-hash-值"><a href="#七、webpack-为文件名添加-hash-值" class="headerlink" title="七、webpack 为文件名添加 hash 值"></a>七、webpack 为文件名添加 hash 值</h2><p>由于我们打包出来的 <code>css</code>、<code>js</code> 文件是静态文件，就存在缓存问题，因此我们可以给文件名添加 <code>hash</code> 值，防止缓存。   </p>
<h3 id="1-添加-hash-值"><a href="#1-添加-hash-值" class="headerlink" title="1. 添加 hash 值"></a>1. 添加 hash 值</h3><p>直接在 <code>webpack.config.js</code> 中，为需要添加 hash 值的文件名添加 <code>[hash]</code> 就可以：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ... 省略其他</span></span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;main.[hash].js&#x27;</span>,</span><br><span class="line">    <span class="attr">path</span>: path.resolve(__dirname, <span class="string">&#x27;dist&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&#x27;[name].[hash].css&#x27;</span>,</span><br><span class="line">      <span class="attr">chunkFilename</span>: <span class="string">&#x27;[id].[hash].css&#x27;</span></span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置完成后，重新打包，就可以看到文件名中包含了 <code>hash</code> 值了：</p>
<p><img src="http://images.pingan8787.com/webpack08.png" alt="webpack08"></p>
<h3 id="2-动态引用打包后的文件"><a href="#2-动态引用打包后的文件" class="headerlink" title="2. 动态引用打包后的文件"></a>2. 动态引用打包后的文件</h3><p>由于我们前面给打包的文件名添加了 <code>hash</code> 值，会导致 <code>index.html</code> 引用文件错误，所以我们需要让它能动态引入打包后的文件。</p>
<p>这里我们使用 <code>HtmlWebpackPlugin</code> 插件，它可以把打包后的 CSS 或者 JS 文件直接引用注入到 HTML 模版中，就不用每次手动修改。</p>
<p>安装插件：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install html-webpack-plugin --save-dev</span><br></pre></td></tr></table></figure>

<p>引入插件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>使用插件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">  <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&quot;leo study!&quot;</span>,   <span class="comment">// 生成的文件标题</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;main.html&quot;</span>, <span class="comment">// 最终生成的文件名</span></span><br><span class="line">    <span class="attr">minify</span>: &#123; <span class="comment">// 压缩选项</span></span><br><span class="line">      <span class="attr">collapseWhitespace</span>: <span class="literal">true</span>, <span class="comment">// 移除空格</span></span><br><span class="line">      <span class="attr">removeComments</span>: <span class="literal">true</span>, <span class="comment">// 移除注释</span></span><br><span class="line">      <span class="attr">removeAttributeQuotes</span>: <span class="literal">true</span>, <span class="comment">// 移除双引号</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<p>关于 <code>html-webpack-plugin</code> 更多介绍可以<a target="_blank" rel="noopener" href="https://github.com/jantimon/html-webpack-plugin">《查看文档》</a><a target="_blank" rel="noopener" href="https://github.com/jantimon/html-webpack-plugin/%E3%80%82">https://github.com/jantimon/html-webpack-plugin/。</a></p>
<p>接着我们打包以后，可以看见 <code>dist</code> 目录下，多了 <code>main.html</code> 的文件，格式化以后，可以看出，已经动态引入打包后的 CSS 文件和 JS 文件了：</p>
<p><img src="http://images.pingan8787.com/webpack09.png" alt="webpack09"></p>
<h2 id="八、-webpack-清理目录插件"><a href="#八、-webpack-清理目录插件" class="headerlink" title="八、 webpack 清理目录插件"></a>八、 webpack 清理目录插件</h2><p>在之前，我们每次打包都会生成新的文件，并且在添加 <code>hash</code> 值以后，文件名不会出现重复的情况，导致旧文件的冗余。</p>
<p>为了解决这个问题，我们需要在每次打包之前，将 <code>/dist</code> 目录清空，再进行打包。</p>
<p>这里我们使用 <code>clean-webpack-plugin</code> 插件来实现。</p>
<p>安装插件：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install clean-webpack-plugin --save-dev</span><br></pre></td></tr></table></figure>

<p>引入插件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> CleanWebpackPlugin = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>使用插件：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">  <span class="keyword">new</span> CleanWebpackPlugin()</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<p>参数 <code>cleanOnceBeforeBuildPatterns</code> 是表示需要清除的文件夹。</p>
<p>这样我们每次打包之前，都会先将 <code>/dist</code> 目录清空一次，再执行打包。   </p>
<blockquote>
<p>更多参数介绍，可访问中文官网的介绍:<br><a target="_blank" rel="noopener" href="https://github.com/jantimon/clean-webpack-plugin">《clean-webpack-plugin》</a></p>
</blockquote>
<h2 id="九、-webpack-图片处理和优化"><a href="#九、-webpack-图片处理和优化" class="headerlink" title="九、 webpack 图片处理和优化"></a>九、 webpack 图片处理和优化</h2><h3 id="1-图片处理"><a href="#1-图片处理" class="headerlink" title="1. 图片处理"></a>1. 图片处理</h3><p>在项目中引入图片：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// <span class="attribute">src</span>/style/leo<span class="selector-class">.scss</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">    <span class="attribute">background-color</span>: $bg-color;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">&#x27;./../assets/logo.jpg&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时候我们如果直接打包，会报错。</p>
<p>我们需要使用 <code>file-loader</code> 插件来处理文件导入的问题。   </p>
<p>安装插件：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install file-loader --save-dev</span><br></pre></td></tr></table></figure>

<p>使用插件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">test</span>: <span class="regexp">/\.(png|svg|jpg|jpeg|gif)$/</span>,</span><br><span class="line">    use: [<span class="string">&quot;file-loader&quot;</span>]</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>重新打包以后，发现 <code>dist</code> 目录下多了一个如 <code>373e5e0e214390f8aa9e7abb4c7c635c.jpg</code> 名称的文件，这就是我们打包后的图片。</p>
<p><img src="http://images.pingan8787.com/webpack10.png" alt="webpack10"></p>
<h3 id="2-图片优化"><a href="#2-图片优化" class="headerlink" title="2. 图片优化"></a>2. 图片优化</h3><p>更进一步，我们可以对图片进行压缩和优化，这里我们用到 <code>image-webpack-loader</code> 插件来处理。</p>
<p>安装插件：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install image-webpack-loader --save-dev</span><br></pre></td></tr></table></figure>

<p>使用插件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">test</span>: <span class="regexp">/\.(png|svg|jpg|jpeg|gif)$/</span>,</span><br><span class="line">    include: [path.resolve(__dirname, <span class="string">&#x27;src/&#x27;</span>)],</span><br><span class="line">    <span class="attr">use</span>: [<span class="string">&quot;file-loader&quot;</span>,&#123;</span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&quot;image-webpack-loader&quot;</span>,</span><br><span class="line">        <span class="attr">options</span>: &#123;</span><br><span class="line">          <span class="attr">mozjpeg</span>: &#123; <span class="attr">progressive</span>: <span class="literal">true</span>, <span class="attr">quality</span>: <span class="number">65</span> &#125;,</span><br><span class="line">          <span class="attr">optipng</span>: &#123; <span class="attr">enabled</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">          <span class="attr">pngquant</span>: &#123; <span class="attr">quality</span>: <span class="string">&#x27;65-90&#x27;</span>, <span class="attr">speed</span>: <span class="number">4</span> &#125;,</span><br><span class="line">          <span class="attr">gifsicle</span>: &#123; <span class="attr">interlaced</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">          <span class="attr">webp</span>: &#123; <span class="attr">quality</span>: <span class="number">75</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<blockquote>
<p>更多参数介绍，可访问中文官网的介绍:<br><a target="_blank" rel="noopener" href="https://github.com/tcoopman/image-webpack-loader">《image-webpack-loader》</a></p>
</blockquote>
<p>再重新打包，我们可以看到图片打包前后，压缩了很大：</p>
<p><img src="http://images.pingan8787.com/webpack11.png" alt="webpack11"></p>
<h2 id="十、-webpack-图片-base64-和字体处理"><a href="#十、-webpack-图片-base64-和字体处理" class="headerlink" title="十、 webpack 图片 base64 和字体处理"></a>十、 webpack 图片 base64 和字体处理</h2><h3 id="1-图片-base64-处理"><a href="#1-图片-base64-处理" class="headerlink" title="1. 图片 base64 处理"></a>1. 图片 base64 处理</h3><p><code>url-loader</code> 功能类似于 <code>file-loader</code>，可以将 url 地址对应的文件，打包成 base64 的 DataURL，提高访问效率。</p>
<p>安装插件：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install url-loader --save-dev</span><br></pre></td></tr></table></figure>

<p>使用插件：</p>
<blockquote>
<p>注意：这里需要将前面配置的 <code>image-webpack-loader</code> 先删除掉，在使用 <code>url-loader</code>。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">test</span>: <span class="regexp">/\.(png|svg|jpg|jpeg|gif)$/</span>,</span><br><span class="line">    include: [path.resolve(__dirname, <span class="string">&#x27;src/&#x27;</span>)],</span><br><span class="line">    <span class="attr">use</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&#x27;url-loader&#x27;</span>, <span class="comment">// 根据图片大小，把图片转换成 base64</span></span><br><span class="line">          <span class="attr">options</span>: &#123; <span class="attr">limit</span>: <span class="number">10000</span> &#125;, </span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&quot;image-webpack-loader&quot;</span>,</span><br><span class="line">        <span class="attr">options</span>: &#123;</span><br><span class="line">          <span class="attr">mozjpeg</span>: &#123; <span class="attr">progressive</span>: <span class="literal">true</span>, <span class="attr">quality</span>: <span class="number">65</span> &#125;,</span><br><span class="line">          <span class="attr">optipng</span>: &#123; <span class="attr">enabled</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">          <span class="attr">pngquant</span>: &#123; <span class="attr">quality</span>: <span class="string">&#x27;65-90&#x27;</span>, <span class="attr">speed</span>: <span class="number">4</span> &#125;,</span><br><span class="line">          <span class="attr">gifsicle</span>: &#123; <span class="attr">interlaced</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">          <span class="attr">webp</span>: &#123; <span class="attr">quality</span>: <span class="number">75</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<blockquote>
<p>更多参数介绍，可访问中文官网的介绍:<br><a target="_blank" rel="noopener" href="https://github.com/webpack-contrib/url-loader">《url-loader》</a></p>
</blockquote>
<h3 id="2-字体处理"><a href="#2-字体处理" class="headerlink" title="2. 字体处理"></a>2. 字体处理</h3><p>字体处理的方式和图片处理方式是一样的，只是我们在配置 <code>rules</code> 时的 <code>test</code> 值不相同：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">test</span>: <span class="regexp">/\.(woff|woff2|eot|ttf|otf)$/</span>,</span><br><span class="line">    include: [path.resolve(__dirname, <span class="string">&#x27;src/&#x27;</span>)],</span><br><span class="line">    <span class="attr">use</span>: [ <span class="string">&#x27;file-loader&#x27;</span> ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h2 id="十一、-webpack-配置合并和提取公共配置"><a href="#十一、-webpack-配置合并和提取公共配置" class="headerlink" title="十一、 webpack 配置合并和提取公共配置"></a>十一、 webpack 配置合并和提取公共配置</h2><p>在开发环境（development）和生产环境（production）配置文件有很多不同，但也有部分相同，为了不每次更换环境的时候都修改配置，我们就需要将配置文件做合并，和提取公共配置。</p>
<p>我们使用 <code>webpack-merge</code> 工具，将两份配置文件合并。</p>
<p>安装插件：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack-merge --save-dev</span><br></pre></td></tr></table></figure>

<p>然后调整目录结构，为了方便，我们将原来 <code>webpack.config.js</code> 文件修改名称为 <code>webpack.commen.js</code>，并复制两份相同的文件出来，分别修改文件名为 <code>webpack.prod.js</code> 和 <code>webpack.dev.js</code> 。 </p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">  ├─package.json</span><br><span class="line">  ├─dist</span><br><span class="line">  ├─src</span><br><span class="line"><span class="deletion">- ├─webpack.config.js</span></span><br><span class="line"><span class="addition">+ ├─webpack.common.js  // webpack 公共配置文件</span></span><br><span class="line"><span class="addition">+ ├─webpack.prod.js    // webpack 生产环境配置文件</span></span><br><span class="line"><span class="addition">+ ├─webpack.dev.js     // webpack 开发环境配置文件</span></span><br></pre></td></tr></table></figure>

<p>由于我们文件调整了，所以在 <code>package.json</code> 中，打包命令也需要调整，并且配置 <code>mode</code> 模式。</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;,</span><br><span class="line"><span class="deletion">- &quot;build&quot;: &quot;npx webpack -c webpack.config.js&quot;,</span></span><br><span class="line"><span class="addition">+ &quot;build&quot;: &quot;npx webpack -c webpack.dev.js --mode development&quot;,</span></span><br><span class="line"><span class="addition">+ &quot;dist&quot;: &quot;npx webpack -c webpack.prod.js --mode production&quot;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h3 id="1-调整-webpack-common-js"><a href="#1-调整-webpack-common-js" class="headerlink" title="1. 调整 webpack.common.js"></a>1. 调整 webpack.common.js</h3><p>我们先调整 <code>webpack.common.js </code> 文件，将通用的配置保留，不是通用的配置删除，结果如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.common.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; CleanWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">noParse</span>: <span class="function"><span class="keyword">function</span> (<span class="params">content</span>) </span>&#123;<span class="keyword">return</span> <span class="regexp">/jquery|lodash/</span>.test(content);&#125;,</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.(png|svg|jpg|jpeg|gif)$/</span>,</span><br><span class="line">      include: [path.resolve(__dirname, <span class="string">&#x27;src/&#x27;</span>)],</span><br><span class="line">      <span class="attr">use</span>: [&#123;</span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&#x27;url-loader&#x27;</span>, <span class="comment">// 根据图片大小，把图片转换成 base64</span></span><br><span class="line">        <span class="attr">options</span>: &#123; <span class="attr">limit</span>: <span class="number">10000</span> &#125;,</span><br><span class="line">      &#125;,&#123;</span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&quot;image-webpack-loader&quot;</span>,</span><br><span class="line">        <span class="attr">options</span>: &#123;</span><br><span class="line">          <span class="attr">mozjpeg</span>: &#123; <span class="attr">progressive</span>: <span class="literal">true</span>, <span class="attr">quality</span>: <span class="number">65</span> &#125;,</span><br><span class="line">          <span class="attr">optipng</span>: &#123; <span class="attr">enabled</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">          <span class="attr">pngquant</span>: &#123; <span class="attr">quality</span>: <span class="string">&#x27;65-90&#x27;</span>, <span class="attr">speed</span>: <span class="number">4</span> &#125;,</span><br><span class="line">          <span class="attr">gifsicle</span>: &#123; <span class="attr">interlaced</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">          <span class="attr">webp</span>: &#123; <span class="attr">quality</span>: <span class="number">75</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;]</span><br><span class="line">    &#125;,&#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.(woff|woff2|eot|ttf|otf)$/</span>,</span><br><span class="line">      include: [path.resolve(__dirname, <span class="string">&#x27;src/&#x27;</span>)],</span><br><span class="line">      <span class="attr">use</span>: [ <span class="string">&#x27;file-loader&#x27;</span> ]</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">      <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">          <span class="attr">title</span>: <span class="string">&quot;leo study!&quot;</span>,</span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;main.html&quot;</span>,</span><br><span class="line">          <span class="attr">template</span>: path.resolve(__dirname, <span class="string">&#x27;src/index.html&#x27;</span>), </span><br><span class="line">          <span class="attr">minify</span>: &#123;</span><br><span class="line">              <span class="attr">collapseWhitespace</span>: <span class="literal">true</span>,</span><br><span class="line">              <span class="attr">removeComments</span>: <span class="literal">true</span>,</span><br><span class="line">              <span class="attr">removeAttributeQuotes</span>: <span class="literal">true</span>,</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="keyword">new</span> CleanWebpackPlugin()</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-安装-babel-loader"><a href="#2-安装-babel-loader" class="headerlink" title="2. 安装 babel-loader"></a>2. 安装 babel-loader</h3><p>安装 <code>babel-loader</code> 是为了将 ES6 及以上版本的 JS 代码转换成 ES5。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install babel-loader @babel/core @babel/preset-env --save-dev</span><br></pre></td></tr></table></figure>

<p>使用插件：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.common.js</span></span><br><span class="line"></span><br><span class="line"><span class="attr">rules</span>: [</span><br><span class="line">  <span class="comment">// ... 省略其他</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">    use: [&#123;</span><br><span class="line">      <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="attr">presets</span>: [<span class="string">&#x27;@babel/preset-env&#x27;</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="attr">exclude</span>: <span class="regexp">/(node_modules|bower_components)/</span>,</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>关于 <code>babel-loader</code> 更多介绍可以<a target="_blank" rel="noopener" href="https://webpack.js.org/loaders/babel-loader/">《查看文档》</a><a target="_blank" rel="noopener" href="https://webpack.js.org/loaders/babel-loader/%E3%80%82">https://webpack.js.org/loaders/babel-loader/。</a></p>
<h3 id="3-调整-webpack-dev-js"><a href="#3-调整-webpack-dev-js" class="headerlink" title="3. 调整 webpack.dev.js"></a>3. 调整 webpack.dev.js</h3><p>这里我们就需要用到 <code>merge-webpack</code> 插件进行配置合并了：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.dev.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">&#x27;webpack-merge&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> common = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.common.js&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> devConfig = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;main.js&#x27;</span>,</span><br><span class="line">    <span class="attr">path</span>: path.resolve(__dirname, <span class="string">&#x27;dist&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [&#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.(sc|c|sa)ss$/</span>,</span><br><span class="line">      use: [</span><br><span class="line">        <span class="string">&#x27;style-loader&#x27;</span>, &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123; <span class="attr">sourceMap</span>: <span class="literal">true</span> &#125;</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">              <span class="attr">ident</span>: <span class="string">&quot;postcss&quot;</span>, <span class="attr">sourceMap</span>: <span class="literal">true</span>,</span><br><span class="line">              <span class="attr">plugins</span>: <span class="function"><span class="params">loader</span> =&gt;</span> [ <span class="built_in">require</span>(<span class="string">&#x27;autoprefixer&#x27;</span>)() ]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&quot;sass-loader&quot;</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123; <span class="attr">sourceMap</span>: <span class="literal">true</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = merge(common, devConfig)</span><br></pre></td></tr></table></figure>

<h3 id="4-调整-webpack-prod-js"><a href="#4-调整-webpack-prod-js" class="headerlink" title="4. 调整 webpack.prod.js"></a>4. 调整 webpack.prod.js</h3><p>同样对于生产环境的配置，我们也需要用 <code>merge-webpack</code> 插件进行配置合并：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.prod.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">&#x27;mini-css-extract-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> OptimizeCssAssetsPlugin = <span class="built_in">require</span>(<span class="string">&#x27;optimize-css-assets-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> UglifyJsPlugin = <span class="built_in">require</span>(<span class="string">&#x27;uglifyjs-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">&#x27;webpack-merge&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> common = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.common.js&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> prodConfig = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;main.[hash].js&#x27;</span>,</span><br><span class="line">    <span class="attr">path</span>: path.resolve(__dirname, <span class="string">&#x27;dist&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [&#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.(sc|c|sa)ss$/</span>,</span><br><span class="line">      use: [</span><br><span class="line">        MiniCssExtractPlugin.loader, &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123; <span class="attr">sourceMap</span>: <span class="literal">true</span> &#125;</span><br><span class="line">        &#125;,  &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">ident</span>: <span class="string">&quot;postcss&quot;</span>, <span class="attr">sourceMap</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">plugins</span>: <span class="function"><span class="params">loader</span> =&gt;</span> [ <span class="built_in">require</span>(<span class="string">&#x27;autoprefixer&#x27;</span>)() ]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&quot;sass-loader&quot;</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123; <span class="attr">sourceMap</span>: <span class="literal">true</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&#x27;[name].[hash].css&#x27;</span>,</span><br><span class="line">      <span class="attr">chunkFilename</span>: <span class="string">&#x27;[id].[hash].css&#x27;</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> OptimizeCssAssetsPlugin(&#123;&#125;),</span><br><span class="line">    <span class="keyword">new</span> UglifyJsPlugin(&#123;</span><br><span class="line">      <span class="attr">cache</span>: <span class="literal">true</span>, <span class="attr">parallel</span>: <span class="literal">true</span>, <span class="attr">sourceMap</span>: <span class="literal">true</span></span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = merge(common, prodConfig)</span><br></pre></td></tr></table></figure>

<h2 id="十二、-webpack-监控自动编译和启用-js-的-sourceMap"><a href="#十二、-webpack-监控自动编译和启用-js-的-sourceMap" class="headerlink" title="十二、 webpack 监控自动编译和启用 js 的 sourceMap"></a>十二、 webpack 监控自动编译和启用 js 的 sourceMap</h2><h3 id="1-开启-js-的-sourceMap"><a href="#1-开启-js-的-sourceMap" class="headerlink" title="1. 开启 js 的 sourceMap"></a>1. 开启 js 的 sourceMap</h3><p>当 webpack 打包源代码后，就很难追踪到错误和警告在源代码的位置。</p>
<p>如将三个源文件打包一个 <code>bundle</code> 中，其中一个文件的代码报错，那么堆栈追中就会指向 <code>bundle</code>。</p>
<p>为了能方便定位错误，我们使用 <code>inline-source-map</code> 选项，注意不要在生产环境中使用。</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// webpack.dev.js</span><br><span class="line"></span><br><span class="line">let devConfig = &#123;</span><br><span class="line">  // ... 省略其他</span><br><span class="line"><span class="addition">+  devtool: &#x27;inline-source-map&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-测试-sourceMap"><a href="#2-测试-sourceMap" class="headerlink" title="2. 测试 sourceMap"></a>2. 测试 sourceMap</h3><p>为了测试是否成功，我们将 <code>src/index.js</code> 代码中，在第 12 行上，添加一句日志打印。</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// src/index.js</span><br><span class="line"></span><br><span class="line">// ... 省略其他</span><br><span class="line"><span class="addition">+ console.log(111)</span></span><br></pre></td></tr></table></figure>

<p>对比下开启 <code>sourceMap</code> 前后的区别：</p>
<p><img src="http://images.pingan8787.com/webpack12.png" alt="webpack12"></p>
<h3 id="3-开启监控自动编译"><a href="#3-开启监控自动编译" class="headerlink" title="3. 开启监控自动编译"></a>3. 开启监控自动编译</h3><p>如果每次我们修改完代码，都要手动编译，那是多累的一件事。</p>
<p>为此我们使用 <code>--watch</code> 命令，让我们每次保存完，都会自动编译。</p>
<p>为此，我们需要在 <code>package.json</code> 中的打包命令添加 <code>--watch</code> 命令：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// package.json</span><br><span class="line"></span><br><span class="line"><span class="deletion">- &quot;build&quot;: &quot;npx webpack --config webpack.dev.js&quot;,</span></span><br><span class="line"><span class="addition">+ &quot;build&quot;: &quot;npx webpack --config webpack.dev.js --watch&quot;,</span></span><br></pre></td></tr></table></figure>

<p>这里仅对开发环境开启，生产环境不需要使用。</p>
<h2 id="十三、-webpack-热更新"><a href="#十三、-webpack-热更新" class="headerlink" title="十三、 webpack 热更新"></a>十三、 webpack 热更新</h2><p>上一节介绍监控自动编译，当我们保存文件后，会自动编译文件，但是我们还是需要手动去刷新页面，才能看到编译后的结果。</p>
<p>于是为了自动编译之后，再自动重新加载，我们就可以使用 <code>webpack-dev-server</code> 来启动一个简单 web 服务器，实时重新加载。</p>
<h3 id="1-开启热更新"><a href="#1-开启热更新" class="headerlink" title="1. 开启热更新"></a>1. 开启热更新</h3><p>插件安装：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack-dev-server --save-dev</span><br></pre></td></tr></table></figure>

<p>使用插件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.dev.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> devConfig = &#123;</span><br><span class="line">  <span class="comment">// ... 省略其他</span></span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">contentBase</span>: path.join(__dirname, <span class="string">&#x27;dist&#x27;</span>), </span><br><span class="line">    <span class="attr">compress</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">hot</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">overlay</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="attr">open</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">publicPath</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">host</span>: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="string">&#x27;1200&#x27;</span></span><br><span class="line"> &#125;</span><br><span class="line"> <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> webpack.NamedModulesPlugin(), <span class="comment">// 更容易查看（patch）的以来</span></span><br><span class="line">    <span class="keyword">new</span> webpack.HotModuleReplacementPlugin() <span class="comment">// 替换插件</span></span><br><span class="line"> ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启动热更新：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack-dev-server --config webpack.dev.js</span><br></pre></td></tr></table></figure>

<p>常用配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">contentBase: path.join(__dirname, &#x27;dist&#x27;), //本地服务器所加载的页面所在的目录</span><br><span class="line">clinetLogLevel: &#x27;warning&#x27;, // 可能值有 none, error, warning 或者 info (默认值)</span><br><span class="line">hot:true,//启动热更新替换特性，需要配合 webpack.HotModuleReplacementPlugin 插件</span><br><span class="line">host:&#x27;0.0.0.0&#x27;, // 启动服务器的 host</span><br><span class="line">port:7000,      // 端口号</span><br><span class="line">compress:true,  // 为所有服务启用gzip压缩</span><br><span class="line">overlay: true,  // 在浏览器中显示全屏覆盖</span><br><span class="line">stats: &quot;errors-only&quot; ,// 只显示包中的错误</span><br><span class="line">open:true, // 启用“打开”后，dev服务器将打开浏览器。</span><br><span class="line">proxy: &#123;   // 设置代理</span><br><span class="line">    &quot;/api&quot;: &#123;</span><br><span class="line">        target: &quot;http://localhost:3000&quot;,</span><br><span class="line">        pathRewrite: &#123;&quot;^/api&quot; : &quot;&quot;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时候我们访问 <code>http://localhost:1200/main.html</code> 就可以看到页面，并且修改文件，页面也会同时刷新。</p>
<h3 id="2-优化命令"><a href="#2-优化命令" class="headerlink" title="2. 优化命令"></a>2. 优化命令</h3><p>我们可以将 <code>npx webpack-dev-server --config webpack.dev.js</code> 写到 <code>package.json</code> 中作为一个命令：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// package.json</span><br><span class="line"></span><br><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;,</span><br><span class="line">  &quot;build&quot;: &quot;npx webpack --config webpack.dev.js --watch&quot;,</span><br><span class="line">  &quot;dist&quot;: &quot;npx webpack --config webpack.prod.js&quot;,</span><br><span class="line"><span class="addition">+ &quot;watch&quot;: &quot;npx webpack-dev-server --config webpack.dev.js&quot;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h2 id="十四、-webpack-设置代理服务器和-babel-转换及优化"><a href="#十四、-webpack-设置代理服务器和-babel-转换及优化" class="headerlink" title="十四、 webpack 设置代理服务器和 babel 转换及优化"></a>十四、 webpack 设置代理服务器和 babel 转换及优化</h2><h3 id="1-设置代理服务器"><a href="#1-设置代理服务器" class="headerlink" title="1. 设置代理服务器"></a>1. 设置代理服务器</h3><p>接着上一节，接下来给 webpack 设置代理服务器：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.dev.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> devConfig = &#123;</span><br><span class="line">  <span class="comment">// ... 省略其他</span></span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="comment">// ... 省略其他</span></span><br><span class="line">    <span class="attr">proxy</span>: &#123; </span><br><span class="line">      <span class="string">&quot;/api&quot;</span>: &#123; <span class="comment">// 以 &#x27;/api&#x27; 开头的请求，会跳转到下面的 target 配置</span></span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;http://192.168.30.33:8080&quot;</span>,</span><br><span class="line">        <span class="attr">pathRewrite</span>: &#123;</span><br><span class="line">          <span class="string">&quot;^api&quot;</span>: <span class="string">&quot;/mock/api&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后当我们请求 <code>/api/getuser</code> 接口，就会转发到 <code>http://192.168.30.33:8080/mock/api</code>。</p>
<h3 id="2-babel-转换及优化"><a href="#2-babel-转换及优化" class="headerlink" title="2. babel 转换及优化"></a>2. babel 转换及优化</h3><p><code>babel-loader</code> 插件的安装，已经提前介绍，在【十一、 webpack 配置合并和提取公共配置】中。</p>
<p>这里讲一下 <code>babel-loader</code> 的优化。</p>
<p><code>babel-loader</code> 可以配置 <code>cacheDirectory</code> 来提高打包效率：</p>
<ul>
<li><code>cacheDirectory</code>：默认值 <code>false</code>，开启后构建时会缓存文件夹，后续从缓存中读取，将提高打包效率。</li>
</ul>
<h2 id="十五、-webpack-开启-Eslint"><a href="#十五、-webpack-开启-Eslint" class="headerlink" title="十五、 webpack 开启 Eslint"></a>十五、 webpack 开启 Eslint</h2><p>安装插件：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install eslint eslint-loader --save-dev</span><br></pre></td></tr></table></figure>

<p>另外还需要安装 eslint 解释器、校验规则等：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install babel-loader standard --save-dev</span><br></pre></td></tr></table></figure>

<h3 id="2-添加-eslintrc-js"><a href="#2-添加-eslintrc-js" class="headerlink" title="2. 添加 .eslintrc.js"></a>2. 添加 .eslintrc.js</h3><p>在项目根目录创建 <code>.eslintrc.js</code>，指定 eslint 规则。</p>
<p>这份配置内容有点多，可以去 <a target="_blank" rel="noopener" href="https://gist.github.com/pingan8787/8b9abe4e04bed85f9d7846e513ed2e11">我的 gist 复制</a><a target="_blank" rel="noopener" href="https://gist.github.com/pingan8787/8b9abe4e04bed85f9d7846e513ed2e11">https://gist.github.com/pingan8787/8b9abe4e04bed85f9d7846e513ed2e11</a> 。</p>
<h3 id="3-添加-eslintignore"><a href="#3-添加-eslintignore" class="headerlink" title="3. 添加 .eslintignore"></a>3. 添加 .eslintignore</h3><p>在项目根目录创建 <code>.eslintignore</code>，指定 eslint 忽略一些文件不校验，比如内容可以是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/dist/</span><br><span class="line">/node_modules/</span><br></pre></td></tr></table></figure>

<h2 id="十六、-webpack-解析模块拓展名和别名"><a href="#十六、-webpack-解析模块拓展名和别名" class="headerlink" title="十六、 webpack 解析模块拓展名和别名"></a>十六、 webpack 解析模块拓展名和别名</h2><p>在 webpack 配置中，我们使用 <code>resolve</code> 来配置模块解析方式。</p>
<p>这是非常重要的，比如 <code>import _ from &#39;lodash&#39;</code> ，其实是加载解析了 <code>lodash.js</code> 文件。</p>
<p>该配置就是用来设置<strong>加载和解析</strong>的方式。</p>
<p>在解析过程中，我们可以进行配置：   </p>
<h3 id="1-resolve-alias"><a href="#1-resolve-alias" class="headerlink" title="1. resolve.alias"></a>1. resolve.alias</h3><p>当我们引入一些文件时，需要写很长的路径，这样使得代码更加复杂。</p>
<p>为此我们可以使用 <code>resolve.alias</code>，创建 <code>import</code> 或 <code>require</code> 的别名，使模块引入更加简单。</p>
<p>使用配置：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// webpack.common.js</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  entry: &#x27;./src/index.js&#x27;,</span><br><span class="line"><span class="addition">+ resolve: &#123;</span></span><br><span class="line"><span class="addition">+   alias: &#123;</span></span><br><span class="line"><span class="addition">+     &#x27;@&#x27; : path.resolve(__dirname, &#x27;src/&#x27;)</span></span><br><span class="line"><span class="addition">+   &#125;</span></span><br><span class="line"><span class="addition">+ &#125;</span></span><br><span class="line">  // 省略其他</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>alias</code> 参数的含义：</p>
<p>使用 <code>@</code> 来替代 <code>path.resolve(__dirname, &#39;src/&#39;)</code> 这个路径，接下来我们测试看看。</p>
<p>我们在 <code>src/</code> 目录下新增 <code>leo.js</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// leo.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> name = <span class="string">&#x27;pingan&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>再到 <code>src/index.js</code> 中引入：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; name &#125; <span class="keyword">from</span> <span class="string">&#x27;@/leo.js&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>这样就能正常引入。   </p>
<p>当然，我们也可以根据实际情况，<strong>为不同路径设置不同别名</strong>：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// webpack.common.js</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">alias: &#123;</span><br><span class="line">  &#x27;@&#x27; : path.resolve(__dirname, &#x27;src/&#x27;)</span><br><span class="line"><span class="addition">+ &#x27;assets&#x27; : path.resolve(__dirname, &#x27;src/assets/&#x27;)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>更多参数介绍，可访问中文官网的介绍:<br><a target="_blank" rel="noopener" href="https://www.webpackjs.com/configuration/resolve/">《resolve》</a></p>
</blockquote>
<h3 id="2-resolve-extensions"><a href="#2-resolve-extensions" class="headerlink" title="2. resolve.extensions"></a>2. resolve.extensions</h3><p><code>resolve.extensions</code> 用来自动解析确定的扩展，让我们在引入模块的时候，可以不用设置拓展名，默认值为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">extensions: [<span class="string">&quot;.js&quot;</span>, <span class="string">&quot;.json&quot;</span>]</span><br></pre></td></tr></table></figure>

<p>使用配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.common.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; name &#125; <span class="keyword">from</span> <span class="string">&#x27;@/leo&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="十七、-webpack-配置外部拓展"><a href="#十七、-webpack-配置外部拓展" class="headerlink" title="十七、 webpack 配置外部拓展"></a>十七、 webpack 配置外部拓展</h2><p>当我们使用 CDN 引入 <code>jquery</code> 时，我们并不想把它也打包到项目中，我们就可以配置 <code>externals</code> 外部拓展的选项，来将这些不需要打包的模块从输出的 bundle 中排除：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcss.com/jquery/3.4.1/jquery.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>配置 <code>externals</code>：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// webpack.common.js</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  // ... 省略其他</span><br><span class="line"><span class="addition">+ externals: &#123;</span></span><br><span class="line"><span class="addition">+   jquery: &#x27;jQuery&#x27;</span></span><br><span class="line"><span class="addition">+ &#125;,</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过上面配置，我们就不会把不需要打包的模块打包进来。并且下面代码正常运行：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">&#x27;jquery&#x27;</span>;</span><br><span class="line"></span><br><span class="line">$(<span class="string">&#x27;.leo&#x27;</span>).show();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>更多参数介绍，可访问中文官网的介绍:<br><a target="_blank" rel="noopener" href="https://www.webpackjs.com/configuration/externals/">《externals》</a></p>
</blockquote>
<h2 id="十八、-webpack-打包分析报表及优化总结"><a href="#十八、-webpack-打包分析报表及优化总结" class="headerlink" title="十八、 webpack 打包分析报表及优化总结"></a>十八、 webpack 打包分析报表及优化总结</h2><h3 id="1-生成报表"><a href="#1-生成报表" class="headerlink" title="1. 生成报表"></a>1. 生成报表</h3><p>这里我们使用 <code>webpack-bundle-analyzer</code> 插件，来对打包后的文件进行数据分析，从来找到项目优化的方向。</p>
<p><code>webpack-bundle-analyzer</code> 使用交互式可缩放树形图可视化 webpack 输出文件的大小。</p>
<p>安装插件：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack-bundle-analyzer --save-dev</span><br></pre></td></tr></table></figure>

<p>这个我们只有在<strong>开发环境</strong>中使用。</p>
<p>使用插件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.dev.js</span></span><br><span class="line"><span class="keyword">const</span> BundleAnalyzerPlugin = <span class="built_in">require</span>(<span class="string">&#x27;webpack-bundle-analyzer&#x27;</span>).BundleAnalyzerPlugin;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> BundleAnalyzerPlugin()</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置完成以后，我们执行 <code>npm run build</code> 打包，打包完成后，会自动打开一个数据报表分析的页面，地址是 <code>http://127.0.0.1:8888/</code>：</p>
<p><img src="http://images.pingan8787.com/webpack14.png" alt="webpack14"></p>
<p><code>webpack-bundle-analyzer</code> 将帮助我们：</p>
<ul>
<li>看清楚我们包内都包含什么模块；</li>
<li>准确看出每个模块的组成；</li>
<li>最后优化它！</li>
</ul>
<p>我们经常将报表中区域最大的模块进行优化！</p>
<h3 id="2-通过报表优化项目"><a href="#2-通过报表优化项目" class="headerlink" title="2. 通过报表优化项目"></a>2. 通过报表优化项目</h3><p><img src="http://images.pingan8787.com/webpack14.png" alt="webpack14"></p>
<p>我们可以看出，打包后的项目中 <code>lodash.js</code> 占了非常大的内存，我们就针对 <code>lodash.js</code> 进行优化。</p>
<p>我们将 <code>lodash.js</code> 改为 CDN 引入：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// index.html</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcss.com/lodash.js/4.17.15/lodash.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后去设置上一节讲到的 <code>externals</code>：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// webpack.common.js</span><br><span class="line"></span><br><span class="line">externals: &#123;</span><br><span class="line">  jquery: &#x27;jQuery&#x27;,</span><br><span class="line"><span class="addition">+ lodash: &#x27;_&#x27;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>再打包以后，可以看到 <code>lodash.js</code> 已经不在包里面了：</p>
<p><img src="http://images.pingan8787.com/webpack15.png" alt="webpack15"></p>
<p>并且打包后的文件，也能正常运行：</p>
<p><img src="http://images.pingan8787.com/webpack16.png" alt="webpack16"></p>
<blockquote>
<p>更多参数介绍，可访问中文官网的介绍:<br><a target="_blank" rel="noopener" href="https://github.com/webpack-contrib/webpack-bundle-analyzer">《webpack-bundle-analyzer》</a></p>
</blockquote>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><p><a target="_blank" rel="noopener" href="https://www.webpackjs.com/">《Webpack4 中文网》</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av41546218/?p=1">《2019最新Webpack4.0教程4.x 成仙之路》</a></p>
</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文是根据 <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av41546218/?p=1">《2019最新Webpack4.0教程4.x 成仙之路》</a> 学习总结下来的学习之路，适合入门，涉及范围较多，内容比较长，需要能静下心来学习。</p>
<p>内容如果有误，欢迎留言指点，我会及时修改。</p>
<p>本文代码最终托管在我的 github 上，<a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo-JavaScript/blob/master/Cute-Webpack/introduction/README.md">点击查看</a>(<a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo-JavaScript/blob/master/Cute-Webpack/introduction/README.md)%E3%80%82">https://github.com/pingan8787/Leo-JavaScript/blob/master/Cute-Webpack/introduction/README.md)。</a></p>
<p>希望自己的文章会对各位有所帮助，也欢迎各位大佬指点。 </p>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#x70;&#105;&#x6e;&#103;&#97;&#x6e;&#56;&#55;&#56;&#x37;&#x40;&#113;&#113;&#46;&#x63;&#111;&#109;">&#x70;&#105;&#x6e;&#103;&#97;&#x6e;&#56;&#55;&#56;&#x37;&#x40;&#113;&#113;&#46;&#x63;&#111;&#109;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>ES小册</td>
<td>js.pingan8787.com</td>
</tr>
</tbody></table>
<h2 id="微信公众号"><a href="#微信公众号" class="headerlink" title="微信公众号"></a>微信公众号</h2><p><img src="http://images.pingan8787.com/2019_07_12guild_page.png" alt="bg">  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/08/14/171-%E3%80%90Webpack%E3%80%91Webpack4%E5%85%A5%E9%97%A8%E6%89%8B%E5%86%8C%E2%80%94%E2%80%94%E5%85%B118%E7%AF%87/" data-id="ckts3ejzp00r24d9k9rx90ap9" data-title="171-【Webpack】Webpack4入门手册——共18篇" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Webpack/" rel="tag">Webpack</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-170-【CSS】CSS实现宽高等比自适应容器" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/08/07/170-%E3%80%90CSS%E3%80%91CSS%E5%AE%9E%E7%8E%B0%E5%AE%BD%E9%AB%98%E7%AD%89%E6%AF%94%E8%87%AA%E9%80%82%E5%BA%94%E5%AE%B9%E5%99%A8/" class="article-date">
  <time class="dt-published" datetime="2019-08-07T14:40:07.000Z" itemprop="datePublished">2019-08-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/08/07/170-%E3%80%90CSS%E3%80%91CSS%E5%AE%9E%E7%8E%B0%E5%AE%BD%E9%AB%98%E7%AD%89%E6%AF%94%E8%87%AA%E9%80%82%E5%BA%94%E5%AE%B9%E5%99%A8/">170-【CSS】CSS实现宽高等比自适应容器</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>在最近开发移动端页面，遇到这么一个情况：当页面宽度 100% 时，高度为宽度一半，并随手机宽度变化依然是一半。</p>
<p>于是我们就需要实现一个<strong>宽度自适应，高度为宽度一半的容器</strong>。</p>
<p><em>这里先以高度为宽度一半为例，也可以是其他任意比例</em>。</p>
<h3 id="一、思考如何实现"><a href="#一、思考如何实现" class="headerlink" title="一、思考如何实现"></a>一、思考如何实现</h3><p>这个问题类似于：我们在移动端页面，上面有一张宽度 100% 的图片，如果我们没设置高度，则图片会根据原有尺寸，等比缩放。</p>
<p>我们可以借助这个想法，根据元素高度，来为元素设置一个相应比例的高度即可。</p>
<h3 id="二、实现方法1-通过-vw-视口单位实现"><a href="#二、实现方法1-通过-vw-视口单位实现" class="headerlink" title="二、实现方法1 - 通过 vw 视口单位实现"></a>二、实现方法1 - 通过 vw 视口单位实现</h3><p>所谓<strong>视口单位</strong>(viewport units)是相对于视口(viewport)的尺寸而言，<code>100vw</code> 等于视口宽度的 <code>100%</code>，即 <code>1vw</code> 等于视口宽度的 <code>1%</code>。</p>
<p>我们就可以利用这个特性，实现移动端的宽高等比自适应容器。</p>
<p>HTML代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;http://images.pingan8787.com/2019_07_12guild_page.png&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>CSS代码：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">*&#123;</span><br><span class="line">    <span class="attribute">margin</span>:<span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>:<span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>:<span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>:<span class="number">51.5vw</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span> <span class="selector-tag">img</span>&#123; </span><br><span class="line">    <span class="attribute">width</span>:<span class="number">100%</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>为什么 <code>.box</code> 高度为 <code>51.5vw</code> 呢？</strong></li>
</ul>
<p>原因是图片原来的尺寸是 <code>884 * 455</code>的宽高比例，即 <code>455 / 884 = 51.5%</code>。</p>
<p>这个方法相比原来图片的等比缩放，有个优点：无论图片是否加载成功，容器高度始终是计算完成，不会造成页面抖动，也不会造成页面重绘，从而提升性能。</p>
<p>下面看看这种情况下，图片加载成功和失败的对比：</p>
<p><img src="http://images.pingan8787.com/20190807css01.png" alt="1"></p>
<h3 id="三、实现方法2-通过子元素-padding-实现"><a href="#三、实现方法2-通过子元素-padding-实现" class="headerlink" title="三、实现方法2 - 通过子元素 padding 实现"></a>三、实现方法2 - 通过子元素 padding 实现</h3><p>通过设置子元素的 <code>padding</code> 属性来实现，是比较常用，也是效果比较好的一种，这里需要理解的是：<strong>子元素的 <code>padding</code> 属性百分比的值是先对父容器的宽度而言</strong>。</p>
<p>这里看下面代码和效果图理解下：</p>
<p>HTML代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span>我是王平安，pingan8787<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>CSS代码：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.text</span>&#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">10%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://images.pingan8787.com/20190807css02.png" alt="2"></p>
<p><strong>分析：</strong></p>
<p>这里我们将父容器 <code>.box</code> 宽度设置为 <code>200px</code>，子元素 <code>.text</code> 的 <code>padding:10%</code> ，因此 <code>.box</code> 的 <code>padding</code> 计算结果为 <code>20px</code>;</p>
<p>接下来结合主题，我们利用这个原理，来实现等比例的问题：   </p>
<p>HTML代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;http://images.pingan8787.com/2019_07_12guild_page.png&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>CSS代码：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.text</span>&#123;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding-bottom</span>: <span class="number">51.5%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span> <span class="selector-class">.text</span> <span class="selector-tag">img</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里 <code>.text</code> 的 <code>padding-bottom: 51.5%;</code> 也是按照第一个方法，用图片原始尺寸的宽高比计算出来的，需要注意，这里将 <code>.text</code> 设置 <code>height: 0;</code> 会出现高度比实际高的问题，因此为了避免这个情况，就需要设置 <code>height: 0;</code>。</p>
<p>于是我们通过2种方法解决了这个问题。   </p>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#112;&#105;&#x6e;&#103;&#97;&#x6e;&#x38;&#55;&#56;&#x37;&#x40;&#113;&#113;&#x2e;&#99;&#x6f;&#109;">&#112;&#105;&#x6e;&#103;&#97;&#x6e;&#x38;&#55;&#56;&#x37;&#x40;&#113;&#113;&#x2e;&#99;&#x6f;&#109;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>ES小册</td>
<td>js.pingan8787.com</td>
</tr>
</tbody></table>
<h3 id="微信公众号"><a href="#微信公众号" class="headerlink" title="微信公众号"></a>微信公众号</h3><p><img src="http://images.pingan8787.com/2019_07_12guild_page.png" alt="bg">  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/08/07/170-%E3%80%90CSS%E3%80%91CSS%E5%AE%9E%E7%8E%B0%E5%AE%BD%E9%AB%98%E7%AD%89%E6%AF%94%E8%87%AA%E9%80%82%E5%BA%94%E5%AE%B9%E5%99%A8/" data-id="ckts3ejtm00484d9k95h48j3m" data-title="170-【CSS】CSS实现宽高等比自适应容器" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CSS/" rel="tag">CSS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-169-【CSS】解决canvas在高清屏中绘制模糊的问题" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/08/05/169-%E3%80%90CSS%E3%80%91%E8%A7%A3%E5%86%B3canvas%E5%9C%A8%E9%AB%98%E6%B8%85%E5%B1%8F%E4%B8%AD%E7%BB%98%E5%88%B6%E6%A8%A1%E7%B3%8A%E7%9A%84%E9%97%AE%E9%A2%98/" class="article-date">
  <time class="dt-published" datetime="2019-08-05T12:32:15.000Z" itemprop="datePublished">2019-08-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/08/05/169-%E3%80%90CSS%E3%80%91%E8%A7%A3%E5%86%B3canvas%E5%9C%A8%E9%AB%98%E6%B8%85%E5%B1%8F%E4%B8%AD%E7%BB%98%E5%88%B6%E6%A8%A1%E7%B3%8A%E7%9A%84%E9%97%AE%E9%A2%98/">169-【CSS】解决canvas在高清屏中绘制模糊的问题</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="一、问题分析"><a href="#一、问题分析" class="headerlink" title="一、问题分析"></a>一、问题分析</h3><p>使用 <code>canvas</code> 绘制图片或者是文字在 <strong>Retina</strong> 屏中会非常模糊。如图：</p>
<p><img src="http://images.pingan8787.com/20190805.png" alt="img"></p>
<p>因为 <code>canvas</code> 不是矢量图，而是像图片一样是位图模式的。高 <code>dpi</code> 显示设备意味着每平方英寸有更多的像素。也就是说二倍屏，浏览器就会<strong>以 2 个像素点的宽度来渲染一个像素</strong>，该 <code>canvas</code> 在 <strong>Retina</strong> 屏幕下相当于占据了2倍的空间，相当于图片被放大了一倍，因此绘制出来的图片文字等会变模糊。</p>
<p>因此，要做 <strong>Retina</strong> 屏适配，关键是知道当前屏幕的设备像素比，然后将 <code>canvas</code> 放大到该设备像素比来绘制，然后将 <code>canvas</code> 压缩到一倍来展示。</p>
<h3 id="二、解决思路"><a href="#二、解决思路" class="headerlink" title="二、解决思路"></a>二、解决思路</h3><p>在浏览器的 <code>window</code> 对象中有一个 <code>devicePixelRatio</code> 的属性，该属性表示了屏幕的设备像素比，即用几个（通常是 2 个）像素点宽度来渲染 1 个像素。</p>
<p>举例来说，假设 <code>devicePixelRatio</code> 的值为 2 ，一张 <code>100×100</code> 像素大小的图片，在 <strong>Retina</strong> 屏幕下，会用 2 个像素点的宽度去渲染图片的 1 个像素点，因此该图片在 Retina 屏幕上实际会占据 <code>200×200</code> 像素的空间，相当于图片被放大了一倍，因此图片会变得模糊。</p>
<p>类似的，在 <strong>canvas</strong> <code>context</code> 中也存在一个 <code>backingStorePixelRatio</code> 的属性，该属性的值决定了浏览器在渲染 <code>canvas</code> 之前会用几个像素来来存储画布信息。 <code>backingStorePixelRatio</code> 属性在各浏览器厂商的获取方式不一样，所以需要<strong>加上浏览器前缀来实现兼容</strong>。</p>
<h3 id="三、解决问题"><a href="#三、解决问题" class="headerlink" title="三、解决问题"></a>三、解决问题</h3><ol>
<li>首先一样，获取 <code>Canvas</code> 对象：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myCanvas = <span class="built_in">document</span>.getElementById(<span class="string">&quot;my_canvas&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> context = myCanvas.getContext(<span class="string">&quot;2d&quot;</span>);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>获取像素比，将 <code>Canvas</code> 宽高进行放大，放大比例为：<code>devicePixelRatio / webkitBackingStorePixelRatio</code> , 我们写了一个兼容的方法。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> getPixelRatio = <span class="function"><span class="keyword">function</span> (<span class="params">context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> backingStore = context.backingStorePixelRatio ||</span><br><span class="line">        context.webkitBackingStorePixelRatio ||</span><br><span class="line">        context.mozBackingStorePixelRatio ||</span><br><span class="line">        context.msBackingStorePixelRatio ||</span><br><span class="line">        context.oBackingStorePixelRatio ||</span><br><span class="line">        context.backingStorePixelRatio || <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">window</span>.devicePixelRatio || <span class="number">1</span>) / backingStore;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> ratio = getPixelRatio(context);</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>按实际渲染倍率来缩放 <code>canvas</code> 。</li>
</ol>
<p>注意基础知识点：</p>
<ul>
<li>要设置 <code>canvas</code> 的画布大小，使用的是<code>canvas.width</code>和 <code>canvas.height</code>；</li>
<li>要设置画布的实际渲染大小，使用的 <code>style</code> 属性或 <code>CSS</code> 设置的 <code>width</code> 和<code>height</code>，只是简单的对画布进行缩放。</li>
</ul>
<p>2倍屏幕下示例代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">width</span>=<span class="string">&quot;640&quot;</span> <span class="attr">height</span>=<span class="string">&quot;800&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:320px; height:400px&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>canvas</code> 的实际大小的<code> 640px × 800px</code>，但是实际渲染到页面的大小是 <code>320px × 400px</code>，相当于缩小一倍来显示。</p>
<p>那么在3倍屏幕下就是：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">width</span>=<span class="string">&quot;960&quot;</span> <span class="attr">height</span>=<span class="string">&quot;1200&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:320px; height:400px&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>因此，要使 <code>canvas</code> 适配高倍屏，就是要将 <code>canvas</code> 放大到设备像素比来绘制，最后将 <code>canvas</code> 压缩成一倍的物理大小来展示。如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">myCanvas.style.width = myCanvas.width + <span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">myCanvas.style.height = myCanvas.height + <span class="string">&#x27;px&#x27;</span>;</span><br><span class="line"> </span><br><span class="line">myCanvas.width = myCanvas.width * ratio;</span><br><span class="line">myCanvas.height = myCanvas.height * ratio;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>绘制</li>
</ol>
<p>由于 <code>Canvas</code> 放大后，相应的绘制图片时也要放大，有两种方式：</p>
<p><strong>第一种方法</strong>：每一个绘制相应的放大，比如我们绘制文字：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">context.font = <span class="string">&quot;36px Georgia&quot;</span>; <span class="comment">//一倍屏下18px字体</span></span><br><span class="line">context.fillStyle = <span class="string">&quot;#999&quot;</span>;</span><br><span class="line">context.fillText(<span class="string">&quot;我是清晰的文字&quot;</span>, <span class="number">50</span>*ratio, <span class="number">50</span>*ratio);<span class="comment">// 坐标位置乘以像素比</span></span><br></pre></td></tr></table></figure>

<p>相对来说这个方法非常繁琐麻烦。</p>
<p><strong>第二种方法</strong>：直接使用 <code>scale</code> 方法:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 放大倍数</span></span><br><span class="line">context.scale(ratio, ratio);</span><br><span class="line"> </span><br><span class="line">context.font = <span class="string">&quot;18px Georgia&quot;</span>;</span><br><span class="line">context.fillStyle = <span class="string">&quot;#999&quot;</span>;</span><br><span class="line">context.fillText(<span class="string">&quot;我是清晰的文字&quot;</span>, <span class="number">50</span>, <span class="number">50</span>);</span><br></pre></td></tr></table></figure>

<p>这样就可以解决 <code>canvas</code> 在高清屏中绘制模糊的问题。</p>
<p>完整的demo：<a target="_blank" rel="noopener" href="https://www.html.cn/demo/canvas_retina/index.html">https://www.html.cn/demo/canvas_retina/index.html</a></p>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#112;&#105;&#x6e;&#x67;&#97;&#110;&#56;&#x37;&#56;&#55;&#64;&#113;&#x71;&#46;&#x63;&#111;&#x6d;">&#112;&#105;&#x6e;&#x67;&#97;&#110;&#56;&#x37;&#56;&#55;&#64;&#113;&#x71;&#46;&#x63;&#111;&#x6d;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>ES小册</td>
<td>js.pingan8787.com</td>
</tr>
</tbody></table>
<h3 id="微信公众号"><a href="#微信公众号" class="headerlink" title="微信公众号"></a>微信公众号</h3><p><img src="http://images.pingan8787.com/2019_07_12guild_page.png" alt="bg">  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/08/05/169-%E3%80%90CSS%E3%80%91%E8%A7%A3%E5%86%B3canvas%E5%9C%A8%E9%AB%98%E6%B8%85%E5%B1%8F%E4%B8%AD%E7%BB%98%E5%88%B6%E6%A8%A1%E7%B3%8A%E7%9A%84%E9%97%AE%E9%A2%98/" data-id="ckts3ejtk00434d9kbbwh6oeu" data-title="169-【CSS】解决canvas在高清屏中绘制模糊的问题" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CSS/" rel="tag">CSS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-168-【JavaScript】正确使用sort方法" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/07/23/168-%E3%80%90JavaScript%E3%80%91%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A8sort%E6%96%B9%E6%B3%95/" class="article-date">
  <time class="dt-published" datetime="2019-07-23T14:40:37.000Z" itemprop="datePublished">2019-07-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/07/23/168-%E3%80%90JavaScript%E3%80%91%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A8sort%E6%96%B9%E6%B3%95/">168-【JavaScript】正确使用sort方法</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>英文原文： <a target="_blank" rel="noopener" href="https://www.todojs.com/usar-correctamente-el-metodo-sort/">《Usar correctamente el método sort()》</a><br>注意：内容有做精简和调整。</p>
</blockquote>
<p>在过去的几个星期里，我们在不同的团队中看到，一般来说都没有使用 <code>Array.prototype.sort()</code> 的习惯，并且不知道这种方法是如何工作的。今天我们将尝试简要描述它是如何工作的 <code>.sort()</code>，揭示它的一些秘密。</p>
<h3 id="1-修改原数组"><a href="#1-修改原数组" class="headerlink" title="1. 修改原数组"></a>1. 修改原数组</h3><p>在这种情况下，我们必须记住，此方法通过<strong>对数组进行排序来修改数组</strong>，<strong>返回相同的有序数组，但不返回新数组</strong>。如果我们想要保持数组不可变并获得另一个排序，这一点很重要，我们必须在排序之前制作数组的拷贝。</p>
<h3 id="2-字符串在-Unicode-代码中的位置比较"><a href="#2-字符串在-Unicode-代码中的位置比较" class="headerlink" title="2. 字符串在 Unicode 代码中的位置比较"></a>2. 字符串在 Unicode 代码中的位置比较</h3><p>默认情况下，<code>.sort()</code> 方法会根据 <code>Unicode</code> 代码中<strong>每个字母的位置</strong>将数组值排序为字符串，因此您可以对此数组进行排序而不会出现问题：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log([<span class="string">&quot;Zaragoza&quot;</span>, <span class="string">&quot;Madrid&quot;</span>, <span class="string">&quot;Barcelona&quot;</span>].sort());</span><br><span class="line"><span class="comment">// [ &#x27;Barcelona&#x27;, &#x27;Madrid&#x27;, &#x27;Zaragoza&#x27; ]</span></span><br></pre></td></tr></table></figure>

<p>这似乎是正确的，但是如果和一些名称<strong>以小写字母开头</strong>，那么排序似乎不正确：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log([<span class="string">&quot;Zaragoza&quot;</span>, <span class="string">&quot;madrid&quot;</span>, <span class="string">&quot;Barcelona&quot;</span>].sort());</span><br><span class="line"><span class="comment">// [ &#x27;Barcelona&#x27;, &#x27;Zaragoza&#x27;, &#x27;madrid&#x27; ]</span></span><br></pre></td></tr></table></figure>

<p>在这种情况下，排序是在 Unicode 代码表中的每个字母的位置之后完成的，并且 <code>m</code> 落后 <code>Z</code> ，因此它已经以这种方式排序。</p>
<p>如果我们想对<strong>数字排序</strong>，事情就会变得复杂起来:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log([<span class="number">80</span>, <span class="number">9</span>, <span class="number">100</span>].sort());</span><br><span class="line"><span class="comment">// [ 100, 80, 9 ]</span></span><br></pre></td></tr></table></figure>

<p>结果似乎很荒谬，但这是有道理的，发生的事情是<strong>数字已被转换为字符串</strong>，因此被比较的是字符串<code>&quot;100&quot;</code>，<code>&quot;80&quot;</code>并且<code>&quot;9&quot;</code>。由于它们在 Unicode 代码中的位置是按顺序的，因此排序是正确的，即使它不是我们最初的预期。</p>
<p>这些情况的产生导致一些人放弃使用 <code>.sort()</code> 产生混乱的行为。这有点草率，因为只需一点帮助，这种方法可以毫无问题地运行。</p>
<h3 id="3-Sort-方法参数"><a href="#3-Sort-方法参数" class="headerlink" title="3. Sort() 方法参数"></a>3. Sort() 方法参数</h3><p>该 <code>.sort()</code> 有<strong>一个可选参数</strong>，<strong>允许此方法帮助对内容进行排序</strong>。这是此方法的关键，因为我们对每种情况都感兴趣。</p>
<p>此函数接收<strong>两个要比较的值</strong>，因此也会有这么三种情况：</p>
<ul>
<li>如果第一个值大于第二个值，则返回<strong>正值</strong> (<code>1</code>);</li>
<li>如果第一个值小于第二个值，则返回<strong>负值</strong> (<code>-1)</code>;</li>
<li>如果两个值相等或等效于排序，则返回<strong>零值</strong> (<code>0</code>);</li>
</ul>
<p>这个函数由 <code>Javascript</code> 调用，只要您需要对数组中的元素进行排序，我们就可以进行必要的<strong>比较和</strong>调整。例如，为了比较数字，我们可以使用类似方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log([<span class="number">80</span>, <span class="number">9</span>, <span class="number">100</span>].sort(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a - b));</span><br><span class="line"><span class="comment">// [ 9, 80, 100 ]</span></span><br></pre></td></tr></table></figure>

<p>另外，<code>(a, b) =&gt; a – b</code> 还可以这么使用：使用其中一个值 <code>a</code> 去判断是否大于另一个值 <code>b</code> 来返回排序结果：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = [ <span class="string">&quot;Zaragoza&quot;</span>, <span class="string">&quot;madrid&quot;</span>, <span class="string">&quot;Barcelona&quot;</span> ];</span><br><span class="line">data.sort (<span class="function">(<span class="params">a, b</span>) =&gt;</span> a.toLowerCase () &gt; b.toLowerCase ());</span><br><span class="line"><span class="built_in">console</span>.log (data);</span><br><span class="line"><span class="comment">// [ &#x27;Zaragoza&#x27;, &#x27;madrid&#x27;, &#x27;Barcelona&#x27; ]</span></span><br></pre></td></tr></table></figure>

<p>显然结果不正确，因为我们草率的将函数比较的结果 <code>true</code> 或者 <code>false</code> 返回，我们必须记住支持**函数 <code>.sort()</code> 希望我们返回 <code>-1</code> ， <code>1</code> 或者 <code>0</code>**。为了使它正常运行，我们必须做修改：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = [ <span class="string">&quot;Zaragoza&quot;</span>, <span class="string">&quot;madrid&quot;</span>, <span class="string">&quot;Barcelona&quot;</span> ];</span><br><span class="line">data.sort (<span class="function">(<span class="params">a, b</span>) =&gt;</span></span><br><span class="line">  a.toLowerCase() &gt; b.toLowerCase() ? <span class="number">1</span> :</span><br><span class="line">  a.toLowerCase() &lt; b.toLowerCase() ? -<span class="number">1</span>:</span><br><span class="line">  <span class="number">0</span></span><br><span class="line">);</span><br><span class="line"><span class="built_in">console</span>.log (data);</span><br><span class="line"><span class="comment">// [ &#x27;Barcelona&#x27;, &#x27;madrid&#x27;, &#x27;Zaragoza&#x27; ]</span></span><br></pre></td></tr></table></figure>

<p><strong>现在的结果是我们需要的</strong>，因为我们已经对小写和大写也进行了比较，并且我们已经返回<code>-1</code>，<code>1</code>或者<code>0</code>根据每种情况。   </p>
<p>我们还没有真正完成，因为如果我们<strong>加入一些重音字母</strong>，我们会得到一个不希望的结果：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = [ <span class="string">&quot;Zaragoza&quot;</span>, <span class="string">&quot;madrid&quot;</span>, <span class="string">&quot;Barcelona&quot;</span>, <span class="string">&quot;Ávila&quot;</span> ];</span><br><span class="line"></span><br><span class="line">data.sort (<span class="function">(<span class="params">a, b</span>) =&gt;</span></span><br><span class="line">  a.toLowerCase() &gt; b.toLowerCase() ? <span class="number">1</span> :</span><br><span class="line">  a.toLowerCase() &lt; b.toLowerCase() ? -<span class="number">1</span>:</span><br><span class="line">  <span class="number">0</span></span><br><span class="line">);</span><br><span class="line"><span class="built_in">console</span>.log (data);</span><br><span class="line"><span class="comment">// [ &#x27;Barcelona&#x27;, &#x27;madrid&#x27;, &#x27;Zaragoza&#x27;, &#x27;Ávila&#x27; ]</span></span><br></pre></td></tr></table></figure>

<p>当我们想对文本字符串进行排序，就非常有必要使用 <code>.localeCompare()</code> 方法，也是非常重要。   </p>
<h3 id="4-用对象属性排序数组"><a href="#4-用对象属性排序数组" class="headerlink" title="4. 用对象属性排序数组"></a>4. 用对象属性排序数组</h3><p>通常，如果数组包含对象，我们可以使用对象的属性进行比较，例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = <span class="built_in">require</span> (<span class="string">&#x27;./municipios.json&#x27;</span>);</span><br><span class="line">data.sort (<span class="function">(<span class="params">a, b</span>) =&gt;</span> a.municipio.localeCompare (b.municipio));</span><br></pre></td></tr></table></figure>

<p>我们可以对数据结构中的日期和任何其他类型的对象执行相同的操作。</p>
<h3 id="5-关于性能方面"><a href="#5-关于性能方面" class="headerlink" title="5. 关于性能方面"></a>5. 关于性能方面</h3><p>如果我们想对<strong>非常大的数组</strong>进行排序，我们必须记住。<code>sort()</code> 方法的<strong>支持函数将被多次调用</strong>，我们必须<strong>避免在这个函数中执行许多操作或非常重的操作</strong>。我们必须尽可能有效地进行比较。</p>
<p>例如，在非常大的数组中，可以使用新的方法 <code>Int.Collate().compare</code> 来获得更有效的排序函数，而不是使用 <code>.localecompare()</code>。<code>Int</code> 对象是名为 <code>International API</code> ，也是 <code>ECMA-402</code> 的标准的一部分，</p>
<p>该标准侧重于<strong>国际化功能</strong>，包括<strong>每种语言的正确排序</strong>。<code>Int</code> 在浏览器和节点中以全局对象的形式呈现，并具有广泛的支持(包括<strong>IE11</strong>)。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data    = [ <span class="string">&quot;Zaragoza&quot;</span>, <span class="string">&quot;Ávila&quot;</span>, <span class="string">&quot;madrid&quot;</span>, <span class="string">&quot;Barcelona&quot;</span> ];</span><br><span class="line"><span class="keyword">const</span> compare = <span class="keyword">new</span> <span class="built_in">Intl</span>.Collator ().compare;</span><br><span class="line">data.sort (compare);</span><br><span class="line"><span class="built_in">console</span>.log (data);</span><br><span class="line"><span class="comment">// [ &#x27;Ávila&#x27;, &#x27;Barcelona&#x27;, &#x27;madrid&#x27;, &#x27;Zaragoza&#x27; ]</span></span><br></pre></td></tr></table></figure>

<p>排序操作很复杂，性能也很差，因此对于非常大的数组，排序方法支持函数速度的任何改进都将对性能产生非常显著的影响。</p>
<h3 id="6-总结"><a href="#6-总结" class="headerlink" title="6. 总结"></a>6. 总结</h3><p>一般来说，我们应该利用 <code>.sort()</code> 功能和一个支持函数来控制排序应该如何执行：</p>
<ul>
<li>数字： <code>(a, b) =&gt; a – b</code></li>
<li>链式： <code>(a, b) =&gt; a.localeCompare(b)</code></li>
</ul>
<p>在没有函数参数的情况下使用 <code>.sort()</code> 是没有意义的，也许在少数情况下是这样，但是如果我们用一个<strong>简单的函数</strong>支持它，那么 <code>.sort</code> 是一个非常有用的工具。</p>
<p><strong>在许多情况下，排序是一个基本的操作，我们不应该放弃在Javascript中进行这种排序。</strong></p>
<h3 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h3><blockquote>
<p>本文首发在 <a target="_blank" rel="noopener" href="http://www.pingan8787.com/">pingan8787个人博客</a>，如需转载请保留个人介绍。</p>
</blockquote>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#112;&#x69;&#110;&#103;&#97;&#110;&#x38;&#55;&#56;&#55;&#64;&#x71;&#x71;&#x2e;&#99;&#111;&#x6d;">&#112;&#x69;&#110;&#103;&#97;&#110;&#x38;&#55;&#56;&#55;&#64;&#x71;&#x71;&#x2e;&#99;&#111;&#x6d;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>ES小册</td>
<td>js.pingan8787.com</td>
</tr>
</tbody></table>
<h3 id="微信公众号"><a href="#微信公众号" class="headerlink" title="微信公众号"></a>微信公众号</h3><p><img src="http://images.pingan8787.com/2019_07_12guild_page.png" alt="bg">  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/07/23/168-%E3%80%90JavaScript%E3%80%91%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A8sort%E6%96%B9%E6%B3%95/" data-id="ckts3ejtj00404d9k7cnpesrw" data-title="168-【JavaScript】正确使用sort方法" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/5/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><a class="extend next" rel="next" href="/page/7/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Angular/" rel="tag">Angular</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/" rel="tag">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS%E5%8A%A8%E7%94%BB/" rel="tag">CSS动画</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Chrome/" rel="tag">Chrome</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES6-ES7-ES8/" rel="tag">ES6/ES7/ES8</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Eslint/" rel="tag">Eslint</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Express/" rel="tag">Express</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GraphQL/" rel="tag">GraphQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/H5/" rel="tag">H5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML/" rel="tag">HTML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/" rel="tag">HTTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP%E5%8D%8F%E8%AE%AE/" rel="tag">HTTP协议</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hybrid/" rel="tag">Hybrid</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NPM/" rel="tag">NPM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nodejs/" rel="tag">Nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Numpy/" rel="tag">Numpy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/" rel="tag">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tensorflow/" rel="tag">Tensorflow</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TyeScript/" rel="tag">TyeScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TypeScript/" rel="tag">TypeScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vuejs/" rel="tag">Vuejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebSocket/" rel="tag">WebSocket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Webpack/" rel="tag">Webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/demo/" rel="tag">demo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" rel="tag">中间件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" rel="tag">人工智能</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/" rel="tag">全栈开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E6%8E%A2%E7%B4%A2/" rel="tag">前端探索</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E7%9F%A5%E4%B9%8E%E7%B3%BB%E5%88%97/" rel="tag">前端知乎系列</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B8%B8%E7%94%A8%E6%8A%80%E6%9C%AF/" rel="tag">常用技术</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BE%AE%E5%89%8D%E7%AB%AF/" rel="tag">微前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%BB%E7%BB%93/" rel="tag">总结</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/" rel="tag">构建工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" rel="tag">正则表达式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BA%90%E7%A0%81/" rel="tag">源码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BA%90%E7%A0%81%E7%B2%BE%E8%AF%BB/" rel="tag">源码精读</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%83%AD%E9%97%A8/" rel="tag">热门</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%94%9F%E6%B4%BB%E6%9D%82%E8%AE%B0/" rel="tag">生活杂记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/" rel="tag">编译原理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/" rel="tag">网络请求</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag">读书笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%87%8D%E6%B8%A9%E5%9F%BA%E7%A1%80/" rel="tag">重温基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" rel="tag">面试题</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Angular/" style="font-size: 11.88px;">Angular</a> <a href="/tags/CSS/" style="font-size: 18.13px;">CSS</a> <a href="/tags/CSS%E5%8A%A8%E7%94%BB/" style="font-size: 12.5px;">CSS动画</a> <a href="/tags/Chrome/" style="font-size: 10px;">Chrome</a> <a href="/tags/ES6-ES7-ES8/" style="font-size: 10.63px;">ES6/ES7/ES8</a> <a href="/tags/Eslint/" style="font-size: 10px;">Eslint</a> <a href="/tags/Express/" style="font-size: 10px;">Express</a> <a href="/tags/GraphQL/" style="font-size: 10px;">GraphQL</a> <a href="/tags/H5/" style="font-size: 10px;">H5</a> <a href="/tags/HTML/" style="font-size: 10px;">HTML</a> <a href="/tags/HTTP/" style="font-size: 11.88px;">HTTP</a> <a href="/tags/HTTP%E5%8D%8F%E8%AE%AE/" style="font-size: 11.25px;">HTTP协议</a> <a href="/tags/Hybrid/" style="font-size: 10.63px;">Hybrid</a> <a href="/tags/JavaScript/" style="font-size: 19.38px;">JavaScript</a> <a href="/tags/NPM/" style="font-size: 10px;">NPM</a> <a href="/tags/Nodejs/" style="font-size: 11.25px;">Nodejs</a> <a href="/tags/Numpy/" style="font-size: 10.63px;">Numpy</a> <a href="/tags/Python/" style="font-size: 17.5px;">Python</a> <a href="/tags/React/" style="font-size: 12.5px;">React</a> <a href="/tags/Tensorflow/" style="font-size: 10.63px;">Tensorflow</a> <a href="/tags/TyeScript/" style="font-size: 10px;">TyeScript</a> <a href="/tags/TypeScript/" style="font-size: 11.25px;">TypeScript</a> <a href="/tags/Vuejs/" style="font-size: 14.38px;">Vuejs</a> <a href="/tags/WebSocket/" style="font-size: 10px;">WebSocket</a> <a href="/tags/Webpack/" style="font-size: 15.63px;">Webpack</a> <a href="/tags/demo/" style="font-size: 10.63px;">demo</a> <a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 10px;">中间件</a> <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" style="font-size: 16.25px;">人工智能</a> <a href="/tags/%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/" style="font-size: 11.25px;">全栈开发</a> <a href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" style="font-size: 20px;">前端开发</a> <a href="/tags/%E5%89%8D%E7%AB%AF%E6%8E%A2%E7%B4%A2/" style="font-size: 11.25px;">前端探索</a> <a href="/tags/%E5%89%8D%E7%AB%AF%E7%9F%A5%E4%B9%8E%E7%B3%BB%E5%88%97/" style="font-size: 10.63px;">前端知乎系列</a> <a href="/tags/%E5%8E%9F%E5%88%9B/" style="font-size: 18.75px;">原创</a> <a href="/tags/%E5%B8%B8%E7%94%A8%E6%8A%80%E6%9C%AF/" style="font-size: 10.63px;">常用技术</a> <a href="/tags/%E5%BE%AE%E5%89%8D%E7%AB%AF/" style="font-size: 10px;">微前端</a> <a href="/tags/%E6%80%BB%E7%BB%93/" style="font-size: 13.75px;">总结</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 10px;">数据结构</a> <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" style="font-size: 15px;">机器学习</a> <a href="/tags/%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/" style="font-size: 10.63px;">构建工具</a> <a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 10.63px;">正则表达式</a> <a href="/tags/%E6%BA%90%E7%A0%81/" style="font-size: 10px;">源码</a> <a href="/tags/%E6%BA%90%E7%A0%81%E7%B2%BE%E8%AF%BB/" style="font-size: 10px;">源码精读</a> <a href="/tags/%E7%83%AD%E9%97%A8/" style="font-size: 10px;">热门</a> <a href="/tags/%E7%94%9F%E6%B4%BB%E6%9D%82%E8%AE%B0/" style="font-size: 10px;">生活杂记</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 13.13px;">算法</a> <a href="/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/" style="font-size: 10px;">编译原理</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/" style="font-size: 10px;">网络请求</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 15px;">设计模式</a> <a href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" style="font-size: 14.38px;">读书笔记</a> <a href="/tags/%E9%87%8D%E6%B8%A9%E5%9F%BA%E7%A1%80/" style="font-size: 16.88px;">重温基础</a> <a href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" style="font-size: 10px;">面试题</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/07/28/227-%E3%80%90%E6%80%BB%E7%BB%93%E3%80%91%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E5%9C%A8%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%BD%BF%E7%94%A8SVG%E5%AD%97%E4%BD%93%E5%9B%BE%E6%A0%87/">227-【总结】如何优雅的在微信小程序使用SVG字体图标</a>
          </li>
        
          <li>
            <a href="/2021/07/28/226-%E3%80%90HTTP%E3%80%91%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E7%AE%A1%E7%90%86HTTP%E8%AF%B7%E6%B1%82%E5%92%8C%E5%93%8D%E5%BA%94%E6%8B%A6%E6%88%AA%E5%99%A8%EF%BC%9F/">226-【HTTP】如何优雅的管理HTTP请求和响应拦截器？</a>
          </li>
        
          <li>
            <a href="/2021/07/28/225-%E3%80%90Vue%E3%80%91%E4%BB%8E%E6%89%8B%E5%86%99Vue3%E7%9A%84Reactivity%E5%BC%80%E5%A7%8B%E6%B7%B1%E5%85%A5Vue3%E6%BA%90%E7%A0%81/">225-【Vue】从手写Vue3的Reactivity开始深入Vue3源码</a>
          </li>
        
          <li>
            <a href="/2021/05/30/224-%E3%80%90Chrome%E3%80%915%E4%B8%AAChrome%E8%B0%83%E8%AF%95%E6%B7%B7%E5%90%88%E5%BA%94%E7%94%A8%E7%9A%84%E6%8A%80%E5%B7%A7/">224-【Chrome】5个Chrome调试混合应用的技巧</a>
          </li>
        
          <li>
            <a href="/2021/03/19/223-%E3%80%90%E5%89%8D%E7%AB%AF%E6%8E%A2%E7%B4%A2%E3%80%91%E6%8E%A2%E7%B4%A2Snabbdom%E6%A8%A1%E5%9D%97%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/">223-【前端探索】探索Snabbdom模块系统原理</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>