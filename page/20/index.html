<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/20/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-38-【JavaScript】JavaScript异步机制详解" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/01/28/38-%E3%80%90JavaScript%E3%80%91JavaScript%E5%BC%82%E6%AD%A5%E6%9C%BA%E5%88%B6%E8%AF%A6%E8%A7%A3/" class="article-date">
  <time class="dt-published" datetime="2018-01-28T11:44:51.000Z" itemprop="datePublished">2018-01-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/01/28/38-%E3%80%90JavaScript%E3%80%91JavaScript%E5%BC%82%E6%AD%A5%E6%9C%BA%E5%88%B6%E8%AF%A6%E8%A7%A3/">38-【JavaScript】JavaScript异步机制详解</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p><a target="_blank" rel="noopener" href="https://juejin.im/post/5a6ad46ef265da3e513352c8">原文地址</a>   </p>
</blockquote>
<blockquote>
<p>学习JavaScript的时候了解到JavaScript是单线程的，刚开始很疑惑，单线程怎么处理网络请求、文件读写等耗时操作呢？效率岂不是会很低？随着对这方面内容的了解和深入，知道了其中的奥秘。本篇文章就主要讲解一下JavaScript怎么处理异步问题。</p>
</blockquote>
<h2 id="一、同步与异步"><a href="#一、同步与异步" class="headerlink" title="一、同步与异步"></a>一、同步与异步</h2><p>在介绍JavaScript的异步机制之前，首先介绍一下：什么是同步？什么是异步？<br><img src="https://user-gold-cdn.xitu.io/2018/1/26/161314dc9a9298f4?imageView2/0/w/1280/h/960/ignore-error/1" alt="Synchronous/Asynchronous">  </p>
<h3 id="同步"><a href="#同步" class="headerlink" title="同步"></a>同步</h3><p>如果在函数返回的时候，调用者就能够得到预期结果(即拿到了预期的返回值或者看到了预期的效果)，那么这个函数就是同步的。<br>如下所示：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在函数返回时，获得了预期值，即2的平方根</span></span><br><span class="line"><span class="built_in">Math</span>.sqrt(<span class="number">2</span>);</span><br><span class="line"><span class="comment">//在函数返回时，获得了预期的效果，即在控制台上打印了&#x27;hello&#x27;</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;hello&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>上面两个函数就是同步的。<br><strong>如果函数是同步的，即使调用函数执行的任务比较耗时，也会一直等待直到得到预期结果。</strong></p>
<h2 id="异步"><a href="#异步" class="headerlink" title="异步"></a>异步</h2><p>如果在函数返回的时候，调用者还不能够得到预期结果，而是需要在将来通过一定的手段得到，那么这个函数就是异步的。<br>如下所示：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//读取文件</span></span><br><span class="line">fs.readFile(<span class="string">&#x27;hello.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//网络请求</span></span><br><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">xhr.onreadystatechange = xxx; <span class="comment">// 添加回调函数</span></span><br><span class="line">xhr.open(<span class="string">&#x27;GET&#x27;</span>, url);</span><br><span class="line">xhr.send(); <span class="comment">// 发起函数</span></span><br></pre></td></tr></table></figure>
<p>上述示例中读取文件函数 <code>readFile</code>和网络请求的发起函数  <code>send</code>都将执行耗时操作，虽然函数会立即返回，但是不能立刻获取预期的结果，因为耗时操作交给其他线程执行，暂时获取不到预期结果（后面介绍）。而在<code>JavaScript</code>中通过回调函数 <code>function(err, data) &#123; console.log(data); &#125;</code>和 <code>onreadystatechange</code>   ，在耗时操作执行完成后把相应的结果信息传递给回调函数，通知执行<code>JavaScript</code>代码的线程执行回调。<br><strong>如果函数是异步的，发出调用之后，马上返回，但是不会马上返回预期结果。调用者不必主动等待，当被调用者得到结果之后会通过回调函数主动通知调用者。</strong></p>
<h2 id="二、单线程与多线程"><a href="#二、单线程与多线程" class="headerlink" title="二、单线程与多线程"></a>二、单线程与多线程</h2><p><img src="https://user-gold-cdn.xitu.io/2018/1/26/161314dc9b08b2b1?imageView2/0/w/1280/h/960/ignore-error/1" alt="单线程与多线程">  </p>
<p>在上面介绍异步的过程中就可能会纳闷：既然JavaScript是单线程，怎么还存在异步，那些耗时操作到底交给谁去执行了？<br>JavaScript其实就是一门语言，说是单线程还是多线程得结合具体运行环境。JS的运行通常是在浏览器中进行的，具体由JS引擎去解析和运行。下面我们来具体了解一下浏览器。  </p>
<h3 id="浏览器"><a href="#浏览器" class="headerlink" title="浏览器"></a>浏览器</h3><p>目前最为流行的浏览器为：Chrome，IE，Safari，FireFox，Opera。浏览器的内核是多线程的。<br>一个浏览器通常由以下几个常驻的线程：   </p>
<ul>
<li>渲染引擎线程：顾名思义，该线程负责页面的渲染</li>
<li>JS引擎线程：负责JS的解析和执行</li>
<li>定时触发器线程：处理定时事件，比如setTimeout, setInterval</li>
<li>事件触发线程：处理DOM事件</li>
<li>异步http请求线程：处理http请求</li>
</ul>
<p>需要注意的是，渲染线程和JS引擎线程是不能同时进行的。渲染线程在执行任务的时候，JS引擎线程会被挂起。因为JS可以操作DOM，若在渲染中JS处理了DOM，浏览器可能就不知所措了。  </p>
<h3 id="JS引擎"><a href="#JS引擎" class="headerlink" title="JS引擎"></a>JS引擎</h3><p>通常讲到浏览器的时候，我们会说到两个引擎：渲染引擎和JS引擎。渲染引擎就是如何渲染页面，Chrome／Safari／Opera用的是Webkit引擎，IE用的是Trident引擎，FireFox用的是Gecko引擎。不同的引擎对同一个样式的实现不一致，就导致了经常被人诟病的浏览器样式兼容性问题。这里我们不做具体讨论。<br>JS引擎可以说是JS虚拟机，负责JS代码的解析和执行。通常包括以下几个步骤：  </p>
<ul>
<li>词法分析：将源代码分解为有意义的分词</li>
<li>语法分析：用语法分析器将分词解析成语法树</li>
<li>代码生成：生成机器能运行的代码</li>
<li>代码执行</li>
</ul>
<p>不同浏览器的JS引擎也各不相同，Chrome用的是V8，FireFox用的是SpiderMonkey，Safari用的是JavaScriptCore，IE用的是Chakra。<br>之所以说JavaScript是单线程，就是因为浏览器在运行时只开启了一个JS引擎线程来解析和执行JS。那为什么只有一个引擎呢？如果同时有两个线程去操作DOM，浏览器是不是又要不知所措了。<br>所以，虽然JavaScript是单线程的，可是浏览器内部不是单线程的。一些I/O操作、定时器的计时和事件监听（click, keydown…）等都是由浏览器提供的其他线程来完成的。  </p>
<h2 id="三、消息队列与事件循环"><a href="#三、消息队列与事件循环" class="headerlink" title="三、消息队列与事件循环"></a>三、消息队列与事件循环</h2><p>通过以上了解，可以知道其实JavaScript也是通过JS引擎线程与浏览器中其他线程交互协作实现异步。但是回调函数具体何时加入到JS引擎线程中执行？执行顺序是怎么样的？<br>这一切的解释就需要继续了解消息队列和事件循环。<br><img src="https://user-gold-cdn.xitu.io/2018/1/26/161314dca3a23ba4?imageView2/0/w/1280/h/960/ignore-error/1"><br>如上图所示，左边的栈存储的是同步任务，就是那些能立即执行、不耗时的任务，如变量和函数的初始化、事件的绑定等等那些不需要回调函数的操作都可归为这一类。<br>右边的堆用来存储声明的变量、对象。下面的队列就是消息队列，一旦某个异步任务有了响应就会被推入队列中。如用户的点击事件、浏览器收到服务的响应和setTimeout中待执行的事件，每个异步任务都和回调函数相关联。<br>JS引擎线程用来执行栈中的同步任务，当所有同步任务执行完毕后，栈被清空，然后读取消息队列中的一个待处理任务，并把相关回调函数压入栈中，单线程开始执行新的同步任务。<br>JS引擎线程从消息队列中读取任务是不断循环的，每次栈被清空后，都会在消息队列中读取新的任务，如果没有新的任务，就会等待，直到有新的任务，这就叫事件循环。<br><img src="https://user-gold-cdn.xitu.io/2018/1/26/161314dcb17a84ad?imageView2/0/w/1280/h/960/ignore-error/1" alt="ajax异步请求"><br>上图以AJAX异步请求为例，发起异步任务后，由AJAX线程执行耗时的异步操作，而JS引擎线程继续执行堆中的其他同  步任务，直到堆中的所有异步任务执行完毕。然后，从消息队列中依次按照顺序取出消息作为一个同步任务在JS引擎线程中执行，那么AJAX的回调函数就会在某一时刻被调用执行。</p>
<h2 id="四、示例"><a href="#四、示例" class="headerlink" title="四、示例"></a>四、示例</h2><p>引用一篇文章中提到的考察JavaScript异步机制的面试题来具体介绍。  </p>
<blockquote>
<p>执行下面这段代码，执行后，在 5s 内点击两下，过一段时间（&gt;5s）后，再点击两下，整个过程的输出结果是什么？</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">100000000</span>; i++)&#123;&#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;timer a&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; <span class="number">5</span>; j++)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(j);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;timer b&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waitFiveSeconds</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> now = (<span class="keyword">new</span> <span class="built_in">Date</span>()).getTime();</span><br><span class="line">    <span class="keyword">while</span>(((<span class="keyword">new</span> <span class="built_in">Date</span>()).getTime() - now) &lt; <span class="number">5000</span>)&#123;&#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;finished waiting&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;click&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;click begin&#x27;</span>);</span><br><span class="line">waitFiveSeconds();</span><br></pre></td></tr></table></figure>

<p>要想了解上述代码的输出结果，首先介绍下定时器。<br><code>setTimeout</code>的作用是在间隔一定的时间后，将回调函数插入消息队列中，等栈中的同步任务都执行完毕后，再执行。因为栈中的同步任务也会耗时，<strong>所以间隔的时间一般会大于等于指定的时间</strong>。<br><code>setTimeout(fn, 0)</code>的意思是，将回调函数fn立刻插入消息队列，等待执行，而不是立即执行。看一个例子：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;a&quot;</span>)</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>; i&lt;<span class="number">10000</span>; i++) &#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;b&quot;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b  a</span><br></pre></td></tr></table></figure>
<p>打印结果表明回调函数并没有立刻执行，而是等待栈中的任务执行完毕后才执行的。栈中的任务执行多久，它就得等多久。<br>理解了定时器的作用，那么对于输出结果就容易得出了。<br>首先，先执行同步任务。其中<code>waitFiveSeconds</code>是耗时操作，持续执行长达5s。   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line">click begin</span><br><span class="line">finished waiting</span><br></pre></td></tr></table></figure>
<p>然后，在JS引擎线程执行的时候，<code>&#39;timer a&#39;</code>对应的定时器产生的回调、 <code>&#39;timer b&#39;</code>对应的定时器产生的回调和两次 <code>click</code> 对应的回调被先后放入消息队列。由于JS引擎线程空闲后，会<strong>先查看是否有事件可执行</strong>，接着再处理其他异步任务。因此会产生 下面的输出顺序。  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">click</span><br><span class="line">click</span><br><span class="line">timer a</span><br><span class="line">timer b</span><br></pre></td></tr></table></figure>
<p>最后，5s 后的两次 click 事件被放入消息队列，由于此时JS引擎线程空闲，便被立即执行了。  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">click</span><br><span class="line">click</span><br></pre></td></tr></table></figure>

<h2 id="五、参考文章"><a href="#五、参考文章" class="headerlink" title="五、参考文章"></a>五、参考文章</h2><p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000004322358">JavaScript：彻底理解同步、异步和事件循环(Event Loop)</a><br><a target="_blank" rel="noopener" href="http://www.alloyteam.com/2015/10/turning-to-javascript-series-from-settimeout-said-the-event-loop-model/">从setTimeout说事件循环模型</a><br><a target="_blank" rel="noopener" href="https://github.com/pramper/Blog/issues/4">JavaScript单线程和异步机制</a><br><a target="_blank" rel="noopener" href="https://github.com/huangtengfei/blog/issues/15">JavaScript的单线程机制</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/27035708">JavaScript单线程异步的背后——事件循环机制</a><br><a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2014/10/event-loop.html">JavaScript 运行机制详解：再谈Event Loop</a>  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/01/28/38-%E3%80%90JavaScript%E3%80%91JavaScript%E5%BC%82%E6%AD%A5%E6%9C%BA%E5%88%B6%E8%AF%A6%E8%A7%A3/" data-id="ckts3ejuq007j4d9k7b4vdigy" data-title="38-【JavaScript】JavaScript异步机制详解" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-37-【Vuejs】Vuex复习资料" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/01/25/37-%E3%80%90Vuejs%E3%80%91Vuex%E5%A4%8D%E4%B9%A0%E8%B5%84%E6%96%99/" class="article-date">
  <time class="dt-published" datetime="2018-01-25T14:48:09.000Z" itemprop="datePublished">2018-01-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/01/25/37-%E3%80%90Vuejs%E3%80%91Vuex%E5%A4%8D%E4%B9%A0%E8%B5%84%E6%96%99/">37-【Vuejs】Vuex复习资料</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>个人整理的demo ， 欢迎stat <a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Vuejs/tree/master/2-demo/demo%20-%20Vuex/gankdemo">打开链接</a></p>
</blockquote>
<h1 id="Vuex核心概念整理"><a href="#Vuex核心概念整理" class="headerlink" title="Vuex核心概念整理"></a>Vuex核心概念整理</h1><h2 id="1、安装和使用"><a href="#1、安装和使用" class="headerlink" title="1、安装和使用"></a>1、安装和使用</h2><p>npm安装：  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install vuex --save</span><br></pre></td></tr></table></figure>

<p>使用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&quot;vuex&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">    <span class="attr">state</span> : &#123;</span><br><span class="line">        <span class="attr">name</span>:<span class="string">&#x27;leo&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mutations</span>:&#123;...&#125;,</span><br><span class="line">    <span class="attr">getters</span>:&#123;...&#125;,</span><br><span class="line">    <span class="attr">actions</span>:&#123;...&#125;,</span><br><span class="line">    <span class="attr">modules</span>:&#123;...&#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    router,</span><br><span class="line">    store,</span><br><span class="line">    <span class="attr">components</span>: &#123; App &#125;,</span><br><span class="line">    <span class="attr">template</span>: <span class="string">&#x27;&lt;App/&gt;&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="1、State-使用"><a href="#1、State-使用" class="headerlink" title="1、State 使用"></a>1、State 使用</h2><p><code>Vuex</code> 使用单一状态树——是的，用一个对象就包含了全部的应用层级状态。至此它便作为一个“唯一数据源 (SSOT)”而存在。这也意味着，每个应用将仅仅包含一个 <code>store</code> 实例。单一状态树让我们能够直接地定位任一特定的状态片段，在调试的过程中也能轻易地取得整个当前应用状态的快照。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Childer.vue</span></span><br><span class="line">名字：&lt;span v-text=<span class="string">&quot;name&quot;</span>&gt;&lt;/span&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;mapState&#125; <span class="keyword">from</span> <span class="string">&quot;vuex&quot;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">localName</span>:<span class="string">&#x27;pingan&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 常规实现方法</span></span><br><span class="line">    <span class="attr">computed</span>:&#123;</span><br><span class="line">        <span class="function"><span class="title">name</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.$store.state.name</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 使用mapState辅助函数 传入对象参数</span></span><br><span class="line">    <span class="attr">computed</span>:mapState(&#123;</span><br><span class="line">        <span class="comment">// 使用方法1：箭头函数可以使代码更简洁</span></span><br><span class="line">        <span class="attr">name</span>:<span class="function"><span class="params">state</span>=&gt;</span>state.name,</span><br><span class="line">        <span class="comment">// 使用方法2：传字符串参数 &#x27;count&#x27; 等同于 `state =&gt; state.count`</span></span><br><span class="line">        <span class="attr">name</span>:<span class="string">&#x27;name&#x27;</span></span><br><span class="line">        <span class="comment">// 使用方法3：为了能够使用 `this` 获取局部状态，必须使用常规函数</span></span><br><span class="line">        <span class="function"><span class="title">localData</span>(<span class="params">state</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> state.name + <span class="built_in">this</span>.localName</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用mapSatate辅助函数 传入数组参数</span></span><br><span class="line">    <span class="attr">computed</span>:mapState([</span><br><span class="line">        <span class="comment">// 映射 this.name 为 store.state.name</span></span><br><span class="line">        <span class="string">&#x27;name&#x27;</span></span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line">    <span class="comment">// mapState和局部计算属性computed混合使用</span></span><br><span class="line">    <span class="attr">computed</span>:&#123;</span><br><span class="line">        <span class="function"><span class="title">testName</span>(<span class="params"></span>)</span>&#123; <span class="comment">/* ... */</span>&#125;,</span><br><span class="line">        <span class="comment">// 使用对象展开运算符将此对象混入到外部对象中</span></span><br><span class="line">        ...mapState(&#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="2、Getter-使用"><a href="#2、Getter-使用" class="headerlink" title="2、Getter 使用"></a>2、Getter 使用</h2><p>有时候我们需要从 <code>store</code> 中的 <code>state</code> 中派生出一些状态，例如对列表进行过滤并计数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">todos</span>: [</span><br><span class="line">      &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">&#x27;...&#x27;</span>, <span class="attr">done</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">text</span>: <span class="string">&#x27;...&#x27;</span>, <span class="attr">done</span>: <span class="literal">false</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="attr">doneTodos</span>: <span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> state.todos.filter(<span class="function"><span class="params">todo</span> =&gt;</span> todo.done)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// Getter 也可以接受其他 getter 作为第二个参数：</span></span><br><span class="line">    <span class="attr">doneTodosCount</span>: <span class="function">(<span class="params">state, getters</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getters.doneTodos.length</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 通过让 getter 返回一个函数，来实现给 getter 传参。在你对 store 里的数组进行查询时非常有用。</span></span><br><span class="line">    <span class="attr">getTodoById</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> state.todos.find(<span class="function"><span class="params">todo</span> =&gt;</span> todo.id === id)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Childer.vue</span></span><br><span class="line"><span class="comment">// Getter 会暴露为 store.getters 对象</span></span><br><span class="line"><span class="keyword">import</span> &#123;mapGetters&#125; <span class="keyword">from</span> <span class="string">&quot;vuex&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">created</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.$store.getters.doneTodos)       <span class="comment">// -&gt; [&#123; id: 1, text: &#x27;...&#x27;, done: true &#125;]</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.$store.getters.doneTodosCount ) <span class="comment">// -&gt; 1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="attr">computed</span>:&#123;</span><br><span class="line">    doneTodosCount () &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.$store.getters.doneTodosCount</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 使用mapGetters辅助函数 传入数组参数</span></span><br><span class="line">    <span class="comment">// 使用对象展开运算符将 getter 混入 computed 对象中</span></span><br><span class="line">    ...mapGetters([</span><br><span class="line">        <span class="string">&#x27;doneTodosCount&#x27;</span>,</span><br><span class="line">    ])</span><br><span class="line">    <span class="comment">// 使用mapGetters辅助函数 传入对象参数</span></span><br><span class="line">    <span class="comment">// 为getter属性命名</span></span><br><span class="line">    ...mapGetters(&#123;</span><br><span class="line">        <span class="attr">doneCount</span>:<span class="string">&#x27;doneTodosCount&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="3、Mutation-使用"><a href="#3、Mutation-使用" class="headerlink" title="3、Mutation 使用"></a>3、Mutation 使用</h2><p>更改 <code>Vuex</code> 的 <code>store</code> 中的状态的唯一方法是提交 <code>mutation</code>。<code>Vuex</code> 中的 <code>mutation</code> 非常类似于事件：每个 <code>mutation</code> 都有一个字符串的 <code>事件类型 (type)</code> 和 一个 <code>回调函数 (handler)</code>。<br>这个回调函数就是我们实际进行状态更改的地方，并且它会接受 <code>state</code> 作为第一个参数：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">count</span>: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    increment (state) &#123;</span><br><span class="line">      <span class="comment">// 变更状态</span></span><br><span class="line">      state.count++</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>不可直接调用一个 <code>mutation handler</code>。这个选项更像是事件注册：“当触发一个类型为 <code>increment</code> 的 <code>mutation</code> 时，调用此函数。”要唤醒一个 <code>mutation handler</code>，你需要以相应的 <code>type</code> 调用 <code>store.commit</code> 方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line">store.commit(<span class="string">&#x27;increment&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Childer.vue</span></span><br><span class="line">&lt;button @click=<span class="string">&quot;fun&quot;</span>&gt;测试&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">methods:&#123;</span><br><span class="line">    <span class="function"><span class="title">fun</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.$store.commit(<span class="string">&#x27;increment&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要向 <code>store.commit</code> 传入额外的参数，即 <code>mutation</code> 的 载荷（payload）：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">count</span>: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="comment">// 传入参数方式1</span></span><br><span class="line">    increment (state, n) &#123;</span><br><span class="line">      state.count += n</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 传入参数方式2</span></span><br><span class="line">    increment (state, payload) &#123;</span><br><span class="line">      state.count += payload.amount</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 传入参数方式1  -  提交</span></span><br><span class="line">store.commit(<span class="string">&#x27;increment&#x27;</span>, <span class="number">10</span>)</span><br><span class="line"><span class="comment">// 传入参数方式2  -  提交</span></span><br><span class="line">store.commit(<span class="string">&#x27;increment&#x27;</span>, &#123;<span class="attr">amount</span>: <span class="number">10</span>&#125;)</span><br><span class="line"><span class="comment">// 传入参数方式2  -  提交  对象形式</span></span><br><span class="line">store.commit(&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;increment&#x27;</span>,</span><br><span class="line">  <span class="attr">amount</span>: <span class="number">10</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Childer.vue</span></span><br><span class="line">&lt;button @click=<span class="string">&quot;incrementBy(&#123;amount:11&#125;)&quot;</span>&gt;测试&lt;/button&gt;</span><br><span class="line"><span class="keyword">import</span> &#123;mapMutations&#125; <span class="keyword">from</span> <span class="string">&quot;vuex&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">methods</span>:&#123;</span><br><span class="line">    <span class="function"><span class="title">fun</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 传入参数方式1  -  提交</span></span><br><span class="line">        <span class="built_in">this</span>.$store.commit(<span class="string">&#x27;increment&#x27;</span>, <span class="number">10</span>)</span><br><span class="line">        <span class="comment">// 传入参数方式2  -  提交</span></span><br><span class="line">        <span class="built_in">this</span>.$store.commit(<span class="string">&#x27;increment&#x27;</span>, &#123;<span class="attr">amount</span>: <span class="number">10</span>&#125;)</span><br><span class="line">        <span class="comment">// 传入参数方式2  -  提交  对象形式</span></span><br><span class="line">        <span class="built_in">this</span>.$store.commit(&#123;<span class="attr">type</span>: <span class="string">&#x27;increment&#x27;</span>,<span class="attr">amount</span>: <span class="number">10</span>&#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 组件中提交Mutation  传入数组</span></span><br><span class="line">    ...mapMutations([</span><br><span class="line">        <span class="string">&#x27;increment&#x27;</span>, <span class="comment">// 将 `this.increment()` 映射为 `this.$store.commit(&#x27;increment&#x27;)`</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// `mapMutations` 也支持载荷：需要在调用的地方传入参数</span></span><br><span class="line">        <span class="string">&#x27;incrementBy&#x27;</span> <span class="comment">// 将 `this.incrementBy(amount)` 映射为 `this.$store.commit(&#x27;incrementBy&#x27;, amount)`</span></span><br><span class="line">    ])</span><br><span class="line">    <span class="comment">// 组件中提交Mutation  传入对象</span></span><br><span class="line">    ...mapMutations(&#123;</span><br><span class="line">      <span class="attr">add</span>: <span class="string">&#x27;increment&#x27;</span> <span class="comment">// 将 `this.add()` 映射为 `this.$store.commit(&#x27;increment&#x27;)`</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一条重要的原则就是要记住 mutation 必须是同步函数。  </p>
<h2 id="4、Action-使用"><a href="#4、Action-使用" class="headerlink" title="4、Action 使用"></a>4、Action 使用</h2><p><code>Action</code> 类似于 <code>mutation</code>，不同在于：  </p>
<ul>
<li><code>Action</code> 提交的是 <code>mutation</code>，而不是直接变更状态。  </li>
<li><code>Action</code> 可以包含任意异步操作。  </li>
</ul>
<p>注册一个简单的<code>action</code>:  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">    <span class="attr">state</span>:&#123;</span><br><span class="line">        <span class="attr">count</span>:<span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mutations</span>:&#123;</span><br><span class="line">        <span class="function"><span class="title">increment</span>(<span class="params">state</span>)</span>&#123;</span><br><span class="line">            state.count ++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">actions</span>:&#123;</span><br><span class="line">        <span class="comment">// 常用写法</span></span><br><span class="line">        <span class="function"><span class="title">increment</span>(<span class="params">context</span>)</span>&#123;</span><br><span class="line">            context.commit(<span class="string">&#x27;incremnet&#x27;</span>)   <span class="comment">// 通过 context.commit 提交一个 mutation</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 简化写法 使用 ES6 参数结构 </span></span><br><span class="line">        <span class="function"><span class="title">increment</span>(<span class="params">&#123;commit&#125;</span>)</span>&#123;</span><br><span class="line">            commit(<span class="string">&#x27;increment&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>通过 <code>store.dispatch</code> 方法来触发 <code>action</code> 来提交修改：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Childer.vue</span></span><br><span class="line">&lt;button @click=<span class="string">&quot;incrementBy(&#123;amount:11&#125;)&quot;</span>&gt;测试&lt;/button&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;mapActions&#125; <span class="keyword">from</span> <span class="string">&quot;vuex&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">methods</span>:&#123;</span><br><span class="line">    <span class="function"><span class="title">fun</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 简单使用</span></span><br><span class="line">        <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;increment&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 以荷载形式分发</span></span><br><span class="line">        <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;incremrnt&#x27;</span>,&#123;<span class="attr">amount</span>: <span class="number">11</span>&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 以对象形式分发</span></span><br><span class="line">        <span class="built_in">this</span>.$store.dispatch(&#123;</span><br><span class="line">            <span class="attr">type</span>:<span class="string">&#x27;increment&#x27;</span>,</span><br><span class="line">            <span class="attr">amount</span>: <span class="number">11</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 在组件中分发 Action</span></span><br><span class="line">    ...mapActions([</span><br><span class="line">        <span class="string">&#x27;increment&#x27;</span>, <span class="comment">// 将 `this.increment()` 映射为 `this.$store.dispatch(&#x27;increment&#x27;)`</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// `mapActions` 也支持载荷：</span></span><br><span class="line">        <span class="string">&#x27;incrementBy&#x27;</span> <span class="comment">// 将 `this.incrementBy(amount)` 映射为 `this.$store.dispatch(&#x27;incrementBy&#x27;, amount)`</span></span><br><span class="line">    ]),</span><br><span class="line">    ...mapActions(&#123;</span><br><span class="line">      <span class="attr">add</span>: <span class="string">&#x27;increment&#x27;</span> <span class="comment">// 将 `this.add()` 映射为 `this.$store.dispatch(&#x27;increment&#x27;)`</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>组合 <code>Action</code> ，可以使用 <code>new Promise</code> 实现同步：<br>具体查看 <a target="_blank" rel="noopener" href="https://vuex.vuejs.org/zh-cn/actions.html">点击查看</a>    </p>
<h2 id="5、Module"><a href="#5、Module" class="headerlink" title="5、Module"></a>5、Module</h2><p>由于使用单一状态树，应用的所有状态会集中到一个比较大的对象。当应用变得非常复杂时，<code>store</code> 对象就有可能变得相当臃肿。<br>为了解决以上问题，<code>Vuex</code> 允许我们将 <code>store</code> 分割成模块（module）。每个模块拥有自己的 <code>state</code>、<code>mutation</code>、<code>action</code>、<code>getter</code>、甚至是嵌套子模块——从上至下进行同样方式的分割：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">const</span> moduleA = &#123;</span><br><span class="line">  <span class="attr">state</span>: &#123; ... &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123; ... &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123; ... &#125;,</span><br><span class="line">  <span class="attr">getters</span>: &#123; ... &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> moduleB = &#123;</span><br><span class="line">  <span class="attr">state</span>: &#123; ... &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123; ... &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123; ... &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  <span class="attr">modules</span>: &#123;</span><br><span class="line">    <span class="attr">a</span>: moduleA,</span><br><span class="line">    <span class="attr">b</span>: moduleB</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">store.state.a <span class="comment">// -&gt; moduleA 的状态</span></span><br><span class="line">store.state.b <span class="comment">// -&gt; moduleB 的状态</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>模块的局部状态<br>对于模块内部的 <code>mutation</code> 和 <code>getter</code>，接收的第一个参数是模块的 <code>局部状态对象</code> 。  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">const</span> moduleA = &#123;</span><br><span class="line">  <span class="attr">state</span>: &#123; <span class="attr">count</span>: <span class="number">0</span> &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    increment (state) &#123;</span><br><span class="line">      <span class="comment">// 这里的 `state` 对象是模块的局部状态</span></span><br><span class="line">      state.count++</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    doubleCount (state) &#123;</span><br><span class="line">      <span class="keyword">return</span> state.count * <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同样，对于模块内部的 <code>action</code>，局部状态通过 <code>context.state</code> 暴露出来，根节点状态则为 <code>context.rootState</code>：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> moduleA = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    incrementIfOddOnRootSum (&#123; state, commit, rootState &#125;) &#123;</span><br><span class="line">      <span class="keyword">if</span> ((state.count + rootState.count) % <span class="number">2</span> === <span class="number">1</span>) &#123;</span><br><span class="line">        commit(<span class="string">&#x27;increment&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于模块内部的 <code>getter</code>，根节点状态会作为第三个参数暴露出来：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> moduleA = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    sumWithRootCount (state, getters, rootState) &#123;</span><br><span class="line">      <span class="keyword">return</span> state.count + rootState.count</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="6、项目结构"><a href="#6、项目结构" class="headerlink" title="6、项目结构"></a>6、项目结构</h2><p><code>Vuex</code> 并不限制你的代码结构。但是，它规定了一些需要遵守的规则：   </p>
<ul>
<li>应用层级的状态应该集中到单个 <code>store</code> 对象中。   </li>
<li>提交 <code>mutation</code> 是更改状态的唯一方法，并且这个过程是同步的。   </li>
<li>异步逻辑都应该封装到 <code>action</code> 里面。   </li>
</ul>
<p>只要你遵守以上规则，如何组织代码随你便。如果你的 <code>store</code> 文件太大，只需将 <code>action</code>、<code>mutation</code> 和 <code>getter</code> 分割到单独的文件。</p>
<p>对于大型应用，我们会希望把 <code>Vuex</code> 相关代码分割到模块中。下面是项目结构示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">├── index.html</span><br><span class="line">├── main.js</span><br><span class="line">├── api</span><br><span class="line">│   └── ... # 抽取出API请求</span><br><span class="line">├── components</span><br><span class="line">│   ├── App.vue</span><br><span class="line">│   └── ...</span><br><span class="line">└── store</span><br><span class="line">    ├── index.js          # 我们组装模块并导出 store 的地方</span><br><span class="line">    ├── actions.js        # 根级别的 action</span><br><span class="line">    ├── mutations.js      # 根级别的 mutation</span><br><span class="line">    └── modules</span><br><span class="line">        ├── cart.js       # 购物车模块</span><br><span class="line">        └── products.js   # 产品模块</span><br></pre></td></tr></table></figure>
<p>参考<a target="_blank" rel="noopener" href="https://github.com/vuejs/vuex/tree/dev/examples/shopping-cart">购物车示例</a>。</p>
<h2 id="Vuex源码分析："><a href="#Vuex源码分析：" class="headerlink" title="Vuex源码分析："></a>Vuex源码分析：</h2><ol>
<li><a target="_blank" rel="noopener" href="https://www.imooc.com/article/14739">源码分析(上)</a></li>
<li><a target="_blank" rel="noopener" href="https://www.imooc.com/article/14740">源码分析(中)</a></li>
<li><a target="_blank" rel="noopener" href="https://www.imooc.com/article/14741">源码分析(下)</a></li>
</ol>
<h2 id="参考demo"><a href="#参考demo" class="headerlink" title="参考demo"></a>参考demo</h2><ol>
<li><a target="_blank" rel="noopener" href="https://github.com/superman66/vue-axios-github">Vue 全家桶 + axios 前端实现登录拦截、登出、拦截器等功能</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/zhaohaodang/vue-WeChat">一款基于Vue2.0高仿微信App的单页应用 </a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/01/25/37-%E3%80%90Vuejs%E3%80%91Vuex%E5%A4%8D%E4%B9%A0%E8%B5%84%E6%96%99/" data-id="ckts3ejup007h4d9kdqn5b12z" data-title="37-【Vuejs】Vuex复习资料" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Vuejs/" rel="tag">Vuejs</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-36-【WebSocket】重新复习WebSocket" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/01/24/36-%E3%80%90WebSocket%E3%80%91%E9%87%8D%E6%96%B0%E5%A4%8D%E4%B9%A0WebSocket/" class="article-date">
  <time class="dt-published" datetime="2018-01-24T15:51:26.000Z" itemprop="datePublished">2018-01-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/01/24/36-%E3%80%90WebSocket%E3%80%91%E9%87%8D%E6%96%B0%E5%A4%8D%E4%B9%A0WebSocket/">36-【WebSocket】重新复习WebSocket</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p><a target="_blank" rel="noopener" href="https://juejin.im/post/5a4e6a43f265da3e303c4787">阅读原文</a></p>
</blockquote>
<h1 id="一、内容概览"><a href="#一、内容概览" class="headerlink" title="一、内容概览"></a>一、内容概览</h1><p><code>WebSocket</code> 的出现，使得浏览器具备了实时双向通信的能力。本文由浅入深，介绍了<code>WebSocket</code>如何建立连接、交换数据的细节，以及数据帧的格式。此外，还简要介绍了针对<code>WebSocket</code>的安全攻击，以及协议是如何抵御类似攻击的。  </p>
<h1 id="二、什么是WebSocket"><a href="#二、什么是WebSocket" class="headerlink" title="二、什么是WebSocket"></a>二、什么是WebSocket</h1><p>HTML5开始提供的一种浏览器与服务器进行全双工通讯的网络技术，属于应用层协议。它基于TCP传输协议，并复用HTTP的握手通道。<br>对大部分web开发者来说，上面这段描述有点枯燥，其实只要记住几点：  </p>
<ol>
<li>WebSocket可以在浏览器里使用</li>
<li>支持双向通信</li>
<li>使用很简单</li>
</ol>
<h2 id="1、有哪些优点"><a href="#1、有哪些优点" class="headerlink" title="1、有哪些优点"></a>1、有哪些优点</h2><p>说到优点，这里的对比参照物是 <code>HTTP协议</code> ，概括地说就是：<code>支持双向通信</code>，<code>更灵活</code>，<code>更高效</code>，<code>可扩展性更好</code>。  </p>
<ol>
<li>支持双向通信，实时性更强。  </li>
<li>更好的二进制支持。  </li>
<li>较少的控制开销。连接创建后，ws客户端、服务端进行数据交换时，协议控制的数据包头部较小。在不包含头部的情况下，服务端到客户端的包头只有2~10字节（取决于数据包长度），客户端到服务端的的话，需要加上额外的4字节的掩码。而HTTP协议每次通信都需要携带完整的头部。  </li>
<li>支持扩展。ws协议定义了扩展，用户可以扩展协议，或者实现自定义的子协议。（比如支持自定义压缩算法等）  </li>
</ol>
<p>对于后面两点，没有研究过 <code>WebSocket协议规范</code> 的同学可能理解起来不够直观，但不影响对 <code>WebSocket</code> 的学习和使用。  </p>
<h2 id="2、需要学习哪些东西"><a href="#2、需要学习哪些东西" class="headerlink" title="2、需要学习哪些东西"></a>2、需要学习哪些东西</h2><p>对网络应用层协议的学习来说，最重要的往往就是 <code>连接建立过程</code>、<code>数据交换教程</code>。当然，数据的格式是逃不掉的，因为它直接决定了协议本身的能力。好的数据格式能让协议更高效、扩展性更好。<br>下文主要围绕下面几点展开：   </p>
<ol>
<li>如何建立连接</li>
<li>如何交换数据</li>
<li>数据帧格式</li>
<li>如何维持连接</li>
</ol>
<h1 id="三、入门案例"><a href="#三、入门案例" class="headerlink" title="三、入门案例"></a>三、入门案例</h1><p>在正式介绍协议细节前，先来看一个简单的例子，有个直观感受。例子包括了<code>WebSocket服务端</code>、<code>WebSocket客户端（网页端）</code>。完整代码可以在 <a target="_blank" rel="noopener" href="https://github.com/chyingp/blog/tree/master/demo/2017.05.22-web-socket/ws">这里</a> 找到。<br>这里服务端用了<code>ws</code>这个库。相比大家熟悉的<code>socket.io</code>，<code>ws</code>实现更轻量，更适合学习的目的。  </p>
<h2 id="1、服务端"><a href="#1、服务端" class="headerlink" title="1、服务端"></a>1、服务端</h2><p>代码如下，监听8080端口。当有新的连接请求到达时，打印日志，同时向客户端发送消息。当收到到来自客户端的消息时，同样打印日志。 </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)();</span><br><span class="line"><span class="keyword">var</span> server = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>).Server(app);</span><br><span class="line"><span class="keyword">var</span> WebSocket = <span class="built_in">require</span>(<span class="string">&#x27;ws&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wss = <span class="keyword">new</span> WebSocket.Server(&#123; <span class="attr">port</span>: <span class="number">8080</span> &#125;);</span><br><span class="line"></span><br><span class="line">wss.on(<span class="string">&#x27;connection&#x27;</span>, <span class="function"><span class="keyword">function</span> <span class="title">connection</span>(<span class="params">ws</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;server: receive connection.&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    ws.on(<span class="string">&#x27;message&#x27;</span>, <span class="function"><span class="keyword">function</span> <span class="title">incoming</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;server: received: %s&#x27;</span>, message);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    ws.send(<span class="string">&#x27;world&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.sendfile(__dirname + <span class="string">&#x27;/index.html&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>

<h2 id="2、客户端"><a href="#2、客户端" class="headerlink" title="2、客户端"></a>2、客户端</h2><p>代码如下，向8080端口发起WebSocket连接。连接建立后，打印日志，同时向服务端发送消息。接收到来自服务端的消息后，同样打印日志。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">var</span> ws = <span class="keyword">new</span> WebSocket(<span class="string">&#x27;ws://localhost:8080&#x27;</span>);</span><br><span class="line">  ws.onopen = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;ws onopen&#x27;</span>);</span><br><span class="line">    ws.send(<span class="string">&#x27;from client: hello&#x27;</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  ws.onmessage = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;ws onmessage&#x27;</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;from server: &#x27;</span> + e.data);</span><br><span class="line">  &#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="3、运行结果"><a href="#3、运行结果" class="headerlink" title="3、运行结果"></a>3、运行结果</h2><p>可分别查看服务端、客户端的日志，这里不展开。<br>服务端输出：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">server: receive connection.</span><br><span class="line"><span class="attr">server</span>: received hello</span><br></pre></td></tr></table></figure>
<p>客户端输出：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">client: ws connection is open</span><br><span class="line"><span class="attr">client</span>: received world</span><br></pre></td></tr></table></figure>

<h1 id="四、如何建立连接"><a href="#四、如何建立连接" class="headerlink" title="四、如何建立连接"></a>四、如何建立连接</h1><p>前面提到，<code>WebSocket</code>复用了<code>HTTP</code>的握手通道。具体指的是，客户端通过<code>HTTP</code>请求与<code>WebSocket</code>服务端协商升级协议。协议升级完成后，后续的数据交换则遵照<code>WebSocket</code>的协议。</p>
<h2 id="1、客户端：申请协议升级"><a href="#1、客户端：申请协议升级" class="headerlink" title="1、客户端：申请协议升级"></a>1、客户端：申请协议升级</h2><p>首先，客户端发起协议升级请求。可以看到，采用的是标准的HTTP报文格式，且只支持GET方法。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET / HTTP/1.1</span><br><span class="line">Host: localhost:8080</span><br><span class="line">Origin: http://127.0.0.1:3000</span><br><span class="line">Connection: Upgrade</span><br><span class="line">Upgrade: websocket</span><br><span class="line">Sec-WebSocket-Version: 13</span><br><span class="line">Sec-WebSocket-Key: w4v7O6xFTi36lq3RNcgctw==</span><br></pre></td></tr></table></figure>
<p>重点请求首部意义如下：</p>
<ul>
<li><code>Connection: Upgrade</code>：表示要升级协议</li>
<li><code>Upgrade: websocket</code>：表示要升级到<code>websocket</code>协议。</li>
<li><code>Sec-WebSocket-Version: 13</code>：表示<code>websocket</code>的版本。如果服务端不支持该版本，需要返回一个<code>Sec-WebSocket-Version</code> header，里面包含服务端支持的版本号。</li>
<li><code>Sec-WebSocket-Key</code>：与后面服务端响应首部的<code>Sec-WebSocket-Accept</code>是配套的，提供基本的防护，比如恶意的连接，或者无意的连接。</li>
</ul>
<blockquote>
<p>注意，上面请求省略了部分非重点请求首部。由于是标准的HTTP请求，类似Host、Origin、Cookie等请求首部会照常发送。在握手阶段，可以通过相关请求首部进行 安全限制、权限校验等。</p>
</blockquote>
<h2 id="2、服务端：响应协议升级"><a href="#2、服务端：响应协议升级" class="headerlink" title="2、服务端：响应协议升级"></a>2、服务端：响应协议升级</h2><p>服务端返回内容如下，状态代码101表示协议切换。到此完成协议升级，后续的数据交互都按照新的协议来。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 101 Switching Protocols</span><br><span class="line">Connection:Upgrade</span><br><span class="line">Upgrade: websocket</span><br><span class="line">Sec-WebSocket-Accept: Oy4NRAQ13jhfONC7bP8dTKb4PTU=</span><br></pre></td></tr></table></figure>

<blockquote>
<p>备注：每个header都以\r\n结尾，并且最后一行加上一个额外的空行\r\n。此外，服务端回应的HTTP状态码只能在握手阶段使用。过了握手阶段后，就只能采用特定的错误码。</p>
</blockquote>
<h2 id="3、Sec-WebSocket-Accept的计算"><a href="#3、Sec-WebSocket-Accept的计算" class="headerlink" title="3、Sec-WebSocket-Accept的计算"></a>3、Sec-WebSocket-Accept的计算</h2><p><code>Sec-WebSocket-Accept1</code>根据客户端请求首部的1<code>Sec-WebSocket-Key1</code>计算出来。<br>计算公式为：</p>
<ol>
<li>将<code>Sec-WebSocket-Key</code>跟<code>258EAFA5-E914-47DA-95CA-C5AB0DC85B11</code>拼接。</li>
<li>通过SHA1计算出摘要，并转成base64字符串。</li>
</ol>
<p>伪代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;toBase64( sha1( Sec-WebSocket-Key + 258EAFA5-E914-47DA-95CA-C5AB0DC85B11 )  )</span><br></pre></td></tr></table></figure>
<p>验证下前面的返回结果：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> magic = <span class="string">&#x27;258EAFA5-E914-47DA-95CA-C5AB0DC85B11&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> secWebSocketKey = <span class="string">&#x27;w4v7O6xFTi36lq3RNcgctw==&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> secWebSocketAccept = crypto.createHash(<span class="string">&#x27;sha1&#x27;</span>)</span><br><span class="line">	.update(secWebSocketKey + magic)</span><br><span class="line">	.digest(<span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(secWebSocketAccept);</span><br><span class="line"><span class="comment">// Oy4NRAQ13jhfONC7bP8dTKb4PTU=</span></span><br></pre></td></tr></table></figure>

<h1 id="五、数据帧格式"><a href="#五、数据帧格式" class="headerlink" title="五、数据帧格式"></a>五、数据帧格式</h1><p>客户端、服务端数据的交换，离不开数据帧格式的定义。因此，在实际讲解数据交换之前，我们先来看下WebSocket的数据帧格式。<br>WebSocket客户端、服务端通信的最小单位是帧（frame），由1个或多个帧组成一条完整的消息（message）。  </p>
<ol>
<li>发送端：将消息切割成多个帧，并发送给服务端；</li>
<li>接收端：接收消息帧，并将关联的帧重新组装成完整的消息；</li>
</ol>
<p>本节的重点，就是讲解<code>数据帧</code>的格式。详细定义可参考 <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc6455#section-5.2">RFC6455 5.2节</a> 。</p>
<h2 id="1、数据帧格式概览"><a href="#1、数据帧格式概览" class="headerlink" title="1、数据帧格式概览"></a>1、数据帧格式概览</h2><p>下面给出了<code>WebSocket</code>数据帧的统一格式。熟悉<code>TCP/IP协议</code>的同学对这样的图应该不陌生。  </p>
<ol>
<li>从左到右，单位是比特。比如FIN、RSV1各占据1比特，opcode占据4比特。</li>
<li>内容包括了标识、操作代码、掩码、数据、数据长度等。（下一小节会展开）<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> 0                   1                   2                   3</span><br><span class="line"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span><br><span class="line">+-+-+-+-+-------+-+-------------+-------------------------------+</span><br><span class="line">|F|R|R|R| opcode|M| Payload len |    Extended payload length    |</span><br><span class="line">|I|S|S|S|  (4)  |A|     (7)     |             (16/64)           |</span><br><span class="line">|N|V|V|V|       |S|             |   (if payload len==126/127)   |</span><br><span class="line">| |1|2|3|       |K|             |                               |</span><br><span class="line">+-+-+-+-+-------+-+-------------+ - - - - - - - - - - - - - - - +</span><br><span class="line">|     Extended payload length continued, if payload len == 127  |</span><br><span class="line">+ - - - - - - - - - - - - - - - +-------------------------------+</span><br><span class="line">|                               |Masking-key, if MASK set to 1  |</span><br><span class="line">+-------------------------------+-------------------------------+</span><br><span class="line">| Masking-key (continued)       |          Payload Data         |</span><br><span class="line">+-------------------------------- - - - - - - - - - - - - - - - +</span><br><span class="line">:                     Payload Data continued ...                :</span><br><span class="line">+ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +</span><br><span class="line">|                     Payload Data continued ...                |</span><br><span class="line">+---------------------------------------------------------------+</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="2、数据帧格式详解"><a href="#2、数据帧格式详解" class="headerlink" title="2、数据帧格式详解"></a>2、数据帧格式详解</h2><p>针对前面的格式概览图，这里逐个字段进行讲解，如有不清楚之处，可参考协议规范，或留言交流。<br><strong>FIN</strong>：1个比特。<br>如果是1，表示这是消息（message）的最后一个分片（fragment），如果是0，表示不是是消息（message）的最后一个分片（fragment）。<br><strong>RSV1, RSV2, RSV3</strong>：各占1个比特。<br>一般情况下全为0。当客户端、服务端协商采用WebSocket扩展时，这三个标志位可以非0，且值的含义由扩展进行定义。如果出现非零的值，且并没有采用WebSocket扩展，连接出错。<br><strong>Opcode</strong>:  4个比特。<br>操作代码，Opcode的值决定了应该如何解析后续的数据载荷（data payload）。如果操作代码是不认识的，那么接收端应该断开连接（fail the connection）。可选的操作代码如下：</p>
<ul>
<li>%x0：表示一个延续帧。当Opcode为0时，表示本次数据传输采用了数据分片，当前收到的数据帧为其中一个数据分片。</li>
<li>%x1：表示这是一个文本帧（frame）</li>
<li>%x2：表示这是一个二进制帧（frame）</li>
<li>%x3-7：保留的操作代码，用于后续定义的非控制帧。</li>
<li>%x8：表示连接断开。</li>
<li>%x9：表示这是一个ping操作。</li>
<li>%xA：表示这是一个pong操作。</li>
<li>%xB-F：保留的操作代码，用于后续定义的控制帧。</li>
</ul>
<p><strong>Mask</strong>:  1个比特。<br>表示是否要对数据载荷进行掩码操作。从客户端向服务端发送数据时，需要对数据进行掩码操作；从服务端向客户端发送数据时，不需要对数据进行掩码操作。<br>如果服务端接收到的数据没有进行过掩码操作，服务端需要断开连接。<br>如果Mask是1，那么在Masking-key中会定义一个掩码键（masking key），并用这个掩码键来对数据载荷进行反掩码。所有客户端发送到服务端的数据帧，Mask都是1。<br>掩码的算法、用途在下一小节讲解。  </p>
<p><strong>Payload length</strong>：数据载荷的长度，单位是字节。为7位，或7+16位，或1+64位。<br>假设数Payload length === x，如果</p>
<ul>
<li>x为0~126：数据的长度为x字节。  </li>
<li>x为126：后续2个字节代表一个16位的无符号整数，该无符号整数的值为数据的长度。  </li>
<li>x为127：后续8个字节代表一个64位的无符号整数（最高位为0），该无符号整数的值为数据的长度。<br>此外，如果payload length占用了多个字节的话，payload length的二进制表达采用网络序（big endian，重要的位在前）。   </li>
</ul>
<p><strong>Masking-key</strong>：0或4字节（32位）<br>所有从客户端传送到服务端的数据帧，数据载荷都进行了掩码操作，Mask为1，且携带了4字节的Masking-key。如果Mask为0，则没有Masking-key。<br>备注：载荷数据的长度，不包括mask key的长度。  </p>
<p><strong>Payload data</strong>：(x+y) 字节<br>载荷数据：包括了扩展数据、应用数据。其中，扩展数据x字节，应用数据y字节。<br>扩展数据：如果没有协商使用扩展的话，扩展数据数据为0字节。所有的扩展都必须声明扩展数据的长度，或者可以如何计算出扩展数据的长度。此外，扩展如何使用必须在握手阶段就协商好。如果扩展数据存在，那么载荷数据长度必须将扩展数据的长度包含在内。<br>应用数据：任意的应用数据，在扩展数据之后（如果存在扩展数据），占据了数据帧剩余的位置。载荷数据长度 减去 扩展数据长度，就得到应用数据的长度。  </p>
<h2 id="3、掩码算法"><a href="#3、掩码算法" class="headerlink" title="3、掩码算法"></a>3、掩码算法</h2><p>掩码键（<code>Masking-key</code>）是由客户端挑选出来的32位的随机数。掩码操作不会影响数据载荷的长度。掩码、反掩码操作都采用如下算法：<br>首先，假设：    </p>
<ul>
<li>original-octet-i：为原始数据的第i字节。  </li>
<li>transformed-octet-i：为转换后的数据的第i字节。  </li>
<li>j：为i mod 4的结果。  </li>
<li>masking-key-octet-j：为mask key第j字节。<br>算法描述为： original-octet-i 与 masking-key-octet-j 异或后，得到  transformed-octet-i。  </li>
</ul>
<blockquote>
<p>j  = i MOD 4  transformed-octet-i = original-octet-i XOR masking-key-octet-j</p>
</blockquote>
<h1 id="六、数据传递"><a href="#六、数据传递" class="headerlink" title="六、数据传递"></a>六、数据传递</h1><p>一旦WebSocket客户端、服务端建立连接后，后续的操作都是基于数据帧的传递。<br>WebSocket根据opcode来区分操作的类型。比如0x8表示断开连接，0x0-0x2表示数据交互。  </p>
<h2 id="1、数据分片"><a href="#1、数据分片" class="headerlink" title="1、数据分片"></a>1、数据分片</h2><p>WebSocket的每条消息可能被切分成多个数据帧。当WebSocket的接收方收到一个数据帧时，会根据FIN的值来判断，是否已经收到消息的最后一个数据帧。<br>FIN=1表示当前数据帧为消息的最后一个数据帧，此时接收方已经收到完整的消息，可以对消息进行处理。FIN=0，则接收方还需要继续监听接收其余的数据帧。<br>此外，opcode在数据交换的场景下，表示的是数据的类型。0x01表示文本，0x02表示二进制。而0x00比较特殊，表示延续帧（continuation frame），顾名思义，就是完整消息对应的数据帧还没接收完。  </p>
<h2 id="2、数据分片例子"><a href="#2、数据分片例子" class="headerlink" title="2、数据分片例子"></a>2、数据分片例子</h2><p>直接看例子更形象些。下面例子来自<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_servers"> MDN </a>，可以很好地演示数据的分片。客户端向服务端两次发送消息，服务端收到消息后回应客户端，这里主要看客户端往服务端发送的消息。<br><strong>第一条消息</strong><br>FIN=1, 表示是当前消息的最后一个数据帧。服务端收到当前数据帧后，可以处理消息。opcode=0x1，表示客户端发送的是文本类型。<br><strong>第二条消息</strong></p>
<ol>
<li>FIN=0，opcode=0x1，表示发送的是文本类型，且消息还没发送完成，还有后续的数据帧。  </li>
<li>FIN=0，opcode=0x0，表示消息还没发送完成，还有后续的数据帧，当前的数据帧需要接在上一条数据帧之后。  </li>
<li>FIN=1，opcode=0x0，表示消息已经发送完成，没有后续的数据帧，当前的数据帧需要接在上一条数据帧之后。服务端可以将关联的数据帧组装成完整的消息。  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Client: FIN=1, opcode=0x1, msg=&quot;hello&quot;</span><br><span class="line">Server: (process complete message immediately) Hi.</span><br><span class="line">Client: FIN=0, opcode=0x1, msg=&quot;and a&quot;</span><br><span class="line">Server: (listening, new message containing text started)</span><br><span class="line">Client: FIN=0, opcode=0x0, msg=&quot;happy new&quot;</span><br><span class="line">Server: (listening, payload concatenated to previous message)</span><br><span class="line">Client: FIN=1, opcode=0x0, msg=&quot;year!&quot;</span><br><span class="line">Server: (process complete message) Happy new year to you too!</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="七、连接保持-心跳"><a href="#七、连接保持-心跳" class="headerlink" title="七、连接保持+心跳"></a>七、连接保持+心跳</h1><p><code>WebSocket</code>为了保持客户端、服务端的实时双向通信，需要确保客户端、服务端之间的TCP通道保持连接没有断开。然而，对于长时间没有数据往来的连接，如果依旧长时间保持着，可能会浪费包括的连接资源。<br>但不排除有些场景，客户端、服务端虽然长时间没有数据往来，但仍需要保持连接。这个时候，可以采用心跳来实现。  </p>
<ul>
<li>发送方-&gt;接收方：ping</li>
<li>接收方-&gt;发送方：pong<br>ping、pong的操作，对应的是WebSocket的两个控制帧，opcode分别是0x9、0xA。<br>举例，WebSocket服务端向客户端发送ping，只需要如下代码（采用ws模块）  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ws.ping(<span class="string">&#x27;&#x27;</span>, <span class="literal">false</span>, <span class="literal">true</span>);  </span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="八、Sec-WebSocket-Key-Accept的作用"><a href="#八、Sec-WebSocket-Key-Accept的作用" class="headerlink" title="八、Sec-WebSocket-Key/Accept的作用"></a>八、Sec-WebSocket-Key/Accept的作用</h1><p>前面提到了，<code>Sec-WebSocket-Key/Sec-WebSocket-Accept</code>在主要作用在于提供基础的防护，减少恶意连接、意外连接。<br>作用大致归纳如下：  </p>
<ol>
<li>避免服务端收到非法的websocket连接（比如http客户端不小心请求连接websocket服务，此时服务端可以直接拒绝连接）</li>
<li>确保服务端理解websocket连接。因为ws握手阶段采用的是http协议，因此可能ws连接是被一个http服务器处理并返回的，此时客户端可以通过Sec-WebSocket-Key来确保服务端认识ws协议。（并非百分百保险，比如总是存在那么些无聊的http服务器，光处理Sec-WebSocket-Key，但并没有实现ws协议。。。）</li>
<li>用浏览器里发起ajax请求，设置header时，Sec-WebSocket-Key以及其他相关的header是被禁止的。这样可以避免客户端发送ajax请求时，意外请求协议升级（websocket upgrade）</li>
<li>可以防止反向代理（不理解ws协议）返回错误的数据。比如反向代理前后收到两次ws连接的升级请求，反向代理把第一次请求的返回给cache住，然后第二次请求到来时直接把cache住的请求给返回（无意义的返回）。</li>
<li>Sec-WebSocket-Key主要目的并不是确保数据的安全性，因为Sec-WebSocket-Key、Sec-WebSocket-Accept的转换计算公式是公开的，而且非常简单，最主要的作用是预防一些常见的意外情况（非故意的）。</li>
</ol>
<blockquote>
<p>强调：Sec-WebSocket-Key/Sec-WebSocket-Accept 的换算，只能带来基本的保障，但连接是否安全、数据是否安全、客户端/服务端是否合法的 ws客户端、ws服务端，其实并没有实际性的保证。</p>
</blockquote>
<h1 id="九、数据掩码的作用"><a href="#九、数据掩码的作用" class="headerlink" title="九、数据掩码的作用"></a>九、数据掩码的作用</h1><p>WebSocket协议中，数据掩码的作用是增强协议的安全性。但数据掩码并不是为了保护数据本身，因为算法本身是公开的，运算也不复杂。除了加密通道本身，似乎没有太多有效的保护通信安全的办法。<br>那么为什么还要引入掩码计算呢，除了增加计算机器的运算量外似乎并没有太多的收益（这也是不少同学疑惑的点）。<br>答案还是两个字：安全。但并不是为了防止数据泄密，而是为了防止早期版本的协议中存在的代理缓存污染攻击（proxy cache poisoning attacks）等问题。  </p>
<h2 id="1、代理缓存污染攻击"><a href="#1、代理缓存污染攻击" class="headerlink" title="1、代理缓存污染攻击"></a>1、代理缓存污染攻击</h2><p>下面摘自2010年关于安全的一段讲话。其中提到了代理服务器在协议实现上的缺陷可能导致的安全问题。<a href="https://link.juejin.im/?target=http://w2spconf.com/2011/papers/websocket.pdf">猛击出处</a>。  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">“We show, empirically, that the current version of the WebSocket consent mechanism is vulnerable to proxy cache poisoning attacks. Even though the WebSocket handshake is based on HTTP, which should be understood by most network intermediaries, the handshake uses the esoteric “Upgrade” mechanism of HTTP [5]. In our experiment, we find that many proxies do not implement the Upgrade mechanism properly, which causes the handshake to succeed even though subsequent traffic over the socket will be misinterpreted by the proxy.”</span><br><span class="line">[TALKING]  Huang, L-S., Chen, E., Barth, A., Rescorla, E., and C.</span><br><span class="line">Jackson, &quot;Talking to Yourself for Fun and Profit&quot;, 2010,</span><br></pre></td></tr></table></figure>
<p>在正式描述攻击步骤之前，我们假设有如下参与者：  </p>
<ul>
<li>攻击者、攻击者自己控制的服务器（简称“邪恶服务器”）、攻击者伪造的资源（简称“邪恶资源”）</li>
<li>受害者、受害者想要访问的资源（简称“正义资源”）</li>
<li>受害者实际想要访问的服务器（简称“正义服务器”）</li>
<li>中间代理服务器</li>
</ul>
<p>攻击步骤一：  </p>
<ol>
<li><strong>攻击者浏览器</strong> 向 <strong>邪恶服务器</strong> 发起WebSocket连接。根据前文，首先是一个协议升级请求。</li>
<li>协议升级请求 实际到达 <strong>代理服务器</strong>。</li>
<li><strong>代理服务器</strong> 将协议升级请求转发到 <strong>邪恶服务器</strong>。</li>
<li><strong>邪恶服务器</strong> 同意连接，<strong>代理服务器</strong> 将响应转发给 <strong>攻击者</strong>。</li>
</ol>
<p>由于 <strong>upgrade</strong> 的实现上有缺陷，<strong>代理服务器</strong> 以为之前转发的是普通的HTTP消息。因此，当<strong>协议服务器</strong> 同意连接，<strong>代理服务器</strong> 以为本次会话已经结束。  </p>
<p>攻击步骤二：  </p>
<ol>
<li><code>攻击者</code> 在之前建立的连接上，通过WebSocket的接口向<code> 邪恶服务器</code> 发送数据，且数据是精心构造的HTTP格式的文本。其中包含了 <code>义资源</code> 的地址，以及一个伪造的host（指向<code>正义服务器</code>）。（见后面报文）</li>
<li>请求到达 <code>代理服务器</code> 。虽然复用了之前的TCP连接，但 <code>代理服务器</code> 以为是新的HTTP请求。</li>
<li><code>代理服务器</code> 向 <code>邪恶服务</code>器<code>请求</code>邪恶资源`。</li>
<li><code>邪恶服务器</code> 返回 <code>邪恶资源</code>。<code>代理服务器 </code>缓存住 <code>邪恶资源</code>（url是对的，但host是<code> 正义服务器</code> 的地址）。</li>
</ol>
<p>到这里，受害者可以登场了：  </p>
<ol>
<li>受害者 通过 代理服务器 访问 正义服务器 的 正义资源。</li>
<li>代理服务器 检查该资源的url、host，发现本地有一份缓存（伪造的）。</li>
<li>代理服务器 将 邪恶资源 返回给 受害者。</li>
<li>受害者 卒。</li>
</ol>
<p>附：前面提到的精心构造的“HTTP请求报文”。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Client → Server:</span><br><span class="line">POST /path/of/attackers/choice HTTP/1.1 Host: host-of-attackers-choice.com Sec-WebSocket-Key: &lt;connection-key&gt;</span><br><span class="line">Server → Client:</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Sec-WebSocket-Accept: &lt;connection-key&gt;</span><br></pre></td></tr></table></figure>

<h2 id="2、当前解决方案"><a href="#2、当前解决方案" class="headerlink" title="2、当前解决方案"></a>2、当前解决方案</h2><p>最初的提案是对数据进行加密处理。基于安全、效率的考虑，最终采用了折中的方案：对数据载荷进行掩码处理。<br>需要注意的是，这里只是限制了浏览器对数据载荷进行掩码处理，但是坏人完全可以实现自己的WebSocket客户端、服务端，不按规则来，攻击可以照常进行。<br>但是对浏览器加上这个限制后，可以大大增加攻击的难度，以及攻击的影响范围。如果没有这个限制，只需要在网上放个钓鱼网站骗人去访问，一下子就可以在短时间内展开大范围的攻击。  </p>
<h1 id="十、写在后面"><a href="#十、写在后面" class="headerlink" title="十、写在后面"></a>十、写在后面</h1><p>WebSocket可写的东西还挺多，比如WebSocket扩展。客户端、服务端之间是如何协商、使用扩展的。WebSocket扩展可以给协议本身增加很多能力和想象空间，比如数据的压缩、加密，以及多路复用等。<br>篇幅所限，这里先不展开，感兴趣的同学可以留言交流。文章如有错漏，敬请指出。</p>
<h1 id="十一、相关链接"><a href="#十一、相关链接" class="headerlink" title="十一、相关链接"></a>十一、相关链接</h1><ol>
<li><a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc6455">RFC6455：websocket规范</a>  </li>
<li><a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc6455#section-5.3">规范：数据帧掩码细节</a>  </li>
<li><a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc6455#section-5.1">规范：数据帧格式</a>  </li>
<li><a target="_blank" rel="noopener" href="https://github.com/websockets/ws#server-example">server-example</a>  </li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_servers">编写websocket服务器</a>  </li>
<li><a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc6455#section-10.3">对网络基础设施的攻击（数据掩码操作所要预防的事情）</a>  </li>
<li><a href="https://link.juejin.im/?target=http://w2spconf.com/2011/papers/websocket.pdf">Talking to Yourself for Fun and Profit（含有攻击描述）</a>  </li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/18265128/what-is-sec-websocket-key-for">What is Sec-WebSocket-Key for?</a>  </li>
<li><a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc6455#section-10.3">10.3.  Attacks On Infrastructure (Masking)</a>  </li>
<li><a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc6455#section-10.3">Talking to Yourself for Fun and Profit</a>  </li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/33250207/why-are-websockets-masked">Why are WebSockets masked?</a>  </li>
<li><a target="_blank" rel="noopener" href="https://security.stackexchange.com/questions/36930/how-does-websocket-frame-masking-protect-against-cache-poisoning">How does websocket frame masking protect against cache poisoning?</a>  </li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/14174184/what-is-the-mask-in-a-websocket-frame">What is the mask in a WebSocket frame?</a>  </li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/01/24/36-%E3%80%90WebSocket%E3%80%91%E9%87%8D%E6%96%B0%E5%A4%8D%E4%B9%A0WebSocket/" data-id="ckts3ejza00nx4d9k6k7t9y4t" data-title="36-【WebSocket】重新复习WebSocket" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTTP%E5%8D%8F%E8%AE%AE/" rel="tag">HTTP协议</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WebSocket/" rel="tag">WebSocket</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/" rel="tag">网络请求</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-35-【Python】回归算法整理-线性回归-梯度下降" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/01/22/35-%E3%80%90Python%E3%80%91%E5%9B%9E%E5%BD%92%E7%AE%97%E6%B3%95%E6%95%B4%E7%90%86-%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92-%E6%A2%AF%E5%BA%A6%E4%B8%8B%E9%99%8D/" class="article-date">
  <time class="dt-published" datetime="2018-01-22T15:17:56.000Z" itemprop="datePublished">2018-01-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/01/22/35-%E3%80%90Python%E3%80%91%E5%9B%9E%E5%BD%92%E7%AE%97%E6%B3%95%E6%95%B4%E7%90%86-%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92-%E6%A2%AF%E5%BA%A6%E4%B8%8B%E9%99%8D/">35-【Python】回归算法整理[线性回归/梯度下降]</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="一、机器学习分类"><a href="#一、机器学习分类" class="headerlink" title="一、机器学习分类"></a>一、机器学习分类</h2><p>机器学习分为：有监督学习，无监督学习和半监督学习。  </p>
<blockquote>
<p>参考文章 <a target="_blank" rel="noopener" href="http://blog.csdn.net/zb1165048017/article/details/48579677">机器学习两种方法——监督学习和无监督学习（通俗理解）</a></p>
</blockquote>
<h3 id="1、有监督学习"><a href="#1、有监督学习" class="headerlink" title="1、有监督学习"></a>1、有监督学习</h3><p>通过给定的训练数据集中学习出一个函数（模型参数），当新数据到来时，可以根据这个函数预测结果。<br>有监督学习的训练集要求包括输入和输出，也就是特征和目标。<br>有监督学习是最常见的 <code>分类</code> 问题，通过已有的训练样本（即已知数据及其对应输出）去训练得到一个最优模型，再利用这个模型将所有的输入映射为响应的数据，对输出进行简单的判断从而实现分类的目的。也就具有了对位置数据分类的能力。<br>有监督学习的目标往往是让计算机去学习我们已经创建好的分类系统（模型）。  </p>
<p>有监督学习是 <code>训练神经网络</code> 和 <code>决策树</code> 的常见技术。这两个技术高度依赖事先确定的分类系统给出的信息。<br>对于神经网络，系统分类利用信息判断网络的错误，然后不断调整网络参数。<br>对于决策树，分类系统用它来判断哪些属性提供了最多的信息。<br>常见的有监督学习算法：回归分析和统计分类。最典型的算法是KNN和SVM。  </p>
<h3 id="2、无监督学习"><a href="#2、无监督学习" class="headerlink" title="2、无监督学习"></a>2、无监督学习</h3><p>输入数据没有被标记，也没有确定的结果。样本数据类别未知，需要根据样本间的相似性对样本集进行分类试图使类内差距最小化，类间差距最大化。<br>通俗点将就是实际应用中，不少情况下无法预先知道样本的标签，也就是说没有训练样本对应的类别，因而只能从原先没有样本标签的样本集开始学习分类器设计。<br>非监督学习目标不是告诉计算机怎么做，而是让它（计算机）自己去学习怎样做事情。<br>无监督学习的方法分为两大类：<br>(1) 一类为基于概率密度函数估计的直接方法：指设法找到各类别在特征空间的分布参数，再进行分类。<br>(2) 另一类是称为基于样本间相似性度量的简洁聚类方法：其原理是设法定出不同类别的核心或初始内核，然后依据样本与核心之间的相似性度量将样本聚集成不同的类别。<br>利用聚类结果，可以提取数据集中隐藏信息，对未来数据进行分类和预测。应用于数据挖掘，模式识别，图像处理等。  </p>
<h3 id="3、二者区别"><a href="#3、二者区别" class="headerlink" title="3、二者区别"></a>3、二者区别</h3><ul>
<li><p>有监督学习：必须要有训练集和测试样本。在训练集中找规律，而对测试样本使用这种规律。     </p>
</li>
<li><p>无监督学习：没有训练集，只有一组数据，在该数据集中寻找规律。  </p>
</li>
<li><p>有监督学习：有监督学习是识别事物，识别的结果表现在给待识别数据上加上标签。因此训练集必须由带标签的样本组成。  </p>
</li>
<li><p>无监督学习：无监督学习是只有要分析数据集的本身，没有标签，如果发现数据集呈现某种聚集性，则可按自然的聚集性分类，但不予以某种预先分类标签对上号为目的。  </p>
</li>
<li><p>非监督学习方法在寻找数据集中的规律性，这种规律性并不一定要达到划分数据集的目的，也就是说不一定要“分类”。这一点是比有监督学习方法的用途要广。譬如分析一堆数据的主分量，或分析数据集有什么特点都可以归于非监督学习方法的范畴。  </p>
</li>
<li><p>用非监督学习方法分析数据集的主分量与用K-L变换计算数据集的主分量又有区别。后者从方法上讲不是学习方法。因此用K-L变换找主分量不属于无监督学习方法，即方法上不是。而通过学习逐渐找到规律性这体现了学习方法这一点。在人工神经元网络中寻找主分量的方法属于无监督学习方法。   </p>
</li>
</ul>
<h3 id="4、总结"><a href="#4、总结" class="headerlink" title="4、总结"></a>4、总结</h3><p><img src="https://github.com/pingan8787/Leo_MachineLearing/blob/master/1-Python/4-%E3%80%8A%E5%94%90%E5%AE%87%E8%BF%AApython%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E3%80%8B/images/5_0_%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE.png?raw=true" alt="思维导图">   </p>
<h2 id="二、线性回归"><a href="#二、线性回归" class="headerlink" title="二、线性回归"></a>二、线性回归</h2><p>简单解释：最终得到的结果是个具体的数值，成为线性回归。  </p>
<blockquote>
<p>延伸学习 <a href="blog.csdn.net/xbinworld/article/details/43919445">机器学习方法：回归（一）：线性回归Linear regression</a><br>还有一类叫 <code>分类</code> ，这个最终预测的结果是一个类别值，比如这个数值属于A类还是B类。    </p>
</blockquote>
<blockquote>
<p>Sklearn 安装:  </p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install scikit-learn</span><br><span class="line">或者  </span><br><span class="line">conda install scikit-learn</span><br></pre></td></tr></table></figure>

<h3 id="1、回归问题"><a href="#1、回归问题" class="headerlink" title="1、回归问题"></a>1、回归问题</h3><p>例如银行借钱，需要填写 <code>工资</code> 和 <code>年龄</code> 来判断要分配多少 <code>额度</code> ，其中 <code>工资</code> 和 <code>年龄</code> 便称为特征，<code>额度</code> 称为目标。<br><code>hθ</code> ：银行最终借款额度, <code>x1</code> ：工资, <code>x2</code> ：年龄, <code>θ1</code> ：工资的权重参数, <code>θ2</code> ：年龄的权重参数。<br>假设为每一行添加一列权重参数为 <code>x0</code> ，且值为 <code>1</code>。<br><img src="https://github.com/pingan8787/Leo_MachineLearing/blob/master/1-Python/4-%E3%80%8A%E5%94%90%E5%AE%87%E8%BF%AApython%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E3%80%8B/images/5_1_%E5%9B%9E%E5%BD%92%E7%AE%97%E6%B3%95%E7%BB%BC%E8%BF%B0.png?raw=true" alt="线性回归案例1"><br>第二个方程式为将第一个方程式转换成 <code>向量</code> 形式。   </p>
<p><img src="https://github.com/pingan8787/Leo_MachineLearing/blob/master/1-Python/4-%E3%80%8A%E5%94%90%E5%AE%87%E8%BF%AApython%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E3%80%8B/images/5_2_%E5%9B%9E%E5%BD%92%E7%AE%97%E6%B3%95%E7%BB%BC%E8%BF%B0.png?raw=true" alt="线性回归案例2"><br><code>独立同分布</code> ： 每个样本（这里是误差）不相关称为 <code>独立</code> ，每个误差具有相同的分布称为 <code>同分布</code> 。（高斯分布就是正态分布）   </p>
<p><img src="https://github.com/pingan8787/Leo_MachineLearing/blob/master/1-Python/4-%E3%80%8A%E5%94%90%E5%AE%87%E8%BF%AApython%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E3%80%8B/images/5_3_%E5%9B%9E%E5%BD%92%E7%AE%97%E6%B3%95%E7%BB%BC%E8%BF%B0.png?raw=true" alt="线性回归案例3"><br><code>L(θ)</code> ：似然函数，值越大代表模型越好。  </p>
<p>显然求累乘和的难度很高，于是这里引入 <code>对数似然函数</code> ，求解过程如下：<br><img src="https://github.com/pingan8787/Leo_MachineLearing/blob/master/1-Python/4-%E3%80%8A%E5%94%90%E5%AE%87%E8%BF%AApython%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E3%80%8B/images/5_4_%E5%9B%9E%E5%BD%92%E7%AE%97%E6%B3%95%E7%BB%BC%E8%BF%B0.png?raw=true" alt="线性回归案例4"><br><code>J(θ)</code> ：目标函数，值越大代表模型越好。   </p>
<p>对等式两边求导：<br><img src="https://github.com/pingan8787/Leo_MachineLearing/blob/master/1-Python/4-%E3%80%8A%E5%94%90%E5%AE%87%E8%BF%AApython%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E3%80%8B/images/5_5_%E5%9B%9E%E5%BD%92%E7%AE%97%E6%B3%95%E7%BB%BC%E8%BF%B0.png?raw=true" alt="线性回归案例5"><br><code>θ</code> 就是最终要得到的目标结果。  </p>
<h2 id="2、代码实现"><a href="#2、代码实现" class="headerlink" title="2、代码实现"></a>2、代码实现</h2><p>按照上面的结论来写下面的模型就很简单了。  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> datasets</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinearRegression</span>():</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">    self.w = <span class="literal">None</span>   <span class="comment"># w参数就是上面公式里面的 θ</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">fit</span>(<span class="params">self, X, y</span>):</span></span><br><span class="line">    <span class="comment"># Insert constant ones for bias weights  为偏置权重插入常数</span></span><br><span class="line">    <span class="built_in">print</span>(X.shape)</span><br><span class="line">    X = np.insert(X, <span class="number">0</span>, <span class="number">1</span>, axis=<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(X.shape)</span><br><span class="line">    X_ = np.linalg.inv(X.T.dot(X))   <span class="comment"># X_ 表示处理完后的X值</span></span><br><span class="line">    self.w = X_.dot(X.T).dot(y)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">predict</span>(<span class="params">self, X</span>):</span></span><br><span class="line">    <span class="comment"># Insert constant ones for bias weights  为偏置权重插入常数</span></span><br><span class="line">    X =np.insert(X, <span class="number">0</span>, <span class="number">1</span>, axis=<span class="number">1</span>)</span><br><span class="line">    y_pred = X.dot(self.w)</span><br><span class="line">    <span class="keyword">return</span> y_pred</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mean_squared_error</span>(<span class="params">y_true, y_pred</span>):</span></span><br><span class="line">  mse = np.mean(np.power(y_true - y_pred,<span class="number">2</span>))</span><br><span class="line">  <span class="keyword">return</span> mse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">  <span class="comment"># Load the diabetes datasets 加载数据</span></span><br><span class="line">  diabetes = datasets.load_diabetes()</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Use only one feature 只使用一个特性</span></span><br><span class="line">  X = diabetes.data[:, np.newaxis, <span class="number">2</span>]</span><br><span class="line">  <span class="built_in">print</span>(X.shape)</span><br><span class="line">  <span class="comment"># Split the data into training 使用这些数据做测试</span></span><br><span class="line">  <span class="comment"># x_train, y_train 训练集  x_test,y_test 测试集</span></span><br><span class="line">  x_train, x_test = X[:-<span class="number">20</span>],X[-<span class="number">20</span>:] </span><br><span class="line">  y_train, y_test = diabetes.target[:-<span class="number">20</span>],diabetes.target[-<span class="number">20</span>:]</span><br><span class="line">  clf = LinearRegression()</span><br><span class="line">  clf.fit(x_train, y_train)</span><br><span class="line">  y_pred = clf.predict(x_test)</span><br><span class="line"></span><br><span class="line">  <span class="comment">#Print the mean squared error</span></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&quot;Mean Square Error:&quot;</span>,mean_squared_error(y_test, y_pred))</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># Plot the results </span></span><br><span class="line">  plt.scatter(x_test[:,<span class="number">0</span>], y_test, color=<span class="string">&quot;black&quot;</span>)</span><br><span class="line">  plt.plot(x_test[:,<span class="number">0</span>], y_pred, color=<span class="string">&quot;blue&quot;</span>, linewidth=<span class="number">3</span>)</span><br><span class="line">  plt.show()</span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure>

<h2 id="二、Logistic回归（逻辑回归）"><a href="#二、Logistic回归（逻辑回归）" class="headerlink" title="二、Logistic回归（逻辑回归）"></a>二、Logistic回归（逻辑回归）</h2><p>Logistic Regression（逻辑回归）是机器学习中一个非常非常常见的模型，在实际生产环境中也常常被使用，是一种经典的分类模型（不是回归模型）。<br>虽然是种回归，实际是拿来做数据分类，得出每个类别的概率。<br>逻辑回归只能做 <code>二分类问题</code> ，不是A类就是B类。  </p>
<blockquote>
<p>延伸学习 <a target="_blank" rel="noopener" href="http://blog.csdn.net/programmer_wei/article/details/52072939">Logistic Regression（逻辑回归）原理及公式推导</a></p>
</blockquote>
<h3 id="1、逻辑回归问题"><a href="#1、逻辑回归问题" class="headerlink" title="1、逻辑回归问题"></a>1、逻辑回归问题</h3><p>将数据进行分类，这里通过 <code>Sigmoid函数</code> 来说明：<br><img src="https://github.com/pingan8787/Leo_MachineLearing/blob/master/1-Python/4-%E3%80%8A%E5%94%90%E5%AE%87%E8%BF%AApython%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E3%80%8B/images/5_6_%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92.png?raw=true" alt="逻辑回归1">   </p>
<p>其中，传入任意数值 <code>z</code> 到 <code>g(z)</code> 函数都会返回一个 0~1 之间的数值，通过指定 <code>中间阀值</code> （通常是0.5），便将原始数据划分为两类，大于中间阀值0.5的为1这类，小于中间阀值0.5的为0这类。<br>将结果值 <code>g(z)</code> 看作概率，即 <code>Sigmoid函数</code> 可以将任意实数转换为概率。将一个回归问题转换成分类问题。<br><img src="https://github.com/pingan8787/Leo_MachineLearing/blob/master/1-Python/4-%E3%80%8A%E5%94%90%E5%AE%87%E8%BF%AApython%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E3%80%8B/images/5_7_%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92.png?raw=true" alt="逻辑回归2"><br><img src="https://github.com/pingan8787/Leo_MachineLearing/blob/master/1-Python/4-%E3%80%8A%E5%94%90%E5%AE%87%E8%BF%AApython%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E3%80%8B/images/5_8_%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92.png?raw=true" alt="逻辑回归3">   </p>
<h2 id="2、梯度下降"><a href="#2、梯度下降" class="headerlink" title="2、梯度下降"></a>2、梯度下降</h2><blockquote>
<p>参考文章：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/pinard/p/5970503.html">梯度下降（Gradient Descent）小结</a><br>代码实现：（计算那高尔夫球离球洞距离和准确度）</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一、绘制图像</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">pga = pd.read_csv(<span class="string">&quot;../data/pga.csv&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据归一化</span></span><br><span class="line">pga.distance = (pga.distance - pga.distance.mean()) / pga.distance.std()</span><br><span class="line">pga.accuracy = (pga.accuracy - pga.accuracy.mean()) / pga.accuracy.std()</span><br><span class="line"><span class="comment"># 绘图</span></span><br><span class="line">plt.scatter(pga.distance, pga.accuracy)</span><br><span class="line">plt.xlabel(<span class="string">&quot;初始化距离&quot;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&quot;初始化准确值&quot;</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 二、计算梯度下降</span></span><br><span class="line"><span class="comment">## 1、非梯度下降法</span></span><br><span class="line"><span class="comment">## 定义目标函数(损失函数)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cost</span>(<span class="params">theta0, theta, x, y</span>):</span></span><br><span class="line">    J = <span class="number">0</span></span><br><span class="line">    m = <span class="built_in">len</span>(x)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">        h = theta * x[i] + theta0</span><br><span class="line">        J += (h - y[i])**<span class="number">2</span></span><br><span class="line">    J /= (<span class="number">2</span>*m)</span><br><span class="line">    <span class="keyword">return</span> J</span><br><span class="line"><span class="built_in">print</span>(cost(<span class="number">0</span>, <span class="number">1</span>, pga.distance, pga.accuracy))</span><br><span class="line"></span><br><span class="line">theta0 = <span class="number">100</span></span><br><span class="line">thetals = np.linspace(-<span class="number">3</span>, <span class="number">2</span>, <span class="number">100</span>)</span><br><span class="line">costs = []</span><br><span class="line"><span class="keyword">for</span> thetal <span class="keyword">in</span> thetals:</span><br><span class="line">    costs.append(cost(theta0, thetal, pga.distance, pga.accuracy))</span><br><span class="line">plt.plot(thetals, costs)</span><br><span class="line">plt.show()    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 2、梯度下降法</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> mpl_toolkits.mplot3d <span class="keyword">import</span> Axes3D</span><br><span class="line">x = np.linspace(-<span class="number">10</span>, <span class="number">10</span>, <span class="number">100</span>)</span><br><span class="line">y = np.linspace(-<span class="number">10</span>, <span class="number">10</span>, <span class="number">100</span>)</span><br><span class="line">X,Y = np.meshgrid(x, y)</span><br><span class="line">Z = X**<span class="number">2</span> + Y **<span class="number">2</span></span><br><span class="line">fig = plt.figure()</span><br><span class="line">ax = fig.gca(projection=<span class="string">&quot;3d&quot;</span>)</span><br><span class="line">ax.plot_surface(X=X,Y=Y,Z=Z)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line">theta0s = np.linspace(-<span class="number">2</span>, <span class="number">2</span>, <span class="number">100</span>)</span><br><span class="line">theta1s = np.linspace(-<span class="number">2</span>, <span class="number">2</span>, <span class="number">100</span>)</span><br><span class="line">COST = np.empty(shape = (<span class="number">100</span>, <span class="number">100</span>))</span><br><span class="line">TOS, T1S = np.meshgrid(theta0s, theta1s)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">        COST[i, j] = cost(TOS[<span class="number">0</span>, i], T1S[j, <span class="number">0</span>], pga.distance, pga.accuracy)</span><br><span class="line">fig2 = plt.figure()</span><br><span class="line">ax = fig2.gca(projection=<span class="string">&quot;3d&quot;</span>)</span><br><span class="line">ax.plot_surface(X = TOS, Y=T1S, Z=COST)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment">### 对θ0和θ1求偏导</span></span><br><span class="line"><span class="comment">### θ0</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">partial_cost_theta1</span>(<span class="params">theta0, theta1, x, y</span>):</span></span><br><span class="line">    h = theta0 + theta1 * x</span><br><span class="line">    diff = (h - y) * x</span><br><span class="line">    partial = diff.<span class="built_in">sum</span>() / (x.shape[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">return</span> partial</span><br><span class="line"></span><br><span class="line">partial1 = partial_cost_theta1(<span class="number">0</span>, <span class="number">5</span>, pga.distance, pga.accuracy)</span><br><span class="line"></span><br><span class="line"><span class="comment">### θ1</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">partial_cost_theta0</span>(<span class="params">theta0, theta1, x, y</span>):</span></span><br><span class="line">    h = theta0 + theta1 * x</span><br><span class="line">    diff = (h - y)</span><br><span class="line">    partial = diff.<span class="built_in">sum</span>() / (x.shape[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">return</span> partial</span><br><span class="line"></span><br><span class="line">partial1 = partial_cost_theta0(<span class="number">1</span>, <span class="number">1</span>, pga.distance, pga.accuracy)</span><br><span class="line"><span class="comment">### 定义更新函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gradient_descent</span>(<span class="params">x, y, a;pha=<span class="number">0.1</span>, theta0 = <span class="number">0</span>, theta1 = <span class="number">0</span></span>):</span></span><br><span class="line">    max_epochs = <span class="number">1000</span> <span class="comment"># 最大循环次数</span></span><br><span class="line">    counter = <span class="number">0</span>       <span class="comment"># 当前循环次数</span></span><br><span class="line">    c = cost(theta1, theta0, pga.distance, pga.accuracy)  <span class="comment"># 计算当前目标函数值</span></span><br><span class="line">    costs = [c]       <span class="comment"># 添加值作为图像显示</span></span><br><span class="line">    convergence_thres = <span class="number">0.000001</span></span><br><span class="line">    cprev = c + <span class="number">10</span></span><br><span class="line">    theta0s = [theta0]</span><br><span class="line">    theta1s = [theta1]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (np.<span class="built_in">abs</span>(cprev - c) &gt; convergence_thres) <span class="keyword">and</span> (counter &lt; max_epochs):</span><br><span class="line">        cprev = c</span><br><span class="line">        <span class="comment"># 参数更新  导数 * 步长 = 下降距离</span></span><br><span class="line">        update0 = alpha * partial_cost_theta0(theta0, theta1, x, y)</span><br><span class="line">        update1 = alpha * partial_cost_theta1(theta0, theta1, x, y)</span><br><span class="line">        <span class="comment"># 实际更新 梯度下降</span></span><br><span class="line">        theta0 -= update0</span><br><span class="line">        theta1 -= update1</span><br><span class="line">        <span class="comment"># 保存数据</span></span><br><span class="line">        theta0s.append(theta0)</span><br><span class="line">        theta1s.append(theta1)</span><br><span class="line"></span><br><span class="line">        c = cost(theta0, theta1, pga.distance, pga.accuracy)</span><br><span class="line">        costs.append(c)</span><br><span class="line">        counter += <span class="number">1</span>  <span class="comment"># 计算次数</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;theta0&quot;</span>:theta0, <span class="string">&quot;theta1&quot;</span>: theta1, <span class="string">&quot;costs&quot;</span>: costs&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Theta1 = &quot;</span>,gradient_descent(pga.distance, pga.accuracy)[<span class="string">&quot;theta1&quot;</span>])</span><br><span class="line">descend = gradient_descent(pga.distance, pga.accuracy, alpha=<span class="number">.01</span>)</span><br><span class="line">plt.scatter(<span class="built_in">range</span>(<span class="built_in">len</span>(descend[<span class="string">&quot;costs&quot;</span>])),descend[<span class="string">&quot;costs&quot;</span>])</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/01/22/35-%E3%80%90Python%E3%80%91%E5%9B%9E%E5%BD%92%E7%AE%97%E6%B3%95%E6%95%B4%E7%90%86-%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92-%E6%A2%AF%E5%BA%A6%E4%B8%8B%E9%99%8D/" data-id="ckts3ejuo007e4d9k6q351w6i" data-title="35-【Python】回归算法整理[线性回归/梯度下降]" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" rel="tag">人工智能</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-34-【Python】图像绘制工具Seaborn-回归分析绘图" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/01/16/34-%E3%80%90Python%E3%80%91%E5%9B%BE%E5%83%8F%E7%BB%98%E5%88%B6%E5%B7%A5%E5%85%B7Seaborn-%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90%E7%BB%98%E5%9B%BE/" class="article-date">
  <time class="dt-published" datetime="2018-01-16T14:50:14.000Z" itemprop="datePublished">2018-01-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/01/16/34-%E3%80%90Python%E3%80%91%E5%9B%BE%E5%83%8F%E7%BB%98%E5%88%B6%E5%B7%A5%E5%85%B7Seaborn-%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90%E7%BB%98%E5%9B%BE/">34-【Python】图像绘制工具Seaborn[回归分析绘图]</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> scipy <span class="keyword">import</span> stats, integrate</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line"></span><br><span class="line">sns.<span class="built_in">set</span>(color_codes= <span class="literal">True</span>)</span><br><span class="line">np.random.seed(<span class="built_in">sum</span>(<span class="built_in">map</span>(<span class="built_in">ord</span>,<span class="string">&quot;regression&quot;</span>)))</span><br><span class="line"></span><br><span class="line">tips = sns.load_dataset(<span class="string">&quot;tips&quot;</span>)</span><br><span class="line">tips.head()</span><br><span class="line"></span><br><span class="line"><span class="comment">## 绘制回归关系方式有2种</span></span><br><span class="line"><span class="comment"># 1、绘图方式1 regplot() 推荐</span></span><br><span class="line">sns.regplot(x = <span class="string">&quot;total_bill&quot;</span>,y=<span class="string">&quot;tip&quot;</span>,data=tips) <span class="comment"># x x轴数据 y y轴数据 data 当前dataFrame</span></span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、绘图方式2 lmplot()</span></span><br><span class="line">sns.lmplot(x = <span class="string">&quot;total_bill&quot;</span>,y=<span class="string">&quot;tip&quot;</span>,data=tips) <span class="comment"># x x轴数据 y y轴数据 data 当前dataFrame</span></span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、添加抖动值 x_jitter</span></span><br><span class="line">sns.regplot(x = <span class="string">&quot;size&quot;</span>,y=<span class="string">&quot;tip&quot;</span>,data=tips ,x_jitter=<span class="number">.05</span>)  <span class="comment"># x_jitter 使得原始值随机增加发生浮动</span></span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment">## 更多用法 后续学习</span></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/01/16/34-%E3%80%90Python%E3%80%91%E5%9B%BE%E5%83%8F%E7%BB%98%E5%88%B6%E5%B7%A5%E5%85%B7Seaborn-%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90%E7%BB%98%E5%9B%BE/" data-id="ckts3ejuo007c4d9kfovq7eua" data-title="34-【Python】图像绘制工具Seaborn[回归分析绘图]" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" rel="tag">人工智能</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-33-【Python】图像绘制工具Seaborn-分析绘图" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/01/16/33-%E3%80%90Python%E3%80%91%E5%9B%BE%E5%83%8F%E7%BB%98%E5%88%B6%E5%B7%A5%E5%85%B7Seaborn-%E5%88%86%E6%9E%90%E7%BB%98%E5%9B%BE/" class="article-date">
  <time class="dt-published" datetime="2018-01-16T14:49:08.000Z" itemprop="datePublished">2018-01-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/01/16/33-%E3%80%90Python%E3%80%91%E5%9B%BE%E5%83%8F%E7%BB%98%E5%88%B6%E5%B7%A5%E5%85%B7Seaborn-%E5%88%86%E6%9E%90%E7%BB%98%E5%9B%BE/">33-【Python】图像绘制工具Seaborn[分析绘图]</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一、单变量分析绘图</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> scipy <span class="keyword">import</span> stats, integrate</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line"></span><br><span class="line">sns.<span class="built_in">set</span>(color_codes= <span class="literal">True</span>)</span><br><span class="line">np.random.seed(<span class="built_in">sum</span>(<span class="built_in">map</span>(<span class="built_in">ord</span>,<span class="string">&quot;distributions&quot;</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1、绘制直方图</span></span><br><span class="line">x = np.random.normal(size = <span class="number">100</span>)</span><br><span class="line">sns.distplot(x,bins = <span class="number">20</span>,kde=<span class="literal">False</span>,fit=stats.gamma)   <span class="comment"># x 数据 ，bins 间隔，kde 是否和密度估计，fit 绘制当前变化的指标</span></span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、根据均值和协方差绘图</span></span><br><span class="line">mean,cov = [<span class="number">0</span>,<span class="number">1</span>],[(<span class="number">1</span>, <span class="number">.5</span>),(<span class="number">.5</span>, <span class="number">1</span>)]</span><br><span class="line">data = np.random.multivariate_normal(mean, cov, <span class="number">200</span>)</span><br><span class="line">df = pd.DataFrame(data, columns=[<span class="string">&quot;x&quot;</span>,<span class="string">&quot;y&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、绘制散点图</span></span><br><span class="line"><span class="comment">### 观测两个变量之间的关系最好用 散点图</span></span><br><span class="line">sns.jointplot(x=<span class="string">&quot;x&quot;</span>,y=<span class="string">&quot;y&quot;</span>, data = df) <span class="comment">#  jointplot()绘制散点图 x 第一维度 y 第二维度 data 数据</span></span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4、绘制hex图  六边形图 适用于数据量大的</span></span><br><span class="line">x,y = np.random.multivariate_normal(mean, cov, <span class="number">1000</span>).T</span><br><span class="line"><span class="keyword">with</span> sns.axes_style(<span class="string">&quot;white&quot;</span>):</span><br><span class="line">    sns.jointplot(x=x,y=y,kind=<span class="string">&quot;hex&quot;</span>,color=<span class="string">&quot;k&quot;</span>)   <span class="comment"># kin指定格式为hex</span></span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5、绘制四个特征(变量)散点图 展示两两之间的关系</span></span><br><span class="line">iris = sns.load_dataset(<span class="string">&quot;iris&quot;</span>)</span><br><span class="line">sns.pairplot(iris)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ================================ #</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 二、多变量分析绘图</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> scipy <span class="keyword">import</span> stats, integrate</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line">sns.<span class="built_in">set</span>(style=<span class="string">&quot;shitefrid&quot;</span>,color_codes=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">np.random.seed(<span class="built_in">sum</span>(<span class="built_in">map</span>(<span class="built_in">ord</span>,<span class="string">&quot;categorical&quot;</span>)))</span><br><span class="line">titanic = sns.load_dataset(<span class="string">&quot;titanic&quot;</span>)</span><br><span class="line">tips = sns.load_dataset(<span class="string">&quot;tips&quot;</span>)</span><br><span class="line">iris = sns.load_dataset(<span class="string">&quot;iris&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1、绘制 stripplot 图</span></span><br><span class="line">sns.stripplot(x=<span class="string">&quot;day&quot;</span>, y=<span class="string">&quot;total_bill&quot;</span>,data=tips)   <span class="comment"># 这样绘图 点太集中 不好分析</span></span><br><span class="line">sns.stripplot(x=<span class="string">&quot;day&quot;</span>, y=<span class="string">&quot;total_bill&quot;</span>,data=tips, jitter=<span class="literal">True</span>)   <span class="comment"># 添加jitter 更适合分析</span></span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、绘制 swarmplot 图</span></span><br><span class="line">sns.swarmplot(x=<span class="string">&quot;day&quot;</span>, y=<span class="string">&quot;total_bill&quot;</span>,data=tips, hue=<span class="string">&quot;sex&quot;</span>)  <span class="comment"># hue=&quot;sex&quot; 绘制图例</span></span><br><span class="line">sns.swarmplot(x=<span class="string">&quot;total_bill&quot;</span>, y=<span class="string">&quot;day&quot;</span>,data=tips, hue=<span class="string">&quot;time&quot;</span>)  <span class="comment"># hue=&quot;time&quot; 绘制图例</span></span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、绘制 boxplot 图（盒图）</span></span><br><span class="line"><span class="comment">## IQR即统计学概念四分位距，第一/四分位与第三/四分位之间的距离 如100个样本 则去25 和 75 之间距离</span></span><br><span class="line"><span class="comment">## N = 1.5IQR 如果一个值&gt;Q3+N 或 &lt; Q1-N,则为离群点</span></span><br><span class="line">sns.boxplot(x=<span class="string">&quot;day&quot;</span>, y=<span class="string">&quot;total_bill&quot;</span>, hue=<span class="string">&quot;time&quot;</span>, data=tips)</span><br><span class="line">plt.show()</span><br><span class="line"><span class="comment">## 图中 单独的菱形点为离群点 上下横线代表最大最小值</span></span><br><span class="line"><span class="comment">## 横型盒图绘制</span></span><br><span class="line">sns.boxplot(data=iris,orient=<span class="string">&quot;h&quot;</span>)  <span class="comment"># orient=&quot;h&quot; 即指定横型</span></span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4、绘制 violinplot 图 （小提琴图）</span></span><br><span class="line">sns.violinplot(x=<span class="string">&quot;total_bill&quot;</span>, y=<span class="string">&quot;day&quot;</span>, hue=<span class="string">&quot;time&quot;</span>, data=tips)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line">sns.violinplot(x=<span class="string">&quot;day&quot;</span>, y=<span class="string">&quot;total_bill&quot;</span>, hue=<span class="string">&quot;sex&quot;</span>, data=tips,split=<span class="literal">True</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5、多种图组合</span></span><br><span class="line">sns.violinplot(x=<span class="string">&quot;day&quot;</span>, y=<span class="string">&quot;total_bill&quot;</span>, data=tips, inner=<span class="literal">None</span>)</span><br><span class="line">sns.swarmplot(x=<span class="string">&quot;day&quot;</span>, y=<span class="string">&quot;total_bill&quot;</span>,data=tips, color=<span class="string">&quot;w&quot;</span>, alpha=<span class="number">.5</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6、绘制 barplot 柱形图</span></span><br><span class="line">sns.barplot(x=<span class="string">&quot;sex&quot;</span>, y=<span class="string">&quot;survived&quot;</span>, hue=<span class="string">&quot;class&quot;</span>,data=titanic)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7、绘制 pointplot 点图</span></span><br><span class="line"><span class="comment">## 更好的描述变化差异</span></span><br><span class="line">sns.pointplot(x = <span class="string">&quot;sex&quot;</span>, y = <span class="string">&quot;survived&quot;</span>, hue=<span class="string">&quot;class&quot;</span>, data=titanic)</span><br><span class="line">plt.show()</span><br><span class="line"><span class="comment">## 比较好看的点图设置</span></span><br><span class="line">sns.pointplot(x=<span class="string">&quot;class&quot;</span>, y=<span class="string">&quot;survived&quot;</span>, hue=<span class="string">&quot;sex&quot;</span>, data=titanic, palette=&#123;<span class="string">&quot;male&quot;</span>:<span class="string">&quot;g&quot;</span>,<span class="string">&quot;female&quot;</span>:<span class="string">&quot;m&quot;</span>&#125;,markers=[<span class="string">&quot;^&quot;</span>,<span class="string">&quot;o&quot;</span>],linestyles=[<span class="string">&quot;-&quot;</span>,<span class="string">&quot;--&quot;</span>])</span><br><span class="line"><span class="comment">## palette调色板 markers 节点样式 linestyles 线条样式</span></span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 8、绘制 factorplot 图 多层面板分类图</span></span><br><span class="line">sns.factorplot(x=<span class="string">&quot;day&quot;</span>, y=<span class="string">&quot;total_bill&quot;</span>, hue=<span class="string">&quot;smoker&quot;</span>, data=tips)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line">sns.factorplot(x=<span class="string">&quot;day&quot;</span>, y=<span class="string">&quot;total_bill&quot;</span>, hue=<span class="string">&quot;smoker&quot;</span>, data=tips, kind=<span class="string">&quot;bar&quot;</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line">sns.factorplot(x=<span class="string">&quot;day&quot;</span>, y=<span class="string">&quot;total_bill&quot;</span>, hue=<span class="string">&quot;smoker&quot;</span>, data=tips,col=<span class="string">&quot;time&quot;</span>, kind=<span class="string">&quot;swarm&quot;</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line">sns.factorplot(x=<span class="string">&quot;time&quot;</span>, y=<span class="string">&quot;total_bill&quot;</span>, hue=<span class="string">&quot;smoker&quot;</span>, data=tips,col=<span class="string">&quot;day&quot;</span>, kind=<span class="string">&quot;box&quot;</span>, size=<span class="number">4</span>, aspect=<span class="number">.5</span>)</span><br><span class="line"><span class="comment">## col 指定对比类型 aspect 长宽比</span></span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">### Parameters： ###</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">* x,y,hue 数据集变量 变量名</span></span><br><span class="line"><span class="string">* date 数据集 数据集名</span></span><br><span class="line"><span class="string">* row,col 更多分类变量进行平铺显示 变量名</span></span><br><span class="line"><span class="string">* col_wrap 每行的最高平铺数 整数</span></span><br><span class="line"><span class="string">* estimator 在每个分类中进行矢量到标量的映射 矢量</span></span><br><span class="line"><span class="string">* ci 置信区间 浮点数或None</span></span><br><span class="line"><span class="string">* n_boot 计算置信区间时使用的引导迭代次数 整数</span></span><br><span class="line"><span class="string">* units 采样单元的标识符，用于执行多级引导和重复测量设计 数据变量或向量数据</span></span><br><span class="line"><span class="string">* order, hue_order 对应排序列表 字符串列表</span></span><br><span class="line"><span class="string">* row_order, col_order 对应排序列表 字符串列表</span></span><br><span class="line"><span class="string">* kind : 可选：point 默认, bar 柱形图, count 频次, box 箱体, violin 提琴, strip 散点，swarm 分散点</span></span><br><span class="line"><span class="string">size 每个面的高度（英寸） 标量</span></span><br><span class="line"><span class="string">aspect 纵横比 标量</span></span><br><span class="line"><span class="string">orient 方向 &quot;v&quot;/&quot;h&quot;</span></span><br><span class="line"><span class="string">color 颜色 matplotlib颜色</span></span><br><span class="line"><span class="string">palette 调色板 seaborn颜色色板或字典</span></span><br><span class="line"><span class="string">legend hue的信息面板 True/False</span></span><br><span class="line"><span class="string">legend_out 是否扩展图形，并将信息框绘制在中心右边 True/False</span></span><br><span class="line"><span class="string">share&#123;x,y&#125; 共享轴线 True/False</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/01/16/33-%E3%80%90Python%E3%80%91%E5%9B%BE%E5%83%8F%E7%BB%98%E5%88%B6%E5%B7%A5%E5%85%B7Seaborn-%E5%88%86%E6%9E%90%E7%BB%98%E5%9B%BE/" data-id="ckts3ejun00794d9k5m13dita" data-title="33-【Python】图像绘制工具Seaborn[分析绘图]" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" rel="tag">人工智能</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-32-【Python】图像绘制工具Seaborn-调色板" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/01/16/32-%E3%80%90Python%E3%80%91%E5%9B%BE%E5%83%8F%E7%BB%98%E5%88%B6%E5%B7%A5%E5%85%B7Seaborn-%E8%B0%83%E8%89%B2%E6%9D%BF/" class="article-date">
  <time class="dt-published" datetime="2018-01-16T14:48:07.000Z" itemprop="datePublished">2018-01-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/01/16/32-%E3%80%90Python%E3%80%91%E5%9B%BE%E5%83%8F%E7%BB%98%E5%88%B6%E5%B7%A5%E5%85%B7Seaborn-%E8%B0%83%E8%89%B2%E6%9D%BF/">32-【Python】图像绘制工具Seaborn[调色板]</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 调色板 颜色很重要</span></span><br><span class="line"><span class="comment">## color_palette() 能传入任何 Matplotlib 所支持的颜色</span></span><br><span class="line"><span class="comment">## color_palette() 不写参数则默认颜色</span></span><br><span class="line"><span class="comment">## set_palette()设置所有图的颜色</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">sns.<span class="built_in">set</span>(rc = &#123;<span class="string">&quot;figure.figsize&quot;</span>: (<span class="number">6</span>,<span class="number">6</span>)&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 1、分类色板</span></span><br><span class="line"><span class="comment">## 6个默认循环颜色主题：deep, muted, pastel, bright, datk, colorblind</span></span><br><span class="line">current_palette = sns.color_palette()    <span class="comment"># 没有传入颜色 则使用默认</span></span><br><span class="line">sns.palplot(current_palette)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment">## 2、圆形画板</span></span><br><span class="line"><span class="comment">### 即在一个圆形的颜色空间中均匀间隔的分布颜色 最常用的是hls的颜色空间，这是RGB值的一个简单转换</span></span><br><span class="line">sns.palplot(sns.color_palette(<span class="string">&quot;hls&quot;</span>, <span class="number">8</span>))  <span class="comment"># 均匀平分成8份</span></span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line">data = np.random.normal(size=(<span class="number">20</span>, <span class="number">8</span>)) + np.arange(<span class="number">8</span>) / <span class="number">2</span></span><br><span class="line">sns.boxplot(data = data, palette=sns.color_palette(<span class="string">&quot;hls&quot;</span>,<span class="number">8</span>))</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment">### hls_palette() 函数控制颜色的亮度和饱和度</span></span><br><span class="line"><span class="comment">### l - 亮度 lightness</span></span><br><span class="line"><span class="comment">### s - 饱和度 saturation</span></span><br><span class="line">sns.palplot(sns.hls_palette(<span class="number">8</span>, l=<span class="number">.3</span>, s=<span class="number">.8</span>))  <span class="comment"># hls_palette( 颜色数量，亮度，饱和度)</span></span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line">sns.palplot(sns.color_palette(<span class="string">&quot;Paired&quot;</span>,<span class="number">10</span>)) <span class="comment"># Paired 类型表示颜色成对出现，这里出现5对10个</span></span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment">### 使用skcd颜色来命名颜色</span></span><br><span class="line"><span class="comment">### 用得少 查官网来使用</span></span><br><span class="line">plt.plot([<span class="number">0</span>, <span class="number">1</span>],[<span class="number">0</span>, <span class="number">1</span>],sns.xkcd_rgb[<span class="string">&quot;pale_red&quot;</span>], lw = <span class="number">3</span>)</span><br><span class="line">plt.plot([<span class="number">0</span>, <span class="number">1</span>],[<span class="number">0</span>, <span class="number">2</span>],sns.xkcd_rgb[<span class="string">&quot;medium_green&quot;</span>], lw = <span class="number">3</span>)</span><br><span class="line">plt.plot([<span class="number">0</span>, <span class="number">1</span>],[<span class="number">0</span>, <span class="number">3</span>],sns.xkcd_rgb[<span class="string">&quot;denim_blue&quot;</span>], lw = <span class="number">3</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment">## 3、连续画板</span></span><br><span class="line">sns.palplot(sns.color_palette(<span class="string">&quot;Blues&quot;</span>))</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line">sns.palplot(sns.color_palette(<span class="string">&quot;BuGn_r&quot;</span>))  <span class="comment"># 颜色名加 &quot; _r &quot; 表示翻转渐变色</span></span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment">## 4、cubehelix_palette() 调色板</span></span><br><span class="line"><span class="comment">### 色调线性变换</span></span><br><span class="line">sns.palplot(sns.color_palette(<span class="string">&quot;cubehelix&quot;</span>, <span class="number">8</span>))</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line">sns.palplot(sns.cubehelix_palette(<span class="number">8</span>, start=<span class="number">.5</span>, rot=-<span class="number">0.75</span>))  <span class="comment"># start rot 指定颜色区间</span></span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line">sns.palplot(sns.cubehelix_palette(<span class="number">8</span>, start=<span class="number">.75</span>, rot=-<span class="number">.150</span>))</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment">## 5、light_palette() 和 dark_palette 调用定制连续调色板</span></span><br><span class="line">sns.palplot(sns.light_palette(<span class="string">&quot;green&quot;</span>))</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line">sns.palplot(sns.light_palette(<span class="string">&quot;purple&quot;</span>))</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line">sns.palplot(sns.light_palette(<span class="string">&quot;navy&quot;</span>, reverse=<span class="literal">True</span>))  <span class="comment"># reverse 倒序排序颜色</span></span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line">x, y = np.random.multivariate_normal([<span class="number">0</span>, <span class="number">0</span>],[[<span class="number">1</span>,-<span class="number">.5</span>],[-<span class="number">.5</span>,<span class="number">1</span>]],size=<span class="number">300</span>).T</span><br><span class="line">pal = sns.dark_palette(<span class="string">&quot;green&quot;</span>,as_cmap=<span class="literal">True</span>)</span><br><span class="line">sns.kdeplot(x,y,cmap=pal)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line">sns.palplot(sns.light_palette((<span class="number">210</span>,<span class="number">90</span>,<span class="number">60</span>)),<span class="built_in">input</span>=<span class="string">&quot;husl&quot;</span>) <span class="comment"># input 指定颜色空间 基本不用</span></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/01/16/32-%E3%80%90Python%E3%80%91%E5%9B%BE%E5%83%8F%E7%BB%98%E5%88%B6%E5%B7%A5%E5%85%B7Seaborn-%E8%B0%83%E8%89%B2%E6%9D%BF/" data-id="ckts3ejum00774d9k4n7g6qpy" data-title="32-【Python】图像绘制工具Seaborn[调色板]" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" rel="tag">人工智能</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-31-【Python】图像绘制工具Seaborn-简单使用" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/01/16/31-%E3%80%90Python%E3%80%91%E5%9B%BE%E5%83%8F%E7%BB%98%E5%88%B6%E5%B7%A5%E5%85%B7Seaborn-%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/" class="article-date">
  <time class="dt-published" datetime="2018-01-16T14:46:20.000Z" itemprop="datePublished">2018-01-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/01/16/31-%E3%80%90Python%E3%80%91%E5%9B%BE%E5%83%8F%E7%BB%98%E5%88%B6%E5%B7%A5%E5%85%B7Seaborn-%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/">31-【Python】图像绘制工具Seaborn[简单使用]</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 网上文章 [点击打开](http://blog.csdn.net/ice_martin/article/details/61617053)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Seaborn 是在 Matplotlib 基础上的封装，可以简单绘制出精美图像</span></span><br><span class="line"><span class="comment">## 安装 pip install seaborn</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib <span class="keyword">as</span> mpl</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="comment"># %matplotlib inline</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 1、简单使用</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sinplot</span>(<span class="params">flip=<span class="number">10</span></span>):</span></span><br><span class="line">    x = np.linspace(<span class="number">0</span>, <span class="number">14</span>, <span class="number">100</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">7</span>):</span><br><span class="line">        plt.plot(x, np.sin(x + i * <span class="number">.5</span>) * (<span class="number">7</span> - i) * flip)</span><br><span class="line">sinplot()</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment">## 3、Seaborn 自带模版的使用</span></span><br><span class="line"><span class="comment">### Seaborn自带5个模版  darkgrid whitegrid  dark  white  ticks</span></span><br><span class="line">sns.set_style(<span class="string">&quot;whitegrid&quot;</span>)</span><br><span class="line">datas = np.random.normal(size=(<span class="number">20</span>, <span class="number">6</span>))+ np.arange(<span class="number">6</span>)/<span class="number">2</span></span><br><span class="line">sns.boxplot(data = datas)    <span class="comment"># 绘制盒图 数据为 datas</span></span><br><span class="line">sns.despine()                <span class="comment"># 去掉绘图区域上和左边的边框</span></span><br><span class="line">sns.despine(offset = <span class="number">10</span>)     <span class="comment">#  offset = n  所要绘制的图离横轴的距离 n</span></span><br><span class="line">sns.despine(left = <span class="literal">True</span>)     <span class="comment">#  left right top bottom  隐藏对应的轴线</span></span><br><span class="line">sns.despine(<span class="number">3</span>)               <span class="comment"># n 指定第n个子图的风格</span></span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment">## 4、Seaborn 自带布局的使用</span></span><br><span class="line"><span class="comment">### Seaborn自带个布局  paper talk poster notebook</span></span><br><span class="line">sns.set_context(<span class="string">&quot;paper&quot;</span>)</span><br><span class="line"><span class="comment">## 设置字体大小 线宽等</span></span><br><span class="line">sns.set_context(<span class="string">&quot;paper&quot;</span>,font_scale=<span class="number">1.5</span>, rc=&#123;<span class="string">&quot;lines.linewidth&quot;</span>:<span class="number">2.5</span>&#125;)</span><br><span class="line">plt.figure(figsize = (<span class="number">8</span>,<span class="number">6</span>))</span><br><span class="line">sinplot()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/01/16/31-%E3%80%90Python%E3%80%91%E5%9B%BE%E5%83%8F%E7%BB%98%E5%88%B6%E5%B7%A5%E5%85%B7Seaborn-%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/" data-id="ckts3ejul00744d9kgpmn9v8a" data-title="31-【Python】图像绘制工具Seaborn[简单使用]" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" rel="tag">人工智能</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-30-【Python】图像绘制工具Matplotlit介绍3" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/01/14/30-%E3%80%90Python%E3%80%91%E5%9B%BE%E5%83%8F%E7%BB%98%E5%88%B6%E5%B7%A5%E5%85%B7Matplotlit%E4%BB%8B%E7%BB%8D3/" class="article-date">
  <time class="dt-published" datetime="2018-01-14T14:02:02.000Z" itemprop="datePublished">2018-01-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/01/14/30-%E3%80%90Python%E3%80%91%E5%9B%BE%E5%83%8F%E7%BB%98%E5%88%B6%E5%B7%A5%E5%85%B7Matplotlit%E4%BB%8B%E7%BB%8D3/">30-【Python】图像绘制工具Matplotlit介绍3</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## 查看手册 比如设置线条颜色等</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/01/14/30-%E3%80%90Python%E3%80%91%E5%9B%BE%E5%83%8F%E7%BB%98%E5%88%B6%E5%B7%A5%E5%85%B7Matplotlit%E4%BB%8B%E7%BB%8D3/" data-id="ckts3ejul00724d9kar7xhste" data-title="30-【Python】图像绘制工具Matplotlit介绍3" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" rel="tag">人工智能</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-29-【Python】图像绘制工具Matplotlit介绍2" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/01/14/29-%E3%80%90Python%E3%80%91%E5%9B%BE%E5%83%8F%E7%BB%98%E5%88%B6%E5%B7%A5%E5%85%B7Matplotlit%E4%BB%8B%E7%BB%8D2/" class="article-date">
  <time class="dt-published" datetime="2018-01-14T14:01:34.000Z" itemprop="datePublished">2018-01-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/01/14/29-%E3%80%90Python%E3%80%91%E5%9B%BE%E5%83%8F%E7%BB%98%E5%88%B6%E5%B7%A5%E5%85%B7Matplotlit%E4%BB%8B%E7%BB%8D2/">29-【Python】图像绘制工具Matplotlit介绍2</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 0、通用代码</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> arange</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">reviews = pd.read_csv(<span class="string">&quot;fandango_scores.csv&quot;</span>)</span><br><span class="line">num_cols = [<span class="string">&quot;RT_user_norm&quot;</span>,<span class="string">&quot;Metacritic_user_nom&quot;</span>,<span class="string">&quot;IMDB_norm&quot;</span>,<span class="string">&quot;Fandango_Ratingvalue&quot;</span>,<span class="string">&quot;Fandango_Stars&quot;</span>]</span><br><span class="line">norm_reviews = reviews[num_cols]</span><br><span class="line"><span class="built_in">print</span> (norm_reviews[:<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">## 设置中文乱码问题</span></span><br><span class="line"><span class="keyword">from</span> pylab <span class="keyword">import</span> mpl</span><br><span class="line">mpl.rcParams[<span class="string">&#x27;font.sans-serif&#x27;</span>] = [<span class="string">&#x27;SimHei&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1、绘制简单柱状图</span></span><br><span class="line">bar_heights = norm_reviews.ix[<span class="number">0</span>,num_cols].values      <span class="comment">## 每个柱的高度</span></span><br><span class="line">bar_positions = arange(<span class="number">5</span>) + <span class="number">0.75</span>                      <span class="comment">## 每个柱离 0 值的距离</span></span><br><span class="line">fig,ax= plt.subplots()                                <span class="comment">## 把图拿出来  ax 通常用来画图 fig 通常用来设置图</span></span><br><span class="line">ax.bar(bar_positions,bar_heights,<span class="number">0.5</span>)                 <span class="comment"># ax.bar( 离0点横坐标 , 柱高度 , 柱宽度)</span></span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、绘制带有title和label的柱状图</span></span><br><span class="line">bar_heights = norm_reviews.ix[<span class="number">0</span>,num_cols].values      <span class="comment">## 每个柱的高度</span></span><br><span class="line">bar_positions = arange(<span class="number">5</span>) + <span class="number">0.75</span></span><br><span class="line">tick_positions = <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">6</span>)</span><br><span class="line">fig,ax = plt.subplots()</span><br><span class="line"></span><br><span class="line">ax.bar(bar_positions, bar_heights, <span class="number">0.5</span>)               <span class="comment"># ax.bar() 绘制纵向柱状图</span></span><br><span class="line">ax.set_xticks(tick_positions)                         <span class="comment"># 设置 x 轴刻度值</span></span><br><span class="line">ax.set_xticklabels(num_cols,rotation=<span class="number">45</span>)              <span class="comment"># 设置 x 轴刻度值的旋转角度</span></span><br><span class="line">ax.set_xlabel(<span class="string">&quot;Rating Source&quot;</span>)                     <span class="comment"># 设置 x 轴名称</span></span><br><span class="line">ax.set_ylabel(<span class="string">&quot;Average Rating&quot;</span>)                    <span class="comment"># 设置 y 轴名称</span></span><br><span class="line">ax.set_title(<span class="string">&quot;这是标题&quot;</span>)                             <span class="comment"># 设置 图表 标题</span></span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、绘制横向柱状图</span></span><br><span class="line">bar_heights = norm_reviews.ix[<span class="number">0</span>,num_cols].values      <span class="comment">## 每个柱的高度</span></span><br><span class="line">bar_positions = arange(<span class="number">5</span>) + <span class="number">0.75</span></span><br><span class="line">tick_positions = <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">6</span>)</span><br><span class="line">fig,ax = plt.subplots()</span><br><span class="line"></span><br><span class="line">ax.barh(bar_positions, bar_heights, <span class="number">0.5</span>)               <span class="comment"># ax.bar() 绘制横向柱状图</span></span><br><span class="line">ax.set_xticks(tick_positions)                         <span class="comment"># 设置 x 轴刻度值</span></span><br><span class="line">ax.set_xticklabels(num_cols,rotation=<span class="number">45</span>)              <span class="comment"># 设置 x 轴刻度值的旋转角度</span></span><br><span class="line">ax.set_xlabel(<span class="string">&quot;Rating Source&quot;</span>)                     <span class="comment"># 设置 x 轴名称</span></span><br><span class="line">ax.set_ylabel(<span class="string">&quot;Average Rating&quot;</span>)                    <span class="comment"># 设置 y 轴名称</span></span><br><span class="line">ax.set_title(<span class="string">&quot;这是标题&quot;</span>)                             <span class="comment"># 设置 图表 标题</span></span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4、绘制简单散点图</span></span><br><span class="line">fig,ax = plt.subplots()</span><br><span class="line">ax.scatter(norm_reviews[<span class="string">&quot;Fandango_Ratingvalue&quot;</span>], norm_reviews[<span class="string">&quot;RT_user_norm&quot;</span>])</span><br><span class="line">ax.set_xlabel(<span class="string">&quot;Fandango&quot;</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">&quot;Rotten Tomatoes&quot;</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5、绘制含有子图的散点图</span></span><br><span class="line">fig = plt.figure(figsize = (<span class="number">5</span>,<span class="number">10</span>))</span><br><span class="line">ax1 = fig.add_subplot(<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">ax2 = fig.add_subplot(<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">ax1.scatter(norm_reviews[<span class="string">&quot;Fandango_Ratingvalue&quot;</span>],norm_reviews[<span class="string">&quot;RT_user_norm&quot;</span>])</span><br><span class="line">ax1.set_xlabel(<span class="string">&quot;Fandango&quot;</span>)</span><br><span class="line">ax1.seet_ylabel(<span class="string">&quot;Rotten Tomatoes&quot;</span>)</span><br><span class="line">ax2.scatter(norm_reviews[<span class="string">&quot;RT_user_norm&quot;</span>],norm_reviews[<span class="string">&quot;Fandango_Ratingvalue&quot;</span>])</span><br><span class="line">ax2.set_xlabel(<span class="string">&quot;Rotten Tomatoes&quot;</span>)</span><br><span class="line">ax2.seet_ylabel(<span class="string">&quot;Fandango&quot;</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6、绘制简单区间柱形图( 添加 bins )</span></span><br><span class="line"><span class="comment">## 整理数据</span></span><br><span class="line">fandango_distibution = norm_reviews[<span class="string">&quot;Fandango_Ratingvalue&quot;</span>].value_counts()</span><br><span class="line">fandango_distibution = fandango_distibution.sort_index()</span><br><span class="line">imdb_distribution = norm_reviews[<span class="string">&quot;IMDB_norm&quot;</span>].value_counts()</span><br><span class="line">imdb_distribution = imdb_distribution.sort_index()</span><br><span class="line"><span class="comment">## 绘制图形</span></span><br><span class="line">fig, ax = plt.subplots()</span><br><span class="line">ax.hist(norm_reviews[<span class="string">&quot;Fandango_Ratingvalue&quot;</span>])</span><br><span class="line"><span class="comment"># ax.hist(norm_reviews[&quot;Fandango_Ratingvalue&quot;],bins=20)      # 指定 Bins 划分格子数量</span></span><br><span class="line"><span class="comment"># ax.hist(norm_reviews[&quot;Fandango_Ratingvalue&quot;],range=(4, 5),bins=20)  # range(x, y) 取x开始，y结束数据</span></span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7、绘制复杂的区间柱状图</span></span><br><span class="line">fig = plt.figure(figsize=(<span class="number">5</span>,<span class="number">20</span>))</span><br><span class="line">ax1 = fig.add_subplot(<span class="number">4</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">ax2 = fig.add_subplot(<span class="number">4</span>,<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">ax3 = fig.add_subplot(<span class="number">4</span>,<span class="number">1</span>,<span class="number">3</span>)</span><br><span class="line">ax4 = fig.add_subplot(<span class="number">4</span>,<span class="number">1</span>,<span class="number">4</span>)</span><br><span class="line">ax1.hist(norm_reviews[<span class="string">&quot;Fandango_Ratingvalue&quot;</span>],bins = <span class="number">20</span>, <span class="built_in">range</span>=(<span class="number">0</span>, <span class="number">5</span>))</span><br><span class="line">ax1.set_title(<span class="string">&quot;Distribution of Fandango Ratings&quot;</span>)</span><br><span class="line">ax1.set_ylim(<span class="number">0</span>,<span class="number">50</span>)    <span class="comment"># ax.set_ylim(x, y)  设置y轴坐标区间 x开始 y结束</span></span><br><span class="line"></span><br><span class="line">ax2.hist(norm_reviews[<span class="string">&quot;RT_user_norm&quot;</span>],bins = <span class="number">20</span>, <span class="built_in">range</span>=(<span class="number">0</span>, <span class="number">5</span>))</span><br><span class="line">ax2.set_title(<span class="string">&quot;Distribution of Rotten Tomatoes Ratings&quot;</span>)</span><br><span class="line">ax2.set_ylim(<span class="number">0</span>,<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">ax3.hist(norm_reviews[<span class="string">&quot;Metacritic_user_nom&quot;</span>],bins = <span class="number">20</span>, <span class="built_in">range</span>=(<span class="number">0</span>, <span class="number">5</span>))</span><br><span class="line">ax3.set_title(<span class="string">&quot;Distribution of Metacritic Ratings&quot;</span>)</span><br><span class="line">ax3.set_ylim(<span class="number">0</span>,<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">ax4.hist(norm_reviews[<span class="string">&quot;IMDB_norm&quot;</span>],bins = <span class="number">20</span>, <span class="built_in">range</span>=(<span class="number">0</span>, <span class="number">5</span>))</span><br><span class="line">ax4.set_title(<span class="string">&quot;Distribution of IMDB Ratings&quot;</span>)</span><br><span class="line">ax4.set_ylim(<span class="number">0</span>,<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 8、单数据盒图( 四分图 )</span></span><br><span class="line">fig, ax = plt.subplots()</span><br><span class="line">ax.boxplot(norm_reviews[<span class="string">&quot;RT_user_norm&quot;</span>])  <span class="comment"># ax.boxplot( )用来绘制盒图</span></span><br><span class="line">ax.set_xticklabels([<span class="string">&quot;Rotten Tomatoes&quot;</span>])</span><br><span class="line">ax.tick_params(bottom=<span class="string">&quot;off&quot;</span>, top=<span class="string">&quot;off&quot;</span>, left=<span class="string">&quot;off&quot;</span>, right=<span class="string">&quot;off&quot;</span>)</span><br><span class="line">ax.set_ylim(<span class="number">0</span>, <span class="number">5</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 9、多数据盒图( 四分图 )</span></span><br><span class="line">num_cols = [<span class="string">&quot;RT_user_norm&quot;</span>,<span class="string">&quot;Metacritic_user_nom&quot;</span>,<span class="string">&quot;IMDB_norm&quot;</span>,<span class="string">&quot;Fandango_Ratingvalue&quot;</span>]</span><br><span class="line">fig, ax = plt.subplots()</span><br><span class="line">ax.boxplot(norm_reviews[num_cols].values,c=line1_color)  <span class="comment"># ax.boxplot( )用来绘制盒图</span></span><br><span class="line">ax.set_xticklabels(num_cols,rotation=<span class="number">90</span>)</span><br><span class="line">ax.tick_params(bottom=<span class="string">&quot;off&quot;</span>, top=<span class="string">&quot;off&quot;</span>, left=<span class="string">&quot;off&quot;</span>, right=<span class="string">&quot;off&quot;</span>)    <span class="comment"># 去除对应位置的刻度线</span></span><br><span class="line">ax.set_ylim(<span class="number">0</span>, <span class="number">5</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 10、设置折线等的颜色</span></span><br><span class="line">line1_color = (<span class="number">0</span>/<span class="number">255</span>,<span class="number">107</span>/<span class="number">255</span>,<span class="number">164</span>,<span class="number">255</span>)</span><br><span class="line">plt.plot(subset[<span class="string">&quot;MONTH&quot;</span>],subset[<span class="string">&quot;VALUE&quot;</span>],c=line1_color,label=labels)</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/01/14/29-%E3%80%90Python%E3%80%91%E5%9B%BE%E5%83%8F%E7%BB%98%E5%88%B6%E5%B7%A5%E5%85%B7Matplotlit%E4%BB%8B%E7%BB%8D2/" data-id="ckts3ejuk006z4d9k3gek5fsn" data-title="29-【Python】图像绘制工具Matplotlit介绍2" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" rel="tag">人工智能</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/19/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="page-number" href="/page/19/">19</a><span class="page-number current">20</span><a class="page-number" href="/page/21/">21</a><a class="page-number" href="/page/22/">22</a><a class="page-number" href="/page/23/">23</a><a class="extend next" rel="next" href="/page/21/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Angular/" rel="tag">Angular</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/" rel="tag">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS%E5%8A%A8%E7%94%BB/" rel="tag">CSS动画</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Chrome/" rel="tag">Chrome</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES6-ES7-ES8/" rel="tag">ES6/ES7/ES8</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Eslint/" rel="tag">Eslint</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Express/" rel="tag">Express</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GraphQL/" rel="tag">GraphQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/H5/" rel="tag">H5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML/" rel="tag">HTML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/" rel="tag">HTTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP%E5%8D%8F%E8%AE%AE/" rel="tag">HTTP协议</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hybrid/" rel="tag">Hybrid</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NPM/" rel="tag">NPM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nodejs/" rel="tag">Nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Numpy/" rel="tag">Numpy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/" rel="tag">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tensorflow/" rel="tag">Tensorflow</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TyeScript/" rel="tag">TyeScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TypeScript/" rel="tag">TypeScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vuejs/" rel="tag">Vuejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebSocket/" rel="tag">WebSocket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Webpack/" rel="tag">Webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/demo/" rel="tag">demo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" rel="tag">中间件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" rel="tag">人工智能</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/" rel="tag">全栈开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E6%8E%A2%E7%B4%A2/" rel="tag">前端探索</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E7%9F%A5%E4%B9%8E%E7%B3%BB%E5%88%97/" rel="tag">前端知乎系列</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B8%B8%E7%94%A8%E6%8A%80%E6%9C%AF/" rel="tag">常用技术</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BE%AE%E5%89%8D%E7%AB%AF/" rel="tag">微前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%BB%E7%BB%93/" rel="tag">总结</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/" rel="tag">构建工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" rel="tag">正则表达式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BA%90%E7%A0%81/" rel="tag">源码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BA%90%E7%A0%81%E7%B2%BE%E8%AF%BB/" rel="tag">源码精读</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%83%AD%E9%97%A8/" rel="tag">热门</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%94%9F%E6%B4%BB%E6%9D%82%E8%AE%B0/" rel="tag">生活杂记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/" rel="tag">编译原理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/" rel="tag">网络请求</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag">读书笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%87%8D%E6%B8%A9%E5%9F%BA%E7%A1%80/" rel="tag">重温基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" rel="tag">面试题</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Angular/" style="font-size: 11.88px;">Angular</a> <a href="/tags/CSS/" style="font-size: 18.13px;">CSS</a> <a href="/tags/CSS%E5%8A%A8%E7%94%BB/" style="font-size: 12.5px;">CSS动画</a> <a href="/tags/Chrome/" style="font-size: 10px;">Chrome</a> <a href="/tags/ES6-ES7-ES8/" style="font-size: 10.63px;">ES6/ES7/ES8</a> <a href="/tags/Eslint/" style="font-size: 10px;">Eslint</a> <a href="/tags/Express/" style="font-size: 10px;">Express</a> <a href="/tags/GraphQL/" style="font-size: 10px;">GraphQL</a> <a href="/tags/H5/" style="font-size: 10px;">H5</a> <a href="/tags/HTML/" style="font-size: 10px;">HTML</a> <a href="/tags/HTTP/" style="font-size: 11.88px;">HTTP</a> <a href="/tags/HTTP%E5%8D%8F%E8%AE%AE/" style="font-size: 11.25px;">HTTP协议</a> <a href="/tags/Hybrid/" style="font-size: 10.63px;">Hybrid</a> <a href="/tags/JavaScript/" style="font-size: 19.38px;">JavaScript</a> <a href="/tags/NPM/" style="font-size: 10px;">NPM</a> <a href="/tags/Nodejs/" style="font-size: 11.25px;">Nodejs</a> <a href="/tags/Numpy/" style="font-size: 10.63px;">Numpy</a> <a href="/tags/Python/" style="font-size: 17.5px;">Python</a> <a href="/tags/React/" style="font-size: 12.5px;">React</a> <a href="/tags/Tensorflow/" style="font-size: 10.63px;">Tensorflow</a> <a href="/tags/TyeScript/" style="font-size: 10px;">TyeScript</a> <a href="/tags/TypeScript/" style="font-size: 11.25px;">TypeScript</a> <a href="/tags/Vuejs/" style="font-size: 14.38px;">Vuejs</a> <a href="/tags/WebSocket/" style="font-size: 10px;">WebSocket</a> <a href="/tags/Webpack/" style="font-size: 15.63px;">Webpack</a> <a href="/tags/demo/" style="font-size: 10.63px;">demo</a> <a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 10px;">中间件</a> <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" style="font-size: 16.25px;">人工智能</a> <a href="/tags/%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/" style="font-size: 11.25px;">全栈开发</a> <a href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" style="font-size: 20px;">前端开发</a> <a href="/tags/%E5%89%8D%E7%AB%AF%E6%8E%A2%E7%B4%A2/" style="font-size: 11.25px;">前端探索</a> <a href="/tags/%E5%89%8D%E7%AB%AF%E7%9F%A5%E4%B9%8E%E7%B3%BB%E5%88%97/" style="font-size: 10.63px;">前端知乎系列</a> <a href="/tags/%E5%8E%9F%E5%88%9B/" style="font-size: 18.75px;">原创</a> <a href="/tags/%E5%B8%B8%E7%94%A8%E6%8A%80%E6%9C%AF/" style="font-size: 10.63px;">常用技术</a> <a href="/tags/%E5%BE%AE%E5%89%8D%E7%AB%AF/" style="font-size: 10px;">微前端</a> <a href="/tags/%E6%80%BB%E7%BB%93/" style="font-size: 13.75px;">总结</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 10px;">数据结构</a> <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" style="font-size: 15px;">机器学习</a> <a href="/tags/%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/" style="font-size: 10.63px;">构建工具</a> <a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 10.63px;">正则表达式</a> <a href="/tags/%E6%BA%90%E7%A0%81/" style="font-size: 10px;">源码</a> <a href="/tags/%E6%BA%90%E7%A0%81%E7%B2%BE%E8%AF%BB/" style="font-size: 10px;">源码精读</a> <a href="/tags/%E7%83%AD%E9%97%A8/" style="font-size: 10px;">热门</a> <a href="/tags/%E7%94%9F%E6%B4%BB%E6%9D%82%E8%AE%B0/" style="font-size: 10px;">生活杂记</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 13.13px;">算法</a> <a href="/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/" style="font-size: 10px;">编译原理</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/" style="font-size: 10px;">网络请求</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 15px;">设计模式</a> <a href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" style="font-size: 14.38px;">读书笔记</a> <a href="/tags/%E9%87%8D%E6%B8%A9%E5%9F%BA%E7%A1%80/" style="font-size: 16.88px;">重温基础</a> <a href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" style="font-size: 10px;">面试题</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/07/28/227-%E3%80%90%E6%80%BB%E7%BB%93%E3%80%91%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E5%9C%A8%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%BD%BF%E7%94%A8SVG%E5%AD%97%E4%BD%93%E5%9B%BE%E6%A0%87/">227-【总结】如何优雅的在微信小程序使用SVG字体图标</a>
          </li>
        
          <li>
            <a href="/2021/07/28/226-%E3%80%90HTTP%E3%80%91%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E7%AE%A1%E7%90%86HTTP%E8%AF%B7%E6%B1%82%E5%92%8C%E5%93%8D%E5%BA%94%E6%8B%A6%E6%88%AA%E5%99%A8%EF%BC%9F/">226-【HTTP】如何优雅的管理HTTP请求和响应拦截器？</a>
          </li>
        
          <li>
            <a href="/2021/07/28/225-%E3%80%90Vue%E3%80%91%E4%BB%8E%E6%89%8B%E5%86%99Vue3%E7%9A%84Reactivity%E5%BC%80%E5%A7%8B%E6%B7%B1%E5%85%A5Vue3%E6%BA%90%E7%A0%81/">225-【Vue】从手写Vue3的Reactivity开始深入Vue3源码</a>
          </li>
        
          <li>
            <a href="/2021/05/30/224-%E3%80%90Chrome%E3%80%915%E4%B8%AAChrome%E8%B0%83%E8%AF%95%E6%B7%B7%E5%90%88%E5%BA%94%E7%94%A8%E7%9A%84%E6%8A%80%E5%B7%A7/">224-【Chrome】5个Chrome调试混合应用的技巧</a>
          </li>
        
          <li>
            <a href="/2021/03/19/223-%E3%80%90%E5%89%8D%E7%AB%AF%E6%8E%A2%E7%B4%A2%E3%80%91%E6%8E%A2%E7%B4%A2Snabbdom%E6%A8%A1%E5%9D%97%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/">223-【前端探索】探索Snabbdom模块系统原理</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>