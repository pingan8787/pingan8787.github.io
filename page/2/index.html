<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-217-【设计模式】TypeScript设计模式之观察者模式" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/09/22/217-%E3%80%90%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E3%80%91TypeScript%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/" class="article-date">
  <time class="dt-published" datetime="2020-09-22T01:36:55.000Z" itemprop="datePublished">2020-09-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/09/22/217-%E3%80%90%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E3%80%91TypeScript%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/">217-【设计模式】TypeScript设计模式之观察者模式</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>在之前两篇自测清单中，和大家分享了很多 JavaScript 基础知识，大家可以一起再回顾下~</p>
<p>本文是我在我们团队内部“<strong>现代 JavaScript 突击队</strong>”分享的一篇内容，第二期学习内容为“<strong>设计模式</strong>”系列，我会将我负责分享的知识整理成文章输出，希望能够和大家一起温故知新！</p>
<p>“<strong>现代 JavaScript 突击队</strong>”学习总结：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/6846687584710557710">《初中级前端 JavaScript 自测清单 - 1》</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/6857037330113363982">《初中级前端 JavaScript 自测清单 - 2》</a></li>
</ol>
<h1 id="一、模式介绍"><a href="#一、模式介绍" class="headerlink" title="一、模式介绍"></a>一、模式介绍</h1><h2 id="1-背景介绍"><a href="#1-背景介绍" class="headerlink" title="1. 背景介绍"></a>1. 背景介绍</h2><p>在软件系统中经常碰到这类需求：当一个对象的状态发生改变，某些与它相关的对象也要随之做出相应的变化。这是建立一种<strong>对象与对象之间的依赖关系</strong>，一个对象发生改变时将<strong>自动通知其他对象</strong>，其他对象将<strong>相应做出反应</strong>。</p>
<p>我们将发生改变的对象称为<strong>观察目标</strong>，将被通知的对象称为<strong>观察者</strong>，<strong>一个观察目标可以对应多个观察者</strong>，而且这些观察者之间没有相互联系，之后可以根据需要增加和删除观察者，使得系统更易于扩展，这就是观察者模式的产生背景。</p>
<h2 id="2-概念介绍"><a href="#2-概念介绍" class="headerlink" title="2. 概念介绍"></a>2. 概念介绍</h2><p>观察者模式(Observer Pattern)：定义对象间的一种<strong>一对多依赖关系</strong>，使得每当一个对象状态发生改变时，其相关依赖对象皆得到通知并被自动更新。观察者模式是一种对象行为型模式。</p>
<h2 id="3-生活场景"><a href="#3-生活场景" class="headerlink" title="3. 生活场景"></a>3. 生活场景</h2><p>在所有浏览器事件（鼠标悬停，按键等事件）都是观察者模式的例子。</p>
<p>另外还有：</p>
<p>如我们订阅微信公众号“前端自习课”（<strong>观察目标</strong>），当“前端自习课”群发图文消息后，所有公众号粉丝（<strong>观察者</strong>）都会接收到这篇文章（事件），这篇文章的内容是发布者自定义的（自定义事件），粉丝阅读后作出特定操作（如：点赞，收藏，关注等）。</p>
<p><img src="http://images.pingan8787.com/DesignPattern/observer-parttern.png" alt="观察者模式.png"></p>
<h1 id="二、模式特点"><a href="#二、模式特点" class="headerlink" title="二、模式特点"></a>二、模式特点</h1><h2 id="1-模式组成"><a href="#1-模式组成" class="headerlink" title="1. 模式组成"></a>1. 模式组成</h2><p>在观察者模式中，通常包含以下角色：</p>
<ul>
<li><strong>目标：Subject</strong></li>
<li><strong>观察目标：ConcreteSubject</strong></li>
<li><strong>观察者：Observer</strong></li>
<li><strong>具体观察者：ConcreteObserver</strong></li>
</ul>
<h2 id="2-UML-类图"><a href="#2-UML-类图" class="headerlink" title="2. UML 类图"></a>2. UML 类图</h2><p><img src="http://images.pingan8787.com/DesignPattern/observer-UML.png" alt="UML 类图"></p>
<p>图片来源：<a target="_blank" rel="noopener" href="https://www.semlinker.com/ts-observer-pattern/">《TypeScript 设计模式之观察者模式》</a> </p>
<h2 id="3-优点"><a href="#3-优点" class="headerlink" title="3. 优点"></a>3. 优点</h2><ul>
<li>观察者模式可以实现<strong>表示层和数据逻辑层的分离</strong>，并<strong>降低观察目标和观察者之间耦合度</strong>；</li>
<li>观察者模式支持<strong>简单广播通信</strong>，<strong>自动通知</strong>所有已经订阅过的对象；</li>
<li>观察者模式<strong>符合“开闭原则”的要求</strong>；</li>
<li>观察目标和观察者之间的抽象耦合关系能够<strong>单独扩展以及重用</strong>。</li>
</ul>
<h2 id="4-缺点"><a href="#4-缺点" class="headerlink" title="4. 缺点"></a>4. 缺点</h2><ul>
<li>当一个观察目标<strong>有多个直接或间接的观察者</strong>时，通知所有观察者的过程将会花费很多时间；</li>
<li>当观察目标和观察者之间存在<strong>循环依赖</strong>时，观察目标会触发它们之间进行循环调用，可能<strong>导致系统崩溃</strong>。</li>
<li>观察者模式缺少相应机制，让观察者知道所观察的目标对象是怎么发生变化的，而仅仅只是知道观察目标发生了变化。</li>
</ul>
<h1 id="三、使用场景"><a href="#三、使用场景" class="headerlink" title="三、使用场景"></a>三、使用场景</h1><p>在以下情况下可以使用观察者模式：</p>
<ul>
<li>在一个抽象模型中，一个对象的行为<strong>依赖于</strong>另一个对象的状态。即当<strong>目标对象</strong>的状态发生改变时，会直接影响到<strong>观察者</strong>的行为；</li>
<li>一个对象需要通知其他对象发生反应，但不知道这些对象是谁。</li>
<li>需要在系统中创建一个触发链，A对象的行为将影响B对象，B对象的行为将影响C对象……，可以使用观察者模式创建一种链式触发机制。</li>
</ul>
<h1 id="四、实战示例"><a href="#四、实战示例" class="headerlink" title="四、实战示例"></a>四、实战示例</h1><h2 id="1-简单示例"><a href="#1-简单示例" class="headerlink" title="1. 简单示例"></a>1. 简单示例</h2><ol>
<li><p>定义<strong>观察目标接口</strong>（Subject）和<strong>观察者接口</strong>（Observer）</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ObserverPattern.ts</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 观察目标接口</span></span><br><span class="line"><span class="keyword">interface</span> Subject &#123;</span><br><span class="line">  <span class="attr">addObserver</span>: <span class="function">(<span class="params">observer: Observer</span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">  deleteObserver: <span class="function">(<span class="params">observer: Observer</span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">  notifyObservers: <span class="function">() =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 观察者接口</span></span><br><span class="line"><span class="keyword">interface</span> Observer &#123;</span><br><span class="line">  <span class="attr">notify</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>定义<strong>具体观察目标类</strong>（ConcreteSubject）</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ObserverPattern.ts</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体观察目标类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteSubject</span> <span class="title">implements</span> <span class="title">Subject</span></span>&#123; </span><br><span class="line">  <span class="keyword">private</span> observers: Observer[] = [];</span><br><span class="line">	</span><br><span class="line">  <span class="comment">// 添加观察者</span></span><br><span class="line">  <span class="keyword">public</span> addObserver(observer: Observer): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(observer, <span class="string">&quot; is pushed~~&quot;</span>);</span><br><span class="line">    <span class="built_in">this</span>.observers.push(observer);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 移除观察者</span></span><br><span class="line">  <span class="keyword">public</span> deleteObserver(observer: Observer): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(observer, <span class="string">&quot; have deleted~~&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> idx: <span class="built_in">number</span> = <span class="built_in">this</span>.observers.indexOf(observer);</span><br><span class="line">    ~idx &amp;&amp; <span class="built_in">this</span>.observers.splice(idx, <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 通知观察者</span></span><br><span class="line">  <span class="keyword">public</span> notifyObservers(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;notify all the observers &quot;</span>, <span class="built_in">this</span>.observers);</span><br><span class="line">    <span class="built_in">this</span>.observers.forEach(<span class="function"><span class="params">observer</span> =&gt;</span> &#123; </span><br><span class="line">      <span class="comment">// 调用 notify 方法时可以携带指定参数</span></span><br><span class="line">      observer.notify();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>定义<strong>具体观察者类</strong>（ConcreteObserver）</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ObserverPattern.ts</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体观</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteObserver</span> <span class="title">implements</span> <span class="title">Observer</span></span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">private</span> name: <span class="built_in">string</span></span>)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">  notify(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="comment">// 可以处理其他逻辑</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span> has been notified.`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<ol start="4">
<li>测试代码<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ObserverPattern.ts</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useObserver</span>(<span class="params"></span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> subject: Subject = <span class="keyword">new</span> ConcreteSubject();</span><br><span class="line">  <span class="keyword">const</span> Leo   = <span class="keyword">new</span> ConcreteObserver(<span class="string">&quot;Leo&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> Robin = <span class="keyword">new</span> ConcreteObserver(<span class="string">&quot;Robin&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> Pual  = <span class="keyword">new</span> ConcreteObserver(<span class="string">&quot;Pual&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> Lisa  = <span class="keyword">new</span> ConcreteObserver(<span class="string">&quot;Lisa&quot;</span>);</span><br><span class="line"></span><br><span class="line">  subject.addObserver(Leo);</span><br><span class="line">  subject.addObserver(Robin);</span><br><span class="line">  subject.addObserver(Pual);</span><br><span class="line">  subject.addObserver(Lisa);</span><br><span class="line">  subject.notifyObservers();</span><br><span class="line">  </span><br><span class="line">  subject.deleteObserver(Pual);</span><br><span class="line">  subject.deleteObserver(Lisa);</span><br><span class="line">  subject.notifyObservers();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">useObserver();</span><br></pre></td></tr></table></figure></li>
</ol>
<p>完整演示代码如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ObserverPattern.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Subject &#123;</span><br><span class="line">  <span class="attr">addObserver</span>: <span class="function">(<span class="params">observer: Observer</span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">  deleteObserver: <span class="function">(<span class="params">observer: Observer</span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">  notifyObservers: <span class="function">() =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Observer &#123;</span><br><span class="line">  <span class="attr">notify</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteSubject</span> <span class="title">implements</span> <span class="title">Subject</span></span>&#123; </span><br><span class="line">  <span class="keyword">private</span> observers: Observer[] = [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> addObserver(observer: Observer): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(observer, <span class="string">&quot; is pushed~~&quot;</span>);</span><br><span class="line">    <span class="built_in">this</span>.observers.push(observer);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> deleteObserver(observer: Observer): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(observer, <span class="string">&quot; have deleted~~&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> idx: <span class="built_in">number</span> = <span class="built_in">this</span>.observers.indexOf(observer);</span><br><span class="line">    ~idx &amp;&amp; <span class="built_in">this</span>.observers.splice(idx, <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> notifyObservers(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;notify all the observers &quot;</span>, <span class="built_in">this</span>.observers);</span><br><span class="line">    <span class="built_in">this</span>.observers.forEach(<span class="function"><span class="params">observer</span> =&gt;</span> &#123; </span><br><span class="line">      <span class="comment">// 调用 notify 方法时可以携带指定参数</span></span><br><span class="line">      observer.notify();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteObserver</span> <span class="title">implements</span> <span class="title">Observer</span></span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">private</span> name: <span class="built_in">string</span></span>)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">  notify(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="comment">// 可以处理其他逻辑</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span> has been notified.`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useObserver</span>(<span class="params"></span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> subject: Subject = <span class="keyword">new</span> ConcreteSubject();</span><br><span class="line">  <span class="keyword">const</span> Leo   = <span class="keyword">new</span> ConcreteObserver(<span class="string">&quot;Leo&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> Robin = <span class="keyword">new</span> ConcreteObserver(<span class="string">&quot;Robin&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> Pual  = <span class="keyword">new</span> ConcreteObserver(<span class="string">&quot;Pual&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> Lisa  = <span class="keyword">new</span> ConcreteObserver(<span class="string">&quot;Lisa&quot;</span>);</span><br><span class="line"></span><br><span class="line">  subject.addObserver(Leo);</span><br><span class="line">  subject.addObserver(Robin);</span><br><span class="line">  subject.addObserver(Pual);</span><br><span class="line">  subject.addObserver(Lisa);</span><br><span class="line">  subject.notifyObservers();</span><br><span class="line">  </span><br><span class="line">  subject.deleteObserver(Pual);</span><br><span class="line">  subject.deleteObserver(Lisa);</span><br><span class="line">  subject.notifyObservers();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">useObserver();</span><br></pre></td></tr></table></figure>

<h2 id="2-Vue-js-数据双向绑定实现原理"><a href="#2-Vue-js-数据双向绑定实现原理" class="headerlink" title="2. Vue.js 数据双向绑定实现原理"></a>2. Vue.js 数据双向绑定实现原理</h2><p>在 Vue.js 中，当我们修改数据状时，视图随之更新，这就是 Vue.js 的双向数据绑定（也称响应式原理），这是 Vue.js 中最独特的特性之一。<br>如果你对 Vue.js 的双向数据绑定还不清楚，建议先阅读官方文档《<a target="_blank" rel="noopener" href="https://cn.vuejs.org/v2/guide/reactivity.html">深入响应式原理</a>》章节。</p>
<h3 id="2-1-原理介绍"><a href="#2-1-原理介绍" class="headerlink" title="2.1 原理介绍"></a>2.1 原理介绍</h3><p>在官网中提供这么一张流程图，介绍了 Vue.js 响应式系统的整个流程：</p>
<p><img src="http://images.pingan8787.com/DesignPattern/vue-observer.png" alt="原理介绍"><br>图片来自：Vue.js 官网《<a target="_blank" rel="noopener" href="https://cn.vuejs.org/v2/guide/reactivity.html">深入响应式原理</a>》</p>
<p>在 Vue.js 中，每个组件实例都对应一个 watcher 实例，它会在组件渲染的过程中把“接触”（“Touch” 过程）过的数据 property 记录为依赖（Collect as Dependency 过程）。之后当依赖项的 setter 触发时，会通知 watcher（Notify 过程），从而使它关联的组件重新渲染（Trigger re-render 过程）——这是一个典型的观察者模式。</p>
<p>这道面试题考察面试者对 Vue.js 底层原理的理解、对观察者模式的实现能力以及一系列重要的JS知识点，具有较强的综合性和代表性。</p>
<h3 id="2-2-组成部分"><a href="#2-2-组成部分" class="headerlink" title="2.2 组成部分"></a>2.2 组成部分</h3><p>在 Vue.js 数据双向绑定的实现逻辑中，包含三个关键角色：</p>
<ul>
<li>observer（监听器）：这里的 observer 不仅是订阅者（<strong>需要监听数据变化</strong>），同时还是发布者（<strong>对监听的数据进行转发</strong>）。</li>
<li>watcher（订阅者）：watcher对象是**真正的订阅者， **observer 把数据转发给 watcher 对象。watcher 接收到新的数据后，执行视图更新。</li>
<li>compile（编译器）：MVVM 框架特有的角色，负责对每个节点元素指令进行扫描和解析，处理指令的数据初始化、订阅者的创建等操作。</li>
</ul>
<p>这三者的配合过程如图所示：<br><img src="http://images.pingan8787.com/DesignPattern/observer-watcher.png" alt="组成部分"><br>图片来自：掘金小册《JavaScript 设计模式核⼼原理与应⽤实践》</p>
<h3 id="2-3-实现核心代码-observer"><a href="#2-3-实现核心代码-observer" class="headerlink" title="2.3 实现核心代码 observer"></a>2.3 实现核心代码 observer</h3><p>首先我们需要实现一个方法，这个方法会对需要监听的数据对象进行遍历、给它的属性加上定制的 <code>getter</code> 和 <code>setter</code> 函数。这样但凡这个对象的某个属性发生了改变，就会触发 <code>setter</code> 函数，进而通知到订阅者。这个 <code>setter</code> 函数，就是我们的监听器：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// observe方法遍历并包装对象属性</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">observe</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 若target是一个对象，则遍历它</span></span><br><span class="line">    <span class="keyword">if</span>(target &amp;&amp; <span class="keyword">typeof</span> target === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">        <span class="built_in">Object</span>.keys(target).forEach(<span class="function">(<span class="params">key</span>)=&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// defineReactive方法会给目标属性装上“监听器”</span></span><br><span class="line">            defineReactive(target, key, target[key])</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 定义defineReactive方法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">defineReactive</span>(<span class="params">target, key, val</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 属性值也可能是object类型，这种情况下需要调用observe进行递归遍历</span></span><br><span class="line">    observe(val)</span><br><span class="line">    <span class="comment">// 为当前属性安装监听器</span></span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(target, key, &#123;</span><br><span class="line">         <span class="comment">// 可枚举</span></span><br><span class="line">        <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 不可配置</span></span><br><span class="line">        <span class="attr">configurable</span>: <span class="literal">false</span>, </span><br><span class="line">        <span class="attr">get</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> val;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 监听器函数</span></span><br><span class="line">        <span class="attr">set</span>: <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;target&#125;</span>属性的<span class="subst">$&#123;key&#125;</span>属性从<span class="subst">$&#123;val&#125;</span>值变成了了<span class="subst">$&#123;value&#125;</span>`</span>)</span><br><span class="line">            val = value</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面实现订阅者 <code>Dep</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义订阅者类Dep</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dep</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 初始化订阅队列</span></span><br><span class="line">        <span class="built_in">this</span>.subs = []</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 增加订阅者</span></span><br><span class="line">    <span class="function"><span class="title">addSub</span>(<span class="params">sub</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.subs.push(sub)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 通知订阅者（是不是所有的代码都似曾相识？）</span></span><br><span class="line">    <span class="function"><span class="title">notify</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.subs.forEach(<span class="function">(<span class="params">sub</span>)=&gt;</span>&#123;</span><br><span class="line">            sub.update()</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>现在我们可以改写 <code>defineReactive</code> 中的 <code>setter</code> 方法，在监听器里去通知订阅者了：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">defineReactive</span>(<span class="params">target, key, val</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> dep = <span class="keyword">new</span> Dep()</span><br><span class="line">    <span class="comment">// 监听当前属性</span></span><br><span class="line">    observe(val)</span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(target, key, &#123;</span><br><span class="line">        <span class="attr">set</span>: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 通知所有订阅者</span></span><br><span class="line">            dep.notify()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="五、总结"><a href="#五、总结" class="headerlink" title="五、总结"></a>五、总结</h1><p>观察者模式又称发布-订阅模式、模型-视图模式、源-监听器模式或从属者模式。是一种<strong>对象行为型模式</strong>。其定义了一种<strong>对象间的一对多依赖关系</strong>，当观察目标发生状态变化，会通知所有观察者对象，使它们自动更新。</p>
<p>在实际业务中，如果一个对象的行为<strong>依赖于</strong>另一个对象的状态。或者说当<strong>目标对象</strong>的状态发生改变时，会直接影响到<strong>观察者</strong>的行为，尽量考虑到使用观察者模式来实现。</p>
<h1 id="六、拓展"><a href="#六、拓展" class="headerlink" title="六、拓展"></a>六、拓展</h1><p>观察者模式和发布-订阅模式两者很像，但其实区别比较大。例如：</p>
<ul>
<li>耦合度差异：观察者模式的耦合度就比发布-订阅模式要高；</li>
<li>关注点不同：观察者模式需要知道彼此的存在，而发布-订阅模式则是通过调度中心来联系发布/订阅者。</li>
</ul>
<p>下一篇文章见。</p>
<h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><p>1.<a target="_blank" rel="noopener" href="https://design-patterns.readthedocs.io/zh_CN/latest/behavioral_patterns/observer.html">《3. 观察者模式》</a><br>2.<a target="_blank" rel="noopener" href="https://www.semlinker.com/ts-observer-pattern/">《TypeScript 设计模式之观察者模式》</a> <br>3.<a target="_blank" rel="noopener" href="https://juejin.im/book/6844733790204461070">《JavaScript 设计模式核⼼原理与应⽤实践》</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/09/22/217-%E3%80%90%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E3%80%91TypeScript%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/" data-id="ckts3ejua00684d9k3jic01pr" data-title="217-【设计模式】TypeScript设计模式之观察者模式" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-216-【JavaScript】前端如何优雅处理类数组对象" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/09/22/216-%E3%80%90JavaScript%E3%80%91%E5%89%8D%E7%AB%AF%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E5%A4%84%E7%90%86%E7%B1%BB%E6%95%B0%E7%BB%84%E5%AF%B9%E8%B1%A1/" class="article-date">
  <time class="dt-published" datetime="2020-09-22T01:33:54.000Z" itemprop="datePublished">2020-09-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/09/22/216-%E3%80%90JavaScript%E3%80%91%E5%89%8D%E7%AB%AF%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E5%A4%84%E7%90%86%E7%B1%BB%E6%95%B0%E7%BB%84%E5%AF%B9%E8%B1%A1/">216-【JavaScript】前端如何优雅处理类数组对象</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="一、背景介绍"><a href="#一、背景介绍" class="headerlink" title="一、背景介绍"></a>一、背景介绍</h2><p>Leo 部门最近来了位前端实习生 Robin，作为师傅，Leo 认真的为 Robin 介绍了公司业务、部门工作等情况，还有前端的新人学习地图。</p>
<p>接下来 Robin 开始一周愉快的学习啦~</p>
<p>一周后，Leo 为 Robin 同学布置了学习作业，开发一个【人员搜索选择】的页面，效果大致如下：</p>
<p><img src="http://images.pingan8787.com/JavaScript-Base/Learn-Array-Liked-Objects/Learn-Array-Liked-Objects-Demo.gif"></p>
<p>Robin 看完这个效果图后，一脸得意的样子，这确实不难呀~</p>
<p>过几天后，Robin 带着自己写的代码，给 Leo 展示了她的代码，并疑惑的问到：</p>
<p><img src="http://images.pingan8787.com/JavaScript-Base/Learn-Array-Liked-Objects/Learn-Array-Liked-Objects-1.png"></p>
<p>她将这个“数组”输出到控制台：</p>
<p><img src="http://images.pingan8787.com/JavaScript-Base/Learn-Array-Liked-Objects/Learn-Array-Liked-Objects-Code-1.png"></p>
<p>Leo 看了看代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">getUserList</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="keyword">const</span> memberList = $(<span class="string">&#x27;#MemberList li&#x27;</span>);</span><br><span class="line">   memberList.map(<span class="function"><span class="params">item</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(item) &#125;);</span><br><span class="line">   <span class="built_in">console</span>.log(memberList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Leo 又问到：</p>
<p><img src="http://images.pingan8787.com/JavaScript-Base/Learn-Array-Liked-Objects/Learn-Array-Liked-Objects-2.png"></p>
<p>Robin 一脸疑惑，然后 Leo 再原来代码上，加了个 <code>Array.from</code> 方法如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">getUserList</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> memberList = <span class="built_in">Array</span>.from($(<span class="string">&#x27;#MemberList li&#x27;</span>));</span><br><span class="line">    memberList.map(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(item)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">console</span>.log(memberList)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后重新执行代码，输出下面结果：</p>
<p><img src="http://images.pingan8787.com/JavaScript-Base/Learn-Array-Liked-Objects/Learn-Array-Liked-Objects-Code-2.png"></p>
<p>Leo 输出的结果，跟 Robin 说到：</p>
<p><img src="http://images.pingan8787.com/JavaScript-Base/Learn-Array-Liked-Objects/Learn-Array-Liked-Objects-3.png"></p>
<p>Robin 满脸期待望着师傅，对<strong>类数组对象</strong>更加充满期待。</p>
<h2 id="二、类数组对象介绍"><a href="#二、类数组对象介绍" class="headerlink" title="二、类数组对象介绍"></a>二、类数组对象介绍</h2><h3 id="2-1-概念介绍"><a href="#2-1-概念介绍" class="headerlink" title="2.1 概念介绍"></a>2.1 概念介绍</h3><p>所谓 <strong>类数组对象</strong>，即格式与数组结构类似，拥有 <code>length</code> 属性，可以通过<strong>索引</strong>来访问或设置里面的元素，但是不能使用数组的方法，就可以归类为<strong>类数组对象</strong>。</p>
<p>举个例子🌰：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arrLike = &#123;</span><br><span class="line">  <span class="number">0</span>: <span class="string">&#x27;name&#x27;</span>,</span><br><span class="line">  <span class="number">1</span>: <span class="string">&#x27;age&#x27;</span>,</span><br><span class="line">  <span class="number">2</span>: <span class="string">&#x27;job&#x27;</span>,</span><br><span class="line">  <span class="attr">length</span>: <span class="number">3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-常见类数组对象"><a href="#2-2-常见类数组对象" class="headerlink" title="2.2 常见类数组对象"></a>2.2 常见类数组对象</h3><ul>
<li><code>arguments</code> 对象；</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">arguments</span>;</span><br><span class="line">&#125;</span><br><span class="line">f(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Arguments(3) [1, 2, 3, callee: ƒ, Symbol(Symbol.iterator): ƒ]</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>NodeList</code>（比如 <code>document.getElementsByClassName(&#39;a&#39;)</code> 得到的结果；</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementsByTagName(<span class="string">&#x27;img&#x27;</span>)</span><br><span class="line"><span class="comment">// HTMLCollection(3) [img, img, img]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><code>typedArray</code>（比如 <code>Int32Array</code>）；</li>
</ul>
<p>typedArray 即  **<br>对象** 是一种类似数组的对象，它提供了一种用于访问原始二进制数据的机制。JavaScript引擎会做一些内部优化，以便对数组的操作可以很快。然而，随着Web应用程序变得越来越强大，尤其一些新增加的功能例如：音频视频编辑，访问WebSockets的原始数据等，很明显有些时候如果使用JavaScript代码可以快速方便地通过类型化数组来操作原始的二进制数据将会非常有帮助。 ——<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Typed_arrays"> 《MDN 类型化数组》</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> typedArray = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line"><span class="comment">// Uint8Array(4) [1, 2, 3, 4]</span></span><br></pre></td></tr></table></figure>

<p>另外使用 jQuery 获取元素，会被 jQuery 做特殊处理成为 init 类型：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;img&#x27;</span>)</span><br><span class="line"><span class="comment">// init(3) [img, img, img, prevObject: init(1), context: document, selector: &quot;img&quot;]</span></span><br></pre></td></tr></table></figure>

<p>当然还有一些不常见的类数组对象，比如“Storage API 返回的结果”，这里就不一一列出。</p>
<h2 id="三、类数组对象属性"><a href="#三、类数组对象属性" class="headerlink" title="三、类数组对象属性"></a>三、类数组对象属性</h2><p>下面通过 Robin 代码作为示例，介绍类数组对象的属性：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> memberList = $(<span class="string">&#x27;#MemberList li&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="3-1-读写"><a href="#3-1-读写" class="headerlink" title="3.1 读写"></a>3.1 读写</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读取</span></span><br><span class="line">memberList[<span class="number">0</span>];</span><br><span class="line"><span class="comment">// Node: &lt;li&gt;...&lt;/li&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 写入</span></span><br><span class="line">memberList[<span class="number">0</span>] = <span class="built_in">document</span>.createElement(<span class="string">&quot;div&quot;</span>)</span><br><span class="line">memberList[<span class="number">0</span>];</span><br><span class="line"><span class="comment">//  Node: &lt;div&gt;...&lt;/div&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-长度"><a href="#3-2-长度" class="headerlink" title="3.2 长度"></a>3.2 长度</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">memberList.length; </span><br><span class="line"><span class="comment">// 10</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-遍历"><a href="#3-3-遍历" class="headerlink" title="3.3 遍历"></a>3.3 遍历</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>;i &lt; memberList.length; i++)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(memberList[i]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	Node: &lt;li&gt;...&lt;/li&gt;</span></span><br><span class="line"><span class="comment">	Node: &lt;li&gt;...&lt;/li&gt;</span></span><br><span class="line"><span class="comment">  ... 共10个，省略其他</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">memberList.map(<span class="function"><span class="params">item</span> =&gt;</span> <span class="built_in">console</span>.log(item));</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	0</span></span><br><span class="line"><span class="comment">  ... 共10个，省略其他</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>但如果是 <code>HTMLCollection</code> 就不能使用 <code>map</code> 咯：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> img = <span class="built_in">document</span>.getElementsByTagName(<span class="string">&quot;img&quot;</span>);</span><br><span class="line">img.map(<span class="function"><span class="params">item</span> =&gt;</span> <span class="built_in">console</span>.log(item));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Uncaught TypeError: img.map is not a function</span></span><br></pre></td></tr></table></figure>

<h2 id="四、类数组对象处理"><a href="#四、类数组对象处理" class="headerlink" title="四、类数组对象处理"></a>四、类数组对象处理</h2><p>Leo 看了看 Robin 处理这个列表的代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">getUserList</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> memberList = $(<span class="string">&#x27;#MemberList li&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> result = &#123;</span><br><span class="line">        <span class="attr">text</span>: [],</span><br><span class="line">        <span class="attr">dom</span> : [],</span><br><span class="line">    &#125;;</span><br><span class="line">    memberList.map(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        item = memberList[item]</span><br><span class="line">        <span class="comment">// 判断当前节点是否有 checked 类名</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">console</span>.log(result)</span><br><span class="line">    <span class="built_in">this</span>.showToast(<span class="string">`选中成员：<span class="subst">$&#123;result.text&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>很明显，Robin 并没有对 jQuery 获取到的 <code>memberList</code> 做处理，直接使用，通过索引来获取对应值。<br>Leo 继续和 Robin 介绍到：<br><img src="http://images.pingan8787.com/JavaScript-Base/Learn-Array-Liked-Objects/Learn-Array-Liked-Objects-4.png"></p>
<h3 id="4-1-Array-from"><a href="#4-1-Array-from" class="headerlink" title="4.1 Array.from"></a>4.1 Array.from</h3><p>使用 <code>Array.from</code> 来将类数组对象转为数组对象，操作起来非常简单：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">getUserList</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> memberList = <span class="built_in">Array</span>.from($(<span class="string">&#x27;#MemberList li&#x27;</span>));</span><br><span class="line">    <span class="comment">// 省略其他代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其<strong>语法</strong>如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.from(arrayLike[, mapFn[, thisArg]])</span><br></pre></td></tr></table></figure>
<p><strong>参数</strong>：</p>
<ol>
<li><code>arrayLike</code> 想要转换成数组的伪数组对象或可迭代对象。</li>
<li><code>mapFn</code> 可选如果指定了该参数，新数组中的每个元素会执行该回调函数。</li>
<li><code>thisArg</code> 可选可选参数，执行回调函数 <code>mapFn</code> 时 <code>this</code> 对象。</li>
</ol>
<p><strong>返回值</strong>：<br>一个新的数组实例。</p>
<p>更多<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/from"> <code>Array.from</code> </a> 介绍可以查看文档。</p>
<h3 id="4-2-Array-prototype-slice-call"><a href="#4-2-Array-prototype-slice-call" class="headerlink" title="4.2 Array.prototype.slice.call()"></a>4.2 Array.prototype.slice.call()</h3><p><code>slice()</code> 方法返回一个新的数组对象，这一对象是一个由 <code>begin</code> 和 <code>end</code> 决定的原数组的<strong>浅拷贝</strong>（包括 <code>begin</code>，不包括<code>end</code>）。<strong>原始数组不会被改变</strong>。</p>
<p>实现代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">getUserList</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> memberList = <span class="built_in">Array</span>.prototype.slice.call($(<span class="string">&#x27;#MemberList li&#x27;</span>));</span><br><span class="line">    <span class="comment">// 省略其他代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>更多 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/slice">Array.prototype.slice</a> 介绍可以查看文档。</p>
<h3 id="4-3-ES6展开运算符"><a href="#4-3-ES6展开运算符" class="headerlink" title="4.3 ES6展开运算符"></a>4.3 ES6展开运算符</h3><p>展开语法(Spread syntax), 可以在函数调用/数组构造时, <strong>将数组表达式或者string在语法层面展开</strong>；还可以在构造字面量对象时, 将对象表达式按<code>key-value</code>的方式展开。</p>
<p>实现代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">getUserList</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> memberList = [...document.getElementsByTagName(<span class="string">&quot;li&quot;</span>)];</span><br><span class="line">    <span class="comment">// 省略其他代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>更多 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Spread_syntax">ES6展开运算符</a> 介绍可以查看文档。</p>
<h3 id="4-4-利用concat-apply"><a href="#4-4-利用concat-apply" class="headerlink" title="4.4 利用concat+apply"></a>4.4 利用concat+apply</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">getUserList</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> memberList = <span class="built_in">Array</span>.prototype.concat.apply([], $(<span class="string">&#x27;#MemberList li&#x27;</span>));</span><br><span class="line">    <span class="comment">// 省略其他代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="五、案例小结"><a href="#五、案例小结" class="headerlink" title="五、案例小结"></a>五、案例小结</h2><p>Leo 介绍完这些知识后，Robin 又优化了下自己的代码，涉及<strong>到类数组对象操作的</strong>核心 js 代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SelectMember</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.MockUsers = <span class="built_in">window</span>.MockUsers;</span><br><span class="line">        <span class="built_in">this</span>.init();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">init</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.initMemberList(<span class="string">&#x27;#MemberList&#x27;</span>, <span class="built_in">this</span>.MockUsers);</span><br><span class="line">        <span class="built_in">this</span>.initBindEvent();</span><br><span class="line">    &#125;</span><br><span class="line">	  <span class="comment">// ... 省略部分代码，保留核心代码</span></span><br><span class="line">    <span class="function"><span class="title">submitSelect</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> memberList = <span class="built_in">Array</span>.from($(<span class="string">&#x27;#MemberList li&#x27;</span>));</span><br><span class="line">        <span class="keyword">const</span> result = &#123;</span><br><span class="line">            <span class="attr">text</span>: [],</span><br><span class="line">            <span class="attr">dom</span> : [],</span><br><span class="line">        &#125;;</span><br><span class="line">        memberList.map(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> hasClass = $(item).children(<span class="string">&#x27;.round-checkbox&#x27;</span>).children(<span class="string">&#x27;span&#x27;</span>).hasClass(<span class="built_in">this</span>.selectClassName);</span><br><span class="line">            <span class="keyword">if</span>(hasClass)&#123;</span><br><span class="line">                result.text.push($(item).children(<span class="string">&#x27;.user-data&#x27;</span>).children(<span class="string">&#x27;h4&#x27;</span>).text());</span><br><span class="line">                result.dom.push(item);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="built_in">this</span>.showToast(<span class="string">`选中成员：<span class="subst">$&#123;result.text&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> newMember = <span class="keyword">new</span> SelectMember();</span><br></pre></td></tr></table></figure>
<p>很明显，使用正确方式来处理类数组对象，不仅能使我们代码更加少，减少转换处理，还能提高代码质量。</p>
<p>整个项目的完整代码，可以在<a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo-JavaScript/blob/master/Cute-Demo/10.Learn-Array-Liked-Objects/index.html">我的 github 查看</a>：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo-JavaScript/blob/master/Cute-Demo/10.Learn-Array-Liked-Objects/index.html">https://github.com/pingan8787/Leo-JavaScript/blob/master/Cute-Demo/10.Learn-Array-Liked-Objects/index.html</a></p>
<h2 id="六、总结"><a href="#六、总结" class="headerlink" title="六、总结"></a>六、总结</h2><p>本文我们通过一个实际场景，详细介绍了类数组对象在实际开发中的使用，对于常见的类数组对象，我们还介绍了处理方式，能很大程度减少我们处理类数组对象的操作，将类数组统一转成数组，更加方便对数据的操作。<br>希望看完本文的你，以后再遇到类数组对象，不会再一脸懵逼咯~~~</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/09/22/216-%E3%80%90JavaScript%E3%80%91%E5%89%8D%E7%AB%AF%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E5%A4%84%E7%90%86%E7%B1%BB%E6%95%B0%E7%BB%84%E5%AF%B9%E8%B1%A1/" data-id="ckts3ejua00654d9kh74j1eg0" data-title="216-【JavaScript】前端如何优雅处理类数组对象" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-215-【JavaScript】初中级前端JavaScript自测清单-2" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/08/05/215-%E3%80%90JavaScript%E3%80%91%E5%88%9D%E4%B8%AD%E7%BA%A7%E5%89%8D%E7%AB%AFJavaScript%E8%87%AA%E6%B5%8B%E6%B8%85%E5%8D%95-2/" class="article-date">
  <time class="dt-published" datetime="2020-08-05T13:56:55.000Z" itemprop="datePublished">2020-08-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/08/05/215-%E3%80%90JavaScript%E3%80%91%E5%88%9D%E4%B8%AD%E7%BA%A7%E5%89%8D%E7%AB%AFJavaScript%E8%87%AA%E6%B5%8B%E6%B8%85%E5%8D%95-2/">215-【JavaScript】初中级前端JavaScript自测清单-2</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>在<a target="_blank" rel="noopener" href="https://juejin.im/post/6846687584710557710">《初中级前端 JavaScript 自测清单 - 1》</a>部分中，和大家简单过了一遍 JavaScript 基础知识，没看过的朋友可以回顾一下😁</p>
<p>本系列文章是我在我们团队内部的“<strong>现代 JavaScript 突击队</strong>”，第一期学习内容为<a target="_blank" rel="noopener" href="https://zh.javascript.info/">《现代 JavaScript 教程》</a>系列的<strong>第二部分</strong>输出内容，希望这份自测清单，能够帮助大家巩固知识，温故知新。</p>
<p>本部分内容，以 <strong>JavaScript 对象</strong>为主，大致包括以下内容：<br><img src="http://images.pingan8787.com/JavaScript-Base/section2/xmind.png" alt="初中级前端 JavaScript 自测清单 2.png"></p>
<h1 id="一、对象"><a href="#一、对象" class="headerlink" title="一、对象"></a>一、对象</h1><p>JavaScript 有八种数据额类型，有七种原始类型，它们值只包含一种类型（字符串，数字或其他），而对象是用来<strong>保存键值对和更复杂实体。</strong><br>我们可以通过使用带有可选<strong>属性列表</strong>的花括号 <code>**&#123;...&#125;**</code> 来创建对象，一个属性就是一个键值对 <code>&#123;&quot;key&quot; : &quot;value&quot;&#125;</code> ，其中键（ <code>key</code> ）是一个字符串（或称属性名），值（ <code>value</code> ）可以是任何类型。</p>
<h2 id="1-创建对象"><a href="#1-创建对象" class="headerlink" title="1. 创建对象"></a>1. 创建对象</h2><p>我们可以使用 2 种方式来创建一个新对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 通过“构造函数”创建</span></span><br><span class="line"><span class="keyword">let</span> user = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 通过“字面量”创建</span></span><br><span class="line"><span class="keyword">let</span> user = &#123;&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="2-对象文本和属性"><a href="#2-对象文本和属性" class="headerlink" title="2. 对象文本和属性"></a>2. 对象文本和属性</h2><p>创建对象时，可以初始化对象的一些属性：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123;</span><br><span class="line">	<span class="attr">name</span> : <span class="string">&#x27;leo&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>  : <span class="number">18</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后可以对该对象进行属性对<strong>增删改查</strong>操作：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 增加属性</span></span><br><span class="line">user.addr = <span class="string">&quot;China&quot;</span>;</span><br><span class="line"><span class="comment">// user =&gt; &#123;name: &quot;leo&quot;, age: 18, addr: &quot;China&quot;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除属性</span></span><br><span class="line"><span class="keyword">delete</span> user.addr</span><br><span class="line"><span class="comment">// user =&gt; &#123;name: &quot;leo&quot;, age: 18&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改属性</span></span><br><span class="line">user.age  = <span class="number">20</span>;</span><br><span class="line"><span class="comment">// user =&gt; &#123;name: &quot;leo&quot;, age: 20&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 查找属性</span></span><br><span class="line">user.age;</span><br><span class="line"><span class="comment">// 20</span></span><br></pre></td></tr></table></figure>

<h2 id="3-方括号的使用"><a href="#3-方括号的使用" class="headerlink" title="3. 方括号的使用"></a>3. 方括号的使用</h2><p>当然对象的键（ <code>key</code> ）也可以是多词属性，但必须加引号，使用的时候，必须使用方括号（ <code>[]</code> ）读取：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123;</span><br><span class="line">	<span class="attr">name</span> : <span class="string">&#x27;leo&#x27;</span>,</span><br><span class="line">  <span class="string">&quot;my interest&quot;</span> : [<span class="string">&quot;coding&quot;</span>, <span class="string">&quot;football&quot;</span>, <span class="string">&quot;cycling&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">user[<span class="string">&quot;my interest&quot;</span>]; <span class="comment">// [&quot;coding&quot;, &quot;football&quot;, &quot;cycling&quot;]</span></span><br><span class="line"><span class="keyword">delete</span> user[<span class="string">&quot;my interest&quot;</span>];</span><br></pre></td></tr></table></figure>

<p>我们也可以在方括号中使用变量，来获取属性值：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> key = <span class="string">&quot;name&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> user = &#123;</span><br><span class="line">	<span class="attr">name</span> : <span class="string">&quot;leo&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>  : <span class="number">18</span> </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ok</span></span><br><span class="line">user[key]; <span class="comment">// &quot;leo&quot;</span></span><br><span class="line">user[key] = <span class="string">&quot;pingan&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// error</span></span><br><span class="line">user.key; <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>

<h2 id="4-计算属性"><a href="#4-计算属性" class="headerlink" title="4. 计算属性"></a>4. 计算属性</h2><p>创建对象时，可以在对象字面量中使用方括号，即 <strong>计算属性</strong> ：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> key = <span class="string">&quot;name&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> inputKey = prompt(<span class="string">&quot;请输入key&quot;</span>, <span class="string">&quot;age&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> user = &#123;</span><br><span class="line">	[key] : <span class="string">&quot;leo&quot;</span>,</span><br><span class="line">  [inputKey] : <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 当用户在 prompt 上输入 &quot;age&quot; 时，user 变成下面样子：</span></span><br><span class="line"><span class="comment">// &#123;name: &quot;leo&quot;, age: 18&#125;</span></span><br></pre></td></tr></table></figure>
<p>当然，计算属性也可以是表达式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> key = <span class="string">&quot;name&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> user = &#123;</span><br><span class="line">	[<span class="string">&quot;my_&quot;</span> + key] : <span class="string">&quot;leo&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">user[<span class="string">&quot;my_&quot;</span> + key]; <span class="comment">// &quot;leo&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="5-属性名简写"><a href="#5-属性名简写" class="headerlink" title="5. 属性名简写"></a>5. 属性名简写</h2><p>实际开发中，可以将相同的属性名和属性值简写成更短的语法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 原本书写方式</span></span><br><span class="line"><span class="keyword">let</span> getUser = <span class="function"><span class="keyword">function</span>(<span class="params">name, age</span>)</span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		<span class="attr">name</span>: name,</span><br><span class="line">    <span class="attr">age</span>: age</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 简写方式</span></span><br><span class="line"><span class="keyword">let</span> getUser = <span class="function"><span class="keyword">function</span>(<span class="params">name, age</span>)</span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		name,</span><br><span class="line">    age</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也可以混用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 原本书写方式</span></span><br><span class="line"><span class="keyword">let</span> getUser = <span class="function"><span class="keyword">function</span>(<span class="params">name, age</span>)</span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		<span class="attr">name</span>: name,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 简写方式</span></span><br><span class="line"><span class="keyword">let</span> getUser = <span class="function"><span class="keyword">function</span>(<span class="params">name, age</span>)</span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		name,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-对象属性存在性检测"><a href="#6-对象属性存在性检测" class="headerlink" title="6. 对象属性存在性检测"></a>6. 对象属性存在性检测</h2><h3 id="6-1-使用-in-关键字"><a href="#6-1-使用-in-关键字" class="headerlink" title="6.1 使用 in 关键字"></a>6.1 使用 in 关键字</h3><p>该方法可以判断<strong>对象的自有属性和继承来的属性</strong>是否存在。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123;<span class="attr">name</span>: <span class="string">&quot;leo&quot;</span>&#125;;</span><br><span class="line"><span class="string">&quot;name&quot;</span> <span class="keyword">in</span> user;            <span class="comment">//true，自有属性存在</span></span><br><span class="line"><span class="string">&quot;age&quot;</span>  <span class="keyword">in</span> user;            <span class="comment">//false</span></span><br><span class="line"><span class="string">&quot;toString&quot;</span> <span class="keyword">in</span> user;     <span class="comment">//true，是一个继承属性</span></span><br></pre></td></tr></table></figure>

<h3 id="6-2使用对象的-hasOwnProperty-方法。"><a href="#6-2使用对象的-hasOwnProperty-方法。" class="headerlink" title="6.2使用对象的 hasOwnProperty() 方法。"></a>6.2使用对象的 hasOwnProperty() 方法。</h3><p>该方法只能判断<strong>自有属性</strong>是否存在，对于<strong>继承属性</strong>会返回 <code>false</code> 。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123;<span class="attr">name</span>: <span class="string">&quot;leo&quot;</span>&#125;;</span><br><span class="line">user.hasOwnProperty(<span class="string">&quot;name&quot;</span>);       <span class="comment">//true，自有属性中有 name</span></span><br><span class="line">user.hasOwnProperty(<span class="string">&quot;age&quot;</span>);        <span class="comment">//false，自有属性中不存在 age</span></span><br><span class="line">user.hasOwnProperty(<span class="string">&quot;toString&quot;</span>);   <span class="comment">//false，这是一个继承属性，但不是自有属性</span></span><br></pre></td></tr></table></figure>

<h3 id="6-3-用-undefined-判断"><a href="#6-3-用-undefined-判断" class="headerlink" title="6.3 用 undefined 判断"></a>6.3 用 undefined 判断</h3><p>该方法可以判断对象的<strong>自有属性和继承属性</strong>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123;<span class="attr">name</span>: <span class="string">&quot;leo&quot;</span>&#125;;</span><br><span class="line">user.name !== <span class="literal">undefined</span>;        <span class="comment">// true</span></span><br><span class="line">user.age  !== <span class="literal">undefined</span>;        <span class="comment">// false</span></span><br><span class="line">user.toString !== <span class="literal">undefined</span>     <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>该方法存在一个问题，如果属性的值就是 <code>undefined</code>  的话，该方法不能返回想要的结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123;<span class="attr">name</span>: <span class="literal">undefined</span>&#125;;</span><br><span class="line">user.name !== <span class="literal">undefined</span>;        <span class="comment">// false，属性存在，但值是undefined</span></span><br><span class="line">user.age  !== <span class="literal">undefined</span>;        <span class="comment">// false</span></span><br><span class="line">user.toString !== <span class="literal">undefined</span>;    <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h3 id="6-4-在条件语句中直接判断"><a href="#6-4-在条件语句中直接判断" class="headerlink" title="6.4 在条件语句中直接判断"></a>6.4 在条件语句中直接判断</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123;&#125;;</span><br><span class="line"><span class="keyword">if</span>(user.name) user.name = <span class="string">&quot;pingan&quot;</span>;</span><br><span class="line"><span class="comment">//如果 name 是 undefine, null, false, &quot; &quot;, 0 或 NaN,它将保持不变</span></span><br><span class="line"></span><br><span class="line">user; <span class="comment">// &#123;&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="7-对象循环遍历"><a href="#7-对象循环遍历" class="headerlink" title="7. 对象循环遍历"></a>7. 对象循环遍历</h2><p>当我们需要遍历对象中每一个属性，可以使用 <code>for...in</code> 语句来实现</p>
<h3 id="7-1-for…in-循环"><a href="#7-1-for…in-循环" class="headerlink" title="7.1 for…in 循环"></a>7.1 for…in 循环</h3><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/for...in"><code>for...in</code></a> 语句以任意顺序遍历一个对象的除 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol"><code>Symbol</code></a> 以外的<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Enumerability_and_ownership_of_properties">可枚举</a>属性。<br><strong>注意</strong> ： <code>for...in</code> 不应该应用在一个数组，其中索引顺序很重要。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123;</span><br><span class="line">	<span class="attr">name</span> : <span class="string">&quot;leo&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>  : <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> k <span class="keyword">in</span> user)&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(k, user[k]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// name leo</span></span><br><span class="line"><span class="comment">// age 18</span></span><br></pre></td></tr></table></figure>

<h3 id="7-2-ES7-新增方法"><a href="#7-2-ES7-新增方法" class="headerlink" title="7.2 ES7 新增方法"></a>7.2 ES7 新增方法</h3><p>ES7中新增加的 <code>Object.values()</code>和<code>Object.entries()</code>与之前的<code>Object.keys()</code>类似，返回数组类型。</p>
<h4 id="1-Object-keys"><a href="#1-Object-keys" class="headerlink" title="1. Object.keys()"></a>1. Object.keys()</h4><p>返回一个数组，成员是参数对象自身的（不含继承的）所有<strong>可遍历属性</strong>的健名。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123; <span class="attr">name</span>: <span class="string">&quot;leo&quot;</span>, <span class="attr">age</span>: <span class="number">18</span>&#125;;</span><br><span class="line"><span class="built_in">Object</span>.keys(user); <span class="comment">// [&quot;name&quot;, &quot;age&quot;]</span></span><br></pre></td></tr></table></figure>

<h4 id="2-Object-values"><a href="#2-Object-values" class="headerlink" title="2. Object.values()"></a>2. Object.values()</h4><p>返回一个数组，成员是参数对象自身的（不含继承的）所有可遍历属性的键值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123; <span class="attr">name</span>: <span class="string">&quot;leo&quot;</span>, <span class="attr">age</span>: <span class="number">18</span>&#125;;</span><br><span class="line"><span class="built_in">Object</span>.values(user); <span class="comment">// [&quot;leo&quot;, 18]</span></span><br></pre></td></tr></table></figure>

<p>如果参数不是对象，则返回空数组：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Object.values(10);   // []</span><br><span class="line">Object.values(true); // []</span><br></pre></td></tr></table></figure>

<h4 id="3-Object-entries"><a href="#3-Object-entries" class="headerlink" title="3. Object.entries()"></a>3. Object.entries()</h4><p>返回一个数组，成员是参数对象自身的（不含继承的）所有<strong>可遍历属性</strong>的键值对数组。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123; <span class="attr">name</span>: <span class="string">&quot;leo&quot;</span>, <span class="attr">age</span>: <span class="number">18</span>&#125;;</span><br><span class="line"><span class="built_in">Object</span>.entries(user);</span><br><span class="line"><span class="comment">// [[&quot;name&quot;,&quot;leo&quot;],[&quot;age&quot;,18]]</span></span><br></pre></td></tr></table></figure>

<p>手动实现<code>Object.entries()</code>方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Generator函数实现：  </span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">entries</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">of</span> <span class="built_in">Object</span>.keys(obj))&#123;</span><br><span class="line">        <span class="keyword">yield</span> [k ,obj[k]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 非Generator函数实现：</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">entries</span> (<span class="params">obj</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> arr = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> k <span class="keyword">of</span> <span class="built_in">Object</span>.keys(obj))&#123;</span><br><span class="line">        arr.push([k, obj[k]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-Object-getOwnPropertyNames-Obj"><a href="#4-Object-getOwnPropertyNames-Obj" class="headerlink" title="4. Object.getOwnPropertyNames(Obj)"></a>4. Object.getOwnPropertyNames(Obj)</h4><p>该方法返回一个数组，它包含了对象 <code>Obj</code> 所有拥有的属性（<strong>无论是否可枚举</strong>）的名称。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123; <span class="attr">name</span>: <span class="string">&quot;leo&quot;</span>, <span class="attr">age</span>: <span class="number">18</span>&#125;;</span><br><span class="line"><span class="built_in">Object</span>.getOwnPropertyNames(user);</span><br><span class="line"><span class="comment">// [&quot;name&quot;, &quot;age&quot;]</span></span><br></pre></td></tr></table></figure>

<h1 id="二、对象拷贝"><a href="#二、对象拷贝" class="headerlink" title="二、对象拷贝"></a>二、对象拷贝</h1><p>参考文章<a target="_blank" rel="noopener" href="https://juejin.im/post/5d235d1ef265da1b855c7b5d">《搞不懂JS中赋值·浅拷贝·深拷贝的请看这里》</a></p>
<h2 id="1-赋值操作"><a href="#1-赋值操作" class="headerlink" title="1. 赋值操作"></a>1. 赋值操作</h2><p>首先回顾下基本数据类型和引用数据类型：</p>
<ul>
<li>基本类型</li>
</ul>
<p>概念：基本类型值在内存中占据固定大小，保存在<code>栈内存</code>中（不包含<code>闭包</code>中的变量）。<br>常见包括：undefined,null,Boolean,String,Number,Symbol</p>
<ul>
<li>引用类型</li>
</ul>
<p>概念：引用类型的值是对象，保存在<code>堆内存</code>中。而栈内存存储的是对象的变量标识符以及对象在堆内存中的存储地址(引用)，引用数据类型在栈中存储了指针，该指针指向堆中该实体的起始地址。当解释器寻找引用值时，会首先检索其在栈中的地址，取得地址后从堆中获得实体。<br>常见包括：Object,Array,Date,Function,RegExp等</p>
<h3 id="1-1-基本数据类型赋值"><a href="#1-1-基本数据类型赋值" class="headerlink" title="1.1 基本数据类型赋值"></a>1.1 基本数据类型赋值</h3><p>在栈内存中的数据发生数据变化的时候，系统会自动为新的变量分配一个新的之值在栈内存中，两个变量相互独立，互不影响的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user  = <span class="string">&quot;leo&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> user1 = user;</span><br><span class="line">user1 = <span class="string">&quot;pingan&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(user);  <span class="comment">// &quot;leo&quot;</span></span><br><span class="line"><span class="built_in">console</span>.log(user1); <span class="comment">// &quot;pingan&quot; </span></span><br></pre></td></tr></table></figure>

<h3 id="1-2-引用数据类型赋值"><a href="#1-2-引用数据类型赋值" class="headerlink" title="1.2 引用数据类型赋值"></a>1.2 引用数据类型赋值</h3><p>在 JavaScript 中，变量不存储对象本身，而是存储其“内存中的地址”，换句话说就是存储对其的“引用”。<br>如下面 <code>leo</code>  变量只是保存对<code>user</code> 对象对应引用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123; <span class="attr">name</span>: <span class="string">&quot;leo&quot;</span>, <span class="attr">age</span>: <span class="number">18</span>&#125;;</span><br><span class="line"><span class="keyword">let</span> leo  = user;</span><br></pre></td></tr></table></figure>
<p>其他变量也可以引用 <code>user</code> 对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> leo1 = user;</span><br><span class="line"><span class="keyword">let</span> leo2 = user;</span><br></pre></td></tr></table></figure>
<p>但是由于变量保存的是引用，所以当我们修改变量 <code>leo</code> \ <code>leo1</code> \ <code>leo2</code> 这些值时，<strong>也会改动到引用对象</strong> <code>user</code> ，但当 <code>user</code> 修改，则其他引用该对象的变量，值都会发生变化：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">leo.name = <span class="string">&quot;pingan&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(leo);   <span class="comment">// &#123;name: &quot;pingan&quot;, age: 18&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(leo1);  <span class="comment">// &#123;name: &quot;pingan&quot;, age: 18&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(leo2);  <span class="comment">// &#123;name: &quot;pingan&quot;, age: 18&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(user);  <span class="comment">// &#123;name: &quot;pingan&quot;, age: 18&#125;</span></span><br><span class="line"></span><br><span class="line">user.name = <span class="string">&quot;pingan8787&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(leo);   <span class="comment">// &#123;name: &quot;pingan8787&quot;, age: 18&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(leo1);  <span class="comment">// &#123;name: &quot;pingan8787&quot;, age: 18&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(leo2);  <span class="comment">// &#123;name: &quot;pingan8787&quot;, age: 18&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(user);  <span class="comment">// &#123;name: &quot;pingan8787&quot;, age: 18&#125;</span></span><br></pre></td></tr></table></figure>
<p>这个过程中涉及变量地址指针指向问题，这里暂时不展开讨论，有兴趣的朋友可以网上查阅相关资料。</p>
<h2 id="2-对象比较"><a href="#2-对象比较" class="headerlink" title="2. 对象比较"></a>2. 对象比较</h2><p>当两个变量引用同一个对象时，它们无论是 <code>==</code> 还是 <code>===</code> 都会返回 <code>true</code> 。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123; <span class="attr">name</span>: <span class="string">&quot;leo&quot;</span>, <span class="attr">age</span>: <span class="number">18</span>&#125;;</span><br><span class="line"><span class="keyword">let</span> leo  = user;</span><br><span class="line"><span class="keyword">let</span> leo1 = user;</span><br><span class="line">leo ==  leo1;   <span class="comment">// true</span></span><br><span class="line">leo === leo1;   <span class="comment">// true</span></span><br><span class="line">leo ==  user;   <span class="comment">// true</span></span><br><span class="line">leo === user;   <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>但如果两个变量是空对象 <code>&#123;&#125;</code> ，则不相等：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> leo1 = &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> leo2 = &#123;&#125;;</span><br><span class="line">leo1 ==  leo2;  <span class="comment">// false</span></span><br><span class="line">leo1 === leo2;  <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<h2 id="3-浅拷贝"><a href="#3-浅拷贝" class="headerlink" title="3. 浅拷贝"></a>3. 浅拷贝</h2><h3 id="3-1-概念"><a href="#3-1-概念" class="headerlink" title="3.1 概念"></a>3.1 概念</h3><p>概念：<strong>新的对象复制已有对象中非对象属性的值和对象属性的引用</strong>。也可以理解为：<strong>一个新的对象直接拷贝已存在的对象的对象属性的引用</strong>，即浅拷贝。</p>
<p>浅拷贝<strong>只对第一层属性进行了拷贝</strong>，当第一层的属性值是基本数据类型时，新的对象和原对象互不影响，但是如果第一层的属性值是复杂数据类型，那么新对象和原对象的属性值其指向的是同一块内存地址。</p>
<p>通过示例代码演示没有使用浅拷贝场景：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例1 对象原始拷贝</span></span><br><span class="line"><span class="keyword">let</span> user = &#123; <span class="attr">name</span>: <span class="string">&quot;leo&quot;</span>, <span class="attr">skill</span>: &#123; <span class="attr">JavaScript</span>: <span class="number">90</span>, <span class="attr">CSS</span>: <span class="number">80</span>&#125;&#125;;</span><br><span class="line"><span class="keyword">let</span> leo = user;</span><br><span class="line">leo.name = <span class="string">&quot;leo1&quot;</span>;</span><br><span class="line">leo.skill.CSS = <span class="number">90</span>;</span><br><span class="line"><span class="built_in">console</span>.log(leo.name);      <span class="comment">// &quot;leo1&quot;</span></span><br><span class="line"><span class="built_in">console</span>.log(user.name);     <span class="comment">// &quot;leo1&quot;</span></span><br><span class="line"><span class="built_in">console</span>.log(leo.skill.CSS); <span class="comment">// 90</span></span><br><span class="line"><span class="built_in">console</span>.log(user.skill.CSS);<span class="comment">// 90</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例2 数组原始拷贝</span></span><br><span class="line"><span class="keyword">let</span> user = [<span class="string">&quot;leo&quot;</span>, <span class="string">&quot;pingan&quot;</span>, &#123;<span class="attr">name</span>: <span class="string">&quot;pingan8787&quot;</span>&#125;];</span><br><span class="line"><span class="keyword">let</span> leo  = user;</span><br><span class="line">leo[<span class="number">0</span>] = <span class="string">&quot;pingan888&quot;</span>;</span><br><span class="line">leo[<span class="number">2</span>][<span class="string">&quot;name&quot;</span>] = <span class="string">&quot;pingan999&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(leo[<span class="number">0</span>]);          <span class="comment">// &quot;pingan888&quot;</span></span><br><span class="line"><span class="built_in">console</span>.log(user[<span class="number">0</span>]);         <span class="comment">// &quot;pingan888&quot;</span></span><br><span class="line"><span class="built_in">console</span>.log(leo[<span class="number">2</span>][<span class="string">&quot;name&quot;</span>]);  <span class="comment">// &quot;pingan999&quot;</span></span><br><span class="line"><span class="built_in">console</span>.log(user[<span class="number">2</span>][<span class="string">&quot;name&quot;</span>]); <span class="comment">// &quot;pingan999&quot;</span></span><br></pre></td></tr></table></figure>
<p>从上面示例代码可以看出：<br>由于对象被直接拷贝，相当于拷贝 <strong>引用数据类型</strong> ，所以在新对象修改任何值时，都会改动到源数据。</p>
<p>接下来实现浅拷贝，对比以下。</p>
<h3 id="3-2-实现浅拷贝"><a href="#3-2-实现浅拷贝" class="headerlink" title="3.2 实现浅拷贝"></a>3.2 实现浅拷贝</h3><h4 id="1-Object-assign"><a href="#1-Object-assign" class="headerlink" title="1. Object.assign()"></a>1. Object.assign()</h4><p>语法： <code>Object.assign(target, ...sources)</code><br>ES6中拷贝对象的方法，接受的第一个参数是拷贝的目标target，剩下的参数是拷贝的源对象sources（可以是多个）。<br>详细介绍，可以阅读文档<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/assign">《MDN Object.assign》</a>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例1 对象浅拷贝</span></span><br><span class="line"><span class="keyword">let</span> user = &#123; <span class="attr">name</span>: <span class="string">&quot;leo&quot;</span>, <span class="attr">skill</span>: &#123; <span class="attr">JavaScript</span>: <span class="number">90</span>, <span class="attr">CSS</span>: <span class="number">80</span>&#125;&#125;;</span><br><span class="line"><span class="keyword">let</span> leo = <span class="built_in">Object</span>.assign(&#123;&#125;, user);</span><br><span class="line">leo.name = <span class="string">&quot;leo1&quot;</span>;</span><br><span class="line">leo.skill.CSS = <span class="number">90</span>;</span><br><span class="line"><span class="built_in">console</span>.log(leo.name);      <span class="comment">// &quot;leo1&quot; ⚠️ 差异！</span></span><br><span class="line"><span class="built_in">console</span>.log(user.name);     <span class="comment">// &quot;leo&quot;  ⚠️ 差异！</span></span><br><span class="line"><span class="built_in">console</span>.log(leo.skill.CSS); <span class="comment">// 90</span></span><br><span class="line"><span class="built_in">console</span>.log(user.skill.CSS);<span class="comment">// 90</span></span><br></pre></td></tr></table></figure>
<p>从打印结果可以看出，浅拷贝只是在根属性(对象的第一层级)创建了一个新的对象，但是对于属性的值是对象的话只会拷贝一份相同的内存地址。</p>
<p><code>Object.assign()</code> 使用注意：</p>
<ul>
<li>只拷贝源对象的自身属性（不拷贝继承属性）；</li>
<li>不会拷贝对象不可枚举的属性；</li>
<li>属性名为<code>Symbol</code> 值的属性，可以被Object.assign拷贝；</li>
<li><code>undefined</code>和<code>null</code>无法转成对象，它们不能作为<code>Object.assign</code>参数，但是可以作为源对象。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.assign(<span class="literal">undefined</span>); <span class="comment">// 报错</span></span><br><span class="line"><span class="built_in">Object</span>.assign(<span class="literal">null</span>);      <span class="comment">// 报错</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.assign(&#123;&#125;, <span class="literal">undefined</span>); <span class="comment">// &#123;&#125;</span></span><br><span class="line"><span class="built_in">Object</span>.assign(&#123;&#125;, <span class="literal">null</span>);      <span class="comment">// &#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> user = &#123;<span class="attr">name</span>: <span class="string">&quot;leo&quot;</span>&#125;;</span><br><span class="line"><span class="built_in">Object</span>.assign(user, <span class="literal">undefined</span>) === user; <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Object</span>.assign(user, <span class="literal">null</span>)      === user; <span class="comment">// true</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-Array-prototype-slice"><a href="#2-Array-prototype-slice" class="headerlink" title="2. Array.prototype.slice()"></a>2. Array.prototype.slice()</h4><p>语法： <code>arr.slice([begin[, end]])</code><br><code>slice()</code> 方法返回一个新的数组对象，这一对象是一个由 <code>begin</code> 和 <code>end</code> 决定的原数组的浅拷贝（包括 <code>begin</code>，不包括<code>end</code>）。原始数组不会被改变。<br>详细介绍，可以阅读文档<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/slice">《MDN Array slice》</a>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例 数组深拷贝</span></span><br><span class="line"><span class="keyword">let</span> user = [<span class="string">&quot;leo&quot;</span>, <span class="string">&quot;pingan&quot;</span>, &#123;<span class="attr">name</span>: <span class="string">&quot;pingan8787&quot;</span>&#125;];</span><br><span class="line"><span class="keyword">let</span> leo  = <span class="built_in">Array</span>.prototype.slice.call(user);</span><br><span class="line">leo[<span class="number">0</span>] = <span class="string">&quot;pingan888&quot;</span>;</span><br><span class="line">leo[<span class="number">2</span>][<span class="string">&quot;name&quot;</span>] = <span class="string">&quot;pingan999&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(leo[<span class="number">0</span>]);          <span class="comment">// &quot;pingan888&quot;  ⚠️ 差异！</span></span><br><span class="line"><span class="built_in">console</span>.log(user[<span class="number">0</span>]);         <span class="comment">// &quot;leo&quot;        ⚠️ 差异！</span></span><br><span class="line"><span class="built_in">console</span>.log(leo[<span class="number">2</span>][<span class="string">&quot;name&quot;</span>]);  <span class="comment">// &quot;pingan999&quot;</span></span><br><span class="line"><span class="built_in">console</span>.log(user[<span class="number">2</span>][<span class="string">&quot;name&quot;</span>]); <span class="comment">// &quot;pingan999&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-Array-prototype-concat"><a href="#3-Array-prototype-concat" class="headerlink" title="3. Array.prototype.concat()"></a>3. Array.prototype.concat()</h4><p>语法： <code>var new_array = old_array.concat(value1[, value2[, ...[, valueN]]])</code><br><code>concat()</code> 方法用于合并两个或多个数组。此方法不会更改现有数组，而是返回一个新数组。<br>详细介绍，可以阅读文档<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/concat">《MDN Array concat》</a>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user  = [&#123;<span class="attr">name</span>: <span class="string">&quot;leo&quot;</span>&#125;,   &#123;<span class="attr">age</span>: <span class="number">18</span>&#125;];</span><br><span class="line"><span class="keyword">let</span> user1 = [&#123;<span class="attr">age</span>: <span class="number">20</span>&#125;,&#123;<span class="attr">addr</span>: <span class="string">&quot;fujian&quot;</span>&#125;];</span><br><span class="line"><span class="keyword">let</span> user2 = user.concat(user1);</span><br><span class="line">user1[<span class="number">0</span>][<span class="string">&quot;age&quot;</span>] = <span class="number">25</span>;</span><br><span class="line"><span class="built_in">console</span>.log(user);  <span class="comment">// [&#123;&quot;name&quot;:&quot;leo&quot;&#125;,&#123;&quot;age&quot;:18&#125;]</span></span><br><span class="line"><span class="built_in">console</span>.log(user1); <span class="comment">// [&#123;&quot;age&quot;:25&#125;,&#123;&quot;addr&quot;:&quot;fujian&quot;&#125;]</span></span><br><span class="line"><span class="built_in">console</span>.log(user2); <span class="comment">// [&#123;&quot;name&quot;:&quot;leo&quot;&#125;,&#123;&quot;age&quot;:18&#125;,&#123;&quot;age&quot;:25&#125;,&#123;&quot;addr&quot;:&quot;fujian&quot;&#125;]</span></span><br></pre></td></tr></table></figure>
<p><code>Array.prototype.concat</code> 也是一个浅拷贝，只是在根属性(对象的第一层级)创建了一个新的对象，但是对于属性的值是对象的话只会拷贝一份相同的内存地址。</p>
<h4 id="4-拓展运算符（…）"><a href="#4-拓展运算符（…）" class="headerlink" title="4. 拓展运算符（…）"></a>4. 拓展运算符（…）</h4><p>语法： <code>var cloneObj = &#123; ...obj &#125;;</code><br>扩展运算符也是浅拷贝，对于值是对象的属性无法完全拷贝成2个不同对象，但是如果属性都是基本类型的值的话，使用扩展运算符也是优势方便的地方。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123; <span class="attr">name</span>: <span class="string">&quot;leo&quot;</span>, <span class="attr">skill</span>: &#123; <span class="attr">JavaScript</span>: <span class="number">90</span>, <span class="attr">CSS</span>: <span class="number">80</span>&#125;&#125;;</span><br><span class="line"><span class="keyword">let</span> leo = &#123;...user&#125;;</span><br><span class="line">leo.name = <span class="string">&quot;leo1&quot;</span>;</span><br><span class="line">leo.skill.CSS = <span class="number">90</span>;</span><br><span class="line"><span class="built_in">console</span>.log(leo.name);      <span class="comment">// &quot;leo1&quot; ⚠️ 差异！</span></span><br><span class="line"><span class="built_in">console</span>.log(user.name);     <span class="comment">// &quot;leo&quot;  ⚠️ 差异！</span></span><br><span class="line"><span class="built_in">console</span>.log(leo.skill.CSS); <span class="comment">// 90</span></span><br><span class="line"><span class="built_in">console</span>.log(user.skill.CSS);<span class="comment">// 90</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-手写浅拷贝"><a href="#3-3-手写浅拷贝" class="headerlink" title="3.3 手写浅拷贝"></a>3.3 手写浅拷贝</h3><p>实现原理：新的对象复制已有对象中非对象属性的值和对象属性的<strong>引用</strong>,也就是说对象属性并不复制到内存。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cloneShallow</span>(<span class="params">source</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> target = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> source) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">Object</span>.prototype.hasOwnProperty.call(source, key)) &#123;</span><br><span class="line">            target[key] = source[key];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>for in</strong></li>
</ul>
<p>for…in语句以任意顺序遍历一个对象自有的、继承的、<code>可枚举的</code>、非Symbol的属性。对于每个不同的属性，语句都会被执行。</p>
<ul>
<li><strong>hasOwnProperty</strong></li>
</ul>
<p>该函数返回值为布尔值，所有继承了 Object 的对象都会继承到 <code>hasOwnProperty</code> 方法，和 <code>in</code> 运算符不同，该函数会忽略掉那些从原型链上继承到的属性和自身属性。<br>语法：<code>obj.hasOwnProperty(prop)</code><br><code>prop</code> 是要检测的属性<strong>字符串名称</strong>或者<code>Symbol</code>。</p>
<h2 id="4-深拷贝"><a href="#4-深拷贝" class="headerlink" title="4. 深拷贝"></a>4. 深拷贝</h2><h3 id="4-1-概念"><a href="#4-1-概念" class="headerlink" title="4.1 概念"></a>4.1 概念</h3><p>复制变量值，对于引用数据，则递归至基本类型后，再复制。深拷贝后的对象<strong>与原来的对象完全隔离</strong>，互不影响，对一个对象的修改并不会影响另一个对象。</p>
<h3 id="4-2-实现深拷贝"><a href="#4-2-实现深拷贝" class="headerlink" title="4.2 实现深拷贝"></a>4.2 实现深拷贝</h3><h4 id="1-JSON-parse-JSON-stringify"><a href="#1-JSON-parse-JSON-stringify" class="headerlink" title="1. JSON.parse(JSON.stringify())"></a>1. JSON.parse(JSON.stringify())</h4><p>其原理是把一个对象序列化成为一个JSON字符串，将对象的内容转换成字符串的形式再保存在磁盘上，再用<code>JSON.parse()</code> 反序列化将JSON字符串变成一个新的对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123; <span class="attr">name</span>: <span class="string">&quot;leo&quot;</span>, <span class="attr">skill</span>: &#123; <span class="attr">JavaScript</span>: <span class="number">90</span>, <span class="attr">CSS</span>: <span class="number">80</span>&#125;&#125;;</span><br><span class="line"><span class="keyword">let</span> leo = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(user));</span><br><span class="line">leo.name = <span class="string">&quot;leo1&quot;</span>;</span><br><span class="line">leo.skill.CSS = <span class="number">90</span>;</span><br><span class="line"><span class="built_in">console</span>.log(leo.name);      <span class="comment">// &quot;leo1&quot; ⚠️ 差异！</span></span><br><span class="line"><span class="built_in">console</span>.log(user.name);     <span class="comment">// &quot;leo&quot;  ⚠️ 差异！</span></span><br><span class="line"><span class="built_in">console</span>.log(leo.skill.CSS); <span class="comment">// 90 ⚠️ 差异！</span></span><br><span class="line"><span class="built_in">console</span>.log(user.skill.CSS);<span class="comment">// 80 ⚠️ 差异！</span></span><br></pre></td></tr></table></figure>
<p><code>JSON.stringify()</code> 使用注意：</p>
<ul>
<li>拷贝的对象的值中如果有函数， <code>undefined</code> ， <code>symbol</code> 则经过 <code>JSON.stringify()</code> `序列化后的JSON字符串中这个键值对会消失；</li>
<li>无法拷贝不可枚举的属性，无法拷贝对象的原型链；</li>
<li>拷贝 <code>Date</code> 引用类型会变成字符串；</li>
<li>拷贝 <code>RegExp</code> 引用类型会变成空对象；</li>
<li>对象中含有 <code>NaN</code> 、 <code>Infinity</code> 和 <code>-Infinity</code> ，则序列化的结果会变成 <code>null</code> ；</li>
<li>无法拷贝对象的循环应用(即 <code>obj[key] = obj</code> )。</li>
</ul>
<h4 id="2-第三方库"><a href="#2-第三方库" class="headerlink" title="2. 第三方库"></a>2. 第三方库</h4><h3 id="4-3-手写深拷贝"><a href="#4-3-手写深拷贝" class="headerlink" title="4.3 手写深拷贝"></a>4.3 手写深拷贝</h3><p>核心思想是<strong>递归</strong>，遍历对象、数组直到里边都是基本数据类型，然后再去复制，就是深度拷贝。 实现代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isObject = <span class="function"><span class="params">obj</span> =&gt;</span> <span class="keyword">typeof</span> obj === <span class="string">&#x27;object&#x27;</span> &amp;&amp; obj != <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cloneDeep</span>(<span class="params">source</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!isObject(source)) <span class="keyword">return</span> source; <span class="comment">// 非对象返回自身</span></span><br><span class="line">    <span class="keyword">const</span> target = <span class="built_in">Array</span>.isArray(source) ? [] : &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> source) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">Object</span>.prototype.hasOwnProperty.call(source, key)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (isObject(source[key])) &#123;</span><br><span class="line">                target[key] = cloneDeep(source[key]); <span class="comment">// 注意这里</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                target[key] = source[key];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>该方法缺陷： 遇到循环引用，会陷入一个循环的递归过程，从而导致爆栈。<br>其他写法，可以阅读<a target="_blank" rel="noopener" href="https://juejin.im/post/5d6aa4f96fb9a06b112ad5b1">《如何写出一个惊艳面试官的深拷贝?》</a> 。</p>
<h2 id="5-小结"><a href="#5-小结" class="headerlink" title="5. 小结"></a>5. 小结</h2><p><strong>浅拷贝</strong>：将对象的每个属性进行依次复制，但是当对象的属性值是引用类型时，实质复制的是其引用，当引用指向的值改变时也会跟着变化。</p>
<p><strong>深拷贝</strong>：复制变量值，对于引用数据，则递归至基本类型后，再复制。深拷贝后的对象<strong>与原来的对象完全隔离</strong>，互不影响，对一个对象的修改并不会影响另一个对象。</p>
<p><strong>深拷贝和浅拷贝是针对复杂数据类型来说的，浅拷贝只拷贝一层，而深拷贝是层层拷贝。</strong><br><img src="http://images.pingan8787.com/JavaScript-Base/section2/object-copy.png" alt="深拷贝和浅拷贝"></p>
<h1 id="三、垃圾回收机制（GC）"><a href="#三、垃圾回收机制（GC）" class="headerlink" title="三、垃圾回收机制（GC）"></a>三、垃圾回收机制（GC）</h1><p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-hans/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6_(%E8%A8%88%E7%AE%97%E6%A9%9F%E7%A7%91%E5%AD%B8)">垃圾回收（Garbage Collection，缩写为GC）</a>是一种自动的存储器管理机制。当某个程序占用的一部分内存空间不再被这个程序访问时，这个程序会借助垃圾回收算法向操作系统归还这部分内存空间。垃圾回收器可以减轻程序员的负担，也减少程序中的错误。垃圾回收最早起源于LISP语言。<br>目前许多语言如Smalltalk、Java、C#和D语言都支持垃圾回收器，我们熟知的 JavaScript 具有自动垃圾回收机制。</p>
<p><strong>在 JavaScript 中，原始类型的数据被分配到栈空间中，引用类型的数据会被分配到堆空间中。</strong></p>
<h2 id="1-栈空间中的垃圾回收"><a href="#1-栈空间中的垃圾回收" class="headerlink" title="1. 栈空间中的垃圾回收"></a>1. 栈空间中的垃圾回收</h2><p>当函数 <code>showName</code> 调用完成后，通过下移 <a target="_blank" rel="noopener" href="https://baike.baidu.com/item/esp/35173">ESP（Extended Stack Pointer）</a>指针，来销毁 <code>showName</code> 函数，之后调用其他函数时，将覆盖掉旧内存，存放另一个函数的执行上下文，实现垃圾回收。<br><img src="hhttp://images.pingan8787.com/JavaScript-Base/section2/v8-1.jpg"><br>图片来自《浏览器工作原理与实践》</p>
<h2 id="2-堆空间中的垃圾回收"><a href="#2-堆空间中的垃圾回收" class="headerlink" title="2. 堆空间中的垃圾回收"></a>2. 堆空间中的垃圾回收</h2><p>堆中数据垃圾回收策略的基础是：<a target="_blank" rel="noopener" href="https://plumbr.io/handbook/garbage-collection-in-java/generational-hypothesis"><strong>代际假说</strong>（The Generational Hypothesis）</a>。即：</p>
<ol>
<li>大部分对象在内存中存在时间极短，很多对象很快就不可访问。</li>
<li>不死的对象将活得更久。</li>
</ol>
<p>这两个特点不仅仅适用于 JavaScript，同样适用于大多数的动态语言，如 Java、Python 等。<br>V8 引擎将堆空间分为<strong>新生代</strong>（存放生存<strong>时间短</strong>的对象）和<strong>老生代</strong>（存放生存<strong>时间长</strong>的对象）两个区域，并使用不同的垃圾回收器。</p>
<ul>
<li>副垃圾回收器，主要负责新生代的垃圾回收。</li>
<li>主垃圾回收器，主要负责老生代的垃圾回收。</li>
</ul>
<p>不管是哪种垃圾回收器，都使用相同垃圾回收流程：<strong>标记活动对象和非活动对象，回收非活动对象的内存，最后内存整理。</strong><br>**</p>
<h3 id="1-1-副垃圾回收器"><a href="#1-1-副垃圾回收器" class="headerlink" title="1.1 副垃圾回收器"></a>1.1 副垃圾回收器</h3><p>使用 Scavenge 算法处理，将新生代空间对半分为两个区域，一个对象区域，一个空闲区域。<br><img src="hhttp://images.pingan8787.com/JavaScript-Base/section2/v8-2.jpg"><br>图片来自《浏览器工作原理与实践》</p>
<p>执行流程：</p>
<ul>
<li>新对象存在在<strong>对象区域</strong>，当对象区域将要写满时，执行一次垃圾回收；</li>
<li>垃圾回收过程中，首先对对象区域中的垃圾做标记，然后副垃圾回收器将存活的对象复制并有序排列到空闲区域，相当于完成内存整理。</li>
<li>复制完成后，将对象区域和空闲区域翻转，完成垃圾回收操作，这也让新生代中两块区域无限重复使用。</li>
</ul>
<p>当然，这也存在一些问题：若复制操作的数据较大则影响清理效率。<br>JavaScript 引擎的解决方式是：将新生代区域设置得比较小，并采用对象晋升策略（经过两次回收仍存活的对象，会被移动到老生区），避免因为新生代区域较小引起存活对象装满整个区域的问题。</p>
<h3 id="1-2-主垃圾回收器"><a href="#1-2-主垃圾回收器" class="headerlink" title="1.2 主垃圾回收器"></a>1.2 主垃圾回收器</h3><p>分为：<strong>标记 - 清除（Mark-Sweep）算法</strong>，和<strong>标记 - 整理（Mark-Compact）算法</strong>。</p>
<p><strong>a)标记 - 清除（Mark-Sweep）算法</strong><br><strong>过程：</strong></p>
<ul>
<li>标记过程：从一组根元素开始遍历整个元素，能到达的元素为活动对象，反之为垃圾数据；</li>
<li>清除过程：清理被标记的数据，并产生大量碎片内存。（缺点：导致大对象无法分配到足够的连续内存）</li>
</ul>
<p><img src="hhttp://images.pingan8787.com/JavaScript-Base/section2/v8-3.jpg"><br>图片来自《浏览器工作原理与实践》</p>
<p><strong>b)标记 - 整理（Mark-Compact）算法</strong><br><strong>过程：</strong></p>
<ul>
<li>标记过程：从一组根元素开始遍历整个元素，能到达的元素为活动对象，反之为垃圾数据；</li>
<li>整理过程：将所有存活的对象，向一段移动，然后清除端边界以外的内容。</li>
</ul>
<p><img src="hhttp://images.pingan8787.com/JavaScript-Base/section2/v8-4.jpg"><br>图片来自《浏览器工作原理与实践》</p>
<h2 id="3-拓展阅读"><a href="#3-拓展阅读" class="headerlink" title="3. 拓展阅读"></a>3. 拓展阅读</h2><p>1.<a target="_blank" rel="noopener" href="https://blog.csdn.net/justloveyou_/article/details/71216049">《图解Java 垃圾回收机制》</a><br>2.<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Memory_Management">《MDN 内存管理》</a></p>
<h1 id="四、对象方法和-this"><a href="#四、对象方法和-this" class="headerlink" title="四、对象方法和 this"></a>四、对象方法和 this</h1><h2 id="1-对象方法"><a href="#1-对象方法" class="headerlink" title="1. 对象方法"></a>1. 对象方法</h2><p>具体介绍可阅读 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/Method_definitions">《MDN 方法的定义》</a> 。<br>将作为对象属性的方法称为“对象方法”，如下面 <code>user</code> 对象的 <code>say</code> 方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> say = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="string">&quot;hello!&quot;</span>)&#125;;</span><br><span class="line"></span><br><span class="line">user.say = say;  <span class="comment">// 赋值到对象上</span></span><br><span class="line">user.say(); <span class="comment">// &quot;hello!&quot;</span></span><br></pre></td></tr></table></figure>
<p>也可以使用更加简洁的方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123;</span><br><span class="line">	<span class="attr">say</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 简写为</span></span><br><span class="line">	say ()&#123;<span class="built_in">console</span>.log(<span class="string">&quot;hello!&quot;</span>)&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ES8 async 方法</span></span><br><span class="line">	<span class="keyword">async</span> say ()&#123;<span class="regexp">/.../</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line">user.say();</span><br></pre></td></tr></table></figure>
<p>当然对象方法的名称，还支持计算的属性名称作为方法名：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> hello = <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> user = &#123;</span><br><span class="line">	[<span class="string">&#x27;say&#x27;</span> + hello]()&#123;<span class="built_in">console</span>.log(<span class="string">&quot;hello!&quot;</span>)&#125;</span><br><span class="line">&#125;</span><br><span class="line">user[<span class="string">&#x27;say&#x27;</span> + hello](); <span class="comment">// &quot;hello!&quot;</span></span><br></pre></td></tr></table></figure>


<p>另外需要注意的是：所有方法定义不是构造函数，如果您尝试实例化它们，将抛出<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/TypeError"><code>TypeError</code></a>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123;</span><br><span class="line">	<span class="function"><span class="title">say</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> user.say; <span class="comment">// TypeError: user.say is not a constructor</span></span><br></pre></td></tr></table></figure>

<h2 id="2-this"><a href="#2-this" class="headerlink" title="2. this"></a>2. this</h2><h3 id="2-1-this-简介"><a href="#2-1-this-简介" class="headerlink" title="2.1 this 简介"></a>2.1 this 简介</h3><p>当对象方法需要使用对象中的属性，可以使用 <code>this</code> 关键字：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123;</span><br><span class="line">	<span class="attr">name</span> : <span class="string">&#x27;leo&#x27;</span>,</span><br><span class="line">  <span class="function"><span class="title">say</span>(<span class="params"></span>)</span>&#123; <span class="built_in">console</span>.log(<span class="string">`hello <span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span>`</span>)&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">user.say(); <span class="comment">// &quot;hello leo&quot;</span></span><br></pre></td></tr></table></figure>
<p>当代码 <code>user.say()</code> 执行过程中， <code>this</code> 指的是 <code>user</code> 对象。当然也可以直接使用变量名 <code>user</code> 来引用 <code>say()</code> 方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123;</span><br><span class="line">	<span class="attr">name</span> : <span class="string">&#x27;leo&#x27;</span>,</span><br><span class="line">  <span class="function"><span class="title">say</span>(<span class="params"></span>)</span>&#123; <span class="built_in">console</span>.log(<span class="string">`hello <span class="subst">$&#123;user.name&#125;</span>`</span>)&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">user.say(); <span class="comment">// &quot;hello leo&quot;</span></span><br></pre></td></tr></table></figure>
<p>但是这样并不安全，因为 <code>user</code> 对象可能赋值给另外一个变量，并且将其他值赋值给 <code>user</code> 对象，就可能导致报错：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123;</span><br><span class="line">	<span class="attr">name</span> : <span class="string">&#x27;leo&#x27;</span>,</span><br><span class="line">  <span class="function"><span class="title">say</span>(<span class="params"></span>)</span>&#123; <span class="built_in">console</span>.log(<span class="string">`hello <span class="subst">$&#123;user.name&#125;</span>`</span>)&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> leo = user;</span><br><span class="line">user = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">leo.say(); <span class="comment">// Uncaught TypeError: Cannot read property &#x27;name&#x27; of null</span></span><br></pre></td></tr></table></figure>
<p>但将  <code>user.name</code>  改成 <code>this.name</code> 代码便正常运行。</p>
<h3 id="2-2-this-取值"><a href="#2-2-this-取值" class="headerlink" title="2.2 this 取值"></a>2.2 this 取值</h3><p><code>this</code> 的值是在 <strong>代码运行时计算出来</strong> 的，它的值取决于代码上下文：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123; <span class="attr">name</span>: <span class="string">&quot;leo&quot;</span>&#125;;</span><br><span class="line"><span class="keyword">let</span> admin = &#123;<span class="attr">name</span>: <span class="string">&quot;pingan&quot;</span>&#125;;</span><br><span class="line"><span class="keyword">let</span> say = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">`hello <span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span>`</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">user.fun = say;</span><br><span class="line">admin.fun = say;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数内部 this 是指“点符号前面”的对象</span></span><br><span class="line">user.fun();     <span class="comment">// &quot;hello leo&quot;</span></span><br><span class="line">admin.fun();    <span class="comment">// &quot;hello pingan&quot;</span></span><br><span class="line">admin[<span class="string">&#x27;fun&#x27;</span>](); <span class="comment">// &quot;hello pingan&quot;</span></span><br></pre></td></tr></table></figure>
<p>规则：如果 <code>obj.fun()</code> 被调用，则 <code>this</code> 在 <code>fun</code> 函数调用期间是 <code>obj</code> ，所以上面的 <code>this</code> 先是 <code>user</code> ，然后是 <code>admin</code> 。</p>
<p>但是在全局环境中，无论是否开启严格模式， <code>this</code> 都指向全局对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">this</span> == <span class="built_in">window</span>); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="built_in">this</span>.b = <span class="number">10</span>;</span><br><span class="line">a === <span class="built_in">this</span>.b; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-箭头函数没有自己的-this"><a href="#2-3-箭头函数没有自己的-this" class="headerlink" title="2.3 箭头函数没有自己的 this"></a>2.3 箭头函数没有自己的 this</h3><p>箭头函数比较特别，没有自己的 <code>this</code> ，如果有引用 <code>this</code> 的话，则指向外部正常函数，下面例子中， <code>this</code> 指向 <code>user.say()</code> 方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123;</span><br><span class="line">	<span class="attr">name</span> : <span class="string">&#x27;leo&#x27;</span>,</span><br><span class="line">  <span class="attr">say</span> : <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  	<span class="built_in">console</span>.log(<span class="string">`hello <span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span>`</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">hello</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">let</span> fun = <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`hello <span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span>`</span>);</span><br><span class="line">    fun();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">user.say();   <span class="comment">// hello      =&gt; say() 外部函数是 window</span></span><br><span class="line">user.hello(); <span class="comment">// hello leo  =&gt; fun() 外部函数是 hello</span></span><br></pre></td></tr></table></figure>

<h3 id="2-4-call-apply-bind"><a href="#2-4-call-apply-bind" class="headerlink" title="2.4 call / apply / bind"></a>2.4 call / apply / bind</h3><p>详细可以阅读<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1479810">《js基础-关于call,apply,bind的一切》</a> 。<br>当我们想把 <code>this</code> 值绑定到另一个环境中，就可以使用 <code>call</code> / <code>apply</code> / <code>bind</code> 方法实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> user = &#123; <span class="attr">name</span>: <span class="string">&#x27;leo&#x27;</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> name = <span class="string">&#x27;pingan&#x27;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">console</span>.log(<span class="built_in">this</span>.name); <span class="comment">// this 的值取决于函数调用方式</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fun();           <span class="comment">// &quot;pingan&quot;</span></span><br><span class="line">fun.call(user);  <span class="comment">// &quot;leo&quot;</span></span><br><span class="line">fun.apply(user); <span class="comment">// &quot;leo&quot;</span></span><br></pre></td></tr></table></figure>
<p>注意：这里的 <code>var name = &#39;pingan&#39;;</code> 需要使用 <code>var</code> 来声明，使用 <code>let</code> 的话， <code>window</code> 上将没有 <code>name</code> 变量。</p>
<p>三者语法如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fun.call(thisArg, param1, param2, ...)</span><br><span class="line">fun.apply(thisArg, [param1,param2,...])</span><br><span class="line">fun.bind(thisArg, param1, param2, ...)</span><br></pre></td></tr></table></figure>

<h1 id="五、构造函数和-new-运算符"><a href="#五、构造函数和-new-运算符" class="headerlink" title="五、构造函数和 new 运算符"></a>五、构造函数和 new 运算符</h1><h2 id="1-构造函数"><a href="#1-构造函数" class="headerlink" title="1. 构造函数"></a>1. 构造函数</h2><p>构造函数的作用在于 <strong>实现可重用的对象创建代码</strong> 。<br>通常，对于构造函数有两个约定：</p>
<ul>
<li>命名时首字母大写；</li>
<li>只能使用 <code>new</code> 运算符执行。</li>
</ul>
<p><strong><code>new</code> 运算符</strong>创建一个用户定义的对象类型的实例或具有构造函数的内置对象的实例。<br>语法如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title">constructor</span>[(<span class="params">[<span class="built_in">arguments</span>]</span>)]</span><br></pre></td></tr></table></figure>
<p>参数如下：</p>
<ul>
<li><code>constructor</code>一个指定对象实例的类型的类或函数。</li>
<li><code>arguments</code>一个用于被 <code>constructor</code> 调用的参数列表。</li>
</ul>
<h2 id="2-简单示例"><a href="#2-简单示例" class="headerlink" title="2. 简单示例"></a>2. 简单示例</h2><p>举个简单示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">User</span> (<span class="params">name</span>)</span>&#123;</span><br><span class="line">	<span class="built_in">this</span>.name = name;</span><br><span class="line">  <span class="built_in">this</span>.isAdmin = <span class="literal">false</span>; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> leo = <span class="keyword">new</span> User(<span class="string">&#x27;leo&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(leo.name, leo.isAdmin); <span class="comment">// &quot;leo&quot; false</span></span><br></pre></td></tr></table></figure>

<h2 id="3-new-运算符操作过程"><a href="#3-new-运算符操作过程" class="headerlink" title="3. new 运算符操作过程"></a>3. new 运算符操作过程</h2><p>当一个函数被使用 <code>new</code> 运算符执行时，它按照以下步骤：</p>
<ol>
<li>一个新的空对象被创建并分配给 <code>this</code>。</li>
<li>函数体执行。通常它会修改 <code>this</code>，为其添加新的属性。</li>
<li>返回 <code>this</code> 的值。</li>
</ol>
<p>以前面 <code>User</code> 方法为例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">User</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// this = &#123;&#125;;（隐式创建）</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 添加属性到 this</span></span><br><span class="line">  <span class="built_in">this</span>.name = name;</span><br><span class="line">  <span class="built_in">this</span>.isAdmin = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// return this;（隐式返回）</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> leo = <span class="keyword">new</span> User(<span class="string">&#x27;leo&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(leo.name, leo.isAdmin); <span class="comment">// &quot;leo&quot; false</span></span><br></pre></td></tr></table></figure>

<p>当我们执行 <code>new User(&#39;leo&#39;)</code> 时，发生以下事情：</p>
<ol>
<li>一个继承自 <code>User.prototype</code> 的新对象被创建；</li>
<li>使用指定参数调用构造函数 <code>User</code> ，并将 <code>this</code> 绑定到新创建的对象；</li>
<li>由构造函数返回的对象就是 <code>new</code> 表达式的结果。如果构造函数没有显式返回一个对象，则使用步骤1创建的对象。</li>
</ol>
<p><strong>需要注意</strong>：</p>
<ol>
<li><p>一般情况下，构造函数不返回值，但是开发者可以选择主动返回对象，来覆盖正常的对象创建步骤；</p>
</li>
<li><p><code>new User</code> 等同于 <code>new User()</code> ，只是没有指定参数列表，即 <code>User</code> 不带参数的情况；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = <span class="keyword">new</span> User; <span class="comment">// &lt;-- 没有参数</span></span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="keyword">let</span> user = <span class="keyword">new</span> User();</span><br></pre></td></tr></table></figure></li>
<li><p>任何函数都可以作为构造器，即都可以使用 <code>new</code> 运算符运行。</p>
</li>
</ol>
<h2 id="4-构造函数中的方法"><a href="#4-构造函数中的方法" class="headerlink" title="4. 构造函数中的方法"></a>4. 构造函数中的方法</h2><p>在构造函数中，也可以将方法绑定到 <code>this</code> 上：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">User</span> (<span class="params">name</span>)</span>&#123;</span><br><span class="line">	<span class="built_in">this</span>.name = name;</span><br><span class="line">  <span class="built_in">this</span>.isAdmin = <span class="literal">false</span>; </span><br><span class="line">	<span class="built_in">this</span>.sayHello = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">&quot;hello &quot;</span> + <span class="built_in">this</span>.name);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> leo = <span class="keyword">new</span> User(<span class="string">&#x27;leo&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(leo.name, leo.isAdmin); <span class="comment">// &quot;leo&quot; false</span></span><br><span class="line">leo.sayHello(); <span class="comment">// &quot;hello leo&quot;</span></span><br></pre></td></tr></table></figure>

<h1 id="六、可选链-“-”"><a href="#六、可选链-“-”" class="headerlink" title="六、可选链 “?.”"></a>六、可选链 “?.”</h1><p>详细介绍可以查看 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/%E5%8F%AF%E9%80%89%E9%93%BE">《MDN 可选链操作符》</a> 。</p>
<h2 id="1-背景介绍"><a href="#1-背景介绍" class="headerlink" title="1. 背景介绍"></a>1. 背景介绍</h2><p>在实际开发中，常常出现下面几种报错情况：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 对象中不存在指定属性</span></span><br><span class="line"><span class="keyword">const</span> leo = &#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(leo.name.toString()); </span><br><span class="line"><span class="comment">// Uncaught TypeError: Cannot read property &#x27;toString&#x27; of undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 使用不存在的 DOM 节点属性</span></span><br><span class="line"><span class="keyword">const</span> dom = <span class="built_in">document</span>.getElementById(<span class="string">&quot;dom&quot;</span>).innerHTML; </span><br><span class="line"><span class="comment">// Uncaught TypeError: Cannot read property &#x27;innerHTML&#x27; of null</span></span><br></pre></td></tr></table></figure>
<p>在可选链 <code>?.</code> 出现之前，我们会使用短路操作 <code>&amp;&amp;</code> 运算符来解决该问题：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> leo = &#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(leo &amp;&amp; leo.name &amp;&amp; leo.name.toString()); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
<p>这种写法的缺点就是 <strong>太麻烦了</strong> 。</p>
<h2 id="2-可选链介绍"><a href="#2-可选链介绍" class="headerlink" title="2. 可选链介绍"></a>2. 可选链介绍</h2><p>可选链 <code>?.</code> 是一种 <strong>访问嵌套对象属性的防错误方法</strong> 。即使中间的属性不存在，也不会出现错误。<br>如果可选链 <code>?.</code> 前面部分是 <code>undefined</code> 或者 <code>null</code>，它会停止运算并返回 <code>undefined</code>。</p>
<p>语法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">obj?.prop</span><br><span class="line">obj?.[expr]</span><br><span class="line">arr?.[index]</span><br><span class="line">func?.(args)</span><br></pre></td></tr></table></figure>
<p>**<br><strong>我们改造前面示例代码：</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 对象中不存在指定属性</span></span><br><span class="line"><span class="keyword">const</span> leo = &#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(leo?.name?.toString()); </span><br><span class="line"><span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 使用不存在的 DOM 节点属性</span></span><br><span class="line"><span class="keyword">const</span> dom = <span class="built_in">document</span>?.getElementById(<span class="string">&quot;dom&quot;</span>)?.innerHTML; </span><br><span class="line"><span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>

<h2 id="3-使用注意"><a href="#3-使用注意" class="headerlink" title="3. 使用注意"></a>3. 使用注意</h2><p>可选链虽然好用，但需要注意以下几点：</p>
<ol>
<li><strong>不能过度使用可选链</strong>；</li>
</ol>
<p>我们应该只将 <code>?.</code> 使用在一些属性或方法可以不存在的地方，以上面示例代码为例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> leo = &#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(leo.name?.toString()); </span><br></pre></td></tr></table></figure>
<p>这样写会更好，因为 <code>leo</code> 对象是必须存在，而 <code>name</code> 属性则可能不存在。</p>
<ol start="2">
<li><strong>可选链 <code>?.</code> 之前的变量必须已声明</strong>；</li>
</ol>
<p>在可选链 <code>?.</code> 之前的变量必须使用 <code>let/const/var</code> 声明，否则会报错：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">leo?.name;</span><br><span class="line"><span class="comment">// Uncaught ReferenceError: leo is not defined</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p><strong>可选链不能用于赋值</strong> ；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> object = &#123;&#125;;</span><br><span class="line">object?.property = <span class="number">1</span>; </span><br><span class="line"><span class="comment">// Uncaught SyntaxError: Invalid left-hand side in assignment</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>可选链访问数组元素的方法</strong> ；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arrayItem = arr?.[<span class="number">42</span>];</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="4-其他情况：-和"><a href="#4-其他情况：-和" class="headerlink" title="4. 其他情况：?.() 和 ?.[]"></a>4. 其他情况：?.() 和 ?.[]</h2><p>需要说明的是 <code>?.</code> 是一个特殊的语法结构，而不是一个运算符，它还可以与其 <code>()</code> 和 <code>[]</code> 一起使用：</p>
<h3 id="4-1-可选链与函数调用"><a href="#4-1-可选链与函数调用" class="headerlink" title="4.1 可选链与函数调用 ?.()"></a>4.1 可选链与函数调用 ?.()</h3><p><code>?.()</code> 用于调用一个可能不存在的函数，比如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user1 = &#123;</span><br><span class="line">  <span class="function"><span class="title">admin</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    alert(<span class="string">&quot;I am admin&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> user2 = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">user1.admin?.(); <span class="comment">// I am admin</span></span><br><span class="line">user2.admin?.();</span><br></pre></td></tr></table></figure>
<p><code>?.()</code> 会检查它左边的部分：如果 admin 函数存在，那么就调用运行它（对于 <code>user1</code>）。否则（对于 <code>user2</code>）运算停止，没有错误。</p>
<h3 id="4-2-可选链和表达式"><a href="#4-2-可选链和表达式" class="headerlink" title="4.2 可选链和表达式 ?.[]"></a>4.2 可选链和表达式 ?.[]</h3><p><code>?.[]</code> 允许从一个可能不存在的对象上安全地读取属性。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user1 = &#123;</span><br><span class="line">  <span class="attr">firstName</span>: <span class="string">&quot;John&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> user2 = <span class="literal">null</span>; <span class="comment">// 假设，我们不能授权此用户</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> key = <span class="string">&quot;firstName&quot;</span>;</span><br><span class="line"></span><br><span class="line">alert( user1?.[key] ); <span class="comment">// John</span></span><br><span class="line">alert( user2?.[key] ); <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line">alert( user1?.[key]?.something?.not?.existing); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>

<h2 id="5-可选链-语法总结"><a href="#5-可选链-语法总结" class="headerlink" title="5. 可选链 ?. 语法总结"></a>5. 可选链 <code>?.</code> 语法总结</h2><p>可选链 <code>?.</code> 语法有三种形式：</p>
<ol>
<li><code>obj?.prop</code> —— 如果 <code>obj</code> 存在则返回 <code>obj.prop</code>，否则返回 <code>undefined</code>。</li>
<li><code>obj?.[prop]</code> —— 如果 <code>obj</code> 存在则返回 <code>obj[prop]</code>，否则返回 <code>undefined</code>。</li>
<li><code>obj?.method()</code> —— 如果 <code>obj</code> 存在则调用 <code>obj.method()</code>，否则返回 <code>undefined</code>。</li>
</ol>
<p>正如我们所看到的，这些语法形式用起来都很简单直接。<code>?.</code> 检查左边部分是否为 <code>null/undefined</code>，如果不是则继续运算。<br><code>?.</code> 链使我们能够安全地访问嵌套属性。</p>
<h1 id="七、Symbol"><a href="#七、Symbol" class="headerlink" title="七、Symbol"></a>七、Symbol</h1><p>规范规定，JavaScript 中对象的属性只能为 <strong>字符串类型</strong> 或者 <strong>Symbol类型</strong> ，毕竟我们也只见过这两种类型。</p>
<h2 id="1-概念介绍"><a href="#1-概念介绍" class="headerlink" title="1. 概念介绍"></a>1. 概念介绍</h2><p>ES6引入<code>Symbol</code>作为一种新的<strong>原始数据类型</strong>，表示<strong>独一无二</strong>的值，主要是为了<strong>防止属性名冲突</strong>。<br>ES6之后，JavaScript一共有其中数据类型：<code>Symbol</code>、<code>undefined</code>、<code>null</code>、<code>Boolean</code>、<code>String</code>、<code>Number</code>、<code>Object</code>。<br><strong>简单使用</strong>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> leo = <span class="built_in">Symbol</span>();</span><br><span class="line"><span class="keyword">typeof</span> leo; <span class="comment">// &quot;symbol&quot;</span></span><br></pre></td></tr></table></figure>
<p>Symbol 支持传入参数作为 Symbol 名，方便代码调试：<br>**</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> leo = <span class="built_in">Symbol</span>(<span class="string">&quot;leo&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="2-注意事项"><a href="#2-注意事项" class="headerlink" title="2. 注意事项**"></a>2. 注意事项**</h2><ul>
<li><code>Symbol</code>函数不能用<code>new</code>，会报错。</li>
</ul>
<p>由于<code>Symbol</code>是一个原始类型，不是对象，所以不能添加属性，它是类似于字符串的数据类型。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> leo = <span class="keyword">new</span> <span class="built_in">Symbol</span>()</span><br><span class="line"><span class="comment">// Uncaught TypeError: Symbol is not leo constructor</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>Symbol</code>都是不相等的，<strong>即使参数相同</strong>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 没有参数</span></span><br><span class="line"><span class="keyword">let</span> leo1 = <span class="built_in">Symbol</span>();</span><br><span class="line"><span class="keyword">let</span> leo2 = <span class="built_in">Symbol</span>();</span><br><span class="line">leo1 === leo2; <span class="comment">// false </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 有参数</span></span><br><span class="line"><span class="keyword">let</span> leo1 = <span class="built_in">Symbol</span>(<span class="string">&#x27;leo&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> leo2 = <span class="built_in">Symbol</span>(<span class="string">&#x27;leo&#x27;</span>);</span><br><span class="line">leo1 === leo2; <span class="comment">// false</span></span><br></pre></td></tr></table></figure></li>
<li><p><code>Symbol</code>不能与其他类型的值计算，会报错。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> leo = <span class="built_in">Symbol</span>(<span class="string">&#x27;hello&#x27;</span>);</span><br><span class="line">leo + <span class="string">&quot; world!&quot;</span>;  <span class="comment">// 报错</span></span><br><span class="line"><span class="string">`<span class="subst">$&#123;leo&#125;</span> world!`</span>;  <span class="comment">// 报错</span></span><br></pre></td></tr></table></figure></li>
<li><p><code>Symbol</code> 不能自动转换为字符串，只能显式转换。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> leo = <span class="built_in">Symbol</span>(<span class="string">&#x27;hello&#x27;</span>);</span><br><span class="line">alert(leo); </span><br><span class="line"><span class="comment">// Uncaught TypeError: Cannot convert a Symbol value to a string</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">String</span>(leo);    <span class="comment">// &quot;Symbol(hello)&quot;</span></span><br><span class="line">leo.toString(); <span class="comment">// &quot;Symbol(hello)&quot;</span></span><br></pre></td></tr></table></figure></li>
<li><p><code>Symbol</code> 可以转换为布尔值，但不能转为数值：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a1 = <span class="built_in">Symbol</span>();</span><br><span class="line"><span class="built_in">Boolean</span>(a1);</span><br><span class="line">!a1;        <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Number</span>(a1); <span class="comment">// TypeError</span></span><br><span class="line">a1 + <span class="number">1</span> ;    <span class="comment">// TypeError</span></span><br></pre></td></tr></table></figure></li>
<li><p><code>Symbol</code> 属性不参与 <code>for...in/of</code> 循环。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> id = <span class="built_in">Symbol</span>(<span class="string">&quot;id&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> user = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;Leo&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">30</span>,</span><br><span class="line">  [id]: <span class="number">123</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> user) <span class="built_in">console</span>.log(key); <span class="comment">// name, age (no symbols)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 Symbol 任务直接访问</span></span><br><span class="line"><span class="built_in">console</span>.log( <span class="string">&quot;Direct: &quot;</span> + user[id] );</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="3-字面量中使用-Symbol-作为属性名"><a href="#3-字面量中使用-Symbol-作为属性名" class="headerlink" title="3. 字面量中使用 Symbol 作为属性名"></a>3. 字面量中使用 Symbol 作为属性名</h2><p>在对象字面量中使用 <code>Symbol</code> 作为属性名时，需要使用 <strong>方括号</strong> （ <code>[]</code> ），如 <code>[leo]: &quot;leo&quot;</code> 。<br>好处：防止同名属性，还有防止键被改写或覆盖。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> leo = <span class="built_in">Symbol</span>();</span><br><span class="line"><span class="comment">// 写法1</span></span><br><span class="line"><span class="keyword">let</span> user = &#123;&#125;;</span><br><span class="line">user[leo] = <span class="string">&#x27;leo&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写法2</span></span><br><span class="line"><span class="keyword">let</span> user = &#123;</span><br><span class="line">    [leo] : <span class="string">&#x27;leo&#x27;</span></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 写法3</span></span><br><span class="line"><span class="keyword">let</span> user = &#123;&#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(user, leo, &#123;<span class="attr">value</span> : <span class="string">&#x27;leo&#x27;</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3种写法 结果相同</span></span><br><span class="line">user[leo]; <span class="comment">// &#x27;leo&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>需要注意</strong> ：Symbol作为对象属性名时，不能用点运算符，并且必须放在方括号内。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> leo = <span class="built_in">Symbol</span>();</span><br><span class="line"><span class="keyword">let</span> user = &#123;&#125;;</span><br><span class="line"><span class="comment">// 不能用点运算</span></span><br><span class="line">user.leo = <span class="string">&#x27;leo&#x27;</span>;</span><br><span class="line">user[leo] ; <span class="comment">// undefined</span></span><br><span class="line">user[<span class="string">&#x27;leo&#x27;</span>] ; <span class="comment">// &#x27;leo&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 必须放在方括号内</span></span><br><span class="line"><span class="keyword">let</span> user = &#123;</span><br><span class="line">    [leo] : <span class="function"><span class="keyword">function</span> (<span class="params">text</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(text);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">user[leo](<span class="string">&#x27;leo&#x27;</span>); <span class="comment">// &#x27;leo&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 上面等价于 更简洁</span></span><br><span class="line"><span class="keyword">let</span> user = &#123;</span><br><span class="line">    [leo](text)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(text);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>常常还用于创建一组常量，保证所有值不相等</strong>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123;&#125;;</span><br><span class="line">user.list = &#123;</span><br><span class="line">    <span class="attr">AAA</span>: <span class="built_in">Symbol</span>(<span class="string">&#x27;Leo&#x27;</span>),</span><br><span class="line">    <span class="attr">BBB</span>: <span class="built_in">Symbol</span>(<span class="string">&#x27;Robin&#x27;</span>),</span><br><span class="line">    <span class="attr">CCC</span>: <span class="built_in">Symbol</span>(<span class="string">&#x27;Pingan&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-应用：消除魔术字符串"><a href="#4-应用：消除魔术字符串" class="headerlink" title="4. 应用：消除魔术字符串"></a>4. 应用：消除魔术字符串</h2><p><strong>魔术字符串</strong>：指代码中多次出现，强耦合的字符串或数值，应该避免，而使用含义清晰的变量代替。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(name == <span class="string">&#x27;leo&#x27;</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;hello&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">fun(<span class="string">&#x27;leo&#x27;</span>);   <span class="comment">// &#x27;hello&#x27; 为魔术字符串</span></span><br></pre></td></tr></table></figure>

<p>常使用变量，消除魔术字符串：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;leo&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(name == obj.name)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;hello&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">fun(obj.name); <span class="comment">// &#x27;hello&#x27;</span></span><br></pre></td></tr></table></figure>

<p>使用<code>Symbol</code>消除强耦合，使得不需关系具体的值:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">Symbol</span>()</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span> (<span class="params">name</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(name == obj.name)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;hello&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">fun(obj.name); <span class="comment">// &#x27;hello&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="5-属性名遍历"><a href="#5-属性名遍历" class="headerlink" title="5. 属性名遍历"></a>5. 属性名遍历</h2><p>Symbol作为属性名遍历，不出现在<code>for...in</code>、<code>for...of</code>循环，也不被<code>Object.keys()</code>、<code>Object.getOwnPropertyNames()</code>、<code>JSON.stringify()</code>返回。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> leo = <span class="built_in">Symbol</span>(<span class="string">&#x27;leo&#x27;</span>), robin = <span class="built_in">Symbol</span>(<span class="string">&#x27;robin&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> user = &#123;</span><br><span class="line">    [leo]:<span class="string">&#x27;18&#x27;</span>, [robin]:<span class="string">&#x27;28&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> k <span class="keyword">of</span> <span class="built_in">Object</span>.values(user))&#123;<span class="built_in">console</span>.log(k)&#125;</span><br><span class="line"><span class="comment">// 无输出</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> user = &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> leo = <span class="built_in">Symbol</span>(<span class="string">&#x27;leo&#x27;</span>);</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(user, leo, &#123;<span class="attr">value</span>: <span class="string">&#x27;hi&#x27;</span>&#125;);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> k <span class="keyword">in</span> user)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(k); <span class="comment">// 无输出</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Object</span>.getOwnPropertyNames(user);   <span class="comment">// []</span></span><br><span class="line"><span class="built_in">Object</span>.getOwnPropertySymbols(user); <span class="comment">// [Symbol(leo)]</span></span><br></pre></td></tr></table></figure>
<p><code>Object.getOwnPropertySymbols</code>方法返回一个数组，包含当前对象所有用做属性名的Symbol值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> leo = <span class="built_in">Symbol</span>(<span class="string">&#x27;leo&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> pingan = <span class="built_in">Symbol</span>(<span class="string">&#x27;pingan&#x27;</span>);</span><br><span class="line">user[leo] = <span class="string">&#x27;hi leo&#x27;</span>;</span><br><span class="line">user[pingan] = <span class="string">&#x27;hi pingan&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> obj = <span class="built_in">Object</span>.getOwnPropertySymbols(user);</span><br><span class="line">obj; <span class="comment">//  [Symbol(leo), Symbol(pingan)]</span></span><br></pre></td></tr></table></figure>

<p>另外可以使用<code>Reflect.ownKeys</code>方法可以返回所有类型的键名，包括常规键名和 Symbol 键名。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123;</span><br><span class="line">    [<span class="built_in">Symbol</span>(<span class="string">&#x27;leo&#x27;</span>)]: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">age</span> : <span class="number">2</span>, </span><br><span class="line">    <span class="attr">address</span> : <span class="number">3</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Reflect</span>.ownKeys(user); <span class="comment">// [&#x27;age&#x27;, &#x27;address&#x27;,Symbol(&#x27;leo&#x27;)]</span></span><br></pre></td></tr></table></figure>

<p>由于Symbol值作为名称的属性不被常规方法遍历获取，因此常用于定义对象的一些非私有，且内部使用的方法。</p>
<h2 id="6-Symbol-for-、Symbol-keyFor"><a href="#6-Symbol-for-、Symbol-keyFor" class="headerlink" title="6. Symbol.for()、Symbol.keyFor()"></a>6. Symbol.for()、Symbol.keyFor()</h2><h3 id="6-1-Symbol-for"><a href="#6-1-Symbol-for" class="headerlink" title="6.1 Symbol.for()"></a>6.1 Symbol.for()</h3><p><strong>用于重复使用一个Symbol值</strong>，接收一个<strong>字符串</strong>作为参数，若存在用此参数作为名称的Symbol值，返回这个Symbol，否则新建并返回以这个参数为名称的Symbol值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> leo = <span class="built_in">Symbol</span>.for(<span class="string">&#x27;leo&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> pingan = <span class="built_in">Symbol</span>.for(<span class="string">&#x27;pingan&#x27;</span>);</span><br><span class="line">leo === pingan;  <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p><code>Symbol()</code> 和 <code>Symbol.for()</code>区别：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Symbol</span>.for(<span class="string">&#x27;leo&#x27;</span>) === <span class="built_in">Symbol</span>.for(<span class="string">&#x27;leo&#x27;</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Symbol</span>(<span class="string">&#x27;leo&#x27;</span>) === <span class="built_in">Symbol</span>(<span class="string">&#x27;leo&#x27;</span>);         <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<h3 id="6-2-Symbol-keyFor"><a href="#6-2-Symbol-keyFor" class="headerlink" title="6.2 Symbol.keyFor()"></a>6.2 Symbol.keyFor()</h3><p><strong>用于返回一个已使用的Symbol类型的key</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> leo = <span class="built_in">Symbol</span>.for(<span class="string">&#x27;leo&#x27;</span>);</span><br><span class="line"><span class="built_in">Symbol</span>.keyFor(leo);   <span class="comment">//  &#x27;leo&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> leo = <span class="built_in">Symbol</span>(<span class="string">&#x27;leo&#x27;</span>);</span><br><span class="line"><span class="built_in">Symbol</span>.keyFor(leo);   <span class="comment">//  undefined</span></span><br></pre></td></tr></table></figure>

<h2 id="7-内置的Symbol值"><a href="#7-内置的Symbol值" class="headerlink" title="7. 内置的Symbol值"></a>7. 内置的Symbol值</h2><p>ES6提供11个内置的Symbol值，指向语言内部使用的方法：</p>
<h3 id="7-1-Symbol-hasInstance"><a href="#7-1-Symbol-hasInstance" class="headerlink" title="7.1 Symbol.hasInstance"></a>7.1 Symbol.hasInstance</h3><p>当其他对象使用<code>instanceof</code>运算符，判断是否为该对象的实例时，会调用这个方法。比如，<code>foo instanceof Foo</code>在语言内部，实际调用的是<code>Foo[Symbol.hasInstance](foo)</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">    [<span class="built_in">Symbol</span>.hasInstance](a)&#123;</span><br><span class="line">        <span class="keyword">return</span> a <span class="keyword">instanceof</span> <span class="built_in">Array</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] <span class="keyword">instanceof</span> <span class="keyword">new</span> P(); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>P是一个类，new P()会返回一个实例，该实例的<code>Symbol.hasInstance</code>方法，会在进行<code>instanceof</code>运算时自动调用，判断左侧的运算子是否为<code>Array</code>的实例。</p>
<h3 id="7-2-Symbol-isConcatSpreadable"><a href="#7-2-Symbol-isConcatSpreadable" class="headerlink" title="7.2 Symbol.isConcatSpreadable"></a>7.2 Symbol.isConcatSpreadable</h3><p>值为布尔值，表示该对象用于<code>Array.prototype.concat()</code>时，是否可以展开。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="string">&#x27;aa&#x27;</span>,<span class="string">&#x27;bb&#x27;</span>];</span><br><span class="line">[<span class="string">&#x27;cc&#x27;</span>,<span class="string">&#x27;dd&#x27;</span>].concat(a, <span class="string">&#x27;ee&#x27;</span>); </span><br><span class="line"><span class="comment">// [&#x27;cc&#x27;, &#x27;dd&#x27;, &#x27;aa&#x27;, &#x27;bb&#x27;, &#x27;ee&#x27;]</span></span><br><span class="line">a[<span class="built_in">Symbol</span>.isConcatSpreadable]; <span class="comment">// undefined</span></span><br><span class="line"><span class="keyword">let</span> b = [<span class="string">&#x27;aa&#x27;</span>,<span class="string">&#x27;bb&#x27;</span>]; </span><br><span class="line">b[<span class="built_in">Symbol</span>.isConcatSpreadable] = <span class="literal">false</span>; </span><br><span class="line">[<span class="string">&#x27;cc&#x27;</span>,<span class="string">&#x27;dd&#x27;</span>].concat(b, <span class="string">&#x27;ee&#x27;</span>); </span><br><span class="line"><span class="comment">// [&#x27;cc&#x27;, &#x27;dd&#x27;,[ &#x27;aa&#x27;, &#x27;bb&#x27;], &#x27;ee&#x27;]</span></span><br></pre></td></tr></table></figure>

<h3 id="7-3-Symbol-species"><a href="#7-3-Symbol-species" class="headerlink" title="7.3 Symbol.species"></a>7.3 Symbol.species</h3><p>指向一个构造函数，在创建衍生对象时会使用，使用时需要用<code>get</code>取值器。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> <span class="keyword">extends</span> <span class="title">Array</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> get [<span class="built_in">Symbol</span>.species]()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>解决下面问题：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 问题：  b应该是 Array 的实例，实际上是 P 的实例</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> <span class="keyword">extends</span> <span class="title">Array</span></span>&#123;&#125;</span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> P(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);</span><br><span class="line"><span class="keyword">let</span> b = a.map(<span class="function"><span class="params">x</span> =&gt;</span> x);</span><br><span class="line">b <span class="keyword">instanceof</span> <span class="built_in">Array</span>; <span class="comment">// true</span></span><br><span class="line">b <span class="keyword">instanceof</span> P; <span class="comment">// true</span></span><br><span class="line"><span class="comment">// 解决：  通过使用 Symbol.species</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> <span class="keyword">extends</span> <span class="title">Array</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> get [<span class="built_in">Symbol</span>.species]() &#123; <span class="keyword">return</span> <span class="built_in">Array</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> P();</span><br><span class="line"><span class="keyword">let</span> b = a.map(<span class="function"><span class="params">x</span> =&gt;</span> x);</span><br><span class="line">b <span class="keyword">instanceof</span> P;     <span class="comment">// false</span></span><br><span class="line">b <span class="keyword">instanceof</span> <span class="built_in">Array</span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h3 id="7-4-Symbol-match"><a href="#7-4-Symbol-match" class="headerlink" title="7.4 Symbol.match"></a>7.4 Symbol.match</h3><p>当执行<code>str.match(myObject)</code>，传入的属性存在时会调用，并返回该方法的返回值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">    [<span class="built_in">Symbol</span>.match](string)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;hello world&#x27;</span>.indexOf(string);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">&#x27;h&#x27;</span>.match(<span class="keyword">new</span> P());   <span class="comment">// 0</span></span><br></pre></td></tr></table></figure>

<h3 id="7-5-Symbol-replace"><a href="#7-5-Symbol-replace" class="headerlink" title="7.5 Symbol.replace"></a>7.5 Symbol.replace</h3><p>当该对象被<code>String.prototype.replace</code>方法调用时，会返回该方法的返回值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = &#123;&#125;;</span><br><span class="line">a[<span class="built_in">Symbol</span>.replace] = <span class="function">(<span class="params">...s</span>) =&gt;</span> <span class="built_in">console</span>.log(s);</span><br><span class="line"><span class="string">&#x27;Hello&#x27;</span>.replace(a , <span class="string">&#x27;World&#x27;</span>) <span class="comment">// [&quot;Hello&quot;, &quot;World&quot;]</span></span><br></pre></td></tr></table></figure>

<h3 id="7-6-Symbol-hasInstance"><a href="#7-6-Symbol-hasInstance" class="headerlink" title="7.6 Symbol.hasInstance"></a>7.6 Symbol.hasInstance</h3><p>当该对象被<code>String.prototype.search</code>方法调用时，会返回该方法的返回值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">val</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.val = val;</span><br><span class="line">    &#125;</span><br><span class="line">    [<span class="built_in">Symbol</span>.search](s)&#123;</span><br><span class="line">        <span class="keyword">return</span> s.indexOf(<span class="built_in">this</span>.val);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">&#x27;hileo&#x27;</span>.search(<span class="keyword">new</span> P(<span class="string">&#x27;leo&#x27;</span>)); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>

<h3 id="7-7-Symbol-split"><a href="#7-7-Symbol-split" class="headerlink" title="7.7 Symbol.split"></a>7.7 Symbol.split</h3><p>当该对象被<code>String.prototype.split</code>方法调用时，会返回该方法的返回值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 重新定义了字符串对象的split方法的行为</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">val</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.val = val;</span><br><span class="line">    &#125;</span><br><span class="line">    [<span class="built_in">Symbol</span>.split](s) &#123;</span><br><span class="line">        <span class="keyword">let</span> i = s.indexOf(<span class="built_in">this</span>.val);</span><br><span class="line">        <span class="keyword">if</span>(i == -<span class="number">1</span>) <span class="keyword">return</span> s;</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            s.substr(<span class="number">0</span>, i),</span><br><span class="line">            s.substr(i + <span class="built_in">this</span>.val.length)</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">&#x27;helloworld&#x27;</span>.split(<span class="keyword">new</span> P(<span class="string">&#x27;hello&#x27;</span>)); <span class="comment">// [&quot;hello&quot;, &quot;&quot;]</span></span><br><span class="line"><span class="string">&#x27;helloworld&#x27;</span>.split(<span class="keyword">new</span> P(<span class="string">&#x27;world&#x27;</span>)); <span class="comment">// [&quot;&quot;, &quot;world&quot;] </span></span><br><span class="line"><span class="string">&#x27;helloworld&#x27;</span>.split(<span class="keyword">new</span> P(<span class="string">&#x27;leo&#x27;</span>));   <span class="comment">// &quot;helloworld&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="7-8-Symbol-iterator"><a href="#7-8-Symbol-iterator" class="headerlink" title="7.8 Symbol.iterator"></a>7.8 Symbol.iterator</h3><p>对象进行<code>for...of</code>循环时，会调用<code>Symbol.iterator</code>方法，返回该对象的默认遍历器。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">    *[<span class="built_in">Symbol</span>.interator]() &#123;</span><br><span class="line">        <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(<span class="built_in">this</span>[i] !== <span class="literal">undefined</span> ) &#123;</span><br><span class="line">            <span class="keyword">yield</span> <span class="built_in">this</span>[i];</span><br><span class="line">            ++i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> P();</span><br><span class="line">a[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">a[<span class="number">1</span>] = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">of</span> a)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(k);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-9-Symbol-toPrimitive"><a href="#7-9-Symbol-toPrimitive" class="headerlink" title="7.9.Symbol.toPrimitive"></a>7.9.Symbol.toPrimitive</h3><p>该对象被转为原始类型的值时，会调用这个方法，返回该对象对应的原始类型值。调用时，需要接收一个字符串参数，表示当前运算模式，运算模式有：</p>
<ul>
<li>Number : 此时需要转换成数值</li>
<li>String : 此时需要转换成字符串</li>
<li>Default : 此时可以转换成数值或字符串<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  [<span class="built_in">Symbol</span>.toPrimitive](hint) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (hint) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;number&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">123</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;string&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;str&#x27;</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;default&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;default&#x27;</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>();</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="number">2</span> * obj <span class="comment">// 246</span></span><br><span class="line"><span class="number">3</span> + obj <span class="comment">// &#x27;3default&#x27;</span></span><br><span class="line">obj == <span class="string">&#x27;default&#x27;</span> <span class="comment">// true</span></span><br><span class="line"><span class="built_in">String</span>(obj) <span class="comment">// &#x27;str&#x27;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="7-10-Symbol-toStringTag"><a href="#7-10-Symbol-toStringTag" class="headerlink" title="7.10 Symbol.toStringTag"></a>7.10 Symbol.toStringTag</h3><p>在该对象上面调用<code>Object.prototype.toString</code>方法时，如果这个属性存在，它的返回值会出现在<code>toString</code>方法返回的字符串之中，表示对象的类型。也就是说，这个属性可以用来定制<code>[object Object</code>]或<code>[object Array]</code>中<code>object</code>后面的那个字符串。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 例一</span></span><br><span class="line">(&#123;[<span class="built_in">Symbol</span>.toStringTag]: <span class="string">&#x27;Foo&#x27;</span>&#125;.toString())</span><br><span class="line"><span class="comment">// &quot;[object Foo]&quot;</span></span><br><span class="line"><span class="comment">// 例二</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Collection</span> </span>&#123;</span><br><span class="line">  get [<span class="built_in">Symbol</span>.toStringTag]() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;xxx&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> x = <span class="keyword">new</span> Collection();</span><br><span class="line"><span class="built_in">Object</span>.prototype.toString.call(x) <span class="comment">// &quot;[object xxx]&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="7-11-Symbol-unscopables"><a href="#7-11-Symbol-unscopables" class="headerlink" title="7.11 Symbol.unscopables"></a>7.11 Symbol.unscopables</h3><p>该对象指定了使用with关键字时，哪些属性会被with环境排除。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 没有 unscopables 时</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">foo</span>(<span class="params"></span>)</span> &#123; <span class="keyword">return</span> <span class="number">1</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="number">2</span>; &#125;;</span><br><span class="line"><span class="keyword">with</span> (MyClass.prototype) &#123;</span><br><span class="line">  foo(); <span class="comment">// 1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 有 unscopables 时</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">foo</span>(<span class="params"></span>)</span> &#123; <span class="keyword">return</span> <span class="number">1</span>; &#125;</span><br><span class="line">  get [<span class="built_in">Symbol</span>.unscopables]() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">foo</span>: <span class="literal">true</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="number">2</span>; &#125;;</span><br><span class="line"><span class="keyword">with</span> (MyClass.prototype) &#123;</span><br><span class="line">  foo(); <span class="comment">// 2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面代码通过指定<code>Symbol.unscopables</code>属性，使得<code>with</code>语法块不会在当前作用域寻找<code>foo</code>属性，即<code>foo</code>将指向外层作用域的变量。</p>
<h1 id="八、原始值转换"><a href="#八、原始值转换" class="headerlink" title="八、原始值转换"></a>八、原始值转换</h1><p>前面复习到字符串、数值、布尔值等的转换，但是没有讲到对象的转换规则，这部分就一起看看：。<br>需要记住几个规则：</p>
<ol>
<li>所有对象在布尔上下文中都为 <code>true</code> ，并且不存在转换为布尔值的操作，只有字符串和数值转换有。</li>
<li>数值转换发生在对象相减或应用数学函数时。如 <code>Date</code> 对象可以相减，如 <code>date1 - date2</code> 结果为两个时间的差值。</li>
<li>在字符串转换，通常出现在如 <code>alert(obj)</code> 这种形式。</li>
</ol>
<p>当然我们可以使用特殊的对象方法，对字符串和数值转换进行微调。下面介绍三个类型（hint）转换情况：</p>
<h2 id="1-object-to-string"><a href="#1-object-to-string" class="headerlink" title="1. object to string"></a>1. object to string</h2><p>对象到字符串的转换，当我们对期望一个字符串的对象执行操作时，如 “alert”：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 输出</span></span><br><span class="line">alert(obj);</span><br><span class="line"><span class="comment">// 将对象作为属性键</span></span><br><span class="line">anotherObj[obj] = <span class="number">123</span>;</span><br></pre></td></tr></table></figure>

<h2 id="2-object-to-number"><a href="#2-object-to-number" class="headerlink" title="2. object to number"></a>2. object to number</h2><p>对象到数字的转换，例如当我们进行数学运算时：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 显式转换</span></span><br><span class="line"><span class="keyword">let</span> num = <span class="built_in">Number</span>(obj);</span><br><span class="line"><span class="comment">// 数学运算（除了二进制加法）</span></span><br><span class="line"><span class="keyword">let</span> n = +obj; <span class="comment">// 一元加法</span></span><br><span class="line"><span class="keyword">let</span> delta = date1 - date2;</span><br><span class="line"><span class="comment">// 小于/大于的比较</span></span><br><span class="line"><span class="keyword">let</span> greater = user1 &gt; user2;</span><br></pre></td></tr></table></figure>

<h2 id="3-object-to-default"><a href="#3-object-to-default" class="headerlink" title="3. object to default"></a>3. object to default</h2><p>少数情况下，<strong>当运算符“不确定”期望值类型时</strong>。<br>例如，二进制加法 <code>+</code> 可用于字符串（连接），也可以用于数字（相加），所以字符串和数字这两种类型都可以。因此，当二元加法得到对象类型的参数时，它将依据 <code>&quot;default&quot;</code> 来对其进行转换。<br>此外，如果对象被用于与字符串、数字或 symbol 进行 <code>==</code> 比较，这时到底应该进行哪种转换也不是很明确，因此使用 <code>&quot;default&quot;</code> 。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 二元加法使用默认 hint</span></span><br><span class="line"><span class="keyword">let</span> total = obj1 + obj2;</span><br><span class="line"><span class="comment">// obj == number 使用默认 hint</span></span><br><span class="line"><span class="keyword">if</span> (user == <span class="number">1</span>) &#123; ... &#125;;</span><br></pre></td></tr></table></figure>

<h2 id="4-类型转换算法"><a href="#4-类型转换算法" class="headerlink" title="4. 类型转换算法"></a>4. 类型转换算法</h2><p><strong>为了进行转换，JavaScript 尝试查找并调用三个对象方法：</strong></p>
<ol>
<li>调用 <code>obj[Symbol.toPrimitive](hint)</code> —— 带有 symbol 键 <code>Symbol.toPrimitive</code>（系统 symbol）的方法，如果这个方法存在的话，</li>
<li>否则，如果 hint 是 <code>&quot;string&quot;</code> —— 尝试 <code>obj.toString()</code> 和 <code>obj.valueOf()</code>，无论哪个存在。</li>
<li>否则，如果 hint 是 <code>&quot;number&quot;</code> 或 <code>&quot;default&quot;</code> —— 尝试 <code>obj.valueOf()</code> 和 <code>obj.toString()</code>，无论哪个存在。</li>
</ol>
<h2 id="5-Symbol-toPrimitive"><a href="#5-Symbol-toPrimitive" class="headerlink" title="5. Symbol.toPrimitive"></a>5. Symbol.toPrimitive</h2><p>详细介绍可阅读<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Symbol/toPrimitive">《MDN | Symbol.toPrimitive》</a> 。<br><code>Symbol.toPrimitive</code> 是一个内置的 Symbol 值，它是作为对象的函数值属性存在的，当一个对象转换为对应的原始值时，会调用此函数。<br>简单示例介绍：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;Leo&quot;</span>,</span><br><span class="line">  <span class="attr">money</span>: <span class="number">9999</span>,</span><br><span class="line"></span><br><span class="line">  [<span class="built_in">Symbol</span>.toPrimitive](hint) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`hint: <span class="subst">$&#123;hint&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">return</span> hint == <span class="string">&quot;string&quot;</span> ? <span class="string">`&#123;name: &quot;<span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span>&quot;&#125;`</span> : <span class="built_in">this</span>.money;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">alert(user);     <span class="comment">// 控制台：hint: string 弹框：&#123;name: &quot;John&quot;&#125;</span></span><br><span class="line">alert(+user);    <span class="comment">// 控制台：hint: number 弹框：9999</span></span><br><span class="line">alert(user + <span class="number">1</span>); <span class="comment">// 控制台：hint: default 弹框：10000</span></span><br></pre></td></tr></table></figure>

<h2 id="6-toString-valueOf"><a href="#6-toString-valueOf" class="headerlink" title="6. toString/valueOf"></a>6. toString/valueOf</h2><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/toString"><code>toString</code></a> / <code>valueOf</code> 是两个比较早期的实现转换的方法。当没有 <code>Symbol.toPrimitive</code> ，那么 JavaScript 将尝试找到它们，并且按照下面的顺序进行尝试：</p>
<ul>
<li>对于 “string” hint，<code>toString -&gt; valueOf</code>。</li>
<li>其他情况，<code>valueOf -&gt; toString</code>。</li>
</ul>
<p>这两个方法必须返回一个原始值。如果 <code>toString</code> 或 <code>valueOf</code> 返回了一个对象，那么返回值会被忽略。默认情况下，普通对象具有 <code>toString</code> 和 <code>valueOf</code> 方法：</p>
<ul>
<li><code>toString</code> 方法返回一个字符串 <code>&quot;[object Object]&quot;</code>。</li>
<li><code>valueOf</code> 方法返回对象自身。</li>
</ul>
<p>简单示例介绍：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user = &#123;<span class="attr">name</span>: <span class="string">&quot;Leo&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">alert(user); <span class="comment">// [object Object]</span></span><br><span class="line">alert(user.valueOf() === user); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>我们也可以结合 <code>toString</code> / <code>valueOf</code>  实现前面第 5 点介绍的 <code>user</code> 对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;Leo&quot;</span>,</span><br><span class="line">  <span class="attr">money</span>: <span class="number">9999</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 对于 hint=&quot;string&quot;</span></span><br><span class="line">  <span class="function"><span class="title">toString</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`&#123;name: &quot;<span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span>&quot;&#125;`</span>;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 对于 hint=&quot;number&quot; 或 &quot;default&quot;</span></span><br><span class="line">  <span class="function"><span class="title">valueOf</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.money;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">alert(user);     <span class="comment">// 控制台：hint: string 弹框：&#123;name: &quot;John&quot;&#125;</span></span><br><span class="line">alert(+user);    <span class="comment">// 控制台：hint: number 弹框：9999</span></span><br><span class="line">alert(user + <span class="number">1</span>); <span class="comment">// 控制台：hint: default 弹框：10000</span></span><br></pre></td></tr></table></figure>

<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>本文作为《初中级前端 JavaScript 自测清单》第二部分，介绍的内容以 JavaScript 对象为主，其中有让我眼前一亮的知识点，如 <code>Symbol.toPrimitive</code> 方法。我也希望这个清单能帮助大家自测自己的 JavaScript 水平并查缺补漏，温故知新。</p>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#112;&#105;&#110;&#103;&#x61;&#110;&#x38;&#55;&#x38;&#55;&#64;&#x71;&#113;&#46;&#x63;&#111;&#109;">&#112;&#105;&#110;&#103;&#x61;&#110;&#x38;&#55;&#x38;&#55;&#64;&#x71;&#113;&#46;&#x63;&#111;&#109;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>ES小册</td>
<td>js.pingan8787.com</td>
</tr>
<tr>
<td>语雀知识库</td>
<td><a target="_blank" rel="noopener" href="https://www.yuque.com/wangpingan/cute-frontend">Cute-FrontEnd</a></td>
</tr>
</tbody></table>
<p><img src="http://images.pingan8787.com/2019_07_12guild_page.png" alt="bg">  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/08/05/215-%E3%80%90JavaScript%E3%80%91%E5%88%9D%E4%B8%AD%E7%BA%A7%E5%89%8D%E7%AB%AFJavaScript%E8%87%AA%E6%B5%8B%E6%B8%85%E5%8D%95-2/" data-id="ckts3ejzw00rm4d9kapxvdaso" data-title="215-【JavaScript】初中级前端JavaScript自测清单-2" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag">读书笔记</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-214-【React】React与前端开发的那些年" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/08/05/214-%E3%80%90React%E3%80%91React%E4%B8%8E%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E7%9A%84%E9%82%A3%E4%BA%9B%E5%B9%B4/" class="article-date">
  <time class="dt-published" datetime="2020-08-05T13:54:05.000Z" itemprop="datePublished">2020-08-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/08/05/214-%E3%80%90React%E3%80%91React%E4%B8%8E%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E7%9A%84%E9%82%A3%E4%BA%9B%E5%B9%B4/">214-【React】React与前端开发的那些年</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>这几天在通过各种资料，了解了 React 出现的背景，还有前端这些年的变换，不得不说，感觉真的神奇！</p>
<p>本文将带大家了解<strong>前端发展的那些年</strong>还有 React <strong>出现的背景</strong>～</p>
<p>首先我们来看看为什么会产生 React 这个框架？</p>
<p>React 是 Facebook 在 2013 年开源的一款前端框架，在这之前，Facebook 工程师开发一个简单功能时，如下图界面中“小红点”功能：</p>
<p><img src="http://images.pingan8787.com/chuanzhiboke/messages_on_facebook.png" alt="Facebook"></p>
<p>在导航栏中有“新好友”、“新消息”和“新动态”三个功能按钮，这其实功能挺简单，但却经常出 BUG，比如“收到新消息后，新消息的图标上数字没有正确更新”等问题。</p>
<p>大家可以先猜一下导致这个问题可能的原因。</p>
<p>我们都知道 Facebook 工程师都是世界顶级水平，<strong>他们找寻出现这种问题的深层次原因</strong> ，最终总结为两个原因：</p>
<p>1.<strong>工程师太过关注 UI 层面的细节操作</strong>；å</p>
<p>2.<strong>应用程序的状态较为分散，无法追踪和维护</strong>。</p>
<p>另外这里再介绍下 React 出现的时代背景：</p>
<p>1.<strong>大量业务逻辑由后端转为前端实现</strong>，即前后端分离；</p>
<p>2.已有前端框架开发的<strong>复杂应用性能不佳</strong>。</p>
<p>当时由于 Ajax 技术兴起，大量原来由服务端处理的逻辑，慢慢转移到前端做处理，这也是为了追求更流畅的 Web 交互体验。后来为了<strong>提升开发效率和应用性能</strong>，开始有很多大型前端框架出现（如：AngularJS），这些框架也让工程师们越来越关注 UI 层面的操作（如：频繁操作 DOM），<strong>应用性能越来越差</strong>，并伴随无法预知的 BUG 出现，就像前面讲到的 Facebook 工程师总结的原因之一。</p>
<p>之后 Facebook 工程师开始打造自己的前端框架，解决前面总结的问题，于是 React 就诞生啦～</p>
<p><img src="http://images.pingan8787.com/chuanzhiboke/section-1-react.png" alt="react"></p>
<p>接下来就跟我一起，踏上 React 入门第一步吧！</p>
<h1 id="一、React-介绍"><a href="#一、React-介绍" class="headerlink" title="一、React 介绍"></a>一、React 介绍</h1><h2 id="1-前端开发方式演进"><a href="#1-前端开发方式演进" class="headerlink" title="1. 前端开发方式演进"></a>1. 前端开发方式演进</h2><ul>
<li>前端混沌时代</li>
</ul>
<p>在“前端混沌时代”，页面主要在服务端开发并生成，服务端生成什么页面，浏览器端就展示什么样的页面，这是时代，是多么单纯。</p>
<ul>
<li>小前端时代</li>
</ul>
<p>随后进入“小前端时代”，形成了以 HTML 为骨架，CSS 为外貌，JavaScript 为交互体验的前端开发模式，在这个时代，出现了 Ajax 这种划时代意义的技术，让静态网页升级为动态网页，并随着 JavaScript 的发展，前端能做更加多样的页面。当时出现了 jQuery 这类 JS 工具库，主要用来<strong>操作 DOM</strong>，<strong>处理数据交互</strong>，至今仍有很多老旧项目依然在使用 jQuery。</p>
<p><img src="http://images.pingan8787.com/chuanzhiboke/section-1-jquery.png" alt="jquery"></p>
<ul>
<li>大前端时代</li>
</ul>
<p>在小前端时代稳定发展一段时间之后，工程师们开始发现前端<strong>需要呈现的数据量越来越大</strong>，<strong>网页动态交互效果也越来越多</strong>，jQuery 这类工具库<strong>越来越频繁操作 DOM</strong>，使得应用性能越来越差，页面越来越卡，慢慢前端大佬们开始解决这些问题。</p>
<p>在 2009 年诞生了 NodeJS ，将前端带入全新方向，为 AngularJS（2009年诞生），React（2011年诞生）和 Vuejs （2014年诞生）三大框架的<strong>诞生奠定基础</strong>。这些框架通过一定的分析比较算法，实现同等效果下最小的 DOM 开销，提高应用性能。前端开发进入“大前端时代”。</p>
<p><img src="http://images.pingan8787.com/chuanzhiboke/section-1-frame.jpg" alt="frame"></p>
<ul>
<li>全栈前端时代</li>
</ul>
<p>“大前端时代”之后 NodeJS 社区蓬勃发展，4G 网络也在不断普及发展，很多传统 PC 网站开始转向手机、平板等移动端设备，开始出现了混合应用技术（Hybrid APP），出现了各种开发框架，如 Cordova、React-Native、Weex、Electron等，还有最近比较火的 Flutter。</p>
<p><img src="http://images.pingan8787.com/chuanzhiboke/section-1-app.png" alt="app"></p>
<p>随着 TypeScript 的出现，和 ECMAScript 标准日渐完善，<strong>前端开发正在朝着更加全能化</strong>，<strong>多样化和更加细分领域的方向发展</strong>。</p>
<h2 id="2-React-介绍"><a href="#2-React-介绍" class="headerlink" title="2. React 介绍"></a>2. React 介绍</h2><p>React 是一个用于构建用户界面的 JavaScript 库，是用 JavaScript 构建<strong>快速响应</strong>的大型 Web 应用程序的首选方式。</p>
<p>由于 React 的设计思想极其独特，属于革命性创新，性能出众，代码逻辑却非常简单。所以，越来越多的人开始关注和使用，认为它可能是将来 Web 开发的主流工具。</p>
<p>在 React 中，可以将页面中每个部分分成每一个独立的小模块，每个小模块就是组建，这些组件可以互相组合和嵌套，就组成每一个页面。相比传统操作 DOM 的前端开发方式，我们<strong>主要要关心的是应用中数据的变化</strong> ，React 会帮我们将 UI 渲染完成。</p>
<p>以一个“用户推荐关注页面”为例子，可以将页面简单分为下面几个组件：</p>
<p><img src="http://images.pingan8787.com/chuanzhiboke/section-1-component.png" alt="component"></p>
<p>其中：</p>
<ul>
<li>组件<code>UserPageComponent</code> 为：主页面组件；</li>
<li>组件 <code>HeaderComponent</code> 为：页面顶部标题栏组件；</li>
<li>组件<code>ContentComponent</code> 为：页面主要内容区域组件；</li>
<li>组件<code>FooterComponent</code> 为：页面底部操作组件；</li>
<li>组件<code>UserInfoComponent</code> 为：通用用户信息组件；</li>
<li>组件<code>CommonButtonComponent</code> 为：通用按钮组件。</li>
</ul>
<p>接下来看下这个页面在 React 中是如何编写的吧～</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserPageComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">HeaderComponent</span>&gt;</span><span class="tag">&lt;/<span class="name">HeaderComponent</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">ContentComponent</span>&gt;</span><span class="tag">&lt;/<span class="name">ContentComponent</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">FooterComponent</span>&gt;</span><span class="tag">&lt;/<span class="name">FooterComponent</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ContentComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">UserInfoComponent</span>&gt;</span><span class="tag">&lt;/<span class="name">UserInfoComponent</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">UserInfoComponent</span>&gt;</span><span class="tag">&lt;/<span class="name">UserInfoComponent</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">UserInfoComponent</span>&gt;</span><span class="tag">&lt;/<span class="name">UserInfoComponent</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看起来就跟叠积木一样啦～～</p>
<p>看到这里，恭喜你已经了解了 React 并且知道 React 代码是如何编写的了！</p>
<p>接下来再来看看 React 各个重大版本的更新，这对于你了解 React 很有帮助。</p>
<h2 id="3-React-版本"><a href="#3-React-版本" class="headerlink" title="3. React 版本"></a>3. React 版本</h2><p>我们可以在 React 官网中查看 React 的版本迭代历史记录和更新内容：<a target="_blank" rel="noopener" href="https://reactjs.org/versions/%E3%80%82">https://reactjs.org/versions/。</a></p>
<p>在 2017.09.26 Facebook 发布 React v16.0 版本，截止课程制作时，React 最新版本为 v16.13.1 ，且引入了大量的令人振奋的新特性，接下来将以 React v16.0 版本开始，介绍一些重要更新内容，快跟我一起看看吧！</p>
<ul>
<li><strong>React v16.2.0 (November 28, 2017)</strong> </li>
</ul>
<p>增加 Fragment 组件，其作用是将一些子元素添加到 DOM tree 上且不需要为这些元素提供额外的父节点，相当于 render 返回数组元素。</p>
<ul>
<li><strong>React v16.3.0 (March 29, 2018)</strong> </li>
</ul>
<p>增加 <code>React.createRef()</code> API，可以通过 <code>React.createRef</code> 取得 Ref 对象。</p>
<p>增加 <code>React.forwardRef()</code>  API，它是 Ref 的转发, 让父组件能够访问到子组件的 Ref，从而操作子组件的 DOM。</p>
<ul>
<li><strong>React v16.6.0 (October 23, 2018)</strong> </li>
</ul>
<p>增加 <code>React.memo()</code> API，它只能作用在简单的函数组件上，本质是一个高阶函数，可以自动帮助组件执行 。</p>
<p>增加 <code>React.lazy()</code> API，它提供了动态 import 组件的能力，实现代码分割。</p>
<ul>
<li><strong>React v16.8.0 (February 6, 2019)</strong> </li>
</ul>
<p>增加 React Hooks，一种无需编写类即可使用状态和其他React功能的方法，用来解决状态逻辑复用问题，且不会产生 JSX 嵌套地狱。</p>
<p>改进 <code>useReducer</code>  Hook 惰性初始化API。</p>
<p>React 版本大概介绍到这里，相信这里还有很多知识你还不清楚，但是没关系，接下来的课程，我们将一一解答～</p>
<h1 id="二、闯关训练"><a href="#二、闯关训练" class="headerlink" title="二、闯关训练"></a>二、闯关训练</h1><p>请问 React 开发中，相比传统前端开发，我们更需要关注什么？</p>
<p>A. 应用中 DOM 的变化</p>
<p>B. 应用中数据的变化</p>
<p>C. 应用中 UI 展示</p>
<p>答案：B</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/08/05/214-%E3%80%90React%E3%80%91React%E4%B8%8E%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E7%9A%84%E9%82%A3%E4%BA%9B%E5%B9%B4/" data-id="ckts3eju900634d9k6gf928ek" data-title="214-【React】React与前端开发的那些年" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-213-【Webpack】了不起的WebpackScopeHoisting学习指南" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/08/05/213-%E3%80%90Webpack%E3%80%91%E4%BA%86%E4%B8%8D%E8%B5%B7%E7%9A%84WebpackScopeHoisting%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97/" class="article-date">
  <time class="dt-published" datetime="2020-08-05T12:58:57.000Z" itemprop="datePublished">2020-08-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/08/05/213-%E3%80%90Webpack%E3%80%91%E4%BA%86%E4%B8%8D%E8%B5%B7%E7%9A%84WebpackScopeHoisting%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97/">213-【Webpack】了不起的 Webpack Scope Hoisting 学习指南</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>近期原创文章回顾😄</p>
<ul>
<li>  <a target="_blank" rel="noopener" href="https://juejin.im/post/5f0023625188252e8c308597">《1.2w字 ｜ 初中级前端 JavaScript 自测清单 - 1》</a></li>
<li>  <a target="_blank" rel="noopener" href="https://juejin.im/post/5ee8e32a51882543485780d3">《了不起的 Webpack HMR 学习指南（含源码分析）》</a></li>
<li>  <a target="_blank" rel="noopener" href="https://juejin.im/post/5eeff398e51d4573e060874d">《了不起的 Webpack 构建流程学习指南》</a></li>
<li>  <a target="_blank" rel="noopener" href="https://juejin.im/post/5ee78bb7f265da76f15a0698">《你不知道的 WeakMap》番外篇</a></li>
<li>  <a target="_blank" rel="noopener" href="https://juejin.im/post/5ede5300e51d4578a6798220">《你不知道的 Blob》番外篇</a></li>
<li>  <a target="_blank" rel="noopener" href="https://juejin.im/post/5ed589a251882542e3022f44">《了不起的 tsconfig.json 指南》</a></li>
<li>  <a target="_blank" rel="noopener" href="https://juejin.im/post/5e802e41e51d4546b659b31b">《200行JS代码，带你实现代码编译器》</a></li>
</ul>
<h1 id="一、什么是-Scope-Hoisting"><a href="#一、什么是-Scope-Hoisting" class="headerlink" title="一、什么是 Scope Hoisting"></a>一、什么是 Scope Hoisting</h1><p>Scope Hoisting 是 webpack3 的新功能，直译为 “<strong>作用域提升</strong>“，它可以让 webpack 打包出来的<strong>代码文件更小</strong>，<strong>运行更快</strong>。</p>
<p>在 JavaScript 中，还有“变量提升”和“函数提升”，JavaScript 会将变量和函数的声明提升到当前作用域顶部，而“作用域提升”也类似，webpack 将引入到 JS 文件“提升到”它的引入者的顶部。</p>
<p>首先回顾下在没有 Scope Hoisting 时用 webpack 打包下面两个文件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="string">&quot;hello leo~&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> str <span class="keyword">from</span> <span class="string">&quot;./main.js&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(str);</span><br></pre></td></tr></table></figure>

<p>使用 webpack 打包后输出文件内容如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  (<span class="function"><span class="keyword">function</span> (<span class="params"><span class="built_in">module</span>, __webpack_exports__, __webpack_require__</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> __WEBPACK_IMPORTED_MODULE_0__main_js__ = __webpack_require__(<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(__WEBPACK_IMPORTED_MODULE_0__main_js__[<span class="string">&quot;a&quot;</span>]);</span><br><span class="line">  &#125;),</span><br><span class="line">  (<span class="function"><span class="keyword">function</span> (<span class="params"><span class="built_in">module</span>, __webpack_exports__, __webpack_require__</span>) </span>&#123;</span><br><span class="line">    __webpack_exports__[<span class="string">&quot;a&quot;</span>] = (<span class="string">&#x27;hello leo~&#x27;</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>再开启 Scope Hoisting 后，相同源码打包输出结果变为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  (<span class="function"><span class="keyword">function</span> (<span class="params"><span class="built_in">module</span>, __webpack_exports__, __webpack_require__</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> main = (<span class="string">&#x27;hello leo~&#x27;</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(main);</span><br><span class="line">  &#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>对比两种打包方式输出的代码，我们可以看出，启用 Scope Hoisting 后，函数声明变成一个， <code>main.js</code> 中定义的内容被直接注入到 <code>main.js</code> 对应模块中，这样做的好处：</p>
<ul>
<li><strong>代码体积更小</strong>，因为函数申明语句会产生大量代码，导致包体积增大（模块越多越明显）；</li>
<li>代码在运行时因为创建的函数作用域更少，<strong>内存开销也随之变小</strong>。</li>
</ul>
<h1 id="二、webpack-模块机制"><a href="#二、webpack-模块机制" class="headerlink" title="二、webpack 模块机制"></a>二、webpack 模块机制</h1><p>我们使用下面 <code>webpack.config.js</code> 配置，打包来看看 webpack 模块机制：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;bundle.js&#x27;</span>,</span><br><span class="line">        <span class="attr">path</span>: path.resolve(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">    <span class="attr">optimization</span>: &#123;</span><br><span class="line">        <span class="attr">usedExports</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>打包后输出结果（精简后）：<br><img src="http://images.pingan8787.com/Webpack/Scope-Hoisting/build-result.png"><br>通过分析，我们可以得出以下结论：</p>
<ul>
<li>webpack 打包输出打是一个 IIFE（匿名闭包）；</li>
<li><code>modules</code>  是一个数组，每一项是一个模块初始化函数；</li>
<li>使用 <code>__webpack_require()</code> 来家在模块，返回 <code>module.exports</code> ；</li>
<li>通过 <code>__webpack_require__(__webpack_require__.s = 0);</code> 启动程序。</li>
</ul>
<h1 id="三、Scope-Hoisting-原理"><a href="#三、Scope-Hoisting-原理" class="headerlink" title="三、Scope Hoisting 原理"></a>三、Scope Hoisting 原理</h1><p>Scope Hoisting 的实现原理其实很简单：分析出模块之间的依赖关系，尽可能将打散的模块合并到一个函数中，前提是不能造成代码冗余。 因此<strong>只有那些被引用了一次的模块才能被合并</strong>。</p>
<p>由于 Scope Hoisting 需要分析出模块之间的依赖关系，因此源码<strong>必须采用 ES6 模块化语句</strong>，不然它将无法生效。 原因和<a target="_blank" rel="noopener" href="http://webpack.wuhaolin.cn/4%E4%BC%98%E5%8C%96/4-10%E4%BD%BF%E7%94%A8TreeShaking.html">4-10 使用 TreeShaking</a> 中介绍的类似。</p>
<p><img src="http://images.pingan8787.com/Webpack/Scope-Hoisting/build-result-comparison.png"></p>
<h1 id="四、Scope-Hoisting-使用方式"><a href="#四、Scope-Hoisting-使用方式" class="headerlink" title="四、Scope Hoisting 使用方式"></a>四、Scope Hoisting 使用方式</h1><h2 id="1-自动启用"><a href="#1-自动启用" class="headerlink" title="1. 自动启用"></a>1. 自动启用</h2><p>在 webpack 的 <code>mode</code> 设置为 <code>production</code> 时，会默认自动启用 Scope Hooting。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">	<span class="attr">mode</span>: <span class="string">&quot;production&quot;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="2-手动启用"><a href="#2-手动启用" class="headerlink" title="2. 手动启用"></a>2. 手动启用</h2><p>在 webpack 中已经内置 Scope Hoisting ，所以用起来很简单，只需要配置<a target="_blank" rel="noopener" href="https://webpack.js.org/plugins/module-concatenation-plugin/#root">ModuleConcatenationPlugin</a> 插件即可：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> webpack.optimize.ModuleConcatenationPlugin()</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>考虑到 Scope Hoisting 以来 ES6 模块化语法，而现在很多 npm 包的第三方库还是使用 CommonJS 语法，为了充分发挥 Scope Hoisting 效果，我们可以增加以下 <code>mainFields</code> 配置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="attr">resolve</span>: &#123;</span><br><span class="line">        <span class="comment">// 针对 npm 中的第三方模块优先采用 jsnext:main 中指向的 ES6 模块化语法的文件</span></span><br><span class="line">        <span class="attr">mainFields</span>: [<span class="string">&#x27;jsnext:main&#x27;</span>, <span class="string">&#x27;browser&#x27;</span>, <span class="string">&#x27;main&#x27;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> webpack.optimize.ModuleConcatenationPlugin()</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>针对非 ES6 模块化语法的代码，webpack 会降级处理不使用 Scope Hoisting 优化，我们可以在 webpack 命令上增加 <code>--display-optimization-bailout</code> 参数，在输出的日志查看哪些代码做了降级处理：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;webpack --display-optimization-bailout&quot;</span> </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们写个简单示例代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> str <span class="keyword">from</span> <span class="string">&quot;./main.js&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; name &#125; = <span class="built_in">require</span>(<span class="string">&#x27;./no-es6.js&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="string">&quot;hello leo~&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// no-es6.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">name</span> : <span class="string">&quot;leo&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接着打包测试，可以看到控制台输出下面日志：</p>
<p><img src="http://images.pingan8787.com/Webpack/Scope-Hoisting/build-result-log.png"></p>
<p>输出的日志中 <code>ModuleConcatenation bailout</code> 告诉我们哪些文件因为什么原因导致降级处理了。</p>
<h1 id="五、总结"><a href="#五、总结" class="headerlink" title="五、总结"></a>五、总结</h1><p>本文主要和大家一起回顾了 Scope Hoisting 基本概念，使用方式和使用后效果对比，希望大家不要只停留在会用 webpack，也要看看其中一些不常见的知识，比如本文介绍的 Scope Hoisting，它对我们项目优化非常有帮助，但平常又很少会去注意。</p>
<h1 id="六、参考文章"><a href="#六、参考文章" class="headerlink" title="六、参考文章"></a>六、参考文章</h1><ul>
<li><a target="_blank" rel="noopener" href="https://imweb.io/topic/5a43064fa192c3b460fce360">《通过Scope Hoisting优化Webpack输出》</a> </li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000018220850">《webpack 的 scope hoisting 是什么？》</a> </li>
</ul>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#x70;&#x69;&#110;&#103;&#x61;&#110;&#56;&#55;&#x38;&#x37;&#x40;&#113;&#113;&#46;&#x63;&#x6f;&#109;">&#x70;&#x69;&#110;&#103;&#x61;&#110;&#56;&#55;&#x38;&#x37;&#x40;&#113;&#113;&#46;&#x63;&#x6f;&#109;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>ES小册</td>
<td>js.pingan8787.com</td>
</tr>
<tr>
<td>语雀知识库</td>
<td><a target="_blank" rel="noopener" href="https://www.yuque.com/wangpingan/cute-frontend">Cute-FrontEnd</a></td>
</tr>
</tbody></table>
<p><img src="http://images.pingan8787.com/2019_07_12guild_page.png">  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/08/05/213-%E3%80%90Webpack%E3%80%91%E4%BA%86%E4%B8%8D%E8%B5%B7%E7%9A%84WebpackScopeHoisting%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97/" data-id="ckts3eju800604d9kecm87hpq" data-title="213-【Webpack】了不起的 Webpack Scope Hoisting 学习指南" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Webpack/" rel="tag">Webpack</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag">读书笔记</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-212-【JavaScript】初中级前端JavaScript自测清单-1" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/07/06/212-%E3%80%90JavaScript%E3%80%91%E5%88%9D%E4%B8%AD%E7%BA%A7%E5%89%8D%E7%AB%AFJavaScript%E8%87%AA%E6%B5%8B%E6%B8%85%E5%8D%95-1/" class="article-date">
  <time class="dt-published" datetime="2020-07-06T04:46:41.000Z" itemprop="datePublished">2020-07-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/07/06/212-%E3%80%90JavaScript%E3%80%91%E5%88%9D%E4%B8%AD%E7%BA%A7%E5%89%8D%E7%AB%AFJavaScript%E8%87%AA%E6%B5%8B%E6%B8%85%E5%8D%95-1/">212-【JavaScript】初中级前端JavaScript自测清单-1</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>最近原创文章🔥：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5ee8e32a51882543485780d3">《了不起的 Webpack HMR 学习指南（含源码分析）》</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5eeff398e51d4573e060874d">《了不起的 Webpack 构建流程学习指南》</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5ee78bb7f265da76f15a0698">《你不知道的 WeakMap》番外篇</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5ede5300e51d4578a6798220">《你不知道的 Blob》番外篇</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5ed589a251882542e3022f44">《了不起的 tsconfig.json 指南》</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5e802e41e51d4546b659b31b">《200行JS代码，带你实现代码编译器》</a></li>
</ul>
<hr>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近与部门老大一起面试了许多前端求职者，其中<strong>想换个学习氛围较好的人占多数</strong>，但良好的学习氛围也是需要一点点营造出来的🌺。</p>
<p>为此我们组建了我们团队内部的“<strong>现代 JavaScript 突击队</strong>”，第一期学习内容为<a target="_blank" rel="noopener" href="https://zh.javascript.info/">《现代 JavaScript 教程》</a>系列，帮助小组成员系统地进行学习巩固，并<strong>让大家养成系统性学习和输出学习总结的学习方式</strong>。</p>
<p>本文作为我输出的第一部分学习总结，希望作为一份自测清单，帮助大家巩固知识，温故知新。</p>
<p>这里也下面分享我们学习小组的“押金制度”和“押金记录表”🍀</p>
<p><img src="http://images.pingan8787.com/JavaScript-Base/learn-1.png" alt="“押金制度”和“押金记录表”"></p>
<p>接下来开始分享自测清单的内容。</p>
<p><img src="http://images.pingan8787.com/JavaScript-Base/learn-xmind-1.png" alt="初中级前端 JavaScript 自测清单.png"></p>
<h1 id="一、Hello-World"><a href="#一、Hello-World" class="headerlink" title="一、Hello World!"></a>一、Hello World!</h1><h2 id="1-脚本引入方式"><a href="#1-脚本引入方式" class="headerlink" title="1. 脚本引入方式"></a>1. 脚本引入方式</h2><p>JavaScript 脚本引入方式有两种：</p>
<ul>
<li><code>&lt;script&gt;</code>  标签插入脚本；</li>
<li><code>&lt;script&gt;</code> 标签 <code>src</code> 设置脚本地址。</li>
</ul>
<h2 id="2-script-标签属性"><a href="#2-script-标签属性" class="headerlink" title="2. script 标签属性"></a>2. script 标签属性</h2><p><code>&lt;script&gt;</code>  标签有以下常用属性：</p>
<h3 id="2-1-src"><a href="#2-1-src" class="headerlink" title="2.1 src"></a>2.1 src</h3><p><code>src</code> ：指定外部脚本的URI， 如果设置了 <code>src</code> 特性，script 标签内容将会被忽略；</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;example-url.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-2-type"><a href="#2-2-type" class="headerlink" title="2.2 type"></a>2.2 type</h3><p><code>type</code> ：指定引用脚本的语言，属性值为 MIME 类型，包括<code>text/javascript</code>, <code>text/ecmascript</code>, <code>application/javascript</code>, 和<code>application/ecmascript</code>。如果没有定义这个属性，脚本会被视作JavaScript。</p>
<p>ES6 新增了属性值 <code>module</code> ，代码会被当做 JavaScript 模块。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-3-async"><a href="#2-3-async" class="headerlink" title="2.3 async"></a>2.3 async</h3><p><code>async</code> 规定一旦脚本可用，则会异步执行。<br>注意：async 属性仅适用于外部脚本（<strong>只有在使用 src 属性时</strong>）。<br>有多种执行外部脚本的方法：<br>如果 <code>async=&quot;async&quot;</code> ：脚本相对于页面的其余部分异步地执行（当页面继续进行解析时，脚本将被执行）；<br>如果不使用 <code>async</code>  且 <code>defer=&quot;defer&quot;</code> ：脚本将在页面完成解析时执行；<br>如果既不使用 <code>async </code> 也不使用 <code>defer</code> ：在浏览器继续解析页面之前，立即读取并执行脚本；</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">async</span>=<span class="string">&quot;async&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-4-defer"><a href="#2-4-defer" class="headerlink" title="2.4 defer"></a>2.4 defer</h3><p><code>defer</code>  属性规定是否对脚本执行进行延迟，直到页面加载为止。</p>
<p>如果您的脚本不会改变文档的内容，可将 defer 属性加入到 <code>&lt;script&gt;</code> 标签中，以便加快处理文档的速度。因为浏览器知道它将能够安全地读取文档的剩余部分而不用执行脚本，它将推迟对脚本的解释，直到文档已经显示给用户为止。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">defer</span>=<span class="string">&quot;defer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>详细介绍可以阅读<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/script">《MDN <code>&lt;script&gt; </code>章节 》</a>。</p>
<h1 id="二、代码结构"><a href="#二、代码结构" class="headerlink" title="二、代码结构"></a>二、代码结构</h1><h2 id="1-语句"><a href="#1-语句" class="headerlink" title="1. 语句"></a>1. 语句</h2><p>语句是执行行为（action）的语法结构和命令。如： <code>alert(&#39;Hello, world!&#39;)</code> 这样可以用来显示消息的语句。</p>
<h2 id="2-分号"><a href="#2-分号" class="headerlink" title="2. 分号"></a>2. 分号</h2><p>存在分行符时，多数情况下可以省略分号。但不全是，比如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alert(<span class="number">3</span> +</span><br><span class="line"><span class="number">1</span></span><br><span class="line">+ <span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<p>建议新人最好不要省略分号。</p>
<h2 id="3-注释"><a href="#3-注释" class="headerlink" title="3. 注释"></a>3. 注释</h2><p><strong>单行注释以两个正斜杠字符 <code>//</code> 开始。</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注释文本</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;leo&quot;</span>);</span><br></pre></td></tr></table></figure>
<p><strong>多行注释以一个正斜杠和星号开始 <code>“/*”</code> 并以一个星号和正斜杆结束 <code>“*/”</code>。</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">这是多行注释。</span></span><br><span class="line"><span class="comment">第二行注释。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;leo&quot;</span>);</span><br></pre></td></tr></table></figure>

<h1 id="三、现代模式，”use-strict”"><a href="#三、现代模式，”use-strict”" class="headerlink" title="三、现代模式，”use strict”"></a>三、现代模式，”use strict”</h1><h2 id="1-作用"><a href="#1-作用" class="headerlink" title="1. 作用"></a>1. 作用</h2><p>JavaScript 的严格模式是使用受限制的 JavaScript 的一种方式，从而隐式地退出“草率模式”。</p>
<p><code>&quot;use strict&quot;</code> 指令将浏览器引擎转换为“现代”模式，改变一些内建特性的行为。</p>
<h2 id="2-使用"><a href="#2-使用" class="headerlink" title="2. 使用"></a>2. 使用</h2><p>通过在脚本文件/函数开头添加 <code>&quot;use strict&quot;;</code> 声明，即可启用严格模式。<br>全局开启严格模式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> v = <span class="string">&quot;Hi!  I&#x27;m a strict mode script!&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>函数内开启严格模式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">strict</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">  &#x27;use strict&#x27;</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">nested</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;And so am I!&quot;</span>; </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;Hi!  I&#x27;m a strict mode function!  &quot;</span> + nested();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-注意点"><a href="#3-注意点" class="headerlink" title="3. 注意点"></a>3. 注意点</h2><ol>
<li><code>&quot;use strict&quot;</code> 需要定义在脚本最顶部（函数内除外），否则严格模式可能无法启用。</li>
<li>一旦进入了严格模式，就无法关闭严格模式。</li>
</ol>
<h2 id="4-体验"><a href="#4-体验" class="headerlink" title="4. 体验"></a>4. 体验</h2><p>启用 <code>&quot;use strict&quot;</code> 后，为未定义元素赋值将抛出异常：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line">leo = <span class="number">17</span>; <span class="comment">// Uncaught ReferenceError: leo is not defined</span></span><br></pre></td></tr></table></figure>
<p>启用 <code>&quot;use strict&quot;</code> 后，试图删除不可删除的属性时会抛出异常：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"><span class="keyword">delete</span> <span class="built_in">Object</span>.prototype; <span class="comment">// Uncaught TypeError: Cannot delete property &#x27;prototype&#x27; of function Object() &#123; [native code] &#125;</span></span><br></pre></td></tr></table></figure>
<p>详细介绍可以阅读<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Strict_mode">《MDN 严格模式章节 》</a>。</p>
<h1 id="四、变量"><a href="#四、变量" class="headerlink" title="四、变量"></a>四、变量</h1><h2 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1. 介绍"></a>1. 介绍</h2><p>变量是数据的“命名存储”。</p>
<h2 id="2-使用-1"><a href="#2-使用-1" class="headerlink" title="2. 使用"></a>2. 使用</h2><p>目前定义变量可以使用三种关键字：var / let / const。三者区别可以阅读<a target="_blank" rel="noopener" href="https://es6.ruanyifeng.com/#docs/let">《let 和 const 命令》</a> 。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="string">&quot;leo&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> name = <span class="string">&quot;leo&quot;</span>, age, addr;</span><br><span class="line"><span class="keyword">let</span> name = <span class="string">&quot;leo&quot;</span>, age = <span class="number">27</span>, addr = <span class="string">&quot;fujian&quot;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="3-命名建议"><a href="#3-命名建议" class="headerlink" title="3. 命名建议"></a>3. 命名建议</h2><p>变量命名有 2 个限制：</p>
<ol>
<li>变量名称必须仅包含<strong>字母，数字，符号</strong> <code>$</code> 和 <code>_</code>。</li>
<li>首字符必须<strong>非数字</strong>。<br>变量命名还有一些建议：</li>
</ol>
<ul>
<li>常量一般用全大写，如 <code>const PI = 3.141592</code> ；</li>
<li>使用易读的命名，比如 <code>userName</code> 或者 <code>shoppingCart</code>。</li>
</ul>
<h2 id="4-注意点"><a href="#4-注意点" class="headerlink" title="4. 注意点"></a>4. 注意点</h2><ul>
<li>JavaScript 变量名称区分大小写，如变量 <code>leo</code> 与 <code>Leo</code> 是不同的；</li>
<li>JavaScript 变量名称允许非英文字母，但不推荐，如 <code>let 平安 = &quot;leo&quot;</code> ；</li>
<li>避免使用  <code>a</code>、<code>b</code>、<code>c</code> 这种缩写。</li>
</ul>
<h1 id="五、数据类型"><a href="#五、数据类型" class="headerlink" title="五、数据类型"></a>五、数据类型</h1><p>JavaScript 是一种<strong>弱类型</strong>或者说<strong>动态语言</strong>。这意味着你不用提前声明变量的类型，在程序运行过程中，类型会被自动确定。这也意味着你可以使用同一个变量保存不同类型的数据：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = <span class="number">42</span>;    <span class="comment">// foo is a Number now</span></span><br><span class="line">foo = <span class="string">&quot;bar&quot;</span>; <span class="comment">// foo is a String now</span></span><br><span class="line">foo = <span class="literal">true</span>;  <span class="comment">// foo is a Boolean now</span></span><br></pre></td></tr></table></figure>
<p>详细介绍可以阅读<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Data_structures">《MDN JavaScript 数据类型和数据结构 》</a>。</p>
<h2 id="1-八大数据类型"><a href="#1-八大数据类型" class="headerlink" title="1. 八大数据类型"></a>1. 八大数据类型</h2><p>前七种为基本数据类型，也称为原始类型（值本身无法被改变），而 <code>object</code> 为复杂数据类型。<br>八大数据类型分别是：</p>
<ul>
<li><code>number</code> 用于任何类型的数字：整数或浮点数，在 ±2 范围内的整数。</li>
<li><code>bigint</code> 用于任意长度的整数。</li>
<li><code>string</code> 用于字符串：一个字符串可以包含一个或多个字符，所以没有单独的单字符类型。</li>
<li><code>boolean</code> 用于 <code>true</code> 和 <code>false</code>。</li>
<li><code>null</code> 用于未知的值 —— 只有一个 <code>null</code> 值的独立类型。</li>
<li><code>undefined</code> 用于未定义的值 —— 只有一个 <code>undefined</code> 值的独立类型。</li>
<li><code>symbol</code> 用于唯一的标识符。</li>
<li><code>object</code> 用于更复杂的数据结构。</li>
</ul>
<p><strong>每个类型后面会详细介绍。</strong></p>
<h2 id="2-检测数据类型"><a href="#2-检测数据类型" class="headerlink" title="2. 检测数据类型"></a>2. 检测数据类型</h2><p>通过 <code>typeof</code> 运算符检查：</p>
<ul>
<li>两种形式：<code>typeof x</code> 或者 <code>typeof(x)</code>。</li>
<li>以字符串的形式返回类型名称，例如 <code>&quot;string&quot;</code>。</li>
<li><code>typeof null</code> 会返回 <code>&quot;object&quot;</code> —— 这是 JavaScript 编程语言的一个错误，实际上它并不是一个 <code>object</code>。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typeof</span> <span class="string">&quot;leo&quot;</span> <span class="comment">// &quot;string&quot;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">undefined</span>    <span class="comment">// &quot;undefined&quot;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="number">0</span>     <span class="comment">// &quot;number&quot;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">NaN</span>   <span class="comment">// &quot;number&quot;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="number">10n</span>   <span class="comment">// &quot;bigint&quot;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">true</span>  <span class="comment">// &quot;boolean&quot;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="built_in">Symbol</span>(<span class="string">&quot;id&quot;</span>) <span class="comment">// &quot;symbol&quot;</span></span><br><span class="line"><span class="keyword">typeof</span> [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]    <span class="comment">// &quot;object&quot;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="built_in">Math</span>  <span class="comment">// &quot;object&quot;  (1) Math 是一个提供数学运算的内建 object。</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">null</span>  <span class="comment">// &quot;object&quot;  (2) JavaScript 语言的一个错误，null 不是一个 object。null 有自己的类型，它是一个特殊值。</span></span><br><span class="line"><span class="keyword">typeof</span> alert <span class="comment">// &quot;function&quot;  (3) alert 在 JavaScript 语言中是一个函数。</span></span><br></pre></td></tr></table></figure>
<h1 id="六、类型转换"><a href="#六、类型转换" class="headerlink" title="六、类型转换"></a>六、类型转换</h1>JavaScript 变量可以转换为新变量或其他数据类型：</li>
<li>通过使用 JavaScript 函数</li>
<li>通过 JavaScript 自身自动转换<h2 id="1-字符串转换"><a href="#1-字符串转换" class="headerlink" title="1. 字符串转换"></a>1. 字符串转换</h2>通过全局方法 <code>String()</code>  将<strong>其他类型数据（任何类型的数字，字母，布尔值，对象）</strong>转换为 String 类型：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span>(<span class="number">123</span>);   <span class="comment">// &quot;123&quot;</span></span><br><span class="line"><span class="comment">// Number方法toString()/toExponential()/toFixed()/toPrecision() 也有同样效果。</span></span><br><span class="line"><span class="built_in">String</span>(<span class="literal">false</span>); <span class="comment">// &quot;false&quot;</span></span><br><span class="line"><span class="comment">// Boolean方法 toString() 也有同样效果。</span></span><br><span class="line"><span class="built_in">String</span>(<span class="keyword">new</span> <span class="built_in">Date</span>()); <span class="comment">// &quot;Sun Jun 07 2020 21:44:20 GMT+0800 (中国标准时间)&quot;</span></span><br><span class="line"><span class="comment">// Date方法 toString() 也有同样效果。</span></span><br><span class="line"><span class="built_in">String</span>(leo);</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="2-数值转换"><a href="#2-数值转换" class="headerlink" title="2. 数值转换"></a>2. 数值转换</h2><p>通过以下几种方式能将其他类型数据转换为 Number 类型：</p>
<ul>
<li>一元运算符 <code>+</code><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> age = +<span class="string">&quot;22&quot;</span>; <span class="comment">// 22</span></span><br></pre></td></tr></table></figure></li>
<li><code>Number</code> 方法<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> age = <span class="built_in">Number</span>(<span class="string">&quot;22&quot;</span>); <span class="comment">// 22</span></span><br><span class="line"><span class="built_in">Number</span>.parseFloat(<span class="string">&quot;22&quot;</span>);  <span class="comment">// 22</span></span><br><span class="line"><span class="built_in">Number</span>.parseInt(<span class="string">&quot;22&quot;</span>);  <span class="comment">// 22</span></span><br></pre></td></tr></table></figure></li>
<li>其他方式转 Number 类型<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 布尔值</span></span><br><span class="line"><span class="built_in">Number</span>(<span class="literal">false</span>)     <span class="comment">// 返回 0</span></span><br><span class="line"><span class="built_in">Number</span>(<span class="literal">true</span>)      <span class="comment">// 返回 1</span></span><br><span class="line"><span class="comment">// 日期</span></span><br><span class="line"><span class="keyword">const</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line"><span class="built_in">Number</span>(date);     <span class="comment">// 返回 1591537858154</span></span><br><span class="line">date.getTime();   <span class="comment">// 返回 1591537858154，效果一致。</span></span><br><span class="line"><span class="comment">// 自动转换</span></span><br><span class="line"><span class="number">5</span> + <span class="literal">null</span>    <span class="comment">// 返回 5         null 转换为 0</span></span><br><span class="line"><span class="string">&quot;5&quot;</span> + <span class="literal">null</span>  <span class="comment">// 返回&quot;5null&quot;   null 转换为 &quot;null&quot;</span></span><br><span class="line"><span class="string">&quot;5&quot;</span> + <span class="number">1</span>     <span class="comment">// 返回 &quot;51&quot;      1 转换为 &quot;1&quot; </span></span><br><span class="line"><span class="string">&quot;5&quot;</span> - <span class="number">1</span>     <span class="comment">// 返回 4         &quot;5&quot; 转换为 5</span></span><br></pre></td></tr></table></figure>
<h2 id="3-布尔值转换"><a href="#3-布尔值转换" class="headerlink" title="3. 布尔值转换"></a>3. 布尔值转换</h2>转换规则如下：</li>
<li>直观上为“空”的值（如 <code>0</code>、空字符串、<code>null</code>、<code>undefined</code> 和 <code>NaN</code>）将变为 <code>false</code>。</li>
<li>其他值变成 <code>true</code>。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Boolean</span>(<span class="number">1</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Boolean</span>(<span class="number">0</span>); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Boolean</span>(<span class="string">&quot;hello&quot;</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Boolean</span>(<span class="string">&quot;&quot;</span>); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Boolean</span>(<span class="string">&quot;0&quot;</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Boolean</span>(<span class="string">&quot; &quot;</span>); <span class="comment">// 空白, 也是 true (任何非空字符串是 true)</span></span><br></pre></td></tr></table></figure>
<h2 id="4-小结"><a href="#4-小结" class="headerlink" title="4. 小结"></a>4. 小结</h2><img src="http://images.pingan8787.com/JavaScript-Base/learn-2.png" alt="类型转换"><h1 id="七、运算符"><a href="#七、运算符" class="headerlink" title="七、运算符"></a>七、运算符</h1><h2 id="1、运算符概念"><a href="#1、运算符概念" class="headerlink" title="1、运算符概念"></a>1、运算符概念</h2>常见运算符如加法 <code>+</code> 、减法 <code>-</code> 、乘法 <code>*</code> 和除法 <code>/</code> ，举一个例子，来介绍一些概念：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sum = <span class="number">1</span> + <span class="number">2</span>;</span><br><span class="line"><span class="keyword">let</span> age = +<span class="number">18</span>;</span><br></pre></td></tr></table></figure>
其中：</li>
<li>加法运算 <code>1 + 2</code> 中， <code>1</code> 和 <code>2</code> 为 2 个运算元，左运算元 <code>1</code> 和右运算元 <code>2</code> ，即<strong>运算元就是运算符作用的对象。</strong></li>
<li><code>1 + 2</code> 运算式中包含 2 个运算元，因此也称该运算式中的加号  <code>+</code> 为 <strong>二元运算符。</strong></li>
<li>在 <code>+18</code> 中的加号 <code>+</code> 对应只有一个运算元，则它是 <strong>一元运算符</strong> 。</li>
</ul>
<h2 id="2、-号运算符"><a href="#2、-号运算符" class="headerlink" title="2、+ 号运算符"></a>2、+ 号运算符</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> msg = <span class="string">&quot;hello &quot;</span> + <span class="string">&quot;leo&quot;</span>; <span class="comment">// &quot;hello leo&quot;</span></span><br><span class="line"><span class="keyword">let</span> total = <span class="number">10</span> + <span class="number">20</span>;  <span class="comment">// 30</span></span><br><span class="line"><span class="keyword">let</span> text1 = <span class="string">&quot;1&quot;</span> + <span class="string">&quot;2&quot;</span>; <span class="comment">// &quot;12&quot;</span></span><br><span class="line"><span class="keyword">let</span> text2 = <span class="string">&quot;1&quot;</span> + <span class="number">2</span>;   <span class="comment">// &quot;12&quot;</span></span><br><span class="line"><span class="keyword">let</span> text3 = <span class="number">1</span> + <span class="string">&quot;2&quot;</span>;   <span class="comment">// &quot;12&quot;</span></span><br><span class="line"><span class="keyword">let</span> text4 = <span class="number">1</span> + <span class="number">2</span> + <span class="string">&quot;3&quot;</span>;  <span class="comment">// &quot;33&quot;</span></span><br><span class="line"><span class="keyword">let</span> num = +text1; <span class="comment">//  12 转换为 Number 类型</span></span><br></pre></td></tr></table></figure>

<h2 id="3、运算符优先级"><a href="#3、运算符优先级" class="headerlink" title="3、运算符优先级"></a>3、运算符优先级</h2><p>运算符的优先级决定了表达式中运算执行的先后顺序，优先级高的运算符最先被执行。<br>下面的表将所有运算符按照优先级的不同从高（20）到低（1）排列。<br>| 优先级 | 运算类型 | 关联性 | 运算符 |<br>| :— | :— | :— | :— |<br>| 20 | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Grouping"><code>圆括号</code></a> | n/a（不相关） | <code>( … )</code> |<br>| 19 | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Property_Accessors#%E7%82%B9%E7%AC%A6%E5%8F%B7%E8%A1%A8%E7%A4%BA%E6%B3%95"><code>成员访问</code></a> | 从左到右 | <code>… . …</code> |<br>|  | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Property_Accessors#%E6%8B%AC%E5%8F%B7%E8%A1%A8%E7%A4%BA%E6%B3%95"><code>需计算的成员访问</code></a> | 从左到右 | <code>… [ … ]</code> |<br>|  | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/new"><code>new</code></a> (带参数列表) | n/a | <code>new … ( … )</code> |<br>|  | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Functions">函数调用</a> | 从左到右 | <code>… ( … )</code> |<br>|  | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Optional_chaining">可选链（Optional chaining）</a> | 从左到右 | <code>?.</code> |<br>| 18 | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/new">new</a> (无参数列表) | 从右到左 | <code>new …</code> |<br>| 17 | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Arithmetic_Operators#Increment">后置递增</a>(运算符在后) | n/a<br> | <code>… ++</code> |<br>|  | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Arithmetic_Operators#Decrement">后置递减</a>(运算符在后) |  | <code>… --</code> |<br>| 16 | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Logical_Operators#Logical_NOT">逻辑非</a> | 从右到左 | <code>! …</code> |<br>|  | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Bitwise_Operators#Bitwise_NOT">按位非</a> |  | <code>~ …</code> |<br>|  | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Arithmetic_Operators#Unary_plus">一元加法</a> |  | <code>+ …</code> |<br>|  | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Arithmetic_Operators#Unary_negation">一元减法</a> |  | <code>- …</code> |<br>|  | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Arithmetic_Operators#Increment">前置递增</a> |  | <code>++ …</code> |<br>|  | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Arithmetic_Operators#Decrement">前置递减</a> |  | <code>-- …</code> |<br>|  | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/typeof">typeof</a> |  | <code>typeof …</code> |<br>|  | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/void">void</a> |  | <code>void …</code> |<br>|  | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/delete">delete</a> |  | <code>delete …</code> |<br>|  | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await">await</a> |  | <code>await …</code> |<br>| 15 | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Arithmetic_Operators#Exponentiation">幂</a> | 从右到左 | <code>… ** …</code> |<br>| 14 | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Arithmetic_Operators#Multiplication">乘法</a> | 从左到右<br> | <code>… * …</code> |<br>|  | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Arithmetic_Operators#Division">除法</a> |  | <code>… / …</code> |<br>|  | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Arithmetic_Operators#Remainder">取模</a> |  | <code>… % …</code> |<br>| 13 | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Arithmetic_Operators#Addition">加法</a> | 从左到右<br> | <code>… + …</code> |<br>|  | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Arithmetic_Operators#Subtraction">减法</a> |  | <code>… - …</code> |<br>| 12 | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Bitwise_Operators">按位左移</a> | 从左到右 | <code>… &lt;&lt; …</code> |<br>|  | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Bitwise_Operators">按位右移</a> |  | <code>… &gt;&gt; …</code> |<br>|  | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Bitwise_Operators">无符号右移</a> |  | <code>… &gt;&gt;&gt; …</code> |<br>| 11 | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Comparison_Operators#Less_than_operator">小于</a> | 从左到右 | <code>… &lt; …</code> |<br>|  | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Comparison_Operators#Less_than__or_equal_operator">小于等于</a> |  | <code>… &lt;= …</code> |<br>|  | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Comparison_Operators#Greater_than_operator">大于</a> |  | <code>… &gt; …</code> |<br>|  | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Comparison_Operators#Greater_than_or_equal_operator">大于等于</a> |  | <code>… &gt;= …</code> |<br>|  | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/in">in</a> |  | <code>… in …</code> |<br>|  | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/instanceof">instanceof</a> |  | <code>… instanceof …</code> |<br>| 10 | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Comparison_Operators#Equality">等号</a> | 从左到右<br> | <code>… == …</code> |<br>|  | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Comparison_Operators#Inequality">非等号</a> |  | <code>… != …</code> |<br>|  | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Comparison_Operators#Identity">全等号</a> |  | <code>… === …</code> |<br>|  | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Comparison_Operators#Nonidentity">非全等号</a> |  | <code>… !== …</code> |<br>| 9 | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Bitwise_Operators#Bitwise_AND">按位与</a> | 从左到右 | <code>… &amp; …</code> |<br>| 8 | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Bitwise_Operators#Bitwise_XOR">按位异或</a> | 从左到右 | <code>… ^ …</code> |<br>| 7 | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Bitwise_Operators#Bitwise_OR">按位或</a> | 从左到右 | <code>… | …</code> |<br>| 6 | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Logical_Operators#Logical_AND">逻辑与</a> | 从左到右 | <code>… &amp;&amp; …</code> |<br>| 5 | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Logical_Operators#Logical_OR">逻辑或</a> | 从左到右 | <code>… || …</code> |<br>| 4 | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Conditional_Operator">条件运算符</a> | 从右到左 | <code>… ? … : …</code> |<br>| 3 | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Assignment_Operators">赋值</a> | 从右到左 | <code>… = …</code> |<br>|  |  |  | <code>… += …</code> |<br>|  |  |  | <code>… -= …</code> |<br>|  |  |  | <code>… *= …</code> |<br>|  |  |  | <code>… /= …</code> |<br>|  |  |  | <code>… %= …</code> |<br>|  |  |  | <code>… &lt;&lt;= …</code> |<br>|  |  |  | <code>… &gt;&gt;= …</code> |<br>|  |  |  | <code>… &gt;&gt;&gt;= …</code> |<br>|  |  |  | <code>… &amp;= …</code> |<br>|  |  |  | <code>… ^= …</code> |<br>|  |  |  | <code>… |= …</code> |<br>| 2 | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/yield">yield</a> | 从右到左 | <code>yield …</code> |<br>|  | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/yield*">yield*</a> |  | <code>yield* …</code> |<br>| 1 | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Spread_operator">展开运算符</a> | n/a | <code>...</code> … |<br>| 0 | <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Comma_Operator">逗号</a> | 从左到右 | <code>… , …</code> |</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3</span> &gt; <span class="number">2</span> &amp;&amp; <span class="number">2</span> &gt; <span class="number">1</span></span><br><span class="line"><span class="comment">// return true</span></span><br><span class="line"><span class="number">3</span> &gt; <span class="number">2</span> &gt; <span class="number">1</span></span><br><span class="line"><span class="comment">// 返回 false，因为 3 &gt; 2 是 true，并且 true &gt; 1 is false</span></span><br><span class="line"><span class="comment">// 加括号可以更清楚：(3 &gt; 2) &gt; 1</span></span><br></pre></td></tr></table></figure>

<h1 id="八、值的比较"><a href="#八、值的比较" class="headerlink" title="八、值的比较"></a>八、值的比较</h1><h2 id="1-常见比较"><a href="#1-常见比较" class="headerlink" title="1. 常见比较"></a>1. 常见比较</h2><p>在 JS 中的值的比较与数学很类型：</p>
<ul>
<li>大于/小于/大于等于/小于等于： <code>a&gt;b</code> / <code>a&lt;b</code> / <code>a&gt;=b</code> / <code>a&lt;=b</code> ；</li>
<li>判断相等：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 ==，非严格等于，不关心值类型</span></span><br><span class="line"><span class="comment">// == 运算符会对比较的操作数做隐式类型转换，再比较</span></span><br><span class="line"><span class="string">&#x27;1&#x27;</span> == <span class="number">1</span>; <span class="comment">// true</span></span><br><span class="line"><span class="comment">// 使用 ===，严格相等，关心值类型</span></span><br><span class="line"><span class="comment">// 将数字值 -0 和 +0 视为相等，并认为 Number.NaN 不等于 NaN。</span></span><br><span class="line"><span class="string">&#x27;1&#x27;</span> === <span class="number">1</span>; <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<img src="http://images.pingan8787.com/JavaScript-Base/learn-3.png" alt="值的比较"><br>（图片来自：<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Equality_comparisons_and_sameness">《MDN JavaScript 中的相等性判断》</a>）</li>
<li>判断不相等：<br>和判断相等一样，也有两种： <code>!=</code> / <code>!==</code> 。<h2 id="2-相等性判断（Object-is-）"><a href="#2-相等性判断（Object-is-）" class="headerlink" title="2. 相等性判断（Object.is()）"></a>2. 相等性判断（Object.is()）</h2>另外 ES6 新增 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/is">Object.is</a> 方法判断两个值是否相同，语法如下：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.is(value1, value2);</span><br></pre></td></tr></table></figure>
以下任意项成立则两个值相同：</li>
<li>两个值都是 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/undefined"><code>undefined</code></a></li>
<li>两个值都是 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/null"><code>null</code></a></li>
<li>两个值都是 <code>true</code> 或者都是 <code>false</code></li>
<li>两个值是由相同个数的字符按照相同的顺序组成的字符串</li>
<li>两个值指向同一个对象</li>
<li>两个值都是数字并且<ul>
<li>都是正零 <code>+0</code></li>
<li>都是负零 <code>-0</code></li>
<li>都是 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/NaN"><code>NaN</code></a></li>
<li>都是除零和 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/NaN"><code>NaN</code></a> 外的其它同一个数字<br>使用示例：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.is(<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;foo&#x27;</span>);     <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Object</span>.is(<span class="built_in">window</span>, <span class="built_in">window</span>);   <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Object</span>.is(<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>);     <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Object</span>.is([], []);           <span class="comment">// false</span></span><br><span class="line"><span class="keyword">var</span> foo = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> bar = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="built_in">Object</span>.is(foo, foo);         <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Object</span>.is(foo, bar);         <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Object</span>.is(<span class="literal">null</span>, <span class="literal">null</span>);       <span class="comment">// true</span></span><br><span class="line"><span class="comment">// 特例</span></span><br><span class="line"><span class="built_in">Object</span>.is(<span class="number">0</span>, -<span class="number">0</span>);            <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Object</span>.is(<span class="number">0</span>, +<span class="number">0</span>);            <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Object</span>.is(-<span class="number">0</span>, -<span class="number">0</span>);           <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Object</span>.is(<span class="literal">NaN</span>, <span class="number">0</span>/<span class="number">0</span>);         <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
兼容性 Polyfill 处理：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="built_in">Object</span>.is) &#123;</span><br><span class="line">  <span class="built_in">Object</span>.is = <span class="function"><span class="keyword">function</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// SameValue algorithm</span></span><br><span class="line">    <span class="keyword">if</span> (x === y) &#123; <span class="comment">// Steps 1-5, 7-10</span></span><br><span class="line">      <span class="comment">// Steps 6.b-6.e: +0 != -0</span></span><br><span class="line">      <span class="keyword">return</span> x !== <span class="number">0</span> || <span class="number">1</span> / x === <span class="number">1</span> / y;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// Step 6.a: NaN == NaN</span></span><br><span class="line">      <span class="keyword">return</span> x !== x &amp;&amp; y !== y;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-null-与-undefined-比较"><a href="#3-null-与-undefined-比较" class="headerlink" title="3. null 与 undefined 比较"></a>3. null 与 undefined 比较</h2>对于相等性判断比较简单：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">null</span> == <span class="literal">undefined</span>;  <span class="comment">// true</span></span><br><span class="line"><span class="literal">null</span> === <span class="literal">undefined</span>; <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
对于其他比较，它们会先转换位数字：<br><code>null</code> 转换为 <code>0</code> ， <code>undefied</code> 转换为 <code>NaN</code> 。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">null</span> &gt; <span class="number">0</span>;  <span class="comment">// false 1</span></span><br><span class="line"><span class="literal">null</span> &gt;= <span class="number">0</span>; <span class="comment">// true  2</span></span><br><span class="line"><span class="literal">null</span> == <span class="number">0</span>; <span class="comment">// false 3</span></span><br><span class="line"><span class="literal">null</span> &lt; <span class="number">1</span>;  <span class="comment">// true  4</span></span><br></pre></td></tr></table></figure>
需要注意：<br><code>null == 0; // false</code> 这里是因为：<code>undefined</code> 和 <code>null</code> 在相等性检查 <code>==</code> 中<strong>不会进行任何的类型转换</strong>，它们有自己独立的比较规则，所以除了它们之间互等外，不会等于任何其他的值。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">undefined</span> &gt; <span class="number">0</span>;  <span class="comment">// false  1</span></span><br><span class="line"><span class="literal">undefined</span> &gt; <span class="number">1</span>;  <span class="comment">// false  2</span></span><br><span class="line"><span class="literal">undefined</span> == <span class="number">0</span>; <span class="comment">// false  3</span></span><br></pre></td></tr></table></figure>
第 1、2 行都返回 <code>false</code> 是因为 <code>undefined</code> 在比较中被转换为了 <code>NaN</code>，而 <code>NaN</code> 是一个特殊的数值型值，它与任何值进行比较都会返回 <code>false</code>。<br>第 3 行返回 <code>false</code> 是因为这是一个相等性检查，而 <code>undefined</code> 只与 <code>null</code> 相等，不会与其他值相等。<h1 id="九、alert-prompt-confirm"><a href="#九、alert-prompt-confirm" class="headerlink" title="九、alert / prompt / confirm"></a>九、alert / prompt / confirm</h1><h2 id="1-alert"><a href="#1-alert" class="headerlink" title="1. alert"></a>1. alert</h2>显示一个警告对话框，上面显示有指定的文本内容以及一个“确定”按钮。</li>
</ul>
</li>
</ul>
<p><strong>注意：弹出模态框，并暂停脚本，直到用户点击“确定”按钮。</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 语法</span></span><br><span class="line"><span class="built_in">window</span>.alert(message);</span><br><span class="line">alert(message);</span><br><span class="line"><span class="comment">// 示例</span></span><br><span class="line">alert(<span class="string">&#x27;hello leo!&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p><code>message</code>是要显示在对话框中的文本字符串，如果传入其他类型的值,会转换成字符串。</p>
<h2 id="2-prompt"><a href="#2-prompt" class="headerlink" title="2. prompt"></a>2. prompt</h2><p>显示一个对话框，对话框中包含一条文字信息，用来提示用户输入文字。<br><strong>注意：弹出模态框，并暂停脚本，直到用户点击“确定”按钮。</strong><br>当点击确定返回文本，点击取消或按下 Esc 键返回 <code>null</code>。<br>语法如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> result = <span class="built_in">window</span>.prompt(text, value);</span><br></pre></td></tr></table></figure>
<ul>
<li><code>result</code> 用来存储用户输入文字的字符串，或者是 null。</li>
<li><code>text</code> 用来提示用户输入文字的字符串，如果没有任何提示内容，该参数可以省略不写。</li>
<li><code>value</code> 文本输入框中的默认值，该参数也可以省略不写。不过在 Internet Explorer 7 和 8 中，省略该参数会导致输入框中显示默认值”undefined”。</li>
</ul>
<h2 id="3-confirm"><a href="#3-confirm" class="headerlink" title="3. confirm"></a>3. confirm</h2><p><code>Window.confirm()</code> 方法显示一个具有一个可选消息和两个按钮(确定和取消)的模态对话框。<br><strong>注意：弹出模态框，并暂停脚本，直到用户点击“确定”按钮。</strong><br>语法如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> result = <span class="built_in">window</span>.confirm(message);</span><br></pre></td></tr></table></figure>
<ul>
<li>message 是要在对话框中显示的可选字符串。</li>
<li>result 是一个布尔值，表示是选择确定还是取消 (true表示OK)。</li>
</ul>
<h1 id="十、条件运算符：if-和-‘-’"><a href="#十、条件运算符：if-和-‘-’" class="headerlink" title="十、条件运算符：if 和 ‘?’"></a>十、条件运算符：if 和 ‘?’</h1><h2 id="1-if-语句"><a href="#1-if-语句" class="headerlink" title="1. if 语句"></a>1. if 语句</h2><p>当 if 语句当条件表达式，会将表达式转换为布尔值，当为 truthy 时执行里面代码。<br>转换规则如：</p>
<ul>
<li>数字 <code>0</code>、空字符串 <code>&quot;&quot;</code>、<code>null</code>、<code>undefined</code> 和 <code>NaN</code> 都会被转换成 <code>false</code>。因为他们被称为 “falsy” 值。</li>
<li>其他值被转换为 <code>true</code>，所以它们被称为 “truthy”。<h2 id="2-三元运算符"><a href="#2-三元运算符" class="headerlink" title="2. 三元运算符"></a>2. 三元运算符</h2></li>
</ul>
<p><strong>条件（三元）运算符</strong>是 JavaScript 仅有的使用三个操作数的运算符。一个条件后面会跟一个问号（?），如果条件为 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Glossary/Truthy">truthy</a> ，则问号后面的表达式A将会执行；表达式A后面跟着一个冒号（:），如果条件为 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Glossary/Falsy">falsy</a> ，则冒号后面的表达式B将会执行。本运算符经常作为 <code>[if](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/if...else)</code> 语句的简捷形式来使用。<br>语法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">condition ? exprIfTrue : exprIfFalse</span><br></pre></td></tr></table></figure>
<ul>
<li>condition<br>计算结果用作条件的表达式。</li>
<li>exprIfTrue<br>如果表达式 condition 的计算结果是 truthy（它和 true 相等或者可以转换成 true ），那么表达式 exprIfTrue 将会被求值。</li>
<li>exprIfFalse<br>如果表达式 condition 的计算结果是 falsy（它可以转换成 false ），那么表达式 exprIfFalse 将会被执行。<br>示例：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> getUser = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> name === <span class="string">&#x27;leo&#x27;</span> ? <span class="string">&#x27;hello leo!&#x27;</span> : <span class="string">&#x27;unknow user&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 可以简写如下：</span></span><br><span class="line"><span class="keyword">let</span> getUser = <span class="function"><span class="params">name</span> =&gt;</span> name === <span class="string">&#x27;leo&#x27;</span> ? <span class="string">&#x27;hello leo!&#x27;</span> : <span class="string">&#x27;unknow user&#x27;</span>;</span><br><span class="line">getUser(<span class="string">&#x27;leo&#x27;</span>); <span class="comment">// &quot;hello leo!&quot;</span></span><br><span class="line">getUser(<span class="string">&#x27;pingan&#x27;</span>); <span class="comment">// &quot;unknow user&quot;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="十一、逻辑运算符"><a href="#十一、逻辑运算符" class="headerlink" title="十一、逻辑运算符"></a>十一、逻辑运算符</h1><p>详细可以阅读<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Logical_Operators">《MDN 逻辑运算符》</a> 。</p>
<h2 id="1-运算符介绍"><a href="#1-运算符介绍" class="headerlink" title="1. 运算符介绍"></a>1. 运算符介绍</h2><p>逻辑运算符如下表所示 (其中<code>_expr_</code>可能是任何一种<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Glossary/Data_structure">类型</a>, 不一定是布尔值):<br>| 运算符 | 语法 | 说明 |<br>| :— | :— | :— |<br>| 逻辑与，AND（<code>&amp;&amp;</code>） | <code>_expr1_ &amp;&amp; _expr2_</code> | 若 <code>expr**1**</code> 可转换为 <code>true</code>，则返回 <code>expr**2**</code>；否则，返回 <code>expr**1**</code>。 |<br>| 逻辑或，OR（<code>||</code>） | <code>_expr1_ || _expr2_</code> | 若 <code>expr**1**</code> 可转换为 <code>true</code>，则返回 <code>expr**1**</code>；否则，返回 <code>expr**2**</code>。 |<br>| 逻辑非，NOT（<code>!</code>） | <code>!_expr_</code> | 若 <code>expr</code> 可转换为 <code>true</code>，则返回 <code>false</code>；否则，返回 <code>true</code>。 |<br>如果一个值可以被转换为 <code>true</code>，那么这个值就是所谓的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Glossary/Truthy">truthy</a>，如果可以被转换为 <code>false</code>，那么这个值就是所谓的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Glossary/Falsy">falsy</a>。<br>会被转换为 <code>false</code> 的表达式有：</p>
<ul>
<li><code>null</code>；</li>
<li><code>NaN</code>；</li>
<li><code>0</code>；</li>
<li>空字符串（<code>&quot;&quot;</code> or <code>&#39;&#39;</code> or ````）；</li>
<li><code>undefined</code>。<br>尽管 <code>&amp;&amp;</code> 和 <code>||</code> 运算符能够使用非布尔值的操作数, 但它们依然可以被看作是布尔操作符，因为它们的返回值总是能够被转换为布尔值。如果要显式地将它们的返回值（或者表达式）转换为布尔值，请使用<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Logical_Operators#%E9%80%BB%E8%BE%91%E9%9D%9E%EF%BC%88!%EF%BC%89">双重非运算符</a>（即<code>!!</code>）或者<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean">Boolean</a>构造函数。<br>JavaScript 里有三个逻辑运算符：<code>||</code>（或），<code>&amp;&amp;</code>（与），<code>!</code>（非）。</li>
</ul>
<h2 id="2-运算符示例"><a href="#2-运算符示例" class="headerlink" title="2. 运算符示例"></a>2. 运算符示例</h2><ul>
<li>逻辑与（&amp;&amp;）<br>所有条件都为 true 才返回 true，否则为 false。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a1 = <span class="literal">true</span>  &amp;&amp; <span class="literal">true</span>      <span class="comment">// t &amp;&amp; t 返回 true</span></span><br><span class="line">a2 = <span class="literal">true</span>  &amp;&amp; <span class="literal">false</span>     <span class="comment">// t &amp;&amp; f 返回 false</span></span><br><span class="line">a3 = <span class="literal">false</span> &amp;&amp; <span class="literal">true</span>      <span class="comment">// f &amp;&amp; t 返回 false</span></span><br><span class="line">a4 = <span class="literal">false</span> &amp;&amp; (<span class="number">3</span> == <span class="number">4</span>)  <span class="comment">// f &amp;&amp; f 返回 false</span></span><br><span class="line">a5 = <span class="string">&quot;Cat&quot;</span> &amp;&amp; <span class="string">&quot;Dog&quot;</span>     <span class="comment">// t &amp;&amp; t 返回 &quot;Dog&quot;</span></span><br><span class="line">a6 = <span class="literal">false</span> &amp;&amp; <span class="string">&quot;Cat&quot;</span>     <span class="comment">// f &amp;&amp; t 返回 false</span></span><br><span class="line">a7 = <span class="string">&quot;Cat&quot;</span> &amp;&amp; <span class="literal">false</span>     <span class="comment">// t &amp;&amp; f 返回 false</span></span><br><span class="line">a8 = <span class="string">&#x27;&#x27;</span>    &amp;&amp; <span class="literal">false</span>     <span class="comment">// f &amp;&amp; f 返回 &quot;&quot;</span></span><br><span class="line">a9 = <span class="literal">false</span> &amp;&amp; <span class="string">&#x27;&#x27;</span>        <span class="comment">// f &amp;&amp; f 返回 false</span></span><br></pre></td></tr></table></figure></li>
<li>逻辑或（ || ）<br>所有条件有一个为 true 则返回 true，否则为 false。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">o1 = <span class="literal">true</span>  || <span class="literal">true</span>      <span class="comment">// t || t 返回 true</span></span><br><span class="line">o2 = <span class="literal">false</span> || <span class="literal">true</span>      <span class="comment">// f || t 返回 true</span></span><br><span class="line">o3 = <span class="literal">true</span>  || <span class="literal">false</span>     <span class="comment">// t || f 返回 true</span></span><br><span class="line">o4 = <span class="literal">false</span> || (<span class="number">3</span> == <span class="number">4</span>)  <span class="comment">// f || f 返回 false</span></span><br><span class="line">o5 = <span class="string">&quot;Cat&quot;</span> || <span class="string">&quot;Dog&quot;</span>     <span class="comment">// t || t 返回 &quot;Cat&quot;</span></span><br><span class="line">o6 = <span class="literal">false</span> || <span class="string">&quot;Cat&quot;</span>     <span class="comment">// f || t 返回 &quot;Cat&quot;</span></span><br><span class="line">o7 = <span class="string">&quot;Cat&quot;</span> || <span class="literal">false</span>     <span class="comment">// t || f 返回 &quot;Cat&quot;</span></span><br><span class="line">o8 = <span class="string">&#x27;&#x27;</span>    || <span class="literal">false</span>     <span class="comment">// f || f 返回 false</span></span><br><span class="line">o9 = <span class="literal">false</span> || <span class="string">&#x27;&#x27;</span>        <span class="comment">// f || f 返回 &quot;&quot;</span></span><br></pre></td></tr></table></figure></li>
<li>逻辑非（ ! ）<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">n1 = !<span class="literal">true</span>              <span class="comment">// !t 返回 false</span></span><br><span class="line">n2 = !<span class="literal">false</span>             <span class="comment">// !f 返回 true</span></span><br><span class="line">n3 = !<span class="string">&#x27;&#x27;</span>                <span class="comment">// !f 返回 true</span></span><br><span class="line">n4 = !<span class="string">&#x27;Cat&#x27;</span>             <span class="comment">// !t 返回 false</span></span><br></pre></td></tr></table></figure></li>
<li>双重非运（ !! ）<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">n1 = !!<span class="literal">true</span>                   <span class="comment">// !!truthy 返回 true</span></span><br><span class="line">n2 = !!&#123;&#125;                     <span class="comment">// !!truthy 返回 true: 任何 对象都是 truthy 的…</span></span><br><span class="line">n3 = !!(<span class="keyword">new</span> <span class="built_in">Boolean</span>(<span class="literal">false</span>))   <span class="comment">// …甚至 .valueOf() 返回 false 的布尔值对象也是！</span></span><br><span class="line">n4 = !!<span class="literal">false</span>                  <span class="comment">// !!falsy 返回 false</span></span><br><span class="line">n5 = !!<span class="string">&quot;&quot;</span>                     <span class="comment">// !!falsy 返回 false</span></span><br><span class="line">n6 = !!<span class="built_in">Boolean</span>(<span class="literal">false</span>)         <span class="comment">// !!falsy 返回 false</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="3-布尔值转换规则"><a href="#3-布尔值转换规则" class="headerlink" title="3. 布尔值转换规则"></a>3. 布尔值转换规则</h2><ul>
<li>将 &amp;&amp; 转换为 ||<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">condi1 &amp;&amp; confi2</span><br><span class="line"><span class="comment">// 转换为</span></span><br><span class="line">!(!condi1 || !condi2)</span><br></pre></td></tr></table></figure></li>
<li>将 || 转换为 &amp;&amp;<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">condi1 || condi2</span><br><span class="line"><span class="comment">// 转换为</span></span><br><span class="line">!(!condi1 &amp;&amp; !condi2)</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="4-短路取值"><a href="#4-短路取值" class="headerlink" title="4. 短路取值"></a>4. 短路取值</h2><p>由于逻辑表达式的运算顺序是从左到右，也可以用以下规则进行”短路”计算：</p>
<ul>
<li><code>(some falsy expression) &amp;&amp; (_expr)_</code> 短路计算的结果为假。</li>
<li><code>(some truthy expression) || _(expr)_</code> 短路计算的结果为真。<br>短路意味着上述表达式中的expr部分<strong>不会被执行</strong>，因此expr的任何副作用都不会生效（举个例子，如果expr是一次函数调用，这次调用就不会发生）。造成这种现象的原因是，整个表达式的值在第一个操作数被计算后已经确定了。看一个例子：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">A</span>(<span class="params"></span>)</span>&#123; <span class="built_in">console</span>.log(<span class="string">&#x27;called A&#x27;</span>); <span class="keyword">return</span> <span class="literal">false</span>; &#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">B</span>(<span class="params"></span>)</span>&#123; <span class="built_in">console</span>.log(<span class="string">&#x27;called B&#x27;</span>); <span class="keyword">return</span> <span class="literal">true</span>; &#125;</span><br><span class="line"><span class="built_in">console</span>.log( A() &amp;&amp; B() );</span><br><span class="line"><span class="comment">// logs &quot;called A&quot; due to the function call,</span></span><br><span class="line"><span class="comment">// then logs false (which is the resulting value of the operator)</span></span><br><span class="line"><span class="built_in">console</span>.log( B() || A() );</span><br><span class="line"><span class="comment">// logs &quot;called B&quot; due to the function call,</span></span><br><span class="line"><span class="comment">// then logs true (which is the resulting value of the operator)</span></span><br></pre></td></tr></table></figure>
<h2 id="5-注意"><a href="#5-注意" class="headerlink" title="5. 注意"></a>5. 注意</h2>与运算 <code>&amp;&amp;</code> 的优先级比或运算 <code>||</code> 要高。<br>所以代码 <code>a &amp;&amp; b || c &amp;&amp; d</code> 完全跟 <code>&amp;&amp;</code> 表达式加了括号一样：<code>(a &amp;&amp; b) || (c &amp;&amp; d)</code>。</li>
</ul>
<h1 id="十二、循环：while-和-for"><a href="#十二、循环：while-和-for" class="headerlink" title="十二、循环：while 和 for"></a>十二、循环：while 和 for</h1><h2 id="1-while-循环"><a href="#1-while-循环" class="headerlink" title="1. while 循环"></a>1. while 循环</h2><p>详细可以阅读<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/while">《MDN  while》</a> 。<br><strong>while 语句</strong>可以在某个条件表达式为真的前提下，循环执行指定的一段代码，直到那个表达式不为真时结束循环。<br>如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> n = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> x = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (n &lt; <span class="number">3</span>) &#123;</span><br><span class="line">  n++;</span><br><span class="line">  x += n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当循环体为单行时，可以不写大括号：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> i = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">while</span>(i) <span class="built_in">console</span>.log(i --);</span><br></pre></td></tr></table></figure>

<h2 id="2-do…while-循环"><a href="#2-do…while-循环" class="headerlink" title="2. do…while 循环"></a>2. do…while 循环</h2><p>详细可以阅读<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/do...while">《MDN  do…while》</a> 。<br><code>do...while</code> 语句创建一个执行指定语句的循环，直到<code>condition</code>值为 false。在执行<code>statement</code> 后检测<code>condition</code>，所以指定的<code>statement</code>至少执行一次。<br>如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> result = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">   i += <span class="number">1</span>;</span><br><span class="line">   result += i + <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">&#125; <span class="keyword">while</span> (i &lt; <span class="number">5</span>);</span><br></pre></td></tr></table></figure>
<h2 id="3-for-循环"><a href="#3-for-循环" class="headerlink" title="3. for 循环"></a>3. for 循环</h2><p>详细可以阅读<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/for">《MDN  for》</a> 。<br><code>for</code> 语句用于创建一个循环，它包含了三个可选的表达式，这三个表达式被包围在圆括号之中，使用分号分隔，后跟一个用于在循环中执行的语句（通常是一个<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/block">块语句</a>）。<br>语法如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (begin; condition; step) &#123;</span><br><span class="line">  <span class="comment">// ……循环体……</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>描述：<br>| begin | <code>i = 0</code> | 进入循环时执行一次。 |<br>| — | — | — |<br>| condition | <code>i &lt; 3</code> | 在每次循环迭代之前检查，如果为 false，停止循环。 |<br>| body（循环体） | <code>alert(i)</code> | 条件为真时，重复运行。 |<br>| step | <code>i++</code> | 在每次循环体迭代后执行。 |</p>
<h2 id="4-可选的-for-表达式"><a href="#4-可选的-for-表达式" class="headerlink" title="4. 可选的 for 表达式"></a>4. 可选的 for 表达式</h2><p><code>for</code> 语句头部圆括号中的所有三个表达式都是可选的。</p>
<ul>
<li>不指定表达式中初始化块<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>不指定表达式中条件块，这就必须要求在循环体中结束循环，否则会出现死循环<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>;; i++) &#123;</span><br><span class="line">   <span class="built_in">console</span>.log(i);</span><br><span class="line">   <span class="keyword">if</span> (i &gt; <span class="number">3</span>) <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>不指定所有表达式，也需要在循环体中指定结束循环的条件<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (;;) &#123;</span><br><span class="line">  <span class="keyword">if</span> (i &gt; <span class="number">3</span>) <span class="keyword">break</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(i);</span><br><span class="line">  i++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="5-break-语句"><a href="#5-break-语句" class="headerlink" title="5. break 语句"></a>5. break 语句</h2>详细可以阅读<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/break">《MDN  break》</a> 。<br>break 语句中止当前循环，<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/switch"><code>switch</code></a>语句或<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/label"><code>label</code></a> 语句，并把程序控制流转到紧接着被中止语句后面的语句。<br>在 while 语句中：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">testBreak</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (i &lt; <span class="number">6</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (i == <span class="number">3</span>) &#123;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    i += <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> i * x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
另外，也可以为代码块做标记，并在 break 中指定要跳过的代码块语句的 label：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">outer_block:&#123;</span><br><span class="line">  <span class="attr">inner_block</span>:&#123;</span><br><span class="line">    <span class="built_in">console</span>.log (<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line">    <span class="keyword">break</span> outer_block;      <span class="comment">// breaks out of both inner_block and outer_block</span></span><br><span class="line">    <span class="built_in">console</span>.log (<span class="string">&#x27;:-(&#x27;</span>);    <span class="comment">// skipped</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log (<span class="string">&#x27;2&#x27;</span>);        <span class="comment">// skipped</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
需要注意的是：break 语句需要内嵌在它所应用的标签或代码块中，否则报错：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">block_1:&#123;</span><br><span class="line">  <span class="built_in">console</span>.log (<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line">  <span class="keyword">break</span> block_2;            <span class="comment">// SyntaxError: label not found</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="attr">block_2</span>:&#123;</span><br><span class="line">  <span class="built_in">console</span>.log (<span class="string">&#x27;2&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="6-continue-语句"><a href="#6-continue-语句" class="headerlink" title="6. continue 语句"></a>6. continue 语句</h2>continue 声明终止当前循环或标记循环的当前迭代中的语句执行，并在下一次迭代时继续执行循环。<br>与 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/break"><code>break</code></a> 语句的区别在于， continue 并不会终止循环的迭代，而是：</li>
<li>在 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/while"><code>while</code></a> 循环中，控制流跳转回条件判断；</li>
<li>在 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/for"><code>for</code></a> 循环中，控制流跳转到更新语句。<br>注意：continue 也必须在对应循环内部，否则报错。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="number">0</span>;</span><br><span class="line">n = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (i &lt; <span class="number">5</span>) &#123;</span><br><span class="line">   i++;</span><br><span class="line">   <span class="keyword">if</span> (i === <span class="number">3</span>) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   n += i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
带 label：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i = <span class="number">0</span>, </span><br><span class="line">    j = <span class="number">8</span>;</span><br><span class="line">checkiandj: <span class="keyword">while</span> (i &lt; <span class="number">4</span>) &#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&quot;i: &quot;</span> + i);</span><br><span class="line">   i += <span class="number">1</span>;</span><br><span class="line">   checkj: <span class="keyword">while</span> (j &gt; <span class="number">4</span>) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;j: &quot;</span>+ j);</span><br><span class="line">      j -= <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">if</span> ((j % <span class="number">2</span>) == <span class="number">0</span>)</span><br><span class="line">         <span class="keyword">continue</span> checkj;</span><br><span class="line">      <span class="built_in">console</span>.log(j + <span class="string">&quot; is odd.&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&quot;i = &quot;</span> + i);</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&quot;j = &quot;</span> + j);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="7-注意"><a href="#7-注意" class="headerlink" title="7. 注意"></a>7. 注意</h2></li>
</ul>
<p><strong>禁止 <strong><code>break/continue</code></strong> 在 ‘?’ 的右边：</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(i &gt; <span class="number">5</span>) ? <span class="built_in">console</span>.log(i) : <span class="keyword">continue</span>; <span class="comment">// continue 不允许在这个位置</span></span><br></pre></td></tr></table></figure>
<p>这样会提示语法错误。<br>请注意非表达式的语法结构不能与三元运算符 <code>?</code> 一起使用。特别是 <code>break/continue</code> 这样的指令是不允许这样使用的。</p>
<h2 id="8-总结"><a href="#8-总结" class="headerlink" title="8. 总结"></a>8. 总结</h2><p>三种循环：</p>
<ul>
<li><code>while</code> —— 每次迭代之前都要检查条件。</li>
<li><code>do..while</code> —— 每次迭代后都要检查条件。</li>
<li><code>for (;;)</code> —— 每次迭代之前都要检查条件，可以使用其他设置。<br>通常使用 <code>while(true)</code> 来构造“无限”循环。这样的循环和其他循环一样，都可以通过 <code>break</code> 指令来终止。<br>如果我们不想在当前迭代中做任何事，并且想要转移至下一次迭代，那么可以使用 <code>continue</code> 指令。<br><code>break/continue</code> 支持循环前的标签。标签是 <code>break/continue</code> 跳出嵌套循环以转到外部的唯一方法。</li>
</ul>
<h1 id="十三、”switch”-语句"><a href="#十三、”switch”-语句" class="headerlink" title="十三、”switch” 语句"></a>十三、”switch” 语句</h1><p><code>switch</code> 语句用来将表达式的值与 case 语句匹配，并执行与情况对应的语句。<br><code>switch</code> 语句可以替代多个 if 判断，为多个分支选择的情况提供一个更具描述性的方式。</p>
<h2 id="1-语法"><a href="#1-语法" class="headerlink" title="1. 语法"></a>1. 语法</h2><p><code>switch</code> 语句至少包含一个 <code>case</code> 代码块和一个可选的 <code>default</code> 代码块：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span>(expression) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">&#x27;value1&#x27;</span>:</span><br><span class="line">    <span class="comment">// do something ...</span></span><br><span class="line">    [<span class="keyword">break</span>]</span><br><span class="line">   </span><br><span class="line">  <span class="attr">default</span>:</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    [<span class="keyword">break</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当 <code>expression</code> 表达式的值与 <code>value1</code> 匹配时，则执行其中代码块。<br>如果没有 <code>case</code>  子句匹配，则会选择 <code>default</code> 子句执行，若连 <code>default</code> 子句都没有，则直接执行到 <code>switch</code> 结束。</p>
<h2 id="2-使用-case-分组"><a href="#2-使用-case-分组" class="headerlink" title="2. 使用 case 分组"></a>2. 使用 case 分组</h2><p>所谓 case 分组，就是与多个 case 分支共享同一段代码，如下面例子中 <code>case 1</code>  和 <code>case 2</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">switch</span> (a) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">1</span>: <span class="comment">// (*) 下面这两个 case 被分在一组</span></span><br><span class="line">  <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;case is 1 or 2!&#x27;</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;case is 3!&#x27;</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;The result is default.&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// &#x27;case is 1 or 2!&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="3-注意点-1"><a href="#3-注意点-1" class="headerlink" title="3. 注意点"></a>3. 注意点</h2><ol>
<li><strong><code>expression</code> 表达式的值与 <code>case</code> 值的比较是严格相等：</strong><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">n</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> a ;</span><br><span class="line">    <span class="keyword">switch</span>(n)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            a = <span class="string">&#x27;number&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            a = <span class="string">&#x27;string&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            a = <span class="string">&#x27;default&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(a)</span><br><span class="line">&#125;</span><br><span class="line">f(<span class="number">1</span>);   <span class="comment">// number</span></span><br><span class="line">f(<span class="string">&#x27;1&#x27;</span>); <span class="comment">// string</span></span><br></pre></td></tr></table></figure></li>
<li>**如果没有 <code>break</code>，程序将不经过任何检查就会继续执行下一个 **<code>**case**</code> :<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">2</span> + <span class="number">2</span>;</span><br><span class="line"><span class="keyword">switch</span> (a) &#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">&#x27;Too small&#x27;</span> );</span><br><span class="line">  <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">&#x27;Exactly!&#x27;</span> );</span><br><span class="line">  <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">&#x27;Too big&#x27;</span> );</span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">&quot;I don&#x27;t know such values&quot;</span> );</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Exactly!</span></span><br><span class="line"><span class="comment">// Too big</span></span><br><span class="line"><span class="comment">// I don&#x27;t know such values</span></span><br></pre></td></tr></table></figure></li>
<li><code>**default**</code> **放在 **<code>**case**</code> <strong>之上不影响匹配：</strong><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">n</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (n) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;default&#x27;</span>)</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:  </span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">f(<span class="number">1</span>); <span class="comment">// 1</span></span><br><span class="line">f(<span class="number">2</span>); <span class="comment">// 2</span></span><br><span class="line">f(<span class="number">3</span>); <span class="comment">// default</span></span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li><strong><code>switch</code> 语句中存在 <code>let</code> / <code>const</code>重复声明问题：</strong><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以下定义会报错</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">n</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">switch</span>(n)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">let</span> msg = <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>: </span><br><span class="line">            <span class="keyword">let</span> msg = <span class="string">&#x27;leo&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>: </span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;default&#x27;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Error: Uncaught SyntaxError: Identifier &#x27;msg&#x27; has already been declared</span></span><br></pre></td></tr></table></figure>
这是由于两个 <code>let</code> 处于同一个块级作用域，所以它们被认为是同一变量名的重复声明。<br>解决方式，只需要将 <code>case</code> 语句包装在括号内即可解决：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">n</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">switch</span>(n)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:&#123; <span class="comment">// added brackets</span></span><br><span class="line">            <span class="keyword">let</span> msg = <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line">            <span class="built_in">console</span>.log(msg);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>: &#123;</span><br><span class="line">            <span class="keyword">let</span> msg = <span class="string">&#x27;leo&#x27;</span>;</span><br><span class="line">            <span class="built_in">console</span>.log(msg);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="attr">default</span>: </span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;default&#x27;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="十四、函数"><a href="#十四、函数" class="headerlink" title="十四、函数"></a>十四、函数</h1><p>函数可以让一段代码被多次调用，避免重复代码。<br>如之前学习到的一些内置函数： <code>alert(msg)</code> / <code>prompt(msg, default)</code> / <code>confirm(quesyion)</code> 等。</p>
<h2 id="1-函数定义"><a href="#1-函数定义" class="headerlink" title="1. 函数定义"></a>1. 函数定义</h2><p>定义函数有两种方式：<strong>函数声明</strong>和<strong>函数表达式</strong>。</p>
<h3 id="1-1-函数声明"><a href="#1-1-函数声明" class="headerlink" title="1.1 函数声明"></a>1.1 函数声明</h3><p>如定义一个简单 <code>getUser</code> 函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUser</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&#x27;hello &#x27;</span> + name;</span><br><span class="line">&#125;</span><br><span class="line">getUser(<span class="string">&#x27;leo&quot;); // 函数调用</span></span><br></pre></td></tr></table></figure>
<p>通过函数声明来定义函数时，需要由以下几部分组成：</p>
<ul>
<li>函数名称 - <code>getUser</code> ；</li>
<li>函数参数列表 - <code>name</code> ；</li>
<li>函数的 JS 执行语句 - <code>return &#39;hello &#39; + name</code> 。</li>
</ul>
<h3 id="1-2-函数表达式"><a href="#1-2-函数表达式" class="headerlink" title="1.2 函数表达式"></a>1.2 函数表达式</h3><p>类似声明变量，还是以 <code>getUser</code> 为例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> getUser = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&#x27;hello &#x27;</span> + name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>另外，函数表达式也可以提供函数名，并用于函数内部指代函数本身：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fun = <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">n</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> n &lt; <span class="number">3</span> ? <span class="number">1</span> : n * f(n - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">fun(<span class="number">3</span>);  <span class="comment">// 3</span></span><br><span class="line">fun(<span class="number">5</span>);  <span class="comment">// 60</span></span><br></pre></td></tr></table></figure>

<h2 id="2-函数调用"><a href="#2-函数调用" class="headerlink" title="2. 函数调用"></a>2. 函数调用</h2><p>当定义一个函数后，它并不会自动执行，而是需要使用函数名称进行调用，如上面例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fun(<span class="number">3</span>);  <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>
<p><strong>只要注意：</strong><br>使用 <strong>函数表达式</strong> 定义函数时，调用函数的方法必须写在定义之后，否则报错：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(fun());  <span class="comment">// Uncaught ReferenceError: fun is not defined</span></span><br><span class="line"><span class="keyword">let</span> fun = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> <span class="number">1</span>&#125;;</span><br></pre></td></tr></table></figure>
<p>而使用 <strong>函数声明</strong> 则不会出现该问题：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(fun());  <span class="comment">// 1</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> <span class="number">1</span>&#125;;</span><br></pre></td></tr></table></figure>
<p>原因就是：函数提升仅适用于函数声明，而不适用于函数表达式。</p>
<h2 id="3-函数中的变量"><a href="#3-函数中的变量" class="headerlink" title="3. 函数中的变量"></a>3. 函数中的变量</h2><p>在函数中，可以使用局部变量和外部变量。</p>
<h3 id="3-1-局部变量"><a href="#3-1-局部变量" class="headerlink" title="3.1 局部变量"></a>3.1 局部变量</h3><p>函数中声明的变量只能在该函数内可见。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fun = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">let</span> name = <span class="string">&#x27;leo&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">fun();</span><br><span class="line"><span class="built_in">console</span>.log(name); <span class="comment">// Uncaught ReferenceError: name is not defined</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-全局变量"><a href="#3-2-全局变量" class="headerlink" title="3.2 全局变量"></a>3.2 全局变量</h3><p>函数内可以使用外部变量，并且可以修改外部变量的值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="string">&#x27;leo&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> fun = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">let</span> text = <span class="string">&#x27;Hello, &#x27;</span> + name;</span><br><span class="line">  <span class="built_in">console</span>.log(text);</span><br><span class="line">&#125;</span><br><span class="line">fun(); <span class="comment">// Hello, leo</span></span><br></pre></td></tr></table></figure>
<p>当函数内也有与外部变量名称相同的变量，会忽略外部变量：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="string">&#x27;leo&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> fun = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> name = <span class="string">&#x27;pingan8787&#x27;</span>;</span><br><span class="line">	<span class="keyword">let</span> text = <span class="string">&#x27;Hello, &#x27;</span> + name;</span><br><span class="line">  <span class="built_in">console</span>.log(text);</span><br><span class="line">&#125;</span><br><span class="line">fun(); <span class="comment">// Hello, pingan8787</span></span><br></pre></td></tr></table></figure>

<h2 id="4-函数参数"><a href="#4-函数参数" class="headerlink" title="4. 函数参数"></a>4. 函数参数</h2><p>从ECMAScript 6开始，有两个新的类型的参数：默认参数，剩余参数。</p>
<h3 id="4-1-默认参数"><a href="#4-1-默认参数" class="headerlink" title="4.1 默认参数"></a>4.1 默认参数</h3><p>若函数没有传入参数，则参数默认值为<code>undefined</code>，通常设置参数默认值是这样做的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES6 之前，没有设置默认值</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">a, b</span>)</span>&#123;</span><br><span class="line">    b = b ? b : <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> a * b;</span><br><span class="line">&#125;</span><br><span class="line">f(<span class="number">2</span>,<span class="number">3</span>);  <span class="comment">// 6</span></span><br><span class="line">f(<span class="number">2</span>);    <span class="comment">// 2</span></span><br><span class="line"><span class="comment">// ES6，设置默认值</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">a, b = <span class="number">1</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a * b;</span><br><span class="line">&#125;</span><br><span class="line">f(<span class="number">2</span>,<span class="number">3</span>);  <span class="comment">// 6</span></span><br><span class="line">f(<span class="number">2</span>);    <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<h3 id="4-2-剩余参数"><a href="#4-2-剩余参数" class="headerlink" title="4.2 剩余参数"></a>4.2 剩余参数</h3><p>可以将参数中不确定数量的参数表示成数组，如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span> (<span class="params">a, ...b</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(a, b);</span><br><span class="line">&#125;</span><br><span class="line">f(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>); <span class="comment">// a =&gt; 1 b =&gt; [2, 3, 4]</span></span><br></pre></td></tr></table></figure>
<p>既然讲到参数，那就不能少了 arguments 对象。</p>
<h3 id="4-3-arguments-对象"><a href="#4-3-arguments-对象" class="headerlink" title="4.3 arguments 对象"></a>4.3 arguments 对象</h3><p>函数的实际参数会被保存在一个<strong>类似数组的arguments对象</strong>中。在函数内，我们可以使用 arguments 对象获取函数的所有参数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fun = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">arguments</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">arguments</span>.length);</span><br><span class="line">&#125;</span><br><span class="line">fun(<span class="string">&#x27;leo&#x27;</span>); </span><br><span class="line"><span class="comment">// Arguments [&quot;leo&quot;, callee: ƒ, Symbol(Symbol.iterator): ƒ] </span></span><br><span class="line"><span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<p>以一个实际示例介绍，实现将任意数量参数连接成一个字符串，并输出的函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> argumentConcat = <span class="function"><span class="keyword">function</span>(<span class="params">separator</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">let</span> result = <span class="string">&#x27;&#x27;</span>, i;</span><br><span class="line">  <span class="keyword">for</span>(i = <span class="number">1</span>; i &lt; <span class="built_in">arguments</span>.length; i ++)&#123;</span><br><span class="line">  	result += <span class="built_in">arguments</span>[i] + separator;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">argumentConcat(<span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27;leo&#x27;</span>, <span class="string">&#x27;pingan&#x27;</span>); <span class="comment">//&quot;leo,pingan,&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="5-函数返回值"><a href="#5-函数返回值" class="headerlink" title="5. 函数返回值"></a>5. 函数返回值</h2><p>在函数任意位置，指定 <code>return</code> 指令来停止函数的执行，并返回函数指定的返回值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sum = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> a + b;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> res = sum(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"><span class="built_in">console</span>.log(res); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>
<p>默认空值的 <code>return</code> 或没有 <code>return</code> 的函数返回值为 <code>undefined</code> 。</p>
<h1 id="十五、函数表达式"><a href="#十五、函数表达式" class="headerlink" title="十五、函数表达式"></a>十五、函数表达式</h1><p>函数表达式是一种函数定义方式，在前面章节中已经介绍到了，这个部分将着重介绍 <strong>函数表达式</strong> 和 <strong>函数声明</strong> 的区别：</p>
<h2 id="1-语法差异"><a href="#1-语法差异" class="headerlink" title="1. 语法差异"></a>1. 语法差异</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数表达式</span></span><br><span class="line"><span class="keyword">let</span> fun = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line"><span class="comment">// 函数声明</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params"></span>)</span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-创建时机差异"><a href="#2-创建时机差异" class="headerlink" title="2. 创建时机差异"></a>2. 创建时机差异</h2><p>函数表达式会在代码执行到达时被创建，并且仅从那一刻可用。<br>而函数声明被定义之前，它就可以被调用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数表达式</span></span><br><span class="line">fun();  <span class="comment">// Uncaught ReferenceError: fun is not defined</span></span><br><span class="line"><span class="keyword">let</span> fun = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="string">&#x27;leo&#x27;</span>)&#125;;</span><br><span class="line"><span class="comment">// 函数声明</span></span><br><span class="line">fun();  <span class="comment">// &quot;leo&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="string">&#x27;leo&#x27;</span>)&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="3-使用建议"><a href="#3-使用建议" class="headerlink" title="3. 使用建议"></a>3. 使用建议</h2><p>建议优先考虑函数声明语法，它能够为组织代码提供更多灵活性，因为我们可以在声明函数前调用该函数。</p>
<h1 id="十六、箭头函数"><a href="#十六、箭头函数" class="headerlink" title="十六、箭头函数"></a>十六、箭头函数</h1><p><strong>本章节简单介绍箭头函数基础知识，后面章节会完整介绍。</strong><br><strong>函数箭头表达式</strong>是ES6新增的函数表达式的语法，也叫<strong>胖箭头函数</strong>，变化：更简洁的函数和<code>this</code>。</p>
<h2 id="1-代码更简洁"><a href="#1-代码更简洁" class="headerlink" title="1. 代码更简洁"></a>1. 代码更简洁</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 有1个参数</span></span><br><span class="line"><span class="keyword">let</span> f = <span class="function"><span class="params">v</span> =&gt;</span> v;</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="keyword">let</span> f = <span class="function"><span class="keyword">function</span> (<span class="params">v</span>)</span>&#123;<span class="keyword">return</span> v&#125;;</span><br><span class="line"><span class="comment">// 有多个参数</span></span><br><span class="line"><span class="keyword">let</span> f = <span class="function">(<span class="params">v, i</span>) =&gt;</span> &#123;<span class="keyword">return</span> v + i&#125;;</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="keyword">let</span> f = <span class="function"><span class="keyword">function</span> (<span class="params">v, i</span>)</span>&#123;<span class="keyword">return</span> v + i&#125;;</span><br><span class="line"><span class="comment">// 没参数</span></span><br><span class="line"><span class="keyword">let</span> f = <span class="function">() =&gt;</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="keyword">let</span> f = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;<span class="keyword">return</span> <span class="number">1</span>&#125;;</span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>];</span><br><span class="line">arr.map(<span class="function"><span class="params">ele</span> =&gt;</span> ele + <span class="number">1</span>);  <span class="comment">// [2, 3, 4, 5]</span></span><br></pre></td></tr></table></figure>

<h2 id="2-注意点"><a href="#2-注意点" class="headerlink" title="2. 注意点"></a>2. 注意点</h2><ol>
<li>箭头函数不存在<code>this</code>；</li>
<li>箭头函数不能当做<strong>构造函数</strong>，即不能用<code>new</code>实例化；</li>
<li>箭头函数不存在<code>arguments</code>对象，即不能使用，可以使用<code>rest</code>参数代替；</li>
<li>箭头函数不能使用<code>yield</code>命令，即不能用作Generator函数。<br>一个简单的例子：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.age = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.age++;</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> Person(); <span class="comment">// 定时器一直在执行 p的值一直变化</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>本文作为《初中级前端 JavaScript 自测清单》第一部分，介绍的内容以常用基础知识为主，并在学习资料中，将知识点结合实际开发中遇到的场景进行展开介绍。希望能帮助大家自测自己的 JavaScript 水平并查缺补漏，温故知新。</p>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#x70;&#x69;&#110;&#103;&#97;&#x6e;&#56;&#55;&#x38;&#x37;&#x40;&#x71;&#113;&#x2e;&#x63;&#111;&#x6d;">&#x70;&#x69;&#110;&#103;&#97;&#x6e;&#56;&#55;&#x38;&#x37;&#x40;&#x71;&#113;&#x2e;&#x63;&#111;&#x6d;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>ES小册</td>
<td>js.pingan8787.com</td>
</tr>
<tr>
<td>语雀知识库</td>
<td><a target="_blank" rel="noopener" href="https://www.yuque.com/wangpingan/cute-frontend">Cute-FrontEnd</a></td>
</tr>
</tbody></table>
<p><img src="http://images.pingan8787.com/2019_07_12guild_page.png" alt="bg">  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/07/06/212-%E3%80%90JavaScript%E3%80%91%E5%88%9D%E4%B8%AD%E7%BA%A7%E5%89%8D%E7%AB%AFJavaScript%E8%87%AA%E6%B5%8B%E6%B8%85%E5%8D%95-1/" data-id="ckts3ejzq00r44d9kcq6vhn4o" data-title="212-【JavaScript】初中级前端JavaScript自测清单-1" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag">读书笔记</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-211-【Webpack】了不起的Webpack构建流程学习指南" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/07/06/211-%E3%80%90Webpack%E3%80%91%E4%BA%86%E4%B8%8D%E8%B5%B7%E7%9A%84Webpack%E6%9E%84%E5%BB%BA%E6%B5%81%E7%A8%8B%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97/" class="article-date">
  <time class="dt-published" datetime="2020-07-06T04:44:14.000Z" itemprop="datePublished">2020-07-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/07/06/211-%E3%80%90Webpack%E3%80%91%E4%BA%86%E4%B8%8D%E8%B5%B7%E7%9A%84Webpack%E6%9E%84%E5%BB%BA%E6%B5%81%E7%A8%8B%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97/">211-【Webpack】了不起的Webpack构建流程学习指南</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>最近原创文章回顾：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5ed589a251882542e3022f44">《了不起的 tsconfig.json 指南》</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5ee8e32a51882543485780d3">《了不起的 Webpack HMR 学习指南（含源码分析）》</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5ede5300e51d4578a6798220">《《你不知道的 Blob》番外篇》</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5ee78bb7f265da76f15a0698">《《你不知道的 WeakMap》番外篇》</a></li>
</ul>
<p>Webpack 是前端很火的打包工具，它本质上是一个现代 JavaScript 应用程序的静态模块打包器(module bundler)。当 Webpack 处理应用程序时，它会递归地构建一个依赖关系图(<code>dependency graph</code>)，其中包含应用程序需要的每个模块，然后将所有模块打包成一个或多个 <code>bundle</code>。</p>
<p>其实就是：Webpack 是一个 JS 代码打包器。</p>
<p>至于图片、CSS、Less、TS等其他文件，就需要 Webpack 配合 loader 或者 plugin 功能来实现~</p>
<p><img src="http://images.pingan8787.com/Webpack-Build/Webpack-Build-Xmind.png" alt="了不起的 Webpack 构建流程学习指南.png"></p>
<h1 id="一、Webpack-构建流程分析"><a href="#一、Webpack-构建流程分析" class="headerlink" title="一、Webpack 构建流程分析"></a>一、Webpack 构建流程分析</h1><h2 id="1-Webpack-构建过程"><a href="#1-Webpack-构建过程" class="headerlink" title="1. Webpack 构建过程"></a>1. Webpack 构建过程</h2><p>首先先简单了解下 Webpack 构建过程：</p>
<ol>
<li>根据配置，识别入口文件；</li>
<li>逐层识别模块依赖（包括 Commonjs、AMD、或 ES6 的 import 等，都会被识别和分析）；</li>
<li>Webpack 主要工作内容就是分析代码，转换代码，编译代码，最后输出代码；</li>
<li>输出最后打包后的代码。</li>
</ol>
<h2 id="2-Webpack-构建原理"><a href="#2-Webpack-构建原理" class="headerlink" title="2. Webpack 构建原理"></a>2. Webpack 构建原理</h2><p>看完上面的构建流程的简单介绍，相信你已经简单了解了这个过程，那么接下来开始详细介绍 Webpack 构建原理，包括从启动构建到输出结果一系列过程：</p>
<p><strong>（1）初始化参数</strong></p>
<p>解析 Webpack 配置参数，合并 Shell 传入和 <code>webpack.config.js</code> 文件配置的参数，形成最后的配置结果。</p>
<p><strong>（2）开始编译</strong></p>
<p>上一步得到的参数初始化 <code>compiler</code> 对象，注册所有配置的插件，插件监听 Webpack 构建生命周期的事件节点，做出相应的反应，执行对象的 <code>run</code> 方法开始执行编译。</p>
<p><strong>（3）确定入口</strong></p>
<p>从配置文件（ <code>webpack.config.js</code> ）中指定的 <code>entry</code> 入口，开始解析文件构建 AST 语法树，找出依赖，递归下去。</p>
<p><strong>（4）编译模块</strong></p>
<p>递归中根据<strong>文件类型</strong>和 <strong>loader</strong> 配置，调用所有配置的 loader 对文件进行转换，再找出该模块依赖的模块，再递归本步骤直到所有入口依赖的文件都经过了本步骤的处理。</p>
<p><strong>（5）完成模块编译并输出</strong></p>
<p>递归完后，得到每个文件结果，包含每个模块以及他们之间的依赖关系，根据 <code>entry</code> 配置生成代码块 <code>chunk</code> 。</p>
<p><strong>（6）输出完成</strong></p>
<p>输出所有的 <code>chunk</code> 到文件系统。</p>
<p>注意：在构建生命周期中有一系列插件在做合适的时机做合适事情，比如 <code>UglifyPlugin</code> 会在 loader 转换递归完对结果使用 <code>UglifyJs</code> 压缩<strong>覆盖之前的结果</strong>。</p>
<h1 id="二、手写-Webpack-构建工具"><a href="#二、手写-Webpack-构建工具" class="headerlink" title="二、手写 Webpack 构建工具"></a>二、手写 Webpack 构建工具</h1><p>到这里，相信大家对 Webpack 构建流程已经有所了解，但是这还不够，我们再来试着手写 Webpack 构建工具，来将上面文字介绍的内容，应用于实际代码，那么开始吧~</p>
<h2 id="1-初始化项目"><a href="#1-初始化项目" class="headerlink" title="1. 初始化项目"></a>1. 初始化项目</h2><p>在手写构建工具前，我们先初始化一个项目：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yarn init -y</span><br></pre></td></tr></table></figure>

<p>并安装下面四个依赖包：</p>
<ol>
<li><code>@babel/parser</code> : 用于分析通过 <code>fs.readFileSync</code>  读取的文件内容，并返回 AST (抽象语法树) ； </li>
<li><code>@babel/traverse</code> : 用于遍历 AST, 获取必要的数据；</li>
<li><code>@babel/core</code> : babel 核心模块，提供 <code>transformFromAst</code> 方法，用于将 AST 转化为浏览器可运行的代码；</li>
<li><code>@babel/preset-env</code> : 将转换后代码转化成 ES5 代码；</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yarn add @babel/parser @babel/traverse @babel/core @babel/preset-env</span><br></pre></td></tr></table></figure>

<p>初始化项目目录及文件：<br><img src="http://images.pingan8787.com/Webpack-Build/Webpack-Build-Xmind-Demo1.png" alt="image.png"></p>
<p>代码存放在仓库：<a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo-JavaScript/tree/master/Cute-Webpack/Write-Webpack">https://github.com/pingan8787/Leo-JavaScript/tree/master/Cute-Webpack/Write-Webpack</a></p>
<p>由于本部分核心内容是实现 Webpack 构建工具，所以会从《2. Webpack 构建原理》的“（3）确定入口”步骤开始下面介绍。</p>
<p>大致代码实现流程如下：</p>
<p><img src="http://images.pingan8787.com/Webpack-Build/Webpack-Build.jpeg" alt="webpack构建流程.jpg"></p>
<p>从图中可以看出，手写 Webpack 的核心是实现以下三个方法：</p>
<ul>
<li><code>createAssets</code> : 收集和处理文件的代码；</li>
<li><code>createGraph</code> ：根据入口文件，返回所有文件依赖图；</li>
<li><code>bundle</code> : 根据依赖图整个代码并输出；</li>
</ul>
<h2 id="2-实现-createAssets-函数"><a href="#2-实现-createAssets-函数" class="headerlink" title="2. 实现 createAssets 函数"></a>2. 实现 createAssets 函数</h2><h3 id="2-1-读取通过入口文件，并转为-AST"><a href="#2-1-读取通过入口文件，并转为-AST" class="headerlink" title="2.1 读取通过入口文件，并转为 AST"></a>2.1 读取通过入口文件，并转为 AST</h3><p>首先在 <code>./src/index</code> 文件中写点简单代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> info <span class="keyword">from</span> <span class="string">&quot;./info.js&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(info);</span><br></pre></td></tr></table></figure>
<p>实现 <code>createAssets</code> 方法中的 <strong>文件读取</strong> 和 <strong>AST转换</strong> 操作：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// leo_webpack.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> parser = <span class="built_in">require</span>(<span class="string">&quot;@babel/parser&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> traverse = <span class="built_in">require</span>(<span class="string">&quot;@babel/traverse&quot;</span>).default;</span><br><span class="line"><span class="comment">// 由于 traverse 采用的 ES Module 导出，我们通过 requier 引入的话就加个 .default</span></span><br><span class="line"><span class="keyword">const</span> babel = <span class="built_in">require</span>(<span class="string">&quot;@babel/core&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> moduleId = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> createAssets = <span class="function"><span class="params">filename</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> content = fs.readFileSync(filename, <span class="string">&quot;utf-8&quot;</span>); <span class="comment">// 根据文件名，同步读取文件流</span></span><br><span class="line">  </span><br><span class="line">  	<span class="comment">// 将读取文件流 buffer 转换为 AST</span></span><br><span class="line">    <span class="keyword">const</span> ast = parser.parse(content, &#123;</span><br><span class="line">        <span class="attr">sourceType</span>: <span class="string">&quot;module&quot;</span> <span class="comment">// 指定源码类型</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">console</span>.log(ast);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">createAssets(<span class="string">&#x27;./src/index.js&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>上面代码：<br>通过 <code>fs.readFileSync()</code> 方法，以<strong>同步方式</strong>读取指定路径下的文件流，并通过 <code>parser</code> 依赖包提供的 <code>parse()</code> 方法，将读取到的文件流 buffer <strong>转换为浏览器可以认识的代码（AST）</strong>，AST 输出如下：</p>
<p><img src="http://images.pingan8787.com/Webpack-Build/Webpack-Build-Xmind-Demo2.png" alt="image.png"></p>
<p>另外需要注意，这里我们声明了一个 <code>moduleId</code> 变量，来区分当前操作的模块。<br>在这里，不仅将读取到的文件流 buffer 转换为 AST 的同时，也将 ES6 代码转换为 ES5 代码了。</p>
<h3 id="2-2-收集每个模块的依赖"><a href="#2-2-收集每个模块的依赖" class="headerlink" title="2.2 收集每个模块的依赖"></a>2.2 收集每个模块的依赖</h3><p>接下来声明 <code>dependencies</code> 变量来保存收集到的文件依赖路径，通过 <code>traverse（）</code> 方法遍历 <code>ast</code>，获取每个节点依赖路径，并 <code>push</code> 进 <code>dependencies</code> 数组中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// leo_webpack.js</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createAssets</span>(<span class="params">filename</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">const</span> dependencies = []; <span class="comment">// 用于收集文件依赖的路径</span></span><br><span class="line"></span><br><span class="line">  	<span class="comment">// 通过 traverse 提供的操作 AST 的方法，获取每个节点的依赖路径</span></span><br><span class="line">    traverse(ast, &#123;</span><br><span class="line">        <span class="attr">ImportDeclaration</span>: <span class="function">(<span class="params">&#123;node&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">            dependencies.push(node.source.value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-将-AST-转换为浏览器可运行代码"><a href="#2-3-将-AST-转换为浏览器可运行代码" class="headerlink" title="2.3 将 AST 转换为浏览器可运行代码"></a>2.3 将 AST 转换为浏览器可运行代码</h3><p>在收集依赖的同时，我们可以将 AST 代码转换为浏览器可运行代码，这就需要使用到 <code>babel</code> ，这个万能的小家伙，为我们提供了非常好用的 <code>transformFromAstSync()</code> 方法，同步的将 AST 转换为浏览器可运行代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// leo_webpack.js</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createAssets</span>(<span class="params">filename</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">const</span> &#123; code &#125; = babel.transformFromAstSync(ast,<span class="literal">null</span>, &#123;</span><br><span class="line">        <span class="attr">presets</span>: [<span class="string">&quot;@babel/preset-env&quot;</span>]</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">let</span> id = moduleId++; <span class="comment">// 设置当前处理的模块ID</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        id,</span><br><span class="line">        filename,</span><br><span class="line">        code,</span><br><span class="line">        dependencies</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>到这一步，我们在执行 <code>node leo_webpack.js</code> ，输出如下内容，包含了入口文件的路径 <code>filename</code>  、浏览器可执行代码 <code>code</code> 和文件依赖的路径 <code>dependencies</code> 数组：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ node leo_webpack.js</span><br><span class="line"></span><br><span class="line">&#123; </span><br><span class="line">  filename: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">  code: <span class="string">&#x27;&quot;use strict&quot;;\n\nvar _info = _interopRequireDefault(require(&quot;./info.js&quot;));\n\nfunction _interopRequireDefault(obj) &#123; return obj &amp;&amp; obj.__esModule ? obj : &#123; &quot;default&quot;: obj &#125;; &#125;\n\nconsole.log(_info[&quot;default&quot;]);&#x27;</span>, </span><br><span class="line">  dependencies: [ <span class="string">&#x27;./info.js&#x27;</span> ] </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-4-代码小结"><a href="#2-4-代码小结" class="headerlink" title="2.4 代码小结"></a>2.4 代码小结</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// leo_webpack.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> parser = <span class="built_in">require</span>(<span class="string">&quot;@babel/parser&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> traverse = <span class="built_in">require</span>(<span class="string">&quot;@babel/traverse&quot;</span>).default;</span><br><span class="line"><span class="comment">// 由于 traverse 采用的 ES Module 导出，我们通过 requier 引入的话就加个 .default</span></span><br><span class="line"><span class="keyword">const</span> babel = <span class="built_in">require</span>(<span class="string">&quot;@babel/core&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> moduleId = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createAssets</span>(<span class="params">filename</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> content = fs.readFileSync(filename, <span class="string">&quot;utf-8&quot;</span>); <span class="comment">// 根据文件名，同步读取文件流</span></span><br><span class="line">  </span><br><span class="line">  	<span class="comment">// 将读取文件流 buffer 转换为 AST</span></span><br><span class="line">    <span class="keyword">const</span> ast = parser.parse(content, &#123;</span><br><span class="line">        <span class="attr">sourceType</span>: <span class="string">&quot;module&quot;</span> <span class="comment">// 指定源码类型</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> dependencies = []; <span class="comment">// 用于收集文件依赖的路径</span></span><br><span class="line"></span><br><span class="line">  	<span class="comment">// 通过 traverse 提供的操作 AST 的方法，获取每个节点的依赖路径</span></span><br><span class="line">    traverse(ast, &#123;</span><br><span class="line">        <span class="attr">ImportDeclaration</span>: <span class="function">(<span class="params">&#123;node&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">            dependencies.push(node.source.value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// 通过 AST 将 ES6 代码转换成 ES5 代码</span></span><br><span class="line">    <span class="keyword">const</span> &#123; code &#125; = babel.transformFromAstSync(ast,<span class="literal">null</span>, &#123;</span><br><span class="line">        <span class="attr">presets</span>: [<span class="string">&quot;@babel/preset-env&quot;</span>]</span><br><span class="line">    &#125;);</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">let</span> id = moduleId++; <span class="comment">// 设置当前处理的模块ID</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      	id,</span><br><span class="line">        filename,</span><br><span class="line">        code,</span><br><span class="line">        dependencies</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-实现-createGraph-函数"><a href="#3-实现-createGraph-函数" class="headerlink" title="3. 实现 createGraph 函数"></a>3. 实现 createGraph 函数</h2><p>在 <code>createGraph()</code> 函数中，我们将递归所有依赖模块，循环分析每个依赖模块依赖，生成一份依赖图谱。<br>为了方便测试，我们补充下 <code>consts.js</code> 和 <code>info.js</code> 文件的代码，增加一些依赖关系：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/consts.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> company = <span class="string">&quot;平安&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// src/info.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; company &#125; <span class="keyword">from</span> <span class="string">&quot;./consts.js&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="string">`你好，<span class="subst">$&#123;company&#125;</span>`</span>;</span><br></pre></td></tr></table></figure>

<p>接下来开始实现 <code>createGraph()</code> 函数，它需要接收一个入口文件的路径（ <code>entry</code> ）作为参数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// leo_webpack.js</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createGraph</span>(<span class="params">entry</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> mainAsset = createAssets(entry); <span class="comment">// 获取入口文件下的内容</span></span><br><span class="line">    <span class="keyword">const</span> queue = [mainAsset]; <span class="comment">// 入口文件的结果作为第一项</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">const</span> asset <span class="keyword">of</span> queue)&#123;</span><br><span class="line">        <span class="keyword">const</span> dirname = path.dirname(asset.filename);</span><br><span class="line">        asset.mapping = &#123;&#125;;</span><br><span class="line">        asset.dependencies.forEach(<span class="function"><span class="params">relativePath</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> absolutePath = path.join(dirname, relativePath); <span class="comment">// 转换文件路径为绝对路径</span></span><br><span class="line">            <span class="keyword">const</span> child = createAssets(absolutePath);</span><br><span class="line">            asset.mapping[relativePath] = child.id; <span class="comment">// 保存模块ID </span></span><br><span class="line">            queue.push(child); <span class="comment">// 递归去遍历所有子节点的文件</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> queue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面代码：</p>
<p>首先通过 <code>createAssets()</code> 函数读取入口文件的内容，并作为依赖关系的队列（依赖图谱） <code>queue</code> 数组的第一项，接着遍历依赖图谱 <code>queue</code> 每一项，再遍历将每一项中的依赖 <code>dependencies</code> 依赖数组，将依赖中的每一项拼接成依赖的绝对路径（<code>absolutePath</code> ），作为 <code>createAssets()</code> 函数调用的参数，递归去遍历所有子节点的文件，并将结果都保存在依赖图谱 <code>queue</code> 中。</p>
<p>注意， <code>mapping</code> 对象是用来保存文件的相对路径和模块 ID 的对应关系，在 <code>mapping</code> 对象中，我们使用依赖文件的相对路径作为 <code>key</code> ，来存储保存模块 ID。</p>
<p>然后我们修改启动函数：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// leo_webpack.js</span><br><span class="line"></span><br><span class="line"><span class="deletion">- const result = createAssets(&#x27;./src/index.js&#x27;);</span></span><br><span class="line"><span class="addition">+ const graph = createGraph(&quot;./src/index.js&quot;);</span></span><br><span class="line"><span class="addition">+ console.log(graph);</span></span><br></pre></td></tr></table></figure>

<p>这时我们将得到一份包含所有文件依赖关系的依赖图谱：</p>
<p><img src="http://images.pingan8787.com/Webpack-Build/Webpack-Build-Xmind-Demo3.png" alt="image.png"></p>
<p>这个依赖图谱，包含了所有文件模块的依赖，以及模块的代码内容。下一步只要实现 <code>bundle()</code> 函数，将结果输出即可。</p>
<h2 id="4-实现-bundle-函数"><a href="#4-实现-bundle-函数" class="headerlink" title="4. 实现 bundle 函数"></a>4. 实现 bundle 函数</h2><p>从前面介绍，我们知道，函数 <code>createGraph()</code> 会返回一个包含每个依赖相关信息（id / filename / code / dependencies）的依赖图谱 <code>queue</code>，这一步就将使用到它了。</p>
<p>在 <code>bundle()</code> 函数中，接收一个依赖图谱 <code>graph</code> 作为参数，最后输出编译后的结果。</p>
<h3 id="4-1-读取所有模块信息"><a href="#4-1-读取所有模块信息" class="headerlink" title="4.1 读取所有模块信息"></a>4.1 读取所有模块信息</h3><p>我们首先声明一个变量 <code>modules</code>，值为字符串类型，然后对参数 <code>graph</code> 进行遍历，将每一项中的 <code>id</code> 属性作为 <code>key</code> ，值为一个数组，包括一个用来执行代码 <code>code</code> 的方法和序列化后的 <code>mapping</code>，最后拼接到 <code>modules</code> 中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// leo_webpack.js</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bundle</span>(<span class="params">graph</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> modules = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    graph.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        modules += <span class="string">`</span></span><br><span class="line"><span class="string">            <span class="subst">$&#123;item.id&#125;</span>: [</span></span><br><span class="line"><span class="string">                function (require, module, exports)&#123;</span></span><br><span class="line"><span class="string">                    <span class="subst">$&#123;item.code&#125;</span></span></span><br><span class="line"><span class="string">                &#125;,</span></span><br><span class="line"><span class="string">                <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(item.mapping)&#125;</span></span></span><br><span class="line"><span class="string">            ],</span></span><br><span class="line"><span class="string">        `</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面代码：</p>
<p>在 <code>modules</code> 中每一项的值中，下标为 0 的元素是个函数，接收三个参数 <code>require</code> / <code>module</code> / <code>exports</code> ，为什么会需要这三个参数呢？</p>
<p>原因是：构建工具无法判断是否支持<code>require</code> / <code>module</code> / <code>exports</code> 这三种模块方法，所以需要自己实现（后面步骤会实现），然后方法内的 <code>code</code> 才能正常执行。</p>
<h3 id="4-2-返回最终结果"><a href="#4-2-返回最终结果" class="headerlink" title="4.2 返回最终结果"></a>4.2 返回最终结果</h3><p>接着，我们来实现 <code>bundle()</code> 函数返回值的处理：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// leo_webpack.js</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bundle</span>(<span class="params">graph</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">        (function(modules)&#123;</span></span><br><span class="line"><span class="string">            function require(id)&#123;</span></span><br><span class="line"><span class="string">                const [fn, mapping] = modules[id];</span></span><br><span class="line"><span class="string">                function localRequire(relativePath)&#123;</span></span><br><span class="line"><span class="string">                    return require(mapping[relativePath]);</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                const module = &#123;</span></span><br><span class="line"><span class="string">                    exports: &#123;&#125;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                fn(localRequire, module, module.exports);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                return module.exports;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            require(0);</span></span><br><span class="line"><span class="string">        &#125;)(&#123;<span class="subst">$&#123;modules&#125;</span>&#125;)</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面代码：</p>
<p>最终 <code>bundle</code> 函数返回值是一个字符串，包含一个<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E7%AB%8B%E5%8D%B3%E8%B0%83%E7%94%A8%E5%87%BD%E6%95%B0%E8%A1%A8%E8%BE%BE%E5%BC%8F">自执行函数（IIFE）</a>，其中函数参数是一个对象， <code>key</code> 为 <code>modules</code> ， <code>value</code> 为前面拼接好的 <code>modules</code> 字符串，即 <code>&#123;modules: modules字符串&#125;</code> 。</p>
<p>在这个自执行函数中，实现了 <code>require</code> 方法，接收一个 <code>id</code> 作为参数，在方法内部，分别实现了 <code>localRequire</code> / <code>module</code> / <code>modules.exports</code> 三个方法，并作为参数，传到 <code>modules[id]</code> 中的 <code>fn</code> 方法中，最后初始化 <code>require()</code> 函数（<code>require(0);</code>）。</p>
<h3 id="4-3-代码小结"><a href="#4-3-代码小结" class="headerlink" title="4.3 代码小结"></a>4.3 代码小结</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// leo_webpack.js</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bundle</span>(<span class="params">graph</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> modules = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    graph.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        modules += <span class="string">`</span></span><br><span class="line"><span class="string">            <span class="subst">$&#123;item.id&#125;</span>: [</span></span><br><span class="line"><span class="string">                function (require, module, exports)&#123;</span></span><br><span class="line"><span class="string">                    <span class="subst">$&#123;item.code&#125;</span></span></span><br><span class="line"><span class="string">                &#125;,</span></span><br><span class="line"><span class="string">                <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(item.mapping)&#125;</span></span></span><br><span class="line"><span class="string">            ],</span></span><br><span class="line"><span class="string">        `</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">        (function(modules)&#123;</span></span><br><span class="line"><span class="string">            function require(id)&#123;</span></span><br><span class="line"><span class="string">                const [fn, mapping] = modules[id];</span></span><br><span class="line"><span class="string">                function localRequire(relativePath)&#123;</span></span><br><span class="line"><span class="string">                    return require(mapping[relativePath]);</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                const module = &#123;</span></span><br><span class="line"><span class="string">                    exports: &#123;&#125;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                fn(localRequire, module, module.exports);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                return module.exports;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            require(0);</span></span><br><span class="line"><span class="string">        &#125;)(&#123;<span class="subst">$&#123;modules&#125;</span>&#125;)</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-执行代码"><a href="#5-执行代码" class="headerlink" title="5. 执行代码"></a>5. 执行代码</h2><p>当我们上面方法都实现以后，就开始试试吧：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// leo_webpack.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> graph = createGraph(<span class="string">&quot;./src/index.js&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> result = bundle(graph);</span><br><span class="line"><span class="built_in">console</span>.log(result)</span><br></pre></td></tr></table></figure>
<p>这时候可以看到终端输出类似这样的代码，是字符串，这里为了方便查看而复制到控制台了：</p>
<p><img src="http://images.pingan8787.com/Webpack-Build/Webpack-Build-Xmind-Demo4.png" alt="image.png"></p>
<p>这就是打包后的代码咯~</p>
<p>那么如何让这些代码执行呢？用 <code>eval()</code> 方法咯：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// leo_webpack.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> graph = createGraph(<span class="string">&quot;./src/index.js&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> result = bundle(graph);</span><br><span class="line"><span class="built_in">eval</span>(result);</span><br></pre></td></tr></table></figure>
<p>这时候就能看到控制台输出 <code>你好，平安</code> 。那么我们就完成一个简单的 Webpack 构建工具啦~</p>
<p>能看到这里的朋友，为你点个赞~</p>
<h1 id="三、总结"><a href="#三、总结" class="headerlink" title="三、总结"></a>三、总结</h1><p>本文主要介绍了 Webpack 的构建流程和构建原理，并在此基础上，和大家分享了手写 Webpack 的实现过程，希望大家对 Webpack 构建流程能有更深了解，毕竟面试贼喜欢问啦~</p>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#112;&#x69;&#110;&#103;&#97;&#110;&#x38;&#x37;&#x38;&#x37;&#x40;&#x71;&#113;&#46;&#99;&#x6f;&#109;">&#112;&#x69;&#110;&#103;&#97;&#110;&#x38;&#x37;&#x38;&#x37;&#x40;&#x71;&#113;&#46;&#99;&#x6f;&#109;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>ES小册</td>
<td>js.pingan8787.com</td>
</tr>
<tr>
<td>语雀知识库</td>
<td><a target="_blank" rel="noopener" href="https://www.yuque.com/wangpingan/cute-frontend">Cute-FrontEnd</a></td>
</tr>
</tbody></table>
<p><img src="http://images.pingan8787.com/2019_07_12guild_page.png" alt="bg"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/07/06/211-%E3%80%90Webpack%E3%80%91%E4%BA%86%E4%B8%8D%E8%B5%B7%E7%9A%84Webpack%E6%9E%84%E5%BB%BA%E6%B5%81%E7%A8%8B%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97/" data-id="ckts3ejyx00nc4d9kaizk29a3" data-title="211-【Webpack】了不起的Webpack构建流程学习指南" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Webpack/" rel="tag">Webpack</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag">读书笔记</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-210-【JavaScript】《你不知道的WeakMap》番外篇" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/07/06/210-%E3%80%90JavaScript%E3%80%91%E3%80%8A%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84WeakMap%E3%80%8B%E7%95%AA%E5%A4%96%E7%AF%87/" class="article-date">
  <time class="dt-published" datetime="2020-07-06T04:42:35.000Z" itemprop="datePublished">2020-07-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/07/06/210-%E3%80%90JavaScript%E3%80%91%E3%80%8A%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84WeakMap%E3%80%8B%E7%95%AA%E5%A4%96%E7%AF%87/">210-【JavaScript】《你不知道的WeakMap》番外篇</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>学习时间：2020.05.26</p>
<p>学习章节：<a target="_blank" rel="noopener" href="https://juejin.im/post/5ecd1ad3e51d45784c52db73">《你不知道的 WeakMap》</a></p>
<h1 id="一、主要知识点"><a href="#一、主要知识点" class="headerlink" title="一、主要知识点"></a>一、主要知识点</h1><p>原文主要复习了“JavaScript垃圾回收机制”，“Map/WeakMap区别”和“WeakMap 属性和方法”。这很好弥补被我忽视的知识点。</p>
<p>另外，我们可以通过原文，以相同方式再去学 Set/WeakSet，效果会更好，本文后面也会介绍到。</p>
<p><strong>总结开始，先看原文大纲：</strong></p>
<p><img src="http://images.pingan8787.com/blog/you-dont-know-WeakMap/xmind.png" alt="image.png"></p>
<p>在开始介绍 WeakMap 之前，先复习一遍 JavaScript 中垃圾回收机制，这跟后面的 WeakMap/WeakSet 关系较大。</p>
<h2 id="1-垃圾回收机制"><a href="#1-垃圾回收机制" class="headerlink" title="1. 垃圾回收机制"></a>1. 垃圾回收机制</h2><p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-hans/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6_(%E8%A8%88%E7%AE%97%E6%A9%9F%E7%A7%91%E5%AD%B8)">垃圾回收（Garbage Collection，缩写为GC）</a>是一种自动的存储器管理机制。当某个程序占用的一部分内存空间不再被这个程序访问时，这个程序会借助垃圾回收算法向操作系统归还这部分内存空间。垃圾回收器可以减轻程序员的负担，也减少程序中的错误。垃圾回收最早起源于LISP语言。<br>目前许多语言如Smalltalk、Java、C#和D语言都支持垃圾回收器，我们熟知的 JavaScript 具有自动垃圾回收机制。</p>
<p><strong>在 JavaScript 中，原始类型的数据被分配到栈空间中，引用类型的数据会被分配到堆空间中</strong>。</p>
<h3 id="1-1-栈空间中的垃圾回收"><a href="#1-1-栈空间中的垃圾回收" class="headerlink" title="1.1 栈空间中的垃圾回收"></a>1.1 栈空间中的垃圾回收</h3><p>当函数 <code>showName</code> 调用完成后，通过下移 <a target="_blank" rel="noopener" href="https://baike.baidu.com/item/esp/35173">ESP（Extended Stack Pointer）</a>指针，来销毁 <code>showName</code> 函数，之后调用其他函数时，将覆盖掉旧内存，存放另一个函数的执行上下文，实现垃圾回收。<br><img src="http://images.pingan8787.com/blog/you-dont-know-WeakMap/ESP.png" alt="image.png"><br>图片来自《浏览器工作原理与实践》</p>
<h3 id="1-2-堆空间中的垃圾回收"><a href="#1-2-堆空间中的垃圾回收" class="headerlink" title="1.2 堆空间中的垃圾回收"></a>1.2 堆空间中的垃圾回收</h3><p>堆中数据垃圾回收策略的基础是：<a target="_blank" rel="noopener" href="https://plumbr.io/handbook/garbage-collection-in-java/generational-hypothesis"><strong>代际假说</strong>（The Generational Hypothesis）</a>。即：</p>
<ol>
<li>大部分对象在内存中存在时间极短，很多对象很快就不可访问。</li>
<li>不死的对象将活得更久。</li>
</ol>
<p>这两个特点不仅仅适用于 JavaScript，同样适用于大多数的动态语言，如 Java、Python 等。</p>
<p>V8 引擎将堆空间分为<strong>新生代</strong>（存放生存<strong>时间短</strong>的对象）和<strong>老生代</strong>（存放生存<strong>时间长</strong>的对象）两个区域，并使用不同的垃圾回收器。</p>
<ul>
<li>副垃圾回收器，主要负责新生代的垃圾回收。</li>
<li>主垃圾回收器，主要负责老生代的垃圾回收。</li>
</ul>
<p>不管是哪种垃圾回收器，都使用相同垃圾回收流程：<strong>标记活动对象和非活动对象，回收非活动对象的内存，最后内存整理</strong>。</p>
<h4 id="1-2-1-副垃圾回收器"><a href="#1-2-1-副垃圾回收器" class="headerlink" title="1.2.1 副垃圾回收器"></a>1.2.1 副垃圾回收器</h4><p>使用 Scavenge 算法处理，将新生代空间对半分为两个区域，一个对象区域，一个空闲区域。<br><img src="http://images.pingan8787.com/blog/you-dont-know-WeakMap/Scavenge.png" alt="image.png"><br>图片来自《浏览器工作原理与实践》</p>
<p>执行流程：</p>
<ul>
<li>新对象存在在<strong>对象区域</strong>，当对象区域将要写满时，执行一次垃圾回收；</li>
<li>垃圾回收过程中，首先对对象区域中的垃圾做标记，然后副垃圾回收器将存活的对象复制并有序排列到空闲区域，相当于完成内存整理。</li>
<li>复制完成后，将对象区域和空闲区域翻转，完成垃圾回收操作，这也让新生代中两块区域无限重复使用。</li>
</ul>
<p>当然，这也存在一些问题：若复制操作的数据较大则影响清理效率。</p>
<p>JavaScript 引擎的解决方式是：将新生代区域设置得比较小，并采用对象晋升策略（经过两次回收仍存活的对象，会被移动到老生区），避免因为新生代区域较小引起存活对象装满整个区域的问题。</p>
<h4 id="1-2-2-主垃圾回收器"><a href="#1-2-2-主垃圾回收器" class="headerlink" title="1.2.2 主垃圾回收器"></a>1.2.2 主垃圾回收器</h4><p>分为：<strong>标记 - 清除（Mark-Sweep）算法</strong>，和<strong>标记 - 整理（Mark-Compact）算法</strong>。</p>
<p><strong>a)标记 - 清除（Mark-Sweep）算法</strong><br><strong>过程</strong>：</p>
<ul>
<li>标记过程：从一组根元素开始遍历整个元素，能到达的元素为活动对象，反之为垃圾数据；</li>
<li>清除过程：清理被标记的数据，并产生大量碎片内存。（缺点：导致大对象无法分配到足够的连续内存）</li>
</ul>
<p><img src="http://images.pingan8787.com/blog/you-dont-know-WeakMap/Mark-Sweep.png" alt="image.png"><br>图片来自《浏览器工作原理与实践》</p>
<p><strong>b)标记 - 整理（Mark-Compact）算法</strong><br><strong>过程</strong>：</p>
<ul>
<li>标记过程：从一组根元素开始遍历整个元素，能到达的元素为活动对象，反之为垃圾数据；</li>
<li>整理过程：将所有存活的对象，向一段移动，然后清除端边界以外的内容。</li>
</ul>
<p><img src="http://images.pingan8787.com/blog/you-dont-know-WeakMap/Mark-Compact.png" alt="image.png"><br>图片来自《浏览器工作原理与实践》</p>
<h3 id="1-3-拓展阅读"><a href="#1-3-拓展阅读" class="headerlink" title="1.3 拓展阅读"></a>1.3 拓展阅读</h3><p>1.<a target="_blank" rel="noopener" href="https://blog.csdn.net/justloveyou_/article/details/71216049">《图解Java 垃圾回收机制》</a><br>2.<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Memory_Management">《MDN 内存管理》</a></p>
<h2 id="2-Map-VS-WeakMap"><a href="#2-Map-VS-WeakMap" class="headerlink" title="2. Map VS WeakMap"></a>2. Map VS WeakMap</h2><h3 id="2-1-Map-和-WeakMap-主要区别"><a href="#2-1-Map-和-WeakMap-主要区别" class="headerlink" title="2.1 Map 和 WeakMap 主要区别"></a>2.1 Map 和 WeakMap 主要区别</h3><p><code>WeakMap</code> 结构与 <code>Map</code> 结构类似，也是用于生成键值对的集合。</p>
<p>区别：</p>
<ul>
<li><p><code>Map</code>  对象的键可以是任何类型，但 <code>WeakMap</code>  对象中的键只能是对象引用（ <code>null</code> 除外）；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line">map.set(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="comment">// TypeError: 1 is not an object!</span></span><br><span class="line">map.set(<span class="built_in">Symbol</span>(), <span class="number">2</span>)</span><br><span class="line"><span class="comment">// TypeError: Invalid value used as weak map key</span></span><br><span class="line">map.set(<span class="literal">null</span>, <span class="number">2</span>)</span><br><span class="line"><span class="comment">// TypeError: Invalid value used as weak map key</span></span><br></pre></td></tr></table></figure></li>
<li><p><code>WeakMap</code>  不能包含无引用的对象，否则会被自动清除出集合（垃圾回收机制）；</p>
</li>
<li><p><code>WeakMap</code>  对象没有 <code>size</code> 属性，是不可枚举的，无法获取集合的大小。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"><span class="keyword">const</span> user1 = &#123;<span class="attr">name</span>: <span class="string">&#x27;leo&#x27;</span>&#125;;</span><br><span class="line"><span class="keyword">const</span> user2 = &#123;<span class="attr">name</span>: <span class="string">&#x27;pingan&#x27;</span>&#125;;</span><br><span class="line">map.set(user1, <span class="string">&#x27;good~&#x27;</span>);</span><br><span class="line">map.set(user2, <span class="string">&#x27;hello&#x27;</span>);</span><br><span class="line">map.map(<span class="function"><span class="params">item</span> =&gt;</span> <span class="built_in">console</span>.log(item))</span><br><span class="line"><span class="comment">//Uncaught TypeError: map.map is not a function</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-2-Map-缺点和-WeakMap-优点"><a href="#2-2-Map-缺点和-WeakMap-优点" class="headerlink" title="2.2 Map 缺点和 WeakMap 优点"></a>2.2 Map 缺点和 WeakMap 优点</h3><p>1.赋值和搜索操作都是 O(n) 的时间复杂度，因为这两个操作都需要遍历全部整个数组来进行匹配。</p>
<p>2.可能会导致内存泄漏，因为数组会一直引用着每个键和值。</p>
<p>相比之下， <code>WeakMap</code>  持有的是每个键对象的 “弱引用”，这意味着在没有其他引用存在时垃圾回收能正确进行。 原生 <code>WeakMap </code> 的结构是特殊且有效的，其用于映射的 key 只有在其没有被回收时才是有效的。</p>
<h3 id="2-3-Map-和-WeakMap-垃圾回收对比"><a href="#2-3-Map-和-WeakMap-垃圾回收对比" class="headerlink" title="2.3 Map 和 WeakMap 垃圾回收对比"></a>2.3 Map 和 WeakMap 垃圾回收对比</h3><p>当数据量越大，则垃圾回收效果越明显。</p>
<p>通过命令行执行 <code>node --expose-gc weakmap.js</code> 查看对比效果。</p>
<p>其中 <code>--expose-gc</code> 参数表示允许手动执行垃圾回收机制。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// weakmap.js</span></span><br><span class="line"><span class="keyword">const</span> objNum = <span class="number">10</span> * <span class="number">1024</span> * <span class="number">1024</span>;</span><br><span class="line"><span class="keyword">const</span> useType = <span class="number">1</span>; <span class="comment">// 修改 useType 值来测试Map和WeakMap</span></span><br><span class="line"><span class="keyword">const</span> curType = useType == <span class="number">1</span> ?<span class="string">&quot;【Map】&quot;</span> : <span class="string">&quot;【WeakMap】&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> arr = <span class="keyword">new</span> <span class="built_in">Array</span>(objNum);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">usageSize</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> used = process.memoryUsage().heapUsed;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.round((used / <span class="number">1024</span> / <span class="number">1024</span>) * <span class="number">100</span>) / <span class="number">100</span> + <span class="string">&quot;M&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (useType == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="built_in">global</span>.gc();</span><br><span class="line">    <span class="built_in">console</span>.log(objNum + <span class="string">&#x27;个&#x27;</span> + curType + <span class="string">&#x27;占用内存：&#x27;</span> + usageSize());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">    map.set(arr, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">global</span>.gc();</span><br><span class="line">    <span class="built_in">console</span>.log(objNum + <span class="string">&#x27;个&#x27;</span> + curType + <span class="string">&#x27;占用内存：&#x27;</span> + usageSize());</span><br><span class="line"></span><br><span class="line">    arr = <span class="literal">null</span>;</span><br><span class="line">    <span class="built_in">global</span>.gc();</span><br><span class="line">    <span class="built_in">console</span>.log(objNum + <span class="string">&#x27;个&#x27;</span> + curType + <span class="string">&#x27;占用内存：&#x27;</span> + usageSize());</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;=====&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">global</span>.gc();</span><br><span class="line">    <span class="built_in">console</span>.log(objNum + <span class="string">&#x27;个&#x27;</span> + curType + <span class="string">&#x27;占用内存：&#x27;</span> + usageSize());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> map = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">global</span>.gc();</span><br><span class="line">    <span class="built_in">console</span>.log(objNum + <span class="string">&#x27;个&#x27;</span> + curType + <span class="string">&#x27;占用内存：&#x27;</span> + usageSize());</span><br><span class="line"></span><br><span class="line">    arr = <span class="literal">null</span>;</span><br><span class="line">    <span class="built_in">global</span>.gc();</span><br><span class="line">    <span class="built_in">console</span>.log(objNum + <span class="string">&#x27;个&#x27;</span> + curType + <span class="string">&#x27;占用内存：&#x27;</span> + usageSize());</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;=====&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="3-WeakMap介绍和应用"><a href="#3-WeakMap介绍和应用" class="headerlink" title="3. WeakMap介绍和应用"></a>3. WeakMap介绍和应用</h2><h3 id="3-1-WeakMap-介绍"><a href="#3-1-WeakMap-介绍" class="headerlink" title="3.1 WeakMap 介绍"></a>3.1 WeakMap 介绍</h3><p><code>WeakMap</code>  对象是一组键/值对的集合，其中的键是 <strong>弱引用</strong> 的。</p>
<p><strong>WeakMap 的 key 只能是 Object 类型</strong>。</p>
<p><strong>原始数据类型是不能作为 key 的（比如 Symbol）</strong>。</p>
<p><code>WeakMap</code>只有四个方法可用：<code>get()</code>、<code>set()</code>、<code>has()</code>、<code>delete()</code>。</p>
<p>具体属性和方法介绍，可查看 《<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/WeakMap">MDN WeakMap</a>》。</p>
<h3 id="3-2-WeakMap-应用"><a href="#3-2-WeakMap-应用" class="headerlink" title="3.2 WeakMap 应用"></a>3.2 WeakMap 应用</h3><p>原文中介绍了“通过 WeakMap 缓存计算结果”和“在 WeakMap 中保留私有数据”两种应用场景。</p>
<p>另外还有一种比较常见的场景：<strong>以 DOM节点作为键名的场景</strong>。</p>
<p><strong>场景1：当我们想要为DOM添加数据时，可使用 <code>WeakMap</code> 。</strong></p>
<p>好处在于，当DOM元素移除时，对应 WeakMap 记录也会自动移除：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;WeakMap&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wm = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"><span class="keyword">const</span> weakMap = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;WeakMap&#x27;</span>);</span><br><span class="line">wm.set(weakMap, <span class="string">&#x27;some information&#x27;</span>);</span><br><span class="line">wm.get(weakMap) <span class="comment">//&quot;some information&quot;</span></span><br></pre></td></tr></table></figure>
<p><strong>场景2：当我们想要为DOM元素添加事件监听时，可使用 <code>WeakMap</code> 。</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;button1&quot;</span>&gt;</span>按钮1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;button2&quot;</span>&gt;</span>按钮2<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> button1 = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;button1&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> button2 = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;button2&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> handler1 = <span class="function">() =&gt;</span> &#123;  <span class="built_in">console</span>.log(<span class="string">&quot;button1 被点击&quot;</span>) &#125;;</span><br><span class="line"><span class="keyword">const</span> handler2 = <span class="function">() =&gt;</span> &#123;  <span class="built_in">console</span>.log(<span class="string">&quot;button2 被点击&quot;</span>) &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代码1</span></span><br><span class="line">button1.addEventListener(<span class="string">&#x27;click&#x27;</span>, handler1, <span class="literal">false</span>);</span><br><span class="line">button2.addEventListener(<span class="string">&#x27;click&#x27;</span>, handler2, <span class="literal">false</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 代码2</span></span><br><span class="line"><span class="keyword">const</span> listener = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"> </span><br><span class="line">listener.set(button1, handler1);</span><br><span class="line">listener.set(button2, handler2);</span><br><span class="line"> </span><br><span class="line">button1.addEventListener(<span class="string">&#x27;click&#x27;</span>, listener.get(button1), <span class="literal">false</span>);</span><br><span class="line">button2.addEventListener(<span class="string">&#x27;click&#x27;</span>, listener.get(button2), <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<p>代码2比起代码1的好处是：由于监听函数是放在 WeakMap 里面，</p>
<p>则一旦 DOM 对象button1 / button2消失，与它绑定的监听函数handler1和handler2 也会自动消失。</p>
<h1 id="二、拓展知识"><a href="#二、拓展知识" class="headerlink" title="二、拓展知识"></a>二、拓展知识</h1><h2 id="1-拓展-Set-WeakSet"><a href="#1-拓展-Set-WeakSet" class="headerlink" title="1. 拓展 Set/WeakSet"></a>1. 拓展 Set/WeakSet</h2><h3 id="1-1-Set-和-WeakSet-主要区别"><a href="#1-1-Set-和-WeakSet-主要区别" class="headerlink" title="1.1 Set 和 WeakSet 主要区别"></a>1.1 Set 和 WeakSet 主要区别</h3><p><code>WeakSet</code>  结构与 <code>Set</code> 类似，也是不重复的值的集合。</p>
<p>区别：</p>
<ul>
<li><p><code>WeakSet</code> 的成员只能是对象，而不能是其他类型的值；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ws = <span class="keyword">new</span> <span class="built_in">WeakSet</span>();</span><br><span class="line">ws.add(<span class="number">1</span>)</span><br><span class="line"><span class="comment">// TypeError: Invalid value used in weak set</span></span><br><span class="line">ws.add(<span class="built_in">Symbol</span>())</span><br><span class="line"><span class="comment">// TypeError: invalid value used in weak set</span></span><br></pre></td></tr></table></figure></li>
<li><p><code>WeakSet</code>  中的对象都是弱引用，即垃圾回收机制不考虑 <code>WeakSet</code>  对该对象的引用;</p>
</li>
<li><p><code>WeakSet</code>  对象没有 <code>size</code> 属性，是不可枚举的，无法获取集合的大小。</p>
</li>
</ul>
<h3 id="1-2-Set-WeakSet-垃圾回收对比"><a href="#1-2-Set-WeakSet-垃圾回收对比" class="headerlink" title="1.2 Set/WeakSet 垃圾回收对比"></a>1.2 Set/WeakSet 垃圾回收对比</h3><p>通过命令行执行 <code>node --expose-gc weakset.js</code> 查看对比效果。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// weakset.js</span></span><br><span class="line"><span class="keyword">const</span> objNum = <span class="number">5000</span> * <span class="number">1024</span>;</span><br><span class="line"><span class="keyword">const</span> useType = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> curType = useType == <span class="number">1</span> ?<span class="string">&quot;【Set】&quot;</span> : <span class="string">&quot;【WeakSet】&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> obj = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> k = <span class="number">0</span>; k &lt; objNum; k++) &#123;</span><br><span class="line">    obj[k] = &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">usageSize</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> used = process.memoryUsage().heapUsed;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.round((used / <span class="number">1024</span> / <span class="number">1024</span>) * <span class="number">100</span>) / <span class="number">100</span> + <span class="string">&quot;M&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (useType == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="built_in">global</span>.gc();</span><br><span class="line">    <span class="built_in">console</span>.log(objNum + <span class="string">&#x27;个&#x27;</span> + curType + <span class="string">&#x27;占用内存：&#x27;</span> + usageSize());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> sets = <span class="keyword">new</span> <span class="built_in">Set</span>([...obj]);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">global</span>.gc();</span><br><span class="line">    <span class="built_in">console</span>.log(objNum + <span class="string">&#x27;个&#x27;</span> + curType + <span class="string">&#x27;占用内存：&#x27;</span> + usageSize());</span><br><span class="line"></span><br><span class="line">    obj = <span class="literal">null</span>;</span><br><span class="line">    <span class="built_in">global</span>.gc();</span><br><span class="line">    <span class="built_in">console</span>.log(objNum + <span class="string">&#x27;个&#x27;</span> + curType + <span class="string">&#x27;占用内存：&#x27;</span> + usageSize());</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;=====&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">global</span>.gc();</span><br><span class="line">    <span class="built_in">console</span>.log(objNum + <span class="string">&#x27;个&#x27;</span> + curType + <span class="string">&#x27;占用内存：&#x27;</span> + usageSize());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> sets = <span class="keyword">new</span> <span class="built_in">WeakSet</span>(obj);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">global</span>.gc();</span><br><span class="line">    <span class="built_in">console</span>.log(objNum + <span class="string">&#x27;个&#x27;</span> + curType + <span class="string">&#x27;占用内存：&#x27;</span> + usageSize());</span><br><span class="line"></span><br><span class="line">    obj = <span class="literal">null</span>;</span><br><span class="line">    <span class="built_in">global</span>.gc();</span><br><span class="line">    <span class="built_in">console</span>.log(objNum + <span class="string">&#x27;个&#x27;</span> + curType + <span class="string">&#x27;占用内存：&#x27;</span> + usageSize());</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;=====&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="三、总结"><a href="#三、总结" class="headerlink" title="三、总结"></a>三、总结</h1><p>本文首先复习了《你不知道的 WeakMap》中核心知识点，重新回顾了“垃圾回收机制”，“Map VS WeakMap”和“WeakMap 介绍和应用”，最后延伸复习了“Set/WeakSet”相关知识点。</p>
<p>在实际业务开发中，最好也能考虑垃圾回收机制的合理使用，这也是提升产品性能的一个非常常用的方式。</p>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#x70;&#x69;&#110;&#x67;&#97;&#x6e;&#56;&#x37;&#56;&#55;&#x40;&#113;&#x71;&#46;&#x63;&#x6f;&#109;">&#x70;&#x69;&#110;&#x67;&#97;&#x6e;&#56;&#x37;&#56;&#55;&#x40;&#113;&#x71;&#46;&#x63;&#x6f;&#109;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>ES小册</td>
<td>js.pingan8787.com</td>
</tr>
<tr>
<td>语雀知识库</td>
<td><a target="_blank" rel="noopener" href="https://www.yuque.com/wangpingan/cute-frontend">Cute-FrontEnd</a></td>
</tr>
</tbody></table>
<p><img src="http://images.pingan8787.com/2019_07_12guild_page.png" alt="bg"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/07/06/210-%E3%80%90JavaScript%E3%80%91%E3%80%8A%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84WeakMap%E3%80%8B%E7%95%AA%E5%A4%96%E7%AF%87/" data-id="ckts3eju7005y4d9ke7nqhzld" data-title="210-【JavaScript】《你不知道的WeakMap》番外篇" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag">读书笔记</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-209-【JavaScript】《你不知道的Blob》番外篇" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/07/06/209-%E3%80%90JavaScript%E3%80%91%E3%80%8A%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84Blob%E3%80%8B%E7%95%AA%E5%A4%96%E7%AF%87/" class="article-date">
  <time class="dt-published" datetime="2020-07-06T04:39:07.000Z" itemprop="datePublished">2020-07-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/07/06/209-%E3%80%90JavaScript%E3%80%91%E3%80%8A%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84Blob%E3%80%8B%E7%95%AA%E5%A4%96%E7%AF%87/">209-【JavaScript】《你不知道的Blob》番外篇</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>学习时间：2020.06.06</p>
<p>学习章节：<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/lQKTCS_QB0E62SK9oXD4LA">《你不知道的 Blob》</a></p>
<p>原文对 Blob 的知识点介绍得非常完整清晰，本文通过四个问题来总结本文核心知识：</p>
<ol>
<li>Blob 是什么？</li>
<li>Blob 怎么用？</li>
<li>Blob 有哪些使用场景？</li>
<li>Blob 与 ArrayBuffer 有何区别？</li>
</ol>
<p><img src="http://images.pingan8787.com/blog/you-dont-know-blob/xmind.png" alt="读《你不知道的 Blob》总结.png"></p>
<h1 id="一、Blob-是什么？"><a href="#一、Blob-是什么？" class="headerlink" title="一、Blob 是什么？"></a>一、Blob 是什么？</h1><p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/Blob">Blob（Binary Large Object）</a>表示二进制类型的大对象，通常是影像、声音或多媒体文件。MySql/Oracle数据库中，就有一种Blob类型，专门存放二进制数据。在 JavaScript 中 Blob 对象表示一个不可变、原始数据的类文件对象，它不一定非得是大量数据，也可以表示一个小型文件的内容。</p>
<p>另外，JavaScript 中的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/File">File</a> 接口是基于 Blob，继承 Blob 的功能并将其扩展使其支持用户系统上的文件。</p>
<h1 id="二、Blob-怎么用？"><a href="#二、Blob-怎么用？" class="headerlink" title="二、Blob 怎么用？"></a>二、Blob 怎么用？</h1><p><code>Blob</code> 由一个可选字符串 <code>type</code> 和 <code>blobParts</code> 组成，其中， <code>type</code> 通常为 MIME 类型。</p>
<blockquote>
<p>MIME（Multipurpose Internet Mail Extensions）多用途互联网邮件扩展类型，常见有：超文本标记语言文本 .html <code>text/html</code> 、PNG图像 .png <code>image/png</code> 、普通文本 .txt <code>text/plain</code>  等。</p>
</blockquote>
<h2 id="1-构造函数"><a href="#1-构造函数" class="headerlink" title="1. 构造函数"></a>1. 构造函数</h2><p>Blob 构造函数语法为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myBlob = <span class="keyword">new</span> Blob(blobParts[, options])</span><br></pre></td></tr></table></figure>
<p><strong>入参：</strong></p>
<ul>
<li><code>blobParts</code>：它是一个由 ArrayBuffer，ArrayBufferView，Blob，DOMString 等对象构成的数组。DOMStrings 会被编码为 UTF-8。</li>
<li><code>options</code> ：一个可选的对象，包含以下两个属性：<ul>
<li><code>type</code> ：默认值为 <code>&quot;&quot;</code> ，表示将会被放入到 blob 中的数组内容的 MIME 类型。</li>
<li><code>endings</code> ：默认值为 <code>&quot;transparent&quot;</code>，用于指定包含行结束符 <code>\n</code> 的字符串如何被写入。它是以下两个值中的一个：<code>&quot;native&quot;</code>，代表行结束符会被更改为适合宿主操作系统文件系统的换行符，或者 <code>&quot;transparent&quot;</code>，代表会保持 blob 中保存的结束符不变。</li>
</ul>
</li>
</ul>
<p><strong>出参：</strong>返回一个新创建的 Blob 对象，其内容由参数中给定的数组串联组成。</p>
<h2 id="2-属性和方法"><a href="#2-属性和方法" class="headerlink" title="2. 属性和方法"></a>2. 属性和方法</h2><h3 id="2-1-属性介绍"><a href="#2-1-属性介绍" class="headerlink" title="2.1 属性介绍"></a>2.1 属性介绍</h3><p><code>Blob</code> 对象拥有 2 个属性：</p>
<ul>
<li><code>size</code> ：只读，表示 <code>Blob</code> 对象中所包含的数据大小（以字节为单位）；</li>
<li><code>type</code> ：只读，值为字符串，表示该 <code>Blob</code> 对象所包含数据的 MIME 类型。若类型未知，则该属性值为空字符串。</li>
</ul>
<h3 id="2-2-方法介绍"><a href="#2-2-方法介绍" class="headerlink" title="2.2 方法介绍"></a>2.2 方法介绍</h3><ul>
<li><code>slice([start[, end[, contentType]]])</code> ：返回一个新的 Blob 对象，包含了源 Blob 对象中指定范围内的数据。</li>
<li><code>stream()</code>：返回一个能读取 Blob 内容的 <code>ReadableStream</code> 。</li>
<li><code>text()</code>：返回一个 Promise 对象且包含 Blob 所有内容的 UTF-8 格式的 <code>USVString</code> 。</li>
<li><code>arrayBuffer()</code>：返回一个 Promise 对象且包含 Blob 所有内容的二进制格式的 <code>ArrayBuffer</code> 。</li>
</ul>
<p><strong>注意</strong>：<code>Blob</code> <strong>对象是不可改变的</strong>，但是可以进行分割，并创建出新的 <code>Blob</code> 对象，将它们混合到一个新的 <code>Blob</code>  中。类似于 JavaScript 字符串：我们无法更改字符串中的字符，但可以创建新的更正后的字符串。</p>
<h2 id="3-简单上手"><a href="#3-简单上手" class="headerlink" title="3. 简单上手"></a>3. 简单上手</h2><h3 id="3-1-示例1：从字符串创建-Blob"><a href="#3-1-示例1：从字符串创建-Blob" class="headerlink" title="3.1 示例1：从字符串创建 Blob"></a>3.1 示例1：从字符串创建 Blob</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> myBlobParts = [<span class="string">&#x27;&lt;html&gt;&lt;h2&gt;Hello Leo&lt;/h2&gt;&lt;/html&gt;&#x27;</span>]; <span class="comment">// 一个包含DOMString的数组</span></span><br><span class="line"><span class="keyword">let</span> myBlob = <span class="keyword">new</span> Blob(myBlobParts, &#123;<span class="attr">type</span> : <span class="string">&#x27;text/html&#x27;</span>, <span class="attr">endings</span>: <span class="string">&quot;transparent&quot;</span>&#125;); <span class="comment">// 得到 blob</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(myBlob.size + <span class="string">&quot; bytes size&quot;</span>);</span><br><span class="line"><span class="comment">// Output: 31 bytes size</span></span><br><span class="line"><span class="built_in">console</span>.log(myBlob.type + <span class="string">&quot; is the type&quot;</span>);</span><br><span class="line"><span class="comment">// Output: text/html is the type</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-示例2：从类型化数组和字符串创建-Blob"><a href="#3-2-示例2：从类型化数组和字符串创建-Blob" class="headerlink" title="3.2 示例2：从类型化数组和字符串创建 Blob"></a>3.2 示例2：从类型化数组和字符串创建 Blob</h3><p>JavaScript类型化数组是一种类似数组的对象，并提供了一种用于 <strong>访问原始二进制数据的机制</strong> 。并且在类型数组上调用 <code>Array.isArray()</code> 会返回 <code>false</code> 。</p>
<p>详细可参考MDN《<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Typed_arrays">JavaScript 类型化数组</a>》章节。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> hello = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>([<span class="number">72</span>, <span class="number">101</span>, <span class="number">108</span>, <span class="number">108</span>, <span class="number">111</span>]); <span class="comment">// 二进制格式的 &quot;hello&quot;</span></span><br><span class="line"><span class="keyword">let</span> blob = <span class="keyword">new</span> Blob([hello, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;leo&#x27;</span>], &#123;<span class="attr">type</span>: <span class="string">&#x27;text/plain&#x27;</span>&#125;);</span><br><span class="line"><span class="comment">// Output: &quot;Hello leo&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-示例3：组装新的-Blob"><a href="#3-3-示例3：组装新的-Blob" class="headerlink" title="3.3 示例3：组装新的 Blob"></a>3.3 示例3：组装新的 Blob</h3><p>由于 <code>Blob</code> 对象是不可改变的，但我们可以进行分割，并组装成一个新的 <code>Blob</code> 对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> blob1 = <span class="keyword">new</span> Blob([<span class="string">&#x27;&lt;html&gt;&lt;h2&gt;Hello Leo&lt;/h2&gt;&lt;/html&gt;&#x27;</span>], </span><br><span class="line">   &#123;<span class="attr">type</span> : <span class="string">&#x27;text/html&#x27;</span>, <span class="attr">endings</span>: <span class="string">&quot;transparent&quot;</span>&#125;);</span><br><span class="line"><span class="keyword">let</span> blob2 = <span class="keyword">new</span> Blob([<span class="string">&#x27;&lt;html&gt;&lt;h2&gt;Happy Boy!&lt;/h2&gt;&lt;/html&gt;&#x27;</span>], </span><br><span class="line">   &#123;<span class="attr">type</span> : <span class="string">&#x27;text/html&#x27;</span>, <span class="attr">endings</span>: <span class="string">&quot;transparent&quot;</span>&#125;);</span><br><span class="line"><span class="keyword">let</span> slice1 = blob1.slice(<span class="number">16</span>);</span><br><span class="line"><span class="keyword">let</span> slice2 = blob2.slice(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> slice1.text();</span><br><span class="line"><span class="comment">// currtent slice1 value: &quot;Leo&lt;/h2&gt;&lt;/html&gt;&quot;</span></span><br><span class="line"><span class="keyword">await</span> slice2.text();</span><br><span class="line"><span class="comment">// currtent slice2 value: &quot;&lt;html&gt;&lt;h2&gt;Happy &quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> newBlob = <span class="keyword">new</span> Blob([slice2, slice1], </span><br><span class="line">   &#123;<span class="attr">type</span> : <span class="string">&#x27;text/html&#x27;</span>, <span class="attr">endings</span>: <span class="string">&quot;transparent&quot;</span>&#125;);</span><br><span class="line"><span class="keyword">await</span> newBlob.text();</span><br><span class="line"><span class="comment">// currtent newBlob value: &quot;&lt;html&gt;&lt;h2&gt;Happy Leo&lt;/h2&gt;&lt;/html&gt;&quot;</span></span><br></pre></td></tr></table></figure>

<h1 id="三、Blob-有哪些使用场景？"><a href="#三、Blob-有哪些使用场景？" class="headerlink" title="三、Blob 有哪些使用场景？"></a>三、Blob 有哪些使用场景？</h1><h2 id="1-图片本地预览"><a href="#1-图片本地预览" class="headerlink" title="1. 图片本地预览"></a>1. 图片本地预览</h2><p>这里整理 2 种图片本地预览的方式：</p>
<ol>
<li>使用 DataURL 方式；</li>
<li>使用 Blob URL/Object URL 方式；<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>1.DataURL方式：<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">accept</span>=<span class="string">&quot;image/*&quot;</span> <span class="attr">onchange</span>=<span class="string">&quot;selectFileForDataURL(event)&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">&quot;output1&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>2.Blob方式：<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">accept</span>=<span class="string">&quot;image/*&quot;</span> <span class="attr">onchange</span>=<span class="string">&quot;selectFileForBlob(event)&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">&quot;output2&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 1.DataURL方式：</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">selectFileForDataURL</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> reader = <span class="keyword">new</span> FileReader();</span></span><br><span class="line"><span class="javascript">            reader.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">const</span> output = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#output1&quot;</span>)</span></span><br><span class="line"><span class="javascript">                output.src = reader.result;</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">            reader.readAsDataURL(event.target.files[<span class="number">0</span>]);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">//2.Blob方式：</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">selectFileForBlob</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> reader = <span class="keyword">new</span> FileReader();</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> output = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#output2&quot;</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> imgUrl = <span class="built_in">window</span>.URL.createObjectURL(event.target.files[<span class="number">0</span>]);</span></span><br><span class="line"><span class="javascript">            output.src = imgUrl;</span></span><br><span class="line"><span class="javascript">            reader.onload = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">window</span>.URL.revokeObjectURL(imgUrl);</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p>上面主要介绍 <code>Blob URL</code> 和 <code>Data URL</code> 两种方式实现图片本地预览，这两个类型的区别在<strong>《五、拓展》</strong>中介绍。</p>
<h2 id="2-图片本地预览-分片上传"><a href="#2-图片本地预览-分片上传" class="headerlink" title="2. 图片本地预览 + 分片上传"></a>2. 图片本地预览 + 分片上传</h2><p><strong>实现本地预览：</strong></p>
<p>将 <code>input</code> 获取到的 <code>file</code> 对象，通过实例化 <code>FileReader</code> ，赋值给变量 <code>reader</code> ，调用<code>reader</code> 的 <code>readAsDataURL</code> 方法，将 <code>file</code> 对象转换为  <code>dataURL</code> ，然后监听 <code>reader</code> 的 <code>onload</code> 属性，获取到读取结果 <code>result</code> ，然后设置为图片的 <code>src</code> 值。</p>
<p><strong>实现分片上传</strong>：</p>
<p>由于 File 是特殊类型的 Blob，可用于任意 Blob 类型的上下文，所以针对大文件传输，我们可以使用 <code>slice</code> 方法进行文件切割，分片上传。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">accept</span>=<span class="string">&quot;image/*&quot;</span> <span class="attr">onchange</span>=<span class="string">&quot;selectFile(event)&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;upload()&quot;</span>&gt;</span>上传<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">&quot;output&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> chunkSize = <span class="number">10000</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> url = <span class="string">&quot;https://httpbin.org/post&quot;</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">selectFile</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">          	<span class="comment">// 本地预览</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> reader = <span class="keyword">new</span> FileReader();</span></span><br><span class="line"><span class="javascript">            reader.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">const</span> output = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#output&quot;</span>)</span></span><br><span class="line"><span class="javascript">                output.src = reader.result;</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">            reader.readAsDataURL(event.target.files[<span class="number">0</span>]);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">          	<span class="comment">// 分片上传</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">await</span> upload(event.target.files[<span class="number">0</span>]);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params">files</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> file = files;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">for</span>(<span class="keyword">let</span> start = <span class="number">0</span>; start &lt; file.size; start += chunkSize)&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">const</span> chunk = file.slice(start, start + chunkSize + <span class="number">1</span>);</span></span><br><span class="line"><span class="javascript">                <span class="keyword">const</span> fd = <span class="keyword">new</span> FormData();</span></span><br><span class="line"><span class="javascript">                fd.append(<span class="string">&quot;data&quot;</span>, chunk);</span></span><br><span class="line"><span class="javascript">                <span class="keyword">await</span> fetch(url, &#123; <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>, <span class="attr">body</span>: fd &#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(res)</span></span><br><span class="line"><span class="javascript">                    res.text();</span></span><br><span class="line"><span class="javascript">                &#125;);</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h2 id="3-图片本地预览-分片上传-暂停-续传"><a href="#3-图片本地预览-分片上传-暂停-续传" class="headerlink" title="3. 图片本地预览 + 分片上传 + 暂停 + 续传"></a>3. 图片本地预览 + 分片上传 + 暂停 + 续传</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">accept</span>=<span class="string">&quot;image/*&quot;</span> <span class="attr">onchange</span>=<span class="string">&quot;selectFile(event)&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;upload()&quot;</span>&gt;</span>上传<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;pause()&quot;</span>&gt;</span>暂停<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;continues()&quot;</span>&gt;</span>继续<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">&quot;output&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> chunkSize = <span class="number">30000</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> start = <span class="number">0</span>, curFile, isPause = <span class="literal">false</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> url = <span class="string">&quot;https://httpbin.org/post&quot;</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">selectFile</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> reader = <span class="keyword">new</span> FileReader();</span></span><br><span class="line"><span class="javascript">            reader.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">const</span> output = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#output&quot;</span>)</span></span><br><span class="line"><span class="javascript">                output.src = reader.result;</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">            reader.readAsDataURL(event.target.files[<span class="number">0</span>]);</span></span><br><span class="line"><span class="javascript">            curFile = event.target.files[<span class="number">0</span>];</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> file = curFile;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">for</span>(start; start &lt; file.size; start += chunkSize)&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span>(isPause) <span class="keyword">return</span>;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">const</span> chunk = file.slice(start, start + chunkSize + <span class="number">1</span>);</span></span><br><span class="line"><span class="javascript">                <span class="keyword">const</span> fd = <span class="keyword">new</span> FormData();</span></span><br><span class="line"><span class="javascript">                fd.append(<span class="string">&quot;data&quot;</span>, chunk);</span></span><br><span class="line"><span class="javascript">                <span class="keyword">await</span> fetch(url, &#123; <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>, <span class="attr">body</span>: fd &#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">                        res.text()</span></span><br><span class="line"><span class="javascript">                    &#125;</span></span><br><span class="line"><span class="javascript">                );</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span>(chunk.size &lt; chunkSize)&#123;</span></span><br><span class="line"><span class="javascript">                    uploadSuccess();</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">return</span>;</span></span><br><span class="line"><span class="javascript">                &#125;</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">pause</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            isPause = <span class="literal">true</span>;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">continues</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            isPause = <span class="literal">false</span>;</span></span><br><span class="line"><span class="javascript">            upload();</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">uploadSuccess</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            isPause = <span class="literal">false</span>;</span></span><br><span class="line"><span class="javascript">            start = <span class="number">0</span>;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h2 id="4-从互联网下载数据"><a href="#4-从互联网下载数据" class="headerlink" title="4. 从互联网下载数据"></a>4. 从互联网下载数据</h2><p>在实现“从互联网下载数据”方法时，我们使用 <code>createObjectURL</code> 显示图片，在请求互联网图片时，我们有两种方式：</p>
<ul>
<li>使用 <code>XMLHttpRequest</code> ；</li>
<li>使用 <code>fetch</code> ；<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;download1()&quot;</span>&gt;</span>使用 XMLHttpRequest 下载<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;download2()&quot;</span>&gt;</span>使用 fetch 下载<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">&quot;pingan&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> url = <span class="string">&quot;http://images.pingan8787.com/TinyCompiler/111.png&quot;</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> pingan = <span class="built_in">document</span>.querySelector(<span class="string">&#x27;#pingan&#x27;</span>);</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">download1</span> (<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="javascript">            xhr.open(<span class="string">&#x27;GET&#x27;</span>, url);</span></span><br><span class="line"><span class="javascript">            xhr.responseType = <span class="string">&#x27;blob&#x27;</span>;</span></span><br><span class="line"><span class="javascript">            xhr.onload = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">                renderImage(xhr.response);</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">            xhr.send(<span class="literal">null</span>);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">download2</span> (<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            fetch(url).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">return</span> res.blob();</span></span><br><span class="line"><span class="javascript">            &#125;).then(<span class="function"><span class="params">myBlob</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">                renderImage(myBlob);</span></span><br><span class="line"><span class="javascript">            &#125;)</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">renderImage</span> (<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">let</span> objectURL = URL.createObjectURL(data);</span></span><br><span class="line"><span class="javascript">            pingan.src = objectURL;</span></span><br><span class="line"><span class="javascript">          	<span class="comment">// 根据业务需要手动调用 URL.revokeObjectURL(imgUrl)</span></span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="5-下载文件"><a href="#5-下载文件" class="headerlink" title="5. 下载文件"></a>5. 下载文件</h2><p>通过调用 Blob 的构造函数来创建类型为 <code>&quot;text/plain&quot;</code> 的 Blob 对象，然后通过动态创建 <code>a</code> 标签来实现文件的下载。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;download()&quot;</span>&gt;</span>Blob 文件下载<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">download</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> fileName= <span class="string">&quot;Blob文件.txt&quot;</span>;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> myBlob = <span class="keyword">new</span> Blob([<span class="string">&quot;一文彻底掌握 Blob Web API&quot;</span>], &#123; <span class="attr">type</span>: <span class="string">&quot;text/plain&quot;</span> &#125;);</span></span><br><span class="line"><span class="javascript">            downloadFun(fileName, myBlob);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">downloadFun</span>(<span class="params">fileName, blob</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> link = <span class="built_in">document</span>.createElement(<span class="string">&quot;a&quot;</span>);</span></span><br><span class="line"><span class="javascript">            link.href = URL.createObjectURL(blob);</span></span><br><span class="line"><span class="javascript">            link.download = fileName;</span></span><br><span class="line"><span class="javascript">            link.click();</span></span><br><span class="line"><span class="javascript">            link.remove();</span></span><br><span class="line"><span class="javascript">            URL.revokeObjectURL(link.href);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="6-图片压缩"><a href="#6-图片压缩" class="headerlink" title="6. 图片压缩"></a>6. 图片压缩</h2><p>当我们希望本地图片在上传之前，先进行一定压缩，再提交，从而减少传输的数据量。</p>
<p>在前端我们可以使用 Canvas 提供的 <code>toDataURL()</code> 方法来实现，该方法接收 <code>type</code> 和 <code>encoderOptions</code> 两个可选参数：</p>
<ul>
<li><code>type</code> 表示<strong>图片格式</strong>，默认为 <code>image/png</code> ；</li>
<li><code>encoderOptions</code> 表示<strong>图片质量</strong>，在指定图片格式为 <code>image/jpeg</code> 或 <code>image/webp</code> 的情况下，可以从 0 到 1 区间内选择图片质量。如果超出取值范围，将会使用默认值 <code>0.92</code>，其他参数会被忽略。<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">accept</span>=<span class="string">&quot;image/*&quot;</span> <span class="attr">onchange</span>=<span class="string">&quot;loadFile(event)&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// compress.js</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> MAX_WIDTH = <span class="number">800</span>; <span class="comment">// 图片最大宽度</span></span></span><br><span class="line"><span class="javascript">      	<span class="comment">// 图片压缩方法</span></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">compress</span>(<span class="params">base64, quality, mimeType</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">let</span> canvas = <span class="built_in">document</span>.createElement(<span class="string">&quot;canvas&quot;</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">let</span> img = <span class="built_in">document</span>.createElement(<span class="string">&quot;img&quot;</span>);</span></span><br><span class="line"><span class="javascript">            img.crossOrigin = <span class="string">&quot;anonymous&quot;</span>;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">                img.src = base64;</span></span><br><span class="line"><span class="javascript">                img.onload = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">let</span> targetWidth, targetHeight;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">if</span> (img.width &gt; MAX_WIDTH) &#123;</span></span><br><span class="line"><span class="javascript">                        targetWidth = MAX_WIDTH;</span></span><br><span class="line"><span class="javascript">                        targetHeight = (img.height * MAX_WIDTH) / img.width;</span></span><br><span class="line"><span class="javascript">                    &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">                        targetWidth = img.width;</span></span><br><span class="line"><span class="javascript">                        targetHeight = img.height;</span></span><br><span class="line"><span class="javascript">                    &#125;</span></span><br><span class="line"><span class="javascript">                    canvas.width = targetWidth;</span></span><br><span class="line"><span class="javascript">                    canvas.height = targetHeight;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">let</span> ctx = canvas.getContext(<span class="string">&quot;2d&quot;</span>);</span></span><br><span class="line"><span class="javascript">                    ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, targetWidth, targetHeight); <span class="comment">// 清除画布</span></span></span><br><span class="line"><span class="javascript">                    ctx.drawImage(img, <span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height);</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">let</span> imageData = canvas.toDataURL(mimeType, quality / <span class="number">100</span>); <span class="comment">// 设置图片质量</span></span></span><br><span class="line"><span class="javascript">                    resolve(imageData);</span></span><br><span class="line"><span class="javascript">                &#125;;</span></span><br><span class="line"><span class="javascript">            &#125;);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 为了进一步减少传输的数据量，我们可以把它转换为 Blob 对象</span></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">dataUrlToBlob</span>(<span class="params">base64, mimeType</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">let</span> bytes = <span class="built_in">window</span>.atob(base64.split(<span class="string">&quot;,&quot;</span>)[<span class="number">1</span>]);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">let</span> ab = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(bytes.length);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">let</span> ia = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(ab);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; bytes.length; i++) &#123;</span></span><br><span class="line"><span class="javascript">                ia[i] = bytes.charCodeAt(i);</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="keyword">new</span> Blob([ab], &#123; <span class="attr">type</span>: mimeType &#125;);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 通过 AJAX 提交到服务器</span></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">uploadFile</span>(<span class="params">url, blob</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">let</span> formData = <span class="keyword">new</span> FormData();</span></span><br><span class="line"><span class="javascript">            <span class="keyword">let</span> request = <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="javascript">            formData.append(<span class="string">&quot;image&quot;</span>, blob);</span></span><br><span class="line"><span class="javascript">            request.open(<span class="string">&quot;POST&quot;</span>, url, <span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">            request.send(formData);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">loadFile</span>(<span class="params">event</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> reader = <span class="keyword">new</span> FileReader();</span></span><br><span class="line"><span class="javascript">            reader.onload = <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">let</span> compressedDataURL = <span class="keyword">await</span> compress(</span></span><br><span class="line"><span class="javascript">                    reader.result,</span></span><br><span class="line"><span class="javascript">                    <span class="number">90</span>,</span></span><br><span class="line"><span class="javascript">                    <span class="string">&quot;image/jpeg&quot;</span></span></span><br><span class="line"><span class="javascript">                );</span></span><br><span class="line"><span class="javascript">                <span class="keyword">let</span> compressedImageBlob = dataUrlToBlob(compressedDataURL);</span></span><br><span class="line"><span class="javascript">                uploadFile(<span class="string">&quot;https://httpbin.org/post&quot;</span>, compressedImageBlob);</span></span><br><span class="line"><span class="javascript">            &#125;;</span></span><br><span class="line"><span class="javascript">            reader.readAsDataURL(event.target.files[<span class="number">0</span>]);</span></span><br><span class="line"><span class="javascript">        &#125;;</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
其实 Canvas 对象除了提供 <code>toDataURL()</code> 方法之外，它还提供了一个 <code>toBlob()</code> 方法，该方法的语法如下：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">canvas.toBlob(callback, mimeType, qualityArgument)</span><br></pre></td></tr></table></figure>

<p>和 <code>toDataURL()</code> 方法相比，<code>toBlob()</code> 方法是异步的，因此多了个 <code>callback</code> 参数，这个 <code>callback</code> 回调方法默认的第一个参数就是转换好的 <code>blob</code>文件信息。<br /></p>
<h2 id="7-生成-PDF-文档"><a href="#7-生成-PDF-文档" class="headerlink" title="7. 生成 PDF 文档"></a>7. 生成 PDF 文档</h2><p>在浏览器端，利用一些现成的开源库，比如 jsPDF，我们也可以方便地生成 PDF 文档。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>客户端生成 PDF 示例<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/jspdf@latest/dist/jspdf.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    (<span class="function"><span class="keyword">function</span> <span class="title">generatePdf</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> doc = <span class="keyword">new</span> jsPDF();</span></span><br><span class="line"><span class="javascript">      doc.text(<span class="string">&quot;Hello semlinker!&quot;</span>, <span class="number">66</span>, <span class="number">88</span>);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> blob = <span class="keyword">new</span> Blob([doc.output()], &#123; <span class="attr">type</span>: <span class="string">&quot;application/pdf&quot;</span> &#125;);</span></span><br><span class="line"><span class="javascript">      blob.text().then(<span class="function">(<span class="params">blobAsText</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(blobAsText);</span></span><br><span class="line"><span class="javascript">      &#125;);</span></span><br><span class="line"><span class="javascript">    &#125;)();</span></span><br><span class="line"><span class="javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>其实 jsPDF 除了支持纯文本之外，它也可以生成带图片的 PDF 文档，比如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> imgData = <span class="string">&#x27;data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/...&#x27;</span></span><br><span class="line"><span class="keyword">let</span> doc = <span class="keyword">new</span> jsPDF();</span><br><span class="line"></span><br><span class="line">doc.setFontSize(<span class="number">40</span>);</span><br><span class="line">doc.text(<span class="number">35</span>, <span class="number">25</span>, <span class="string">&#x27;Paranyan loves jsPDF&#x27;</span>);</span><br><span class="line">doc.addImage(imgData, <span class="string">&#x27;JPEG&#x27;</span>, <span class="number">15</span>, <span class="number">40</span>, <span class="number">180</span>, <span class="number">160</span>);</span><br></pre></td></tr></table></figure>

<h1 id="四、Blob-与-ArrayBuffer-有何区别？"><a href="#四、Blob-与-ArrayBuffer-有何区别？" class="headerlink" title="四、Blob 与 ArrayBuffer 有何区别？"></a>四、Blob 与 ArrayBuffer 有何区别？</h1><h2 id="1-定义区别"><a href="#1-定义区别" class="headerlink" title="1. 定义区别"></a>1. 定义区别</h2><p><code>ArrayBuffer</code> 对象用于表示<strong>通用的，固定长度的原始二进制数据缓冲区</strong>。且<strong>不能直接操纵</strong> ArrayBuffer 的内容，需要创建一个类型化数组对象或 <code>DataView</code> 对象，该对象以特定格式表示缓冲区，并使用该对象读取和写入缓冲区的内容。</p>
<p><code>Blob</code> 类型的对象表示<strong>不可变的类似文件对象的原始数据</strong>。<code>Blob</code> 表示的不一定是 JavaScript 原生格式的数据。<code>File</code> 接口基于 <code>Blob</code>，继承了<code>Blob</code> 功能并将其扩展为支持用户系统上的文件。</p>
<p><code>Blob</code> 类型只有 <code>slice</code> 方法，用于返回一个新的 <code>Blob</code> 对象，包含了源 <code>Blob</code> 对象中指定范围内的数据。 对比发现，<code>ArrayBuffer</code> 的数据，是可以<strong>按照字节去操作</strong>的，而 <code>Blob</code> 只能作为一个完整对象去处理。所以说，<code>ArrayBuffer</code> 相比 <code>Blob</code> 更接近真实的二进制，更底层。</p>
<h2 id="2-两者互转"><a href="#2-两者互转" class="headerlink" title="2. 两者互转"></a>2. 两者互转</h2><h3 id="2-1-ArrayBuffer-转-Blob"><a href="#2-1-ArrayBuffer-转-Blob" class="headerlink" title="2.1 ArrayBuffer 转 Blob"></a>2.1 ArrayBuffer 转 Blob</h3><p>只需将 <code>ArrayBuffer</code> 作为参数传入即可：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> buffer = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(<span class="number">16</span>);</span><br><span class="line"><span class="keyword">const</span> blob = <span class="keyword">new</span> Blob([buffer]);</span><br></pre></td></tr></table></figure>

<h3 id="2-2-Blob-转-ArrayBuffer"><a href="#2-2-Blob-转-ArrayBuffer" class="headerlink" title="2.2 Blob 转 ArrayBuffer"></a>2.2 Blob 转 ArrayBuffer</h3><p>需要借助 <code>FileReader</code> 对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> blob = <span class="keyword">new</span> Blob([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]);</span><br><span class="line"><span class="keyword">const</span> reader = <span class="keyword">new</span> FileReader();</span><br><span class="line"></span><br><span class="line">reader.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.result);</span><br><span class="line">&#125;</span><br><span class="line">reader.readAsArrayBuffer(blob);</span><br></pre></td></tr></table></figure>

<h2 id="3-其他区别"><a href="#3-其他区别" class="headerlink" title="3. 其他区别"></a>3. 其他区别</h2><ol>
<li>需要使用写入/编辑操作时使用 ArrayBuffer，否则使用 Blob 即可；</li>
<li>Blob 对象不可变，而 ArrayBuffer 可以通过 TypedArrays 或 DataView 操作；</li>
<li>Blob 可以位于磁盘、高速缓存内存和其他不同用位置，而 ArrayBuffer 存在内存中，可以直接操作；</li>
</ol>
<h2 id="4-Ajax-中使用-Blob-和-ArrayBuffer"><a href="#4-Ajax-中使用-Blob-和-ArrayBuffer" class="headerlink" title="4. Ajax 中使用 Blob 和 ArrayBuffer"></a>4. Ajax 中使用 Blob 和 ArrayBuffer</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">GET</span>(<span class="params">url, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">  xhr.open(<span class="string">&#x27;GET&#x27;</span>, url, <span class="literal">true</span>);</span><br><span class="line">  xhr.responseType = <span class="string">&#x27;arraybuffer&#x27;</span>; <span class="comment">// or xhr.responseType = &quot;blob&quot;;</span></span><br><span class="line">  xhr.send();</span><br><span class="line"></span><br><span class="line">  xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (xhr.status != <span class="number">200</span>) &#123;</span><br><span class="line">      alert(<span class="string">&quot;Unexpected status code &quot;</span> + xhr.status + <span class="string">&quot; for &quot;</span> + url);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    callback(<span class="keyword">new</span> <span class="built_in">Uint8Array</span>(xhr.response)); <span class="comment">// or new Blob([xhr.response]);</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="五、拓展"><a href="#五、拓展" class="headerlink" title="五、拓展"></a>五、拓展</h1><h2 id="1-Blob-URL-和-Data-URL-区别"><a href="#1-Blob-URL-和-Data-URL-区别" class="headerlink" title="1. Blob URL 和 Data URL 区别"></a>1. Blob URL 和 Data URL 区别</h2><h3 id="1-1-格式不同"><a href="#1-1-格式不同" class="headerlink" title="1.1 格式不同"></a>1.1 格式不同</h3><p><code>Blob URL</code> 格式如 <code>blob:域名/uuid</code> ， <code>Data URL</code> 格式如： <code>data:[&lt;mediatype&gt;][;base64],&lt;data&gt;</code>  。</p>
<p><code>mediatype</code> 是个 MIME 类型的字符串，例如 “<code>image/jpeg</code>“ 表示 JPEG 图像文件。如果被省略，则默认值为 <code>text/plain;charset=US-ASCII</code>。</p>
<p><img src="http://images.pingan8787.com/blog/you-dont-know-blob/code.png" alt="image.png"></p>
<h3 id="1-2-长度不同"><a href="#1-2-长度不同" class="headerlink" title="1.2 长度不同"></a>1.2 长度不同</h3><p><code>Blob URL</code> 一般长度较短，而 <code>Data URL</code> 因为直接存储图片 base64 编码后的数据，往往比较长。</p>
<h3 id="1-3-XMLHttpRequest-支持情况不同"><a href="#1-3-XMLHttpRequest-支持情况不同" class="headerlink" title="1.3 XMLHttpRequest 支持情况不同"></a>1.3 XMLHttpRequest 支持情况不同</h3><p><code>Blob URL</code>  可以很方便使用 XMLHttpRequest 获取源数据（ <code>xhr.responseType = &#39;blob&#39;</code> ），而 <code>Data URL</code> 并不是所有浏览器都支持通过 XMLHttpRequest 获取源数据的。</p>
<h3 id="1-4-使用场景不同"><a href="#1-4-使用场景不同" class="headerlink" title="1.4 使用场景不同"></a>1.4 使用场景不同</h3><p><code>Blob URL</code>  只能在当前应用内使用，把 <code>Blob URL</code>  复制到浏览器地址栏是无法获取数据，而 <code>Data URL</code> 则可以在任意浏览器中使用。</p>
<h1 id="六、总结"><a href="#六、总结" class="headerlink" title="六、总结"></a>六、总结</h1><p>本文中我们主要通过 4 个问题来复习了 Blob 知识点：“Blob 是什么”、“Blob 怎么用”、“Blob 使用场景”和“Blob 与 ArrayBuffer 区别”，在“Blob 使用场景”部分中，也主要介绍了我们实际开发中非常常见的“图片预览”、“图片下载”和“生成文件”的场景。在文章最后，也通过和大家复习了“Blob URL 和 Data URL 区别”，让我们对 Blob 有更深的认识。</p>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#112;&#x69;&#x6e;&#x67;&#97;&#x6e;&#x38;&#55;&#56;&#55;&#64;&#x71;&#113;&#x2e;&#99;&#111;&#109;">&#112;&#x69;&#x6e;&#x67;&#97;&#x6e;&#x38;&#55;&#56;&#55;&#64;&#x71;&#113;&#x2e;&#99;&#111;&#109;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>ES小册</td>
<td>js.pingan8787.com</td>
</tr>
<tr>
<td>语雀知识库</td>
<td><a target="_blank" rel="noopener" href="https://www.yuque.com/wangpingan/cute-frontend">Cute-FrontEnd</a></td>
</tr>
</tbody></table>
<p><img src="http://images.pingan8787.com/2019_07_12guild_page.png" alt="bg">  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/07/06/209-%E3%80%90JavaScript%E3%80%91%E3%80%8A%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84Blob%E3%80%8B%E7%95%AA%E5%A4%96%E7%AF%87/" data-id="ckts3ejyw00n94d9k96tu70kd" data-title="209-【JavaScript】《你不知道的Blob》番外篇" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag">读书笔记</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-208-【TyeScript】了不起的tsconfig-json学习指南" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/06/17/208-%E3%80%90TyeScript%E3%80%91%E4%BA%86%E4%B8%8D%E8%B5%B7%E7%9A%84tsconfig-json%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97/" class="article-date">
  <time class="dt-published" datetime="2020-06-16T16:15:09.000Z" itemprop="datePublished">2020-06-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/06/17/208-%E3%80%90TyeScript%E3%80%91%E4%BA%86%E4%B8%8D%E8%B5%B7%E7%9A%84tsconfig-json%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97/">208-【TyeScript】了不起的tsconfig.json学习指南</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>在 TypeScript 开发中，tsconfig.json 是个不可或缺的配置文件，它是我们在 TS 项目中最常见的配置文件，那么你真的了解这个文件吗？它里面都有哪些优秀配置？如何配置一个合理的 tsconfig.json 文件？本文将全面带大家一起详细了解 tsconfig.json 的各项配置。<br /><br><br />本文将从以下几个方面全面介绍 tsconfig.json 文件：<br /><img src="http://images.pingan8787.com/tsconfig-json/tsconfig-json-guide.png" alt="了不起的 tsconfig.json 指南.png"><br><a name="UZ7GF"></a><br><br />水平有限，欢迎各位大佬指点~~<br /></p>
<h2 id="一、tsconfig-json-简介"><a href="#一、tsconfig-json-简介" class="headerlink" title="一、tsconfig.json 简介"></a>一、tsconfig.json 简介</h2><p><a name="bANbi"></a></p>
<h3 id="1-什么是-tsconfig-json"><a href="#1-什么是-tsconfig-json" class="headerlink" title="1. 什么是 tsconfig.json"></a>1. 什么是 tsconfig.json</h3><p>TypeScript 使用 tsconfig.json 文件作为其配置文件，当一个目录中存在 tsconfig.json 文件，则认为该目录为 TypeScript 项目的根目录。<br />通常 tsconfig.json 文件主要包含两部分内容：<strong>指定待编译文件</strong>和<strong>定义编译选项</strong>。<br /><br><br />从《<a target="_blank" rel="noopener" href="http://json.schemastore.org/tsconfig">TypeScript编译器的配置文件的JSON模式</a>》可知，目前 tsconfig.json 文件有以下几个顶层属性：</p>
<ul>
<li>compileOnSave</li>
<li>compilerOptions</li>
<li>exclude</li>
<li>extends</li>
<li>files</li>
<li>include</li>
<li>references</li>
<li>typeAcquisition</li>
</ul>
<p><br />文章后面会详细介绍一些常用属性配置。<br /></p>
<p><a name="EIEcP"></a></p>
<h3 id="2-为什么使用-tsconfig-json"><a href="#2-为什么使用-tsconfig-json" class="headerlink" title="2. 为什么使用 tsconfig.json"></a>2. 为什么使用 tsconfig.json</h3><p>通常我们可以使用 <code>tsc</code> 命令来编译少量 TypeScript 文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">  参数介绍：</span><br><span class="line">  --outFile // 编译后生成的文件名称</span><br><span class="line">  --target  // 指定ECMAScript目标版本</span><br><span class="line">  --module  // 指定生成哪个模块系统代码</span><br><span class="line">  index.ts  // 源文件</span><br><span class="line">*/</span><br><span class="line">$ tsc --outFile leo.js --target es3 --module amd index.ts</span><br></pre></td></tr></table></figure>
<p>但如果实际开发的项目，很少是只有单个文件，当我们需要编译整个项目时，就可以使用 tsconfig.json 文件，将需要使用到的配置都写进 tsconfig.json 文件，<strong>这样就不用每次编译都手动输入配置，另外也方便团队协作开发</strong>。<br /></p>
<p><a name="u7L2g"></a></p>
<h2 id="二、使用-tsconfig-json"><a href="#二、使用-tsconfig-json" class="headerlink" title="二、使用 tsconfig.json"></a>二、使用 tsconfig.json</h2><p>目前使用 tsconfig.json 有2种操作：<br><a name="Kshqd"></a></p>
<h3 id="1-初始化-tsconfig-json"><a href="#1-初始化-tsconfig-json" class="headerlink" title="1. 初始化 tsconfig.json"></a>1. 初始化 tsconfig.json</h3><p>在初始化操作，也有 2 种方式：</p>
<ol>
<li>手动在项目根目录（或其他）创建 tsconfig.json 文件并填写配置；</li>
<li>通过 <code>tsc --init</code> 初始化 tsconfig.json 文件。</li>
</ol>
<p><a name="7PAhG"></a></p>
<h3 id="2-指定需要编译的目录"><a href="#2-指定需要编译的目录" class="headerlink" title="2. 指定需要编译的目录"></a>2. 指定需要编译的目录</h3><p><strong>在不指定输入文件的情况下</strong>执行 <code>tsc</code> 命令，默认从当前目录开始编译，编译所有 <code>.ts</code> 文件，并且从当前目录开始查找 tsconfig.json 文件，并逐级向上级目录搜索。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tsc</span><br></pre></td></tr></table></figure>
<p>另外也可以为 <code>tsc</code> 命令指定参数 <code>--project</code> 或 <code>-p</code> 指定需要编译的目录，该目录需要包含一个 tsconfig.json 文件，如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">  文件目录：</span><br><span class="line">  ├─src/</span><br><span class="line">  │  ├─index.ts</span><br><span class="line">  │  └─tsconfig.json</span><br><span class="line">  ├─package.json</span><br><span class="line">*/</span><br><span class="line">$ tsc --project src</span><br></pre></td></tr></table></figure>
<p><strong>注意，tsc 的命令行选项具有优先级，会覆盖 tsconfig.json 中的同名选项。</strong><br /><br><br />更多 tsc 编译选项，可查看<a target="_blank" rel="noopener" href="https://www.tslang.cn/docs/handbook/compiler-options.html">《编译选项》</a>章节。<br /></p>
<p><a name="pn9rO"></a></p>
<h2 id="三、使用示例"><a href="#三、使用示例" class="headerlink" title="三、使用示例"></a>三、使用示例</h2><p>这个章节，我们将通过本地一个小项目 <code>learnTsconfig</code> 来学着实现一个简单配置。<br />当前开发环境：windows / node 10.15.1 / TypeScript3.9<br /></p>
<p><a name="hqWeO"></a></p>
<h3 id="1-初始化-learnTsconfig-项目"><a href="#1-初始化-learnTsconfig-项目" class="headerlink" title="1. 初始化 learnTsconfig 项目"></a>1. 初始化 learnTsconfig 项目</h3><p>执行下面命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir learnTsconfig</span><br><span class="line">$ <span class="built_in">cd</span> .\learnTsconfig\</span><br><span class="line">$ mkdir src</span><br><span class="line">$ new-item index.ts</span><br></pre></td></tr></table></figure>
<p>并且我们为 index.ts 文件写一些简单代码：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回当前版本号</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getVersion</span>(<span class="params">version:<span class="built_in">string</span> = <span class="string">&quot;1.0.0&quot;</span></span>): <span class="title">string</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> version;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(getVersion(<span class="string">&quot;1.0.1&quot;</span>))</span><br></pre></td></tr></table></figure>

<p>我们将获得这么一个目录结构：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">└─src/</span><br><span class="line">   └─index.ts</span><br></pre></td></tr></table></figure>


<p><a name="TNpbL"></a></p>
<h3 id="2-初始化-tsconfig-json-文件"><a href="#2-初始化-tsconfig-json-文件" class="headerlink" title="2. 初始化 tsconfig.json 文件"></a>2. 初始化 tsconfig.json 文件</h3><p>在 learnTsconfig 根目录执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tsc --init</span><br></pre></td></tr></table></figure>


<p><a name="I03ph"></a></p>
<h3 id="3-修改-tsconfig-json-文件"><a href="#3-修改-tsconfig-json-文件" class="headerlink" title="3. 修改 tsconfig.json 文件"></a>3. 修改 tsconfig.json 文件</h3><p>我们设置几个常见配置项：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;target&quot;</span>: <span class="string">&quot;ES5&quot;</span>,             <span class="comment">// 目标语言的版本</span></span><br><span class="line">    <span class="attr">&quot;module&quot;</span>: <span class="string">&quot;commonjs&quot;</span>,        <span class="comment">// 指定生成代码的模板标准</span></span><br><span class="line">    <span class="attr">&quot;noImplicitAny&quot;</span>: <span class="literal">true</span>,       <span class="comment">// 不允许隐式的 any 类型</span></span><br><span class="line">    <span class="attr">&quot;removeComments&quot;</span>: <span class="literal">true</span>,      <span class="comment">// 删除注释 </span></span><br><span class="line">    <span class="attr">&quot;preserveConstEnums&quot;</span>: <span class="literal">true</span>,  <span class="comment">// 保留 const 和 enum 声明</span></span><br><span class="line">    <span class="attr">&quot;sourceMap&quot;</span>: <span class="literal">true</span>            <span class="comment">// 生成目标文件的sourceMap文件</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;files&quot;</span>: [   <span class="comment">// 指定待编译文件</span></span><br><span class="line">    <span class="string">&quot;./src/index.ts&quot;</span>  </span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中需要注意一点：<br /> <code>files</code> 配置项值是一个<strong>数组</strong>，用来指定了待编译文件，即<strong>入口文件</strong>。<br />当入口文件依赖其他文件时，不需要将被依赖文件也指定到 <code>files</code> 中，因为<strong>编译器会自动将所有的依赖文件归纳为编译对象</strong>，即 <code>index.ts</code> 依赖 <code>user.ts</code> 时，不需要在 <code>files</code> 中指定 <code>user.ts</code> ， <code>user.ts</code> 会自动纳入待编译文件。<br /></p>
<p><a name="5HN4m"></a></p>
<h3 id="4-执行编译"><a href="#4-执行编译" class="headerlink" title="4. 执行编译"></a>4. 执行编译</h3><p>配置完成后，我们可以在命令行执行 <code>tsc</code> 命令，执行编译完成后，我们可以得到一个 <code>index.js</code> 文件和一个 <code>index.js.map</code> 文件，证明我们编译成功，其中 <code>index.js</code> 文件内容如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getVersion</span>(<span class="params">version</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (version === <span class="keyword">void</span> <span class="number">0</span>) &#123; version = <span class="string">&quot;1.0.0&quot;</span>; &#125;</span><br><span class="line">    <span class="keyword">return</span> version;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(getVersion(<span class="string">&quot;1.0.1&quot;</span>));</span><br><span class="line"><span class="comment">//# sourceMappingURL=index.js.map</span></span><br></pre></td></tr></table></figure>
<p>可以看出，tsconfig.json 中的 <code>removeComments</code> 配置生效了，将我们添加的注释代码移除了。<br /><br><br />到这一步，就完成了这个简单的示例，接下来会基于这个示例代码，讲解《七、常见配置示例》。<br /></p>
<p><a name="IgQ8Z"></a></p>
<h2 id="四、tsconfig-json-文件结构介绍"><a href="#四、tsconfig-json-文件结构介绍" class="headerlink" title="四、tsconfig.json 文件结构介绍"></a>四、tsconfig.json 文件结构介绍</h2><p><a name="r62H3"></a></p>
<h3 id="1-按顶层属性分类"><a href="#1-按顶层属性分类" class="headerlink" title="1. 按顶层属性分类"></a>1. 按顶层属性分类</h3><p>在 tsconfig.json 文件中按照<strong>顶层属性</strong>，分为以下几类：<br /><img src="http://images.pingan8787.com/tsconfig-json/tsconfig-json-1.png" alt="tsconfig.json 文件结构（顶层属性）.png"></p>
<p><img src="http://images.pingan8787.com/tsconfig-json/tsconfig-json-3.png" alt="了不起的 tsconfig.json 指南.png"></p>
<p><a name="0vZYp"></a></p>
<h3 id="2-按功能分类"><a href="#2-按功能分类" class="headerlink" title="2. 按功能分类"></a>2. 按功能分类</h3><p><img src="http://images.pingan8787.com/tsconfig-json/tsconfig-json-2.png" alt="tsconfig.json 文件结构（功能）.png"><br /></p>
<p><a name="S64EK"></a></p>
<h2 id="五、tsconfig-json-配置介绍"><a href="#五、tsconfig-json-配置介绍" class="headerlink" title="五、tsconfig.json 配置介绍"></a>五、tsconfig.json 配置介绍</h2><p><a name="pq3yO"></a></p>
<h3 id="1-compileOnSave"><a href="#1-compileOnSave" class="headerlink" title="1. compileOnSave"></a>1. compileOnSave</h3><p><code>compileOnSave</code> 属性作用是<strong>设置保存文件的时候自动编译，但需要编译器支持</strong>。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">  <span class="attr">&quot;compileOnSave&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a name="HWUeW"></a></p>
<h3 id="2-compilerOptions"><a href="#2-compilerOptions" class="headerlink" title="2. compilerOptions"></a>2. compilerOptions</h3><p><code>compilerOptions</code> 属性作用是<strong>配置编译选项</strong>。<br />若 <code>compilerOptions</code> 属性被忽略，则编译器会使用默认值，可以查看<a target="_blank" rel="noopener" href="https://www.typescriptlang.org/docs/handbook/compiler-options.html">《官方完整的编译选项列表》</a>。<br />编译选项配置非常繁杂，有很多配置，这里只列出常用的配置。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;incremental&quot;</span>: <span class="literal">true</span>, <span class="comment">// TS编译器在第一次编译之后会生成一个存储编译信息的文件，第二次编译会在第一次的基础上进行增量编译，可以提高编译的速度</span></span><br><span class="line">    <span class="attr">&quot;tsBuildInfoFile&quot;</span>: <span class="string">&quot;./buildFile&quot;</span>, <span class="comment">// 增量编译文件的存储位置</span></span><br><span class="line">    <span class="attr">&quot;diagnostics&quot;</span>: <span class="literal">true</span>, <span class="comment">// 打印诊断信息 </span></span><br><span class="line">    <span class="attr">&quot;target&quot;</span>: <span class="string">&quot;ES5&quot;</span>, <span class="comment">// 目标语言的版本</span></span><br><span class="line">    <span class="attr">&quot;module&quot;</span>: <span class="string">&quot;CommonJS&quot;</span>, <span class="comment">// 生成代码的模板标准</span></span><br><span class="line">    <span class="attr">&quot;outFile&quot;</span>: <span class="string">&quot;./app.js&quot;</span>, <span class="comment">// 将多个相互依赖的文件生成一个文件，可以用在AMD模块中，即开启时应设置&quot;module&quot;: &quot;AMD&quot;,</span></span><br><span class="line">    <span class="attr">&quot;lib&quot;</span>: [<span class="string">&quot;DOM&quot;</span>, <span class="string">&quot;ES2015&quot;</span>, <span class="string">&quot;ScriptHost&quot;</span>, <span class="string">&quot;ES2019.Array&quot;</span>], <span class="comment">// TS需要引用的库，即声明文件，es5 默认引用dom、es5、scripthost,如需要使用es的高级版本特性，通常都需要配置，如es8的数组新特性需要引入&quot;ES2019.Array&quot;,</span></span><br><span class="line">    <span class="attr">&quot;allowJS&quot;</span>: <span class="literal">true</span>, <span class="comment">// 允许编译器编译JS，JSX文件</span></span><br><span class="line">    <span class="attr">&quot;checkJs&quot;</span>: <span class="literal">true</span>, <span class="comment">// 允许在JS文件中报错，通常与allowJS一起使用</span></span><br><span class="line">    <span class="attr">&quot;outDir&quot;</span>: <span class="string">&quot;./dist&quot;</span>, <span class="comment">// 指定输出目录</span></span><br><span class="line">    <span class="attr">&quot;rootDir&quot;</span>: <span class="string">&quot;./&quot;</span>, <span class="comment">// 指定输出文件目录(用于输出)，用于控制输出目录结构</span></span><br><span class="line">    <span class="attr">&quot;declaration&quot;</span>: <span class="literal">true</span>, <span class="comment">// 生成声明文件，开启后会自动生成声明文件</span></span><br><span class="line">    <span class="attr">&quot;declarationDir&quot;</span>: <span class="string">&quot;./file&quot;</span>, <span class="comment">// 指定生成声明文件存放目录</span></span><br><span class="line">    <span class="attr">&quot;emitDeclarationOnly&quot;</span>: <span class="literal">true</span>, <span class="comment">// 只生成声明文件，而不会生成js文件</span></span><br><span class="line">    <span class="attr">&quot;sourceMap&quot;</span>: <span class="literal">true</span>, <span class="comment">// 生成目标文件的sourceMap文件</span></span><br><span class="line">    <span class="attr">&quot;inlineSourceMap&quot;</span>: <span class="literal">true</span>, <span class="comment">// 生成目标文件的inline SourceMap，inline SourceMap会包含在生成的js文件中</span></span><br><span class="line">    <span class="attr">&quot;declarationMap&quot;</span>: <span class="literal">true</span>, <span class="comment">// 为声明文件生成sourceMap</span></span><br><span class="line">    <span class="attr">&quot;typeRoots&quot;</span>: [], <span class="comment">// 声明文件目录，默认时node_modules/@types</span></span><br><span class="line">    <span class="attr">&quot;types&quot;</span>: [], <span class="comment">// 加载的声明文件包</span></span><br><span class="line">    <span class="attr">&quot;removeComments&quot;</span>:<span class="literal">true</span>, <span class="comment">// 删除注释 </span></span><br><span class="line">    <span class="attr">&quot;noEmit&quot;</span>: <span class="literal">true</span>, <span class="comment">// 不输出文件,即编译后不会生成任何js文件</span></span><br><span class="line">    <span class="attr">&quot;noEmitOnError&quot;</span>: <span class="literal">true</span>, <span class="comment">// 发送错误时不输出任何文件</span></span><br><span class="line">    <span class="attr">&quot;noEmitHelpers&quot;</span>: <span class="literal">true</span>, <span class="comment">// 不生成helper函数，减小体积，需要额外安装，常配合importHelpers一起使用</span></span><br><span class="line">    <span class="attr">&quot;importHelpers&quot;</span>: <span class="literal">true</span>, <span class="comment">// 通过tslib引入helper函数，文件必须是模块</span></span><br><span class="line">    <span class="attr">&quot;downlevelIteration&quot;</span>: <span class="literal">true</span>, <span class="comment">// 降级遍历器实现，如果目标源是es3/5，那么遍历器会有降级的实现</span></span><br><span class="line">    <span class="attr">&quot;strict&quot;</span>: <span class="literal">true</span>, <span class="comment">// 开启所有严格的类型检查</span></span><br><span class="line">    <span class="attr">&quot;alwaysStrict&quot;</span>: <span class="literal">true</span>, <span class="comment">// 在代码中注入&#x27;use strict&#x27;</span></span><br><span class="line">    <span class="attr">&quot;noImplicitAny&quot;</span>: <span class="literal">true</span>, <span class="comment">// 不允许隐式的any类型</span></span><br><span class="line">    <span class="attr">&quot;strictNullChecks&quot;</span>: <span class="literal">true</span>, <span class="comment">// 不允许把null、undefined赋值给其他类型的变量</span></span><br><span class="line">    <span class="attr">&quot;strictFunctionTypes&quot;</span>: <span class="literal">true</span>, <span class="comment">// 不允许函数参数双向协变</span></span><br><span class="line">    <span class="attr">&quot;strictPropertyInitialization&quot;</span>: <span class="literal">true</span>, <span class="comment">// 类的实例属性必须初始化</span></span><br><span class="line">    <span class="attr">&quot;strictBindCallApply&quot;</span>: <span class="literal">true</span>, <span class="comment">// 严格的bind/call/apply检查</span></span><br><span class="line">    <span class="attr">&quot;noImplicitThis&quot;</span>: <span class="literal">true</span>, <span class="comment">// 不允许this有隐式的any类型</span></span><br><span class="line">    <span class="attr">&quot;noUnusedLocals&quot;</span>: <span class="literal">true</span>, <span class="comment">// 检查只声明、未使用的局部变量(只提示不报错)</span></span><br><span class="line">    <span class="attr">&quot;noUnusedParameters&quot;</span>: <span class="literal">true</span>, <span class="comment">// 检查未使用的函数参数(只提示不报错)</span></span><br><span class="line">    <span class="attr">&quot;noFallthroughCasesInSwitch&quot;</span>: <span class="literal">true</span>, <span class="comment">// 防止switch语句贯穿(即如果没有break语句后面不会执行)</span></span><br><span class="line">    <span class="attr">&quot;noImplicitReturns&quot;</span>: <span class="literal">true</span>, <span class="comment">//每个分支都会有返回值</span></span><br><span class="line">    <span class="attr">&quot;esModuleInterop&quot;</span>: <span class="literal">true</span>, <span class="comment">// 允许export=导出，由import from 导入</span></span><br><span class="line">    <span class="attr">&quot;allowUmdGlobalAccess&quot;</span>: <span class="literal">true</span>, <span class="comment">// 允许在模块中全局变量的方式访问umd模块</span></span><br><span class="line">    <span class="attr">&quot;moduleResolution&quot;</span>: <span class="string">&quot;node&quot;</span>, <span class="comment">// 模块解析策略，ts默认用node的解析策略，即相对的方式导入</span></span><br><span class="line">    <span class="attr">&quot;baseUrl&quot;</span>: <span class="string">&quot;./&quot;</span>, <span class="comment">// 解析非相对模块的基地址，默认是当前目录</span></span><br><span class="line">    <span class="attr">&quot;paths&quot;</span>: &#123; <span class="comment">// 路径映射，相对于baseUrl</span></span><br><span class="line">      <span class="comment">// 如使用jq时不想使用默认版本，而需要手动指定版本，可进行如下配置</span></span><br><span class="line">      <span class="attr">&quot;jquery&quot;</span>: [<span class="string">&quot;node_modules/jquery/dist/jquery.min.js&quot;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;rootDirs&quot;</span>: [<span class="string">&quot;src&quot;</span>,<span class="string">&quot;out&quot;</span>], <span class="comment">// 将多个目录放在一个虚拟目录下，用于运行时，即编译后引入文件的位置可能发生变化，这也设置可以虚拟src和out在同一个目录下，不用再去改变路径也不会报错</span></span><br><span class="line">    <span class="attr">&quot;listEmittedFiles&quot;</span>: <span class="literal">true</span>, <span class="comment">// 打印输出文件</span></span><br><span class="line">    <span class="attr">&quot;listFiles&quot;</span>: <span class="literal">true</span><span class="comment">// 打印编译的文件(包括引用的声明文件)</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a name="wn91k"></a></p>
<h3 id="3-exclude"><a href="#3-exclude" class="headerlink" title="3. exclude"></a>3. exclude</h3><p><code>exclude</code> 属性作用是<strong>指定编译器需要排除的文件或文件夹。</strong><br />默认排除 <code>node_modules</code> 文件夹下文件。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">  <span class="attr">&quot;exclude&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;src/lib&quot;</span> <span class="comment">// 排除src目录下的lib文件夹下的文件不会编译</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>和 <code>include</code> 属性一样，支持 glob 通配符：</p>
<ul>
<li><code>*</code> 匹配0或多个字符（不包括目录分隔符）</li>
<li><code>?</code> 匹配一个任意字符（不包括目录分隔符）</li>
<li><code>**/</code> 递归匹配任意子目录</li>
</ul>
<p><a name="hzeaX"></a></p>
<h3 id="4-extends"><a href="#4-extends" class="headerlink" title="4. extends"></a>4. extends</h3><p><code>extends</code> 属性作用是<strong>引入其他配置文件，继承配置</strong>。<br />默认包含当前目录和子目录下所有 TypeScript 文件。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// 把基础配置抽离成tsconfig.base.json文件，然后引入</span></span><br><span class="line">	<span class="attr">&quot;extends&quot;</span>: <span class="string">&quot;./tsconfig.base.json&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><a name="XOcZH"></a></p>
<h3 id="5-files"><a href="#5-files" class="headerlink" title="5. files"></a>5. files</h3><p><code>files</code> 属性作用是<strong>指定需要编译的单个文件列表</strong>。<br />默认包含当前目录和子目录下所有 TypeScript 文件。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">  <span class="attr">&quot;files&quot;</span>: [</span><br><span class="line">    <span class="comment">// 指定编译文件是src目录下的leo.ts文件</span></span><br><span class="line">    <span class="string">&quot;scr/leo.ts&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><a name="coAd0"></a></p>
<h3 id="6-include"><a href="#6-include" class="headerlink" title="6. include"></a>6. include</h3><p><code>include</code> 属性作用是<strong>指定编译需要编译的文件或目录</strong>。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">  <span class="attr">&quot;include&quot;</span>: [</span><br><span class="line">    <span class="comment">// &quot;scr&quot; // 会编译src目录下的所有文件，包括子目录</span></span><br><span class="line">    <span class="comment">// &quot;scr/*&quot; // 只会编译scr一级目录下的文件</span></span><br><span class="line">    <span class="string">&quot;scr/*/*&quot;</span> <span class="comment">// 只会编译scr二级目录下的文件</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><a name="PonUH"></a></p>
<h3 id="7-references"><a href="#7-references" class="headerlink" title="7. references"></a>7. references</h3><p><code>references</code> 属性作用是<strong>指定工程引用依赖。</strong><br />在项目开发中，有时候我们为了方便将前端项目和后端<code>node</code>项目放在同一个目录下开发，两个项目依赖同一个配置文件和通用文件，但我们希望前后端项目进行灵活的分别打包，那么我们可以进行如下配置：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">  <span class="attr">&quot;references&quot;</span>: [ <span class="comment">// 指定依赖的工程</span></span><br><span class="line">     &#123;<span class="attr">&quot;path&quot;</span>: <span class="string">&quot;./common&quot;</span>&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><a name="9RACD"></a></p>
<h3 id="8-typeAcquisition"><a href="#8-typeAcquisition" class="headerlink" title="8. typeAcquisition"></a>8. typeAcquisition</h3><p><code>typeAcquisition</code> 属性作用是<strong>设置自动引入库类型定义文件(.d.ts)相关。</strong><br />包含 3 个子属性：</p>
<ul>
<li><code>enable</code>  : 布尔类型，是否开启自动引入库类型定义文件(.d.ts)，默认为 false；</li>
<li><code>include</code>  : 数组类型，允许自动引入的库名，如：[“jquery”, “lodash”]；</li>
<li><code>exculde</code>  : 数组类型，排除的库名。<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">  <span class="attr">&quot;typeAcquisition&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;enable&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">&quot;exclude&quot;</span>: [<span class="string">&quot;jquery&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;include&quot;</span>: [<span class="string">&quot;jest&quot;</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><a name="QqaRt"></a></p>
<h2 id="六、常见配置示例"><a href="#六、常见配置示例" class="headerlink" title="六、常见配置示例"></a>六、常见配置示例</h2><p>本部分内容中，我们找了几个实际开发中比较常见的配置，当然，还有很多配置需要自己摸索哟~~</p>
<p><a name="SzLQ8"></a></p>
<h3 id="1-移除代码中注释"><a href="#1-移除代码中注释" class="headerlink" title="1. 移除代码中注释"></a>1. 移除代码中注释</h3><p>tsconfig.json：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;removeComments&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译前：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回当前版本号</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getVersion</span>(<span class="params">version:<span class="built_in">string</span> = <span class="string">&quot;1.0.0&quot;</span></span>): <span class="title">string</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> version;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(getVersion(<span class="string">&quot;1.0.1&quot;</span>))</span><br></pre></td></tr></table></figure>
<p>编译结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getVersion</span>(<span class="params">version</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (version === <span class="keyword">void</span> <span class="number">0</span>) &#123; version = <span class="string">&quot;1.0.0&quot;</span>; &#125;</span><br><span class="line">    <span class="keyword">return</span> version;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(getVersion(<span class="string">&quot;1.0.1&quot;</span>));</span><br></pre></td></tr></table></figure>
<p><a name="m3sdZ"></a></p>
<h3 id="2-开启null、undefined检测"><a href="#2-开启null、undefined检测" class="headerlink" title="2. 开启null、undefined检测"></a>2. 开启null、undefined检测</h3><p>tsconfig.json：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;strictNullChecks&quot;</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改 <code>index.ts</code> 文件内容：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> leo;</span><br><span class="line">leo = <span class="keyword">new</span> Pingan(<span class="string">&#x27;leo&#x27;</span>,<span class="string">&#x27;hello&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><br />这时候编辑器也会提示错误信息，执行 <code>tsc</code> 后，控制台报错：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">src/index.ts:9:11 - error TS2304: Cannot find name <span class="string">&#x27;Pingan&#x27;</span>.</span><br><span class="line"></span><br><span class="line">9 leo = new Pingan(<span class="string">&#x27;leo&#x27;</span>,<span class="string">&#x27;hello&#x27;</span>);</span><br><span class="line"></span><br><span class="line">Found 1 error.</span><br></pre></td></tr></table></figure>


<p><a name="2kSjd"></a></p>
<h3 id="3-配置复用"><a href="#3-配置复用" class="headerlink" title="3. 配置复用"></a>3. 配置复用</h3><p>通过 <code>extends</code> 属性实现配置复用，即一个配置文件可以继承另一个文件的配置属性。<br />比如，建立一个基础的配置文件 <code>configs/base.json</code> ：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;noImplicitAny&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;strictNullChecks&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>tsconfig.json</code> 就可以引用这个文件的配置了：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;extends&quot;</span>: <span class="string">&quot;./configs/base&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;files&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;main.ts&quot;</span>,</span><br><span class="line">    <span class="string">&quot;supplemental.ts&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a name="shRlR"></a></p>
<h3 id="4-生成枚举的映射代码"><a href="#4-生成枚举的映射代码" class="headerlink" title="4. 生成枚举的映射代码"></a>4. 生成枚举的映射代码</h3><p>在默认情况下，使用 <code>const</code> 修饰符后，枚举不会生成映射代码。<br />如下，我们可以看出：使用 <code>const</code> 修饰符后，编译器不会生成任何 <code>RequestMethod</code> 枚举的任何映射代码，在其他地方使用时，内联每个成员的值，节省很大开销。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="built_in">enum</span> RequestMethod &#123;</span><br><span class="line">  Get,</span><br><span class="line">  Post,</span><br><span class="line">  Put,</span><br><span class="line">  Delete</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> methods = [</span><br><span class="line">  RequestMethod.Get,</span><br><span class="line">  RequestMethod.Post</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>编译结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> methods = [</span><br><span class="line">    <span class="number">0</span> <span class="comment">/* Get */</span>,</span><br><span class="line">    <span class="number">1</span> <span class="comment">/* Post */</span></span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<p>当然，我们希望生成映射代码时，也可以设置 <code>tsconfig.json</code> 中的配置，设置 <code>preserveConstEnums</code> 编译器选项为 <code>true</code> ：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;target&quot;</span>: <span class="string">&quot;es5&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;preserveConstEnums&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><br />最后编译结果变成：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> RequestMethod;</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">RequestMethod</span>) </span>&#123;</span><br><span class="line">    RequestMethod[RequestMethod[<span class="string">&quot;Get&quot;</span>] = <span class="number">0</span>] = <span class="string">&quot;Get&quot;</span>;</span><br><span class="line">    RequestMethod[RequestMethod[<span class="string">&quot;Post&quot;</span>] = <span class="number">1</span>] = <span class="string">&quot;Post&quot;</span>;</span><br><span class="line">    RequestMethod[RequestMethod[<span class="string">&quot;Put&quot;</span>] = <span class="number">2</span>] = <span class="string">&quot;Put&quot;</span>;</span><br><span class="line">    RequestMethod[RequestMethod[<span class="string">&quot;Delete&quot;</span>] = <span class="number">3</span>] = <span class="string">&quot;Delete&quot;</span>;</span><br><span class="line">&#125;)(RequestMethod || (RequestMethod = &#123;&#125;));</span><br><span class="line"><span class="keyword">let</span> methods = [</span><br><span class="line">    <span class="number">0</span> <span class="comment">/* Get */</span>,</span><br><span class="line">    <span class="number">1</span> <span class="comment">/* Post */</span></span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<p><a name="AxJpb"></a></p>
<h3 id="5-关闭-this-类型注解提示"><a href="#5-关闭-this-类型注解提示" class="headerlink" title="5. 关闭 this 类型注解提示"></a>5. 关闭 this 类型注解提示</h3><p>通过下面代码编译后会报错：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> button = <span class="built_in">document</span>.querySelector(<span class="string">&quot;button&quot;</span>);</span><br><span class="line">button?.addEventListener(<span class="string">&quot;click&quot;</span>, handleClick);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleClick</span>(<span class="params"><span class="built_in">this</span></span>) </span>&#123;</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">&quot;Clicked!&quot;</span>);</span><br><span class="line"> <span class="built_in">this</span>.removeEventListener(<span class="string">&quot;click&quot;</span>, handleClick);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><br />报错内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">src/index.ts:10:22 - error TS7006: Parameter <span class="string">&#x27;this&#x27;</span> implicitly has an <span class="string">&#x27;any&#x27;</span> <span class="built_in">type</span>.</span><br><span class="line">10 <span class="keyword">function</span> handleClick(this) &#123;</span><br><span class="line">Found 1 error.</span><br></pre></td></tr></table></figure>

<p><br />这是因为 <code>this</code> 隐式具有 <code>any</code> 类型，如果没有指定类型注解，编译器会提示“”this” 隐式具有类型 “any”，因为它没有类型注释。”。<br /><br><br />解决方法有2种：</p>
<ol>
<li>指定 this 类型，如本代码中为 <code>HTMLElement</code> 类型：</li>
</ol>
<p><code>HTMLElement</code> 接口表示所有的 HTML 元素。一些HTML元素直接实现了 <code>HTMLElement</code> 接口，其它的间接实现<code>HTMLElement</code>接口。<br />关于<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLElement"> HTMLElement </a>可查看详细。<br /></p>
<ol start="2">
<li>使用 <code>--noImplicitThis</code> 配置项： </li>
</ol>
<p><br />在 TS2.0 还增加一个新的编译选项： <code>--noImplicitThis</code>，表示当 <code>this</code> 表达式值为 <code>any</code> 类型时生成一个错误信息。我们设置为 <code>true</code> 后就能正常编译。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;noImplicitThis&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a name="vPiTf"></a></p>
<h2 id="七、Webpack-React-中使用示例"><a href="#七、Webpack-React-中使用示例" class="headerlink" title="七、Webpack/React 中使用示例"></a>七、Webpack/React 中使用示例</h2><p><a name="9l17W"></a></p>
<h3 id="1-配置编译-ES6-代码，JSX-文件"><a href="#1-配置编译-ES6-代码，JSX-文件" class="headerlink" title="1. 配置编译 ES6 代码，JSX 文件"></a>1. 配置编译 ES6 代码，JSX 文件</h3><p>创建测试项目 webpack-demo，结构如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">webpack-demo/</span><br><span class="line">  |- package.json</span><br><span class="line">  |- tsconfig.json</span><br><span class="line">  |- webpack.config.js</span><br><span class="line">  |- /dist</span><br><span class="line">    |- bundle.js</span><br><span class="line">    |- index.html</span><br><span class="line">  |- /src</span><br><span class="line">    |- index.js</span><br><span class="line">    |- index.ts</span><br><span class="line">  |- /node_modules</span><br></pre></td></tr></table></figure>
<p>安装 TypeScript 和 ts-loader：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save-dev typescript ts-loader</span><br></pre></td></tr></table></figure>
<p>配置 tsconfig.json，支持 JSX，并将 TypeScript 编译为 ES5：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;compilerOptions&quot;: &#123;</span><br><span class="line">    &quot;outDir&quot;: &quot;./dist/&quot;,</span><br><span class="line">    &quot;noImplicitAny&quot;: true,</span><br><span class="line"><span class="addition">+   &quot;module&quot;: &quot;es6&quot;,</span></span><br><span class="line"><span class="addition">+   &quot;target&quot;: &quot;es5&quot;,</span></span><br><span class="line"><span class="addition">+   &quot;jsx&quot;: &quot;react&quot;,</span></span><br><span class="line">    &quot;allowJs&quot;: true</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>还需要配置 webpack.config.js，使其能够处理 TypeScript 代码，这里主要在 <code>rules</code> 中添加 <code>ts-loader</code> ：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/index.ts&#x27;</span>,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.tsx?$/</span>,</span><br><span class="line">        use: <span class="string">&#x27;ts-loader&#x27;</span>,</span><br><span class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">extensions</span>: [ <span class="string">&#x27;.tsx&#x27;</span>, <span class="string">&#x27;.ts&#x27;</span>, <span class="string">&#x27;.js&#x27;</span> ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;bundle.js&#x27;</span>,</span><br><span class="line">    <span class="attr">path</span>: path.resolve(__dirname, <span class="string">&#x27;dist&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>


<p><a name="uSzYa"></a></p>
<h3 id="2-配置-source-map"><a href="#2-配置-source-map" class="headerlink" title="2. 配置 source map"></a>2. 配置 source map</h3><p>想要启用 source map，我们必须配置 TypeScript，以将内联的 source map 输出到编译后的 JavaScript 文件中。<br />只需要在 tsconfig.json 中配置 sourceMap 属性：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">  &#123;</span><br><span class="line">    &quot;compilerOptions&quot;: &#123;</span><br><span class="line">      &quot;outDir&quot;: &quot;./dist/&quot;,</span><br><span class="line"><span class="addition">+     &quot;sourceMap&quot;: true,</span></span><br><span class="line">      &quot;noImplicitAny&quot;: true,</span><br><span class="line">      &quot;module&quot;: &quot;commonjs&quot;,</span><br><span class="line">      &quot;target&quot;: &quot;es5&quot;,</span><br><span class="line">      &quot;jsx&quot;: &quot;react&quot;,</span><br><span class="line">      &quot;allowJs&quot;: true</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>然后配置 webpack.config.js 文件，让 webpack 提取 source map，并内联到最终的 bundle 中：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">  const path = require(&#x27;path&#x27;);</span><br><span class="line"></span><br><span class="line">  module.exports = &#123;</span><br><span class="line">    entry: &#x27;./src/index.ts&#x27;,</span><br><span class="line"><span class="addition">+   devtool: &#x27;inline-source-map&#x27;,</span></span><br><span class="line">    module: &#123;</span><br><span class="line">      rules: [</span><br><span class="line">        &#123;</span><br><span class="line">          test: /\.tsx?$/,</span><br><span class="line">          use: &#x27;ts-loader&#x27;,</span><br><span class="line">          exclude: /node_modules/</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    resolve: &#123;</span><br><span class="line">      extensions: [ &#x27;.tsx&#x27;, &#x27;.ts&#x27;, &#x27;.js&#x27; ]</span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: &#x27;bundle.js&#x27;,</span><br><span class="line">      path: path.resolve(__dirname, &#x27;dist&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>
<p><a name="jIliq"></a></p>
<h2 id="八、总结"><a href="#八、总结" class="headerlink" title="八、总结"></a>八、总结</h2><p>本文较全面介绍了 tsconfig.json 文件的知识，从“什么是 tsconfig.js 文件”开始，一步步带领大家全面认识 tsconfig.json 文件。<br />文中通过一个简单 learnTsconfig 项目，让大家知道项目中如何使用 tsconfig.json 文件。在后续文章中，我们将这么多的配置项进行分类学习。最后通过几个常见配置示例，解决我们开发中遇到的几个常见问题。<br /><br><br />当然，本文篇幅有限，无法针对每个属性进行深入介绍，这就需要大家在实际开发中，多去尝试和使用啦~<br /></p>
<p><a name="HIZQm"></a></p>
<h2 id="九、学习和参考资料"><a href="#九、学习和参考资料" class="headerlink" title="九、学习和参考资料"></a>九、学习和参考资料</h2><p><br />1.<a target="_blank" rel="noopener" href="https://www.typescriptlang.org/tsconfig">《Intro to the TSConfig Reference》</a> <br />2.<a target="_blank" rel="noopener" href="https://www.tslang.cn/docs/handbook/tsconfig-json.html">《tsconfig.json》</a> <br />3.<a target="_blank" rel="noopener" href="http://json.schemastore.org/tsconfig">《TypeScript编译器的配置文件的JSON模式》</a><br />4.<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/0383bbd61a6b">《详解TypeScript项目中的tsconfig.json配置》</a> <br />5.<a target="_blank" rel="noopener" href="https://www.typescriptlang.org/docs/handbook/compiler-options.html">《官方完整的编译选项列表》</a><br /></p>
<h2 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h2><table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#x70;&#105;&#x6e;&#x67;&#97;&#x6e;&#x38;&#55;&#56;&#55;&#x40;&#x71;&#113;&#x2e;&#x63;&#111;&#109;">&#x70;&#105;&#x6e;&#x67;&#97;&#x6e;&#x38;&#55;&#56;&#55;&#x40;&#x71;&#113;&#x2e;&#x63;&#111;&#109;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>ES小册</td>
<td>js.pingan8787.com</td>
</tr>
<tr>
<td>语雀知识库</td>
<td><a target="_blank" rel="noopener" href="https://www.yuque.com/wangpingan/cute-frontend">Cute-FrontEnd</a></td>
</tr>
</tbody></table>
<p><img src="http://images.pingan8787.com/2019_07_12guild_page.png" alt="bg">  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/06/17/208-%E3%80%90TyeScript%E3%80%91%E4%BA%86%E4%B8%8D%E8%B5%B7%E7%9A%84tsconfig-json%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97/" data-id="ckts3ejys00n74d9k0xiucl42" data-title="208-【TyeScript】了不起的tsconfig.json学习指南" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TyeScript/" rel="tag">TyeScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag">读书笔记</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Angular/" rel="tag">Angular</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/" rel="tag">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS%E5%8A%A8%E7%94%BB/" rel="tag">CSS动画</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Chrome/" rel="tag">Chrome</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES6-ES7-ES8/" rel="tag">ES6/ES7/ES8</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Eslint/" rel="tag">Eslint</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Express/" rel="tag">Express</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GraphQL/" rel="tag">GraphQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/H5/" rel="tag">H5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML/" rel="tag">HTML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/" rel="tag">HTTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP%E5%8D%8F%E8%AE%AE/" rel="tag">HTTP协议</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hybrid/" rel="tag">Hybrid</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NPM/" rel="tag">NPM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nodejs/" rel="tag">Nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Numpy/" rel="tag">Numpy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/" rel="tag">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tensorflow/" rel="tag">Tensorflow</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TyeScript/" rel="tag">TyeScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TypeScript/" rel="tag">TypeScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vuejs/" rel="tag">Vuejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebSocket/" rel="tag">WebSocket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Webpack/" rel="tag">Webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/demo/" rel="tag">demo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" rel="tag">中间件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" rel="tag">人工智能</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/" rel="tag">全栈开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E6%8E%A2%E7%B4%A2/" rel="tag">前端探索</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E7%9F%A5%E4%B9%8E%E7%B3%BB%E5%88%97/" rel="tag">前端知乎系列</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B8%B8%E7%94%A8%E6%8A%80%E6%9C%AF/" rel="tag">常用技术</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BE%AE%E5%89%8D%E7%AB%AF/" rel="tag">微前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%BB%E7%BB%93/" rel="tag">总结</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/" rel="tag">构建工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" rel="tag">正则表达式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BA%90%E7%A0%81/" rel="tag">源码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BA%90%E7%A0%81%E7%B2%BE%E8%AF%BB/" rel="tag">源码精读</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%83%AD%E9%97%A8/" rel="tag">热门</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%94%9F%E6%B4%BB%E6%9D%82%E8%AE%B0/" rel="tag">生活杂记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/" rel="tag">编译原理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/" rel="tag">网络请求</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag">读书笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%87%8D%E6%B8%A9%E5%9F%BA%E7%A1%80/" rel="tag">重温基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" rel="tag">面试题</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Angular/" style="font-size: 11.88px;">Angular</a> <a href="/tags/CSS/" style="font-size: 18.13px;">CSS</a> <a href="/tags/CSS%E5%8A%A8%E7%94%BB/" style="font-size: 12.5px;">CSS动画</a> <a href="/tags/Chrome/" style="font-size: 10px;">Chrome</a> <a href="/tags/ES6-ES7-ES8/" style="font-size: 10.63px;">ES6/ES7/ES8</a> <a href="/tags/Eslint/" style="font-size: 10px;">Eslint</a> <a href="/tags/Express/" style="font-size: 10px;">Express</a> <a href="/tags/GraphQL/" style="font-size: 10px;">GraphQL</a> <a href="/tags/H5/" style="font-size: 10px;">H5</a> <a href="/tags/HTML/" style="font-size: 10px;">HTML</a> <a href="/tags/HTTP/" style="font-size: 11.88px;">HTTP</a> <a href="/tags/HTTP%E5%8D%8F%E8%AE%AE/" style="font-size: 11.25px;">HTTP协议</a> <a href="/tags/Hybrid/" style="font-size: 10.63px;">Hybrid</a> <a href="/tags/JavaScript/" style="font-size: 19.38px;">JavaScript</a> <a href="/tags/NPM/" style="font-size: 10px;">NPM</a> <a href="/tags/Nodejs/" style="font-size: 11.25px;">Nodejs</a> <a href="/tags/Numpy/" style="font-size: 10.63px;">Numpy</a> <a href="/tags/Python/" style="font-size: 17.5px;">Python</a> <a href="/tags/React/" style="font-size: 12.5px;">React</a> <a href="/tags/Tensorflow/" style="font-size: 10.63px;">Tensorflow</a> <a href="/tags/TyeScript/" style="font-size: 10px;">TyeScript</a> <a href="/tags/TypeScript/" style="font-size: 11.25px;">TypeScript</a> <a href="/tags/Vuejs/" style="font-size: 14.38px;">Vuejs</a> <a href="/tags/WebSocket/" style="font-size: 10px;">WebSocket</a> <a href="/tags/Webpack/" style="font-size: 15.63px;">Webpack</a> <a href="/tags/demo/" style="font-size: 10.63px;">demo</a> <a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 10px;">中间件</a> <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" style="font-size: 16.25px;">人工智能</a> <a href="/tags/%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/" style="font-size: 11.25px;">全栈开发</a> <a href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" style="font-size: 20px;">前端开发</a> <a href="/tags/%E5%89%8D%E7%AB%AF%E6%8E%A2%E7%B4%A2/" style="font-size: 11.25px;">前端探索</a> <a href="/tags/%E5%89%8D%E7%AB%AF%E7%9F%A5%E4%B9%8E%E7%B3%BB%E5%88%97/" style="font-size: 10.63px;">前端知乎系列</a> <a href="/tags/%E5%8E%9F%E5%88%9B/" style="font-size: 18.75px;">原创</a> <a href="/tags/%E5%B8%B8%E7%94%A8%E6%8A%80%E6%9C%AF/" style="font-size: 10.63px;">常用技术</a> <a href="/tags/%E5%BE%AE%E5%89%8D%E7%AB%AF/" style="font-size: 10px;">微前端</a> <a href="/tags/%E6%80%BB%E7%BB%93/" style="font-size: 13.75px;">总结</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 10px;">数据结构</a> <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" style="font-size: 15px;">机器学习</a> <a href="/tags/%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/" style="font-size: 10.63px;">构建工具</a> <a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 10.63px;">正则表达式</a> <a href="/tags/%E6%BA%90%E7%A0%81/" style="font-size: 10px;">源码</a> <a href="/tags/%E6%BA%90%E7%A0%81%E7%B2%BE%E8%AF%BB/" style="font-size: 10px;">源码精读</a> <a href="/tags/%E7%83%AD%E9%97%A8/" style="font-size: 10px;">热门</a> <a href="/tags/%E7%94%9F%E6%B4%BB%E6%9D%82%E8%AE%B0/" style="font-size: 10px;">生活杂记</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 13.13px;">算法</a> <a href="/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/" style="font-size: 10px;">编译原理</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/" style="font-size: 10px;">网络请求</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 15px;">设计模式</a> <a href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" style="font-size: 14.38px;">读书笔记</a> <a href="/tags/%E9%87%8D%E6%B8%A9%E5%9F%BA%E7%A1%80/" style="font-size: 16.88px;">重温基础</a> <a href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" style="font-size: 10px;">面试题</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/07/28/227-%E3%80%90%E6%80%BB%E7%BB%93%E3%80%91%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E5%9C%A8%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%BD%BF%E7%94%A8SVG%E5%AD%97%E4%BD%93%E5%9B%BE%E6%A0%87/">227-【总结】如何优雅的在微信小程序使用SVG字体图标</a>
          </li>
        
          <li>
            <a href="/2021/07/28/226-%E3%80%90HTTP%E3%80%91%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E7%AE%A1%E7%90%86HTTP%E8%AF%B7%E6%B1%82%E5%92%8C%E5%93%8D%E5%BA%94%E6%8B%A6%E6%88%AA%E5%99%A8%EF%BC%9F/">226-【HTTP】如何优雅的管理HTTP请求和响应拦截器？</a>
          </li>
        
          <li>
            <a href="/2021/07/28/225-%E3%80%90Vue%E3%80%91%E4%BB%8E%E6%89%8B%E5%86%99Vue3%E7%9A%84Reactivity%E5%BC%80%E5%A7%8B%E6%B7%B1%E5%85%A5Vue3%E6%BA%90%E7%A0%81/">225-【Vue】从手写Vue3的Reactivity开始深入Vue3源码</a>
          </li>
        
          <li>
            <a href="/2021/05/30/224-%E3%80%90Chrome%E3%80%915%E4%B8%AAChrome%E8%B0%83%E8%AF%95%E6%B7%B7%E5%90%88%E5%BA%94%E7%94%A8%E7%9A%84%E6%8A%80%E5%B7%A7/">224-【Chrome】5个Chrome调试混合应用的技巧</a>
          </li>
        
          <li>
            <a href="/2021/03/19/223-%E3%80%90%E5%89%8D%E7%AB%AF%E6%8E%A2%E7%B4%A2%E3%80%91%E6%8E%A2%E7%B4%A2Snabbdom%E6%A8%A1%E5%9D%97%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/">223-【前端探索】探索Snabbdom模块系统原理</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>