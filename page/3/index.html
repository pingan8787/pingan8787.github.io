<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/3/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-207-ã€Webpackã€‘äº†ä¸èµ·çš„Webpack-HMRå­¦ä¹ æŒ‡å—ï¼ˆå«æºç åˆ†æï¼‰" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/06/17/207-%E3%80%90Webpack%E3%80%91%E4%BA%86%E4%B8%8D%E8%B5%B7%E7%9A%84Webpack-HMR%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97%EF%BC%88%E5%90%AB%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%89/" class="article-date">
  <time class="dt-published" datetime="2020-06-16T16:12:05.000Z" itemprop="datePublished">2020-06-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/06/17/207-%E3%80%90Webpack%E3%80%91%E4%BA%86%E4%B8%8D%E8%B5%B7%E7%9A%84Webpack-HMR%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97%EF%BC%88%E5%90%AB%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%89/">207-ã€Webpackã€‘äº†ä¸èµ·çš„ Webpack HMR å­¦ä¹ æŒ‡å—ï¼ˆå«æºç åˆ†æï¼‰</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>å­¦ä¹ æ—¶é—´ï¼š2020.06.14<br />å­¦ä¹ ç« èŠ‚ï¼š<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/30669007">ã€ŠWebpack HMR åŸç†è§£æã€‹</a><br /><img src="http://images.pingan8787.com/Webpack-HMR/Webpack-HMR-Xmind.png" alt="äº†ä¸èµ·çš„ Webpack HMR å­¦ä¹ æŒ‡å—.png"></p>
<h1 id="ä¸€ã€HMR-ä»‹ç»"><a href="#ä¸€ã€HMR-ä»‹ç»" class="headerlink" title="ä¸€ã€HMR ä»‹ç»"></a>ä¸€ã€HMR ä»‹ç»</h1><p>Hot Module Replacementï¼ˆä»¥ä¸‹ç®€ç§°ï¼šHMR æ¨¡å—çƒ­æ›¿æ¢ï¼‰æ˜¯ Webpack æä¾›çš„ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„åŠŸèƒ½ï¼Œ<strong>å®ƒå…è®¸åœ¨ JavaScript è¿è¡Œæ—¶æ›´æ–°å„ç§æ¨¡å—ï¼Œè€Œæ— éœ€å®Œå…¨åˆ·æ–°</strong>ã€‚</p>
<blockquote>
<p>Hot Module Replacement (or HMR) is one of the most useful features offered by webpack. It allows all kinds of modules to be updated at runtime without the need for a full refresh.<br>â€“ã€ŠHot Module Replacementã€‹</p>
</blockquote>
<p>å½“æˆ‘ä»¬ä¿®æ”¹ä»£ç å¹¶ä¿å­˜åï¼ŒWebpack å°†å¯¹ä»£ç é‡æ–°æ‰“åŒ…ï¼ŒHMR ä¼šåœ¨åº”ç”¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­æ›¿æ¢ã€æ·»åŠ æˆ–åˆ é™¤æ¨¡å—ï¼Œè€Œæ— éœ€é‡æ–°åŠ è½½æ•´ä¸ªé¡µé¢ã€‚<br />HMR ä¸»è¦é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼Œæ¥æ˜¾è‘—åŠ å¿«å¼€å‘é€Ÿåº¦ï¼š</p>
<ul>
<li>ä¿ç•™åœ¨å®Œå…¨é‡æ–°åŠ è½½é¡µé¢æ—¶ä¸¢å¤±çš„åº”ç”¨ç¨‹åºçŠ¶æ€ï¼›</li>
<li>åªæ›´æ–°å˜æ›´å†…å®¹ï¼Œä»¥èŠ‚çœå®è´µçš„å¼€å‘æ—¶é—´ï¼›</li>
<li>è°ƒæ•´æ ·å¼æ›´åŠ å¿«é€Ÿ - å‡ ä¹ç›¸å½“äºåœ¨æµè§ˆå™¨è°ƒè¯•å™¨ä¸­æ›´æ”¹æ ·å¼ã€‚</li>
</ul>
<p><strong>éœ€è¦æ³¨æ„</strong>ï¼šHMR ä¸é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œè¿™æ„å‘³ç€å®ƒåº”å½“åªåœ¨å¼€å‘ç¯å¢ƒä½¿ç”¨ã€‚<br /></p>
<h1 id="äºŒã€HMR-ä½¿ç”¨æ–¹å¼"><a href="#äºŒã€HMR-ä½¿ç”¨æ–¹å¼" class="headerlink" title="äºŒã€HMR ä½¿ç”¨æ–¹å¼"></a>äºŒã€HMR ä½¿ç”¨æ–¹å¼</h1><p>åœ¨ Webpack ä¸­å¯ç”¨ HMR åŠŸèƒ½æ¯”è¾ƒç®€å•ï¼š</p>
<h2 id="1-æ–¹å¼ä¸€ï¼šä½¿ç”¨-devServer"><a href="#1-æ–¹å¼ä¸€ï¼šä½¿ç”¨-devServer" class="headerlink" title="1. æ–¹å¼ä¸€ï¼šä½¿ç”¨ devServer"></a>1. æ–¹å¼ä¸€ï¼šä½¿ç”¨ devServer</h2><h3 id="1-1-è®¾ç½®-devServer-é€‰é¡¹"><a href="#1-1-è®¾ç½®-devServer-é€‰é¡¹" class="headerlink" title="1.1 è®¾ç½® devServer é€‰é¡¹"></a>1.1 è®¾ç½® devServer é€‰é¡¹</h3><p>åªéœ€è¦åœ¨ <code>webpack.config.js</code>Â ä¸­æ·»åŠ  <code>devServer</code>Â é€‰é¡¹ï¼Œå¹¶è®¾ç½® <code>hot</code>Â å€¼ä¸º <code>true</code>Â ï¼Œå¹¶ä½¿ç”¨<code>HotModuleReplacementPlugin</code>Â å’Œ <code>NamedModulesPlugin</code> ï¼ˆå¯é€‰ï¼‰ä¸¤ä¸ª Plugins ï¼š</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// webpack.config.js</span><br><span class="line"></span><br><span class="line">const path = require(&#x27;path&#x27;)</span><br><span class="line">const webpack = require(&#x27;webpack&#x27;)</span><br><span class="line">module.exports = &#123;</span><br><span class="line">	entry: &#x27;./index.js&#x27;,</span><br><span class="line">	output: &#123;</span><br><span class="line">		filename: &#x27;bundle.js&#x27;,</span><br><span class="line">		path: path.join(__dirname, &#x27;/&#x27;)</span><br><span class="line">	&#125;,</span><br><span class="line"><span class="addition">+	devServer: &#123;</span></span><br><span class="line"><span class="addition">+		hot: true,   // å¯åŠ¨æ¨¡å—çƒ­æ›´æ–° HMR</span></span><br><span class="line"><span class="addition">+   open: true,  // å¼€å¯è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨é¡µé¢</span></span><br><span class="line"><span class="addition">+	&#125;,</span></span><br><span class="line">  plugins: [</span><br><span class="line"><span class="addition">+   new webpack.NamedModulesPlugin(),</span></span><br><span class="line"><span class="addition">+   new webpack.HotModuleReplacementPlugin()</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-2-æ·»åŠ -scripts"><a href="#1-2-æ·»åŠ -scripts" class="headerlink" title="1.2 æ·»åŠ  scripts"></a>1.2 æ·»åŠ  scripts</h3><p>ç„¶ååœ¨ <code>package.json</code>Â ä¸­ä¸º <code>scripts</code>Â å‘½ä»¤å³å¯ï¼š</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// package.json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  // ...</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line"><span class="addition">+    &quot;start&quot;: &quot;webpack-dev-server&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-æ–¹å¼äºŒã€ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°"><a href="#2-æ–¹å¼äºŒã€ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°" class="headerlink" title="2. æ–¹å¼äºŒã€ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°"></a>2. æ–¹å¼äºŒã€ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°</h2><p>å¦ä¸€ç§æ˜¯é€šè¿‡æ·»åŠ  <code>--hot</code>Â å‚æ•°æ¥å®ç°ã€‚æ·»åŠ  <code>--hot</code>Â å‚æ•°åï¼ŒdevServer ä¼šå‘Šè¯‰ Webpack è‡ªåŠ¨å¼•å…¥ <code>HotModuleReplacementPlugin</code> ï¼Œè€Œä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å¼•å…¥ã€‚<br />å¦å¤–å¸¸å¸¸ä¹Ÿæ­é… <code>--open</code>Â æ¥è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨åˆ°é¡µé¢ã€‚<br />è¿™é‡Œç§»é™¤æ‰å‰é¢æ·»åŠ çš„ä¸¤ä¸ª Plugins ï¼š</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// webpack.config.js</span><br><span class="line"></span><br><span class="line">const path = require(&#x27;path&#x27;)</span><br><span class="line">const webpack = require(&#x27;webpack&#x27;)</span><br><span class="line">module.exports = &#123;</span><br><span class="line">	// ...</span><br><span class="line"><span class="deletion">- plugins: [</span></span><br><span class="line"><span class="deletion">-   new webpack.NamedModulesPlugin(),</span></span><br><span class="line"><span class="deletion">-   new webpack.HotModuleReplacementPlugin()</span></span><br><span class="line"><span class="deletion">- ]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åä¿®æ”¹ <code>package.json</code>Â æ–‡ä»¶ä¸­çš„ <code>scripts</code>Â é…ç½®ï¼š</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// package.json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  // ...</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line"><span class="deletion">-    &quot;start&quot;: &quot;webpack-dev-server&quot;</span></span><br><span class="line"><span class="addition">+    &quot;start&quot;: &quot;webpack-dev-server --hot --open&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-ç®€å•ç¤ºä¾‹"><a href="#3-ç®€å•ç¤ºä¾‹" class="headerlink" title="3. ç®€å•ç¤ºä¾‹"></a>3. ç®€å•ç¤ºä¾‹</h2><p>åŸºäºä¸Šè¿°é…ç½®ï¼Œæˆ‘ä»¬ç®€å•å®ç°ä¸€ä¸ªåœºæ™¯ï¼š <code>index.js</code>Â æ–‡ä»¶ä¸­å¯¼å…¥ <code>hello.js</code>Â æ¨¡å—ï¼Œå½“ <code>hello.js</code>Â æ¨¡å—å‘ç”Ÿå˜åŒ–æ—¶ï¼Œ <code>index.js</code>Â å°†æ›´æ–°æ¨¡å—ã€‚<br><br />æ¨¡å—ä»£ç å¦‚ä¸‹å®ç°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hello.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; <span class="string">&#x27;hi leo!&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> hello <span class="keyword">from</span> <span class="string">&#x27;./hello.js&#x27;</span></span><br><span class="line"><span class="keyword">const</span> div = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">div.innerHTML = hello();</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.body.appendChild(div);</span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨ <code>index.html</code>Â ä¸­å¯¼å…¥æ‰“åŒ…åçš„ JS æ–‡ä»¶ï¼Œå¹¶æ‰§è¡Œ <code>npm start</code>Â è¿è¡Œé¡¹ç›®ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span>&gt;</span>äº†ä¸èµ·çš„ Webpack HMR å­¦ä¹ æŒ‡å—<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;bundle.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="4-å®ç°ç›‘å¬æ›´æ–°"><a href="#4-å®ç°ç›‘å¬æ›´æ–°" class="headerlink" title="4. å®ç°ç›‘å¬æ›´æ–°"></a>4. å®ç°ç›‘å¬æ›´æ–°</h2><p>å½“æˆ‘ä»¬é€šè¿‡ <code>HotModuleReplacementPlugin</code>Â  æ’ä»¶å¯ç”¨äº† HMRï¼Œåˆ™å®ƒçš„æ¥å£å°†è¢«æš´éœ²åœ¨å…¨å±€ <code>module.hot</code>Â  å±æ€§ä¸‹é¢ã€‚é€šå¸¸ï¼Œå¯ä»¥å…ˆæ£€æŸ¥è¿™ä¸ªæ¥å£æ˜¯å¦å¯è®¿é—®ï¼Œç„¶åå†å¼€å§‹ä½¿ç”¨å®ƒã€‚<br />ä¸¾ä¸ªä¾‹å­ï¼Œä½ å¯ä»¥è¿™æ · <code>accept</code>Â  ä¸€ä¸ªæ›´æ–°çš„æ¨¡å—ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">  <span class="built_in">module</span>.hot.accept(<span class="string">&#x27;./library.js&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨æ›´æ–°è¿‡çš„ library æ¨¡å—æ‰§è¡ŒæŸäº›æ“ä½œ...</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…³äº <code>module.hot</code>Â æ›´å¤š API ï¼Œå¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£<a target="_blank" rel="noopener" href="https://webpack.js.org/api/hot-module-replacement/">ã€ŠHot Module Replacement APIã€‹</a>Â ã€‚<br><br />å›åˆ°ä¸Šé¢ç¤ºä¾‹ï¼Œæˆ‘ä»¬æµ‹è¯•æ›´æ–°æ¨¡å—çš„åŠŸèƒ½ã€‚<br />è¿™æ—¶æˆ‘ä»¬ä¿®æ”¹ <code>index.js</code>Â ä»£ç ï¼Œæ¥ç›‘å¬ <code>hello.js</code>Â æ¨¡å—ä¸­çš„æ›´æ–°ï¼š</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import hello from &#x27;./hello.js&#x27;;</span><br><span class="line">const div = document.createElement(&#x27;div&#x27;);</span><br><span class="line">div.innerHTML = hello();</span><br><span class="line">document.body.appendChild(div);</span><br><span class="line"></span><br><span class="line"><span class="addition">+ if (module.hot) &#123;</span></span><br><span class="line"><span class="addition">+   module.hot.accept(&#x27;./hello.js&#x27;, function() &#123;</span></span><br><span class="line"><span class="addition">+     console.log(&#x27;ç°åœ¨åœ¨æ›´æ–° hello æ¨¡å—äº†~&#x27;);</span></span><br><span class="line"><span class="addition">+     div.innerHTML = hello();</span></span><br><span class="line"><span class="addition">+   &#125;)</span></span><br><span class="line"><span class="addition">+ &#125;</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åä¿®æ”¹ <code>hello.js</code>Â æ–‡ä»¶å†…å®¹ï¼Œæµ‹è¯•æ•ˆæœï¼š</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">- export default () =&gt; &#x27;hi leo!&#x27;;</span></span><br><span class="line"><span class="addition">+ export default () =&gt; &#x27;hi leo! hello world&#x27;;</span></span><br></pre></td></tr></table></figure>
<p>å½“æˆ‘ä»¬ä¿å­˜ä»£ç æ—¶ï¼Œæ§åˆ¶å°è¾“å‡º <code>&quot;ç°åœ¨åœ¨æ›´æ–° helloæ¨¡å—äº†~&quot;</code>Â ï¼Œå¹¶ä¸”é¡µé¢ä¸­ <code>&quot;hi leo!&quot;</code>Â ä¹Ÿæ›´æ–°ä¸º <code>&quot;hi leo! hello world&quot;</code>Â ï¼Œè¯æ˜æˆ‘ä»¬ç›‘å¬åˆ°æ–‡ä»¶æ›´æ–°äº†ã€‚<br /><img src="http://images.pingan8787.com/Webpack-HMR/Webpack-HMR-demo1.png" alt="image.png"><br /><br><br />ç®€å• Webpack HMR ä½¿ç”¨æ–¹å¼å°±ä»‹ç»åˆ°è¿™ï¼Œæ›´å¤šä»‹ç»ï¼Œè¿˜è¯·é˜…è¯»å®˜æ–¹æ–‡æ¡£<a target="_blank" rel="noopener" href="https://webpack.js.org/guides/hot-module-replacement/">ã€ŠHot Module Replacementã€‹</a>ã€‚<br /></p>
<h2 id="5-devServer-å¸¸ç”¨é…ç½®å’ŒæŠ€å·§"><a href="#5-devServer-å¸¸ç”¨é…ç½®å’ŒæŠ€å·§" class="headerlink" title="5. devServer å¸¸ç”¨é…ç½®å’ŒæŠ€å·§"></a>5. devServer å¸¸ç”¨é…ç½®å’ŒæŠ€å·§</h2><h3 id="5-1-å¸¸ç”¨é…ç½®"><a href="#5-1-å¸¸ç”¨é…ç½®" class="headerlink" title="5.1 å¸¸ç”¨é…ç½®"></a>5.1 å¸¸ç”¨é…ç½®</h3><p>æ ¹æ®ç›®å½•ç»“æ„çš„ä¸åŒï¼Œ<code>contentBase</code>ã€<code>openPage</code> å‚æ•°è¦é…ç½®åˆé€‚çš„å€¼ï¼Œå¦åˆ™è¿è¡Œæ—¶åº”è¯¥ä¸ä¼šç«‹åˆ»è®¿é—®åˆ°ä½ çš„é¦–é¡µã€‚ åŒæ—¶è¦æ³¨æ„ä½ çš„ <code>publicPath</code>ï¼Œé™æ€èµ„æºæ‰“åŒ…åç”Ÿæˆçš„è·¯å¾„æ˜¯ä¸€ä¸ªéœ€è¦æ€è€ƒçš„ç‚¹ï¼Œå–å†³äºä½ çš„ç›®å½•ç»“æ„ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">devServer: &#123;</span><br><span class="line">  <span class="attr">contentBase</span>: path.join(__dirname, <span class="string">&#x27;static&#x27;</span>),    <span class="comment">// å‘Šè¯‰æœåŠ¡å™¨ä»å“ªé‡Œæä¾›å†…å®¹(é»˜è®¤å½“å‰å·¥ä½œç›®å½•)</span></span><br><span class="line">  <span class="attr">openPage</span>: <span class="string">&#x27;views/index.html&#x27;</span>,  <span class="comment">// æŒ‡å®šé»˜è®¤å¯åŠ¨æµè§ˆå™¨æ—¶æ‰“å¼€çš„é¡µé¢</span></span><br><span class="line">  <span class="attr">index</span>: <span class="string">&#x27;views/index.html&#x27;</span>,  <span class="comment">// æŒ‡å®šé¦–é¡µä½ç½®</span></span><br><span class="line">  <span class="attr">watchContentBase</span>: <span class="literal">true</span>, <span class="comment">// contentBaseä¸‹æ–‡ä»¶å˜åŠ¨å°†reloadé¡µé¢(é»˜è®¤false)</span></span><br><span class="line">  <span class="attr">host</span>: <span class="string">&#x27;localhost&#x27;</span>, <span class="comment">// é»˜è®¤localhost,æƒ³å¤–éƒ¨å¯è®¿é—®ç”¨&#x27;0.0.0.0&#x27;</span></span><br><span class="line">  <span class="attr">port</span>: <span class="number">8080</span>, <span class="comment">// é»˜è®¤8080</span></span><br><span class="line">  <span class="attr">inline</span>: <span class="literal">true</span>, <span class="comment">// å¯ä»¥ç›‘æ§jså˜åŒ–</span></span><br><span class="line">  <span class="attr">hot</span>: <span class="literal">true</span>, <span class="comment">// çƒ­å¯åŠ¨</span></span><br><span class="line">  <span class="attr">open</span>: <span class="literal">true</span>, <span class="comment">// å¯åŠ¨æ—¶è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ï¼ˆæŒ‡å®šæ‰“å¼€chromeï¼Œopen: &#x27;Google Chrome&#x27;ï¼‰</span></span><br><span class="line">  <span class="attr">compress</span>: <span class="literal">true</span>, <span class="comment">// ä¸€åˆ‡æœåŠ¡éƒ½å¯ç”¨gzip å‹ç¼©</span></span><br><span class="line">  <span class="attr">disableHostCheck</span>: <span class="literal">true</span>, <span class="comment">// trueï¼šä¸è¿›è¡Œhostæ£€æŸ¥</span></span><br><span class="line">  <span class="attr">quiet</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">https</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">clientLogLevel</span>: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">  <span class="attr">stats</span>: &#123; <span class="comment">// è®¾ç½®æ§åˆ¶å°çš„æç¤ºä¿¡æ¯</span></span><br><span class="line">    <span class="attr">chunks</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">children</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">modules</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">entrypoints</span>: <span class="literal">false</span>, <span class="comment">// æ˜¯å¦è¾“å‡ºå…¥å£ä¿¡æ¯</span></span><br><span class="line">    <span class="attr">warnings</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">performance</span>: <span class="literal">false</span>, <span class="comment">// æ˜¯å¦è¾“å‡ºwebpackå»ºè®®ï¼ˆå¦‚æ–‡ä»¶ä½“ç§¯å¤§å°ï¼‰</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">historyApiFallback</span>: &#123;</span><br><span class="line">    <span class="attr">disableDotRule</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">watchOptions</span>: &#123;</span><br><span class="line">    <span class="attr">ignored</span>: <span class="regexp">/node_modules/</span>, <span class="comment">// ç•¥è¿‡node_modulesç›®å½•</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">proxy</span>: &#123; <span class="comment">// æ¥å£ä»£ç†ï¼ˆè¿™æ®µé…ç½®æ›´æ¨èï¼šå†™åˆ°package.jsonï¼Œå†å¼•å…¥åˆ°è¿™é‡Œï¼‰</span></span><br><span class="line">    <span class="string">&quot;/api-dev&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;target&quot;</span>: <span class="string">&quot;http://api.test.xxx.com&quot;</span>,</span><br><span class="line">      <span class="string">&quot;secure&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;changeOrigin&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;pathRewrite&quot;</span>: &#123; <span class="comment">// å°†urlä¸Šçš„æŸæ®µé‡å†™ï¼ˆä¾‹å¦‚æ­¤å¤„æ˜¯å°† api-dev æ›¿æ¢æˆäº†ç©ºï¼‰</span></span><br><span class="line">        <span class="string">&quot;^/api-dev&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">before</span>(<span class="params">app</span>)</span> &#123; &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-2-æŠ€å·§1ï¼šæ–‡ä»¶å½¢å¼è¾“å‡º-dev-server-ä»£ç "><a href="#5-2-æŠ€å·§1ï¼šæ–‡ä»¶å½¢å¼è¾“å‡º-dev-server-ä»£ç " class="headerlink" title="5.2 æŠ€å·§1ï¼šæ–‡ä»¶å½¢å¼è¾“å‡º dev-server ä»£ç "></a>5.2 æŠ€å·§1ï¼šæ–‡ä»¶å½¢å¼è¾“å‡º dev-server ä»£ç </h3><p>dev-server è¾“å‡ºçš„ä»£ç é€šå¸¸åœ¨å†…å­˜ä¸­ï¼Œä½†ä¹Ÿå¯ä»¥å†™å…¥ç¡¬ç›˜ï¼Œäº§å‡ºå®ä½“æ–‡ä»¶ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">devServer:&#123;</span><br><span class="line">  <span class="attr">writeToDisk</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šå¸¸å¯ä»¥ç”¨äºä»£ç†æ˜ å°„æ–‡ä»¶è°ƒè¯•ï¼Œç¼–è¯‘æ—¶ä¼šäº§å‡ºè®¸å¤šå¸¦ hash çš„ js æ–‡ä»¶ï¼Œä¸å¸¦ hash çš„æ–‡ä»¶åŒæ ·ä¹Ÿæ˜¯<strong>å®æ—¶ç¼–è¯‘çš„</strong>ã€‚</p>
<h3 id="5-3-æŠ€å·§2ï¼šé»˜è®¤ä½¿ç”¨æœ¬åœ°-IP-å¯åŠ¨æœåŠ¡"><a href="#5-3-æŠ€å·§2ï¼šé»˜è®¤ä½¿ç”¨æœ¬åœ°-IP-å¯åŠ¨æœåŠ¡" class="headerlink" title="5.3 æŠ€å·§2ï¼šé»˜è®¤ä½¿ç”¨æœ¬åœ° IP å¯åŠ¨æœåŠ¡"></a>5.3 æŠ€å·§2ï¼šé»˜è®¤ä½¿ç”¨æœ¬åœ° IP å¯åŠ¨æœåŠ¡</h3><p>æœ‰çš„æ—¶å€™ï¼Œå¯åŠ¨æœåŠ¡æ—¶ï¼Œæƒ³è¦é»˜è®¤ä½¿ç”¨æœ¬åœ°çš„ ip åœ°å€æ‰“å¼€ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">devServer:&#123;</span><br><span class="line">  <span class="attr">disableHostCheck</span>: <span class="literal">true</span>, <span class="comment">// trueï¼šä¸è¿›è¡Œhostæ£€æŸ¥</span></span><br><span class="line">  <span class="comment">// useLocalIp: true, // å»ºè®®ä¸åœ¨è¿™é‡Œé…ç½®</span></span><br><span class="line">  <span class="comment">// host: &#x27;0.0.0.0&#x27;, // å»ºè®®ä¸åœ¨è¿™é‡Œé…ç½®</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŒæ—¶è¿˜éœ€è¦å°† host é…ç½®ä¸ºÂ <code>0.0.0.0</code>ï¼Œè¿™ä¸ªé…ç½®å»ºè®®åœ¨ scripts å‘½ä»¤ä¸­è¿½åŠ ï¼Œè€Œéåœ¨é…ç½®ä¸­å†™æ­»ï¼Œå¦åˆ™å°†æ¥ä¸æƒ³è¦è¿™ç§æ–¹å¼å¾€å›æ”¹æŠ˜è…¾ï¼Œå–å·§ä¸€ç‚¹ï¼Œé…ä¸ªæ–°å‘½ä»¤ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;dev-ip&quot;</span>: <span class="string">&quot;yarn run dev --host 0.0.0.0 --useLocalIp&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="5-4-æŠ€å·§3ï¼šæŒ‡å®šå¯åŠ¨çš„è°ƒè¯•åŸŸå"><a href="#5-4-æŠ€å·§3ï¼šæŒ‡å®šå¯åŠ¨çš„è°ƒè¯•åŸŸå" class="headerlink" title="5.4 æŠ€å·§3ï¼šæŒ‡å®šå¯åŠ¨çš„è°ƒè¯•åŸŸå"></a>5.4 æŠ€å·§3ï¼šæŒ‡å®šå¯åŠ¨çš„è°ƒè¯•åŸŸå</h3><p>æœ‰æ—¶å¯åŠ¨çš„æ—¶å€™å¸Œæœ›æ˜¯æŒ‡å®šçš„è°ƒè¯•åŸŸåï¼Œä¾‹å¦‚ï¼š<code>local.test.baidu.com</code>ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">devServer:&#123;</span><br><span class="line">  <span class="attr">open</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">public</span>: <span class="string">&#x27;local.test.baidu.com:8080&#x27;</span>, <span class="comment">// éœ€è¦å¸¦ä¸Šç«¯å£</span></span><br><span class="line">  <span class="attr">port</span>: <span class="number">8080</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŒæ—¶éœ€è¦å°†Â <code>127.0.0.1</code>Â ä¿®æ”¹ä¸ºæŒ‡å®šçš„ hostï¼Œå¯ä»¥å€ŸåŠ© iHost ç­‰å·¥å…·å»ä¿®æ”¹ï¼Œå„ä¸ªå·¥å…·å¤§åŒå°å¼‚ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> local.test.baidu.com</span><br></pre></td></tr></table></figure>
<p>æœåŠ¡å¯åŠ¨åå°†è‡ªåŠ¨æ‰“å¼€Â <code>local.test.baidu.com:8080</code>Â è®¿é—®<br /></p>
<h3 id="5-5-æŠ€å·§4ï¼šå¯åŠ¨-gzip-å‹ç¼©"><a href="#5-5-æŠ€å·§4ï¼šå¯åŠ¨-gzip-å‹ç¼©" class="headerlink" title="5.5 æŠ€å·§4ï¼šå¯åŠ¨ gzip å‹ç¼©"></a>5.5 æŠ€å·§4ï¼šå¯åŠ¨ gzip å‹ç¼©</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">devServer:&#123;</span><br><span class="line">  <span class="attr">compress</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="ä¸‰ã€HMR-åŸºæœ¬åŸç†ä»‹ç»"><a href="#ä¸‰ã€HMR-åŸºæœ¬åŸç†ä»‹ç»" class="headerlink" title="ä¸‰ã€HMR åŸºæœ¬åŸç†ä»‹ç»"></a>ä¸‰ã€HMR åŸºæœ¬åŸç†ä»‹ç»</h1><p>ä»å‰é¢ä»‹ç»ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“ï¼šHMR ä¸»è¦åŠŸèƒ½æ˜¯ä¼š<strong>åœ¨åº”ç”¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­æ›¿æ¢ã€æ·»åŠ æˆ–åˆ é™¤æ¨¡å—ï¼Œè€Œæ— éœ€é‡æ–°åŠ è½½æ•´ä¸ªé¡µé¢</strong>ã€‚<br />é‚£ä¹ˆï¼ŒWebpack ç¼–è¯‘æºç æ‰€äº§ç”Ÿçš„æ–‡ä»¶å˜åŒ–åœ¨ç¼–è¯‘æ—¶ï¼Œæ›¿æ¢æ¨¡å—å®ç°åœ¨è¿è¡Œæ—¶ï¼Œä¸¤è€…å¦‚ä½•è”ç³»èµ·æ¥ï¼Ÿ<br /><br><br />å¸¦ç€è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å…ˆç®€å•çœ‹ä¸‹ HMR æ ¸å¿ƒå·¥ä½œæµç¨‹ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š</p>
<p><img src="http://images.pingan8787.com/Webpack-HMR/Webpack-HMR-Simple-Process.png" alt="HMR å·¥ä½œæµç¨‹å›¾.png"></p>
<p>æ¥ä¸‹æ¥å¼€å§‹ HMR å·¥ä½œæµç¨‹åˆ†æï¼š</p>
<ol>
<li>å½“ Webpackï¼ˆWatchmanï¼‰ ç›‘å¬åˆ°é¡¹ç›®ä¸­çš„æ–‡ä»¶/æ¨¡å—ä»£ç å‘ç”Ÿå˜åŒ–åï¼Œå°†å˜åŒ–é€šçŸ¥ Webpack ä¸­çš„æ„å»ºå·¥å…·ï¼ˆPackagerï¼‰å³ HMR Pluginï¼›</li>
<li>ç„¶åç»è¿‡ HMR Plugin å¤„ç†åï¼Œå°†ç»“æœå‘é€åˆ°åº”ç”¨ç¨‹åºï¼ˆApplicationï¼‰çš„è¿è¡Œæ—¶æ¡†æ¶ï¼ˆHMR Runtimeï¼‰ï¼›</li>
<li>æœ€åç”± HMR Runtime å°†è¿™äº›å‘ç”Ÿå˜åŒ–çš„æ–‡ä»¶/æ¨¡å—æ›´æ–°ï¼ˆæ–°å¢/åˆ é™¤æˆ–æ›¿æ¢ï¼‰åˆ°æ¨¡å—ç³»ç»Ÿä¸­ã€‚</li>
</ol>
<p>å…¶ä¸­ï¼ŒHMR Runtime æ˜¯æ„å»ºå·¥å…·åœ¨ç¼–è¯‘æ—¶æ³¨å…¥çš„ï¼Œé€šè¿‡ç»Ÿä¸€çš„ Module ID å°†ç¼–è¯‘æ—¶çš„æ–‡ä»¶ä¸è¿è¡Œæ—¶çš„æ¨¡å—å¯¹åº”èµ·æ¥ï¼Œå¹¶ä¸”å¯¹å¤–æä¾›ä¸€ç³»åˆ— API ä¾›åº”ç”¨å±‚æ¡†æ¶ï¼ˆå¦‚ Reactï¼‰è°ƒç”¨ã€‚</p>
<p>ğŸ’–<strong>æ³¨æ„</strong>ğŸ’–ï¼šå»ºè®®å…ˆç†è§£ä¸Šé¢è¿™å¼ å›¾çš„å¤§è‡´æµç¨‹ï¼Œåœ¨è¿›è¡Œåç»­é˜…è¯»ã€‚æ”¾å¿ƒï¼Œæˆ‘ç­‰ç€å¤§å®¶~<a target="_blank" rel="noopener" href="https://emojipedia.org/people/">ğŸ˜ƒ</a><br /></p>
<h1 id="å››ã€HMR-å®Œæ•´åŸç†å’Œæºç åˆ†æ"><a href="#å››ã€HMR-å®Œæ•´åŸç†å’Œæºç åˆ†æ" class="headerlink" title="å››ã€HMR å®Œæ•´åŸç†å’Œæºç åˆ†æ"></a>å››ã€HMR å®Œæ•´åŸç†å’Œæºç åˆ†æ</h1><p>é€šè¿‡ä¸Šä¸€èŠ‚å†…å®¹ï¼Œæˆ‘ä»¬å¤§æ¦‚çŸ¥é“ HMR ç®€å•å·¥ä½œæµç¨‹ï¼Œé‚£ä¹ˆæˆ–è®¸ä½ ç°åœ¨å¯èƒ½è¿˜æœ‰å¾ˆå¤šç–‘æƒ‘ï¼šæ–‡ä»¶æ›´æ–°æ˜¯ä»€ä¹ˆé€šçŸ¥ HMR Pluginï¼ŸHMR Plugin æ€ä¹ˆå‘é€æ›´æ–°åˆ° HMR Runtimeï¼Ÿç­‰ç­‰é—®é¢˜ã€‚</p>
<p>é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹è¯¦ç»†ç»“åˆæºç åˆ†ææ•´ä¸ª HMR æ¨¡å—çƒ­æ›´æ–°æµç¨‹ï¼Œé¦–å…ˆè¿˜æ˜¯å…ˆçœ‹æµç¨‹å›¾ï¼Œå¯ä»¥å…ˆä¸äº†è§£å›¾ä¸­æ–¹æ³•åç§°ï¼ˆçº¢è‰²å­—ä½“é»„è‰²èƒŒæ™¯è‰²éƒ¨åˆ†ï¼‰ï¼š</p>
<p><img src="http://images.pingan8787.com/Webpack-HMR/Webpack-HMR-Source-Process.png" alt="Webpack HMR.png"></p>
<p>ä¸Šå›¾å±•ç¤ºäº†ä»æˆ‘ä»¬ä¿®æ”¹ä»£ç ï¼Œåˆ°æ¨¡å—çƒ­æ›´æ–°å®Œæˆçš„ä¸€ä¸ª HMR å®Œæ•´å·¥ä½œæµç¨‹ï¼Œå›¾ä¸­å·²ç”¨çº¢è‰²é˜¿æ‹‰ä¼¯æ•°å­—ç¬¦å·å°†æµç¨‹æ ‡è¯†å‡ºæ¥ã€‚</p>
<p>è¦äº†è§£ä¸Šé¢å·¥ä½œåŸç†ï¼Œæˆ‘ä»¬å…ˆç†è§£å›¾ä¸­è¿™å‡ ä¸ªåç§°æ¦‚å¿µï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/webpack/webpack-dev-server"><strong>Webpack-dev-server</strong></a>Â ï¼šä¸€ä¸ªæœåŠ¡å™¨æ’ä»¶ï¼Œç›¸å½“äº express æœåŠ¡å™¨ï¼Œå¯åŠ¨ä¸€ä¸ª Web æœåŠ¡ï¼Œåªé€‚ç”¨äºå¼€å‘ç¯å¢ƒï¼›</li>
<li><a target="_blank" rel="noopener" href="https://github.com/webpack/webpack-dev-middleware"><strong>Webpack-dev-middleware</strong></a>Â ï¼šä¸€ä¸ª <strong>Webpack-dev-server</strong> çš„ä¸­é—´ä»¶ï¼Œä½œç”¨ç®€å•æ€»ç»“ä¸ºï¼šé€šè¿‡watch modeï¼Œç›‘å¬èµ„æºçš„å˜æ›´ï¼Œç„¶åè‡ªåŠ¨æ‰“åŒ…ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://github.com/webpack-contrib/webpack-hot-middleware"><strong>Webpack-hot-middleware</strong></a>Â ï¼šç»“åˆ Webpack-dev-middleware ä½¿ç”¨çš„ä¸­é—´ä»¶ï¼Œå®ƒå¯ä»¥å®ç°æµè§ˆå™¨çš„æ— åˆ·æ–°æ›´æ–°ï¼Œä¹Ÿå°±æ˜¯ HMRï¼›</li>
</ul>
<p><img src="http://images.pingan8787.com/Webpack-HMR/face1.gif"></p>
<p>ä¸‹é¢ä¸€èµ·å­¦ä¹  HMR æ•´ä¸ªå·¥ä½œåŸç†å§ï¼š</p>
<h2 id="1-ç›‘æ§ä»£ç å˜åŒ–ï¼Œé‡æ–°ç¼–è¯‘æ‰“åŒ…"><a href="#1-ç›‘æ§ä»£ç å˜åŒ–ï¼Œé‡æ–°ç¼–è¯‘æ‰“åŒ…" class="headerlink" title="1.ç›‘æ§ä»£ç å˜åŒ–ï¼Œé‡æ–°ç¼–è¯‘æ‰“åŒ…"></a>1.ç›‘æ§ä»£ç å˜åŒ–ï¼Œé‡æ–°ç¼–è¯‘æ‰“åŒ…</h2><p>é¦–å…ˆæ ¹æ® devServer é…ç½®ï¼Œä½¿ç”¨ <code>npm start</code> å°†å¯åŠ¨ Webpack-dev-server å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨å¹¶è¿›å…¥ Webpack çš„ watch æ¨¡å¼ï¼Œç„¶ååˆå§‹åŒ– Webpack-dev-middleware ï¼Œåœ¨ Webpack-dev-middleware ä¸­é€šè¿‡è°ƒç”¨ <code>startWatch()</code>Â æ–¹æ³•å¯¹æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œ watchï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack-dev-server\bin\webpack-dev-server.js</span></span><br><span class="line"><span class="comment">// 1.å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨ Line 386</span></span><br><span class="line">server = <span class="keyword">new</span> Server(compiler, options);</span><br><span class="line"></span><br><span class="line"><span class="comment">// webpack-dev-server\lib\Server.js</span></span><br><span class="line"><span class="comment">// 2.åˆå§‹åŒ– Webpack-dev-middleware Line 109</span></span><br><span class="line"><span class="built_in">this</span>.middleware = webpackDevMiddleware(compiler, <span class="built_in">Object</span>.assign(&#123;&#125;, options, wdmOptions));</span><br><span class="line"></span><br><span class="line"><span class="comment">// webpack-dev-middleware\lib\Shared.js</span></span><br><span class="line"><span class="comment">// 3.å¼€å§‹ watch æ–‡ä»¶ç³»ç»Ÿ Line 171</span></span><br><span class="line">startWatch: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="comment">//...</span></span><br><span class="line">	<span class="comment">// start watching</span></span><br><span class="line">	<span class="keyword">if</span>(!options.lazy) &#123;</span><br><span class="line">		<span class="keyword">var</span> watching = compiler.watch(options.watchOptions, share.handleCompilerCallback);</span><br><span class="line">		context.watching = watching;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line">share.startWatch();</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>
<p>å½“ <code>startWatch()</code> æ–¹æ³•æ‰§è¡Œåï¼Œä¾¿è¿›å…¥ watch æ¨¡å¼ï¼Œè‹¥å‘ç°æ–‡ä»¶ä¸­ä»£ç å‘ç”Ÿä¿®æ”¹ï¼Œåˆ™æ ¹æ®é…ç½®æ–‡ä»¶<strong>å¯¹æ¨¡å—é‡æ–°ç¼–è¯‘æ‰“åŒ…</strong>ã€‚</p>
<h2 id="2-ä¿å­˜ç¼–è¯‘ç»“æœ"><a href="#2-ä¿å­˜ç¼–è¯‘ç»“æœ" class="headerlink" title="2.ä¿å­˜ç¼–è¯‘ç»“æœ"></a>2.ä¿å­˜ç¼–è¯‘ç»“æœ</h2><p>Webpack ä¸  Webpack-dev-middleware äº¤äº’ï¼ŒWebpack-dev-middleware è°ƒç”¨ Webpack çš„ API å¯¹ä»£ç å˜åŒ–è¿›è¡Œç›‘æ§ï¼Œå¹¶é€šçŸ¥ Webpack å°†é‡æ–°ç¼–è¯‘çš„ä»£ç é€šè¿‡ JavaScript å¯¹è±¡<strong>ä¿å­˜åœ¨å†…å­˜ä¸­</strong>ã€‚</p>
<p>æˆ‘ä»¬ä¼šå‘ç°ï¼Œåœ¨ <code>output.path</code> æŒ‡å®šçš„ <code>dist</code>Â ç›®å½•å¹¶æ²¡æœ‰ä¿å­˜ç¼–è¯‘ç»“æœçš„æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ</p>
<p>å…¶å®ï¼Œ Webpack å°†ç¼–è¯‘ç»“æœä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå› ä¸º<strong>è®¿é—®å†…å­˜ä¸­çš„ä»£ç æ¯”è®¿é—®æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶å¿«</strong>ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ä»£ç å†™å…¥æ–‡ä»¶çš„å¼€é”€ã€‚</p>
<p>Webpack èƒ½å°†ä»£ç ä¿å­˜åˆ°å†…å­˜ä¸­ï¼Œéœ€è¦å½’åŠŸäº Webpack-dev-middleware çš„ <code>memory-fs</code> ä¾èµ–åº“ï¼Œå®ƒå°†åŸæœ¬ <code>outputFileSystem</code>Â  æ›¿æ¢æˆäº† <code>MemoryFileSystem</code>Â  çš„å®ä¾‹ï¼Œä¾¿å®ç°ä»£ç è¾“å‡ºåˆ°å†…å­˜ä¸­ã€‚å…¶ä¸­éƒ¨åˆ†æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack-dev-middleware\lib\Shared.js Line 108</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// store our files in memory</span></span><br><span class="line"><span class="keyword">var</span> fs;</span><br><span class="line"><span class="keyword">var</span> isMemoryFs = !compiler.compilers &amp;&amp; </span><br><span class="line">    compiler.outputFileSystem <span class="keyword">instanceof</span> MemoryFileSystem;</span><br><span class="line"><span class="keyword">if</span>(isMemoryFs) &#123;</span><br><span class="line">	fs = compiler.outputFileSystem;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	fs = compiler.outputFileSystem = <span class="keyword">new</span> MemoryFileSystem();</span><br><span class="line">&#125;</span><br><span class="line">context.fs = fs;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä»£ç å…ˆåˆ¤æ–­ <code>fileSystem</code> æ˜¯å¦æ˜¯ <code>MemoryFileSystem</code> çš„å®ä¾‹ï¼Œè‹¥ä¸æ˜¯ï¼Œåˆ™ç”¨ <code>MemoryFileSystem</code> çš„å®ä¾‹æ›¿æ¢ compiler ä¹‹å‰çš„ <code>outputFileSystem</code>ã€‚è¿™æ · bundle.js æ–‡ä»¶ä»£ç å°±ä½œä¸ºä¸€ä¸ªç®€å• JavaScript å¯¹è±¡ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå½“æµè§ˆå™¨è¯·æ±‚ bundle.js æ–‡ä»¶æ—¶ï¼ŒdevServer å°±ç›´æ¥å»å†…å­˜ä¸­æ‰¾åˆ°ä¸Šé¢ä¿å­˜çš„ JavaScript å¯¹è±¡å¹¶è¿”å›ç»™æµè§ˆå™¨ç«¯ã€‚</p>
<h2 id="3-ç›‘æ§æ–‡ä»¶å˜åŒ–ï¼Œåˆ·æ–°æµè§ˆå™¨"><a href="#3-ç›‘æ§æ–‡ä»¶å˜åŒ–ï¼Œåˆ·æ–°æµè§ˆå™¨" class="headerlink" title="3.ç›‘æ§æ–‡ä»¶å˜åŒ–ï¼Œåˆ·æ–°æµè§ˆå™¨"></a>3.ç›‘æ§æ–‡ä»¶å˜åŒ–ï¼Œåˆ·æ–°æµè§ˆå™¨</h2><p>Webpack-dev-server å¼€å§‹ç›‘æ§æ–‡ä»¶å˜åŒ–ï¼Œä¸ç¬¬ 1 æ­¥ä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œå¹¶ä¸æ˜¯ç›‘æ§ä»£ç å˜åŒ–é‡æ–°ç¼–è¯‘æ‰“åŒ…ã€‚<br />å½“æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®äº† <a target="_blank" rel="noopener" href="https://webpack.js.org/configuration/dev-server/#devserver-watchcontentbase"><code>devServer.watchContentBase</code></a>Â ä¸º <code>true</code>Â ï¼ŒWebpack-dev-server ä¼šç›‘å¬é…ç½®æ–‡ä»¶å¤¹ä¸­é™æ€æ–‡ä»¶çš„å˜åŒ–ï¼Œå‘ç”Ÿå˜åŒ–æ—¶ï¼Œé€šçŸ¥æµè§ˆå™¨ç«¯å¯¹åº”ç”¨è¿›è¡Œ<strong>æµè§ˆå™¨åˆ·æ–°</strong>ï¼Œè¿™ä¸ HMR ä¸ä¸€æ ·ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack-dev-server\lib\Server.js</span></span><br><span class="line"><span class="comment">// 1. è¯»å–å‚æ•° Line 385</span></span><br><span class="line"><span class="keyword">if</span> (options.watchContentBase) &#123; defaultFeatures.push(<span class="string">&#x27;watchContentBase&#x27;</span>); &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. å®šä¹‰ _watch æ–¹æ³• Line 697</span></span><br><span class="line">Server.prototype._watch = <span class="function"><span class="keyword">function</span> (<span class="params">watchPath</span>) </span>&#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">const</span> watcher = chokidar.watch(watchPath, options).on(<span class="string">&#x27;change&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.sockWrite(<span class="built_in">this</span>.sockets, <span class="string">&#x27;content-changed&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">this</span>.contentBaseWatchers.push(watcher);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. æ‰§è¡Œ _watch() ç›‘å¬æ–‡ä»¶å˜åŒ– Line 339</span></span><br><span class="line">watchContentBase: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/^(https?:)?\/\//</span>.test(contentBase) || <span class="keyword">typeof</span> contentBase === <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;Watching remote files is not supported.&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(contentBase)) &#123;</span><br><span class="line">        contentBase.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>._watch(item);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>._watch(contentBase);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-å»ºç«‹-WSï¼ŒåŒæ­¥ç¼–è¯‘é˜¶æ®µçŠ¶æ€"><a href="#4-å»ºç«‹-WSï¼ŒåŒæ­¥ç¼–è¯‘é˜¶æ®µçŠ¶æ€" class="headerlink" title="4.å»ºç«‹ WSï¼ŒåŒæ­¥ç¼–è¯‘é˜¶æ®µçŠ¶æ€"></a>4.å»ºç«‹ WSï¼ŒåŒæ­¥ç¼–è¯‘é˜¶æ®µçŠ¶æ€</h2><p>è¿™ä¸€æ­¥éƒ½æ˜¯ Webpack-dev-server ä¸­å¤„ç†ï¼Œä¸»è¦é€šè¿‡ <a target="_blank" rel="noopener" href="https://github.com/sockjs/sockjs-client">sockjs</a>ï¼ˆWebpack-dev-server çš„ä¾èµ–ï¼‰ï¼Œåœ¨ Webpack-dev-server çš„æµè§ˆå™¨ç«¯ï¼ˆClientï¼‰å’ŒæœåŠ¡å™¨ç«¯ï¼ˆWebpack-dev-middlewareï¼‰ä¹‹é—´<strong>å»ºç«‹ WebSocket é•¿è¿æ¥</strong>ã€‚</p>
<p>ç„¶åå°† Webpack ç¼–è¯‘æ‰“åŒ…çš„å„ä¸ªé˜¶æ®µçŠ¶æ€ä¿¡æ¯åŒæ­¥åˆ°æµè§ˆå™¨ç«¯ã€‚å…¶ä¸­æœ‰ä¸¤ä¸ªé‡è¦æ­¥éª¤ï¼š</p>
<ul>
<li>å‘é€çŠ¶æ€</li>
</ul>
<p>Webpack-dev-server é€šè¿‡ Webpack API ç›‘å¬ compile çš„ <code>done</code>Â äº‹ä»¶ï¼Œå½“ compile å®Œæˆåï¼ŒWebpack-dev-server é€šè¿‡ <code>_sendStats</code>Â æ–¹æ³•å°†ç¼–è¯‘åæ–°æ¨¡å—çš„ hash å€¼ç”¨ socket å‘é€ç»™æµè§ˆå™¨ç«¯ã€‚</p>
<ul>
<li>ä¿å­˜çŠ¶æ€</li>
</ul>
<p>æµè§ˆå™¨ç«¯å°†<code>_sendStats</code> å‘é€è¿‡æ¥çš„ <code>hash</code>Â ä¿å­˜ä¸‹æ¥ï¼Œ<strong>å®ƒå°†ä¼šç”¨åˆ°åæ¨¡å—çƒ­æ›´æ–°</strong>ã€‚<br><img src="http://images.pingan8787.com/Webpack-HMR/Webpack-HMR-WS1.png" alt="image.png"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack-dev-server\lib\Server.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. å®šä¹‰ _sendStats æ–¹æ³• Line 685</span></span><br><span class="line"><span class="comment">// send stats to a socket or multiple sockets</span></span><br><span class="line">Server.prototype._sendStats = <span class="function"><span class="keyword">function</span> (<span class="params">sockets, stats, force</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="built_in">this</span>.sockWrite(sockets, <span class="string">&#x27;hash&#x27;</span>, stats.hash);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. ç›‘å¬ done äº‹ä»¶ Line 86</span></span><br><span class="line">compiler.plugin(<span class="string">&#x27;done&#x27;</span>, <span class="function">(<span class="params">stats</span>) =&gt;</span> &#123;</span><br><span class="line">  	<span class="comment">// å°†æœ€æ–°æ‰“åŒ…æ–‡ä»¶çš„ hash å€¼ï¼ˆstats.hashï¼‰ä½œä¸ºå‚æ•°ä¼ å…¥ _sendStats()</span></span><br><span class="line">    <span class="built_in">this</span>._sendStats(<span class="built_in">this</span>.sockets, stats.toJson(clientStats));</span><br><span class="line">    <span class="built_in">this</span>._stats = stats;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// webpack-dev-server\client\index.js</span></span><br><span class="line"><span class="comment">// 3. ä¿å­˜ hash å€¼ Line 74</span></span><br><span class="line"><span class="keyword">var</span> onSocketMsg = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">hash</span>: <span class="function"><span class="keyword">function</span> <span class="title">hash</span>(<span class="params">_hash</span>) </span>&#123;</span><br><span class="line">    currentHash = _hash;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line">socket(socketUrl, onSocketMsg);</span><br></pre></td></tr></table></figure>
<h2 id="5-æµè§ˆå™¨ç«¯å‘å¸ƒæ¶ˆæ¯"><a href="#5-æµè§ˆå™¨ç«¯å‘å¸ƒæ¶ˆæ¯" class="headerlink" title="5.æµè§ˆå™¨ç«¯å‘å¸ƒæ¶ˆæ¯"></a>5.æµè§ˆå™¨ç«¯å‘å¸ƒæ¶ˆæ¯</h2><p>å½“ <code>hash</code> æ¶ˆæ¯å‘é€å®Œæˆåï¼Œsocket è¿˜ä¼šå‘é€ä¸€æ¡ <code>ok</code>Â çš„æ¶ˆæ¯å‘ŠçŸ¥ Webpack-dev-serverï¼Œç”±äºå®¢æˆ·ç«¯ï¼ˆClientï¼‰å¹¶ä¸è¯·æ±‚çƒ­æ›´æ–°ä»£ç ï¼Œä¹Ÿä¸æ‰§è¡Œçƒ­æ›´æ–°æ¨¡å—æ“ä½œï¼Œå› æ­¤é€šè¿‡ <code>emit</code>Â ä¸€ä¸ª <code>&quot;webpackHotUpdate&quot;</code>Â æ¶ˆæ¯ï¼Œå°†å·¥ä½œè½¬äº¤å› Webpackã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack-dev-server\client\index.js</span></span><br><span class="line"><span class="comment">// 1. å¤„ç† ok æ¶ˆæ¯ Line 135</span></span><br><span class="line"><span class="keyword">var</span> onSocketMsg = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">ok</span>: <span class="function"><span class="keyword">function</span> <span class="title">ok</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      sendMsg(<span class="string">&#x27;Ok&#x27;</span>);</span><br><span class="line">      <span class="keyword">if</span> (useWarningOverlay || useErrorOverlay) overlay.clear();</span><br><span class="line">      <span class="keyword">if</span> (initial) <span class="keyword">return</span> initial = <span class="literal">false</span>; <span class="comment">// eslint-disable-line no-return-assign</span></span><br><span class="line">      reloadApp();</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. å¤„ç†åˆ·æ–° APP Line 218</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reloadApp</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">if</span> (_hot) &#123;</span><br><span class="line">    <span class="comment">// åŠ¨æ€åŠ è½½ emitter</span></span><br><span class="line">    <span class="keyword">var</span> hotEmitter = <span class="built_in">require</span>(<span class="string">&#x27;webpack/hot/emitter&#x27;</span>);</span><br><span class="line">    hotEmitter.emit(<span class="string">&#x27;webpackHotUpdate&#x27;</span>, currentHash);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> self !== <span class="string">&#x27;undefined&#x27;</span> &amp;&amp; self.window) &#123;</span><br><span class="line">      <span class="comment">// broadcast update to window</span></span><br><span class="line">      self.postMessage(<span class="string">&#x27;webpackHotUpdate&#x27;</span> + currentHash, <span class="string">&#x27;*&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="6-ä¼ é€’-hash-åˆ°-HMR"><a href="#6-ä¼ é€’-hash-åˆ°-HMR" class="headerlink" title="6.ä¼ é€’ hash åˆ° HMR"></a>6.ä¼ é€’ hash åˆ° HMR</h2><p>Webpack/hot/dev-server ç›‘å¬æµè§ˆå™¨ç«¯ <code>webpackHotUpdate</code> æ¶ˆæ¯ï¼Œå°†æ–°æ¨¡å— hash å€¼ä¼ åˆ°å®¢æˆ·ç«¯ HMR æ ¸å¿ƒä¸­æ¢çš„ HotModuleReplacement.runtime ï¼Œå¹¶è°ƒç”¨ <code>check</code>Â æ–¹æ³•æ£€æµ‹æ›´æ–°ï¼Œ<strong>åˆ¤æ–­æ˜¯æµè§ˆå™¨åˆ·æ–°è¿˜æ˜¯æ¨¡å—çƒ­æ›´æ–°</strong>ã€‚<br>å¦‚æœæ˜¯æµè§ˆå™¨åˆ·æ–°çš„è¯ï¼Œåˆ™æ²¡æœ‰åç»­æ­¥éª¤å’¯~~</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack\hot\dev-server.js</span></span><br><span class="line"><span class="comment">// 1.ç›‘å¬ webpackHotUpdate Line 42</span></span><br><span class="line"><span class="keyword">var</span> hotEmitter = <span class="built_in">require</span>(<span class="string">&quot;./emitter&quot;</span>);</span><br><span class="line">hotEmitter.on(<span class="string">&quot;webpackHotUpdate&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">currentHash</span>) </span>&#123;</span><br><span class="line">    lastHash = currentHash;</span><br><span class="line">    <span class="keyword">if</span>(!upToDate() &amp;&amp; <span class="built_in">module</span>.hot.status() === <span class="string">&quot;idle&quot;</span>) &#123;</span><br><span class="line">        log(<span class="string">&quot;info&quot;</span>, <span class="string">&quot;[HMR] Checking for updates on the server...&quot;</span>);</span><br><span class="line">        check();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> check = <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">module</span>.hot.check(<span class="literal">true</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">updatedModules</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!updatedModules) &#123;</span><br><span class="line">         	  <span class="comment">// ...</span></span><br><span class="line">						<span class="built_in">window</span>.location.reload();<span class="comment">// æµè§ˆå™¨åˆ·æ–°</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!upToDate()) &#123;</span><br><span class="line">            check();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123; <span class="comment">/*...*/</span>&#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// webpack\lib\HotModuleReplacement.runtime.js</span></span><br><span class="line"><span class="comment">// 3.è°ƒç”¨ HotModuleReplacement.runtime å®šä¹‰çš„ check æ–¹æ³• Line 167</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hotCheck</span>(<span class="params">apply</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(hotStatus !== <span class="string">&quot;idle&quot;</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;check() is only allowed in idle status&quot;</span>);</span><br><span class="line">    hotApplyOnUpdate = apply;</span><br><span class="line">    hotSetStatus(<span class="string">&quot;check&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> hotDownloadManifest(hotRequestTimeout).then(<span class="function"><span class="keyword">function</span>(<span class="params">update</span>) </span>&#123;</span><br><span class="line">				<span class="comment">//...</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-æ£€æµ‹æ˜¯å¦å­˜åœ¨æ›´æ–°"><a href="#7-æ£€æµ‹æ˜¯å¦å­˜åœ¨æ›´æ–°" class="headerlink" title="7.æ£€æµ‹æ˜¯å¦å­˜åœ¨æ›´æ–°"></a>7.æ£€æµ‹æ˜¯å¦å­˜åœ¨æ›´æ–°</h2><p>å½“ HotModuleReplacement.runtime è°ƒç”¨ <code>check</code> æ–¹æ³•æ—¶ï¼Œä¼šè°ƒç”¨ JsonpMainTemplate.runtime ä¸­çš„Â <code>hotDownloadUpdateChunk</code>Â ï¼ˆè·å–æœ€æ–°æ¨¡å—ä»£ç ï¼‰å’ŒÂ <code>hotDownloadManifest</code>Â ï¼ˆè·å–æ˜¯å¦æœ‰æ›´æ–°æ–‡ä»¶ï¼‰ä¸¤ä¸ªæ–¹æ³•ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•çš„æºç ï¼Œåœ¨ä¸‹ä¸€æ­¥å±•å¼€ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack\lib\HotModuleReplacement.runtime.js</span></span><br><span class="line"><span class="comment">// 1.è°ƒç”¨ HotModuleReplacement.runtime å®šä¹‰ hotDownloadUpdateChunk æ–¹æ³• Line 171</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hotCheck</span>(<span class="params">apply</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(hotStatus !== <span class="string">&quot;idle&quot;</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;check() is only allowed in idle status&quot;</span>);</span><br><span class="line">    hotApplyOnUpdate = apply;</span><br><span class="line">    hotSetStatus(<span class="string">&quot;check&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> hotDownloadManifest(hotRequestTimeout).then(<span class="function"><span class="keyword">function</span>(<span class="params">update</span>) </span>&#123;</span><br><span class="line">				<span class="comment">//...</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="comment">// hotEnsureUpdateChunk æ–¹æ³•ä¸­ä¼šè°ƒç”¨ hotDownloadUpdateChunk</span></span><br><span class="line">          hotEnsureUpdateChunk(chunkId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ <code>hotEnsureUpdateChunk</code> æ–¹æ³•ä¸­ä¼šè°ƒç”¨ <code>hotDownloadUpdateChunk</code> ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack\lib\HotModuleReplacement.runtime.js Line 215</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">hotEnsureUpdateChunk</span>(<span class="params">chunkId</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!hotAvailableFilesMap[chunkId]) &#123;</span><br><span class="line">			hotWaitingFilesMap[chunkId] = <span class="literal">true</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			hotRequestedFilesMap[chunkId] = <span class="literal">true</span>;</span><br><span class="line">			hotWaitingFiles++;</span><br><span class="line">			hotDownloadUpdateChunk(chunkId);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h2 id="8-è¯·æ±‚æ›´æ–°æœ€æ–°æ–‡ä»¶åˆ—è¡¨"><a href="#8-è¯·æ±‚æ›´æ–°æœ€æ–°æ–‡ä»¶åˆ—è¡¨" class="headerlink" title="8.è¯·æ±‚æ›´æ–°æœ€æ–°æ–‡ä»¶åˆ—è¡¨"></a>8.è¯·æ±‚æ›´æ–°æœ€æ–°æ–‡ä»¶åˆ—è¡¨</h2><p>åœ¨è°ƒç”¨ <code>check</code> æ–¹æ³•æ—¶ï¼Œä¼šå…ˆè°ƒç”¨ JsonpMainTemplate.runtime ä¸­çš„ <code>hotDownloadManifest</code>Â æ–¹æ³•ï¼Œ é€šè¿‡å‘æœåŠ¡ç«¯<strong>å‘èµ· AJAX è¯·æ±‚è·å–æ˜¯å¦æœ‰æ›´æ–°æ–‡ä»¶</strong>ï¼Œå¦‚æœæœ‰çš„è¯å°† <code>mainfest</code>Â è¿”å›ç»™æµè§ˆå™¨ç«¯ã€‚<br><img src="http://images.pingan8787.com/Webpack-HMR/Webpack-HMR-WS2.png" alt="image.png"><br>è¿™è¾¹æ¶‰åŠä¸€äº›åŸç”Ÿ <code>XMLHttpRequest</code>ï¼Œå°±ä¸å…¨éƒ¨è´´å‡ºäº†~</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack\lib\JsonpMainTemplate.runtime.js</span></span><br><span class="line"><span class="comment">// hotDownloadManifest å®šä¹‰ Line 22</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hotDownloadManifest</span>(<span class="params">requestTimeout</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> request = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">            <span class="keyword">var</span> requestPath = $require$.p + $hotMainFilename$;</span><br><span class="line">            request.open(<span class="string">&quot;GET&quot;</span>, requestPath, <span class="literal">true</span>);</span><br><span class="line">            request.timeout = requestTimeout;</span><br><span class="line">            request.send(<span class="literal">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span>(err) &#123;</span><br><span class="line">            <span class="keyword">return</span> reject(err);</span><br><span class="line">        &#125;</span><br><span class="line">        request.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="9-è¯·æ±‚æ›´æ–°æœ€æ–°æ¨¡å—ä»£ç "><a href="#9-è¯·æ±‚æ›´æ–°æœ€æ–°æ¨¡å—ä»£ç " class="headerlink" title="9.è¯·æ±‚æ›´æ–°æœ€æ–°æ¨¡å—ä»£ç "></a>9.è¯·æ±‚æ›´æ–°æœ€æ–°æ¨¡å—ä»£ç </h2><p>åœ¨  <code>hotDownloadManifest</code>Â æ–¹æ³•ä¸­ï¼Œè¿˜ä¼šæ‰§è¡Œ Â <code>hotDownloadUpdateChunk</code>Â æ–¹æ³•ï¼Œ<strong>é€šè¿‡ JSONP è¯·æ±‚æœ€æ–°çš„æ¨¡å—ä»£ç </strong>ï¼Œå¹¶å°†ä»£ç è¿”å›ç»™ HMR runtime ã€‚<br><strong><img src="http://images.pingan8787.com/Webpack-HMR/Webpack-HMR-WS3.png" alt="image.png"></strong></p>
<p>ç„¶å HMR runtime ä¼šå°†æ–°ä»£ç è¿›ä¸€æ­¥å¤„ç†ï¼Œ<strong>åˆ¤æ–­æ˜¯æµè§ˆå™¨åˆ·æ–°è¿˜æ˜¯æ¨¡å—çƒ­æ›´æ–°</strong>ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack\lib\JsonpMainTemplate.runtime.js</span></span><br><span class="line"><span class="comment">// hotDownloadManifest å®šä¹‰ Line 12</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hotDownloadUpdateChunk</span>(<span class="params">chunkId</span>) </span>&#123;</span><br><span class="line">		<span class="comment">// åˆ›å»º script æ ‡ç­¾ï¼Œå‘èµ· JSONP è¯·æ±‚</span></span><br><span class="line">    <span class="keyword">var</span> head = <span class="built_in">document</span>.getElementsByTagName(<span class="string">&quot;head&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">&quot;script&quot;</span>);</span><br><span class="line">    script.type = <span class="string">&quot;text/javascript&quot;</span>;</span><br><span class="line">    script.charset = <span class="string">&quot;utf-8&quot;</span>;</span><br><span class="line">    script.src = $require$.p + $hotChunkFilename$;</span><br><span class="line">    $crossOriginLoading$;</span><br><span class="line">    head.appendChild(script);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="10-æ›´æ–°æ¨¡å—å’Œä¾èµ–å¼•ç”¨"><a href="#10-æ›´æ–°æ¨¡å—å’Œä¾èµ–å¼•ç”¨" class="headerlink" title="10.æ›´æ–°æ¨¡å—å’Œä¾èµ–å¼•ç”¨"></a>10.æ›´æ–°æ¨¡å—å’Œä¾èµ–å¼•ç”¨</h2><p>è¿™ä¸€æ­¥æ˜¯æ•´ä¸ªæ¨¡å—çƒ­æ›´æ–°ï¼ˆHMRï¼‰çš„æ ¸å¿ƒæ­¥éª¤ï¼Œé€šè¿‡ HMR runtime çš„ <code>hotApply</code>Â æ–¹æ³•ï¼Œç§»é™¤è¿‡æœŸæ¨¡å—å’Œä»£ç ï¼Œå¹¶æ·»åŠ æ–°çš„æ¨¡å—å’Œä»£ç å®ç°çƒ­æ›´æ–°ã€‚</p>
<p>ä» <code>hotApply</code>Â æ–¹æ³•å¯ä»¥çœ‹å‡ºï¼Œæ¨¡å—çƒ­æ›¿æ¢ä¸»è¦åˆ†ä¸‰ä¸ªé˜¶æ®µï¼š</p>
<ol>
<li><p>æ‰¾å‡ºè¿‡æœŸæ¨¡å— <code>outdatedModules</code> å’Œè¿‡æœŸä¾èµ– <code>outdatedDependencies</code> ï¼›</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack\lib\HotModuleReplacement.runtime.js</span></span><br><span class="line"><span class="comment">// æ‰¾å‡º outdatedModules å’Œ outdatedDependencies Line 342</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hotApply</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">var</span> outdatedDependencies = &#123;&#125;;</span><br><span class="line">  <span class="keyword">var</span> outdatedModules = [];</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getAffectedStuff</span>(<span class="params">updateModuleId</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> outdatedModules = [updateModuleId];</span><br><span class="line">    <span class="keyword">var</span> outdatedDependencies = &#123;&#125;;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;accepted&quot;</span>,</span><br><span class="line">        <span class="attr">moduleId</span>: updateModuleId,</span><br><span class="line">        <span class="attr">outdatedModules</span>: outdatedModules,</span><br><span class="line">        <span class="attr">outdatedDependencies</span>: outdatedDependencies</span><br><span class="line">    &#125;;</span><br><span class="line">	&#125;;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">addAllToSet</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; b.length; i++) &#123;</span><br><span class="line">          <span class="keyword">var</span> item = b[i];</span><br><span class="line">          <span class="keyword">if</span> (a.indexOf(item) &lt; <span class="number">0</span>)</span><br><span class="line">              a.push(item);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> id <span class="keyword">in</span> hotUpdate) &#123;</span><br><span class="line">      <span class="keyword">if</span>(<span class="built_in">Object</span>.prototype.hasOwnProperty.call(hotUpdate, id)) &#123;</span><br><span class="line">          <span class="comment">// ... çœç•¥å¤šä½™ä»£ç </span></span><br><span class="line">          <span class="keyword">if</span>(hotUpdate[id]) &#123;</span><br><span class="line">              result = getAffectedStuff(moduleId);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span>(doApply) &#123;</span><br><span class="line">              <span class="keyword">for</span>(moduleId <span class="keyword">in</span> result.outdatedDependencies) &#123;</span><br><span class="line">                 <span class="comment">// æ·»åŠ åˆ° outdatedDependencies</span></span><br><span class="line">                  addAllToSet(outdatedDependencies[moduleId], result.outdatedDependencies[moduleId]);</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span>(doDispose) &#123;</span><br><span class="line">              <span class="comment">// æ·»åŠ åˆ° outdatedModules</span></span><br><span class="line">              addAllToSet(outdatedModules, [result.moduleId]);</span><br><span class="line">              appliedUpdate[moduleId] = warnUnexpectedRequire;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>ä»ç¼“å­˜ä¸­åˆ é™¤è¿‡æœŸæ¨¡å—ã€ä¾èµ–å’Œæ‰€æœ‰å­å…ƒç´ çš„å¼•ç”¨ï¼›</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack\lib\HotModuleReplacement.runtime.js</span></span><br><span class="line"><span class="comment">// ä»ç¼“å­˜ä¸­åˆ é™¤è¿‡æœŸæ¨¡å—ã€ä¾èµ–å’Œæ‰€æœ‰å­å…ƒç´ çš„å¼•ç”¨ Line 442</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hotApply</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> 		<span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">var</span> idx;</span><br><span class="line">    <span class="keyword">var</span> queue = outdatedModules.slice();</span><br><span class="line">    <span class="keyword">while</span>(queue.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        moduleId = queue.pop();</span><br><span class="line">        <span class="built_in">module</span> = installedModules[moduleId];</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="comment">// ç§»é™¤ç¼“å­˜ä¸­çš„æ¨¡å—</span></span><br><span class="line">        <span class="keyword">delete</span> installedModules[moduleId];</span><br><span class="line">        <span class="comment">// ç§»é™¤è¿‡æœŸä¾èµ–ä¸­ä¸éœ€è¦ä½¿ç”¨çš„å¤„ç†æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">delete</span> outdatedDependencies[moduleId];</span><br><span class="line">        <span class="comment">// ç§»é™¤æ‰€æœ‰å­å…ƒç´ çš„å¼•ç”¨</span></span><br><span class="line">        <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="built_in">module</span>.children.length; j++) &#123;</span><br><span class="line">            <span class="keyword">var</span> child = installedModules[<span class="built_in">module</span>.children[j]];</span><br><span class="line">            <span class="keyword">if</span>(!child) <span class="keyword">continue</span>;</span><br><span class="line">            idx = child.parents.indexOf(moduleId);</span><br><span class="line">            <span class="keyword">if</span>(idx &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                child.parents.splice(idx, <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line">		<span class="comment">// ä»æ¨¡å—å­ç»„ä»¶ä¸­åˆ é™¤è¿‡æ—¶çš„ä¾èµ–é¡¹</span></span><br><span class="line">		<span class="keyword">var</span> dependency;</span><br><span class="line">		<span class="keyword">var</span> moduleOutdatedDependencies;</span><br><span class="line">		<span class="keyword">for</span>(moduleId <span class="keyword">in</span> outdatedDependencies) &#123;</span><br><span class="line">			<span class="keyword">if</span>(<span class="built_in">Object</span>.prototype.hasOwnProperty.call(outdatedDependencies, moduleId)) &#123;</span><br><span class="line">				<span class="built_in">module</span> = installedModules[moduleId];</span><br><span class="line">				<span class="keyword">if</span>(<span class="built_in">module</span>) &#123;</span><br><span class="line">					moduleOutdatedDependencies = outdatedDependencies[moduleId];</span><br><span class="line">					<span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; moduleOutdatedDependencies.length; j++) &#123;</span><br><span class="line">						dependency = moduleOutdatedDependencies[j];</span><br><span class="line">						idx = <span class="built_in">module</span>.children.indexOf(dependency);</span><br><span class="line">						<span class="keyword">if</span>(idx &gt;= <span class="number">0</span>) <span class="built_in">module</span>.children.splice(idx, <span class="number">1</span>);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<ol start="3">
<li>å°†æ–°æ¨¡å—ä»£ç æ·»åŠ åˆ° modules ä¸­ï¼Œå½“ä¸‹æ¬¡è°ƒç”¨ <code>__webpack_require__</code>Â  (webpack é‡å†™çš„ <code>require</code>Â  æ–¹æ³•)æ–¹æ³•çš„æ—¶å€™ï¼Œå°±æ˜¯è·å–åˆ°äº†æ–°çš„æ¨¡å—ä»£ç äº†ã€‚<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack\lib\HotModuleReplacement.runtime.js</span></span><br><span class="line"><span class="comment">// å°†æ–°æ¨¡å—ä»£ç æ·»åŠ åˆ° modules ä¸­ Line 501</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hotApply</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> 		<span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">for</span>(moduleId <span class="keyword">in</span> appliedUpdate) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">Object</span>.prototype.hasOwnProperty.call(appliedUpdate, moduleId)) &#123;</span><br><span class="line">            modules[moduleId] = appliedUpdate[moduleId];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p><code>hotApply</code>Â æ–¹æ³•æ‰§è¡Œä¹‹åï¼Œæ–°ä»£ç å·²ç»æ›¿æ¢æ—§ä»£ç ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸šåŠ¡ä»£ç å¹¶ä¸çŸ¥é“è¿™äº›å˜åŒ–ï¼Œå› æ­¤éœ€è¦é€šè¿‡ <code>accept</code>äº‹ä»¶é€šçŸ¥åº”ç”¨å±‚ä½¿ç”¨æ–°çš„æ¨¡å—è¿›è¡Œâ€œå±€éƒ¨åˆ·æ–°â€ï¼Œæˆ‘ä»¬åœ¨ä¸šåŠ¡ä¸­æ˜¯è¿™ä¹ˆä½¿ç”¨ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">  <span class="built_in">module</span>.hot.accept(<span class="string">&#x27;./library.js&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨æ›´æ–°è¿‡çš„ library æ¨¡å—æ‰§è¡ŒæŸäº›æ“ä½œ...</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="11-çƒ­æ›´æ–°é”™è¯¯å¤„ç†"><a href="#11-çƒ­æ›´æ–°é”™è¯¯å¤„ç†" class="headerlink" title="11.çƒ­æ›´æ–°é”™è¯¯å¤„ç†"></a>11.çƒ­æ›´æ–°é”™è¯¯å¤„ç†</h2><p>åœ¨çƒ­æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œ<code>hotApply</code> è¿‡ç¨‹ä¸­å¯èƒ½å‡ºç° <code>abort</code> æˆ–è€… <code>fail</code> é”™è¯¯ï¼Œåˆ™çƒ­æ›´æ–°é€€å›åˆ°åˆ·æ–°æµè§ˆå™¨ï¼ˆBrowser Reloadï¼‰ï¼Œæ•´ä¸ªæ¨¡å—çƒ­æ›´æ–°å®Œæˆã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack\hot\dev-server.js Line 13</span></span><br><span class="line"><span class="built_in">module</span>.hot.check(<span class="literal">true</span>).then(<span class="function"><span class="keyword">function</span> (<span class="params">updatedModules</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!updatedModules) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">window</span>.location.reload();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> status = <span class="built_in">module</span>.hot.status();</span><br><span class="line">    <span class="keyword">if</span> ([<span class="string">&quot;abort&quot;</span>, <span class="string">&quot;fail&quot;</span>].indexOf(status) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">window</span>.location.reload();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="äº”ã€æ€»ç»“"><a href="#äº”ã€æ€»ç»“" class="headerlink" title="äº”ã€æ€»ç»“"></a>äº”ã€æ€»ç»“</h1><p>æœ¬æ–‡ä¸»è¦â€‹å’Œå¤§å®¶åˆ†äº« Webpack çš„ HMR ä½¿ç”¨å’Œå®ç°åŸç†åŠæºç åˆ†æï¼Œåœ¨æºç åˆ†æä¸­ï¼Œé€šè¿‡ä¸€å¼ â€œWebpack HMR å·¥ä½œåŸç†è§£æâ€å›¾è®©å¤§å®¶å¯¹ HMR æ•´ä¸ªå·¥ä½œæµç¨‹æœ‰æ‰€äº†è§£ï¼ŒHMR æœ¬èº«æºç å†…å®¹è¾ƒå¤šï¼Œè®¸å¤šç»†èŠ‚ä¹‹å¤„æœ¬æ–‡æ²¡æœ‰å®Œæ•´å†™å‡ºï¼Œéœ€è¦å„ä½è¯»è€…è‡ªå·±æ…¢æ…¢é˜…è¯»å’Œç†è§£æºç ã€‚</p>
<h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><p>1.å®˜æ–¹æ–‡æ¡£<a target="_blank" rel="noopener" href="https://webpack.js.org/guides/hot-module-replacement/">ã€ŠHot Module Replacementã€‹</a><br />2.<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/30669007">ã€ŠWebpack HMR åŸç†è§£æã€‹</a><br />3.<a href="www.ayqy.net/blog/hot-module-replacement/">ã€Šwebpack HMRã€‹</a>Â <br />4.<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000020293167">ã€Šé…ç½® dev-serverã€‹</a>Â </p>
<p><img src="http://images.pingan8787.com/2019_07_12guild_page.png" alt="bg"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/06/17/207-%E3%80%90Webpack%E3%80%91%E4%BA%86%E4%B8%8D%E8%B5%B7%E7%9A%84Webpack-HMR%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97%EF%BC%88%E5%90%AB%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%89/" data-id="ckts3ejyq00n44d9keybw349e" data-title="207-ã€Webpackã€‘äº†ä¸èµ·çš„ Webpack HMR å­¦ä¹ æŒ‡å—ï¼ˆå«æºç åˆ†æï¼‰" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Webpack/" rel="tag">Webpack</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">å‰ç«¯å¼€å‘</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">åŸåˆ›</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag">è¯»ä¹¦ç¬”è®°</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-206-ã€è¯»ä¹¦ã€‘è¯»ã€Šä½ ä¸çŸ¥é“çš„WeakMapã€‹æ€»ç»“" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/06/06/206-%E3%80%90%E8%AF%BB%E4%B9%A6%E3%80%91%E8%AF%BB%E3%80%8A%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84WeakMap%E3%80%8B%E6%80%BB%E7%BB%93/" class="article-date">
  <time class="dt-published" datetime="2020-06-06T06:22:18.000Z" itemprop="datePublished">2020-06-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/06/06/206-%E3%80%90%E8%AF%BB%E4%B9%A6%E3%80%91%E8%AF%BB%E3%80%8A%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84WeakMap%E3%80%8B%E6%80%BB%E7%BB%93/">206-ã€è¯»ä¹¦ã€‘è¯»ã€Šä½ ä¸çŸ¥é“çš„WeakMapã€‹æ€»ç»“</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>å­¦ä¹ æ—¶é—´ï¼š2020.05.26<br />å­¦ä¹ ç« èŠ‚ï¼š<a target="_blank" rel="noopener" href="https://juejin.im/post/5ecd1ad3e51d45784c52db73">ã€Šä½ ä¸çŸ¥é“çš„ WeakMapã€‹</a></p>
<h1 id="ä¸€ã€ä¸»è¦çŸ¥è¯†ç‚¹"><a href="#ä¸€ã€ä¸»è¦çŸ¥è¯†ç‚¹" class="headerlink" title="ä¸€ã€ä¸»è¦çŸ¥è¯†ç‚¹"></a>ä¸€ã€ä¸»è¦çŸ¥è¯†ç‚¹</h1><p><br />åŸæ–‡ä¸»è¦å¤ä¹ äº†â€œJavaScriptåƒåœ¾å›æ”¶æœºåˆ¶â€ï¼Œâ€œMap/WeakMapåŒºåˆ«â€å’Œâ€œWeakMap å±æ€§å’Œæ–¹æ³•â€ã€‚è¿™å¾ˆå¥½å¼¥è¡¥è¢«æˆ‘å¿½è§†çš„çŸ¥è¯†ç‚¹ã€‚<br />å¦å¤–ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åŸæ–‡ï¼Œä»¥ç›¸åŒæ–¹å¼å†å»å­¦ Set/WeakSetï¼Œæ•ˆæœä¼šæ›´å¥½ï¼Œæœ¬æ–‡åé¢ä¹Ÿä¼šä»‹ç»åˆ°ã€‚<br /><br><br /><strong>æ€»ç»“å¼€å§‹ï¼Œå…ˆçœ‹åŸæ–‡å¤§çº²ï¼š</strong><br /><br><img src="http://images.pingan8787.com/blog/you-dont-know-WeakMap/xmind.png" alt="image.png"><br /></p>
<p><br />åœ¨å¼€å§‹ä»‹ç» WeakMap ä¹‹å‰ï¼Œå…ˆå¤ä¹ ä¸€é JavaScript ä¸­åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œè¿™è·Ÿåé¢çš„ WeakMap/WeakSet å…³ç³»è¾ƒå¤§ã€‚<br /></p>
<h2 id="1-åƒåœ¾å›æ”¶æœºåˆ¶"><a href="#1-åƒåœ¾å›æ”¶æœºåˆ¶" class="headerlink" title="1. åƒåœ¾å›æ”¶æœºåˆ¶"></a>1. åƒåœ¾å›æ”¶æœºåˆ¶</h2><p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-hans/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6_(%E8%A8%88%E7%AE%97%E6%A9%9F%E7%A7%91%E5%AD%B8)">åƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼Œç¼©å†™ä¸ºGCï¼‰</a>æ˜¯ä¸€ç§è‡ªåŠ¨çš„å­˜å‚¨å™¨ç®¡ç†æœºåˆ¶ã€‚å½“æŸä¸ªç¨‹åºå ç”¨çš„ä¸€éƒ¨åˆ†å†…å­˜ç©ºé—´ä¸å†è¢«è¿™ä¸ªç¨‹åºè®¿é—®æ—¶ï¼Œè¿™ä¸ªç¨‹åºä¼šå€ŸåŠ©åƒåœ¾å›æ”¶ç®—æ³•å‘æ“ä½œç³»ç»Ÿå½’è¿˜è¿™éƒ¨åˆ†å†…å­˜ç©ºé—´ã€‚åƒåœ¾å›æ”¶å™¨å¯ä»¥å‡è½»ç¨‹åºå‘˜çš„è´Ÿæ‹…ï¼Œä¹Ÿå‡å°‘ç¨‹åºä¸­çš„é”™è¯¯ã€‚åƒåœ¾å›æ”¶æœ€æ—©èµ·æºäºLISPè¯­è¨€ã€‚<br />ç›®å‰è®¸å¤šè¯­è¨€å¦‚Smalltalkã€Javaã€C#å’ŒDè¯­è¨€éƒ½æ”¯æŒåƒåœ¾å›æ”¶å™¨ï¼Œæˆ‘ä»¬ç†ŸçŸ¥çš„ JavaScript å…·æœ‰è‡ªåŠ¨åƒåœ¾å›æ”¶æœºåˆ¶ã€‚<br /><br><br /><strong>åœ¨ JavaScript ä¸­ï¼ŒåŸå§‹ç±»å‹çš„æ•°æ®è¢«åˆ†é…åˆ°æ ˆç©ºé—´ä¸­ï¼Œå¼•ç”¨ç±»å‹çš„æ•°æ®ä¼šè¢«åˆ†é…åˆ°å †ç©ºé—´ä¸­ã€‚</strong><br />**</p>
<h3 id="1-1-æ ˆç©ºé—´ä¸­çš„åƒåœ¾å›æ”¶"><a href="#1-1-æ ˆç©ºé—´ä¸­çš„åƒåœ¾å›æ”¶" class="headerlink" title="1.1 æ ˆç©ºé—´ä¸­çš„åƒåœ¾å›æ”¶"></a>1.1 æ ˆç©ºé—´ä¸­çš„åƒåœ¾å›æ”¶</h3><p>å½“å‡½æ•° <code>showName</code> è°ƒç”¨å®Œæˆåï¼Œé€šè¿‡ä¸‹ç§» <a target="_blank" rel="noopener" href="https://baike.baidu.com/item/esp/35173">ESPï¼ˆExtended Stack Pointerï¼‰</a>æŒ‡é’ˆï¼Œæ¥é”€æ¯ <code>showName</code> å‡½æ•°ï¼Œä¹‹åè°ƒç”¨å…¶ä»–å‡½æ•°æ—¶ï¼Œå°†è¦†ç›–æ‰æ—§å†…å­˜ï¼Œå­˜æ”¾å¦ä¸€ä¸ªå‡½æ•°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå®ç°åƒåœ¾å›æ”¶ã€‚<br /><img src="http://images.pingan8787.com/blog/you-dont-know-WeakMap/ESP.png" alt="image.png"><br />å›¾ç‰‡æ¥è‡ªã€Šæµè§ˆå™¨å·¥ä½œåŸç†ä¸å®è·µã€‹<br /></p>
<h3 id="1-2-å †ç©ºé—´ä¸­çš„åƒåœ¾å›æ”¶"><a href="#1-2-å †ç©ºé—´ä¸­çš„åƒåœ¾å›æ”¶" class="headerlink" title="1.2 å †ç©ºé—´ä¸­çš„åƒåœ¾å›æ”¶"></a>1.2 å †ç©ºé—´ä¸­çš„åƒåœ¾å›æ”¶</h3><p>å †ä¸­æ•°æ®åƒåœ¾å›æ”¶ç­–ç•¥çš„åŸºç¡€æ˜¯ï¼š<a target="_blank" rel="noopener" href="https://plumbr.io/handbook/garbage-collection-in-java/generational-hypothesis"><strong>ä»£é™…å‡è¯´</strong>ï¼ˆThe Generational Hypothesisï¼‰</a>ã€‚å³ï¼š</p>
<ol>
<li>å¤§éƒ¨åˆ†å¯¹è±¡åœ¨å†…å­˜ä¸­å­˜åœ¨æ—¶é—´æçŸ­ï¼Œå¾ˆå¤šå¯¹è±¡å¾ˆå¿«å°±ä¸å¯è®¿é—®ã€‚</li>
<li>ä¸æ­»çš„å¯¹è±¡å°†æ´»å¾—æ›´ä¹…ã€‚</li>
</ol>
<p><br />è¿™ä¸¤ä¸ªç‰¹ç‚¹ä¸ä»…ä»…é€‚ç”¨äº JavaScriptï¼ŒåŒæ ·é€‚ç”¨äºå¤§å¤šæ•°çš„åŠ¨æ€è¯­è¨€ï¼Œå¦‚ Javaã€Python ç­‰ã€‚<br /><br><br />V8 å¼•æ“å°†å †ç©ºé—´åˆ†ä¸º<strong>æ–°ç”Ÿä»£</strong>ï¼ˆå­˜æ”¾ç”Ÿå­˜<strong>æ—¶é—´çŸ­</strong>çš„å¯¹è±¡ï¼‰å’Œ<strong>è€ç”Ÿä»£</strong>ï¼ˆå­˜æ”¾ç”Ÿå­˜<strong>æ—¶é—´é•¿</strong>çš„å¯¹è±¡ï¼‰ä¸¤ä¸ªåŒºåŸŸï¼Œå¹¶ä½¿ç”¨ä¸åŒçš„åƒåœ¾å›æ”¶å™¨ã€‚<br /><br><br /></p>
<ul>
<li>å‰¯åƒåœ¾å›æ”¶å™¨ï¼Œä¸»è¦è´Ÿè´£æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶ã€‚</li>
<li>ä¸»åƒåœ¾å›æ”¶å™¨ï¼Œä¸»è¦è´Ÿè´£è€ç”Ÿä»£çš„åƒåœ¾å›æ”¶ã€‚</li>
</ul>
<p><br />ä¸ç®¡æ˜¯å“ªç§åƒåœ¾å›æ”¶å™¨ï¼Œéƒ½ä½¿ç”¨ç›¸åŒåƒåœ¾å›æ”¶æµç¨‹ï¼š<strong>æ ‡è®°æ´»åŠ¨å¯¹è±¡å’Œéæ´»åŠ¨å¯¹è±¡ï¼Œå›æ”¶éæ´»åŠ¨å¯¹è±¡çš„å†…å­˜ï¼Œæœ€åå†…å­˜æ•´ç†ã€‚</strong><br />**</p>
<h4 id="1-2-1-å‰¯åƒåœ¾å›æ”¶å™¨"><a href="#1-2-1-å‰¯åƒåœ¾å›æ”¶å™¨" class="headerlink" title="1.2.1 å‰¯åƒåœ¾å›æ”¶å™¨"></a>1.2.1 å‰¯åƒåœ¾å›æ”¶å™¨</h4><p>ä½¿ç”¨ Scavenge ç®—æ³•å¤„ç†ï¼Œå°†æ–°ç”Ÿä»£ç©ºé—´å¯¹åŠåˆ†ä¸ºä¸¤ä¸ªåŒºåŸŸï¼Œä¸€ä¸ªå¯¹è±¡åŒºåŸŸï¼Œä¸€ä¸ªç©ºé—²åŒºåŸŸã€‚<br /><img src="http://images.pingan8787.com/blog/you-dont-know-WeakMap/Scavenge.png" alt="image.png"><br />å›¾ç‰‡æ¥è‡ªã€Šæµè§ˆå™¨å·¥ä½œåŸç†ä¸å®è·µã€‹<br /><br><br />æ‰§è¡Œæµç¨‹ï¼š</p>
<ul>
<li>æ–°å¯¹è±¡å­˜åœ¨åœ¨<strong>å¯¹è±¡åŒºåŸŸ</strong>ï¼Œå½“å¯¹è±¡åŒºåŸŸå°†è¦å†™æ»¡æ—¶ï¼Œæ‰§è¡Œä¸€æ¬¡åƒåœ¾å›æ”¶ï¼›</li>
<li>åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆå¯¹å¯¹è±¡åŒºåŸŸä¸­çš„åƒåœ¾åšæ ‡è®°ï¼Œç„¶åå‰¯åƒåœ¾å›æ”¶å™¨å°†å­˜æ´»çš„å¯¹è±¡å¤åˆ¶å¹¶æœ‰åºæ’åˆ—åˆ°ç©ºé—²åŒºåŸŸï¼Œç›¸å½“äºå®Œæˆå†…å­˜æ•´ç†ã€‚</li>
<li>å¤åˆ¶å®Œæˆåï¼Œå°†å¯¹è±¡åŒºåŸŸå’Œç©ºé—²åŒºåŸŸç¿»è½¬ï¼Œå®Œæˆåƒåœ¾å›æ”¶æ“ä½œï¼Œè¿™ä¹Ÿè®©æ–°ç”Ÿä»£ä¸­ä¸¤å—åŒºåŸŸæ— é™é‡å¤ä½¿ç”¨ã€‚</li>
</ul>
<p><br />å½“ç„¶ï¼Œè¿™ä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ï¼šè‹¥å¤åˆ¶æ“ä½œçš„æ•°æ®è¾ƒå¤§åˆ™å½±å“æ¸…ç†æ•ˆç‡ã€‚<br /><br><br />JavaScript å¼•æ“çš„è§£å†³æ–¹å¼æ˜¯ï¼šå°†æ–°ç”Ÿä»£åŒºåŸŸè®¾ç½®å¾—æ¯”è¾ƒå°ï¼Œå¹¶é‡‡ç”¨å¯¹è±¡æ™‹å‡ç­–ç•¥ï¼ˆç»è¿‡ä¸¤æ¬¡å›æ”¶ä»å­˜æ´»çš„å¯¹è±¡ï¼Œä¼šè¢«ç§»åŠ¨åˆ°è€ç”ŸåŒºï¼‰ï¼Œé¿å…å› ä¸ºæ–°ç”Ÿä»£åŒºåŸŸè¾ƒå°å¼•èµ·å­˜æ´»å¯¹è±¡è£…æ»¡æ•´ä¸ªåŒºåŸŸçš„é—®é¢˜ã€‚<br /><br><br /></p>
<h4 id="1-2-2-ä¸»åƒåœ¾å›æ”¶å™¨"><a href="#1-2-2-ä¸»åƒåœ¾å›æ”¶å™¨" class="headerlink" title="1.2.2 ä¸»åƒåœ¾å›æ”¶å™¨"></a>1.2.2 ä¸»åƒåœ¾å›æ”¶å™¨</h4><p>åˆ†ä¸ºï¼š<strong>æ ‡è®° - æ¸…é™¤ï¼ˆMark-Sweepï¼‰ç®—æ³•</strong>ï¼Œå’Œ<strong>æ ‡è®° - æ•´ç†ï¼ˆMark-Compactï¼‰ç®—æ³•</strong>ã€‚<br /><br><br /><strong>a)æ ‡è®° - æ¸…é™¤ï¼ˆMark-Sweepï¼‰ç®—æ³•</strong><br /><strong>è¿‡ç¨‹ï¼š</strong></p>
<ul>
<li>æ ‡è®°è¿‡ç¨‹ï¼šä»ä¸€ç»„æ ¹å…ƒç´ å¼€å§‹éå†æ•´ä¸ªå…ƒç´ ï¼Œèƒ½åˆ°è¾¾çš„å…ƒç´ ä¸ºæ´»åŠ¨å¯¹è±¡ï¼Œåä¹‹ä¸ºåƒåœ¾æ•°æ®ï¼›</li>
<li>æ¸…é™¤è¿‡ç¨‹ï¼šæ¸…ç†è¢«æ ‡è®°çš„æ•°æ®ï¼Œå¹¶äº§ç”Ÿå¤§é‡ç¢ç‰‡å†…å­˜ã€‚ï¼ˆç¼ºç‚¹ï¼šå¯¼è‡´å¤§å¯¹è±¡æ— æ³•åˆ†é…åˆ°è¶³å¤Ÿçš„è¿ç»­å†…å­˜ï¼‰</li>
</ul>
<p><img src="http://images.pingan8787.com/blog/you-dont-know-WeakMap/Mark-Sweep.png" alt="image.png"><br />å›¾ç‰‡æ¥è‡ªã€Šæµè§ˆå™¨å·¥ä½œåŸç†ä¸å®è·µã€‹<br /><br><br /><strong>b)æ ‡è®° - æ•´ç†ï¼ˆMark-Compactï¼‰ç®—æ³•</strong><br /><strong>è¿‡ç¨‹ï¼š</strong></p>
<ul>
<li>æ ‡è®°è¿‡ç¨‹ï¼šä»ä¸€ç»„æ ¹å…ƒç´ å¼€å§‹éå†æ•´ä¸ªå…ƒç´ ï¼Œèƒ½åˆ°è¾¾çš„å…ƒç´ ä¸ºæ´»åŠ¨å¯¹è±¡ï¼Œåä¹‹ä¸ºåƒåœ¾æ•°æ®ï¼›</li>
<li>æ•´ç†è¿‡ç¨‹ï¼šå°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡ï¼Œå‘ä¸€æ®µç§»åŠ¨ï¼Œç„¶åæ¸…é™¤ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å®¹ã€‚</li>
</ul>
<p><img src="http://images.pingan8787.com/blog/you-dont-know-WeakMap/Mark-Compact.png" alt="image.png"><br />å›¾ç‰‡æ¥è‡ªã€Šæµè§ˆå™¨å·¥ä½œåŸç†ä¸å®è·µã€‹</p>
<h3 id="1-3-æ‹“å±•é˜…è¯»"><a href="#1-3-æ‹“å±•é˜…è¯»" class="headerlink" title="1.3 æ‹“å±•é˜…è¯»"></a>1.3 æ‹“å±•é˜…è¯»</h3><p>1.<a target="_blank" rel="noopener" href="https://blog.csdn.net/justloveyou_/article/details/71216049">ã€Šå›¾è§£Java åƒåœ¾å›æ”¶æœºåˆ¶ã€‹</a><br />2.<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Memory_Management">ã€ŠMDN å†…å­˜ç®¡ç†ã€‹</a><br /></p>
<h2 id="2-Map-VS-WeakMap"><a href="#2-Map-VS-WeakMap" class="headerlink" title="2. Map VS WeakMap"></a>2. Map VS WeakMap</h2><h3 id="2-1-Map-å’Œ-WeakMap-ä¸»è¦åŒºåˆ«"><a href="#2-1-Map-å’Œ-WeakMap-ä¸»è¦åŒºåˆ«" class="headerlink" title="2.1 Map å’Œ WeakMap ä¸»è¦åŒºåˆ«"></a>2.1 Map å’Œ WeakMap ä¸»è¦åŒºåˆ«</h3><p><code>WeakMap</code> ç»“æ„ä¸ <code>Map</code> ç»“æ„ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ç”¨äºç”Ÿæˆé”®å€¼å¯¹çš„é›†åˆã€‚<br />åŒºåˆ«ï¼š</p>
<ul>
<li><p><code>Map</code> Â å¯¹è±¡çš„é”®å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼Œä½† <code>WeakMap</code> Â å¯¹è±¡ä¸­çš„é”®åªèƒ½æ˜¯å¯¹è±¡å¼•ç”¨ï¼ˆ <code>null</code> é™¤å¤–ï¼‰ï¼›</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line">map.set(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="comment">// TypeError: 1 is not an object!</span></span><br><span class="line">map.set(<span class="built_in">Symbol</span>(), <span class="number">2</span>)</span><br><span class="line"><span class="comment">// TypeError: Invalid value used as weak map key</span></span><br><span class="line">map.set(<span class="literal">null</span>, <span class="number">2</span>)</span><br><span class="line"><span class="comment">// TypeError: Invalid value used as weak map key</span></span><br></pre></td></tr></table></figure></li>
<li><p><code>WeakMap</code> Â ä¸èƒ½åŒ…å«æ— å¼•ç”¨çš„å¯¹è±¡ï¼Œå¦åˆ™ä¼šè¢«è‡ªåŠ¨æ¸…é™¤å‡ºé›†åˆï¼ˆåƒåœ¾å›æ”¶æœºåˆ¶ï¼‰ï¼›</p>
</li>
<li><p><code>WeakMap</code> Â å¯¹è±¡æ²¡æœ‰ <code>size</code> å±æ€§ï¼Œæ˜¯ä¸å¯æšä¸¾çš„ï¼Œæ— æ³•è·å–é›†åˆçš„å¤§å°ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"><span class="keyword">const</span> user1 = &#123;<span class="attr">name</span>: <span class="string">&#x27;leo&#x27;</span>&#125;;</span><br><span class="line"><span class="keyword">const</span> user2 = &#123;<span class="attr">name</span>: <span class="string">&#x27;pingan&#x27;</span>&#125;;</span><br><span class="line">map.set(user1, <span class="string">&#x27;good~&#x27;</span>);</span><br><span class="line">map.set(user2, <span class="string">&#x27;hello&#x27;</span>);</span><br><span class="line">map.map(<span class="function"><span class="params">item</span> =&gt;</span> <span class="built_in">console</span>.log(item))</span><br><span class="line"><span class="comment">//Uncaught TypeError: map.map is not a function</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-2-Map-ç¼ºç‚¹å’Œ-WeakMap-ä¼˜ç‚¹"><a href="#2-2-Map-ç¼ºç‚¹å’Œ-WeakMap-ä¼˜ç‚¹" class="headerlink" title="2.2 Map ç¼ºç‚¹å’Œ WeakMap ä¼˜ç‚¹"></a>2.2 Map ç¼ºç‚¹å’Œ WeakMap ä¼˜ç‚¹</h3><p>1.èµ‹å€¼å’Œæœç´¢æ“ä½œéƒ½æ˜¯ O(n) çš„æ—¶é—´å¤æ‚åº¦ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªæ“ä½œéƒ½éœ€è¦éå†å…¨éƒ¨æ•´ä¸ªæ•°ç»„æ¥è¿›è¡ŒåŒ¹é…ã€‚<br />2.å¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼Œå› ä¸ºæ•°ç»„ä¼šä¸€ç›´å¼•ç”¨ç€æ¯ä¸ªé”®å’Œå€¼ã€‚<br /><br><br />ç›¸æ¯”ä¹‹ä¸‹ï¼Œ <code>WeakMap</code> Â æŒæœ‰çš„æ˜¯æ¯ä¸ªé”®å¯¹è±¡çš„ â€œå¼±å¼•ç”¨â€ï¼Œè¿™æ„å‘³ç€åœ¨æ²¡æœ‰å…¶ä»–å¼•ç”¨å­˜åœ¨æ—¶åƒåœ¾å›æ”¶èƒ½æ­£ç¡®è¿›è¡Œã€‚ åŸç”Ÿ <code>WeakMap </code> çš„ç»“æ„æ˜¯ç‰¹æ®Šä¸”æœ‰æ•ˆçš„ï¼Œå…¶ç”¨äºæ˜ å°„çš„ key åªæœ‰åœ¨å…¶æ²¡æœ‰è¢«å›æ”¶æ—¶æ‰æ˜¯æœ‰æ•ˆçš„ã€‚<br /><br><br /></p>
<h3 id="2-3-Map-å’Œ-WeakMap-åƒåœ¾å›æ”¶å¯¹æ¯”"><a href="#2-3-Map-å’Œ-WeakMap-åƒåœ¾å›æ”¶å¯¹æ¯”" class="headerlink" title="2.3 Map å’Œ WeakMap åƒåœ¾å›æ”¶å¯¹æ¯”"></a>2.3 Map å’Œ WeakMap åƒåœ¾å›æ”¶å¯¹æ¯”</h3><p>å½“æ•°æ®é‡è¶Šå¤§ï¼Œåˆ™åƒåœ¾å›æ”¶æ•ˆæœè¶Šæ˜æ˜¾ã€‚<br />é€šè¿‡å‘½ä»¤è¡Œæ‰§è¡Œ <code>node --expose-gc weakmap.js</code> æŸ¥çœ‹å¯¹æ¯”æ•ˆæœã€‚<br />å…¶ä¸­ <code>--expose-gc</code> å‚æ•°è¡¨ç¤ºå…è®¸æ‰‹åŠ¨æ‰§è¡Œåƒåœ¾å›æ”¶æœºåˆ¶ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// weakmap.js</span></span><br><span class="line"><span class="keyword">const</span> objNum = <span class="number">10</span> * <span class="number">1024</span> * <span class="number">1024</span>;</span><br><span class="line"><span class="keyword">const</span> useType = <span class="number">1</span>; <span class="comment">// ä¿®æ”¹ useType å€¼æ¥æµ‹è¯•Mapå’ŒWeakMap</span></span><br><span class="line"><span class="keyword">const</span> curType = useType == <span class="number">1</span> ?<span class="string">&quot;ã€Mapã€‘&quot;</span> : <span class="string">&quot;ã€WeakMapã€‘&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> arr = <span class="keyword">new</span> <span class="built_in">Array</span>(objNum);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">usageSize</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> used = process.memoryUsage().heapUsed;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.round((used / <span class="number">1024</span> / <span class="number">1024</span>) * <span class="number">100</span>) / <span class="number">100</span> + <span class="string">&quot;M&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (useType == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="built_in">global</span>.gc();</span><br><span class="line">    <span class="built_in">console</span>.log(objNum + <span class="string">&#x27;ä¸ª&#x27;</span> + curType + <span class="string">&#x27;å ç”¨å†…å­˜ï¼š&#x27;</span> + usageSize());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">    map.set(arr, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">global</span>.gc();</span><br><span class="line">    <span class="built_in">console</span>.log(objNum + <span class="string">&#x27;ä¸ª&#x27;</span> + curType + <span class="string">&#x27;å ç”¨å†…å­˜ï¼š&#x27;</span> + usageSize());</span><br><span class="line"></span><br><span class="line">    arr = <span class="literal">null</span>;</span><br><span class="line">    <span class="built_in">global</span>.gc();</span><br><span class="line">    <span class="built_in">console</span>.log(objNum + <span class="string">&#x27;ä¸ª&#x27;</span> + curType + <span class="string">&#x27;å ç”¨å†…å­˜ï¼š&#x27;</span> + usageSize());</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;=====&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">global</span>.gc();</span><br><span class="line">    <span class="built_in">console</span>.log(objNum + <span class="string">&#x27;ä¸ª&#x27;</span> + curType + <span class="string">&#x27;å ç”¨å†…å­˜ï¼š&#x27;</span> + usageSize());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> map = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">global</span>.gc();</span><br><span class="line">    <span class="built_in">console</span>.log(objNum + <span class="string">&#x27;ä¸ª&#x27;</span> + curType + <span class="string">&#x27;å ç”¨å†…å­˜ï¼š&#x27;</span> + usageSize());</span><br><span class="line"></span><br><span class="line">    arr = <span class="literal">null</span>;</span><br><span class="line">    <span class="built_in">global</span>.gc();</span><br><span class="line">    <span class="built_in">console</span>.log(objNum + <span class="string">&#x27;ä¸ª&#x27;</span> + curType + <span class="string">&#x27;å ç”¨å†…å­˜ï¼š&#x27;</span> + usageSize());</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;=====&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="3-WeakMapä»‹ç»å’Œåº”ç”¨"><a href="#3-WeakMapä»‹ç»å’Œåº”ç”¨" class="headerlink" title="3. WeakMapä»‹ç»å’Œåº”ç”¨"></a>3. WeakMapä»‹ç»å’Œåº”ç”¨</h2><h3 id="3-1-WeakMap-ä»‹ç»"><a href="#3-1-WeakMap-ä»‹ç»" class="headerlink" title="3.1 WeakMap ä»‹ç»"></a>3.1 WeakMap ä»‹ç»</h3><p><code>WeakMap</code>  å¯¹è±¡æ˜¯ä¸€ç»„é”®/å€¼å¯¹çš„é›†åˆï¼Œå…¶ä¸­çš„é”®æ˜¯ <strong>å¼±å¼•ç”¨</strong> çš„ã€‚<br /><strong>WeakMap çš„ key åªèƒ½æ˜¯ Object ç±»å‹ã€‚</strong><br />** åŸå§‹æ•°æ®ç±»å‹æ˜¯ä¸èƒ½ä½œä¸º key çš„ï¼ˆæ¯”å¦‚ Symbolï¼‰ã€‚**<br /><code>WeakMap</code>åªæœ‰å››ä¸ªæ–¹æ³•å¯ç”¨ï¼š<code>get()</code>ã€<code>set()</code>ã€<code>has()</code>ã€<code>delete()</code>ã€‚<br />**<br />å…·ä½“å±æ€§å’Œæ–¹æ³•ä»‹ç»ï¼Œå¯æŸ¥çœ‹ ã€Š<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/WeakMap">MDN WeakMap</a>ã€‹ã€‚<br /></p>
<h3 id="3-2-WeakMap-åº”ç”¨"><a href="#3-2-WeakMap-åº”ç”¨" class="headerlink" title="3.2 WeakMap åº”ç”¨"></a>3.2 WeakMap åº”ç”¨</h3><p>åŸæ–‡ä¸­ä»‹ç»äº†â€œé€šè¿‡ WeakMap ç¼“å­˜è®¡ç®—ç»“æœâ€å’Œâ€œåœ¨ WeakMap ä¸­ä¿ç•™ç§æœ‰æ•°æ®â€ä¸¤ç§åº”ç”¨åœºæ™¯ã€‚<br />å¦å¤–è¿˜æœ‰ä¸€ç§æ¯”è¾ƒå¸¸è§çš„åœºæ™¯ï¼š<strong>ä»¥ DOMèŠ‚ç‚¹ä½œä¸ºé”®åçš„åœºæ™¯</strong>ã€‚<br /><br><br /><strong>åœºæ™¯1ï¼šå½“æˆ‘ä»¬æƒ³è¦ä¸ºDOMæ·»åŠ æ•°æ®æ—¶ï¼Œå¯ä½¿ç”¨ <code>WeakMap</code> ã€‚</strong><br />å¥½å¤„åœ¨äºï¼Œå½“DOMå…ƒç´ ç§»é™¤æ—¶ï¼Œå¯¹åº” WeakMap è®°å½•ä¹Ÿä¼šè‡ªåŠ¨ç§»é™¤ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;WeakMap&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wm = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"><span class="keyword">const</span> weakMap = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;WeakMap&#x27;</span>);</span><br><span class="line">wm.set(weakMap, <span class="string">&#x27;some information&#x27;</span>);</span><br><span class="line">wm.get(weakMap) <span class="comment">//&quot;some information&quot;</span></span><br></pre></td></tr></table></figure>
<p><strong>åœºæ™¯2ï¼šå½“æˆ‘ä»¬æƒ³è¦ä¸ºDOMå…ƒç´ æ·»åŠ äº‹ä»¶ç›‘å¬æ—¶ï¼Œå¯ä½¿ç”¨ <code>WeakMap</code> ã€‚</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;button1&quot;</span>&gt;</span>æŒ‰é’®1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;button2&quot;</span>&gt;</span>æŒ‰é’®2<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> button1 = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;button1&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> button2 = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;button2&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> handler1 = <span class="function">() =&gt;</span> &#123;  <span class="built_in">console</span>.log(<span class="string">&quot;button1 è¢«ç‚¹å‡»&quot;</span>) &#125;;</span><br><span class="line"><span class="keyword">const</span> handler2 = <span class="function">() =&gt;</span> &#123;  <span class="built_in">console</span>.log(<span class="string">&quot;button2 è¢«ç‚¹å‡»&quot;</span>) &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»£ç 1</span></span><br><span class="line">button1.addEventListener(<span class="string">&#x27;click&#x27;</span>, handler1, <span class="literal">false</span>);</span><br><span class="line">button2.addEventListener(<span class="string">&#x27;click&#x27;</span>, handler2, <span class="literal">false</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// ä»£ç 2</span></span><br><span class="line"><span class="keyword">const</span> listener = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"> </span><br><span class="line">listener.set(button1, handler1);</span><br><span class="line">listener.set(button2, handler2);</span><br><span class="line"> </span><br><span class="line">button1.addEventListener(<span class="string">&#x27;click&#x27;</span>, listener.get(button1), <span class="literal">false</span>);</span><br><span class="line">button2.addEventListener(<span class="string">&#x27;click&#x27;</span>, listener.get(button2), <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<p>ä»£ç 2æ¯”èµ·ä»£ç 1çš„å¥½å¤„æ˜¯ï¼šç”±äºç›‘å¬å‡½æ•°æ˜¯æ”¾åœ¨ WeakMap é‡Œé¢ï¼Œ<br />åˆ™ä¸€æ—¦ DOM å¯¹è±¡button1 / button2æ¶ˆå¤±ï¼Œä¸å®ƒç»‘å®šçš„ç›‘å¬å‡½æ•°handler1å’Œhandler2 ä¹Ÿä¼šè‡ªåŠ¨æ¶ˆå¤±ã€‚<br /></p>
<h1 id="äºŒã€æ‹“å±•çŸ¥è¯†"><a href="#äºŒã€æ‹“å±•çŸ¥è¯†" class="headerlink" title="äºŒã€æ‹“å±•çŸ¥è¯†"></a>äºŒã€æ‹“å±•çŸ¥è¯†</h1><h2 id="1-æ‹“å±•-Set-WeakSet"><a href="#1-æ‹“å±•-Set-WeakSet" class="headerlink" title="1. æ‹“å±• Set/WeakSet"></a>1. æ‹“å±• Set/WeakSet</h2><h3 id="1-1-Set-å’Œ-WeakSet-ä¸»è¦åŒºåˆ«"><a href="#1-1-Set-å’Œ-WeakSet-ä¸»è¦åŒºåˆ«" class="headerlink" title="1.1 Set å’Œ WeakSet ä¸»è¦åŒºåˆ«"></a>1.1 Set å’Œ WeakSet ä¸»è¦åŒºåˆ«</h3><p><code>WeakSet</code> Â ç»“æ„ä¸ <code>Set</code> ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä¸é‡å¤çš„å€¼çš„é›†åˆã€‚<br />åŒºåˆ«ï¼š</p>
<ul>
<li><p><code>WeakSet</code> çš„æˆå‘˜åªèƒ½æ˜¯å¯¹è±¡ï¼Œè€Œä¸èƒ½æ˜¯å…¶ä»–ç±»å‹çš„å€¼ï¼›</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ws = <span class="keyword">new</span> <span class="built_in">WeakSet</span>();</span><br><span class="line">ws.add(<span class="number">1</span>)</span><br><span class="line"><span class="comment">// TypeError: Invalid value used in weak set</span></span><br><span class="line">ws.add(<span class="built_in">Symbol</span>())</span><br><span class="line"><span class="comment">// TypeError: invalid value used in weak set</span></span><br></pre></td></tr></table></figure></li>
<li><p><code>WeakSet</code> Â ä¸­çš„å¯¹è±¡éƒ½æ˜¯å¼±å¼•ç”¨ï¼Œå³åƒåœ¾å›æ”¶æœºåˆ¶ä¸è€ƒè™‘ <code>WeakSet</code> Â å¯¹è¯¥å¯¹è±¡çš„å¼•ç”¨;</p>
</li>
<li><p><code>WeakSet</code> Â å¯¹è±¡æ²¡æœ‰ <code>size</code> å±æ€§ï¼Œæ˜¯ä¸å¯æšä¸¾çš„ï¼Œæ— æ³•è·å–é›†åˆçš„å¤§å°ã€‚</p>
</li>
</ul>
<h3 id="1-2-Set-WeakSet-åƒåœ¾å›æ”¶å¯¹æ¯”"><a href="#1-2-Set-WeakSet-åƒåœ¾å›æ”¶å¯¹æ¯”" class="headerlink" title="1.2 Set/WeakSet åƒåœ¾å›æ”¶å¯¹æ¯”"></a>1.2 Set/WeakSet åƒåœ¾å›æ”¶å¯¹æ¯”</h3><p>é€šè¿‡å‘½ä»¤è¡Œæ‰§è¡Œ <code>node --expose-gc weakset.js</code> æŸ¥çœ‹å¯¹æ¯”æ•ˆæœã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// weakset.js</span></span><br><span class="line"><span class="keyword">const</span> objNum = <span class="number">5000</span> * <span class="number">1024</span>;</span><br><span class="line"><span class="keyword">const</span> useType = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> curType = useType == <span class="number">1</span> ?<span class="string">&quot;ã€Setã€‘&quot;</span> : <span class="string">&quot;ã€WeakSetã€‘&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> obj = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> k = <span class="number">0</span>; k &lt; objNum; k++) &#123;</span><br><span class="line">    obj[k] = &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">usageSize</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> used = process.memoryUsage().heapUsed;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.round((used / <span class="number">1024</span> / <span class="number">1024</span>) * <span class="number">100</span>) / <span class="number">100</span> + <span class="string">&quot;M&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (useType == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="built_in">global</span>.gc();</span><br><span class="line">    <span class="built_in">console</span>.log(objNum + <span class="string">&#x27;ä¸ª&#x27;</span> + curType + <span class="string">&#x27;å ç”¨å†…å­˜ï¼š&#x27;</span> + usageSize());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> sets = <span class="keyword">new</span> <span class="built_in">Set</span>([...obj]);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">global</span>.gc();</span><br><span class="line">    <span class="built_in">console</span>.log(objNum + <span class="string">&#x27;ä¸ª&#x27;</span> + curType + <span class="string">&#x27;å ç”¨å†…å­˜ï¼š&#x27;</span> + usageSize());</span><br><span class="line"></span><br><span class="line">    obj = <span class="literal">null</span>;</span><br><span class="line">    <span class="built_in">global</span>.gc();</span><br><span class="line">    <span class="built_in">console</span>.log(objNum + <span class="string">&#x27;ä¸ª&#x27;</span> + curType + <span class="string">&#x27;å ç”¨å†…å­˜ï¼š&#x27;</span> + usageSize());</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;=====&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">global</span>.gc();</span><br><span class="line">    <span class="built_in">console</span>.log(objNum + <span class="string">&#x27;ä¸ª&#x27;</span> + curType + <span class="string">&#x27;å ç”¨å†…å­˜ï¼š&#x27;</span> + usageSize());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> sets = <span class="keyword">new</span> <span class="built_in">WeakSet</span>(obj);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">global</span>.gc();</span><br><span class="line">    <span class="built_in">console</span>.log(objNum + <span class="string">&#x27;ä¸ª&#x27;</span> + curType + <span class="string">&#x27;å ç”¨å†…å­˜ï¼š&#x27;</span> + usageSize());</span><br><span class="line"></span><br><span class="line">    obj = <span class="literal">null</span>;</span><br><span class="line">    <span class="built_in">global</span>.gc();</span><br><span class="line">    <span class="built_in">console</span>.log(objNum + <span class="string">&#x27;ä¸ª&#x27;</span> + curType + <span class="string">&#x27;å ç”¨å†…å­˜ï¼š&#x27;</span> + usageSize());</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;=====&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="ä¸‰ã€æ€»ç»“"><a href="#ä¸‰ã€æ€»ç»“" class="headerlink" title="ä¸‰ã€æ€»ç»“"></a>ä¸‰ã€æ€»ç»“</h1><p>æœ¬æ–‡é¦–å…ˆå¤ä¹ äº†ã€Šä½ ä¸çŸ¥é“çš„ WeakMapã€‹ä¸­æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼Œé‡æ–°å›é¡¾äº†â€œåƒåœ¾å›æ”¶æœºåˆ¶â€ï¼Œâ€œMap VS WeakMapâ€å’Œâ€œWeakMap ä»‹ç»å’Œåº”ç”¨â€ï¼Œæœ€åå»¶ä¼¸å¤ä¹ äº†â€œSet/WeakSetâ€ç›¸å…³çŸ¥è¯†ç‚¹ã€‚<br />åœ¨å®é™…ä¸šåŠ¡å¼€å‘ä¸­ï¼Œæœ€å¥½ä¹Ÿèƒ½è€ƒè™‘åƒåœ¾å›æ”¶æœºåˆ¶çš„åˆç†ä½¿ç”¨ï¼Œè¿™ä¹Ÿæ˜¯æå‡äº§å“æ€§èƒ½çš„ä¸€ä¸ªéå¸¸å¸¸ç”¨çš„æ–¹å¼ã€‚</p>
<table>
<thead>
<tr>
<th>Author</th>
<th>ç‹å¹³å®‰</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#x70;&#x69;&#110;&#x67;&#97;&#x6e;&#x38;&#55;&#x38;&#x37;&#x40;&#x71;&#x71;&#x2e;&#99;&#x6f;&#x6d;">&#x70;&#x69;&#110;&#x67;&#97;&#x6e;&#x38;&#55;&#x38;&#x37;&#x40;&#x71;&#x71;&#x2e;&#99;&#x6f;&#x6d;</a></td>
</tr>
<tr>
<td>åš  å®¢</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>å¾®  ä¿¡</td>
<td>pingan8787</td>
</tr>
<tr>
<td>æ¯æ—¥æ–‡ç« æ¨è</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>ESå°å†Œ</td>
<td>js.pingan8787.com</td>
</tr>
<tr>
<td>è¯­é›€çŸ¥è¯†åº“</td>
<td><a target="_blank" rel="noopener" href="https://www.yuque.com/wangpingan/cute-frontend">Cute-FrontEnd</a></td>
</tr>
</tbody></table>
<p><img src="http://images.pingan8787.com/2019_07_12guild_page.png" alt="bg"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/06/06/206-%E3%80%90%E8%AF%BB%E4%B9%A6%E3%80%91%E8%AF%BB%E3%80%8A%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84WeakMap%E3%80%8B%E6%80%BB%E7%BB%93/" data-id="ckts3eju6005t4d9k64fsemef" data-title="206-ã€è¯»ä¹¦ã€‘è¯»ã€Šä½ ä¸çŸ¥é“çš„WeakMapã€‹æ€»ç»“" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">å‰ç«¯å¼€å‘</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">åŸåˆ›</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag">è¯»ä¹¦ç¬”è®°</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-205-ã€è¯»ä¹¦ã€‘è¯»ã€Šä½ ä¸çŸ¥é“çš„Blobã€‹æ€»ç»“" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/06/06/205-%E3%80%90%E8%AF%BB%E4%B9%A6%E3%80%91%E8%AF%BB%E3%80%8A%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84Blob%E3%80%8B%E6%80%BB%E7%BB%93/" class="article-date">
  <time class="dt-published" datetime="2020-06-06T05:53:10.000Z" itemprop="datePublished">2020-06-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/06/06/205-%E3%80%90%E8%AF%BB%E4%B9%A6%E3%80%91%E8%AF%BB%E3%80%8A%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84Blob%E3%80%8B%E6%80%BB%E7%BB%93/">205-ã€è¯»ä¹¦ã€‘è¯»ã€Šä½ ä¸çŸ¥é“çš„Blobã€‹æ€»ç»“</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>å­¦ä¹ æ—¶é—´ï¼š2020.06.06<br />å­¦ä¹ ç« èŠ‚ï¼š<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/lQKTCS_QB0E62SK9oXD4LA">ã€Šä½ ä¸çŸ¥é“çš„ Blobã€‹</a><br /><br><br />åŸæ–‡å¯¹ Blob çš„çŸ¥è¯†ç‚¹ä»‹ç»å¾—éå¸¸å®Œæ•´æ¸…æ™°ï¼Œæœ¬æ–‡é€šè¿‡å››ä¸ªé—®é¢˜æ¥æ€»ç»“æœ¬æ–‡æ ¸å¿ƒçŸ¥è¯†ï¼š</p>
<ol>
<li>Blob æ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li>Blob æ€ä¹ˆç”¨ï¼Ÿ</li>
<li>Blob æœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Ÿ</li>
<li>Blob ä¸ ArrayBuffer æœ‰ä½•åŒºåˆ«ï¼Ÿ</li>
</ol>
<p><img src="http://images.pingan8787.com/blog/you-dont-know-blob/xmind.png" alt="è¯»ã€Šä½ ä¸çŸ¥é“çš„ Blobã€‹æ€»ç»“.png"><br /></p>
<h1 id="ä¸€ã€Blob-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ä¸€ã€Blob-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä¸€ã€Blob æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ä¸€ã€Blob æ˜¯ä»€ä¹ˆï¼Ÿ</h1><p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/Blob">Blobï¼ˆBinary Large Objectï¼‰</a>è¡¨ç¤ºäºŒè¿›åˆ¶ç±»å‹çš„å¤§å¯¹è±¡ï¼Œé€šå¸¸æ˜¯å½±åƒã€å£°éŸ³æˆ–å¤šåª’ä½“æ–‡ä»¶ã€‚MySql/Oracleæ•°æ®åº“ä¸­ï¼Œå°±æœ‰ä¸€ç§Blobç±»å‹ï¼Œä¸“é—¨å­˜æ”¾äºŒè¿›åˆ¶æ•°æ®ã€‚åœ¨ JavaScript ä¸­ Blob å¯¹è±¡è¡¨ç¤ºä¸€ä¸ªä¸å¯å˜ã€åŸå§‹æ•°æ®çš„ç±»æ–‡ä»¶å¯¹è±¡ï¼Œå®ƒä¸ä¸€å®šéå¾—æ˜¯å¤§é‡æ•°æ®ï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºä¸€ä¸ªå°å‹æ–‡ä»¶çš„å†…å®¹ã€‚<br />å¦å¤–ï¼ŒJavaScript ä¸­çš„ <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/File">File</a> æ¥å£æ˜¯åŸºäº Blobï¼Œç»§æ‰¿ Blob çš„åŠŸèƒ½å¹¶å°†å…¶æ‰©å±•ä½¿å…¶æ”¯æŒç”¨æˆ·ç³»ç»Ÿä¸Šçš„æ–‡ä»¶ã€‚<br /></p>
<h1 id="äºŒã€Blob-æ€ä¹ˆç”¨ï¼Ÿ"><a href="#äºŒã€Blob-æ€ä¹ˆç”¨ï¼Ÿ" class="headerlink" title="äºŒã€Blob æ€ä¹ˆç”¨ï¼Ÿ"></a>äºŒã€Blob æ€ä¹ˆç”¨ï¼Ÿ</h1><p><code>Blob</code> ç”±ä¸€ä¸ªå¯é€‰å­—ç¬¦ä¸² <code>type</code> å’Œ <code>blobParts</code> ç»„æˆï¼Œå…¶ä¸­ï¼Œ <code>type</code> é€šå¸¸ä¸º MIME ç±»å‹ã€‚</p>
<blockquote>
<p>MIMEï¼ˆMultipurpose Internet Mail Extensionsï¼‰å¤šç”¨é€”äº’è”ç½‘é‚®ä»¶æ‰©å±•ç±»å‹ï¼Œå¸¸è§æœ‰ï¼šè¶…æ–‡æœ¬æ ‡è®°è¯­è¨€æ–‡æœ¬ .html <code>text/html</code> ã€PNGå›¾åƒ .png <code>image/png</code> ã€æ™®é€šæ–‡æœ¬ .txt <code>text/plain</code> Â ç­‰ã€‚</p>
</blockquote>
<h2 id="1-æ„é€ å‡½æ•°"><a href="#1-æ„é€ å‡½æ•°" class="headerlink" title="1. æ„é€ å‡½æ•°"></a>1. æ„é€ å‡½æ•°</h2><p>Blob æ„é€ å‡½æ•°è¯­æ³•ä¸ºï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myBlob = <span class="keyword">new</span> Blob(blobParts[, options])</span><br></pre></td></tr></table></figure>
<p><strong>å…¥å‚ï¼š</strong></p>
<ul>
<li><code>blobParts</code>ï¼šå®ƒæ˜¯ä¸€ä¸ªç”± ArrayBufferï¼ŒArrayBufferViewï¼ŒBlobï¼ŒDOMString ç­‰å¯¹è±¡æ„æˆçš„æ•°ç»„ã€‚DOMStrings ä¼šè¢«ç¼–ç ä¸º UTF-8ã€‚</li>
<li><code>options</code> ï¼šä¸€ä¸ªå¯é€‰çš„å¯¹è±¡ï¼ŒåŒ…å«ä»¥ä¸‹ä¸¤ä¸ªå±æ€§ï¼š<ul>
<li><code>type</code> ï¼šé»˜è®¤å€¼ä¸º <code>&quot;&quot;</code> ï¼Œè¡¨ç¤ºå°†ä¼šè¢«æ”¾å…¥åˆ° blob ä¸­çš„æ•°ç»„å†…å®¹çš„ MIME ç±»å‹ã€‚</li>
<li><code>endings</code> ï¼šé»˜è®¤å€¼ä¸º <code>&quot;transparent&quot;</code>ï¼Œç”¨äºæŒ‡å®šåŒ…å«è¡Œç»“æŸç¬¦ <code>\n</code> çš„å­—ç¬¦ä¸²å¦‚ä½•è¢«å†™å…¥ã€‚å®ƒæ˜¯ä»¥ä¸‹ä¸¤ä¸ªå€¼ä¸­çš„ä¸€ä¸ªï¼š<code>&quot;native&quot;</code>ï¼Œä»£è¡¨è¡Œç»“æŸç¬¦ä¼šè¢«æ›´æ”¹ä¸ºé€‚åˆå®¿ä¸»æ“ä½œç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿçš„æ¢è¡Œç¬¦ï¼Œæˆ–è€… <code>&quot;transparent&quot;</code>ï¼Œä»£è¡¨ä¼šä¿æŒ blob ä¸­ä¿å­˜çš„ç»“æŸç¬¦ä¸å˜ã€‚</li>
</ul>
</li>
</ul>
<p><strong>å‡ºå‚ï¼š</strong><br />è¿”å›ä¸€ä¸ªæ–°åˆ›å»ºçš„ Blob å¯¹è±¡ï¼Œå…¶å†…å®¹ç”±å‚æ•°ä¸­ç»™å®šçš„æ•°ç»„ä¸²è”ç»„æˆã€‚<br /></p>
<h2 id="2-å±æ€§å’Œæ–¹æ³•"><a href="#2-å±æ€§å’Œæ–¹æ³•" class="headerlink" title="2. å±æ€§å’Œæ–¹æ³•"></a>2. å±æ€§å’Œæ–¹æ³•</h2><h3 id="2-1-å±æ€§ä»‹ç»"><a href="#2-1-å±æ€§ä»‹ç»" class="headerlink" title="2.1 å±æ€§ä»‹ç»"></a>2.1 å±æ€§ä»‹ç»</h3><p><code>Blob</code> å¯¹è±¡æ‹¥æœ‰ 2 ä¸ªå±æ€§ï¼š</p>
<ul>
<li><code>size</code> ï¼šåªè¯»ï¼Œè¡¨ç¤º <code>Blob</code> å¯¹è±¡ä¸­æ‰€åŒ…å«çš„æ•°æ®å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ï¼›</li>
<li><code>type</code> ï¼šåªè¯»ï¼Œå€¼ä¸ºå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè¯¥ <code>Blob</code> å¯¹è±¡æ‰€åŒ…å«æ•°æ®çš„ MIME ç±»å‹ã€‚è‹¥ç±»å‹æœªçŸ¥ï¼Œåˆ™è¯¥å±æ€§å€¼ä¸ºç©ºå­—ç¬¦ä¸²ã€‚</li>
</ul>
<h3 id="2-2-æ–¹æ³•ä»‹ç»"><a href="#2-2-æ–¹æ³•ä»‹ç»" class="headerlink" title="2.2 æ–¹æ³•ä»‹ç»"></a>2.2 æ–¹æ³•ä»‹ç»</h3><ul>
<li><code>slice([start[, end[, contentType]]])</code> ï¼šè¿”å›ä¸€ä¸ªæ–°çš„ Blob å¯¹è±¡ï¼ŒåŒ…å«äº†æº Blob å¯¹è±¡ä¸­æŒ‡å®šèŒƒå›´å†…çš„æ•°æ®ã€‚</li>
<li><code>stream()</code>ï¼šè¿”å›ä¸€ä¸ªèƒ½è¯»å– Blob å†…å®¹çš„ <code>ReadableStream</code> ã€‚</li>
<li><code>text()</code>ï¼šè¿”å›ä¸€ä¸ª Promise å¯¹è±¡ä¸”åŒ…å« Blob æ‰€æœ‰å†…å®¹çš„ UTF-8 æ ¼å¼çš„ <code>USVString</code> ã€‚</li>
<li><code>arrayBuffer()</code>ï¼šè¿”å›ä¸€ä¸ª Promise å¯¹è±¡ä¸”åŒ…å« Blob æ‰€æœ‰å†…å®¹çš„äºŒè¿›åˆ¶æ ¼å¼çš„ <code>ArrayBuffer</code> ã€‚</li>
</ul>
<p><br />æ³¨æ„ï¼š** <code>Blob</code> å¯¹è±¡æ˜¯ä¸å¯æ”¹å˜çš„**ï¼Œä½†æ˜¯å¯ä»¥è¿›è¡Œåˆ†å‰²ï¼Œå¹¶åˆ›å»ºå‡ºæ–°çš„ <code>Blob</code> å¯¹è±¡ï¼Œå°†å®ƒä»¬æ··åˆåˆ°ä¸€ä¸ªæ–°çš„ <code>Blob</code> Â ä¸­ã€‚ç±»ä¼¼äº JavaScript å­—ç¬¦ä¸²ï¼šæˆ‘ä»¬æ— æ³•æ›´æ”¹å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ï¼Œä½†å¯ä»¥åˆ›å»ºæ–°çš„æ›´æ­£åçš„å­—ç¬¦ä¸²ã€‚<br /></p>
<h2 id="3-ç®€å•ä¸Šæ‰‹"><a href="#3-ç®€å•ä¸Šæ‰‹" class="headerlink" title="3. ç®€å•ä¸Šæ‰‹"></a>3. ç®€å•ä¸Šæ‰‹</h2><h3 id="3-1-ç¤ºä¾‹1ï¼šä»å­—ç¬¦ä¸²åˆ›å»º-Blob"><a href="#3-1-ç¤ºä¾‹1ï¼šä»å­—ç¬¦ä¸²åˆ›å»º-Blob" class="headerlink" title="3.1 ç¤ºä¾‹1ï¼šä»å­—ç¬¦ä¸²åˆ›å»º Blob"></a>3.1 ç¤ºä¾‹1ï¼šä»å­—ç¬¦ä¸²åˆ›å»º Blob</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> myBlobParts = [<span class="string">&#x27;&lt;html&gt;&lt;h2&gt;Hello Leo&lt;/h2&gt;&lt;/html&gt;&#x27;</span>]; <span class="comment">// ä¸€ä¸ªåŒ…å«DOMStringçš„æ•°ç»„</span></span><br><span class="line"><span class="keyword">let</span> myBlob = <span class="keyword">new</span> Blob(myBlobParts, &#123;<span class="attr">type</span> : <span class="string">&#x27;text/html&#x27;</span>, <span class="attr">endings</span>: <span class="string">&quot;transparent&quot;</span>&#125;); <span class="comment">// å¾—åˆ° blob</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(myBlob.size + <span class="string">&quot; bytes size&quot;</span>);</span><br><span class="line"><span class="comment">// Output: 31 bytes size</span></span><br><span class="line"><span class="built_in">console</span>.log(myBlob.type + <span class="string">&quot; is the type&quot;</span>);</span><br><span class="line"><span class="comment">// Output: text/html is the type</span></span><br></pre></td></tr></table></figure>


<p><a name="uO7tW"></a></p>
<h3 id="3-2-ç¤ºä¾‹2ï¼šä»ç±»å‹åŒ–æ•°ç»„å’Œå­—ç¬¦ä¸²åˆ›å»º-Blob"><a href="#3-2-ç¤ºä¾‹2ï¼šä»ç±»å‹åŒ–æ•°ç»„å’Œå­—ç¬¦ä¸²åˆ›å»º-Blob" class="headerlink" title="3.2 ç¤ºä¾‹2ï¼šä»ç±»å‹åŒ–æ•°ç»„å’Œå­—ç¬¦ä¸²åˆ›å»º Blob"></a>3.2 ç¤ºä¾‹2ï¼šä»ç±»å‹åŒ–æ•°ç»„å’Œå­—ç¬¦ä¸²åˆ›å»º Blob</h3><p>JavaScriptç±»å‹åŒ–æ•°ç»„æ˜¯ä¸€ç§ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼Œå¹¶æä¾›äº†ä¸€ç§ç”¨äº <strong>è®¿é—®åŸå§‹äºŒè¿›åˆ¶æ•°æ®çš„æœºåˆ¶</strong> ã€‚å¹¶ä¸”åœ¨ç±»å‹æ•°ç»„ä¸Šè°ƒç”¨ <code>Array.isArray()</code> ä¼šè¿”å› <code>false</code> ã€‚<br />è¯¦ç»†å¯å‚è€ƒMDNã€Š<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Typed_arrays">JavaScript ç±»å‹åŒ–æ•°ç»„</a>ã€‹ç« èŠ‚ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> hello = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>([<span class="number">72</span>, <span class="number">101</span>, <span class="number">108</span>, <span class="number">108</span>, <span class="number">111</span>]); <span class="comment">// äºŒè¿›åˆ¶æ ¼å¼çš„ &quot;hello&quot;</span></span><br><span class="line"><span class="keyword">let</span> blob = <span class="keyword">new</span> Blob([hello, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;leo&#x27;</span>], &#123;<span class="attr">type</span>: <span class="string">&#x27;text/plain&#x27;</span>&#125;);</span><br><span class="line"><span class="comment">// Output: &quot;Hello leo&quot;</span></span><br></pre></td></tr></table></figure>


<h3 id="3-3-ç¤ºä¾‹3ï¼šç»„è£…æ–°çš„-Blob"><a href="#3-3-ç¤ºä¾‹3ï¼šç»„è£…æ–°çš„-Blob" class="headerlink" title="3.3 ç¤ºä¾‹3ï¼šç»„è£…æ–°çš„ Blob"></a>3.3 ç¤ºä¾‹3ï¼šç»„è£…æ–°çš„ Blob</h3><p>ç”±äº <code>Blob</code> å¯¹è±¡æ˜¯ä¸å¯æ”¹å˜çš„ï¼Œä½†æˆ‘ä»¬å¯ä»¥è¿›è¡Œåˆ†å‰²ï¼Œå¹¶ç»„è£…æˆä¸€ä¸ªæ–°çš„ <code>Blob</code> å¯¹è±¡ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> blob1 = <span class="keyword">new</span> Blob([<span class="string">&#x27;&lt;html&gt;&lt;h2&gt;Hello Leo&lt;/h2&gt;&lt;/html&gt;&#x27;</span>], </span><br><span class="line">   &#123;<span class="attr">type</span> : <span class="string">&#x27;text/html&#x27;</span>, <span class="attr">endings</span>: <span class="string">&quot;transparent&quot;</span>&#125;);</span><br><span class="line"><span class="keyword">let</span> blob2 = <span class="keyword">new</span> Blob([<span class="string">&#x27;&lt;html&gt;&lt;h2&gt;Happy Boy!&lt;/h2&gt;&lt;/html&gt;&#x27;</span>], </span><br><span class="line">   &#123;<span class="attr">type</span> : <span class="string">&#x27;text/html&#x27;</span>, <span class="attr">endings</span>: <span class="string">&quot;transparent&quot;</span>&#125;);</span><br><span class="line"><span class="keyword">let</span> slice1 = blob1.slice(<span class="number">16</span>);</span><br><span class="line"><span class="keyword">let</span> slice2 = blob2.slice(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> slice1.text();</span><br><span class="line"><span class="comment">// currtent slice1 value: &quot;Leo&lt;/h2&gt;&lt;/html&gt;&quot;</span></span><br><span class="line"><span class="keyword">await</span> slice2.text();</span><br><span class="line"><span class="comment">// currtent slice2 value: &quot;&lt;html&gt;&lt;h2&gt;Happy &quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> newBlob = <span class="keyword">new</span> Blob([slice2, slice1], </span><br><span class="line">   &#123;<span class="attr">type</span> : <span class="string">&#x27;text/html&#x27;</span>, <span class="attr">endings</span>: <span class="string">&quot;transparent&quot;</span>&#125;);</span><br><span class="line"><span class="keyword">await</span> newBlob.text();</span><br><span class="line"><span class="comment">// currtent newBlob value: &quot;&lt;html&gt;&lt;h2&gt;Happy Leo&lt;/h2&gt;&lt;/html&gt;&quot;</span></span><br></pre></td></tr></table></figure>

<h1 id="ä¸‰ã€Blob-æœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Ÿ"><a href="#ä¸‰ã€Blob-æœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Ÿ" class="headerlink" title="ä¸‰ã€Blob æœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Ÿ"></a>ä¸‰ã€Blob æœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Ÿ</h1><h2 id="1-å›¾ç‰‡æœ¬åœ°é¢„è§ˆ"><a href="#1-å›¾ç‰‡æœ¬åœ°é¢„è§ˆ" class="headerlink" title="1. å›¾ç‰‡æœ¬åœ°é¢„è§ˆ"></a>1. å›¾ç‰‡æœ¬åœ°é¢„è§ˆ</h2><p>è¿™é‡Œæ•´ç† 2 ç§å›¾ç‰‡æœ¬åœ°é¢„è§ˆçš„æ–¹å¼ï¼š</p>
<ol>
<li>ä½¿ç”¨ DataURL æ–¹å¼ï¼›</li>
<li>ä½¿ç”¨ Blob URL/Object URL æ–¹å¼ï¼›<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>1.DataURLæ–¹å¼ï¼š<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">accept</span>=<span class="string">&quot;image/*&quot;</span> <span class="attr">onchange</span>=<span class="string">&quot;selectFileForDataURL(event)&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">&quot;output1&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>2.Blobæ–¹å¼ï¼š<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">accept</span>=<span class="string">&quot;image/*&quot;</span> <span class="attr">onchange</span>=<span class="string">&quot;selectFileForBlob(event)&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">&quot;output2&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 1.DataURLæ–¹å¼ï¼š</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">selectFileForDataURL</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> reader = <span class="keyword">new</span> FileReader();</span></span><br><span class="line"><span class="javascript">            reader.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">const</span> output = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#output1&quot;</span>)</span></span><br><span class="line"><span class="javascript">                output.src = reader.result;</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">            reader.readAsDataURL(event.target.files[<span class="number">0</span>]);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">//2.Blobæ–¹å¼ï¼š</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">selectFileForBlob</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> reader = <span class="keyword">new</span> FileReader();</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> output = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#output2&quot;</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> imgUrl = <span class="built_in">window</span>.URL.createObjectURL(event.target.files[<span class="number">0</span>]);</span></span><br><span class="line"><span class="javascript">            output.src = imgUrl;</span></span><br><span class="line"><span class="javascript">            reader.onload = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">window</span>.URL.revokeObjectURL(imgUrl);</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p><br />ä¸Šé¢ä¸»è¦ä»‹ç» <code>Blob URL</code> å’Œ <code>Data URL</code> ä¸¤ç§æ–¹å¼å®ç°å›¾ç‰‡æœ¬åœ°é¢„è§ˆï¼Œè¿™ä¸¤ä¸ªç±»å‹çš„åŒºåˆ«åœ¨<strong>ã€Šäº”ã€æ‹“å±•ã€‹</strong>ä¸­ä»‹ç»ã€‚<br /></p>
<h2 id="2-å›¾ç‰‡æœ¬åœ°é¢„è§ˆ-åˆ†ç‰‡ä¸Šä¼ "><a href="#2-å›¾ç‰‡æœ¬åœ°é¢„è§ˆ-åˆ†ç‰‡ä¸Šä¼ " class="headerlink" title="2. å›¾ç‰‡æœ¬åœ°é¢„è§ˆ + åˆ†ç‰‡ä¸Šä¼ "></a>2. å›¾ç‰‡æœ¬åœ°é¢„è§ˆ + åˆ†ç‰‡ä¸Šä¼ </h2><p><strong>å®ç°æœ¬åœ°é¢„è§ˆï¼š</strong><br />å°† <code>input</code> è·å–åˆ°çš„ <code>file</code> å¯¹è±¡ï¼Œé€šè¿‡å®ä¾‹åŒ– <code>FileReader</code> ï¼Œèµ‹å€¼ç»™å˜é‡ <code>reader</code> ï¼Œè°ƒç”¨<code>reader</code> çš„ <code>readAsDataURL</code> æ–¹æ³•ï¼Œå°† <code>file</code> å¯¹è±¡è½¬æ¢ä¸º Â <code>dataURL</code> ï¼Œç„¶åç›‘å¬ <code>reader</code> çš„ <code>onload</code> å±æ€§ï¼Œè·å–åˆ°è¯»å–ç»“æœ <code>result</code> ï¼Œç„¶åè®¾ç½®ä¸ºå›¾ç‰‡çš„ <code>src</code> å€¼ã€‚<br /><br><br /><strong>å®ç°åˆ†ç‰‡ä¸Šä¼ ï¼š</strong><br />ç”±äº File æ˜¯ç‰¹æ®Šç±»å‹çš„ Blobï¼Œå¯ç”¨äºä»»æ„ Blob ç±»å‹çš„ä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥é’ˆå¯¹å¤§æ–‡ä»¶ä¼ è¾“ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>slice</code> æ–¹æ³•è¿›è¡Œæ–‡ä»¶åˆ‡å‰²ï¼Œåˆ†ç‰‡ä¸Šä¼ ã€‚</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">accept</span>=<span class="string">&quot;image/*&quot;</span> <span class="attr">onchange</span>=<span class="string">&quot;selectFile(event)&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;upload()&quot;</span>&gt;</span>ä¸Šä¼ <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">&quot;output&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> chunkSize = <span class="number">10000</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> url = <span class="string">&quot;https://httpbin.org/post&quot;</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">selectFile</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">          	<span class="comment">// æœ¬åœ°é¢„è§ˆ</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> reader = <span class="keyword">new</span> FileReader();</span></span><br><span class="line"><span class="javascript">            reader.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">const</span> output = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#output&quot;</span>)</span></span><br><span class="line"><span class="javascript">                output.src = reader.result;</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">            reader.readAsDataURL(event.target.files[<span class="number">0</span>]);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">          	<span class="comment">// åˆ†ç‰‡ä¸Šä¼ </span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">await</span> upload(event.target.files[<span class="number">0</span>]);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params">files</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> file = files;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">for</span>(<span class="keyword">let</span> start = <span class="number">0</span>; start &lt; file.size; start += chunkSize)&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">const</span> chunk = file.slice(start, start + chunkSize + <span class="number">1</span>);</span></span><br><span class="line"><span class="javascript">                <span class="keyword">const</span> fd = <span class="keyword">new</span> FormData();</span></span><br><span class="line"><span class="javascript">                fd.append(<span class="string">&quot;data&quot;</span>, chunk);</span></span><br><span class="line"><span class="javascript">                <span class="keyword">await</span> fetch(url, &#123; <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>, <span class="attr">body</span>: fd &#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(res)</span></span><br><span class="line"><span class="javascript">                    res.text();</span></span><br><span class="line"><span class="javascript">                &#125;);</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h2 id="3-å›¾ç‰‡æœ¬åœ°é¢„è§ˆ-åˆ†ç‰‡ä¸Šä¼ -æš‚åœ-ç»­ä¼ "><a href="#3-å›¾ç‰‡æœ¬åœ°é¢„è§ˆ-åˆ†ç‰‡ä¸Šä¼ -æš‚åœ-ç»­ä¼ " class="headerlink" title="3. å›¾ç‰‡æœ¬åœ°é¢„è§ˆ + åˆ†ç‰‡ä¸Šä¼  + æš‚åœ + ç»­ä¼ "></a>3. å›¾ç‰‡æœ¬åœ°é¢„è§ˆ + åˆ†ç‰‡ä¸Šä¼  + æš‚åœ + ç»­ä¼ </h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">accept</span>=<span class="string">&quot;image/*&quot;</span> <span class="attr">onchange</span>=<span class="string">&quot;selectFile(event)&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;upload()&quot;</span>&gt;</span>ä¸Šä¼ <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;pause()&quot;</span>&gt;</span>æš‚åœ<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;continues()&quot;</span>&gt;</span>ç»§ç»­<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">&quot;output&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> chunkSize = <span class="number">30000</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> start = <span class="number">0</span>, curFile, isPause = <span class="literal">false</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> url = <span class="string">&quot;https://httpbin.org/post&quot;</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">selectFile</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> reader = <span class="keyword">new</span> FileReader();</span></span><br><span class="line"><span class="javascript">            reader.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">const</span> output = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#output&quot;</span>)</span></span><br><span class="line"><span class="javascript">                output.src = reader.result;</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">            reader.readAsDataURL(event.target.files[<span class="number">0</span>]);</span></span><br><span class="line"><span class="javascript">            curFile = event.target.files[<span class="number">0</span>];</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> file = curFile;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">for</span>(start; start &lt; file.size; start += chunkSize)&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span>(isPause) <span class="keyword">return</span>;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">const</span> chunk = file.slice(start, start + chunkSize + <span class="number">1</span>);</span></span><br><span class="line"><span class="javascript">                <span class="keyword">const</span> fd = <span class="keyword">new</span> FormData();</span></span><br><span class="line"><span class="javascript">                fd.append(<span class="string">&quot;data&quot;</span>, chunk);</span></span><br><span class="line"><span class="javascript">                <span class="keyword">await</span> fetch(url, &#123; <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>, <span class="attr">body</span>: fd &#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">                        res.text()</span></span><br><span class="line"><span class="javascript">                    &#125;</span></span><br><span class="line"><span class="javascript">                );</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span>(chunk.size &lt; chunkSize)&#123;</span></span><br><span class="line"><span class="javascript">                    uploadSuccess();</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">return</span>;</span></span><br><span class="line"><span class="javascript">                &#125;</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">pause</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            isPause = <span class="literal">true</span>;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">continues</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            isPause = <span class="literal">false</span>;</span></span><br><span class="line"><span class="javascript">            upload();</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">uploadSuccess</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            isPause = <span class="literal">false</span>;</span></span><br><span class="line"><span class="javascript">            start = <span class="number">0</span>;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h2 id="4-ä»äº’è”ç½‘ä¸‹è½½æ•°æ®"><a href="#4-ä»äº’è”ç½‘ä¸‹è½½æ•°æ®" class="headerlink" title="4. ä»äº’è”ç½‘ä¸‹è½½æ•°æ®"></a>4. ä»äº’è”ç½‘ä¸‹è½½æ•°æ®</h2><p>åœ¨å®ç°â€œä»äº’è”ç½‘ä¸‹è½½æ•°æ®â€æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>createObjectURL</code> æ˜¾ç¤ºå›¾ç‰‡ï¼Œåœ¨è¯·æ±‚äº’è”ç½‘å›¾ç‰‡æ—¶ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>XMLHttpRequest</code> ï¼›</li>
<li>ä½¿ç”¨ <code>fetch</code> ï¼›<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;download1()&quot;</span>&gt;</span>ä½¿ç”¨ XMLHttpRequest ä¸‹è½½<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;download2()&quot;</span>&gt;</span>ä½¿ç”¨ fetch ä¸‹è½½<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">&quot;pingan&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> url = <span class="string">&quot;http://images.pingan8787.com/TinyCompiler/111.png&quot;</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> pingan = <span class="built_in">document</span>.querySelector(<span class="string">&#x27;#pingan&#x27;</span>);</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">download1</span> (<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="javascript">            xhr.open(<span class="string">&#x27;GET&#x27;</span>, url);</span></span><br><span class="line"><span class="javascript">            xhr.responseType = <span class="string">&#x27;blob&#x27;</span>;</span></span><br><span class="line"><span class="javascript">            xhr.onload = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">                renderImage(xhr.response);</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">            xhr.send(<span class="literal">null</span>);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">download2</span> (<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            fetch(url).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">return</span> res.blob();</span></span><br><span class="line"><span class="javascript">            &#125;).then(<span class="function"><span class="params">myBlob</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">                renderImage(myBlob);</span></span><br><span class="line"><span class="javascript">            &#125;)</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">renderImage</span> (<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">let</span> objectURL = URL.createObjectURL(data);</span></span><br><span class="line"><span class="javascript">            pingan.src = objectURL;</span></span><br><span class="line"><span class="javascript">          	<span class="comment">// æ ¹æ®ä¸šåŠ¡éœ€è¦æ‰‹åŠ¨è°ƒç”¨ URL.revokeObjectURL(imgUrl)</span></span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="5-ä¸‹è½½æ–‡ä»¶"><a href="#5-ä¸‹è½½æ–‡ä»¶" class="headerlink" title="5. ä¸‹è½½æ–‡ä»¶"></a>5. ä¸‹è½½æ–‡ä»¶</h2><p>é€šè¿‡è°ƒç”¨ Blob çš„æ„é€ å‡½æ•°æ¥åˆ›å»ºç±»å‹ä¸º <code>&quot;text/plain&quot;</code> çš„ Blob å¯¹è±¡ï¼Œç„¶åé€šè¿‡åŠ¨æ€åˆ›å»º <code>a</code> æ ‡ç­¾æ¥å®ç°æ–‡ä»¶çš„ä¸‹è½½ã€‚</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;download()&quot;</span>&gt;</span>Blob æ–‡ä»¶ä¸‹è½½<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">download</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> fileName= <span class="string">&quot;Blobæ–‡ä»¶.txt&quot;</span>;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> myBlob = <span class="keyword">new</span> Blob([<span class="string">&quot;ä¸€æ–‡å½»åº•æŒæ¡ Blob Web API&quot;</span>], &#123; <span class="attr">type</span>: <span class="string">&quot;text/plain&quot;</span> &#125;);</span></span><br><span class="line"><span class="javascript">            downloadFun(fileName, myBlob);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">downloadFun</span>(<span class="params">fileName, blob</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> link = <span class="built_in">document</span>.createElement(<span class="string">&quot;a&quot;</span>);</span></span><br><span class="line"><span class="javascript">            link.href = URL.createObjectURL(blob);</span></span><br><span class="line"><span class="javascript">            link.download = fileName;</span></span><br><span class="line"><span class="javascript">            link.click();</span></span><br><span class="line"><span class="javascript">            link.remove();</span></span><br><span class="line"><span class="javascript">            URL.revokeObjectURL(link.href);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="6-å›¾ç‰‡å‹ç¼©"><a href="#6-å›¾ç‰‡å‹ç¼©" class="headerlink" title="6. å›¾ç‰‡å‹ç¼©"></a>6. å›¾ç‰‡å‹ç¼©</h2><p>å½“æˆ‘ä»¬å¸Œæœ›æœ¬åœ°å›¾ç‰‡åœ¨ä¸Šä¼ ä¹‹å‰ï¼Œå…ˆè¿›è¡Œä¸€å®šå‹ç¼©ï¼Œå†æäº¤ï¼Œä»è€Œå‡å°‘ä¼ è¾“çš„æ•°æ®é‡ã€‚<br />åœ¨å‰ç«¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Canvas æä¾›çš„ <code>toDataURL()</code> æ–¹æ³•æ¥å®ç°ï¼Œè¯¥æ–¹æ³•æ¥æ”¶ <code>type</code> å’Œ <code>encoderOptions</code> ä¸¤ä¸ªå¯é€‰å‚æ•°ï¼š</p>
<ul>
<li><code>type</code> è¡¨ç¤º<strong>å›¾ç‰‡æ ¼å¼</strong>ï¼Œé»˜è®¤ä¸º <code>image/png</code> ï¼›</li>
<li><code>encoderOptions</code> è¡¨ç¤º<strong>å›¾ç‰‡è´¨é‡</strong>ï¼Œåœ¨æŒ‡å®šå›¾ç‰‡æ ¼å¼ä¸º <code>image/jpeg</code> æˆ– <code>image/webp</code> çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä» 0 åˆ° 1 åŒºé—´å†…é€‰æ‹©å›¾ç‰‡è´¨é‡ã€‚å¦‚æœè¶…å‡ºå–å€¼èŒƒå›´ï¼Œå°†ä¼šä½¿ç”¨é»˜è®¤å€¼ <code>0.92</code>ï¼Œå…¶ä»–å‚æ•°ä¼šè¢«å¿½ç•¥ã€‚<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">accept</span>=<span class="string">&quot;image/*&quot;</span> <span class="attr">onchange</span>=<span class="string">&quot;loadFile(event)&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// compress.js</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> MAX_WIDTH = <span class="number">800</span>; <span class="comment">// å›¾ç‰‡æœ€å¤§å®½åº¦</span></span></span><br><span class="line"><span class="javascript">      	<span class="comment">// å›¾ç‰‡å‹ç¼©æ–¹æ³•</span></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">compress</span>(<span class="params">base64, quality, mimeType</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">let</span> canvas = <span class="built_in">document</span>.createElement(<span class="string">&quot;canvas&quot;</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">let</span> img = <span class="built_in">document</span>.createElement(<span class="string">&quot;img&quot;</span>);</span></span><br><span class="line"><span class="javascript">            img.crossOrigin = <span class="string">&quot;anonymous&quot;</span>;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">                img.src = base64;</span></span><br><span class="line"><span class="javascript">                img.onload = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">let</span> targetWidth, targetHeight;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">if</span> (img.width &gt; MAX_WIDTH) &#123;</span></span><br><span class="line"><span class="javascript">                        targetWidth = MAX_WIDTH;</span></span><br><span class="line"><span class="javascript">                        targetHeight = (img.height * MAX_WIDTH) / img.width;</span></span><br><span class="line"><span class="javascript">                    &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">                        targetWidth = img.width;</span></span><br><span class="line"><span class="javascript">                        targetHeight = img.height;</span></span><br><span class="line"><span class="javascript">                    &#125;</span></span><br><span class="line"><span class="javascript">                    canvas.width = targetWidth;</span></span><br><span class="line"><span class="javascript">                    canvas.height = targetHeight;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">let</span> ctx = canvas.getContext(<span class="string">&quot;2d&quot;</span>);</span></span><br><span class="line"><span class="javascript">                    ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, targetWidth, targetHeight); <span class="comment">// æ¸…é™¤ç”»å¸ƒ</span></span></span><br><span class="line"><span class="javascript">                    ctx.drawImage(img, <span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height);</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">let</span> imageData = canvas.toDataURL(mimeType, quality / <span class="number">100</span>); <span class="comment">// è®¾ç½®å›¾ç‰‡è´¨é‡</span></span></span><br><span class="line"><span class="javascript">                    resolve(imageData);</span></span><br><span class="line"><span class="javascript">                &#125;;</span></span><br><span class="line"><span class="javascript">            &#125;);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// ä¸ºäº†è¿›ä¸€æ­¥å‡å°‘ä¼ è¾“çš„æ•°æ®é‡ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒè½¬æ¢ä¸º Blob å¯¹è±¡</span></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">dataUrlToBlob</span>(<span class="params">base64, mimeType</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">let</span> bytes = <span class="built_in">window</span>.atob(base64.split(<span class="string">&quot;,&quot;</span>)[<span class="number">1</span>]);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">let</span> ab = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(bytes.length);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">let</span> ia = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(ab);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; bytes.length; i++) &#123;</span></span><br><span class="line"><span class="javascript">                ia[i] = bytes.charCodeAt(i);</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="keyword">new</span> Blob([ab], &#123; <span class="attr">type</span>: mimeType &#125;);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// é€šè¿‡ AJAX æäº¤åˆ°æœåŠ¡å™¨</span></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">uploadFile</span>(<span class="params">url, blob</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">let</span> formData = <span class="keyword">new</span> FormData();</span></span><br><span class="line"><span class="javascript">            <span class="keyword">let</span> request = <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="javascript">            formData.append(<span class="string">&quot;image&quot;</span>, blob);</span></span><br><span class="line"><span class="javascript">            request.open(<span class="string">&quot;POST&quot;</span>, url, <span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">            request.send(formData);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">loadFile</span>(<span class="params">event</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> reader = <span class="keyword">new</span> FileReader();</span></span><br><span class="line"><span class="javascript">            reader.onload = <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">let</span> compressedDataURL = <span class="keyword">await</span> compress(</span></span><br><span class="line"><span class="javascript">                    reader.result,</span></span><br><span class="line"><span class="javascript">                    <span class="number">90</span>,</span></span><br><span class="line"><span class="javascript">                    <span class="string">&quot;image/jpeg&quot;</span></span></span><br><span class="line"><span class="javascript">                );</span></span><br><span class="line"><span class="javascript">                <span class="keyword">let</span> compressedImageBlob = dataUrlToBlob(compressedDataURL);</span></span><br><span class="line"><span class="javascript">                uploadFile(<span class="string">&quot;https://httpbin.org/post&quot;</span>, compressedImageBlob);</span></span><br><span class="line"><span class="javascript">            &#125;;</span></span><br><span class="line"><span class="javascript">            reader.readAsDataURL(event.target.files[<span class="number">0</span>]);</span></span><br><span class="line"><span class="javascript">        &#125;;</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
å…¶å® Canvas å¯¹è±¡é™¤äº†æä¾› <code>toDataURL()</code> æ–¹æ³•ä¹‹å¤–ï¼Œå®ƒè¿˜æä¾›äº†ä¸€ä¸ª <code>toBlob()</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„è¯­æ³•å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">canvas.toBlob(callback, mimeType, qualityArgument)</span><br></pre></td></tr></table></figure>

<p>å’Œ <code>toDataURL()</code> æ–¹æ³•ç›¸æ¯”ï¼Œ<code>toBlob()</code> æ–¹æ³•æ˜¯å¼‚æ­¥çš„ï¼Œå› æ­¤å¤šäº†ä¸ª <code>callback</code> å‚æ•°ï¼Œè¿™ä¸ª <code>callback</code> å›è°ƒæ–¹æ³•é»˜è®¤çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯è½¬æ¢å¥½çš„ <code>blob</code>æ–‡ä»¶ä¿¡æ¯ã€‚<br /></p>
<h2 id="7-ç”Ÿæˆ-PDF-æ–‡æ¡£"><a href="#7-ç”Ÿæˆ-PDF-æ–‡æ¡£" class="headerlink" title="7. ç”Ÿæˆ PDF æ–‡æ¡£"></a>7. ç”Ÿæˆ PDF æ–‡æ¡£</h2><p>åœ¨æµè§ˆå™¨ç«¯ï¼Œåˆ©ç”¨ä¸€äº›ç°æˆçš„å¼€æºåº“ï¼Œæ¯”å¦‚ jsPDFï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ–¹ä¾¿åœ°ç”Ÿæˆ PDF æ–‡æ¡£ã€‚</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>å®¢æˆ·ç«¯ç”Ÿæˆ PDF ç¤ºä¾‹<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/jspdf@latest/dist/jspdf.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    (<span class="function"><span class="keyword">function</span> <span class="title">generatePdf</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> doc = <span class="keyword">new</span> jsPDF();</span></span><br><span class="line"><span class="javascript">      doc.text(<span class="string">&quot;Hello semlinker!&quot;</span>, <span class="number">66</span>, <span class="number">88</span>);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> blob = <span class="keyword">new</span> Blob([doc.output()], &#123; <span class="attr">type</span>: <span class="string">&quot;application/pdf&quot;</span> &#125;);</span></span><br><span class="line"><span class="javascript">      blob.text().then(<span class="function">(<span class="params">blobAsText</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(blobAsText);</span></span><br><span class="line"><span class="javascript">      &#125;);</span></span><br><span class="line"><span class="javascript">    &#125;)();</span></span><br><span class="line"><span class="javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å…¶å® jsPDF é™¤äº†æ”¯æŒçº¯æ–‡æœ¬ä¹‹å¤–ï¼Œå®ƒä¹Ÿå¯ä»¥ç”Ÿæˆå¸¦å›¾ç‰‡çš„ PDF æ–‡æ¡£ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> imgData = <span class="string">&#x27;data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/...&#x27;</span></span><br><span class="line"><span class="keyword">let</span> doc = <span class="keyword">new</span> jsPDF();</span><br><span class="line"></span><br><span class="line">doc.setFontSize(<span class="number">40</span>);</span><br><span class="line">doc.text(<span class="number">35</span>, <span class="number">25</span>, <span class="string">&#x27;Paranyan loves jsPDF&#x27;</span>);</span><br><span class="line">doc.addImage(imgData, <span class="string">&#x27;JPEG&#x27;</span>, <span class="number">15</span>, <span class="number">40</span>, <span class="number">180</span>, <span class="number">160</span>);</span><br></pre></td></tr></table></figure>

<h1 id="å››ã€Blob-ä¸-ArrayBuffer-æœ‰ä½•åŒºåˆ«ï¼Ÿ"><a href="#å››ã€Blob-ä¸-ArrayBuffer-æœ‰ä½•åŒºåˆ«ï¼Ÿ" class="headerlink" title="å››ã€Blob ä¸ ArrayBuffer æœ‰ä½•åŒºåˆ«ï¼Ÿ"></a>å››ã€Blob ä¸ ArrayBuffer æœ‰ä½•åŒºåˆ«ï¼Ÿ</h1><h2 id="1-å®šä¹‰åŒºåˆ«"><a href="#1-å®šä¹‰åŒºåˆ«" class="headerlink" title="1. å®šä¹‰åŒºåˆ«"></a>1. å®šä¹‰åŒºåˆ«</h2><p><code>ArrayBuffer</code> å¯¹è±¡ç”¨äºè¡¨ç¤º<strong>é€šç”¨çš„ï¼Œå›ºå®šé•¿åº¦çš„åŸå§‹äºŒè¿›åˆ¶æ•°æ®ç¼“å†²åŒº</strong>ã€‚ä¸”<strong>ä¸èƒ½ç›´æ¥æ“çºµ</strong> ArrayBuffer çš„å†…å®¹ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªç±»å‹åŒ–æ•°ç»„å¯¹è±¡æˆ– <code>DataView</code> å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä»¥ç‰¹å®šæ ¼å¼è¡¨ç¤ºç¼“å†²åŒºï¼Œå¹¶ä½¿ç”¨è¯¥å¯¹è±¡è¯»å–å’Œå†™å…¥ç¼“å†²åŒºçš„å†…å®¹ã€‚<br /><br><br /><code>Blob</code> ç±»å‹çš„å¯¹è±¡è¡¨ç¤º<strong>ä¸å¯å˜çš„ç±»ä¼¼æ–‡ä»¶å¯¹è±¡çš„åŸå§‹æ•°æ®</strong>ã€‚<code>Blob</code> è¡¨ç¤ºçš„ä¸ä¸€å®šæ˜¯ JavaScript åŸç”Ÿæ ¼å¼çš„æ•°æ®ã€‚<code>File</code> æ¥å£åŸºäº <code>Blob</code>ï¼Œç»§æ‰¿äº†<code>Blob</code> åŠŸèƒ½å¹¶å°†å…¶æ‰©å±•ä¸ºæ”¯æŒç”¨æˆ·ç³»ç»Ÿä¸Šçš„æ–‡ä»¶ã€‚<br /><br><br /><code>Blob</code> ç±»å‹åªæœ‰ <code>slice</code> æ–¹æ³•ï¼Œç”¨äºè¿”å›ä¸€ä¸ªæ–°çš„ <code>Blob</code> å¯¹è±¡ï¼ŒåŒ…å«äº†æº <code>Blob</code> å¯¹è±¡ä¸­æŒ‡å®šèŒƒå›´å†…çš„æ•°æ®ã€‚ å¯¹æ¯”å‘ç°ï¼Œ<code>ArrayBuffer</code> çš„æ•°æ®ï¼Œæ˜¯å¯ä»¥<strong>æŒ‰ç…§å­—èŠ‚å»æ“ä½œ</strong>çš„ï¼Œè€Œ <code>Blob</code> åªèƒ½ä½œä¸ºä¸€ä¸ªå®Œæ•´å¯¹è±¡å»å¤„ç†ã€‚æ‰€ä»¥è¯´ï¼Œ<code>ArrayBuffer</code> ç›¸æ¯” <code>Blob</code> æ›´æ¥è¿‘çœŸå®çš„äºŒè¿›åˆ¶ï¼Œæ›´åº•å±‚ã€‚<br /></p>
<h2 id="2-ä¸¤è€…äº’è½¬"><a href="#2-ä¸¤è€…äº’è½¬" class="headerlink" title="2. ä¸¤è€…äº’è½¬"></a>2. ä¸¤è€…äº’è½¬</h2><h3 id="2-1-ArrayBuffer-è½¬-Blob"><a href="#2-1-ArrayBuffer-è½¬-Blob" class="headerlink" title="2.1 ArrayBuffer è½¬ Blob"></a>2.1 ArrayBuffer è½¬ Blob</h3><p>åªéœ€å°† <code>ArrayBuffer</code> ä½œä¸ºå‚æ•°ä¼ å…¥å³å¯ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> buffer = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(<span class="number">16</span>);</span><br><span class="line"><span class="keyword">const</span> blob = <span class="keyword">new</span> Blob([buffer]);</span><br></pre></td></tr></table></figure>

<h3 id="2-2-Blob-è½¬-ArrayBuffer"><a href="#2-2-Blob-è½¬-ArrayBuffer" class="headerlink" title="2.2 Blob è½¬ ArrayBuffer"></a>2.2 Blob è½¬ ArrayBuffer</h3><p>éœ€è¦å€ŸåŠ© <code>FileReader</code> å¯¹è±¡ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> blob = <span class="keyword">new</span> Blob([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]);</span><br><span class="line"><span class="keyword">const</span> reader = <span class="keyword">new</span> FileReader();</span><br><span class="line"></span><br><span class="line">reader.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.result);</span><br><span class="line">&#125;</span><br><span class="line">reader.readAsArrayBuffer(blob);</span><br></pre></td></tr></table></figure>

<h2 id="3-å…¶ä»–åŒºåˆ«"><a href="#3-å…¶ä»–åŒºåˆ«" class="headerlink" title="3. å…¶ä»–åŒºåˆ«"></a>3. å…¶ä»–åŒºåˆ«</h2><ol>
<li>éœ€è¦ä½¿ç”¨å†™å…¥/ç¼–è¾‘æ“ä½œæ—¶ä½¿ç”¨ ArrayBufferï¼Œå¦åˆ™ä½¿ç”¨ Blob å³å¯ï¼›</li>
<li>Blob å¯¹è±¡ä¸å¯å˜ï¼Œè€Œ ArrayBuffer å¯ä»¥é€šè¿‡ TypedArrays æˆ– DataView æ“ä½œï¼›</li>
<li>Blob å¯ä»¥ä½äºç£ç›˜ã€é«˜é€Ÿç¼“å­˜å†…å­˜å’Œå…¶ä»–ä¸åŒç”¨ä½ç½®ï¼Œè€Œ ArrayBuffer å­˜åœ¨å†…å­˜ä¸­ï¼Œå¯ä»¥ç›´æ¥æ“ä½œï¼›</li>
</ol>
<h2 id="4-Ajax-ä¸­ä½¿ç”¨-Blob-å’Œ-ArrayBuffer"><a href="#4-Ajax-ä¸­ä½¿ç”¨-Blob-å’Œ-ArrayBuffer" class="headerlink" title="4. Ajax ä¸­ä½¿ç”¨ Blob å’Œ ArrayBuffer"></a>4. Ajax ä¸­ä½¿ç”¨ Blob å’Œ ArrayBuffer</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">GET</span>(<span class="params">url, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">  xhr.open(<span class="string">&#x27;GET&#x27;</span>, url, <span class="literal">true</span>);</span><br><span class="line">  xhr.responseType = <span class="string">&#x27;arraybuffer&#x27;</span>; <span class="comment">// or xhr.responseType = &quot;blob&quot;;</span></span><br><span class="line">  xhr.send();</span><br><span class="line"></span><br><span class="line">  xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (xhr.status != <span class="number">200</span>) &#123;</span><br><span class="line">      alert(<span class="string">&quot;Unexpected status code &quot;</span> + xhr.status + <span class="string">&quot; for &quot;</span> + url);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    callback(<span class="keyword">new</span> <span class="built_in">Uint8Array</span>(xhr.response)); <span class="comment">// or new Blob([xhr.response]);</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="äº”ã€æ‹“å±•"><a href="#äº”ã€æ‹“å±•" class="headerlink" title="äº”ã€æ‹“å±•"></a>äº”ã€æ‹“å±•</h1><h2 id="1-Blob-URL-å’Œ-Data-URL-åŒºåˆ«"><a href="#1-Blob-URL-å’Œ-Data-URL-åŒºåˆ«" class="headerlink" title="1. Blob URL å’Œ Data URL åŒºåˆ«"></a>1. Blob URL å’Œ Data URL åŒºåˆ«</h2><h3 id="1-1-æ ¼å¼ä¸åŒ"><a href="#1-1-æ ¼å¼ä¸åŒ" class="headerlink" title="1.1 æ ¼å¼ä¸åŒ"></a>1.1 æ ¼å¼ä¸åŒ</h3><p><code>Blob URL</code> æ ¼å¼å¦‚ <code>blob:åŸŸå/uuid</code> ï¼Œ <code>Data URL</code> æ ¼å¼å¦‚ï¼š <code>data:[&lt;mediatype&gt;][;base64],&lt;data&gt;</code> Â ã€‚<br /><code>mediatype</code> æ˜¯ä¸ª MIME ç±»å‹çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ â€œ<code>image/jpeg</code>â€œ è¡¨ç¤º JPEG å›¾åƒæ–‡ä»¶ã€‚å¦‚æœè¢«çœç•¥ï¼Œåˆ™é»˜è®¤å€¼ä¸º <code>text/plain;charset=US-ASCII</code>ã€‚<br /><img src="http://images.pingan8787.com/blog/you-dont-know-blob/code.png" alt="image.png"></p>
<h3 id="1-2-é•¿åº¦ä¸åŒ"><a href="#1-2-é•¿åº¦ä¸åŒ" class="headerlink" title="1.2 é•¿åº¦ä¸åŒ"></a>1.2 é•¿åº¦ä¸åŒ</h3><p><code>Blob URL</code> ä¸€èˆ¬é•¿åº¦è¾ƒçŸ­ï¼Œè€Œ <code>Data URL</code> å› ä¸ºç›´æ¥å­˜å‚¨å›¾ç‰‡ base64 ç¼–ç åçš„æ•°æ®ï¼Œå¾€å¾€æ¯”è¾ƒé•¿ã€‚<br /></p>
<h3 id="1-3-XMLHttpRequest-æ”¯æŒæƒ…å†µä¸åŒ"><a href="#1-3-XMLHttpRequest-æ”¯æŒæƒ…å†µä¸åŒ" class="headerlink" title="1.3 XMLHttpRequest æ”¯æŒæƒ…å†µä¸åŒ"></a>1.3 XMLHttpRequest æ”¯æŒæƒ…å†µä¸åŒ</h3><p><code>Blob URL</code> Â å¯ä»¥å¾ˆæ–¹ä¾¿ä½¿ç”¨ XMLHttpRequest è·å–æºæ•°æ®ï¼ˆ <code>xhr.responseType = &#39;blob&#39;</code> ï¼‰ï¼Œè€Œ <code>Data URL</code> å¹¶ä¸æ˜¯æ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒé€šè¿‡ XMLHttpRequest è·å–æºæ•°æ®çš„ã€‚<br /></p>
<h3 id="1-4-ä½¿ç”¨åœºæ™¯ä¸åŒ"><a href="#1-4-ä½¿ç”¨åœºæ™¯ä¸åŒ" class="headerlink" title="1.4 ä½¿ç”¨åœºæ™¯ä¸åŒ"></a>1.4 ä½¿ç”¨åœºæ™¯ä¸åŒ</h3><p><code>Blob URL</code> Â åªèƒ½åœ¨å½“å‰åº”ç”¨å†…ä½¿ç”¨ï¼ŒæŠŠ <code>Blob URL</code> Â å¤åˆ¶åˆ°æµè§ˆå™¨åœ°å€æ æ˜¯æ— æ³•è·å–æ•°æ®ï¼Œè€Œ <code>Data URL</code> åˆ™å¯ä»¥åœ¨ä»»æ„æµè§ˆå™¨ä¸­ä½¿ç”¨ã€‚<br /></p>
<h1 id="å…­ã€æ€»ç»“"><a href="#å…­ã€æ€»ç»“" class="headerlink" title="å…­ã€æ€»ç»“"></a>å…­ã€æ€»ç»“</h1><p>æœ¬æ–‡ä¸­æˆ‘ä»¬ä¸»è¦é€šè¿‡ 4 ä¸ªé—®é¢˜æ¥å¤ä¹ äº† Blob çŸ¥è¯†ç‚¹ï¼šâ€œBlob æ˜¯ä»€ä¹ˆâ€ã€â€œBlob æ€ä¹ˆç”¨â€ã€â€œBlob ä½¿ç”¨åœºæ™¯â€å’Œâ€œBlob ä¸ ArrayBuffer åŒºåˆ«â€ï¼Œåœ¨â€œBlob ä½¿ç”¨åœºæ™¯â€éƒ¨åˆ†ä¸­ï¼Œä¹Ÿä¸»è¦ä»‹ç»äº†æˆ‘ä»¬å®é™…å¼€å‘ä¸­éå¸¸å¸¸è§çš„â€œå›¾ç‰‡é¢„è§ˆâ€ã€â€œå›¾ç‰‡ä¸‹è½½â€å’Œâ€œç”Ÿæˆæ–‡ä»¶â€çš„åœºæ™¯ã€‚åœ¨æ–‡ç« æœ€åï¼Œä¹Ÿé€šè¿‡å’Œå¤§å®¶å¤ä¹ äº†â€œBlob URL å’Œ Data URL åŒºåˆ«â€ï¼Œè®©æˆ‘ä»¬å¯¹ Blob æœ‰æ›´æ·±çš„è®¤è¯†ã€‚</p>
<table>
<thead>
<tr>
<th>Author</th>
<th>ç‹å¹³å®‰</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#112;&#x69;&#110;&#103;&#x61;&#110;&#56;&#x37;&#x38;&#55;&#x40;&#x71;&#x71;&#46;&#x63;&#111;&#109;">&#112;&#x69;&#110;&#103;&#x61;&#110;&#56;&#x37;&#x38;&#55;&#x40;&#x71;&#x71;&#46;&#x63;&#111;&#109;</a></td>
</tr>
<tr>
<td>åš  å®¢</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>å¾®  ä¿¡</td>
<td>pingan8787</td>
</tr>
<tr>
<td>æ¯æ—¥æ–‡ç« æ¨è</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>ESå°å†Œ</td>
<td>js.pingan8787.com</td>
</tr>
<tr>
<td>è¯­é›€çŸ¥è¯†åº“</td>
<td><a target="_blank" rel="noopener" href="https://www.yuque.com/wangpingan/cute-frontend">Cute-FrontEnd</a></td>
</tr>
</tbody></table>
<p><img src="http://images.pingan8787.com/2019_07_12guild_page.png" alt="bg">  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/06/06/205-%E3%80%90%E8%AF%BB%E4%B9%A6%E3%80%91%E8%AF%BB%E3%80%8A%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84Blob%E3%80%8B%E6%80%BB%E7%BB%93/" data-id="ckts3ejyp00n24d9k7jzt1ddl" data-title="205-ã€è¯»ä¹¦ã€‘è¯»ã€Šä½ ä¸çŸ¥é“çš„Blobã€‹æ€»ç»“" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">å‰ç«¯å¼€å‘</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">åŸåˆ›</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag">è¯»ä¹¦ç¬”è®°</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-204-ã€TypeScriptã€‘TypeScriptä»£ç æ•´æ´ä¹‹é“" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/05/23/204-%E3%80%90TypeScript%E3%80%91TypeScript%E4%BB%A3%E7%A0%81%E6%95%B4%E6%B4%81%E4%B9%8B%E9%81%93/" class="article-date">
  <time class="dt-published" datetime="2020-05-23T14:41:39.000Z" itemprop="datePublished">2020-05-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/05/23/204-%E3%80%90TypeScript%E3%80%91TypeScript%E4%BB%A3%E7%A0%81%E6%95%B4%E6%B4%81%E4%B9%8B%E9%81%93/">204-ã€TypeScriptã€‘TypeScriptä»£ç æ•´æ´ä¹‹é“</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://github.com/pipiliang/clean-code-typescript">ä¸­æ–‡</a> | <a target="_blank" rel="noopener" href="https://github.com/labs42io/clean-code-typescript">English</a></p>
<blockquote>
<p>å°† Clean Code çš„æ¦‚å¿µé€‚ç”¨åˆ° TypeScriptï¼Œçµæ„Ÿæ¥è‡ª <a target="_blank" rel="noopener" href="https://github.com/ryanmcdermott/clean-code-javascript">clean-code-javascript</a>ã€‚</p>
</blockquote>
<h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a><a href="#%E7%9B%AE%E5%BD%95"></a>ç›®å½•</h2><ol>
<li> <a href="#%E7%AE%80%E4%BB%8B">ç®€ä»‹</a></li>
<li> <a href="#%E5%8F%98%E9%87%8F">å˜é‡</a></li>
<li> <a href="#%E5%87%BD%E6%95%B0">å‡½æ•°</a></li>
<li> <a href="#%E5%AF%B9%E8%B1%A1%E5%92%8C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">å¯¹è±¡ä¸æ•°æ®ç»“æ„</a></li>
<li> <a href="#%E7%B1%BB">ç±»</a></li>
<li> <a href="#SOLID%E5%8E%9F%E5%88%99">SOLIDåŸåˆ™</a></li>
<li> <a href="#%E6%B5%8B%E8%AF%95">æµ‹è¯•</a></li>
<li> <a href="#%E5%B9%B6%E5%8F%91">å¹¶å‘</a></li>
<li> <a href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86">é”™è¯¯å¤„ç†</a></li>
<li> <a href="#%E6%A0%BC%E5%BC%8F%E5%8C%96">æ ¼å¼åŒ–</a></li>
<li> <a href="#%E6%B3%A8%E9%87%8A">æ³¨é‡Š</a></li>
</ol>
<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a><a href="#%E7%AE%80%E4%BB%8B"></a>ç®€ä»‹</h2><p><a target="_blank" rel="noopener" href="https://camo.githubusercontent.com/0607e034aee88cce40b832367d44265e01b42654/68747470733a2f2f7777772e6f736e6577732e636f6d2f696d616765732f636f6d6963732f7774666d2e6a7067"><img src="https://camo.githubusercontent.com/0607e034aee88cce40b832367d44265e01b42654/68747470733a2f2f7777772e6f736e6577732e636f6d2f696d616765732f636f6d6963732f7774666d2e6a7067" alt="Humorous image of software quality estimation as a count of how many expletives you shout when reading code"></a></p>
<p>è¿™ä¸æ˜¯ä¸€ä»½ TypeScript ç¼–ç é£æ ¼è§„èŒƒï¼Œè€Œæ˜¯å°† Robert C. Martin çš„è½¯ä»¶å·¥ç¨‹è‘—ä½œ <a target="_blank" rel="noopener" href="https://www.amazon.com/Clean-Code-Handbook-Software-Craftsmanship/dp/0132350882">ã€ŠClean Codeã€‹</a> é€‚ç”¨åˆ° TypeScriptï¼Œå¼•å¯¼è¯»è€…ä½¿ç”¨ TypeScript ç¼–å†™<a target="_blank" rel="noopener" href="https://github.com/ryanmcdermott/3rs-of-software-architecture">æ˜“è¯»ã€å¤ç”¨å’Œå¯æ‰©å±•</a>çš„è½¯ä»¶ã€‚</p>
<p>å®é™…ä¸Šï¼Œå¹¶ä¸æ˜¯æ¯ä¸€ä¸ªåŸåˆ™éƒ½è¦ä¸¥æ ¼éµå®ˆï¼Œèƒ½è¢«å¹¿æ³›è®¤åŒçš„åŸåˆ™å°±æ›´å°‘äº†ã€‚è¿™çœ‹èµ·æ¥è™½ç„¶åªæ˜¯ä¸€ä»½æŒ‡å¯¼åŸåˆ™ï¼Œä½†å´æ˜¯ <em>Clean Code</em> ä½œè€…å¯¹å¤šå¹´ç¼–ç¨‹ç»éªŒçš„å‡ç»ƒã€‚</p>
<p>è½¯ä»¶å·¥ç¨‹æŠ€æœ¯å·²æœ‰50å¤šå¹´çš„å†å²äº†ï¼Œæˆ‘ä»¬ä»ç„¶è¦å­¦ä¹ å¾ˆå¤šçš„ä¸œè¥¿ã€‚å½“è½¯ä»¶æ¶æ„å’Œæ¶æ„æœ¬èº«ä¸€æ ·å¤è€çš„æ—¶å€™ï¼Œä¹Ÿè®¸æˆ‘ä»¬éœ€è¦éµå®ˆæ›´ä¸¥æ ¼çš„è§„åˆ™ã€‚ä½†æ˜¯ç°åœ¨ï¼Œè®©è¿™äº›æŒ‡å¯¼åŸåˆ™ä½œä¸ºè¯„ä¼°æ‚¨å’Œæ‚¨çš„å›¢é˜Ÿä»£ç è´¨é‡çš„è¯•é‡‘çŸ³ã€‚</p>
<p>å¦å¤–ï¼Œç†è§£è¿™äº›åŸåˆ™ä¸ä¼šç«‹å³è®©æ‚¨å˜çš„ä¼˜ç§€ï¼Œä¹Ÿä¸æ„å‘³ç€ä¸ä¼šçŠ¯é”™ã€‚æ¯ä¸€æ®µä»£ç éƒ½æ˜¯ä»ä¸å®Œç¾å¼€å§‹çš„ï¼Œé€šè¿‡åå¤èµ°æŸ¥ä¸æ–­è¶‹äºå®Œç¾ï¼Œå°±åƒé»åœŸåˆ¶ä½œæˆé™¶è‰ºä¸€æ ·ï¼Œäº«å—è¿™ä¸ªè¿‡ç¨‹å§!</p>
<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h2 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a><a href="#%E5%8F%98%E9%87%8F"></a>å˜é‡</h2><blockquote>
<p>è®¡ç®—æœºç§‘å­¦åªå­˜åœ¨ä¸¤ä¸ªéš¾é¢˜ï¼šç¼“å­˜å¤±æ•ˆå’Œå‘½åã€‚â€”â€” Phil KarIton</p>
</blockquote>
<h3 id="ä½¿ç”¨æœ‰æ„ä¹‰çš„å˜é‡å"><a href="#ä½¿ç”¨æœ‰æ„ä¹‰çš„å˜é‡å" class="headerlink" title="ä½¿ç”¨æœ‰æ„ä¹‰çš„å˜é‡å"></a><a href="#%E4%BD%BF%E7%94%A8%E6%9C%89%E6%84%8F%E4%B9%89%E7%9A%84%E5%8F%98%E9%87%8F%E5%90%8D"></a>ä½¿ç”¨æœ‰æ„ä¹‰çš„å˜é‡å</h3><p>åšæœ‰æ„ä¹‰çš„åŒºåˆ†ï¼Œè®©è¯»è€…æ›´å®¹æ˜“ç†è§£å˜é‡çš„å«ä¹‰ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">between</span>&lt;<span class="title">T</span>&gt;(<span class="params">a1: T, a2: T, a3: T</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> a2 &lt;= a1 &amp;&amp; a1 &lt;= a3;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">between</span>&lt;<span class="title">T</span>&gt;(<span class="params">value: T, left: T, right: T</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> left &lt;= value &amp;&amp; value &lt;= right;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="å¯è¯»çš„å˜é‡å"><a href="#å¯è¯»çš„å˜é‡å" class="headerlink" title="å¯è¯»çš„å˜é‡å"></a><a href="#%E5%8F%AF%E8%AF%BB%E7%9A%84%E5%8F%98%E9%87%8F%E5%90%8D"></a>å¯è¯»çš„å˜é‡å</h3><p>å¦‚æœä½ ä¸èƒ½æ­£ç¡®è¯»å‡ºå®ƒï¼Œé‚£ä¹ˆä½ åœ¨è®¨è®ºå®ƒæ—¶å¬èµ·æ¥å°±ä¼šåƒä¸ªç™½ç—´ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DtaRcrd102</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> genymdhms: <span class="built_in">Date</span>; #  <span class="comment">// ä½ èƒ½è¯»å‡ºè¿™ä¸ªå˜é‡åä¹ˆï¼Ÿ</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> modymdhms: <span class="built_in">Date</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> pszqint = <span class="string">&#x27;102&#x27;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> generationTimestamp: <span class="built_in">Date</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> modificationTimestamp: <span class="built_in">Date</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> recordId = <span class="string">&#x27;102&#x27;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="åˆå¹¶åŠŸèƒ½ä¸€è‡´çš„å˜é‡"><a href="#åˆå¹¶åŠŸèƒ½ä¸€è‡´çš„å˜é‡" class="headerlink" title="åˆå¹¶åŠŸèƒ½ä¸€è‡´çš„å˜é‡"></a><a href="#%E5%90%88%E5%B9%B6%E5%8A%9F%E8%83%BD%E4%B8%80%E8%87%B4%E7%9A%84%E5%8F%98%E9%87%8F"></a>åˆå¹¶åŠŸèƒ½ä¸€è‡´çš„å˜é‡</h3><p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUserInfo</span>(<span class="params"></span>): <span class="title">User</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUserDetails</span>(<span class="params"></span>): <span class="title">User</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUserData</span>(<span class="params"></span>): <span class="title">User</span></span>;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUser</span>(<span class="params"></span>): <span class="title">User</span></span>;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="ä¾¿äºæœç´¢çš„åå­—"><a href="#ä¾¿äºæœç´¢çš„åå­—" class="headerlink" title="ä¾¿äºæœç´¢çš„åå­—"></a><a href="#%E4%BE%BF%E4%BA%8E%E6%90%9C%E7%B4%A2%E7%9A%84%E5%90%8D%E5%AD%97"></a>ä¾¿äºæœç´¢çš„åå­—</h3><p>å¾€å¾€æˆ‘ä»¬è¯»ä»£ç è¦æ¯”å†™çš„å¤šï¼Œæ‰€ä»¥æ˜“è¯»æ€§å’Œå¯æœç´¢éå¸¸é‡è¦ã€‚å¦‚æœä¸æŠ½å–å¹¶å‘½åæœ‰æ„ä¹‰çš„å˜é‡åï¼Œé‚£å°±å‘äº†è¯»ä»£ç çš„äººã€‚ä»£ç ä¸€å®šè¦ä¾¿äºæœç´¢ï¼Œ<a target="_blank" rel="noopener" href="https://palantir.github.io/tslint/rules/no-magic-numbers/">TSLint</a> å°±å¯ä»¥å¸®åŠ©è¯†åˆ«æœªå‘½åçš„å¸¸é‡ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//86400000 ä»£è¡¨ä»€ä¹ˆï¼Ÿ</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(restart, <span class="number">86400000</span>);</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å£°æ˜ä¸ºå¸¸é‡ï¼Œè¦å¤§å†™ä¸”æœ‰æ˜ç¡®å«ä¹‰ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MILLISECONDS_IN_A_DAY = <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(restart, MILLISECONDS_IN_A_DAY);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="ä½¿ç”¨è‡ªè§£é‡Šçš„å˜é‡å"><a href="#ä½¿ç”¨è‡ªè§£é‡Šçš„å˜é‡å" class="headerlink" title="ä½¿ç”¨è‡ªè§£é‡Šçš„å˜é‡å"></a><a href="#%E4%BD%BF%E7%94%A8%E8%87%AA%E8%A7%A3%E9%87%8A%E7%9A%84%E5%8F%98%E9%87%8F%E5%90%8D"></a>ä½¿ç”¨è‡ªè§£é‡Šçš„å˜é‡å</h3><p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="keyword">const</span> users:<span class="built_in">Map</span>&lt;<span class="built_in">string</span>, User&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> keyValue <span class="keyword">of</span> users) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="keyword">const</span> users:<span class="built_in">Map</span>&lt;<span class="built_in">string</span>, User&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> [id, user] <span class="keyword">of</span> users) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="é¿å…æ€ç»´æ˜ å°„"><a href="#é¿å…æ€ç»´æ˜ å°„" class="headerlink" title="é¿å…æ€ç»´æ˜ å°„"></a><a href="#%E9%81%BF%E5%85%8D%E6%80%9D%E7%BB%B4%E6%98%A0%E5%B0%84"></a>é¿å…æ€ç»´æ˜ å°„</h3><p>ä¸è¦è®©äººå»çŒœæµ‹æˆ–æƒ³è±¡å˜é‡çš„å«ä¹‰ï¼Œ<em>æ˜ç¡®æ˜¯ç‹é“ã€‚</em></p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> u = getUser();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> s = getSubscription();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> t = charge(u, s);</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user = getUser();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> subscription = getSubscription();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> transaction = charge(user, subscription);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="ä¸æ·»åŠ æ— ç”¨çš„ä¸Šä¸‹æ–‡"><a href="#ä¸æ·»åŠ æ— ç”¨çš„ä¸Šä¸‹æ–‡" class="headerlink" title="ä¸æ·»åŠ æ— ç”¨çš„ä¸Šä¸‹æ–‡"></a><a href="#%E4%B8%8D%E6%B7%BB%E5%8A%A0%E6%97%A0%E7%94%A8%E7%9A%84%E4%B8%8A%E4%B8%8B%E6%96%87"></a>ä¸æ·»åŠ æ— ç”¨çš„ä¸Šä¸‹æ–‡</h3><p>å¦‚æœç±»åæˆ–å¯¹è±¡åå·²ç»è¡¨è¾¾äº†æŸäº›ä¿¡æ¯ï¼Œåœ¨å†…éƒ¨å˜é‡åä¸­ä¸è¦å†é‡å¤è¡¨è¾¾ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Car = &#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">carMake</span>: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  carModel: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  carColor: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">print</span>(<span class="params">car: Car</span>): <span class="title">void</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.carMake&#125;</span> <span class="subst">$&#123;<span class="built_in">this</span>.carModel&#125;</span> (<span class="subst">$&#123;<span class="built_in">this</span>.carColor&#125;</span>)`</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Car = &#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">make</span>: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  model: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  color: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">print</span>(<span class="params">car: Car</span>): <span class="title">void</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.make&#125;</span> <span class="subst">$&#123;<span class="built_in">this</span>.model&#125;</span> (<span class="subst">$&#123;<span class="built_in">this</span>.color&#125;</span>)`</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="ä½¿ç”¨é»˜è®¤å‚æ•°ï¼Œè€ŒéçŸ­è·¯æˆ–æ¡ä»¶åˆ¤æ–­"><a href="#ä½¿ç”¨é»˜è®¤å‚æ•°ï¼Œè€ŒéçŸ­è·¯æˆ–æ¡ä»¶åˆ¤æ–­" class="headerlink" title="ä½¿ç”¨é»˜è®¤å‚æ•°ï¼Œè€ŒéçŸ­è·¯æˆ–æ¡ä»¶åˆ¤æ–­"></a><a href="#%E4%BD%BF%E7%94%A8%E9%BB%98%E8%AE%A4%E5%8F%82%E6%95%B0%E8%80%8C%E9%9D%9E%E7%9F%AD%E8%B7%AF%E6%88%96%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD"></a>ä½¿ç”¨é»˜è®¤å‚æ•°ï¼Œè€ŒéçŸ­è·¯æˆ–æ¡ä»¶åˆ¤æ–­</h3><p>é€šå¸¸ï¼Œé»˜è®¤å‚æ•°æ¯”çŸ­è·¯æ›´æ•´æ´ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadPages</span>(<span class="params">count: <span class="built_in">number</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> loadCount = count !== <span class="literal">undefined</span> ? count : <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadPages</span>(<span class="params">count: <span class="built_in">number</span> = <span class="number">10</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a><a href="#%E5%87%BD%E6%95%B0"></a>å‡½æ•°</h2><h3 id="å‚æ•°è¶Šå°‘è¶Šå¥½-ç†æƒ³æƒ…å†µä¸è¶…è¿‡2ä¸ª"><a href="#å‚æ•°è¶Šå°‘è¶Šå¥½-ç†æƒ³æƒ…å†µä¸è¶…è¿‡2ä¸ª" class="headerlink" title="å‚æ•°è¶Šå°‘è¶Šå¥½ (ç†æƒ³æƒ…å†µä¸è¶…è¿‡2ä¸ª)"></a><a href="#%E5%8F%82%E6%95%B0%E8%B6%8A%E5%B0%91%E8%B6%8A%E5%A5%BD-%E7%90%86%E6%83%B3%E6%83%85%E5%86%B5%E4%B8%8D%E8%B6%85%E8%BF%872%E4%B8%AA"></a>å‚æ•°è¶Šå°‘è¶Šå¥½ (ç†æƒ³æƒ…å†µä¸è¶…è¿‡2ä¸ª)</h3><p>é™åˆ¶å‚æ•°ä¸ªæ•°ï¼Œè¿™æ ·å‡½æ•°æµ‹è¯•ä¼šæ›´å®¹æ˜“ã€‚è¶…è¿‡ä¸‰ä¸ªå‚æ•°ä¼šå¯¼è‡´æµ‹è¯•å¤æ‚åº¦æ¿€å¢ï¼Œéœ€è¦æµ‹è¯•ä¼—å¤šä¸åŒå‚æ•°çš„ç»„åˆåœºæ™¯ã€‚ ç†æƒ³æƒ…å†µï¼Œåªæœ‰ä¸€ä¸¤ä¸ªå‚æ•°ã€‚å¦‚æœæœ‰ä¸¤ä¸ªä»¥ä¸Šçš„å‚æ•°ï¼Œé‚£ä¹ˆæ‚¨çš„å‡½æ•°å¯èƒ½å°±å¤ªè¿‡å¤æ‚äº†ã€‚</p>
<p>å¦‚æœéœ€è¦å¾ˆå¤šå‚æ•°ï¼Œè¯·æ‚¨è€ƒè™‘ä½¿ç”¨å¯¹è±¡ã€‚ä¸ºäº†ä½¿å‡½æ•°çš„å±æ€§æ›´æ¸…æ™°ï¼Œå¯ä»¥ä½¿ç”¨<a target="_blank" rel="noopener" href="https://basarat.gitbooks.io/typescript/docs/destructuring.html">è§£æ„</a>ï¼Œå®ƒæœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p>
<ol>
<li> å½“æœ‰äººæŸ¥çœ‹å‡½æ•°ç­¾åæ—¶ï¼Œä¼šç«‹å³æ¸…æ¥šä½¿ç”¨äº†å“ªäº›å±æ€§ã€‚</li>
<li> è§£æ„å¯¹ä¼ é€’ç»™å‡½æ•°çš„å‚æ•°å¯¹è±¡åšæ·±æ‹·è´ï¼Œè¿™å¯é¢„é˜²å‰¯ä½œç”¨ã€‚(æ³¨æ„ï¼š<strong>ä¸ä¼šå…‹éš†</strong>ä»å‚æ•°å¯¹è±¡ä¸­è§£æ„çš„å¯¹è±¡å’Œæ•°ç»„)</li>
<li> TypeScript ä¼šå¯¹æœªä½¿ç”¨çš„å±æ€§æ˜¾ç¤ºè­¦å‘Šã€‚</li>
</ol>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createMenu</span>(<span class="params">title: <span class="built_in">string</span>, body: <span class="built_in">string</span>, buttonText: <span class="built_in">string</span>, cancellable: <span class="built_in">boolean</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">createMenu(<span class="string">&#x27;Foo&#x27;</span>, <span class="string">&#x27;Bar&#x27;</span>, <span class="string">&#x27;Baz&#x27;</span>, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createMenu</span>(<span class="params">options: &#123;title: <span class="built_in">string</span>, body: <span class="built_in">string</span>, buttonText: <span class="built_in">string</span>, cancellable: <span class="built_in">boolean</span>&#125;</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">createMenu(</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;Foo&#x27;</span>,</span><br><span class="line">    <span class="attr">body</span>: <span class="string">&#x27;Bar&#x27;</span>,</span><br><span class="line">    <span class="attr">buttonText</span>: <span class="string">&#x27;Baz&#x27;</span>,</span><br><span class="line">    <span class="attr">cancellable</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ TypeScript çš„<a target="_blank" rel="noopener" href="https://www.typescriptlang.org/docs/handbook/advanced-types.html#type-aliases">ç±»å‹åˆ«å</a>ï¼Œå¯ä»¥è¿›ä¸€æ­¥æé«˜å¯è¯»æ€§ã€‚</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MenuOptions = &#123;<span class="attr">title</span>: <span class="built_in">string</span>, <span class="attr">body</span>: <span class="built_in">string</span>, <span class="attr">buttonText</span>: <span class="built_in">string</span>, <span class="attr">cancellable</span>: <span class="built_in">boolean</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createMenu</span>(<span class="params">options: MenuOptions</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">createMenu(</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;Foo&#x27;</span>,</span><br><span class="line">    <span class="attr">body</span>: <span class="string">&#x27;Bar&#x27;</span>,</span><br><span class="line">    <span class="attr">buttonText</span>: <span class="string">&#x27;Baz&#x27;</span>,</span><br><span class="line">    <span class="attr">cancellable</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="åªåšä¸€ä»¶äº‹"><a href="#åªåšä¸€ä»¶äº‹" class="headerlink" title="åªåšä¸€ä»¶äº‹"></a><a href="#%E5%8F%AA%E5%81%9A%E4%B8%80%E4%BB%B6%E4%BA%8B"></a>åªåšä¸€ä»¶äº‹</h3><p>è¿™æ˜¯ç›®å‰è½¯ä»¶å·¥ç¨‹ä¸­æœ€é‡è¦çš„è§„åˆ™ã€‚å¦‚æœå‡½æ•°åšä¸æ­¢ä¸€ä»¶äº‹ï¼Œå®ƒå°±æ›´éš¾ç»„åˆã€æµ‹è¯•ä»¥åŠç†è§£ã€‚åä¹‹ï¼Œå‡½æ•°åªæœ‰ä¸€ä¸ªè¡Œä¸ºï¼Œå®ƒå°±æ›´æ˜“äºé‡æ„ã€ä»£ç å°±æ›´æ¸…æ™°ã€‚å¦‚æœèƒ½åšå¥½è¿™ä¸€ç‚¹ï¼Œä½ ä¸€å®šå¾ˆä¼˜ç§€ï¼</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">emailClients</span>(<span class="params">clients: Client</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  clients.forEach(<span class="function">(<span class="params">client</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> clientRecord = database.lookup(client);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (clientRecord.isActive()) &#123;</span><br><span class="line"></span><br><span class="line">      email(client);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">emailClients</span>(<span class="params">clients: Client</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  clients.filter(isActiveClient).forEach(email);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isActiveClient</span>(<span class="params">client: Client</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> clientRecord = database.lookup(client);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> clientRecord.isActive();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="åå‰¯å…¶å®"><a href="#åå‰¯å…¶å®" class="headerlink" title="åå‰¯å…¶å®"></a><a href="#%E5%90%8D%E5%89%AF%E5%85%B6%E5%AE%9E"></a>åå‰¯å…¶å®</h3><p>é€šè¿‡å‡½æ•°åå°±å¯ä»¥çœ‹å¾—å‡ºå‡½æ•°å®ç°çš„åŠŸèƒ½ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addToDate</span>(<span class="params">date: <span class="built_in">Date</span>, month: <span class="built_in">number</span></span>): <span class="title">Date</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»å‡½æ•°åå¾ˆéš¾çœ‹çš„å‡ºéœ€è¦åŠ ä»€ä¹ˆï¼Ÿ</span></span><br><span class="line">addToDate(date, <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addMonthToDate</span>(<span class="params">date: <span class="built_in">Date</span>, month: <span class="built_in">number</span></span>): <span class="title">Date</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line"></span><br><span class="line">addMonthToDate(date, <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="æ¯ä¸ªå‡½æ•°åªåŒ…å«åŒä¸€ä¸ªå±‚çº§çš„æŠ½è±¡"><a href="#æ¯ä¸ªå‡½æ•°åªåŒ…å«åŒä¸€ä¸ªå±‚çº§çš„æŠ½è±¡" class="headerlink" title="æ¯ä¸ªå‡½æ•°åªåŒ…å«åŒä¸€ä¸ªå±‚çº§çš„æŠ½è±¡"></a><a href="#%E6%AF%8F%E4%B8%AA%E5%87%BD%E6%95%B0%E5%8F%AA%E5%8C%85%E5%90%AB%E5%90%8C%E4%B8%80%E4%B8%AA%E5%B1%82%E7%BA%A7%E7%9A%84%E6%8A%BD%E8%B1%A1"></a>æ¯ä¸ªå‡½æ•°åªåŒ…å«åŒä¸€ä¸ªå±‚çº§çš„æŠ½è±¡</h3><p>å½“æœ‰å¤šä¸ªæŠ½è±¡çº§åˆ«æ—¶ï¼Œå‡½æ•°åº”è¯¥æ˜¯åšå¤ªå¤šäº‹äº†ã€‚æ‹†åˆ†å‡½æ•°ä»¥ä¾¿å¯å¤ç”¨ï¼Œä¹Ÿè®©æµ‹è¯•æ›´å®¹æ˜“ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseCode</span>(<span class="params">code:<span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> REGEXES = [ <span class="comment">/* ... */</span> ];</span><br><span class="line">  <span class="keyword">const</span> statements = code.split(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> tokens = [];</span><br><span class="line"></span><br><span class="line">  REGEXES.forEach(<span class="function">(<span class="params">regex</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    statements.forEach(<span class="function">(<span class="params">statement</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> ast = [];</span><br><span class="line"></span><br><span class="line">  tokens.forEach(<span class="function">(<span class="params">token</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// lex...</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  ast.forEach(<span class="function">(<span class="params">node</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// è§£æ ...</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> REGEXES = [ <span class="comment">/* ... */</span> ];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseCode</span>(<span class="params">code:<span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> tokens = tokenize(code);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> syntaxTree = parse(tokens);</span><br><span class="line"></span><br><span class="line">  syntaxTree.forEach(<span class="function">(<span class="params">node</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// parse...</span></span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">tokenize</span>(<span class="params">code: <span class="built_in">string</span></span>):<span class="title">Token</span>[] </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> statements = code.split(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> tokens:Token[] = [];</span><br><span class="line"></span><br><span class="line">  REGEXES.forEach(<span class="function">(<span class="params">regex</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    statements.forEach(<span class="function">(<span class="params">statement</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">      tokens.push( <span class="comment">/* ... */</span> );</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> tokens;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parse</span>(<span class="params">tokens: Token[]</span>): <span class="title">SyntaxTree</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> syntaxTree:SyntaxTree[] = [];</span><br><span class="line"></span><br><span class="line">  tokens.forEach(<span class="function">(<span class="params">token</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    syntaxTree.push( <span class="comment">/* ... */</span> );</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> syntaxTree;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="åˆ é™¤é‡å¤ä»£ç "><a href="#åˆ é™¤é‡å¤ä»£ç " class="headerlink" title="åˆ é™¤é‡å¤ä»£ç "></a><a href="#%E5%88%A0%E9%99%A4%E9%87%8D%E5%A4%8D%E4%BB%A3%E7%A0%81"></a>åˆ é™¤é‡å¤ä»£ç </h3><p>é‡å¤ä¹ƒä¸‡æ¶ä¹‹æºï¼é‡å¤æ„å‘³ç€å¦‚æœè¦ä¿®æ”¹æŸä¸ªé€»è¾‘ï¼Œéœ€è¦ä¿®æ”¹å¤šå¤„ä»£ç  ğŸ˜¢ã€‚ æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœä½ ç»è¥ä¸€å®¶é¤å…ï¼Œè¦è®°å½•ä½ çš„åº“å­˜:æ‰€æœ‰çš„è¥¿çº¢æŸ¿ã€æ´‹è‘±ã€å¤§è’œã€é¦™æ–™ç­‰ç­‰ã€‚å¦‚æœè¦ç»´æŠ¤å¤šä¸ªåº“å­˜åˆ—è¡¨ï¼Œé‚£æ˜¯å¤šä¹ˆç—›è‹¦çš„äº‹!</p>
<p>å­˜åœ¨é‡å¤ä»£ç ï¼Œæ˜¯å› ä¸ºæœ‰ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šå¾ˆè¿‘ä¼¼çš„åŠŸèƒ½ï¼Œåªæœ‰ä¸€ç‚¹ä¸åŒï¼Œä½†æ˜¯è¿™ç‚¹ä¸åŒè¿«ä½¿ä½ ç”¨å¤šä¸ªç‹¬ç«‹çš„å‡½æ•°æ¥åšå¾ˆå¤šå‡ ä¹ç›¸åŒçš„äº‹æƒ…ã€‚åˆ é™¤é‡å¤ä»£ç ï¼Œåˆ™æ„å‘³ç€åˆ›å»ºä¸€ä¸ªæŠ½è±¡ï¼Œè¯¥æŠ½è±¡ä»…ç”¨ä¸€ä¸ªå‡½æ•°/æ¨¡å—/ç±»å°±å¯ä»¥å¤„ç†è¿™ç»„ä¸åŒçš„ä¸œè¥¿ã€‚</p>
<p>åˆç†çš„æŠ½è±¡è‡³å…³é‡è¦ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ‚¨åº”è¯¥éµå¾ª<a href="#SOLID%E5%8E%9F%E5%88%99">SOLIDåŸåˆ™</a>ã€‚ç³Ÿç³•çš„æŠ½è±¡å¯èƒ½è¿˜ä¸å¦‚é‡å¤ä»£ç ï¼Œæ‰€ä»¥è¦å°å¿ƒï¼è¯è™½å¦‚æ­¤ï¼Œè¿˜æ˜¯è¦åšå¥½æŠ½è±¡ï¼å°½é‡ä¸è¦é‡å¤ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showDeveloperList</span>(<span class="params">developers: Developer[]</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  developers.forEach(<span class="function">(<span class="params">developer</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> expectedSalary = developer.calculateExpectedSalary();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> experience = developer.getExperience();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> githubLink = developer.getGithubLink();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> data = &#123;</span><br><span class="line"></span><br><span class="line">      expectedSalary,</span><br><span class="line"></span><br><span class="line">      experience,</span><br><span class="line"></span><br><span class="line">      githubLink</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    render(data);</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showManagerList</span>(<span class="params">managers: Manager[]</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  managers.forEach(<span class="function">(<span class="params">manager</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> expectedSalary = manager.calculateExpectedSalary();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> experience = manager.getExperience();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> portfolio = manager.getMBAProjects();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> data = &#123;</span><br><span class="line"></span><br><span class="line">      expectedSalary,</span><br><span class="line"></span><br><span class="line">      experience,</span><br><span class="line"></span><br><span class="line">      portfolio</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    render(data);</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Developer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">getExtraDetails</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line"></span><br><span class="line">      <span class="attr">githubLink</span>: <span class="built_in">this</span>.githubLink,</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Manager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">getExtraDetails</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line"></span><br><span class="line">      <span class="attr">portfolio</span>: <span class="built_in">this</span>.portfolio,</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showEmployeeList</span>(<span class="params">employee: Developer | Manager</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  employee.forEach(<span class="function">(<span class="params">employee</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> expectedSalary = developer.calculateExpectedSalary();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> experience = developer.getExperience();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> extra = employee.getExtraDetails();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> data = &#123;</span><br><span class="line"></span><br><span class="line">      expectedSalary,</span><br><span class="line"></span><br><span class="line">      experience,</span><br><span class="line"></span><br><span class="line">      extra,</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    render(data);</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ‰æ—¶ï¼Œåœ¨é‡å¤ä»£ç å’Œå¼•å…¥ä¸å¿…è¦çš„æŠ½è±¡è€Œå¢åŠ çš„å¤æ‚æ€§ä¹‹é—´ï¼Œéœ€è¦åšæƒè¡¡ã€‚å½“æ¥è‡ªä¸åŒé¢†åŸŸçš„ä¸¤ä¸ªä¸åŒæ¨¡å—ï¼Œå®ƒä»¬çš„å®ç°çœ‹èµ·æ¥ç›¸ä¼¼ï¼Œå¤åˆ¶ä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„ï¼Œå¹¶ä¸”æ¯”æŠ½å–å…¬å…±ä»£ç è¦å¥½ä¸€ç‚¹ã€‚å› ä¸ºæŠ½å–å…¬å…±ä»£ç ä¼šå¯¼è‡´ä¸¤ä¸ªæ¨¡å—äº§ç”Ÿé—´æ¥çš„ä¾èµ–å…³ç³»ã€‚</p>
<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="ä½¿ç”¨Object-assignæˆ–è§£æ„æ¥è®¾ç½®é»˜è®¤å¯¹è±¡"><a href="#ä½¿ç”¨Object-assignæˆ–è§£æ„æ¥è®¾ç½®é»˜è®¤å¯¹è±¡" class="headerlink" title="ä½¿ç”¨Object.assignæˆ–è§£æ„æ¥è®¾ç½®é»˜è®¤å¯¹è±¡"></a><a href="#%E4%BD%BF%E7%94%A8objectassign%E6%88%96%E8%A7%A3%E6%9E%84%E6%9D%A5%E8%AE%BE%E7%BD%AE%E9%BB%98%E8%AE%A4%E5%AF%B9%E8%B1%A1"></a>ä½¿ç”¨<code>Object.assign</code>æˆ–<code>è§£æ„</code>æ¥è®¾ç½®é»˜è®¤å¯¹è±¡</h3><p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MenuConfig = &#123;title?: <span class="built_in">string</span>, body?: <span class="built_in">string</span>, buttonText?: <span class="built_in">string</span>, cancellable?: <span class="built_in">boolean</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createMenu</span>(<span class="params">config: MenuConfig</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  config.title = config.title || <span class="string">&#x27;Foo&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  config.body = config.body || <span class="string">&#x27;Bar&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  config.buttonText = config.buttonText || <span class="string">&#x27;Baz&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  config.cancellable = config.cancellable !== <span class="literal">undefined</span> ? config.cancellable : <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> menuConfig = &#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">title</span>: <span class="literal">null</span>,</span><br><span class="line"></span><br><span class="line">  <span class="attr">body</span>: <span class="string">&#x27;Bar&#x27;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="attr">buttonText</span>: <span class="literal">null</span>,</span><br><span class="line"></span><br><span class="line">  <span class="attr">cancellable</span>: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">createMenu(menuConfig);</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MenuConfig = &#123;title?: <span class="built_in">string</span>, body?: <span class="built_in">string</span>, buttonText?: <span class="built_in">string</span>, cancellable?: <span class="built_in">boolean</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createMenu</span>(<span class="params">config: MenuConfig</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> menuConfig = <span class="built_in">Object</span>.assign(&#123;</span><br><span class="line"></span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;Foo&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="attr">body</span>: <span class="string">&#x27;Bar&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="attr">buttonText</span>: <span class="string">&#x27;Baz&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="attr">cancellable</span>: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  &#125;, config);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">createMenu(&#123; <span class="attr">body</span>: <span class="string">&#x27;Bar&#x27;</span> &#125;);</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨é»˜è®¤å€¼çš„è§£æ„:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MenuConfig = &#123;title?: <span class="built_in">string</span>, body?: <span class="built_in">string</span>, buttonText?: <span class="built_in">string</span>, cancellable?: <span class="built_in">boolean</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createMenu</span>(<span class="params">&#123;title = <span class="string">&#x27;Foo&#x27;</span>, body = <span class="string">&#x27;Bar&#x27;</span>, buttonText = <span class="string">&#x27;Baz&#x27;</span>, cancellable = <span class="literal">true</span>&#125;: MenuConfig</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">createMenu(&#123; <span class="attr">body</span>: <span class="string">&#x27;Bar&#x27;</span> &#125;);</span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†é¿å…å‰¯ä½œç”¨ï¼Œä¸å…è®¸æ˜¾å¼ä¼ é€’<code>undefined</code>æˆ–<code>null</code>å€¼ã€‚å‚è§ TypeScript ç¼–è¯‘å™¨çš„<code>--strictnullcheck</code>é€‰é¡¹ã€‚</p>
<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="ä¸è¦ä½¿ç”¨Flagå‚æ•°"><a href="#ä¸è¦ä½¿ç”¨Flagå‚æ•°" class="headerlink" title="ä¸è¦ä½¿ç”¨Flagå‚æ•°"></a><a href="#%E4%B8%8D%E8%A6%81%E4%BD%BF%E7%94%A8flag%E5%8F%82%E6%95%B0"></a>ä¸è¦ä½¿ç”¨Flagå‚æ•°</h3><p>Flagå‚æ•°å‘Šè¯‰ç”¨æˆ·è¿™ä¸ªå‡½æ•°åšäº†ä¸æ­¢ä¸€ä»¶äº‹ã€‚å¦‚æœå‡½æ•°ä½¿ç”¨å¸ƒå°”å€¼å®ç°ä¸åŒçš„ä»£ç é€»è¾‘è·¯å¾„ï¼Œåˆ™è€ƒè™‘å°†å…¶æ‹†åˆ†ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createFile</span>(<span class="params">name:<span class="built_in">string</span>, temp:<span class="built_in">boolean</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (temp) &#123;</span><br><span class="line"></span><br><span class="line">    fs.create(<span class="string">`./temp/<span class="subst">$&#123;name&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">    fs.create(name);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createFile</span>(<span class="params">name:<span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  fs.create(name);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createTempFile</span>(<span class="params">name:<span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  fs.create(<span class="string">`./temp/<span class="subst">$&#123;name&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="é¿å…å‰¯ä½œç”¨-part1"><a href="#é¿å…å‰¯ä½œç”¨-part1" class="headerlink" title="é¿å…å‰¯ä½œç”¨ (part1)"></a><a href="#%E9%81%BF%E5%85%8D%E5%89%AF%E4%BD%9C%E7%94%A8-part1"></a>é¿å…å‰¯ä½œç”¨ (part1)</h3><p>å½“å‡½æ•°äº§ç”Ÿé™¤äº†â€œä¸€ä¸ªè¾“å…¥ä¸€ä¸ªè¾“å‡ºâ€ä¹‹å¤–çš„è¡Œä¸ºæ—¶ï¼Œç§°è¯¥å‡½æ•°äº§ç”Ÿäº†å‰¯ä½œç”¨ã€‚æ¯”å¦‚å†™æ–‡ä»¶ã€ä¿®æ”¹å…¨å±€å˜é‡æˆ–å°†ä½ çš„é’±å…¨è½¬ç»™äº†ä¸€ä¸ªé™Œç”Ÿäººç­‰ã€‚</p>
<p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç¨‹åºéœ€è¦ä¸€äº›å‰¯ä½œç”¨ã€‚å¦‚å…ˆå‰ä¾‹å­ä¸­çš„å†™æ–‡ä»¶ï¼Œè¿™æ—¶åº”è¯¥å°†è¿™äº›åŠŸèƒ½é›†ä¸­åœ¨ä¸€èµ·ï¼Œä¸è¦ç”¨å¤šä¸ªå‡½æ•°/ç±»ä¿®æ”¹æŸä¸ªæ–‡ä»¶ã€‚ç”¨ä¸”åªç”¨ä¸€ä¸ª service å®Œæˆè¿™ä¸€éœ€æ±‚ã€‚</p>
<p>é‡ç‚¹æ˜¯è¦è§„é¿å¸¸è§é™·é˜±ï¼Œæ¯”å¦‚ï¼Œåœ¨æ— ç»“æ„å¯¹è±¡ä¹‹é—´å…±äº«çŠ¶æ€ã€ä½¿ç”¨å¯å˜æ•°æ®ç±»å‹ï¼Œä»¥åŠä¸ç¡®å®šå‰¯ä½œç”¨å‘ç”Ÿçš„ä½ç½®ã€‚å¦‚æœä½ èƒ½åšåˆ°è¿™ç‚¹ï¼Œä½ æ‰å¯èƒ½ç¬‘åˆ°æœ€åï¼</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Global variable referenced by following function.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// If we had another function that used this name, now it&#x27;d be an array and it could break it.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> name = <span class="string">&#x27;Robert C. Martin&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toBase64</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  name = btoa(name);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">toBase64(); <span class="comment">// produces side effects to `name` variable</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(name); <span class="comment">// expected to print &#x27;Robert C. Martin&#x27; but instead &#x27;Um9iZXJ0IEMuIE1hcnRpbg==&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Global variable referenced by following function.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// If we had another function that used this name, now it&#x27;d be an array and it could break it.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> name = <span class="string">&#x27;Robert C. Martin&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toBase64</span>(<span class="params">text:<span class="built_in">string</span></span>):<span class="title">string</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> btoa(text);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> encodedName = toBase64(name);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(name);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="é¿å…å‰¯ä½œç”¨-part2"><a href="#é¿å…å‰¯ä½œç”¨-part2" class="headerlink" title="é¿å…å‰¯ä½œç”¨ (part2)"></a><a href="#%E9%81%BF%E5%85%8D%E5%89%AF%E4%BD%9C%E7%94%A8-part2"></a>é¿å…å‰¯ä½œç”¨ (part2)</h3><p>åœ¨ JavaScript ä¸­ï¼ŒåŸç±»å‹æ˜¯å€¼ä¼ é€’ï¼Œå¯¹è±¡ã€æ•°ç»„æ˜¯å¼•ç”¨ä¼ é€’ã€‚</p>
<p>æœ‰è¿™æ ·ä¸€ç§æƒ…å†µï¼Œå¦‚æœæ‚¨çš„å‡½æ•°ä¿®æ”¹äº†è´­ç‰©è½¦æ•°ç»„ï¼Œç”¨æ¥æ·»åŠ è´­ä¹°çš„å•†å“ï¼Œé‚£ä¹ˆå…¶ä»–ä½¿ç”¨è¯¥<code>cart</code>æ•°ç»„çš„å‡½æ•°éƒ½å°†å—æ­¤æ·»åŠ æ“ä½œçš„å½±å“ã€‚æƒ³è±¡ä¸€ä¸ªç³Ÿç³•çš„æƒ…å†µ:</p>
<p>ç”¨æˆ·ç‚¹å‡»â€œè´­ä¹°â€æŒ‰é’®ï¼Œè¯¥æŒ‰é’®è°ƒç”¨<code>purchase</code>å‡½æ•°ï¼Œå‡½æ•°è¯·æ±‚ç½‘ç»œå¹¶å°†<code>cart</code>æ•°ç»„å‘é€åˆ°æœåŠ¡å™¨ã€‚ç”±äºç½‘ç»œè¿æ¥ä¸å¥½ï¼Œè´­ä¹°åŠŸèƒ½å¿…é¡»ä¸æ–­é‡è¯•è¯·æ±‚ã€‚æ°å·§åœ¨ç½‘ç»œè¯·æ±‚å¼€å§‹å‰ï¼Œç”¨æˆ·ä¸å°å¿ƒç‚¹å‡»äº†æŸä¸ªä¸æƒ³è¦çš„é¡¹ç›®ä¸Šçš„â€œAdd to Cartâ€æŒ‰é’®ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿè€Œæ­¤æ—¶ç½‘ç»œè¯·æ±‚å¼€å§‹ï¼Œé‚£ä¹ˆ<code>purchase</code>å‡½æ•°å°†å‘é€æ„å¤–æ·»åŠ çš„é¡¹ï¼Œå› ä¸ºå®ƒå¼•ç”¨äº†ä¸€ä¸ªè´­ç‰©è½¦æ•°ç»„ï¼Œ<code>addItemToCart</code>å‡½æ•°ä¿®æ”¹äº†è¯¥æ•°ç»„ï¼Œæ·»åŠ äº†ä¸éœ€è¦çš„é¡¹ã€‚</p>
<p>ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯<code>addItemToCart</code>æ€»æ˜¯å…‹éš†<code>cart</code>ï¼Œç¼–è¾‘å®ƒï¼Œå¹¶è¿”å›å…‹éš†ã€‚è¿™ç¡®ä¿å¼•ç”¨è´­ç‰©è½¦çš„å…¶ä»–å‡½æ•°ä¸ä¼šå—åˆ°ä»»ä½•æ›´æ”¹çš„å½±å“ã€‚</p>
<p>æ³¨æ„ä¸¤ç‚¹:</p>
<ol>
<li><p> åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½ç¡®å®æƒ³è¦ä¿®æ”¹è¾“å…¥å¯¹è±¡ï¼Œè¿™ç§æƒ…å†µéå¸¸å°‘è§ã€‚ä¸”å¤§å¤šæ•°å¯ä»¥é‡æ„ï¼Œç¡®ä¿æ²¡å‰¯ä½œç”¨ï¼(è§<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Pure_function">çº¯å‡½æ•°</a>)</p>
</li>
<li><p> æ€§èƒ½æ–¹é¢ï¼Œå…‹éš†å¤§å¯¹è±¡ä»£ä»·ç¡®å®æ¯”è¾ƒå¤§ã€‚è¿˜å¥½æœ‰ä¸€äº›å¾ˆå¥½çš„åº“ï¼Œå®ƒæä¾›äº†ä¸€äº›é«˜æ•ˆå¿«é€Ÿçš„æ–¹æ³•ï¼Œä¸”ä¸åƒæ‰‹åŠ¨å…‹éš†å¯¹è±¡å’Œæ•°ç»„é‚£æ ·å ç”¨å¤§é‡å†…å­˜ã€‚</p>
</li>
</ol>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addItemToCart</span>(<span class="params">cart: CartItem[], item:Item</span>):<span class="title">void</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  cart.push(&#123; item, <span class="attr">date</span>: <span class="built_in">Date</span>.now() &#125;);</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addItemToCart</span>(<span class="params">cart: CartItem[], item:Item</span>):<span class="title">CartItem</span>[] </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> [...cart, &#123; item, <span class="attr">date</span>: <span class="built_in">Date</span>.now() &#125;];</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="ä¸è¦å†™å…¨å±€å‡½æ•°"><a href="#ä¸è¦å†™å…¨å±€å‡½æ•°" class="headerlink" title="ä¸è¦å†™å…¨å±€å‡½æ•°"></a><a href="#%E4%B8%8D%E8%A6%81%E5%86%99%E5%85%A8%E5%B1%80%E5%87%BD%E6%95%B0"></a>ä¸è¦å†™å…¨å±€å‡½æ•°</h3><p>åœ¨ JavaScript ä¸­æ±¡æŸ“å…¨å±€çš„åšæ³•éå¸¸ç³Ÿç³•ï¼Œè¿™å¯èƒ½å¯¼è‡´å’Œå…¶ä»–åº“å†²çªï¼Œè€Œè°ƒç”¨ä½ çš„ API çš„ç”¨æˆ·åœ¨å®é™…ç¯å¢ƒä¸­å¾—åˆ°ä¸€ä¸ª exception å‰å¯¹è¿™ä¸€æƒ…å†µæ˜¯ä¸€æ— æ‰€çŸ¥çš„ã€‚</p>
<p>è€ƒè™‘è¿™æ ·ä¸€ä¸ªä¾‹å­ï¼šå¦‚æœæƒ³è¦æ‰©å±• JavaScript çš„ <code>Array</code>ï¼Œä½¿å…¶æ‹¥æœ‰ä¸€ä¸ªå¯ä»¥æ˜¾ç¤ºä¸¤ä¸ªæ•°ç»„ä¹‹é—´å·®å¼‚çš„ <code>diff</code>æ–¹æ³•ï¼Œè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿå¯ä»¥å°†æ–°å‡½æ•°å†™å…¥<code>Array.prototype</code> ï¼Œä½†å®ƒå¯èƒ½ä¸å¦ä¸€ä¸ªå°è¯•åšåŒæ ·äº‹æƒ…çš„åº“å†²çªã€‚å¦‚æœå¦ä¸€ä¸ªåº“åªæ˜¯ä½¿ç”¨<code>diff</code>æ¥æŸ¥æ‰¾æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ å’Œæœ€åä¸€ä¸ªå…ƒç´ ä¹‹é—´çš„åŒºåˆ«å‘¢ï¼Ÿ</p>
<p>æ›´å¥½çš„åšæ³•æ˜¯æ‰©å±•<code>Array</code>ï¼Œå®ç°å¯¹åº”çš„å‡½æ•°åŠŸèƒ½ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="built_in">global</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">interface</span> Array&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    diff(other: T[]): <span class="built_in">Array</span>&lt;T&gt;;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">Array</span>.prototype.diff)&#123;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">Array</span>.prototype.diff = <span class="function"><span class="keyword">function</span> &lt;<span class="title">T</span>&gt;(<span class="params">other: T[]</span>): <span class="title">T</span>[] </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> hash = <span class="keyword">new</span> <span class="built_in">Set</span>(other);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.filter(<span class="function"><span class="params">elem</span> =&gt;</span> !hash.has(elem));</span><br><span class="line"></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyArray</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">Array</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  diff(other: T[]): T[] &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> hash = <span class="keyword">new</span> <span class="built_in">Set</span>(other);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.filter(<span class="function"><span class="params">elem</span> =&gt;</span> !hash.has(elem));</span><br><span class="line"></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="å‡½æ•°å¼ç¼–ç¨‹ä¼˜äºå‘½ä»¤å¼ç¼–ç¨‹"><a href="#å‡½æ•°å¼ç¼–ç¨‹ä¼˜äºå‘½ä»¤å¼ç¼–ç¨‹" class="headerlink" title="å‡½æ•°å¼ç¼–ç¨‹ä¼˜äºå‘½ä»¤å¼ç¼–ç¨‹"></a><a href="#%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E4%BC%98%E4%BA%8E%E5%91%BD%E4%BB%A4%E5%BC%8F%E7%BC%96%E7%A8%8B"></a>å‡½æ•°å¼ç¼–ç¨‹ä¼˜äºå‘½ä»¤å¼ç¼–ç¨‹</h3><p>å°½é‡ä½¿ç”¨å‡½æ•°å¼ç¼–ç¨‹ï¼</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> contributions = [</span><br><span class="line"></span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Uncle Bobby&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="attr">linesOfCode</span>: <span class="number">500</span></span><br><span class="line"></span><br><span class="line">  &#125;, &#123;</span><br><span class="line"></span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Suzie Q&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="attr">linesOfCode</span>: <span class="number">1500</span></span><br><span class="line"></span><br><span class="line">  &#125;, &#123;</span><br><span class="line"></span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Jimmy Gosling&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="attr">linesOfCode</span>: <span class="number">150</span></span><br><span class="line"></span><br><span class="line">  &#125;, &#123;</span><br><span class="line"></span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Gracie Hopper&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="attr">linesOfCode</span>: <span class="number">1000</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> totalOutput = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; contributions.length; i++) &#123;</span><br><span class="line"></span><br><span class="line">  totalOutput += contributions[i].linesOfCode;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> contributions = [</span><br><span class="line"></span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Uncle Bobby&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="attr">linesOfCode</span>: <span class="number">500</span></span><br><span class="line"></span><br><span class="line">  &#125;, &#123;</span><br><span class="line"></span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Suzie Q&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="attr">linesOfCode</span>: <span class="number">1500</span></span><br><span class="line"></span><br><span class="line">  &#125;, &#123;</span><br><span class="line"></span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Jimmy Gosling&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="attr">linesOfCode</span>: <span class="number">150</span></span><br><span class="line"></span><br><span class="line">  &#125;, &#123;</span><br><span class="line"></span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Gracie Hopper&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="attr">linesOfCode</span>: <span class="number">1000</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> totalOutput = contributions</span><br><span class="line"></span><br><span class="line">  .reduce(<span class="function">(<span class="params">totalLines, output</span>) =&gt;</span> totalLines + output.linesOfCode, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="å°è£…åˆ¤æ–­æ¡ä»¶"><a href="#å°è£…åˆ¤æ–­æ¡ä»¶" class="headerlink" title="å°è£…åˆ¤æ–­æ¡ä»¶"></a><a href="#%E5%B0%81%E8%A3%85%E5%88%A4%E6%96%AD%E6%9D%A1%E4%BB%B6"></a>å°è£…åˆ¤æ–­æ¡ä»¶</h3><p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (subscription.isTrial || account.balance &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">canActivateService</span>(<span class="params">subscription: Subscription, account: Account</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> subscription.isTrial || account.balance &gt; <span class="number">0</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (canActivateService(subscription, account)) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="é¿å…â€œå¦å®šâ€çš„åˆ¤æ–­"><a href="#é¿å…â€œå¦å®šâ€çš„åˆ¤æ–­" class="headerlink" title="é¿å…â€œå¦å®šâ€çš„åˆ¤æ–­"></a><a href="#%E9%81%BF%E5%85%8D%E5%90%A6%E5%AE%9A%E7%9A%84%E5%88%A4%E6%96%AD"></a>é¿å…â€œå¦å®šâ€çš„åˆ¤æ–­</h3><p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isEmailNotUsed</span>(<span class="params">email: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (isEmailNotUsed(email)) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isEmailUsed</span>(<span class="params">email</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!isEmailUsed(node)) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="é¿å…åˆ¤æ–­æ¡ä»¶"><a href="#é¿å…åˆ¤æ–­æ¡ä»¶" class="headerlink" title="é¿å…åˆ¤æ–­æ¡ä»¶"></a><a href="#%E9%81%BF%E5%85%8D%E5%88%A4%E6%96%AD%E6%9D%A1%E4%BB%B6"></a>é¿å…åˆ¤æ–­æ¡ä»¶</h3><p>è¿™çœ‹èµ·æ¥ä¼¼ä¹ä¸å¤ªå¯èƒ½å®Œæˆå•Šã€‚å¤§å¤šæ•°äººå¬åˆ°åç¬¬ä¸€ååº”æ˜¯ï¼Œâ€œæ²¡æœ‰ifè¯­å¥æ€ä¹ˆå®ç°åŠŸèƒ½å‘¢ï¼Ÿâ€ åœ¨å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨å¤šæ€æ€§æ¥å®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚æ¥ä¸‹æ¥çš„é—®é¢˜æ˜¯ â€œä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Ÿâ€ åŸå› å°±æ˜¯ä¹‹å‰æåˆ°çš„ï¼šå‡½æ•°åªåšä¸€ä»¶äº‹ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Airplane</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">type</span>: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">getCruisingAltitude</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (<span class="built_in">this</span>.type) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;777&#x27;</span>:</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getMaxAltitude() - <span class="built_in">this</span>.getPassengerCount();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;Air Force One&#x27;</span>:</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getMaxAltitude();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;Cessna&#x27;</span>:</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getMaxAltitude() - <span class="built_in">this</span>.getFuelExpenditure();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line"></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;Unknown airplane type.&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Airplane</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Boeing777</span> <span class="keyword">extends</span> <span class="title">Airplane</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">getCruisingAltitude</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.getMaxAltitude() - <span class="built_in">this</span>.getPassengerCount();</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AirForceOne</span> <span class="keyword">extends</span> <span class="title">Airplane</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">getCruisingAltitude</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.getMaxAltitude();</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cessna</span> <span class="keyword">extends</span> <span class="title">Airplane</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">getCruisingAltitude</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.getMaxAltitude() - <span class="built_in">this</span>.getFuelExpenditure();</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="é¿å…ç±»å‹æ£€æŸ¥"><a href="#é¿å…ç±»å‹æ£€æŸ¥" class="headerlink" title="é¿å…ç±»å‹æ£€æŸ¥"></a><a href="#%E9%81%BF%E5%85%8D%E7%B1%BB%E5%9E%8B%E6%A3%80%E6%9F%A5"></a>é¿å…ç±»å‹æ£€æŸ¥</h3><p>TypeScript æ˜¯ JavaScript çš„ä¸€ä¸ªä¸¥æ ¼çš„è¯­æ³•è¶…é›†ï¼Œå…·æœ‰é™æ€ç±»å‹æ£€æŸ¥çš„ç‰¹æ€§ã€‚æ‰€ä»¥æŒ‡å®šå˜é‡ã€å‚æ•°å’Œè¿”å›å€¼çš„ç±»å‹ï¼Œä»¥å……åˆ†åˆ©ç”¨æ­¤ç‰¹æ€§ï¼Œèƒ½è®©é‡æ„æ›´å®¹æ˜“ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">travelToTexas</span>(<span class="params">vehicle: Bicycle | Car</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (vehicle <span class="keyword">instanceof</span> Bicycle) &#123;</span><br><span class="line"></span><br><span class="line">    vehicle.pedal(<span class="built_in">this</span>.currentLocation, <span class="keyword">new</span> Location(<span class="string">&#x27;texas&#x27;</span>));</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (vehicle <span class="keyword">instanceof</span> Car) &#123;</span><br><span class="line"></span><br><span class="line">    vehicle.drive(<span class="built_in">this</span>.currentLocation, <span class="keyword">new</span> Location(<span class="string">&#x27;texas&#x27;</span>));</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Vehicle = Bicycle | Car;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">travelToTexas</span>(<span class="params">vehicle: Vehicle</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  vehicle.move(<span class="built_in">this</span>.currentLocation, <span class="keyword">new</span> Location(<span class="string">&#x27;texas&#x27;</span>));</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="ä¸è¦è¿‡åº¦ä¼˜åŒ–"><a href="#ä¸è¦è¿‡åº¦ä¼˜åŒ–" class="headerlink" title="ä¸è¦è¿‡åº¦ä¼˜åŒ–"></a><a href="#%E4%B8%8D%E8%A6%81%E8%BF%87%E5%BA%A6%E4%BC%98%E5%8C%96"></a>ä¸è¦è¿‡åº¦ä¼˜åŒ–</h3><p>ç°ä»£æµè§ˆå™¨åœ¨è¿è¡Œæ—¶è¿›è¡Œå¤§é‡çš„åº•å±‚ä¼˜åŒ–ã€‚å¾ˆå¤šæ—¶å€™ï¼Œä½ åšä¼˜åŒ–åªæ˜¯åœ¨æµªè´¹æ—¶é—´ã€‚æœ‰äº›ä¼˜ç§€<a target="_blank" rel="noopener" href="https://github.com/petkaantonov/bluebird/wiki/Optimization-killers">èµ„æº</a>å¯ä»¥å¸®åŠ©å®šä½å“ªé‡Œéœ€è¦ä¼˜åŒ–ï¼Œæ‰¾åˆ°å¹¶ä¿®å¤å®ƒã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// On old browsers, each iteration with uncached `list.length` would be costly</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// because of `list.length` recomputation. In modern browsers, this is optimized.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = list.length; i &lt; len; i++) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; list.length; i++) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="åˆ é™¤æ— ç”¨ä»£ç "><a href="#åˆ é™¤æ— ç”¨ä»£ç " class="headerlink" title="åˆ é™¤æ— ç”¨ä»£ç "></a><a href="#%E5%88%A0%E9%99%A4%E6%97%A0%E7%94%A8%E4%BB%A3%E7%A0%81"></a>åˆ é™¤æ— ç”¨ä»£ç </h3><p>æ— ç”¨ä»£ç å’Œé‡å¤ä»£ç ä¸€æ ·æ— éœ€ä¿ç•™ã€‚å¦‚æœæ²¡æœ‰åœ°æ–¹è°ƒç”¨å®ƒï¼Œè¯·åˆ é™¤ï¼å¦‚æœä»ç„¶éœ€è¦å®ƒï¼Œå¯ä»¥æŸ¥çœ‹ç‰ˆæœ¬å†å²ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">oldRequestModule</span>(<span class="params">url: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">requestModule</span>(<span class="params">url: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> req = requestModule;</span><br><span class="line"></span><br><span class="line">inventoryTracker(<span class="string">&#x27;apples&#x27;</span>, req, <span class="string">&#x27;www.inventory-awesome.io&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">requestModule</span>(<span class="params">url: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> req = requestModule;</span><br><span class="line"></span><br><span class="line">inventoryTracker(<span class="string">&#x27;apples&#x27;</span>, req, <span class="string">&#x27;www.inventory-awesome.io&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="ä½¿ç”¨è¿­ä»£å™¨å’Œç”Ÿæˆå™¨"><a href="#ä½¿ç”¨è¿­ä»£å™¨å’Œç”Ÿæˆå™¨" class="headerlink" title="ä½¿ç”¨è¿­ä»£å™¨å’Œç”Ÿæˆå™¨"></a><a href="#%E4%BD%BF%E7%94%A8%E8%BF%AD%E4%BB%A3%E5%99%A8%E5%92%8C%E7%94%9F%E6%88%90%E5%99%A8"></a>ä½¿ç”¨è¿­ä»£å™¨å’Œç”Ÿæˆå™¨</h3><p>åƒä½¿ç”¨æµä¸€æ ·å¤„ç†æ•°æ®é›†åˆæ—¶ï¼Œè¯·ä½¿ç”¨ç”Ÿæˆå™¨å’Œè¿­ä»£å™¨ã€‚</p>
<p>ç†ç”±å¦‚ä¸‹:</p>
<ul>
<li>  å°†è°ƒç”¨è€…ä¸ç”Ÿæˆå™¨å®ç°è§£è€¦ï¼Œåœ¨æŸç§æ„ä¹‰ä¸Šï¼Œè°ƒç”¨è€…å†³å®šè¦è®¿é—®å¤šå°‘é¡¹ã€‚</li>
<li>  å»¶è¿Ÿæ‰§è¡Œï¼ŒæŒ‰éœ€ä½¿ç”¨ã€‚</li>
<li>  å†…ç½®æ”¯æŒä½¿ç”¨<code>for-of</code>è¯­æ³•è¿›è¡Œè¿­ä»£</li>
<li>  å…è®¸å®ç°ä¼˜åŒ–çš„è¿­ä»£å™¨æ¨¡å¼</li>
</ul>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fibonacci</span>(<span class="params">n: <span class="built_in">number</span></span>): <span class="title">number</span>[] </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (n === <span class="number">1</span>) <span class="keyword">return</span> [<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">if</span> (n === <span class="number">2</span>) <span class="keyword">return</span> [<span class="number">0</span>, <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> items: <span class="built_in">number</span>[] = [<span class="number">0</span>, <span class="number">1</span>];</span><br><span class="line">  <span class="keyword">while</span> (items.length &lt; n) &#123;</span><br><span class="line">    items.push(items[items.length - <span class="number">2</span>] + items[items.length - <span class="number">1</span>]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> items;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">print</span>(<span class="params">n: <span class="built_in">number</span></span>) </span>&#123;</span><br><span class="line">  fibonacci(n).forEach(<span class="function"><span class="params">fib</span> =&gt;</span> <span class="built_in">console</span>.log(fib));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Print first 10 Fibonacci numbers.</span></span><br><span class="line">print(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Generates an infinite stream of Fibonacci numbers.</span></span><br><span class="line"><span class="comment">// The generator doesn&#x27;t keep the array of all numbers.</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">fibonacci</span>(<span class="params"></span>): <span class="title">IterableIterator</span>&lt;<span class="title">number</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> [a, b] = [<span class="number">0</span>, <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">yield</span> a;</span><br><span class="line">    [a, b] = [b, a + b];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">print</span>(<span class="params">n: <span class="built_in">number</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> fib <span class="keyword">in</span> fibonacci()) &#123;</span><br><span class="line">    <span class="keyword">if</span> (i++ === n) <span class="keyword">break</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(fib);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Print first 10 Fibonacci numbers.</span></span><br><span class="line">print(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<p>æœ‰äº›åº“é€šè¿‡é“¾æ¥â€œmapâ€ã€â€œsliceâ€ã€â€œforEachâ€ç­‰æ–¹æ³•ï¼Œè¾¾åˆ°ä¸åŸç”Ÿæ•°ç»„ç±»ä¼¼çš„æ–¹å¼å¤„ç†è¿­ä»£ã€‚å‚è§ <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/itiriri">itiriri</a> é‡Œé¢æœ‰ä¸€äº›ä½¿ç”¨è¿­ä»£å™¨çš„é«˜çº§æ“ä½œç¤ºä¾‹ï¼ˆæˆ–å¼‚æ­¥è¿­ä»£çš„æ“ä½œ <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/itiriri-async">itiriri-async</a>ï¼‰ã€‚</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itiriri <span class="keyword">from</span> <span class="string">&#x27;itiriri&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">fibonacci</span>(<span class="params"></span>): <span class="title">IterableIterator</span>&lt;<span class="title">number</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> [a, b] = [<span class="number">0</span>, <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">yield</span> a;</span><br><span class="line">    [a, b] = [b, a + b];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">itiriri(fibonacci())</span><br><span class="line">  .take(<span class="number">10</span>)</span><br><span class="line">  .forEach(<span class="function"><span class="params">fib</span> =&gt;</span> <span class="built_in">console</span>.log(fib));</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h2 id="å¯¹è±¡å’Œæ•°æ®ç»“æ„"><a href="#å¯¹è±¡å’Œæ•°æ®ç»“æ„" class="headerlink" title="å¯¹è±¡å’Œæ•°æ®ç»“æ„"></a><a href="#%E5%AF%B9%E8%B1%A1%E5%92%8C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"></a>å¯¹è±¡å’Œæ•°æ®ç»“æ„</h2><h3 id="ä½¿ç”¨getterså’Œsetters"><a href="#ä½¿ç”¨getterså’Œsetters" class="headerlink" title="ä½¿ç”¨getterså’Œsetters"></a><a href="#%E4%BD%BF%E7%94%A8getters%E5%92%8Csetters"></a>ä½¿ç”¨<code>getters</code>å’Œ<code>setters</code></h3><p>TypeScript æ”¯æŒ getter/setter è¯­æ³•ã€‚ä½¿ç”¨ getter å’Œ setter ä»å¯¹è±¡ä¸­è®¿é—®æ•°æ®æ¯”ç®€å•åœ°åœ¨å¯¹è±¡ä¸ŠæŸ¥æ‰¾å±æ€§è¦å¥½ã€‚åŸå› å¦‚ä¸‹:</p>
<ul>
<li>  å½“éœ€è¦åœ¨è·å–å¯¹è±¡å±æ€§ä¹‹å‰åšä¸€äº›äº‹æƒ…æ—¶ï¼Œä¸å¿…åœ¨ä»£ç ä¸­æŸ¥æ‰¾å¹¶ä¿®æ”¹æ¯ä¸ªè®¿é—®å™¨ã€‚</li>
<li>  æ‰§è¡Œ<code>set</code>æ—¶æ·»åŠ éªŒè¯æ›´ç®€å•ã€‚</li>
<li>  å°è£…å†…éƒ¨è¡¨ç¤ºã€‚</li>
<li>  æ›´å®¹æ˜“æ·»åŠ æ—¥å¿—å’Œé”™è¯¯å¤„ç†ã€‚</li>
<li>  å¯ä»¥å»¶è¿ŸåŠ è½½å¯¹è±¡çš„å±æ€§ï¼Œæ¯”å¦‚ä»æœåŠ¡å™¨è·å–å®ƒã€‚</li>
</ul>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BankAccount</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">balance</span>: <span class="built_in">number</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> value = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> account = <span class="keyword">new</span> BankAccount();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (value &lt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;Cannot set negative balance.&#x27;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">account.balance = value;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BankAccount</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> accountBalance: <span class="built_in">number</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> <span class="title">balance</span>(): <span class="title">number</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.accountBalance;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">set</span> <span class="title">balance</span>(<span class="params">value: <span class="built_in">number</span></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (value &lt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;Cannot set negative balance.&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.accountBalance = value;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> account = <span class="keyword">new</span> BankAccount();</span><br><span class="line"></span><br><span class="line">account.balance = <span class="number">100</span>;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="è®©å¯¹è±¡æ‹¥æœ‰-private-protected-æˆå‘˜"><a href="#è®©å¯¹è±¡æ‹¥æœ‰-private-protected-æˆå‘˜" class="headerlink" title="è®©å¯¹è±¡æ‹¥æœ‰ private/protected æˆå‘˜"></a><a href="#%E8%AE%A9%E5%AF%B9%E8%B1%A1%E6%8B%A5%E6%9C%89-privateprotected-%E6%88%90%E5%91%98"></a>è®©å¯¹è±¡æ‹¥æœ‰ private/protected æˆå‘˜</h3><p>TypeScript ç±»æˆå‘˜æ”¯æŒ <code>public</code>*(é»˜è®¤)*ã€<code>protected</code> ä»¥åŠ <code>private</code>çš„è®¿é—®é™åˆ¶ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">radius</span>: <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">radius: <span class="built_in">number</span></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.radius = radius;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">perimeter</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span> * <span class="built_in">Math</span>.PI * <span class="built_in">this</span>.radius;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">surface</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.PI * <span class="built_in">this</span>.radius * <span class="built_in">this</span>.radius;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">private</span> <span class="keyword">readonly</span> radius: <span class="built_in">number</span></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">perimeter</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span> * <span class="built_in">Math</span>.PI * <span class="built_in">this</span>.radius;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">surface</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.PI * <span class="built_in">this</span>.radius * <span class="built_in">this</span>.radius;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="ä¸å˜æ€§"><a href="#ä¸å˜æ€§" class="headerlink" title="ä¸å˜æ€§"></a><a href="#%E4%B8%8D%E5%8F%98%E6%80%A7"></a>ä¸å˜æ€§</h3><p>TypeScript ç±»å‹ç³»ç»Ÿå…è®¸å°†æ¥å£ã€ç±»ä¸Šçš„å•ä¸ªå±æ€§è®¾ç½®ä¸ºåªè¯»ï¼Œèƒ½ä»¥å‡½æ•°çš„æ–¹å¼è¿è¡Œã€‚</p>
<p>è¿˜æœ‰ä¸ªé«˜çº§åœºæ™¯ï¼Œå¯ä»¥ä½¿ç”¨å†…ç½®ç±»å‹<code>Readonly</code>ï¼Œå®ƒæ¥å—ç±»å‹ T å¹¶ä½¿ç”¨<a target="_blank" rel="noopener" href="https://www.typescriptlang.org/docs/handbook/advanced-types.html#mapped-types">æ˜ å°„ç±»å‹</a>å°†å…¶æ‰€æœ‰å±æ€§æ ‡è®°ä¸ºåªè¯»ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Config &#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">host</span>: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  port: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  db: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Config &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">readonly</span> host: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">readonly</span> port: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">readonly</span> db: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="ç±»å‹-vs-æ¥å£"><a href="#ç±»å‹-vs-æ¥å£" class="headerlink" title="ç±»å‹ vs æ¥å£"></a><a href="#%E7%B1%BB%E5%9E%8B-vs-%E6%8E%A5%E5%8F%A3"></a>ç±»å‹ vs æ¥å£</h3><p>å½“å¯èƒ½éœ€è¦è”åˆæˆ–äº¤é›†æ—¶ï¼Œè¯·ä½¿ç”¨ç±»å‹ã€‚å¦‚æœéœ€è¦<code>æ‰©å±•</code>æˆ–<code>å®ç°</code>ï¼Œè¯·ä½¿ç”¨æ¥å£ã€‚ç„¶è€Œï¼Œæ²¡æœ‰ä¸¥æ ¼çš„è§„åˆ™ï¼Œåªæœ‰é€‚åˆçš„è§„åˆ™ã€‚</p>
<p>è¯¦ç»†è§£é‡Šå‚è€ƒå…³äº Typescript ä¸­<code>type</code>å’Œ<code>interface</code>åŒºåˆ«çš„<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/37233735/typescript-interfaces-vs-types/54101543#54101543">è§£ç­”</a> ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> EmailConfig &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> DbConfig &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Config &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Shape &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> EmailConfig &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> DbConfig &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Config  = EmailConfig | DbConfig;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Shape &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span> <span class="title">implements</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="title">implements</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h2 id="ç±»"><a href="#ç±»" class="headerlink" title="ç±»"></a><a href="#%E7%B1%BB"></a>ç±»</h2><h3 id="å°ã€å°ã€å°ï¼è¦äº‹æƒ…è¯´ä¸‰é"><a href="#å°ã€å°ã€å°ï¼è¦äº‹æƒ…è¯´ä¸‰é" class="headerlink" title="å°ã€å°ã€å°ï¼è¦äº‹æƒ…è¯´ä¸‰é"></a><a href="#%E5%B0%8F%E5%B0%8F%E5%B0%8F%E8%A6%81%E4%BA%8B%E6%83%85%E8%AF%B4%E4%B8%89%E9%81%8D"></a>å°ã€å°ã€å°ï¼è¦äº‹æƒ…è¯´ä¸‰é</h3><p>ç±»çš„å¤§å°æ˜¯ç”±å®ƒçš„èŒè´£æ¥åº¦é‡çš„ã€‚æŒ‰ç…§<em>å•ä¸€èŒè´£åŸåˆ™</em>ï¼Œç±»è¦å°ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dashboard</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  getLanguage(): <span class="built_in">string</span> &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line"></span><br><span class="line">  setLanguage(language: <span class="built_in">string</span>): <span class="built_in">void</span> &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line"></span><br><span class="line">  showProgress(): <span class="built_in">void</span> &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line"></span><br><span class="line">  hideProgress(): <span class="built_in">void</span> &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line"></span><br><span class="line">  isDirty(): <span class="built_in">boolean</span> &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line"></span><br><span class="line">  disable(): <span class="built_in">void</span> &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line"></span><br><span class="line">  enable(): <span class="built_in">void</span> &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line"></span><br><span class="line">  addSubscription(subscription: Subscription): <span class="built_in">void</span> &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line"></span><br><span class="line">  removeSubscription(subscription: Subscription): <span class="built_in">void</span> &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line"></span><br><span class="line">  addUser(user: User): <span class="built_in">void</span> &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line"></span><br><span class="line">  removeUser(user: User): <span class="built_in">void</span> &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line"></span><br><span class="line">  goToHomePage(): <span class="built_in">void</span> &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line"></span><br><span class="line">  updateProfile(details: UserDetails): <span class="built_in">void</span> &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line"></span><br><span class="line">  getVersion(): <span class="built_in">string</span> &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dashboard</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  disable(): <span class="built_in">void</span> &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line"></span><br><span class="line">  enable(): <span class="built_in">void</span> &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line"></span><br><span class="line">  getVersion(): <span class="built_in">string</span> &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// split the responsibilities by moving the remaining methods to other classes</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="é«˜å†…èšä½è€¦åˆ"><a href="#é«˜å†…èšä½è€¦åˆ" class="headerlink" title="é«˜å†…èšä½è€¦åˆ"></a><a href="#%E9%AB%98%E5%86%85%E8%81%9A%E4%BD%8E%E8%80%A6%E5%90%88"></a>é«˜å†…èšä½è€¦åˆ</h3><p>å†…èšï¼šå®šä¹‰äº†ç±»æˆå‘˜ä¹‹é—´ç›¸äº’å…³è”çš„ç¨‹åº¦ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œé«˜å†…èšç±»çš„æ¯ä¸ªæ–¹æ³•éƒ½åº”è¯¥ä½¿ç”¨ç±»ä¸­çš„æ‰€æœ‰å­—æ®µï¼Œå®é™…ä¸Šè¿™ä¸å¯èƒ½ä¹Ÿä¸å¯å–ã€‚ä½†æˆ‘ä»¬ä¾ç„¶æå€¡é«˜å†…èšã€‚</p>
<p>è€¦åˆï¼šæŒ‡çš„æ˜¯ä¸¤ä¸ªç±»ä¹‹é—´çš„å…³è”ç¨‹åº¦ã€‚å¦‚æœå…¶ä¸­ä¸€ä¸ªç±»çš„æ›´æ”¹ä¸å½±å“å¦ä¸€ä¸ªç±»ï¼Œåˆ™ç§°ä¸ºä½è€¦åˆç±»ã€‚</p>
<p>å¥½çš„è½¯ä»¶è®¾è®¡å…·æœ‰<strong>é«˜å†…èšæ€§</strong>å’Œ<strong>ä½è€¦åˆæ€§</strong>ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserManager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Bad: each private variable is used by one or another group of methods.</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// It makes clear evidence that the class is holding more than a single responsibility.</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// If I need only to create the service to get the transactions for a user,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// I&#x27;m still forced to pass and instance of emailSender.</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">private</span> <span class="keyword">readonly</span> db: Database,</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">private</span> <span class="keyword">readonly</span> emailSender: EmailSender</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> getUser(id: <span class="built_in">number</span>): <span class="built_in">Promise</span>&lt;User&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> db.users.findOne(&#123; id &#125;)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> getTransactions(userId: <span class="built_in">number</span>): <span class="built_in">Promise</span>&lt;Transaction[]&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> db.transactions.find(&#123; userId &#125;)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> sendGreeting(): <span class="built_in">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> emailSender.send(<span class="string">&#x27;Welcome!&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> sendNotification(text: <span class="built_in">string</span>): <span class="built_in">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> emailSender.send(text);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> sendNewsletter(): <span class="built_in">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">private</span> <span class="keyword">readonly</span> db: Database</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> getUser(id: <span class="built_in">number</span>): <span class="built_in">Promise</span>&lt;User&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> db.users.findOne(&#123; id &#125;)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> getTransactions(userId: <span class="built_in">number</span>): <span class="built_in">Promise</span>&lt;Transaction[]&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> db.transactions.find(&#123; userId &#125;)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserNotifier</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">private</span> <span class="keyword">readonly</span> emailSender: EmailSender</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> sendGreeting(): <span class="built_in">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> emailSender.send(<span class="string">&#x27;Welcome!&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> sendNotification(text: <span class="built_in">string</span>): <span class="built_in">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> emailSender.send(text);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> sendNewsletter(): <span class="built_in">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="ç»„åˆå¤§äºç»§æ‰¿"><a href="#ç»„åˆå¤§äºç»§æ‰¿" class="headerlink" title="ç»„åˆå¤§äºç»§æ‰¿"></a><a href="#%E7%BB%84%E5%90%88%E5%A4%A7%E4%BA%8E%E7%BB%A7%E6%89%BF"></a>ç»„åˆå¤§äºç»§æ‰¿</h3><p>æ­£å¦‚â€œå››äººå¸®â€åœ¨<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Design_Patterns">è®¾è®¡æ¨¡å¼</a>ä¸­æ‰€æŒ‡å‡ºçš„é‚£æ ·ï¼Œæ‚¨å°½å¯èƒ½ä½¿ç”¨ç»„åˆè€Œä¸æ˜¯ç»§æ‰¿ã€‚ç»„åˆå’Œç»§æ‰¿å„æœ‰ä¼˜åŠ£ã€‚è¿™ä¸ªå‡†åˆ™çš„ä¸»è¦è§‚ç‚¹æ˜¯ï¼Œå¦‚æœä½ æ½œæ„è¯†åœ°å€¾å‘äºç»§æ‰¿ï¼Œè¯•ç€æƒ³æƒ³ç»„åˆæ˜¯å¦èƒ½æ›´å¥½åœ°ç»™ä½ çš„é—®é¢˜å»ºæ¨¡ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥ã€‚</p>
<p>ä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨ç»§æ‰¿ï¼Ÿè¿™å–å†³äºä½ é¢ä¸´çš„é—®é¢˜ã€‚ä»¥ä¸‹åœºæ™¯ä½¿ç”¨ç»§æ‰¿æ›´å¥½:</p>
<ol>
<li> ç»§æ‰¿ä»£è¡¨çš„æ˜¯â€œis-aâ€å…³ç³»ï¼Œè€Œä¸æ˜¯â€œhas-aâ€å…³ç³» (äºº -&gt; åŠ¨ç‰© vs. ç”¨æˆ· -&gt; ç”¨æˆ·è¯¦æƒ…)ã€‚</li>
<li> å¯å¤ç”¨åŸºç±»çš„ä»£ç  (äººç±»å¯ä»¥åƒæ‰€æœ‰åŠ¨ç‰©ä¸€æ ·ç§»åŠ¨)ã€‚</li>
<li> å¸Œæœ›é€šè¿‡æ›´æ”¹åŸºç±»å¯¹æ´¾ç”Ÿç±»è¿›è¡Œå…¨å±€æ›´æ”¹(æ”¹å˜æ‰€æœ‰åŠ¨ç‰©åœ¨è¿åŠ¨æ—¶çš„çƒ­é‡æ¶ˆè€—)ã€‚</li>
</ol>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">private</span> <span class="keyword">readonly</span> name: <span class="built_in">string</span>,</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">private</span> <span class="keyword">readonly</span> email:<span class="built_in">string</span></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Bad because Employees &quot;have&quot; tax data. EmployeeTaxData is not a type of Employee</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EmployeeTaxData</span> <span class="keyword">extends</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">    name: <span class="built_in">string</span>,</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">    email:<span class="built_in">string</span>,</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">private</span> <span class="keyword">readonly</span> ssn: <span class="built_in">string</span>,</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">private</span> <span class="keyword">readonly</span> salary: <span class="built_in">number</span></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">super</span>(name, email);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> taxData: EmployeeTaxData;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">private</span> <span class="keyword">readonly</span> name: <span class="built_in">string</span>,</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">private</span> <span class="keyword">readonly</span> email:<span class="built_in">string</span></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  setTaxData(ssn: <span class="built_in">string</span>, <span class="attr">salary</span>: <span class="built_in">number</span>): Employee &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.taxData = <span class="keyword">new</span> EmployeeTaxData(ssn, salary);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EmployeeTaxData</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">public</span> <span class="keyword">readonly</span> ssn: <span class="built_in">string</span>,</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">public</span> <span class="keyword">readonly</span> salary: <span class="built_in">number</span></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="ä½¿ç”¨æ–¹æ³•é“¾"><a href="#ä½¿ç”¨æ–¹æ³•é“¾" class="headerlink" title="ä½¿ç”¨æ–¹æ³•é“¾"></a><a href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%E9%93%BE"></a>ä½¿ç”¨æ–¹æ³•é“¾</h3><p>éå¸¸æœ‰ç”¨çš„æ¨¡å¼ï¼Œåœ¨è®¸å¤šåº“ä¸­éƒ½å¯ä»¥çœ‹åˆ°ã€‚å®ƒè®©ä»£ç è¡¨è¾¾åŠ›æ›´å¥½ï¼Œä¹Ÿæ›´ç®€æ´ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QueryBuilder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> collection: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> pageNumber: <span class="built_in">number</span> = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> itemsPerPage: <span class="built_in">number</span> = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> orderByFields: <span class="built_in">string</span>[] = [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">from</span>(collection: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.collection = collection;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  page(<span class="built_in">number</span>: <span class="built_in">number</span>, <span class="attr">itemsPerPage</span>: <span class="built_in">number</span> = <span class="number">100</span>): <span class="built_in">void</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.pageNumber = <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.itemsPerPage = itemsPerPage;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  orderBy(...fields: <span class="built_in">string</span>[]): <span class="built_in">void</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.orderByFields = fields;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  build(): Query &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> query = <span class="keyword">new</span> QueryBuilder();</span><br><span class="line"></span><br><span class="line">query.from(<span class="string">&#x27;users&#x27;</span>);</span><br><span class="line"></span><br><span class="line">query.page(<span class="number">1</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">query.orderBy(<span class="string">&#x27;firstName&#x27;</span>, <span class="string">&#x27;lastName&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> query = queryBuilder.build();</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QueryBuilder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> collection: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> pageNumber: <span class="built_in">number</span> = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> itemsPerPage: <span class="built_in">number</span> = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> orderByFields: <span class="built_in">string</span>[] = [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">from</span>(collection: <span class="built_in">string</span>): <span class="built_in">this</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.collection = collection;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  page(<span class="built_in">number</span>: <span class="built_in">number</span>, <span class="attr">itemsPerPage</span>: <span class="built_in">number</span> = <span class="number">100</span>): <span class="built_in">this</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.pageNumber = <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.itemsPerPage = itemsPerPage;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  orderBy(...fields: <span class="built_in">string</span>[]): <span class="built_in">this</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.orderByFields = fields;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  build(): Query &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> query = <span class="keyword">new</span> QueryBuilder()</span><br><span class="line"></span><br><span class="line">  .from(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  .page(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">  .orderBy(<span class="string">&#x27;firstName&#x27;</span>, <span class="string">&#x27;lastName&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  .build();</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h2 id="SOLIDåŸåˆ™"><a href="#SOLIDåŸåˆ™" class="headerlink" title="SOLIDåŸåˆ™"></a><a href="#solid%E5%8E%9F%E5%88%99"></a>SOLIDåŸåˆ™</h2><h3 id="å•ä¸€èŒè´£åŸåˆ™-SRP"><a href="#å•ä¸€èŒè´£åŸåˆ™-SRP" class="headerlink" title="å•ä¸€èŒè´£åŸåˆ™ (SRP)"></a><a href="#%E5%8D%95%E4%B8%80%E8%81%8C%E8%B4%A3%E5%8E%9F%E5%88%99-srp"></a>å•ä¸€èŒè´£åŸåˆ™ (SRP)</h3><p>æ­£å¦‚ Clean Code ä¸­æ‰€è¿°ï¼Œâ€œç±»æ›´æ”¹çš„åŸå› ä¸åº”è¯¥è¶…è¿‡ä¸€ä¸ªâ€ã€‚å°†å¾ˆå¤šåŠŸèƒ½æ‰“åŒ…åœ¨ä¸€ä¸ªç±»çœ‹èµ·æ¥å¾ˆè¯±äººï¼Œå°±åƒåœ¨èˆªç­ä¸Šæ‚¨åªèƒ½å¸¦ä¸€ä¸ªæ‰‹æç®±ã€‚è¿™æ ·å¸¦æ¥çš„é—®é¢˜æ˜¯ï¼Œåœ¨æ¦‚å¿µä¸Šç±»ä¸å…·æœ‰å†…èšæ€§ï¼Œä¸”æœ‰å¾ˆå¤šåŸå› å»ä¿®æ”¹ç±»ã€‚è€Œæˆ‘ä»¬åº”è¯¥å°½é‡å‡å°‘ä¿®æ”¹ç±»çš„æ¬¡æ•°ã€‚å¦‚æœä¸€ä¸ªç±»åŠŸèƒ½å¤ªå¤šï¼Œä¿®æ”¹äº†å…¶ä¸­ä¸€å¤„å¾ˆéš¾ç¡®å®šå¯¹ä»£ç åº“ä¸­å…¶ä»–ä¾èµ–æ¨¡å—çš„å½±å“ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserSettings</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">private</span> <span class="keyword">readonly</span> user: User</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">changeSettings</span>(<span class="params">settings: UserSettings</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.verifyCredentials()) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">verifyCredentials</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserAuth</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">private</span> <span class="keyword">readonly</span> user: User</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">verifyCredentials</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserSettings</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">readonly</span> auth: UserAuth;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">private</span> <span class="keyword">readonly</span> user: User</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.auth = <span class="keyword">new</span> UserAuth(user);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">changeSettings</span>(<span class="params">settings: UserSettings</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.auth.verifyCredentials()) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="å¼€é—­åŸåˆ™-OCP"><a href="#å¼€é—­åŸåˆ™-OCP" class="headerlink" title="å¼€é—­åŸåˆ™ (OCP)"></a><a href="#%E5%BC%80%E9%97%AD%E5%8E%9F%E5%88%99-ocp"></a>å¼€é—­åŸåˆ™ (OCP)</h3><p>æ­£å¦‚ Bertrand Meyer æ‰€è¯´ï¼Œâ€œè½¯ä»¶å®ä½“(ç±»ã€æ¨¡å—ã€å‡½æ•°ç­‰)åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­ã€‚â€ æ¢å¥è¯è¯´ï¼Œå°±æ˜¯å…è®¸åœ¨ä¸æ›´æ”¹ç°æœ‰ä»£ç çš„æƒ…å†µä¸‹æ·»åŠ æ–°åŠŸèƒ½ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AjaxAdapter</span> <span class="keyword">extends</span> <span class="title">Adapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NodeAdapter</span> <span class="keyword">extends</span> <span class="title">Adapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HttpRequester</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">private</span> <span class="keyword">readonly</span> adapter: Adapter</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> fetch&lt;T&gt;(url: <span class="built_in">string</span>): <span class="built_in">Promise</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.adapter <span class="keyword">instanceof</span> AjaxAdapter) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> makeAjaxCall&lt;T&gt;(url);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// transform response and return</span></span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.adapter <span class="keyword">instanceof</span> NodeAdapter) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> makeHttpCall&lt;T&gt;(url);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// transform response and return</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeAjaxCall</span>&lt;<span class="title">T</span>&gt;(<span class="params">url: <span class="built_in">string</span></span>): <span class="title">Promise</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// request and return promise</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeHttpCall</span>&lt;<span class="title">T</span>&gt;(<span class="params">url: <span class="built_in">string</span></span>): <span class="title">Promise</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// request and return promise</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">abstract</span> <span class="keyword">async</span> request&lt;T&gt;(url: <span class="built_in">string</span>): <span class="built_in">Promise</span>&lt;T&gt;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AjaxAdapter</span> <span class="keyword">extends</span> <span class="title">Adapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> request&lt;T&gt;(url: <span class="built_in">string</span>): <span class="built_in">Promise</span>&lt;T&gt;&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// request and return promise</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NodeAdapter</span> <span class="keyword">extends</span> <span class="title">Adapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> request&lt;T&gt;(url: <span class="built_in">string</span>): <span class="built_in">Promise</span>&lt;T&gt;&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// request and return promise</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HttpRequester</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">private</span> <span class="keyword">readonly</span> adapter: Adapter</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> fetch&lt;T&gt;(url: <span class="built_in">string</span>): <span class="built_in">Promise</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="built_in">this</span>.adapter.request&lt;T&gt;(url);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// transform response and return</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="é‡Œæ°æ›¿æ¢åŸåˆ™-LSP"><a href="#é‡Œæ°æ›¿æ¢åŸåˆ™-LSP" class="headerlink" title="é‡Œæ°æ›¿æ¢åŸåˆ™ (LSP)"></a><a href="#%E9%87%8C%E6%B0%8F%E6%9B%BF%E6%8D%A2%E5%8E%9F%E5%88%99-lsp"></a>é‡Œæ°æ›¿æ¢åŸåˆ™ (LSP)</h3><p>å¯¹ä¸€ä¸ªéå¸¸ç®€å•çš„æ¦‚å¿µæ¥è¯´ï¼Œè¿™æ˜¯ä¸ªå¯æ€•çš„æœ¯è¯­ã€‚</p>
<p>å®ƒçš„æ­£å¼å®šä¹‰æ˜¯ï¼šâ€œå¦‚æœ S æ˜¯ T çš„ä¸€ä¸ªå­ç±»å‹ï¼Œé‚£ä¹ˆç±»å‹ T çš„å¯¹è±¡å¯ä»¥è¢«æ›¿æ¢ä¸ºç±»å‹ S çš„å¯¹è±¡ï¼Œè€Œä¸ä¼šæ”¹å˜ç¨‹åºä»»ä½•æœŸæœ›çš„å±æ€§(æ­£ç¡®æ€§ã€æ‰§è¡Œçš„ä»»åŠ¡ç­‰)â€œã€‚è¿™æ˜¯ä¸€ä¸ªæ›´å¯æ€•çš„å®šä¹‰ã€‚</p>
<p>æ›´å¥½çš„è§£é‡Šæ˜¯ï¼Œå¦‚æœæ‚¨æœ‰ä¸€ä¸ªçˆ¶ç±»å’Œä¸€ä¸ªå­ç±»ï¼Œé‚£ä¹ˆçˆ¶ç±»å’Œå­ç±»å¯ä»¥äº’æ¢ä½¿ç”¨ï¼Œè€Œä¸ä¼šå‡ºç°é—®é¢˜ã€‚è¿™å¯èƒ½ä»ç„¶ä»¤äººå›°æƒ‘ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬çœ‹ä¸€çœ‹ç»å…¸çš„æ­£æ–¹å½¢çŸ©å½¢çš„ä¾‹å­ã€‚ä»æ•°å­¦ä¸Šè®²ï¼Œæ­£æ–¹å½¢æ˜¯çŸ©å½¢ï¼Œä½†æ˜¯å¦‚æœæ‚¨é€šè¿‡ç»§æ‰¿ä½¿ç”¨ â€œis-aâ€ å…³ç³»å¯¹å…¶å»ºæ¨¡ï¼Œæ‚¨å¾ˆå¿«å°±ä¼šé‡åˆ°éº»çƒ¦ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">protected</span> width: <span class="built_in">number</span> = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">protected</span> height: <span class="built_in">number</span> = <span class="number">0</span></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">setColor</span>(<span class="params">color: <span class="built_in">string</span></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params">area: <span class="built_in">number</span></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">setWidth</span>(<span class="params">width: <span class="built_in">number</span></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.width = width;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">setHeight</span>(<span class="params">height: <span class="built_in">number</span></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.height = height;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getArea(): <span class="built_in">number</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.width * <span class="built_in">this</span>.height;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">Rectangle</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">setWidth</span>(<span class="params">width: <span class="built_in">number</span></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.width = width;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.height = width;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">setHeight</span>(<span class="params">height: <span class="built_in">number</span></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.width = height;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.height = height;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">renderLargeRectangles</span>(<span class="params">rectangles: Rectangle[]</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  rectangles.forEach(<span class="function">(<span class="params">rectangle</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    rectangle.setWidth(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">    rectangle.setHeight(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> area = rectangle.getArea(); <span class="comment">// BAD: Returns 25 for Square. Should be 20.</span></span><br><span class="line"></span><br><span class="line">    rectangle.render(area);</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rectangles = [<span class="keyword">new</span> Rectangle(), <span class="keyword">new</span> Rectangle(), <span class="keyword">new</span> Square()];</span><br><span class="line"></span><br><span class="line">renderLargeRectangles(rectangles);</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">setColor</span>(<span class="params">color: <span class="built_in">string</span></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params">area: <span class="built_in">number</span></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">abstract</span> getArea(): <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">private</span> <span class="keyword">readonly</span> width = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">private</span> <span class="keyword">readonly</span> height = <span class="number">0</span></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getArea(): <span class="built_in">number</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.width * <span class="built_in">this</span>.height;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">private</span> <span class="keyword">readonly</span> length: <span class="built_in">number</span></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getArea(): <span class="built_in">number</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.length * <span class="built_in">this</span>.length;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">renderLargeShapes</span>(<span class="params">shapes: Shape[]</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  shapes.forEach(<span class="function">(<span class="params">shape</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> area = shape.getArea();</span><br><span class="line"></span><br><span class="line">    shape.render(area);</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> shapes = [<span class="keyword">new</span> Rectangle(<span class="number">4</span>, <span class="number">5</span>), <span class="keyword">new</span> Rectangle(<span class="number">4</span>, <span class="number">5</span>), <span class="keyword">new</span> Square(<span class="number">5</span>)];</span><br><span class="line"></span><br><span class="line">renderLargeShapes(shapes);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="æ¥å£éš”ç¦»åŸåˆ™-ISP"><a href="#æ¥å£éš”ç¦»åŸåˆ™-ISP" class="headerlink" title="æ¥å£éš”ç¦»åŸåˆ™ (ISP)"></a><a href="#%E6%8E%A5%E5%8F%A3%E9%9A%94%E7%A6%BB%E5%8E%9F%E5%88%99-isp"></a>æ¥å£éš”ç¦»åŸåˆ™ (ISP)</h3><p>â€œå®¢æˆ·ä¸åº”è¯¥è¢«è¿«ä¾èµ–äºä»–ä»¬ä¸ä½¿ç”¨çš„æ¥å£ã€‚â€ è¿™ä¸€åŸåˆ™ä¸å•ä¸€è´£ä»»åŸåˆ™å¯†åˆ‡ç›¸å…³ã€‚è¿™æ„å‘³ç€ä¸åº”è¯¥è®¾è®¡ä¸€ä¸ªå¤§è€Œå…¨çš„æŠ½è±¡ï¼Œå¦åˆ™ä¼šå¢åŠ å®¢æˆ·çš„è´Ÿæ‹…ï¼Œå› ä¸ºä»–ä»¬éœ€è¦å®ç°ä¸€äº›ä¸éœ€è¦çš„æ–¹æ³•ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> ISmartPrinter &#123;</span><br><span class="line"></span><br><span class="line">  print();</span><br><span class="line"></span><br><span class="line">  fax();</span><br><span class="line"></span><br><span class="line">  scan();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AllInOnePrinter</span> <span class="title">implements</span> <span class="title">ISmartPrinter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">print</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">fax</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">scan</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EconomicPrinter</span> <span class="title">implements</span> <span class="title">ISmartPrinter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">print</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">fax</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;Fax not supported.&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">scan</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;Scan not supported.&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> IPrinter &#123;</span><br><span class="line"></span><br><span class="line">  print();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> IFax &#123;</span><br><span class="line"></span><br><span class="line">  fax();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> IScanner &#123;</span><br><span class="line"></span><br><span class="line">  scan();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AllInOnePrinter</span> <span class="title">implements</span> <span class="title">IPrinter</span>, <span class="title">IFax</span>, <span class="title">IScanner</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">print</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">fax</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">scan</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EconomicPrinter</span> <span class="title">implements</span> <span class="title">IPrinter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">print</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="ä¾èµ–åè½¬åŸåˆ™-Dependency-Inversion-Principle"><a href="#ä¾èµ–åè½¬åŸåˆ™-Dependency-Inversion-Principle" class="headerlink" title="ä¾èµ–åè½¬åŸåˆ™(Dependency Inversion Principle)"></a><a href="#%E4%BE%9D%E8%B5%96%E5%8F%8D%E8%BD%AC%E5%8E%9F%E5%88%99dependency-inversion-principle"></a>ä¾èµ–åè½¬åŸåˆ™(Dependency Inversion Principle)</h3><p>è¿™ä¸ªåŸåˆ™æœ‰ä¸¤ä¸ªè¦ç‚¹:</p>
<ol>
<li> é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–äºä½å±‚æ¨¡å—ï¼Œä¸¤è€…éƒ½åº”è¯¥ä¾èµ–äºæŠ½è±¡ã€‚</li>
<li> æŠ½è±¡ä¸ä¾èµ–å®ç°ï¼Œå®ç°åº”ä¾èµ–æŠ½è±¡ã€‚</li>
</ol>
<p>ä¸€å¼€å§‹è¿™éš¾ä»¥ç†è§£ï¼Œä½†æ˜¯å¦‚æœä½ ä½¿ç”¨è¿‡ Angularï¼Œä½ å°±ä¼šçœ‹åˆ°ä»¥ä¾èµ–æ³¨å…¥(DI)çš„æ–¹å¼å®ç°äº†è¿™ä¸€åŸåˆ™ã€‚è™½ç„¶æ¦‚å¿µä¸åŒï¼Œä½†æ˜¯ DIP é˜»æ­¢é«˜çº§æ¨¡å—äº†è§£å…¶ä½çº§æ¨¡å—çš„ç»†èŠ‚å¹¶è¿›è¡Œè®¾ç½®ã€‚å®ƒå¯ä»¥é€šè¿‡ DI å®ç°è¿™ä¸€ç‚¹ã€‚è¿™æ ·åšçš„ä¸€ä¸ªå·¨å¤§å¥½å¤„æ˜¯å‡å°‘äº†æ¨¡å—ä¹‹é—´çš„è€¦åˆã€‚è€¦åˆéå¸¸ç³Ÿç³•ï¼Œå®ƒè®©ä»£ç éš¾ä»¥é‡æ„ã€‚</p>
<p>DIP é€šå¸¸æ˜¯é€šè¿‡ä½¿ç”¨æ§åˆ¶åè½¬(IoC)å®¹å™¨æ¥å®ç°çš„ã€‚æ¯”å¦‚ï¼šTypeScript çš„ IoC å®¹å™¨ <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/inversify">InversifyJs</a></p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; readFile <span class="keyword">as</span> readFileCb &#125; <span class="keyword">from</span> <span class="string">&#x27;fs&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; promisify &#125; <span class="keyword">from</span> <span class="string">&#x27;util&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> readFile = promisify(readFileCb);</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ReportData = &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ..</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XmlFormatter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  parse&lt;T&gt;(content: <span class="built_in">string</span>): T &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Converts an XML string to an object T</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReportReader</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// BAD: We have created a dependency on a specific request implementation.</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// We should just have ReportReader depend on a parse method: `parse`</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">readonly</span> formatter = <span class="keyword">new</span> XmlFormatter();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> read(path: <span class="built_in">string</span>): <span class="built_in">Promise</span>&lt;ReportData&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> text = <span class="keyword">await</span> readFile(path, <span class="string">&#x27;UTF8&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.formatter.parse&lt;ReportData&gt;(text);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reader = <span class="keyword">new</span> ReportReader();</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> report = <span class="keyword">await</span> reader.read(<span class="string">&#x27;report.xml&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; readFile <span class="keyword">as</span> readFileCb &#125; <span class="keyword">from</span> <span class="string">&#x27;fs&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; promisify &#125; <span class="keyword">from</span> <span class="string">&#x27;util&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> readFile = promisify(readFileCb);</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ReportData = &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ..</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Formatter &#123;</span><br><span class="line"></span><br><span class="line">  parse&lt;T&gt;(content: <span class="built_in">string</span>): T;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XmlFormatter</span> <span class="title">implements</span> <span class="title">Formatter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  parse&lt;T&gt;(content: <span class="built_in">string</span>): T &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Converts an XML string to an object T</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JsonFormatter</span> <span class="title">implements</span> <span class="title">Formatter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  parse&lt;T&gt;(content: <span class="built_in">string</span>): T &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Converts a JSON string to an object T</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReportReader</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">private</span> <span class="keyword">readonly</span> formatter: Formatter</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> read(path: <span class="built_in">string</span>): <span class="built_in">Promise</span>&lt;ReportData&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> text = <span class="keyword">await</span> readFile(path, <span class="string">&#x27;UTF8&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.formatter.parse&lt;ReportData&gt;(text);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reader = <span class="keyword">new</span> ReportReader(<span class="keyword">new</span> XmlFormatter());</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> report = <span class="keyword">await</span> reader.read(<span class="string">&#x27;report.xml&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// or if we had to read a json report:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reader = <span class="keyword">new</span> ReportReader(<span class="keyword">new</span> JsonFormatter());</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> report = <span class="keyword">await</span> reader.read(<span class="string">&#x27;report.json&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a><a href="#%E6%B5%8B%E8%AF%95"></a>æµ‹è¯•</h2><p>æµ‹è¯•æ¯”å‘è´§æ›´é‡è¦ã€‚å¦‚æœæ²¡æœ‰æµ‹è¯•æˆ–æ•°é‡ä¸è¶³ï¼Œé‚£ä¹ˆæ¯æ¬¡å‘å¸ƒä»£ç æ—¶éƒ½æ— æ³•ç¡®ä¿ä¸å¼•å…¥é—®é¢˜ã€‚æ€æ ·æ‰ç®—æ˜¯è¶³å¤Ÿçš„æµ‹è¯•ï¼Ÿè¿™å–å†³äºå›¢é˜Ÿï¼Œä½†æ˜¯æ‹¥æœ‰100%çš„è¦†ç›–ç‡(æ‰€æœ‰è¯­å¥å’Œåˆ†æ”¯)ä¼šè®©å›¢é˜Ÿæ›´æœ‰ä¿¡å¿ƒã€‚è¿™ä¸€åˆ‡éƒ½è¦åŸºäºå¥½çš„æµ‹è¯•æ¡†æ¶ä»¥åŠ<a target="_blank" rel="noopener" href="https://github.com/gotwarlost/istanbul">è¦†ç›–ç‡å·¥å…·</a>ã€‚</p>
<p>æ²¡æœ‰ä»»ä½•ç†ç”±ä¸ç¼–å†™æµ‹è¯•ã€‚æœ‰<a target="_blank" rel="noopener" href="http://jstherightway.org/#testing-tools">å¾ˆå¤šä¼˜ç§€çš„ JS æµ‹è¯•æ¡†æ¶</a>éƒ½æ”¯æŒ TypeScriptï¼Œæ‰¾ä¸ªå›¢é˜Ÿå–œæ¬¢çš„ã€‚ç„¶åä¸ºæ¯ä¸ªæ–°ç‰¹æ€§/æ¨¡å—ç¼–å†™æµ‹è¯•ã€‚å¦‚æœæ‚¨å–œæ¬¢æµ‹è¯•é©±åŠ¨å¼€å‘(TDD)ï¼Œé‚£å°±å¤ªå¥½äº†ï¼Œé‡ç‚¹æ˜¯ç¡®ä¿åœ¨å¼€å‘ä»»ä½•ç‰¹æ€§æˆ–é‡æ„ç°æœ‰ç‰¹æ€§ä¹‹å‰ï¼Œä»£ç è¦†ç›–ç‡å·²ç»è¾¾åˆ°è¦æ±‚ã€‚</p>
<h3 id="TDDï¼ˆæµ‹è¯•é©±åŠ¨å¼€å‘ï¼‰ä¸‰å®šå¾‹"><a href="#TDDï¼ˆæµ‹è¯•é©±åŠ¨å¼€å‘ï¼‰ä¸‰å®šå¾‹" class="headerlink" title="TDDï¼ˆæµ‹è¯•é©±åŠ¨å¼€å‘ï¼‰ä¸‰å®šå¾‹"></a><a href="#tdd%E6%B5%8B%E8%AF%95%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E4%B8%89%E5%AE%9A%E5%BE%8B"></a>TDDï¼ˆæµ‹è¯•é©±åŠ¨å¼€å‘ï¼‰ä¸‰å®šå¾‹</h3><ol>
<li> åœ¨ç¼–å†™ä¸èƒ½é€šè¿‡çš„å•å…ƒæµ‹è¯•å‰ï¼Œä¸å¯ç¼–å†™ç”Ÿäº§ä»£ç ã€‚</li>
<li> åªå¯ç¼–å†™åˆšå¥½æ— æ³•é€šè¿‡çš„å•å…ƒæµ‹è¯•ï¼Œä¸èƒ½ç¼–è¯‘ä¹Ÿç®—ä¸è¿‡ã€‚</li>
<li> åªå¯ç¼–å†™åˆšå¥½è¶³ä»¥é€šè¿‡å½“å‰å¤±è´¥æµ‹è¯•çš„ç”Ÿäº§ä»£ç ã€‚</li>
</ol>
<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="F-I-R-S-T-å‡†åˆ™"><a href="#F-I-R-S-T-å‡†åˆ™" class="headerlink" title="F.I.R.S.T.å‡†åˆ™"></a><a href="#first%E5%87%86%E5%88%99"></a>F.I.R.S.T.å‡†åˆ™</h3><p>æ•´æ´çš„æµ‹è¯•åº”éµå¾ªä»¥ä¸‹å‡†åˆ™:</p>
<ul>
<li>  <strong>å¿«é€Ÿ</strong>ï¼ˆFastï¼‰ï¼Œæµ‹è¯•åº”è¯¥å¿«ï¼ˆåŠæ—¶åé¦ˆå‡ºä¸šåŠ¡ä»£ç çš„é—®é¢˜ï¼‰ã€‚</li>
<li>  <strong>ç‹¬ç«‹</strong>ï¼ˆIndependentï¼‰ï¼Œæ¯ä¸ªæµ‹è¯•æµç¨‹åº”è¯¥ç‹¬ç«‹ã€‚</li>
<li>  <strong>å¯é‡å¤</strong>ï¼ˆRepeatableï¼‰ï¼Œæµ‹è¯•åº”è¯¥åœ¨ä»»ä½•ç¯å¢ƒä¸Šéƒ½èƒ½é‡å¤é€šè¿‡ã€‚</li>
<li>  <strong>è‡ªæˆ‘éªŒè¯</strong>ï¼ˆSelf-Validatingï¼‰ï¼Œæµ‹è¯•ç»“æœåº”è¯¥æ˜ç¡®<em>é€šè¿‡</em>æˆ–è€…<em>å¤±è´¥</em>ã€‚</li>
<li>  <strong>åŠæ—¶</strong>ï¼ˆTimelyï¼‰ï¼Œæµ‹è¯•ä»£ç åº”è¯¥åœ¨äº§å“ä»£ç ä¹‹å‰ç¼–å†™ã€‚</li>
</ul>
<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="å•ä¸€çš„æµ‹è¯•æ¯ä¸ªæ¦‚å¿µ"><a href="#å•ä¸€çš„æµ‹è¯•æ¯ä¸ªæ¦‚å¿µ" class="headerlink" title="å•ä¸€çš„æµ‹è¯•æ¯ä¸ªæ¦‚å¿µ"></a><a href="#%E5%8D%95%E4%B8%80%E7%9A%84%E6%B5%8B%E8%AF%95%E6%AF%8F%E4%B8%AA%E6%A6%82%E5%BF%B5"></a>å•ä¸€çš„æµ‹è¯•æ¯ä¸ªæ¦‚å¿µ</h3><p>æµ‹è¯•ä¹Ÿåº”è¯¥éµå¾ª<em>å•ä¸€èŒè´£åŸåˆ™</em>ï¼Œæ¯ä¸ªå•å…ƒæµ‹è¯•åªåšä¸€ä¸ªæ–­è¨€ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; assert &#125; <span class="keyword">from</span> <span class="string">&#x27;chai&#x27;</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">&#x27;AwesomeDate&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">  it(<span class="string">&#x27;handles date boundaries&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> date: AwesomeDate;</span><br><span class="line"></span><br><span class="line">    date = <span class="keyword">new</span> AwesomeDate(<span class="string">&#x27;1/1/2015&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    date.addDays(<span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">    assert.equal(<span class="string">&#x27;1/31/2015&#x27;</span>, date);</span><br><span class="line"></span><br><span class="line">    date = <span class="keyword">new</span> AwesomeDate(<span class="string">&#x27;2/1/2016&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    date.addDays(<span class="number">28</span>);</span><br><span class="line"></span><br><span class="line">    assert.equal(<span class="string">&#x27;02/29/2016&#x27;</span>, date);</span><br><span class="line"></span><br><span class="line">    date = <span class="keyword">new</span> AwesomeDate(<span class="string">&#x27;2/1/2015&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    date.addDays(<span class="number">28</span>);</span><br><span class="line"></span><br><span class="line">    assert.equal(<span class="string">&#x27;03/01/2015&#x27;</span>, date);</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; assert &#125; <span class="keyword">from</span> <span class="string">&#x27;chai&#x27;</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">&#x27;AwesomeDate&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">  it(<span class="string">&#x27;handles 30-day months&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> date = <span class="keyword">new</span> AwesomeDate(<span class="string">&#x27;1/1/2015&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    date.addDays(<span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">    assert.equal(<span class="string">&#x27;1/31/2015&#x27;</span>, date);</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(<span class="string">&#x27;handles leap year&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> date = <span class="keyword">new</span> AwesomeDate(<span class="string">&#x27;2/1/2016&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    date.addDays(<span class="number">28</span>);</span><br><span class="line"></span><br><span class="line">    assert.equal(<span class="string">&#x27;02/29/2016&#x27;</span>, date);</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(<span class="string">&#x27;handles non-leap year&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> date = <span class="keyword">new</span> AwesomeDate(<span class="string">&#x27;2/1/2015&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    date.addDays(<span class="number">28</span>);</span><br><span class="line"></span><br><span class="line">    assert.equal(<span class="string">&#x27;03/01/2015&#x27;</span>, date);</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="æµ‹è¯•ç”¨ä¾‹åç§°åº”è¯¥æ˜¾ç¤ºå®ƒçš„æ„å›¾"><a href="#æµ‹è¯•ç”¨ä¾‹åç§°åº”è¯¥æ˜¾ç¤ºå®ƒçš„æ„å›¾" class="headerlink" title="æµ‹è¯•ç”¨ä¾‹åç§°åº”è¯¥æ˜¾ç¤ºå®ƒçš„æ„å›¾"></a><a href="#%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B%E5%90%8D%E7%A7%B0%E5%BA%94%E8%AF%A5%E6%98%BE%E7%A4%BA%E5%AE%83%E7%9A%84%E6%84%8F%E5%9B%BE"></a>æµ‹è¯•ç”¨ä¾‹åç§°åº”è¯¥æ˜¾ç¤ºå®ƒçš„æ„å›¾</h3><p>å½“æµ‹è¯•å¤±è´¥æ—¶ï¼Œå‡ºé”™çš„ç¬¬ä¸€ä¸ªè¿¹è±¡å¯èƒ½å°±æ˜¯å®ƒçš„åå­—ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">&#x27;Calendar&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">  it(<span class="string">&#x27;2/29/2020&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(<span class="string">&#x27;throws&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">&#x27;Calendar&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">  it(<span class="string">&#x27;should handle leap year&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(<span class="string">&#x27;should throw when format is invalid&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h2 id="å¹¶å‘"><a href="#å¹¶å‘" class="headerlink" title="å¹¶å‘"></a><a href="#%E5%B9%B6%E5%8F%91"></a>å¹¶å‘</h2><h3 id="ç”¨-Promises-æ›¿ä»£å›è°ƒ"><a href="#ç”¨-Promises-æ›¿ä»£å›è°ƒ" class="headerlink" title="ç”¨ Promises æ›¿ä»£å›è°ƒ"></a><a href="#%E7%94%A8-promises-%E6%9B%BF%E4%BB%A3%E5%9B%9E%E8%B0%83"></a>ç”¨ Promises æ›¿ä»£å›è°ƒ</h3><p>å›è°ƒä¸å¤Ÿæ•´æ´è€Œä¸”ä¼šå¯¼è‡´è¿‡å¤šçš„åµŒå¥—*(å›è°ƒåœ°ç‹±)*ã€‚</p>
<p>æœ‰äº›å·¥å…·ä½¿ç”¨å›è°ƒçš„æ–¹å¼å°†ç°æœ‰å‡½æ•°è½¬æ¢ä¸º promise å¯¹è±¡ï¼š</p>
<ul>
<li>  Node.js å‚è§<a target="_blank" rel="noopener" href="https://nodejs.org/dist/latest-v8.x/docs/api/util.html#util_util_promisify_original"><code>util.promisify</code></a></li>
<li>  é€šç”¨å‚è§ <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/pify">pify</a>, <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/es6-promisify">es6-promisify</a></li>
</ul>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; get &#125; <span class="keyword">from</span> <span class="string">&#x27;request&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; writeFile &#125; <span class="keyword">from</span> <span class="string">&#x27;fs&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">downloadPage</span>(<span class="params">url: <span class="built_in">string</span>, saveTo: <span class="built_in">string</span>, callback: (error: <span class="built_in">Error</span>, content?: <span class="built_in">string</span>) =&gt; <span class="built_in">void</span></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">  get(url, <span class="function">(<span class="params">error, response</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line"></span><br><span class="line">      callback(error);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">      writeFile(saveTo, response.body, <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (error) &#123;</span><br><span class="line"></span><br><span class="line">          callback(error);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">          callback(<span class="literal">null</span>, response.body);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">downloadPage(<span class="string">&#x27;https://en.wikipedia.org/wiki/Robert_Cecil_Martin&#x27;</span>, <span class="string">&#x27;article.html&#x27;</span>, <span class="function">(<span class="params">error, content</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (error) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.error(error);</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(content);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; get &#125; <span class="keyword">from</span> <span class="string">&#x27;request&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; writeFile &#125; <span class="keyword">from</span> <span class="string">&#x27;fs&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; promisify &#125; <span class="keyword">from</span> <span class="string">&#x27;util&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> write = promisify(writeFile);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">downloadPage</span>(<span class="params">url: <span class="built_in">string</span>, saveTo: <span class="built_in">string</span></span>): <span class="title">Promise</span>&lt;<span class="title">string</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> get(url)</span><br><span class="line"></span><br><span class="line">    .then(<span class="function"><span class="params">response</span> =&gt;</span> write(saveTo, response))</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">downloadPage(<span class="string">&#x27;https://en.wikipedia.org/wiki/Robert_Cecil_Martin&#x27;</span>, <span class="string">&#x27;article.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  .then(<span class="function"><span class="params">content</span> =&gt;</span> <span class="built_in">console</span>.log(content))</span><br><span class="line"></span><br><span class="line">  .catch(<span class="function"><span class="params">error</span> =&gt;</span> <span class="built_in">console</span>.error(error));</span><br></pre></td></tr></table></figure>

<p>Promise æä¾›äº†ä¸€äº›è¾…åŠ©æ–¹æ³•ï¼Œèƒ½è®©ä»£ç æ›´ç®€æ´ï¼š</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td><code>Promise.resolve(value)</code></td>
<td>è¿”å›ä¸€ä¸ªä¼ å…¥å€¼è§£æåçš„ promise ã€‚</td>
</tr>
<tr>
<td><code>Promise.reject(error)</code></td>
<td>è¿”å›ä¸€ä¸ªå¸¦æœ‰æ‹’ç»åŸå› çš„ promise ã€‚</td>
</tr>
<tr>
<td><code>Promise.all(promises)</code></td>
<td>è¿”å›ä¸€ä¸ªæ–°çš„ promiseï¼Œä¼ å…¥æ•°ç»„ä¸­çš„<strong>æ¯ä¸ª</strong> promise éƒ½æ‰§è¡Œå®Œæˆåè¿”å›çš„ promise æ‰ç®—å®Œæˆï¼Œæˆ–ç¬¬ä¸€ä¸ª promise æ‹’ç»è€Œæ‹’ç»ã€‚</td>
</tr>
<tr>
<td><code>Promise.race(promises)</code></td>
<td>è¿”å›ä¸€ä¸ªæ–°çš„ promiseï¼Œä¼ å…¥æ•°ç»„ä¸­çš„<strong>æŸä¸ª</strong> promise è§£å†³æˆ–æ‹’ç»ï¼Œè¿”å›çš„ promise å°±ä¼šè§£å†³æˆ–æ‹’ç»ã€‚</td>
</tr>
</tbody></table>
<p><code>Promise.all</code>åœ¨å¹¶è¡Œè¿è¡Œä»»åŠ¡æ—¶å°¤å…¶æœ‰ç”¨ï¼Œ<code>Promise.race</code>è®©ä¸º Promise æ›´å®¹æ˜“å®ç°è¶…æ—¶ã€‚</p>
<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="Async-Await-æ¯”-Promises-æ›´å¥½"><a href="#Async-Await-æ¯”-Promises-æ›´å¥½" class="headerlink" title="Async/Await æ¯” Promises æ›´å¥½"></a><a href="#asyncawait-%E6%AF%94-promises-%E6%9B%B4%E5%A5%BD"></a><code>Async/Await</code> æ¯” <code>Promises</code> æ›´å¥½</h3><p>ä½¿ç”¨<code>async</code>/<code>await</code>è¯­æ³•ï¼Œå¯ä»¥ç¼–å†™æ›´ç®€æ´ã€æ›´æ˜“ç†è§£çš„é“¾å¼ promise çš„ä»£ç ã€‚ä¸€ä¸ªå‡½æ•°ä½¿ç”¨<code>async</code>å…³é”®å­—ä½œä¸ºå‰ç¼€ï¼ŒJavaScript è¿è¡Œæ—¶ä¼šæš‚åœ<code>await</code>å…³é”®å­—ä¸Šçš„ä»£ç æ‰§è¡Œ(å½“ä½¿ç”¨ promise æ—¶)ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; get &#125; <span class="keyword">from</span> <span class="string">&#x27;request&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; writeFile &#125; <span class="keyword">from</span> <span class="string">&#x27;fs&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; promisify &#125; <span class="keyword">from</span> <span class="string">&#x27;util&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> write = util.promisify(writeFile);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">downloadPage</span>(<span class="params">url: <span class="built_in">string</span>, saveTo: <span class="built_in">string</span></span>): <span class="title">Promise</span>&lt;<span class="title">string</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> get(url).then(<span class="function"><span class="params">response</span> =&gt;</span> write(saveTo, response))</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">downloadPage(<span class="string">&#x27;https://en.wikipedia.org/wiki/Robert_Cecil_Martin&#x27;</span>, <span class="string">&#x27;article.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  .then(<span class="function"><span class="params">content</span> =&gt;</span> <span class="built_in">console</span>.log(content))</span><br><span class="line"></span><br><span class="line">  .catch(<span class="function"><span class="params">error</span> =&gt;</span> <span class="built_in">console</span>.error(error));</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; get &#125; <span class="keyword">from</span> <span class="string">&#x27;request&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; writeFile &#125; <span class="keyword">from</span> <span class="string">&#x27;fs&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; promisify &#125; <span class="keyword">from</span> <span class="string">&#x27;util&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> write = promisify(writeFile);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">downloadPage</span>(<span class="params">url: <span class="built_in">string</span>, saveTo: <span class="built_in">string</span></span>): <span class="title">Promise</span>&lt;<span class="title">string</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> response = <span class="keyword">await</span> get(url);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> write(saveTo, response);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> response;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// somewhere in an async function</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> content = <span class="keyword">await</span> downloadPage(<span class="string">&#x27;https://en.wikipedia.org/wiki/Robert_Cecil_Martin&#x27;</span>, <span class="string">&#x27;article.html&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(content);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.error(error);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h2 id="é”™è¯¯å¤„ç†"><a href="#é”™è¯¯å¤„ç†" class="headerlink" title="é”™è¯¯å¤„ç†"></a><a href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"></a>é”™è¯¯å¤„ç†</h2><p>æŠ›å‡ºé”™è¯¯æ˜¯ä»¶å¥½äº‹ï¼å®ƒè¡¨ç¤ºç€è¿è¡Œæ—¶å·²ç»æˆåŠŸè¯†åˆ«å‡ºç¨‹åºä¸­çš„é”™è¯¯ï¼Œé€šè¿‡åœæ­¢å½“å‰å †æ ˆä¸Šçš„å‡½æ•°æ‰§è¡Œï¼Œç»ˆæ­¢è¿›ç¨‹(åœ¨Node.js)ï¼Œä»¥åŠåœ¨æ§åˆ¶å°ä¸­æ‰“å°å †æ ˆä¿¡æ¯æ¥è®©ä½ çŸ¥æ™“ã€‚</p>
<h3 id="æŠ›å‡ºErroræˆ–-ä½¿ç”¨reject"><a href="#æŠ›å‡ºErroræˆ–-ä½¿ç”¨reject" class="headerlink" title="æŠ›å‡ºErroræˆ– ä½¿ç”¨reject"></a><a href="#%E6%8A%9B%E5%87%BAerror%E6%88%96-%E4%BD%BF%E7%94%A8reject"></a>æŠ›å‡º<code>Error</code>æˆ– ä½¿ç”¨<code>reject</code></h3><p>JavaScript å’Œ TypeScript å…è®¸ä½  <code>throw</code> ä»»ä½•å¯¹è±¡ã€‚Promise ä¹Ÿå¯ä»¥ç”¨ä»»ä½•ç†ç”±å¯¹è±¡æ‹’ç»ã€‚</p>
<p>å»ºè®®ä½¿ç”¨ <code>Error</code> ç±»å‹çš„ <code>throw</code> è¯­æ³•ã€‚å› ä¸ºä½ çš„é”™è¯¯å¯èƒ½åœ¨å†™æœ‰ <code>catch</code>è¯­æ³•çš„é«˜çº§ä»£ç ä¸­è¢«æ•è·ã€‚åœ¨é‚£é‡Œæ•è·å­—ç¬¦ä¸²æ¶ˆæ¯æ˜¾å¾—éå¸¸æ··ä¹±ï¼Œå¹¶ä¸”ä¼šä½¿<a target="_blank" rel="noopener" href="https://basarat.gitbooks.io/typescript/docs/types/exceptions.html#always-use-error">è°ƒè¯•æ›´åŠ ç—›è‹¦</a>ã€‚å‡ºäºåŒæ ·çš„åŸå› ï¼Œä¹Ÿåº”è¯¥åœ¨æ‹’ç» promise æ—¶ä½¿ç”¨ <code>Error</code> ç±»å‹ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">calculateTotal</span>(<span class="params">items: Item[]</span>): <span class="title">number</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">throw</span> <span class="string">&#x27;Not implemented.&#x27;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"></span>): <span class="title">Promise</span>&lt;<span class="title">Item</span>[]&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="string">&#x27;Not implemented.&#x27;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">calculateTotal</span>(<span class="params">items: Item[]</span>): <span class="title">number</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;Not implemented.&#x27;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"></span>): <span class="title">Promise</span>&lt;<span class="title">Item</span>[]&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;Not implemented.&#x27;</span>));</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// or equivalent to:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"></span>): <span class="title">Promise</span>&lt;<span class="title">Item</span>[]&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;Not implemented.&#x27;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ <code>Error</code> ç±»å‹çš„å¥½å¤„æ˜¯ <code>try/catch/finally</code> è¯­æ³•æ”¯æŒå®ƒï¼Œå¹¶ä¸”éšå¼åœ°æ‰€æœ‰é”™è¯¯éƒ½å…·æœ‰ <code>stack</code> å±æ€§ï¼Œè¯¥å±æ€§å¯¹äºè°ƒè¯•éå¸¸æœ‰ç”¨ã€‚</p>
<p>å¦å¤–ï¼Œå³ä½¿ä¸ç”¨ <code>throw</code> è¯­æ³•è€Œæ˜¯è¿”å›è‡ªå®šä¹‰é”™è¯¯å¯¹è±¡ï¼ŒTypeScriptåœ¨è¿™å—æ›´å®¹æ˜“ã€‚è€ƒè™‘ä¸‹é¢çš„ä¾‹å­:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Failable&lt;R, E&gt; = &#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">isError</span>: <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  error: E;</span><br><span class="line"></span><br><span class="line">&#125; | &#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">isError</span>: <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  value: R;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">calculateTotal</span>(<span class="params">items: Item[]</span>): <span class="title">Failable</span>&lt;<span class="title">number</span>, &#x27;<span class="title">empty</span>&#x27;&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (items.length === <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">isError</span>: <span class="literal">true</span>, <span class="attr">error</span>: <span class="string">&#x27;empty&#x27;</span> &#125;;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">isError</span>: <span class="literal">false</span>, <span class="attr">value</span>: <span class="number">42</span> &#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯¦ç»†è§£é‡Šè¯·å‚è€ƒ<a target="_blank" rel="noopener" href="https://medium.com/@dhruvrajvanshi/making-exceptions-type-safe-in-typescript-c4d200ee78e9">åŸæ–‡</a>ã€‚</p>
<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="åˆ«å¿˜äº†æ•è·é”™è¯¯"><a href="#åˆ«å¿˜äº†æ•è·é”™è¯¯" class="headerlink" title="åˆ«å¿˜äº†æ•è·é”™è¯¯"></a><a href="#%E5%88%AB%E5%BF%98%E4%BA%86%E6%8D%95%E8%8E%B7%E9%94%99%E8%AF%AF"></a>åˆ«å¿˜äº†æ•è·é”™è¯¯</h3><p>æ•è·é”™è¯¯è€Œä¸å¤„ç†å®é™…ä¸Šä¹Ÿæ˜¯æ²¡æœ‰ä¿®å¤é”™è¯¯ï¼Œå°†é”™è¯¯è®°å½•åˆ°æ§åˆ¶å°(console.logï¼‰ä¹Ÿå¥½ä¸åˆ°å“ªé‡Œå»ï¼Œå› ä¸ºå®ƒå¸¸å¸¸ä¸¢å¤±åœ¨æ§åˆ¶å°å¤§é‡çš„æ—¥å¿—ä¹‹ä¸­ã€‚å¦‚æœå°†ä»£ç å†™åœ¨<code>try/catch</code> ä¸­ï¼Œè¯´æ˜é‚£é‡Œå¯èƒ½ä¼šå‘ç”Ÿé”™è¯¯ï¼Œå› æ­¤åº”è¯¥è€ƒè™‘åœ¨é”™è¯¯å‘ç”Ÿæ—¶åšä¸€äº›å¤„ç†ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">  functionThatMightThrow();</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(error);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// or even worse</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">  functionThatMightThrow();</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ignore error</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; logger &#125; <span class="keyword">from</span> <span class="string">&#x27;./logging&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">  functionThatMightThrow();</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line"></span><br><span class="line">  logger.log(error);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="ä¸è¦å¿½ç•¥è¢«æ‹’ç»çš„-promises"><a href="#ä¸è¦å¿½ç•¥è¢«æ‹’ç»çš„-promises" class="headerlink" title="ä¸è¦å¿½ç•¥è¢«æ‹’ç»çš„ promises"></a><a href="#%E4%B8%8D%E8%A6%81%E5%BF%BD%E7%95%A5%E8%A2%AB%E6%8B%92%E7%BB%9D%E7%9A%84-promises"></a>ä¸è¦å¿½ç•¥è¢«æ‹’ç»çš„ promises</h3><p>ç†ç”±å’Œä¸èƒ½åœ¨<code>try/catch</code>ä¸­å¿½ç•¥<code>Error</code>ä¸€æ ·ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">getUser()</span><br><span class="line"></span><br><span class="line">  .then(<span class="function">(<span class="params">user: User</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> sendEmail(user.email, <span class="string">&#x27;Welcome!&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  .catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; logger &#125; <span class="keyword">from</span> <span class="string">&#x27;./logging&#x27;</span></span><br><span class="line"></span><br><span class="line">getUser()</span><br><span class="line"></span><br><span class="line">  .then(<span class="function">(<span class="params">user: User</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> sendEmail(user.email, <span class="string">&#x27;Welcome!&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  .catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    logger.log(error);</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// or using the async/await syntax:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> user = <span class="keyword">await</span> getUser();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> sendEmail(user.email, <span class="string">&#x27;Welcome!&#x27;</span>);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line"></span><br><span class="line">  logger.log(error);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h2 id="æ ¼å¼åŒ–"><a href="#æ ¼å¼åŒ–" class="headerlink" title="æ ¼å¼åŒ–"></a><a href="#%E6%A0%BC%E5%BC%8F%E5%8C%96"></a>æ ¼å¼åŒ–</h2><p>å°±åƒè¿™é‡Œçš„è®¸å¤šè§„åˆ™ä¸€æ ·ï¼Œæ²¡æœ‰ä»€ä¹ˆæ˜¯ç¡¬æ€§è§„å®šï¼Œæ ¼å¼åŒ–ä¹Ÿæ˜¯ã€‚é‡ç‚¹æ˜¯<strong>ä¸è¦äº‰è®º</strong>æ ¼å¼ï¼Œä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·å®ç°æ ¼å¼åŒ–ã€‚å¯¹äºå·¥ç¨‹å¸ˆæ¥è¯´ï¼Œäº‰è®ºæ ¼å¼å°±æ˜¯æµªè´¹æ—¶é—´å’Œé‡‘é’±ã€‚é€šç”¨çš„åŸåˆ™æ˜¯<em>ä¿æŒä¸€è‡´çš„æ ¼å¼è§„åˆ™</em>ã€‚</p>
<p>å¯¹äº TypeScript ï¼Œæœ‰ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·å«åš TSLintã€‚å®ƒæ˜¯ä¸€ä¸ªé™æ€åˆ†æå·¥å…·ï¼Œå¯ä»¥å¸®åŠ©æ‚¨æ˜¾è‘—æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚é¡¹ç›®ä¸­ä½¿ç”¨å¯ä»¥å‚è€ƒä»¥ä¸‹ TSLint é…ç½®:</p>
<ul>
<li><p>  <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/tslint-config-standard">TSLint Config Standard</a> - æ ‡å‡†æ ¼å¼è§„åˆ™</p>
</li>
<li><p>  <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/tslint-config-airbnb">TSLint Config Airbnb</a> - Airbnb æ ¼å¼è§„åˆ™</p>
</li>
<li><p>  <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/tslint-clean-code">TSLint Clean Code</a> - çµæ„Ÿæ¥è‡ªäº<a target="_blank" rel="noopener" href="https://www.amazon.ca/Clean-Code-Handbook-Software-Craftsmanship/dp/0132350882">Clean Code: A Handbook of Agile Software Craftsmanship</a> çš„ TSLint è§„åˆ™ã€‚</p>
</li>
<li><p>  <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/tslint-react">TSLint react</a> - React ç›¸å…³çš„Lintè§„åˆ™</p>
</li>
<li><p>  <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/tslint-config-prettier">TSLint + Prettier</a> - <a target="_blank" rel="noopener" href="https://github.com/prettier/prettier">Prettier</a> ä»£ç æ ¼å¼åŒ–ç›¸å…³çš„ lint è§„åˆ™</p>
</li>
<li><p>  <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/tslint-eslint-rules">ESLint rules for TSLint</a> - TypeScript çš„ ESLint</p>
</li>
<li><p>  <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/tslint-immutable">Immutable</a> - åœ¨ TypeScript ä¸­ç¦ç”¨ mutation çš„è§„åˆ™</p>
</li>
</ul>
<p>è¿˜å¯ä»¥å‚è€ƒ<a target="_blank" rel="noopener" href="https://basarat.gitbooks.io/typescript/docs/styleguide/styleguide.html">TypeScript é£æ ¼æŒ‡å—å’Œç¼–ç çº¦å®š</a>çš„æºä»£ç ã€‚</p>
<h3 id="å¤§å°å†™ä¸€è‡´"><a href="#å¤§å°å†™ä¸€è‡´" class="headerlink" title="å¤§å°å†™ä¸€è‡´"></a><a href="#%E5%A4%A7%E5%B0%8F%E5%86%99%E4%B8%80%E8%87%B4"></a>å¤§å°å†™ä¸€è‡´</h3><p>å¤§å†™å¯ä»¥å‘Šè¯‰ä½ å¾ˆå¤šå…³äºå˜é‡ã€å‡½æ•°ç­‰çš„ä¿¡æ¯ã€‚è¿™äº›éƒ½æ˜¯ä¸»è§‚è§„åˆ™ï¼Œç”±ä½ çš„å›¢é˜Ÿåšé€‰æ‹©ã€‚å…³é”®æ˜¯æ— è®ºæ€ä¹ˆé€‰ï¼Œéƒ½è¦<em>ä¸€è‡´</em>ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> DAYS_IN_WEEK = <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> daysInMonth = <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> songs = [<span class="string">&#x27;Back In Black&#x27;</span>, <span class="string">&#x27;Stairway to Heaven&#x27;</span>, <span class="string">&#x27;Hey Jude&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Artists = [<span class="string">&#x27;ACDC&#x27;</span>, <span class="string">&#x27;Led Zeppelin&#x27;</span>, <span class="string">&#x27;The Beatles&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">eraseDatabase</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">restore_database</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">animal</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Container</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> DAYS_IN_WEEK = <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> DAYS_IN_MONTH = <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> SONGS = [<span class="string">&#x27;Back In Black&#x27;</span>, <span class="string">&#x27;Stairway to Heaven&#x27;</span>, <span class="string">&#x27;Hey Jude&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ARTISTS = [<span class="string">&#x27;ACDC&#x27;</span>, <span class="string">&#x27;Led Zeppelin&#x27;</span>, <span class="string">&#x27;The Beatles&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">eraseDatabase</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">restoreDatabase</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Container</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>ç±»åã€æ¥å£åã€ç±»å‹åå’Œå‘½åç©ºé—´åæœ€å¥½ä½¿ç”¨â€œå¸•æ–¯å¡å‘½åâ€ã€‚</p>
<p>å˜é‡ã€å‡½æ•°å’Œç±»æˆå‘˜ä½¿ç”¨â€œé©¼å³°å¼å‘½åâ€ã€‚</p>
<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="è°ƒç”¨å‡½æ•°çš„å‡½æ•°å’Œè¢«è°ƒå‡½æ•°åº”é è¿‘æ”¾ç½®"><a href="#è°ƒç”¨å‡½æ•°çš„å‡½æ•°å’Œè¢«è°ƒå‡½æ•°åº”é è¿‘æ”¾ç½®" class="headerlink" title="è°ƒç”¨å‡½æ•°çš„å‡½æ•°å’Œè¢«è°ƒå‡½æ•°åº”é è¿‘æ”¾ç½®"></a><a href="#%E8%B0%83%E7%94%A8%E5%87%BD%E6%95%B0%E7%9A%84%E5%87%BD%E6%95%B0%E5%92%8C%E8%A2%AB%E8%B0%83%E5%87%BD%E6%95%B0%E5%BA%94%E9%9D%A0%E8%BF%91%E6%94%BE%E7%BD%AE"></a>è°ƒç”¨å‡½æ•°çš„å‡½æ•°å’Œè¢«è°ƒå‡½æ•°åº”é è¿‘æ”¾ç½®</h3><p>å½“å‡½æ•°é—´å­˜åœ¨ç›¸äº’è°ƒç”¨çš„æƒ…å†µæ—¶ï¼Œåº”å°†ä¸¤è€…é è¿‘æ”¾ç½®ã€‚æœ€å¥½æ˜¯åº”å°†è°ƒç”¨è€…å†™åœ¨è¢«è°ƒè€…çš„ä¸Šæ–¹ã€‚è¿™å°±åƒè¯»æŠ¥çº¸ä¸€æ ·ï¼Œæˆ‘ä»¬éƒ½æ˜¯ä»ä¸Šå¾€ä¸‹è¯»ï¼Œé‚£ä¹ˆè¯»ä»£ç ä¹Ÿæ˜¯ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PerformanceReview</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">private</span> <span class="keyword">readonly</span> employee: Employee</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="title">lookupPeers</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> db.lookup(<span class="built_in">this</span>.employee.id, <span class="string">&#x27;peers&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="title">lookupManager</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> db.lookup(<span class="built_in">this</span>.employee, <span class="string">&#x27;manager&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="title">getPeerReviews</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> peers = <span class="built_in">this</span>.lookupPeers();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">review</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.getPeerReviews();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.getManagerReview();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.getSelfReview();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="title">getManagerReview</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> manager = <span class="built_in">this</span>.lookupManager();</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="title">getSelfReview</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> review = <span class="keyword">new</span> PerformanceReview(employee);</span><br><span class="line"></span><br><span class="line">review.review();</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PerformanceReview</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">private</span> <span class="keyword">readonly</span> employee: Employee</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">review</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.getPeerReviews();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.getManagerReview();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.getSelfReview();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="title">getPeerReviews</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> peers = <span class="built_in">this</span>.lookupPeers();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="title">lookupPeers</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> db.lookup(<span class="built_in">this</span>.employee.id, <span class="string">&#x27;peers&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="title">getManagerReview</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> manager = <span class="built_in">this</span>.lookupManager();</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="title">lookupManager</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> db.lookup(<span class="built_in">this</span>.employee, <span class="string">&#x27;manager&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="title">getSelfReview</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> review = <span class="keyword">new</span> PerformanceReview(employee);</span><br><span class="line"></span><br><span class="line">review.review();</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="ç»„ç»‡å¯¼å…¥"><a href="#ç»„ç»‡å¯¼å…¥" class="headerlink" title="ç»„ç»‡å¯¼å…¥"></a><a href="#%E7%BB%84%E7%BB%87%E5%AF%BC%E5%85%A5"></a>ç»„ç»‡å¯¼å…¥</h3><p>ä½¿ç”¨æ•´æ´ä¸”æ˜“äºé˜…è¯»çš„<code>import</code>è¯­å¥ï¼Œæ‚¨å¯ä»¥å¿«é€ŸæŸ¥çœ‹å½“å‰ä»£ç çš„ä¾èµ–å…³ç³»ã€‚å¯¼å…¥è¯­å¥åº”éµå¾ªä»¥ä¸‹åšæ³•:</p>
<ul>
<li>  <code>Import</code>è¯­å¥åº”è¯¥æŒ‰å­—æ¯é¡ºåºæ’åˆ—å’Œåˆ†ç»„ã€‚</li>
<li>  åº”è¯¥åˆ é™¤æœªä½¿ç”¨çš„å¯¼å…¥è¯­å¥ã€‚</li>
<li>  å‘½åå¯¼å…¥å¿…é¡»æŒ‰å­—æ¯é¡ºåº(ä¾‹å¦‚ï¼š<code>import &#123;A, B, C&#125; from &#39;foo&#39;;</code>)ã€‚</li>
<li>  å¯¼å…¥æºå¿…é¡»åœ¨ç»„ä¸­æŒ‰å­—æ¯é¡ºåºæ’åˆ—ã€‚ ä¾‹å¦‚: <code>import * as foo from &#39;a&#39;; import * as bar from &#39;b&#39;;</code></li>
<li>  å¯¼å…¥ç»„ç”¨ç©ºè¡Œéš”å¼€ã€‚</li>
<li>ç»„å†…æŒ‰ç…§å¦‚ä¸‹æ’åº:<ul>
<li>  Polyfills (ä¾‹å¦‚: <code>import &#39;reflect-metadata&#39;;</code>)</li>
<li>  Node å†…ç½®æ¨¡å— (ä¾‹å¦‚: <code>import fs from &#39;fs&#39;;</code>)</li>
<li>  å¤–éƒ¨æ¨¡å— (ä¾‹å¦‚: <code>import &#123; query &#125; from &#39;itiriri&#39;;</code>)</li>
<li>  å†…éƒ¨æ¨¡å— (ä¾‹å¦‚: <code>import &#123; UserService &#125; from &#39;src/services/userService&#39;;</code>)</li>
<li>  çˆ¶ç›®å½•ä¸­çš„æ¨¡å— (ä¾‹å¦‚: <code>import foo from &#39;../foo&#39;; import qux from &#39;../../foo/qux&#39;;</code>)</li>
<li>  æ¥è‡ªç›¸åŒæˆ–å…„å¼Ÿç›®å½•çš„æ¨¡å— (ä¾‹å¦‚: <code>import bar from &#39;./bar&#39;; import baz from &#39;./bar/baz&#39;;</code>)</li>
</ul>
</li>
</ul>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; TypeDefinition &#125; <span class="keyword">from</span> <span class="string">&#x27;../types/typeDefinition&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; AttributeTypes &#125; <span class="keyword">from</span> <span class="string">&#x27;../model/attribute&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ApiCredentials, Adapters &#125; <span class="keyword">from</span> <span class="string">&#x27;./common/api/authorization&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">&#x27;fs&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ConfigPlugin &#125; <span class="keyword">from</span> <span class="string">&#x27;./plugins/config/configPlugin&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; BindingScopeEnum, Container &#125; <span class="keyword">from</span> <span class="string">&#x27;inversify&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;reflect-metadata&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;reflect-metadata&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">&#x27;fs&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; BindingScopeEnum, Container &#125; <span class="keyword">from</span> <span class="string">&#x27;inversify&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; AttributeTypes &#125; <span class="keyword">from</span> <span class="string">&#x27;../model/attribute&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TypeDefinition &#125; <span class="keyword">from</span> <span class="string">&#x27;../types/typeDefinition&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; ApiCredentials, Adapters &#125; <span class="keyword">from</span> <span class="string">&#x27;./common/api/authorization&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ConfigPlugin &#125; <span class="keyword">from</span> <span class="string">&#x27;./plugins/config/configPlugin&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="ä½¿ç”¨-typescript-åˆ«å"><a href="#ä½¿ç”¨-typescript-åˆ«å" class="headerlink" title="ä½¿ç”¨ typescript åˆ«å"></a><a href="#%E4%BD%BF%E7%94%A8-typescript-%E5%88%AB%E5%90%8D"></a>ä½¿ç”¨ typescript åˆ«å</h3><p>ä¸ºäº†åˆ›å»ºæ•´æ´æ¼‚äº®çš„å¯¼å…¥è¯­å¥ï¼Œå¯ä»¥åœ¨<code>tsconfig.json</code>ä¸­è®¾ç½®ç¼–è¯‘å™¨é€‰é¡¹çš„<code>paths</code>å’Œ<code>baseUrl</code>å±æ€§ã€‚</p>
<p>è¿™æ ·å¯ä»¥é¿å…å¯¼å…¥æ—¶ä½¿ç”¨è¾ƒé•¿çš„ç›¸å¯¹è·¯å¾„ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; UserService &#125; <span class="keyword">from</span> <span class="string">&#x27;../../../services/UserService&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; UserService &#125; <span class="keyword">from</span> <span class="string">&#x27;@services/UserService&#x27;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tsconfig.json</span></span><br><span class="line">...</span><br><span class="line">  <span class="string">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">&quot;baseUrl&quot;</span>: <span class="string">&quot;src&quot;</span>,</span><br><span class="line">    <span class="string">&quot;paths&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;@services&quot;</span>: [<span class="string">&quot;services/*&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h2 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a><a href="#%E6%B3%A8%E9%87%8A"></a>æ³¨é‡Š</h2><p>å†™æ³¨é‡Šæ„å‘³ç€æ²¡æœ‰æ³¨é‡Šå°±æ— æ³•è¡¨è¾¾æ¸…æ¥šï¼Œè€Œæœ€å¥½ç”¨ä»£ç å»è¡¨è¾¾ã€‚</p>
<blockquote>
<p>ä¸è¦æ³¨é‡Šåä»£ç ï¼Œé‡å†™å§ï¼â€” <em>Brian W. Kernighan and P. J. Plaugher</em></p>
</blockquote>
<h3 id="ä»£ç è‡ªè§£é‡Šè€Œä¸æ˜¯ç”¨æ³¨é‡Š"><a href="#ä»£ç è‡ªè§£é‡Šè€Œä¸æ˜¯ç”¨æ³¨é‡Š" class="headerlink" title="ä»£ç è‡ªè§£é‡Šè€Œä¸æ˜¯ç”¨æ³¨é‡Š"></a><a href="#%E4%BB%A3%E7%A0%81%E8%87%AA%E8%A7%A3%E9%87%8A%E8%80%8C%E4%B8%8D%E6%98%AF%E7%94%A8%E6%B3%A8%E9%87%8A"></a>ä»£ç è‡ªè§£é‡Šè€Œä¸æ˜¯ç”¨æ³¨é‡Š</h3><p>ä»£ç å³æ–‡æ¡£ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Check if subscription is active.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (subscription.endDate &gt; <span class="built_in">Date</span>.now) &#123;  &#125;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isSubscriptionActive = subscription.endDate &gt; <span class="built_in">Date</span>.now;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (isSubscriptionActive) &#123; <span class="comment">/* ... */</span> &#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="ä¸è¦å°†æ³¨é‡Šæ‰çš„ä»£ç ç•™åœ¨ä»£ç åº“ä¸­"><a href="#ä¸è¦å°†æ³¨é‡Šæ‰çš„ä»£ç ç•™åœ¨ä»£ç åº“ä¸­" class="headerlink" title="ä¸è¦å°†æ³¨é‡Šæ‰çš„ä»£ç ç•™åœ¨ä»£ç åº“ä¸­"></a><a href="#%E4%B8%8D%E8%A6%81%E5%B0%86%E6%B3%A8%E9%87%8A%E6%8E%89%E7%9A%84%E4%BB%A3%E7%A0%81%E7%95%99%E5%9C%A8%E4%BB%A3%E7%A0%81%E5%BA%93%E4%B8%AD"></a>ä¸è¦å°†æ³¨é‡Šæ‰çš„ä»£ç ç•™åœ¨ä»£ç åº“ä¸­</h3><p>ç‰ˆæœ¬æ§åˆ¶å­˜åœ¨çš„ä¸€ä¸ªç†ç”±ï¼Œå°±æ˜¯è®©æ—§ä»£ç æˆä¸ºå†å²ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  email: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// age: number;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// jobPosition: string;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  email: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="ä¸è¦åƒå†™æ—¥è®°ä¸€æ ·å†™æ³¨é‡Š"><a href="#ä¸è¦åƒå†™æ—¥è®°ä¸€æ ·å†™æ³¨é‡Š" class="headerlink" title="ä¸è¦åƒå†™æ—¥è®°ä¸€æ ·å†™æ³¨é‡Š"></a><a href="#%E4%B8%8D%E8%A6%81%E5%83%8F%E5%86%99%E6%97%A5%E8%AE%B0%E4%B8%80%E6%A0%B7%E5%86%99%E6%B3%A8%E9%87%8A"></a>ä¸è¦åƒå†™æ—¥è®°ä¸€æ ·å†™æ³¨é‡Š</h3><p>è®°ä½ï¼Œä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ï¼ä¸éœ€è¦ä¿ç•™æ— ç”¨ä»£ç ã€æ³¨é‡Šæ‰çš„ä»£ç ï¼Œå°¤å…¶åƒæ—¥è®°ä¸€æ ·çš„æ³¨é‡Šã€‚ä½¿ç”¨<code>git log</code>æ¥è·å–å†å²ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> * 2016-12-20: Removed monads, didn&#x27;t understand them (RM)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> * 2016-10-01: Improved using special monads (JP)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> * 2016-02-03: Added type-checking (LI)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> * 2015-03-14: Implemented combine (JR)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">combine</span>(<span class="params">a:<span class="built_in">number</span>, b:<span class="built_in">number</span></span>): <span class="title">number</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">combine</span>(<span class="params">a:<span class="built_in">number</span>, b:<span class="built_in">number</span></span>): <span class="title">number</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="é¿å…ä½¿ç”¨æ³¨é‡Šæ ‡è®°ä½ç½®"><a href="#é¿å…ä½¿ç”¨æ³¨é‡Šæ ‡è®°ä½ç½®" class="headerlink" title="é¿å…ä½¿ç”¨æ³¨é‡Šæ ‡è®°ä½ç½®"></a><a href="#%E9%81%BF%E5%85%8D%E4%BD%BF%E7%94%A8%E6%B3%A8%E9%87%8A%E6%A0%87%E8%AE%B0%E4%BD%8D%E7%BD%AE"></a>é¿å…ä½¿ç”¨æ³¨é‡Šæ ‡è®°ä½ç½®</h3><p>å®ƒä»¬å¸¸å¸¸æ‰°ä¹±ä»£ç ã€‚è¦è®©ä»£ç ç»“æ„åŒ–ï¼Œå‡½æ•°å’Œå˜é‡è¦æœ‰åˆé€‚çš„ç¼©è¿›å’Œæ ¼å¼ã€‚</p>
<p>å¦å¤–ï¼Œä½ å¯ä»¥ä½¿ç”¨æ”¯æŒä»£ç æŠ˜å çš„IDE (çœ‹ä¸‹ Visual Studio Code <a target="_blank" rel="noopener" href="https://code.visualstudio.com/updates/v1_17#_folding-regions">ä»£ç æŠ˜å </a>).</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Client class</span></span><br><span class="line"></span><br><span class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  address: Address;</span><br><span class="line"></span><br><span class="line">  contact: Contact;</span><br><span class="line"></span><br><span class="line">  <span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// public methods</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> describe(): <span class="built_in">string</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// private methods</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> describeAddress(): <span class="built_in">string</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> describeContact(): <span class="built_in">string</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  address: Address;</span><br><span class="line"></span><br><span class="line">  contact: Contact;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> describe(): <span class="built_in">string</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> describeAddress(): <span class="built_in">string</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> describeContact(): <span class="built_in">string</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>
<h3 id="TODO-æ³¨é‡Š"><a href="#TODO-æ³¨é‡Š" class="headerlink" title="TODO æ³¨é‡Š"></a><a href="#todo-%E6%B3%A8%E9%87%8A"></a>TODO æ³¨é‡Š</h3><p>å½“å‘ç°è‡ªå·±éœ€è¦åœ¨ä»£ç ä¸­ç•™ä¸‹æ³¨é‡Šï¼Œä»¥æé†’åç»­æ”¹è¿›æ—¶ï¼Œä½¿ç”¨<code>// TODO</code>æ³¨é‡Šã€‚å¤§å¤šæ•°IDEéƒ½å¯¹è¿™ç±»æ³¨é‡Šæä¾›äº†ç‰¹æ®Šçš„æ”¯æŒï¼Œä½ å¯ä»¥å¿«é€Ÿæµè§ˆæ•´ä¸ª<code>TODO</code>åˆ—è¡¨ã€‚</p>
<p>ä½†æ˜¯ï¼Œè¯·è®°ä½<strong>TODO</strong>æ³¨é‡Šå¹¶ä¸æ˜¯åä»£ç çš„å€Ÿå£ã€‚</p>
<p><strong>ğŸ‘ åä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getActiveSubscriptions</span>(<span class="params"></span>): <span class="title">Promise</span>&lt;<span class="title">Subscription</span>[]&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// ensure `dueDate` is indexed.</span></span><br><span class="line">  <span class="keyword">return</span> db.subscriptions.find(&#123; <span class="attr">dueDate</span>: &#123; <span class="attr">$lte</span>: <span class="keyword">new</span> <span class="built_in">Date</span>() &#125; &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ‘ æ­£ä¾‹:</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getActiveSubscriptions</span>(<span class="params"></span>): <span class="title">Promise</span>&lt;<span class="title">Subscription</span>[]&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// <span class="doctag">TODO:</span> ensure `dueDate` is indexed.</span></span><br><span class="line">  <span class="keyword">return</span> db.subscriptions.find(&#123; <span class="attr">dueDate</span>: &#123; <span class="attr">$lte</span>: <span class="keyword">new</span> <span class="built_in">Date</span>() &#125; &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">â†‘ å›åˆ°é¡¶éƒ¨</a></strong></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/05/23/204-%E3%80%90TypeScript%E3%80%91TypeScript%E4%BB%A3%E7%A0%81%E6%95%B4%E6%B4%81%E4%B9%8B%E9%81%93/" data-id="ckts3ek0000rw4d9kdj013w9f" data-title="204-ã€TypeScriptã€‘TypeScriptä»£ç æ•´æ´ä¹‹é“" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TypeScript/" rel="tag">TypeScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">å‰ç«¯å¼€å‘</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-203-ã€JavaScriptã€‘é€å­¦å¦¹æ»¡å±å¹•å°çˆ±å¿ƒ" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/27/203-%E3%80%90JavaScript%E3%80%91%E9%80%81%E5%AD%A6%E5%A6%B9%E6%BB%A1%E5%B1%8F%E5%B9%95%E5%B0%8F%E7%88%B1%E5%BF%83/" class="article-date">
  <time class="dt-published" datetime="2020-04-27T14:05:18.000Z" itemprop="datePublished">2020-04-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/27/203-%E3%80%90JavaScript%E3%80%91%E9%80%81%E5%AD%A6%E5%A6%B9%E6%BB%A1%E5%B1%8F%E5%B9%95%E5%B0%8F%E7%88%B1%E5%BF%83/">203-ã€JavaScriptã€‘é€å­¦å¦¹æ»¡å±å¹•å°çˆ±å¿ƒ</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="æ•…äº‹å¼€å§‹"><a href="#æ•…äº‹å¼€å§‹" class="headerlink" title="æ•…äº‹å¼€å§‹"></a>æ•…äº‹å¼€å§‹</h2><p>åˆé¥­æ—¶é—´ï¼Œæš—æ‹å·²ä¹…çš„å­¦å¦¹æ‹‰ç€æˆ‘çš„è¡£è¢–ï¼šâ€œå­¦é•¿å­¦é•¿ï¼Œä½ èƒ½ä¸èƒ½è®©è¿™äº›çˆ±å¿ƒå˜æˆäº”é¢œå…­è‰²çš„å—~â€ã€‚<br /><br><br />æˆ‘åœ¨æ—è¾¹ç¬‘å¼€äº†èŠ±~~~<br /><br><br /><br>        <img src="https://cdn.nlark.com/yuque/0/2020/png/186051/1587909551332-26fa22bf-c7ee-4a7f-9286-a8e768d352af.png" alt="image.png"></p>
<p><br />è¯¶å‘€ï¼Œå£æ°´æµå‡ºæ¥äº†ã€‚<br /><br><br />æˆ‘æƒ³æœ€ç»ˆæ•ˆæœæ˜¯è¿™æ ·çš„ï¼ˆçŒœçŒœå¤šå°‘ä¸ªçˆ±å¿ƒï¼‰ï¼š<br /><img src="https://cdn.nlark.com/yuque/0/2020/png/186051/1587910535131-d55a64ef-d77f-4d50-bb40-b0ef224782c6.png#align=left&display=inline&height=477&margin=%5Bobject%20Object%5D&name=image.png&originHeight=477&originWidth=305&size=36843&status=done&style=shadow&width=305" alt="image.png"><br />ç„¶åå¼€å§‹åŠ¨æ‰‹å§~<br /></p>
<p><a name="5bWDu"></a></p>
<h2 id="å­¦å•¥æœ¬é¢†"><a href="#å­¦å•¥æœ¬é¢†" class="headerlink" title="å­¦å•¥æœ¬é¢†"></a>å­¦å•¥æœ¬é¢†</h2><p>æœ¬æ–‡å°†å¸¦å¤§å®¶å­¦ä¹ ä¸¤ä¸ªå¥½ä¸œè¥¿ï¼š<br />1.ç”Ÿæˆéšæœºè‰²çš„æ–¹æ³•ï¼›<br />2.Element.animate() æ–¹æ³•ã€‚<br /><br><br />å½“ç„¶ï¼Œè¿˜æœ‰æ’©å¦¹æŠ€å·§äº†~<br /></p>
<p><a name="Jjdhe"></a></p>
<h2 id="ä»£ç èµ°èµ·"><a href="#ä»£ç èµ°èµ·" class="headerlink" title="ä»£ç èµ°èµ·"></a>ä»£ç èµ°èµ·</h2><p><a name="93zDM"></a></p>
<h3 id="1-ç”»ä¸ªå°çˆ±å¿ƒ"><a href="#1-ç”»ä¸ªå°çˆ±å¿ƒ" class="headerlink" title="1. ç”»ä¸ªå°çˆ±å¿ƒ"></a>1. ç”»ä¸ªå°çˆ±å¿ƒ</h3><p><br />çˆ±å¿ƒæ€ä¹ˆç”»ï¼Œä¸æ˜¯å’±ä»¬æœ¬æ–‡é‡ç‚¹ï¼Œsoï¼ŒSVGæèµ·ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;heart&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">svg</span> <span class="attr">t</span>=<span class="string">&quot;1587910011145&quot;</span> <span class="attr">class</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">viewBox</span>=<span class="string">&quot;0 0 1024 1024&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.1&quot;</span> </span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> <span class="attr">p-id</span>=<span class="string">&quot;1253&quot;</span> <span class="attr">width</span>=<span class="string">&quot;32&quot;</span> <span class="attr">height</span>=<span class="string">&quot;32&quot;</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">&quot;M677.51936 192.03072c113.1008 0 204.8 91.6992 204.8 204.77952 0 </span></span></span><br><span class="line"><span class="string"><span class="tag">             186.91072-370.3296 435.15904-370.3296 435.15904S141.68064 592.67072 141.68064 </span></span></span><br><span class="line"><span class="string"><span class="tag">             396.81024c0-140.78976 91.6992-204.77952 204.77952-204.77952 68.11648 0 </span></span></span><br><span class="line"><span class="string"><span class="tag">             128.28672 33.40288 165.5296 84.55168C549.24288 225.4336 609.41312 192.03072 </span></span></span><br><span class="line"><span class="string"><span class="tag">             677.51936 192.03072z&quot;</span> <span class="attr">p-id</span>=<span class="string">&quot;1254&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å°çˆ±å¿ƒå‡ºæ¥äº†ï¼š<br /><img src="https://cdn.nlark.com/yuque/0/2020/png/186051/1587912283717-9a2f58bd-742a-4cd0-bd01-09afa090c1d2.png#align=left&display=inline&height=205&margin=%5Bobject%20Object%5D&name=image.png&originHeight=205&originWidth=318&size=2348&status=done&style=shadow&width=318" alt="image.png"><br><a name="LuHFB"></a></p>
<h3 id="2-ç”»ä¸€å¤§å †çˆ±å¿ƒ"><a href="#2-ç”»ä¸€å¤§å †çˆ±å¿ƒ" class="headerlink" title="2. ç”»ä¸€å¤§å †çˆ±å¿ƒ"></a>2. ç”»ä¸€å¤§å †çˆ±å¿ƒ</h3><p>ç°åœ¨åˆ é™¤åˆ°ä¹‹å‰çš„ SVG æ ‡ç­¾ï¼Œæ¢æˆåŠ¨æ€ç”Ÿæˆå’¯~~</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> heartList = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> n = <span class="number">99</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt;= n; i++)&#123;</span><br><span class="line">    heartList += <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;svg t=&quot;1587910011145&quot; class=&quot;icon&quot; viewBox=&quot;0 0 1024 1024&quot; version=&quot;1.1&quot; </span></span><br><span class="line"><span class="string">           xmlns=&quot;http://www.w3.org/2000/svg&quot; p-id=&quot;1253&quot; width=&quot;32&quot; height=&quot;32&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;path d=&quot;M677.51936 192.03072c113.1008 0 204.8 91.6992 204.8 204.77952 0 </span></span><br><span class="line"><span class="string">                 186.91072-370.3296 435.15904-370.3296 435.15904S141.68064 592.67072 141.68064 </span></span><br><span class="line"><span class="string">                 396.81024c0-140.78976 91.6992-204.77952 204.77952-204.77952 68.11648 0 </span></span><br><span class="line"><span class="string">                 128.28672 33.40288 165.5296 84.55168C549.24288 225.4336 609.41312 192.03072 </span></span><br><span class="line"><span class="string">                 677.51936 192.03072z&quot; p-id=&quot;1254&quot;</span></span><br><span class="line"><span class="string">        &gt;&lt;/path&gt;</span></span><br><span class="line"><span class="string">      &lt;/svg&gt;</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">&#x27;heart&#x27;</span>).innerHTML = heartList;</span><br></pre></td></tr></table></figure>
<p>ä¸€å¤§å †å°çˆ±å¿ƒå‡ºç°å•¦ï¼š<br /><img src="https://cdn.nlark.com/yuque/0/2020/png/186051/1587912432701-df7c0a52-a234-485c-9b06-2eba6cf2d03a.png#align=left&display=inline&height=488&margin=%5Bobject%20Object%5D&name=image.png&originHeight=488&originWidth=313&size=12778&status=done&style=shadow&width=313" alt="image.png"><br /></p>
<p><a name="pHRtK"></a></p>
<h3 id="3-æ‰“é€ é­”æ³•æ£’"><a href="#3-æ‰“é€ é­”æ³•æ£’" class="headerlink" title="3. æ‰“é€ é­”æ³•æ£’"></a>3. æ‰“é€ é­”æ³•æ£’</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¦æ‰“é€ ä¸€æŠŠé­”æ³•æ£’ï¼Œèƒ½è®©æˆ‘ä»¬è¿™äº›å°çˆ±å¿ƒå˜æˆå„ç§å„æ ·çš„é¢œè‰²ã€‚<br />æ²¡é”™ï¼Œè¿™æŠŠé­”æ³•æ£’ï¼Œå°±æ˜¯ç”¨æ¥ç”Ÿæˆéšæœºé¢œè‰²ã€‚<br /><br><br />æ–¹æ³•å¾ˆå¤šï¼Œæˆ‘æœé›†ä»¥ä¸‹å‡ ç§ç®€å•å¥½ç”¨çš„ç”Ÿæˆéšæœºé¢œè‰²çš„æ–¹æ³•ï¼ŒåŸºæœ¬æˆ‘ä»¬ä¸šåŠ¡éšä¾¿ä¸€ä¸ªéƒ½èƒ½ç”¨ï¼š<br /></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRandomColor</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> r = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random()*<span class="number">255</span>);</span><br><span class="line">    <span class="keyword">const</span> g = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random()*<span class="number">255</span>);</span><br><span class="line">    <span class="keyword">const</span> b = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random()*<span class="number">255</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;rgba(&#x27;</span>+ r +<span class="string">&#x27;,&#x27;</span>+ g +<span class="string">&#x27;,&#x27;</span>+ b +<span class="string">&#x27;,0.8)&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRandomColor</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;#&#x27;</span>+<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random()*<span class="number">16777215</span>).toString(<span class="number">16</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRandomColor</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;#&#x27;</span> + (<span class="function"><span class="keyword">function</span>(<span class="params">color</span>)</span>&#123;    </span><br><span class="line">        <span class="keyword">return</span> (color +=  <span class="string">&#x27;0123456789abcdef&#x27;</span>[<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random()*<span class="number">16</span>)])    </span><br><span class="line">        &amp;&amp; (color.length == <span class="number">6</span>) ?  color : <span class="built_in">arguments</span>.callee(color);    </span><br><span class="line">    &#125;)(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRandomColor</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;#&#x27;</span>+<span class="string">&#x27;0123456789abcdef&#x27;</span>.split(<span class="string">&#x27;&#x27;</span>).map(</span><br><span class="line">        <span class="function">(<span class="params">v,i,a</span>) =&gt;</span> i&gt;<span class="number">5</span> ? <span class="literal">null</span> : a[<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random()*<span class="number">16</span>)] </span><br><span class="line">    ).join(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRandomColor</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;#&#x27;</span>+(<span class="string">&#x27;00000&#x27;</span>+(<span class="built_in">Math</span>.random()*<span class="number">0x1000000</span>&lt;&lt;<span class="number">0</span>).toString(<span class="number">16</span>)).slice(-<span class="number">6</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRandomColor</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> colorAngle = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random()*<span class="number">360</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hsla(&#x27;</span>+ colorAngle +<span class="string">&#x27;,100%,50%,1)&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRandomColor</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="function"><span class="keyword">function</span>(<span class="params">m,s,c</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (c ? <span class="built_in">arguments</span>.callee(m,s,c-<span class="number">1</span>) : <span class="string">&#x27;#&#x27;</span>) +</span><br><span class="line">        s[m.floor(m.random() * <span class="number">16</span>)]</span><br><span class="line">    &#125;)(<span class="built_in">Math</span>,<span class="string">&#x27;0123456789abcdef&#x27;</span>,<span class="number">5</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>éšæœºè‰²çœŸå¥½ç©~<br /></p>
<p><a name="VZS4r"></a></p>
<h3 id="4-äº”é¢œå…­è‰²ï¼å˜"><a href="#4-äº”é¢œå…­è‰²ï¼å˜" class="headerlink" title="4.Â äº”é¢œå…­è‰²ï¼å˜~"></a>4.Â äº”é¢œå…­è‰²ï¼å˜~</h3><p>æœ€åï¼Œæˆ‘ä»¬ä¿®æ”¹å‰é¢ SVG çš„ä»£ç ç‰‡æ®µï¼ŒåŠ å…¥ <code>getRandomColor</code> æ–¹æ³•çš„è°ƒç”¨ï¼š<br /></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt;= n; i++)&#123;</span><br><span class="line">    heartList += <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;svg t=&quot;1587910011145&quot; class=&quot;icon&quot; viewBox=&quot;0 0 1024 1024&quot; version=&quot;1.1&quot; </span></span><br><span class="line"><span class="string">           xmlns=&quot;http://www.w3.org/2000/svg&quot; p-id=&quot;1253&quot; width=&quot;32&quot; height=&quot;32&quot;</span></span><br><span class="line"><span class="string">					 fill=&quot;<span class="subst">$&#123;getRandomColor()&#125;</span>&quot;</span></span><br><span class="line"><span class="string">			&gt;</span></span><br><span class="line"><span class="string">        &lt;path d=&quot;M677.51936 192.03072c113.1008 0 204.8 91.6992 204.8 204.77952 0 </span></span><br><span class="line"><span class="string">                 186.91072-370.3296 435.15904-370.3296 435.15904S141.68064 592.67072 141.68064 </span></span><br><span class="line"><span class="string">                 396.81024c0-140.78976 91.6992-204.77952 204.77952-204.77952 68.11648 0 </span></span><br><span class="line"><span class="string">                 128.28672 33.40288 165.5296 84.55168C549.24288 225.4336 609.41312 192.03072 </span></span><br><span class="line"><span class="string">                 677.51936 192.03072z&quot; p-id=&quot;1254&quot;</span></span><br><span class="line"><span class="string">        &gt;&lt;/path&gt;</span></span><br><span class="line"><span class="string">      &lt;/svg&gt;</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>99 ä¸ªå°çˆ±å¿ƒï¼Œæ°´çµçµçš„ï¼<br /><img src="https://cdn.nlark.com/yuque/0/2020/png/186051/1587912884313-d52a18d6-0d62-4b1b-a897-96b02a5d4924.png#align=left&display=inline&height=517&margin=%5Bobject%20Object%5D&name=image.png&originHeight=517&originWidth=316&size=37711&status=done&style=none&width=316" alt="image.png"><br><a name="2uEER"></a></p>
<h3 id="5-åŠ¨èµ·æ¥å§ï¼"><a href="#5-åŠ¨èµ·æ¥å§ï¼" class="headerlink" title="5. åŠ¨èµ·æ¥å§ï¼"></a>5. åŠ¨èµ·æ¥å§ï¼</h3><p>è¿™æ—¶å€™ï¼Œæ¯ä¸ªçˆ±å¿ƒéƒ½é™é™èººç€é¡µé¢ï¼Œæ˜¯æ—¶å€™è®©å®ƒä»¬åŠ¨èµ·æ¥å•¦ï¼Œä¸ºäº†å­¦å¦¹~<br /><br><br />ç»§ç»­æ”¹é€ å‰é¢ SVG ä»£ç ï¼Œä¸ºæ¯ä¸ª SVG æ ‡ç­¾æ·»åŠ è¿ç»­ ID å€¼ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt;= n; i++)&#123;</span><br><span class="line">    heartList += <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;svg id=&quot;heart_<span class="subst">$&#123;i&#125;</span>&quot; t=&quot;1587910011145&quot; class=&quot;icon&quot; viewBox=&quot;0 0 1024 1024&quot; version=&quot;1.1&quot; </span></span><br><span class="line"><span class="string">           xmlns=&quot;http://www.w3.org/2000/svg&quot; p-id=&quot;1253&quot; width=&quot;32&quot; height=&quot;32&quot;</span></span><br><span class="line"><span class="string">					 fill=&quot;<span class="subst">$&#123;getRandomColor()&#125;</span>&quot;</span></span><br><span class="line"><span class="string">			&gt;</span></span><br><span class="line"><span class="string">        &lt;path d=&quot;M677.51936 192.03072c113.1008 0 204.8 91.6992 204.8 204.77952 0 </span></span><br><span class="line"><span class="string">                 186.91072-370.3296 435.15904-370.3296 435.15904S141.68064 592.67072 141.68064 </span></span><br><span class="line"><span class="string">                 396.81024c0-140.78976 91.6992-204.77952 204.77952-204.77952 68.11648 0 </span></span><br><span class="line"><span class="string">                 128.28672 33.40288 165.5296 84.55168C549.24288 225.4336 609.41312 192.03072 </span></span><br><span class="line"><span class="string">                 677.51936 192.03072z&quot; p-id=&quot;1254&quot;</span></span><br><span class="line"><span class="string">        &gt;&lt;/path&gt;</span></span><br><span class="line"><span class="string">      &lt;/svg&gt;</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”Ÿå‘½éšæœºæ”¾å¤§å€æ•°ï¼Œå¹¶è®¾ç½®åŠ¨ç”»æ•ˆæœï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> getRandomNum = <span class="function">() =&gt;</span> <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random()*<span class="number">2</span>+<span class="number">1</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> item = <span class="string">`heart_<span class="subst">$&#123;i&#125;</span>`</span>;</span><br><span class="line">        <span class="built_in">document</span>.getElementById(item).animate([</span><br><span class="line">            <span class="comment">// keyframes translateY(0px)</span></span><br><span class="line">            &#123; <span class="attr">transform</span>: <span class="string">`scale(<span class="subst">$&#123;getRandomNum()&#125;</span>)`</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">transform</span>: <span class="string">`scale(<span class="subst">$&#123;getRandomNum()&#125;</span>)`</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">transform</span>: <span class="string">`scale(<span class="subst">$&#123;getRandomNum()&#125;</span>)`</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">transform</span>: <span class="string">`scale(<span class="subst">$&#123;getRandomNum()&#125;</span>)`</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">transform</span>: <span class="string">`scale(<span class="subst">$&#123;getRandomNum()&#125;</span>)`</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">transform</span>: <span class="string">`scale(<span class="subst">$&#123;getRandomNum()&#125;</span>)`</span> &#125;,</span><br><span class="line">        ], &#123;</span><br><span class="line">            <span class="comment">// timing options</span></span><br><span class="line">            <span class="attr">duration</span>: <span class="number">5000</span>,</span><br><span class="line">            <span class="attr">iterations</span>: <span class="literal">Infinity</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="number">100</span>)</span><br></pre></td></tr></table></figure>
<p>ç„¶åï¼Œå°çˆ±å¿ƒä»¬åŠ¨èµ·æ¥å•¦ã€‚<br /><br><br /><img src="https://cdn.nlark.com/yuque/0/2020/gif/186051/1587918816415-ff934e3e-f954-4767-b3ba-4f393f47a88a.gif#align=left&display=inline&height=480&margin=%5Bobject%20Object%5D&name=%E7%88%B1%E5%BF%83666%20%281%29.gif&originHeight=480&originWidth=270&size=3394858&status=done&style=none&width=270" alt="çˆ±å¿ƒ666 (1).gif"><br><a name="KH8fL"></a></p>
<h3 id="6-é£èµ·æ¥å§"><a href="#6-é£èµ·æ¥å§" class="headerlink" title="6. é£èµ·æ¥å§~"></a>6. é£èµ·æ¥å§~</h3><p><br />æ¥ä¸‹æ¥ï¼Œè¦è®©è¿™äº›å°çˆ±å¿ƒé£èµ·æ¥~<br /><br><br /><img src="https://cdn.nlark.com/yuque/0/2020/gif/186051/1587919330721-201c7eb3-4196-49e0-b21a-ce6a2d558ed2.gif#align=left&display=inline&height=480&margin=%5Bobject%20Object%5D&name=%E7%88%B1%E5%BF%83666%20%283%29.gif&originHeight=480&originWidth=270&size=2612299&status=done&style=none&width=270" alt="çˆ±å¿ƒ666 (3).gif"><br /><br><br />ä¸‹é¢è´´ä»£ç ã€‚</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">html</span>,<span class="selector-tag">body</span>&#123;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#heart</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.item</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€»è¾‘ä¿®æ”¹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> heartList = <span class="string">&#x27;&#x27;</span>; </span><br><span class="line"><span class="keyword">const</span> n = <span class="number">666</span>; <span class="comment">// æ€»çˆ±å¿ƒæ•°</span></span><br><span class="line"><span class="comment">// ç”Ÿæˆéšæœºé¢œè‰²</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRandomColor</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="function"><span class="keyword">function</span> (<span class="params">m, s, c</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (c ? <span class="built_in">arguments</span>.callee(m, s, c - <span class="number">1</span>) : <span class="string">&#x27;#&#x27;</span>) +</span><br><span class="line">            s[m.floor(m.random() * <span class="number">16</span>)]</span><br><span class="line">    &#125;)(<span class="built_in">Math</span>, <span class="string">&#x27;0123456789abcdef&#x27;</span>, <span class="number">5</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç”Ÿæˆçˆ±å¿ƒåˆ—è¡¨</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt;= n; i++)&#123;</span><br><span class="line">    heartList += <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;svg id=&quot;heart_<span class="subst">$&#123;i&#125;</span>&quot; class=&quot;item&quot; t=&quot;1587910011145&quot; class=&quot;icon&quot; viewBox=&quot;0 0 1024 1024&quot; version=&quot;1.1&quot; </span></span><br><span class="line"><span class="string">           xmlns=&quot;http://www.w3.org/2000/svg&quot; p-id=&quot;1253&quot; width=&quot;32&quot; height=&quot;32&quot;</span></span><br><span class="line"><span class="string">					 fill=&quot;<span class="subst">$&#123;getRandomColor()&#125;</span>&quot;</span></span><br><span class="line"><span class="string">			&gt;</span></span><br><span class="line"><span class="string">        &lt;path d=&quot;M677.51936 192.03072c113.1008 0 204.8 91.6992 204.8 204.77952 0 </span></span><br><span class="line"><span class="string">                 186.91072-370.3296 435.15904-370.3296 435.15904S141.68064 592.67072 141.68064 </span></span><br><span class="line"><span class="string">                 396.81024c0-140.78976 91.6992-204.77952 204.77952-204.77952 68.11648 0 </span></span><br><span class="line"><span class="string">                 128.28672 33.40288 165.5296 84.55168C549.24288 225.4336 609.41312 192.03072 </span></span><br><span class="line"><span class="string">                 677.51936 192.03072z&quot; p-id=&quot;1254&quot;</span></span><br><span class="line"><span class="string">        &gt;&lt;/path&gt;</span></span><br><span class="line"><span class="string">      &lt;/svg&gt;</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// éšæœºæ”¾å¤§å€æ•°</span></span><br><span class="line"><span class="keyword">const</span> getRandomNum = <span class="function">(<span class="params">scale</span>) =&gt;</span> <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random()*scale+<span class="number">1</span>);</span><br><span class="line"><span class="keyword">const</span> boxWidth = <span class="built_in">window</span>.innerWidth;</span><br><span class="line"><span class="keyword">const</span> boxHeight = <span class="built_in">window</span>.innerHeight;</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> item = <span class="string">`heart_<span class="subst">$&#123;i&#125;</span>`</span>;</span><br><span class="line">        <span class="keyword">const</span> width = getRandomNum(boxWidth);</span><br><span class="line">        <span class="keyword">const</span> height = getRandomNum(boxHeight);</span><br><span class="line">        <span class="keyword">const</span> cWidth = getRandomNum(<span class="number">1000</span>) - width;</span><br><span class="line">        <span class="keyword">const</span> cHeight = getRandomNum(<span class="number">1000</span>) - height;</span><br><span class="line">        <span class="built_in">document</span>.getElementById(item).animate([</span><br><span class="line">            &#123; <span class="attr">transform</span>: <span class="string">`scale(<span class="subst">$&#123;getRandomNum(<span class="number">2</span>)&#125;</span>)`</span>,<span class="attr">left</span>: <span class="string">`0px`</span>, <span class="attr">top</span>: <span class="string">`0px`</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">transform</span>: <span class="string">`scale(<span class="subst">$&#123;getRandomNum(<span class="number">2</span>)&#125;</span>)`</span>,<span class="attr">left</span>: <span class="string">`<span class="subst">$&#123;boxWidth<span class="regexp">/2&#125;px`, top: `$&#123;boxHeight/</span><span class="number">2</span>&#125;</span>px`</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">transform</span>: <span class="string">`scale(<span class="subst">$&#123;getRandomNum(<span class="number">2</span>)&#125;</span>)`</span>,<span class="attr">left</span>: <span class="string">`<span class="subst">$&#123;cWidth * <span class="number">2</span>&#125;</span>px`</span>, <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;cHeight * <span class="number">2</span>&#125;</span>px`</span> &#125;,</span><br><span class="line">        ], &#123;</span><br><span class="line">            <span class="attr">duration</span>: <span class="number">9000</span>,</span><br><span class="line">            <span class="attr">iterations</span>: <span class="literal">Infinity</span>,</span><br><span class="line">            <span class="attr">easing</span>: <span class="string">&#x27;ease-in-out&#x27;</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="number">100</span>)</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">&#x27;heart&#x27;</span>).innerHTML = heartList;</span><br></pre></td></tr></table></figure>
<p>èªæ˜çš„ä½ ï¼Œå†é…ä¸ŠBGMï¼Œæµªæ¼«~<br /><br><br />è¿˜èƒ½åšæ›´å¤šæœ‰æ„æ€çš„å°ç©æ„ï¼Œé å„ä½å‘æŒ¥å•¦ã€‚<br /></p>
<p><a name="R1cCr"></a></p>
<h2 id="æ•…äº‹ç»“æŸ"><a href="#æ•…äº‹ç»“æŸ" class="headerlink" title="æ•…äº‹ç»“æŸ"></a>æ•…äº‹ç»“æŸ</h2><p>ç»§ç»­~<br /><br><br />å¯¹äº†ï¼Œé€ç»™å­¦å¦¹çš„ä»£ç æˆ‘æ”¾åœ¨ä»“åº“ï¼š<br /><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo-JavaScript/blob/master/Leo-Demo/7-WeiteHeartPop.html">https://github.com/pingan8787/Leo-JavaScript/blob/master/Leo-Demo/7-WeiteHeartPop.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/04/27/203-%E3%80%90JavaScript%E3%80%91%E9%80%81%E5%AD%A6%E5%A6%B9%E6%BB%A1%E5%B1%8F%E5%B9%95%E5%B0%8F%E7%88%B1%E5%BF%83/" data-id="ckts3eju5005q4d9k4gc198zm" data-title="203-ã€JavaScriptã€‘é€å­¦å¦¹æ»¡å±å¹•å°çˆ±å¿ƒ" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">å‰ç«¯å¼€å‘</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">åŸåˆ›</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-202-ã€Babelã€‘ä¸å®¹é”™è¿‡çš„Babel7çŸ¥è¯†" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/15/202-%E3%80%90Babel%E3%80%91%E4%B8%8D%E5%AE%B9%E9%94%99%E8%BF%87%E7%9A%84Babel7%E7%9F%A5%E8%AF%86/" class="article-date">
  <time class="dt-published" datetime="2020-04-15T15:14:47.000Z" itemprop="datePublished">2020-04-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/15/202-%E3%80%90Babel%E3%80%91%E4%B8%8D%E5%AE%B9%E9%94%99%E8%BF%87%E7%9A%84Babel7%E7%9F%A5%E8%AF%86/">202-ã€Babelã€‘ä¸å®¹é”™è¿‡çš„Babel7çŸ¥è¯†</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>ä¸å®¹é”™è¿‡çš„ Babel7 çŸ¥è¯† Â <a target="_blank" rel="noopener" href="https://juejin.im/post/5ddff3abe51d4502d56bd143">https://juejin.im/post/5ddff3abe51d4502d56bd143</a><br /></p>
<hr>
<p>å¯¹ <code>Babel</code> çš„é…ç½®é¡¹çš„ä½œç”¨ä¸é‚£ä¹ˆäº†è§£ï¼Œæ˜¯å¦ä¼šå½±å“æ—¥å¸¸å¼€å‘å‘¢ï¼Ÿè€å®è¯´ï¼Œå¤§å¤šæƒ…å†µä¸‹æ²¡æœ‰ç‰¹åˆ«å¤§çš„å½±å“ï¼ˆæ¯•ç«Ÿæœ‰æœç´¢å¼•æ“ï¼‰ã€‚<br />ä¸è¿‡å‘¢ï¼Œè¿˜æ˜¯æƒ³æ›´è¿›ä¸€æ­¥äº†è§£ä¸‹ï¼Œäºæ˜¯æœ€è¿‘è®¤çœŸé˜…è¯»äº† <code>Babel</code> çš„æ–‡æ¡£ï¼Œå¤–åŠ ä¸æ–­ç¼–è¯‘éªŒè¯ï¼Œè¾“å‡ºäº†æœ¬ç¯‡æ–‡ç« ï¼Œä¸ºäº†æ›´å¥½çš„é˜…è¯»ä½“éªŒï¼Œä¿®ä¿®æ”¹æ”¹ï¼Œæœ€ç»ˆç®—æ˜¯ä»¥æˆ‘ä¸ªäººæ¯”è¾ƒå–œæ¬¢çš„æ–¹å¼æ¨è¿›äº†æ¯ä¸ªçŸ¥è¯†ç‚¹ï¼ˆæ¯ä¸€ä¸ªé…ç½®çš„å¼•å…¥éƒ½æ˜¯æœ‰åŸå› çš„ï¼‰ï¼Œå¸Œæœ›èƒ½å¤Ÿå¸®åŠ©ä½ å¯¹ <code>Babel</code> çš„å„ç§é…ç½®æœ‰ä¸€ä¸ªæ›´æ¸…æ™°çš„è®¤è¯† (å·²ç»å¾ˆæ‡‚çš„å°ä¼™ä¼´ï¼Œæ— è§†æœ¬æ–‡) ã€‚<br /></p>
<blockquote>
<p>Babel æ˜¯ä¸€ä¸ª JS ç¼–è¯‘å™¨</p>
</blockquote>
<p><br />Babel æ˜¯ä¸€ä¸ªå·¥å…·é“¾ï¼Œä¸»è¦ç”¨äºå°† ECMAScript 2015+ ç‰ˆæœ¬çš„ä»£ç è½¬æ¢ä¸ºå‘åå…¼å®¹çš„ JavaScript è¯­æ³•ï¼Œä»¥ä¾¿èƒ½å¤Ÿè¿è¡Œåœ¨å½“å‰å’Œæ—§ç‰ˆæœ¬çš„æµè§ˆå™¨æˆ–å…¶ä»–ç¯å¢ƒä¸­ã€‚<br />æˆ‘ä»¬å…ˆçœ‹çœ‹ <code>Babel</code> èƒ½å¤Ÿåšä»€ä¹ˆï¼š</p>
<ul>
<li>è¯­æ³•è½¬æ¢</li>
<li>é€šè¿‡ <code>Polyfill</code> æ–¹å¼åœ¨ç›®æ ‡ç¯å¢ƒä¸­æ·»åŠ ç¼ºå¤±çš„ç‰¹æ€§(<code>@babel/polyfillæ¨¡å—</code>)</li>
<li>æºç è½¬æ¢(codemods)</li>
</ul>
<p><br />æœ¬ç¯‡æ–‡ç« çš„ç›®çš„æ˜¯ææ˜ç™½ <code>Babel</code> çš„ä½¿ç”¨å’Œé…ç½®ï¼Œææ¸…æ¥š <code>@babel/runtime</code>ï¼Œ<code>@babel/polyfill</code>ï¼Œ<code>@babel/plugin-transform-runtime</code> è¿™äº›ä½œç”¨æ˜¯ä»€ä¹ˆï¼Œæ’ä»¶å’Œé¢„è®¾éƒ½æ˜¯ç”¨æ¥å¹²ä»€ä¹ˆçš„ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦é…ç½®å®ƒä»¬ï¼Œè€Œä¸æ˜¯è®²å¦‚ä½•è¿›è¡Œ <code>AST</code> è½¬æ¢ï¼Œå¦‚æœä½ å¯¹ <code>AST</code> è½¬æ¢éå¸¸æ„Ÿå…´è¶£ï¼Œæ¬¢è¿é˜…è¯»æˆ‘ä»¬çš„ <a target="_blank" rel="noopener" href="https://github.com/areslabs/alita">RNè½¬å°ç¨‹åºå¼•æ“ Alita</a> çš„æºç ï¼Œå…¶ä¸­åº”ç”¨äº†å¤§é‡çš„ <code>AST</code> è½¬æ¢ã€‚<br /></p>
<blockquote>
<p>æ›´å¤šæ–‡ç« å¯æˆ³ï¼ˆå¦‚Starï¼Œè°¢è°¢ä½ ï¼‰ï¼š<a target="_blank" rel="noopener" href="https://github.com/YvetteLau/Blog">https://github.com/YvetteLau/Blog</a></p>
</blockquote>
<p><br />ä¸ºäº†æ›´æ¸…æ™°çš„äº†è§£æ¯ä¸€æ­¥ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ï¼Œä¾‹å¦‚ <code>babelTemp</code>(ä½ çˆ±å–å•¥åå–å•¥å)ï¼Œä½¿ç”¨ <code>npm init -y</code> è¿›è¡Œåˆå§‹åŒ–ï¼Œåˆ›å»º <code>src/index.js</code>ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼ˆä½ ä¹Ÿå¯ä»¥éšä¾¿å†™ç‚¹ä»€ä¹ˆï¼‰:<br /></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fn = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>OKï¼Œåˆ›å»ºå¥½çš„é¡¹ç›®å…ˆæ”¾åœ¨ä¸€è¾¹ï¼Œå…ˆäº†è§£ä¸‹ç†è®ºçŸ¥è¯†:<br><a name="2KaSH"></a></p>
<h3 id=""><a href="#" class="headerlink" title=""></a><br /></h3><p><a name="qkcsg"></a></p>
<h3 id="æ ¸å¿ƒåº“-babel-core"><a href="#æ ¸å¿ƒåº“-babel-core" class="headerlink" title="æ ¸å¿ƒåº“ @babel/core"></a>æ ¸å¿ƒåº“ @babel/core</h3><p>Babel çš„æ ¸å¿ƒåŠŸèƒ½åŒ…å«åœ¨ <code>@babel/core</code> æ¨¡å—ä¸­ã€‚çœ‹åˆ° <code>core</code> è¿™ä¸ªè¯äº†å§ï¼Œæ„å‘³ç€<strong>æ ¸å¿ƒ</strong>ï¼Œæ²¡æœ‰å®ƒï¼Œåœ¨ <code>babel</code> çš„ä¸–ç•Œé‡Œæ³¨å®šå¯¸æ­¥éš¾è¡Œã€‚ä¸å®‰è£… <code>@babel/core</code>ï¼Œæ— æ³•ä½¿ç”¨ <code>babel</code> è¿›è¡Œç¼–è¯‘ã€‚<br /></p>
<p><a name="TC6LJ"></a></p>
<h3 id="CLIå‘½ä»¤è¡Œå·¥å…·-babel-cli"><a href="#CLIå‘½ä»¤è¡Œå·¥å…·-babel-cli" class="headerlink" title="CLIå‘½ä»¤è¡Œå·¥å…· @babel/cli"></a>CLIå‘½ä»¤è¡Œå·¥å…· @babel/cli</h3><p><code>babel</code> æä¾›çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œä¸»è¦æ˜¯æä¾› <code>babel</code> è¿™ä¸ªå‘½ä»¤ï¼Œé€‚åˆå®‰è£…åœ¨é¡¹ç›®é‡Œã€‚<br /><code>@babel/node</code> æä¾›äº† <code>babel-node</code> å‘½ä»¤ï¼Œä½†æ˜¯ <code>@babel/node</code> æ›´é€‚åˆå…¨å±€å®‰è£…ï¼Œä¸é€‚åˆå®‰è£…åœ¨é¡¹ç›®é‡Œã€‚<br /></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev @babel/core @babel/cli</span><br></pre></td></tr></table></figure>

<p><br />ç°åœ¨ä½ å°±å¯ä»¥åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ <code>babel</code> è¿›è¡Œç¼–è¯‘å•¦ï¼ˆå¦‚æœä¸å®‰è£… <code>@babel/core</code>ï¼Œä¼šæŠ¥é”™å™¢ï¼‰<br />å°†å‘½ä»¤é…ç½®åœ¨ <code>package.json</code> æ–‡ä»¶çš„ <code>scripts</code> å­—æ®µä¸­:<br /></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;compiler&quot;</span>: <span class="string">&quot;babel src --out-dir lib --watch&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><br />ä½¿ç”¨ <code>npm run compiler</code> æ¥æ‰§è¡Œç¼–è¯‘ï¼Œç°åœ¨æˆ‘ä»¬æ²¡æœ‰é…ç½®ä»»ä½•æ’ä»¶ï¼Œç¼–è¯‘å‰åçš„ä»£ç æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚<br />å› ä¸º <code>Babel</code> è™½ç„¶å¼€ç®±å³ç”¨ï¼Œä½†æ˜¯ä»€ä¹ˆåŠ¨ä½œä¹Ÿä¸åšï¼Œå¦‚æœæƒ³è¦ <code>Babel</code> åšä¸€äº›å®é™…çš„å·¥ä½œï¼Œå°±éœ€è¦ä¸ºå…¶æ·»åŠ æ’ä»¶(<code>plugin</code>)ã€‚<br><a name="WRy33"></a></p>
<h3 id="æ’ä»¶"><a href="#æ’ä»¶" class="headerlink" title="æ’ä»¶"></a>æ’ä»¶</h3><p><code>Babel</code> æ„å»ºåœ¨æ’ä»¶ä¹‹ä¸Šï¼Œä½¿ç”¨ç°æœ‰çš„æˆ–è€…è‡ªå·±ç¼–å†™çš„æ’ä»¶å¯ä»¥ç»„æˆä¸€ä¸ªè½¬æ¢é€šé“ï¼Œ<code>Babel</code> çš„æ’ä»¶åˆ†ä¸ºä¸¤ç§: è¯­æ³•æ’ä»¶å’Œè½¬æ¢æ’ä»¶ã€‚<br /></p>
<blockquote>
<p>è¯­æ³•æ’ä»¶</p>
</blockquote>
<p><br />è¿™äº›æ’ä»¶åªå…è®¸ <code>Babel</code> <strong>è§£æï¼ˆparseï¼‰</strong> ç‰¹å®šç±»å‹çš„è¯­æ³•ï¼ˆä¸æ˜¯è½¬æ¢ï¼‰ï¼Œå¯ä»¥åœ¨ <code>AST</code> è½¬æ¢æ—¶ä½¿ç”¨ï¼Œä»¥æ”¯æŒè§£ææ–°è¯­æ³•ï¼Œä¾‹å¦‚ï¼š<br /></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> babel <span class="keyword">from</span> <span class="string">&quot;@babel/core&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> code = babel.transformFromAstSync(ast, &#123;</span><br><span class="line">    <span class="comment">//æ”¯æŒå¯é€‰é“¾</span></span><br><span class="line">    <span class="attr">plugins</span>: [<span class="string">&quot;@babel/plugin-proposal-optional-chaining&quot;</span>],</span><br><span class="line">    <span class="attr">babelrc</span>: <span class="literal">false</span></span><br><span class="line">&#125;).code;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è½¬æ¢æ’ä»¶</p>
</blockquote>
<p>è½¬æ¢æ’ä»¶ä¼šå¯ç”¨ç›¸åº”çš„è¯­æ³•æ’ä»¶(å› æ­¤ä¸éœ€è¦åŒæ—¶æŒ‡å®šè¿™ä¸¤ç§æ’ä»¶)ï¼Œè¿™ç‚¹å¾ˆå®¹æ˜“ç†è§£ï¼Œå¦‚æœä¸å¯ç”¨ç›¸åº”çš„è¯­æ³•æ’ä»¶ï¼Œæ„å‘³ç€æ— æ³•è§£æï¼Œè¿è§£æéƒ½ä¸èƒ½è§£æï¼Œåˆä½•è°ˆè½¬æ¢å‘¢ï¼Ÿ<br><a name="AQ3WX"></a></p>
<h4 id="æ’ä»¶çš„ä½¿ç”¨"><a href="#æ’ä»¶çš„ä½¿ç”¨" class="headerlink" title="æ’ä»¶çš„ä½¿ç”¨"></a>æ’ä»¶çš„ä½¿ç”¨</h4><p>å¦‚æœæ’ä»¶å‘å¸ƒåœ¨ <code>npm</code> ä¸Šï¼Œå¯ä»¥ç›´æ¥å¡«å†™æ’ä»¶çš„åç§°ï¼Œ <code>Babel</code> ä¼šè‡ªåŠ¨æ£€æŸ¥å®ƒæ˜¯å¦å·²ç»è¢«å®‰è£…åœ¨ <code>node_modules</code> ç›®å½•ä¸‹ï¼Œåœ¨é¡¹ç›®ç›®å½•ä¸‹æ–°å»º <code>.babelrc</code> æ–‡ä»¶ (ä¸‹æ–‡ä¼šå…·ä½“ä»‹ç»é…ç½®æ–‡ä»¶)ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//.babelrc</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;plugins&quot;</span>: [<span class="string">&quot;@babel/plugin-transform-arrow-functions&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><br />ä¹Ÿå¯ä»¥æŒ‡å®šæ’ä»¶çš„ç›¸å¯¹/ç»å¯¹è·¯å¾„<br /></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;plugins&quot;</span>: [<span class="string">&quot;./node_modules/@babel/plugin-transform-arrow-functions&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><br />æ‰§è¡Œ <code>npm run compiler</code>ï¼Œå¯ä»¥çœ‹åˆ°ç®­å¤´å‡½æ•°å·²ç»è¢«ç¼–è¯‘OKï¼Œ <code>lib/index.js</code> å†…å®¹å¦‚ä¸‹:<br /></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fn = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬ä»…æ”¯æŒè½¬æ¢ç®­å¤´å‡½æ•°ï¼Œå¦‚æœæƒ³å°†å…¶å®ƒçš„æ–°çš„JSç‰¹æ€§è½¬æ¢æˆä½ç‰ˆæœ¬ï¼Œéœ€è¦ä½¿ç”¨å…¶å®ƒå¯¹åº”çš„ <code>plugin</code> ã€‚å¦‚æœæˆ‘ä»¬ä¸€ä¸ªä¸ªé…ç½®çš„è¯ï¼Œä¼šéå¸¸ç¹çï¼Œå› ä¸ºä½ å¯èƒ½éœ€è¦é…ç½®å‡ åä¸ªæ’ä»¶ï¼Œè¿™æ˜¾ç„¶éå¸¸ä¸ä¾¿ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥ç®€åŒ–è¿™ä¸ªé…ç½®å‘¢ï¼Ÿ<br />æœ‰ï¼é¢„è®¾ï¼(æ„Ÿè°¢å¼ºå¤§çš„ <code>Babel</code>)<br /><img src="https://cdn.nlark.com/yuque/0/2020/webp/186051/1585576545113-2af624c5-4388-470e-a4ab-4e2ee545a29a.webp#align=left&display=inline&height=260&originHeight=260&originWidth=250&size=0&status=done&style=none&width=250"><br><a name="lQ9Nw"></a></p>
<h3 id="é¢„è®¾"><a href="#é¢„è®¾" class="headerlink" title="é¢„è®¾"></a>é¢„è®¾</h3><p>é€šè¿‡ä½¿ç”¨æˆ–åˆ›å»ºä¸€ä¸ª <code>preset</code> å³å¯<strong>è½»æ¾</strong>ä½¿ç”¨ä¸€ç»„æ’ä»¶ã€‚</p>
<blockquote>
<p>å®˜æ–¹ Preset</p>
</blockquote>
<ul>
<li>@babel/preset-env</li>
<li>@babel/preset-flow</li>
<li>@babel/preset-react</li>
<li>@babel/preset-typescript</li>
</ul>
<p><strong>æ³¨:</strong> ä» Babel v7 å¼€å§‹ï¼Œæ‰€æœ‰é’ˆå¯¹æ ‡å‡†ææ¡ˆé˜¶æ®µçš„åŠŸèƒ½æ‰€ç¼–å†™çš„é¢„è®¾(stage preset)éƒ½å·²è¢«å¼ƒç”¨ï¼Œå®˜æ–¹å·²ç»ç§»é™¤äº† <code>@babel/preset-stage-x</code>ã€‚<br><a name="0KCWe"></a></p>
<h4 id="babel-preset-env"><a href="#babel-preset-env" class="headerlink" title="@babel/preset-env"></a>@babel/preset-env</h4><p><code>@babel/preset-env</code> ä¸»è¦ä½œç”¨æ˜¯å¯¹æˆ‘ä»¬æ‰€ä½¿ç”¨çš„å¹¶ä¸”ç›®æ ‡æµè§ˆå™¨ä¸­ç¼ºå¤±çš„åŠŸèƒ½è¿›è¡Œä»£ç è½¬æ¢å’ŒåŠ è½½ <code>polyfill</code>ï¼Œåœ¨ä¸è¿›è¡Œä»»ä½•é…ç½®çš„æƒ…å†µä¸‹ï¼Œ<code>@babel/preset-env</code> æ‰€åŒ…å«çš„æ’ä»¶å°†æ”¯æŒæ‰€æœ‰æœ€æ–°çš„JSç‰¹æ€§(ES2015,ES2016ç­‰ï¼Œä¸åŒ…å« stage é˜¶æ®µ)ï¼Œå°†å…¶è½¬æ¢æˆES5ä»£ç ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ çš„ä»£ç ä¸­ä½¿ç”¨äº†å¯é€‰é“¾(ç›®å‰ï¼Œä»åœ¨ stage é˜¶æ®µ)ï¼Œé‚£ä¹ˆåªé…ç½® <code>@babel/preset-env</code>ï¼Œè½¬æ¢æ—¶ä¼šæŠ›å‡ºé”™è¯¯ï¼Œéœ€è¦å¦å¤–å®‰è£…ç›¸åº”çš„æ’ä»¶ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//.babelrc</span><br><span class="line">&#123;</span><br><span class="line">    &quot;presets&quot;: [&quot;@babel/preset-env&quot;]</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œ<code>@babel/preset-env</code> ä¼šæ ¹æ®ä½ é…ç½®çš„ç›®æ ‡ç¯å¢ƒï¼Œç”Ÿæˆæ’ä»¶åˆ—è¡¨æ¥ç¼–è¯‘ã€‚å¯¹äºåŸºäºæµè§ˆå™¨æˆ– <code>Electron</code> çš„é¡¹ç›®ï¼Œå®˜æ–¹æ¨èä½¿ç”¨ <code>.browserslistrc</code> æ–‡ä»¶æ¥æŒ‡å®šç›®æ ‡ç¯å¢ƒã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœä½ æ²¡æœ‰åœ¨ <code>Babel</code> é…ç½®æ–‡ä»¶ä¸­(å¦‚ .babelrc)è®¾ç½® <code>targets</code> æˆ– <code>ignoreBrowserslistConfig</code>ï¼Œ<code>@babel/preset-env</code> ä¼šä½¿ç”¨ <code>browserslist</code> é…ç½®æºã€‚<br />å¦‚æœä½ ä¸æ˜¯è¦å…¼å®¹æ‰€æœ‰çš„æµè§ˆå™¨å’Œç¯å¢ƒï¼Œæ¨èä½ æŒ‡å®šç›®æ ‡ç¯å¢ƒï¼Œè¿™æ ·ä½ çš„ç¼–è¯‘ä»£ç èƒ½å¤Ÿä¿æŒæœ€å°ã€‚<br />ä¾‹å¦‚ï¼Œä»…åŒ…æ‹¬æµè§ˆå™¨å¸‚åœºä»½é¢è¶…è¿‡0.25ï¼…çš„ç”¨æˆ·æ‰€éœ€çš„ <code>polyfill</code> å’Œä»£ç è½¬æ¢ï¼ˆå¿½ç•¥æ²¡æœ‰å®‰å…¨æ›´æ–°çš„æµè§ˆå™¨ï¼Œå¦‚ IE10 å’Œ BlackBerryï¼‰:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//.browserslistrc</span><br><span class="line">&gt; 0.25%</span><br><span class="line">not dead</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹ <a target="_blank" rel="noopener" href="https://github.com/browserslist/browserslist"><code>browserslist</code> çš„æ›´å¤šé…ç½®</a><br />ä¾‹å¦‚ï¼Œä½ å°† <code>.browserslistrc</code> çš„å†…å®¹é…ç½®ä¸º:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">last 2 Chrome versions</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>ç„¶åå†æ‰§è¡Œ <code>npm run compiler</code>ï¼Œä½ ä¼šå‘ç°ç®­å¤´å‡½æ•°ä¸ä¼šè¢«ç¼–è¯‘æˆES5ï¼Œå› ä¸º <code>chrome</code> çš„æœ€æ–°2ä¸ªç‰ˆæœ¬éƒ½èƒ½å¤Ÿæ”¯æŒç®­å¤´å‡½æ•°ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°† <code>.browserslistrc</code> ä»ç„¶æ¢æˆä¹‹å‰çš„é…ç½®ã€‚<br />å°±å’±ä»¬ç›®å‰çš„ä»£ç æ¥è¯´ï¼Œå½“å‰çš„é…ç½®ä¼¼ä¹å·²ç»æ˜¯OKçš„äº†ã€‚<br /><img src="https://cdn.nlark.com/yuque/0/2020/jpeg/186051/1585576545153-848f1a8d-ad56-4ec3-a9df-383b6de5f33a.jpeg#align=left&display=inline&height=245&originHeight=245&originWidth=316&size=0&status=done&style=none&width=316"><br />æˆ‘ä»¬ä¿®æ”¹ä¸‹ <code>src/index.js</code>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const isHas = [1,2,3].includes(2);</span><br><span class="line">const p = new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">    resolve(100);</span><br><span class="line">&#125;);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>ç¼–è¯‘å‡ºæ¥çš„ç»“æœä¸º:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&quot;use strict&quot;;</span><br><span class="line">var isHas = [1, 2, 3].includes(2);</span><br><span class="line">var p = new Promise(function (resolve, reject) &#123;</span><br><span class="line">  resolve(100);</span><br><span class="line">&#125;);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªç¼–è¯‘å‡ºæ¥çš„ä»£ç åœ¨ä½ç‰ˆæœ¬æµè§ˆå™¨ä¸­ä½¿ç”¨çš„è¯ï¼Œæ˜¾ç„¶æ˜¯æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºä½ç‰ˆæœ¬æµè§ˆå™¨ä¸­æ•°ç»„å®ä¾‹ä¸Šæ²¡æœ‰ <code>includes</code> æ–¹æ³•ï¼Œä¹Ÿæ²¡æœ‰ <code>Promise</code> æ„é€ å‡½æ•°ã€‚<br />è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºè¯­æ³•è½¬æ¢åªæ˜¯å°†é«˜ç‰ˆæœ¬çš„è¯­æ³•è½¬æ¢æˆä½ç‰ˆæœ¬çš„ï¼Œä½†æ˜¯æ–°çš„å†…ç½®å‡½æ•°ã€å®ä¾‹æ–¹æ³•æ— æ³•è½¬æ¢ã€‚è¿™æ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨ <code>polyfill</code> ä¸Šåœºäº†ï¼Œé¡¾åæ€ä¹‰ï¼Œ<code>polyfill</code>çš„ä¸­æ–‡æ„æ€æ˜¯å«ç‰‡ï¼Œæ‰€è°“å«ç‰‡å°±æ˜¯å«å¹³ä¸åŒæµè§ˆå™¨æˆ–è€…ä¸åŒç¯å¢ƒä¸‹çš„å·®å¼‚ï¼Œè®©æ–°çš„å†…ç½®å‡½æ•°ã€å®ä¾‹æ–¹æ³•ç­‰åœ¨ä½ç‰ˆæœ¬æµè§ˆå™¨ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚<br /><img src="https://cdn.nlark.com/yuque/0/2020/webp/186051/1585576545151-8518e5ef-31ad-47fc-91ae-812c51e02256.webp#align=left&display=inline&height=301&originHeight=301&originWidth=300&size=0&status=done&style=none&width=300"><br><a name="i3hpv"></a></p>
<h3 id="Polyfill"><a href="#Polyfill" class="headerlink" title="Polyfill"></a>Polyfill</h3><p><code>@babel/polyfill</code> æ¨¡å—åŒ…æ‹¬ <code>core-js</code> å’Œä¸€ä¸ªè‡ªå®šä¹‰çš„ <code>regenerator runtime</code> æ¨¡å—ï¼Œå¯ä»¥æ¨¡æ‹Ÿå®Œæ•´çš„ ES2015+ ç¯å¢ƒï¼ˆä¸åŒ…å«ç¬¬4é˜¶æ®µå‰çš„æè®®ï¼‰ã€‚<br />è¿™æ„å‘³ç€å¯ä»¥ä½¿ç”¨è¯¸å¦‚ <code>Promise</code> å’Œ <code>WeakMap</code> ä¹‹ç±»çš„æ–°çš„å†…ç½®ç»„ä»¶ã€ <code>Array.from</code> æˆ– <code>Object.assign</code> ä¹‹ç±»çš„é™æ€æ–¹æ³•ã€<code>Array.prototype.includes</code> ä¹‹ç±»çš„å®ä¾‹æ–¹æ³•ä»¥åŠç”Ÿæˆå™¨å‡½æ•°(å‰ææ˜¯ä½¿ç”¨äº† <code>@babel/plugin-transform-regenerator</code> æ’ä»¶)ã€‚ä¸ºäº†æ·»åŠ è¿™äº›åŠŸèƒ½ï¼Œ<code>polyfill</code> å°†æ·»åŠ åˆ°å…¨å±€èŒƒå›´å’Œç±»ä¼¼ <code>String</code> è¿™æ ·çš„å†…ç½®åŸå‹ä¸­(ä¼šå¯¹å…¨å±€ç¯å¢ƒé€ æˆæ±¡æŸ“ï¼Œåé¢æˆ‘ä»¬ä¼šä»‹ç»ä¸æ±¡æŸ“å…¨å±€ç¯å¢ƒçš„æ–¹æ³•)ã€‚<br /><strong>è¡¥å……è¯´æ˜ (2020/01/07)ï¼š</strong>V7.4.0 ç‰ˆæœ¬å¼€å§‹ï¼Œ<code>@babel/polyfill</code> å·²ç»è¢«åºŸå¼ƒ(å‰ç«¯å‘å±•æ—¥æ–°æœˆå¼‚)ï¼Œéœ€å•ç‹¬å®‰è£… <code>core-js</code> å’Œ <code>regenerator-runtime</code> æ¨¡å—ã€‚<br />é¦–å…ˆï¼Œå®‰è£… <code>@babel/polyfill</code> ä¾èµ–:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install --save @babel/polyfill</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šä¸ä½¿ç”¨ <code>--save-dev</code>ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªéœ€è¦åœ¨æºç ä¹‹å‰è¿è¡Œçš„å«ç‰‡ã€‚<br />æˆ‘ä»¬éœ€è¦å°†å®Œæ•´çš„ <code>polyfill</code> åœ¨ä»£ç ä¹‹å‰åŠ è½½ï¼Œä¿®æ”¹æˆ‘ä»¬çš„ <code>src/index.js</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import &#x27;@babel/polyfill&#x27;;</span><br><span class="line">const isHas = [1,2,3].includes(2);</span><br><span class="line">const p = new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">    resolve(100);</span><br><span class="line">&#125;);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p><code>@babel/polyfill</code> éœ€è¦åœ¨å…¶å®ƒä»£ç ä¹‹å‰å¼•å…¥ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ <code>webpack</code> ä¸­è¿›è¡Œé…ç½®ã€‚<br />ä¾‹å¦‚:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">entry: [</span><br><span class="line">    require.resolve(&#x27;./polyfills&#x27;),</span><br><span class="line">    path.resolve(&#x27;./index&#x27;)</span><br><span class="line">]</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p><code>polyfills.js</code> æ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//å½“ç„¶ï¼Œè¿˜å¯èƒ½æœ‰ä¸€äº›å…¶å®ƒçš„ polyfillï¼Œä¾‹å¦‚ stage 4ä¹‹å‰çš„ä¸€äº› polyfill</span><br><span class="line">import &#x27;@babel/polyfill&#x27;;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬çš„ä»£ç ä¸ç®¡åœ¨ä½ç‰ˆæœ¬è¿˜æ˜¯é«˜ç‰ˆæœ¬æµè§ˆå™¨(æˆ–nodeç¯å¢ƒ)ä¸­éƒ½èƒ½æ­£å¸¸è¿è¡Œäº†ã€‚ä¸è¿‡ï¼Œå¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬æœªå¿…éœ€è¦å®Œæ•´çš„ <code>@babel/polyfill</code>ï¼Œè¿™ä¼šå¯¼è‡´æˆ‘ä»¬æœ€ç»ˆæ„å»ºå‡ºçš„åŒ…çš„ä½“ç§¯å¢å¤§ï¼Œ<code>@babel/polyfill</code>çš„åŒ…å¤§å°ä¸º89K (å½“å‰ <code>@babel/polyfill</code> ç‰ˆæœ¬ä¸º 7.7.0)ã€‚<br />æˆ‘ä»¬æ›´æœŸæœ›çš„æ˜¯ï¼Œå¦‚æœæˆ‘ä½¿ç”¨äº†æŸä¸ªæ–°ç‰¹æ€§ï¼Œå†å¼•å…¥å¯¹åº”çš„ <code>polyfill</code>ï¼Œé¿å…å¼•å…¥æ— ç”¨çš„ä»£ç ã€‚<br />å€¼å¾—åº†å¹¸çš„æ˜¯ï¼Œ <code>Babel</code> å·²ç»è€ƒè™‘åˆ°äº†è¿™ä¸€ç‚¹ã€‚<br /><img src="https://cdn.nlark.com/yuque/0/2020/jpeg/186051/1585576545130-83449582-6602-48c3-b141-a8e88ec06001.jpeg#align=left&display=inline&height=255&originHeight=255&originWidth=255&size=0&status=done&style=none&width=255"><br /><code>@babel/preset-env</code> æä¾›äº†ä¸€ä¸ª <code>useBuiltIns</code> å‚æ•°ï¼Œè®¾ç½®å€¼ä¸º <code>usage</code> æ—¶ï¼Œå°±åªä¼šåŒ…å«ä»£ç éœ€è¦çš„ <code>polyfill</code> ã€‚æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼šé…ç½®æ­¤å‚æ•°çš„å€¼ä¸º <code>usage</code> ï¼Œå¿…é¡»è¦åŒæ—¶è®¾ç½® <code>corejs</code> (å¦‚æœä¸è®¾ç½®ï¼Œä¼šç»™å‡ºè­¦å‘Šï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯â€corejsâ€: 2) ï¼Œæ³¨æ„: è¿™é‡Œä»ç„¶éœ€è¦å®‰è£… <code>@babel/polyfill</code>(å½“å‰ <code>@babel/polyfill</code> ç‰ˆæœ¬é»˜è®¤ä¼šå®‰è£… â€œcorejsâ€: 2):<br />é¦–å…ˆè¯´ä¸€ä¸‹ä½¿ç”¨ <code>core-js@3</code> çš„åŸå› ï¼Œ<code>core-js@2</code> åˆ†æ”¯ä¸­å·²ç»ä¸ä¼šå†æ·»åŠ æ–°ç‰¹æ€§ï¼Œæ–°ç‰¹æ€§éƒ½ä¼šæ·»åŠ åˆ° <code>core-js@3</code>ã€‚ä¾‹å¦‚ä½ ä½¿ç”¨äº† <code>Array.prototype.flat()</code>ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯ <code>core-js@2</code>ï¼Œé‚£ä¹ˆå…¶ä¸åŒ…å«æ­¤æ–°ç‰¹æ€§ã€‚ä¸ºäº†å¯ä»¥ä½¿ç”¨æ›´å¤šçš„æ–°ç‰¹æ€§ï¼Œå»ºè®®å¤§å®¶ä½¿ç”¨ <code>core-js@3</code>ã€‚<br />å®‰è£…ä¾èµ–ä¾èµ–ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install --save core-js@3</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/zloirock/core-js">core-js (ç‚¹å‡»äº†è§£æ›´å¤š)</a> : JavaScript çš„æ¨¡å—åŒ–æ ‡å‡†åº“ï¼ŒåŒ…å« <code>Promise</code>ã€<code>Symbol</code>ã€<code>Iterator</code>å’Œè®¸å¤šå…¶ä»–çš„ç‰¹æ€§ï¼Œå®ƒå¯ä»¥è®©ä½ ä»…åŠ è½½å¿…éœ€çš„åŠŸèƒ½ã€‚</p>
</blockquote>
<p>ç°åœ¨ï¼Œä¿®æ”¹ <code>Babel</code> çš„é…ç½®æ–‡ä»¶å¦‚ä¸‹:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//.babelrc</span><br><span class="line">const presets = [</span><br><span class="line">    [</span><br><span class="line">        &quot;@babel/env&quot;,</span><br><span class="line">        &#123;   </span><br><span class="line">            &quot;useBuiltIns&quot;: &quot;usage&quot;,</span><br><span class="line">            &quot;corejs&quot;: 3</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">]</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p><code>Babel</code> ä¼šæ£€æŸ¥æ‰€æœ‰ä»£ç ï¼Œä»¥ä¾¿æŸ¥æ‰¾åœ¨ç›®æ ‡ç¯å¢ƒä¸­ç¼ºå¤±çš„åŠŸèƒ½ï¼Œç„¶åä»…ä»…æŠŠéœ€è¦çš„ <code>polyfill</code> åŒ…å«è¿›æ¥ã€‚<br />ä¾‹å¦‚ï¼Œ<code>src/index.js</code> ä»£ç ä¸å˜ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const isHas = [1,2,3].includes(2);</span><br><span class="line">const p = new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">    resolve(100);</span><br><span class="line">&#125;);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çœ‹çœ‹ç¼–è¯‘å‡ºæ¥çš„æ–‡ä»¶(<code>lib/index</code>):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&quot;use strict&quot;;</span><br><span class="line">require(&quot;core-js/modules/es.array.includes&quot;);</span><br><span class="line">require(&quot;core-js/modules/es.object.to-string&quot;);</span><br><span class="line">require(&quot;core-js/modules/es.promise&quot;);</span><br><span class="line">var isHas = [1, 2, 3].includes(2);</span><br><span class="line">var p = new Promise(function (resolve, reject) &#123;</span><br><span class="line">    resolve(100);</span><br><span class="line">&#125;);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>åŒæ ·çš„ä»£ç ï¼Œæˆ‘ä»¬ç”¨ <code>webpack</code> æ„å»ºä¸€ä¸‹(<code>production</code> æ¨¡å¼)ï¼Œèƒ½çœ‹åˆ°æœ€ç»ˆçš„ä»£ç å¤§å°ä»…ä¸º: 20KBã€‚è€Œå¦‚æœæˆ‘ä»¬å¼•å…¥æ•´ä¸ª <code>@babel/polyfill</code> çš„è¯ï¼Œæ„å»ºå‡ºçš„åŒ…å¤§å°ä¸ºï¼š89KB<br />å‰é¢æ›¾æåˆ°ï¼Œåœ¨ <code>useBuiltIns</code> å‚æ•°å€¼ä¸º <code>usage</code> æ—¶ï¼Œä»ç„¶éœ€è¦å®‰è£… <code>@babel/polyfill</code>ï¼Œè™½ç„¶æˆ‘ä»¬ä¸Šé¢çš„ä»£ç è½¬æ¢ä¸­çœ‹èµ·æ¥å¹¶æ²¡æœ‰ä½¿ç”¨åˆ°ï¼Œä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æºç ä¸­ä½¿ç”¨åˆ°äº† <code>async/await</code>ï¼Œé‚£ä¹ˆç¼–è¯‘å‡ºæ¥çš„ä»£ç éœ€è¦ <code>require(&quot;regenerator-runtime/runtime&quot;)</code>ï¼Œåœ¨ <code>@babel/polyfill</code> çš„ä¾èµ–ä¸­ï¼Œå½“ç„¶å•¦ï¼Œä½ ä¹Ÿå¯ä»¥åªå®‰è£… <code>regenerator-runtime/runtime</code> å–ä»£å®‰è£… <code>@babel/polyfill</code>ã€‚<br />åˆ°äº†è¿™ä¸€æ­¥ï¼Œå·²ç»å¾ˆæ£’æ£’äº†ï¼Œæ˜¯ä¸æ˜¯æƒ³è·³èµ·æ¥è½¬ä¸ªåœˆåœˆï¼Ÿ<br /><img src="https://cdn.nlark.com/yuque/0/2020/gif/186051/1585576545283-9cb5b8df-7d37-4cea-92ad-1afdad005035.gif#align=left&display=inline&height=232&originHeight=232&originWidth=188&size=0&status=done&style=none&width=188"><br />ä¸‹é¢æˆ‘è¦è¯´çš„å†…å®¹ï¼Œä¹Ÿè®¸ä½ å·²ç»çŸ¥é“ï¼Œä¹Ÿè®¸ä½ è¿˜ä¸çŸ¥é“ï¼Œè¿™éƒ½ä¸é‡è¦ï¼Œä½†æ˜¯æ­¤åˆ»èµ·ï¼Œä½ è¦çŸ¥é“äº†: <code>Babel</code> ä¼šä½¿ç”¨å¾ˆå°çš„è¾…åŠ©å‡½æ•°æ¥å®ç°ç±»ä¼¼ <code>_createClass</code> ç­‰å…¬å…±æ–¹æ³•ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒå°†è¢«æ·»åŠ (<code>inject</code>)åˆ°éœ€è¦å®ƒçš„æ¯ä¸ªæ–‡ä»¶ä¸­ã€‚<br />å‡å¦‚ï¼Œæˆ‘ä»¬çš„ <code>src/index.js</code> æ˜¯è¿™æ ·çš„:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class Point &#123;</span><br><span class="line">    constructor(x, y) &#123;</span><br><span class="line">        this.x = x;</span><br><span class="line">        this.y = y;</span><br><span class="line">    &#125;;</span><br><span class="line">    getX() &#123;</span><br><span class="line">        return this.x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">let cp = new ColorPoint(25, 8);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>ç¼–è¯‘å‡ºæ¥çš„ <code>lib/index.js</code>ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&quot;use strict&quot;;</span><br><span class="line">require(&quot;core-js/modules/es.object.define-property&quot;);</span><br><span class="line">function _classCallCheck(instance, Constructor) &#123; if (!(instance instanceof Constructor)) &#123; throw new TypeError(&quot;Cannot call a class as a function&quot;); &#125; &#125;</span><br><span class="line">function _defineProperties(target, props) &#123; for (var i = 0; i &lt; props.length; i++) &#123; var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (&quot;value&quot; in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); &#125; &#125;</span><br><span class="line">function _createClass(Constructor, protoProps, staticProps) &#123; if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; &#125;</span><br><span class="line">var Point =</span><br><span class="line">    /*#__PURE__*/</span><br><span class="line">    function () &#123;</span><br><span class="line">        function Point(x, y) &#123;</span><br><span class="line">            _classCallCheck(this, Point);</span><br><span class="line">            this.x = x;</span><br><span class="line">            this.y = y;</span><br><span class="line">        &#125;</span><br><span class="line">        _createClass(Point, [&#123;</span><br><span class="line">            key: &quot;getX&quot;,</span><br><span class="line">            value: function getX() &#123;</span><br><span class="line">                return this.x;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;]);</span><br><span class="line">        return Point;</span><br><span class="line">    &#125;();</span><br><span class="line">var cp = new ColorPoint(25, 8);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>çœ‹èµ·æ¥ï¼Œä¼¼ä¹å¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯ä½ æƒ³ä¸€ä¸‹ï¼Œå¦‚æœä½ æœ‰10ä¸ªæ–‡ä»¶ä¸­éƒ½ä½¿ç”¨äº†è¿™ä¸ª <code>class</code>ï¼Œæ˜¯ä¸æ˜¯æ„å‘³ç€ <code>_classCallCheck</code>ã€<code>_defineProperties</code>ã€<code>_createClass</code> è¿™äº›æ–¹æ³•è¢« <code>inject</code> äº†10æ¬¡ã€‚è¿™æ˜¾ç„¶ä¼šå¯¼è‡´åŒ…ä½“ç§¯å¢å¤§ï¼Œæœ€å…³é”®çš„æ˜¯ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦å®ƒ <code>inject</code> å¤šæ¬¡ã€‚<br />è¿™ä¸ªæ—¶å€™ï¼Œå°±æ˜¯ <code>@babel/plugin-transform-runtime</code> æ’ä»¶å¤§æ˜¾èº«æ‰‹çš„æ—¶å€™äº†ï¼Œä½¿ç”¨ <code>@babel/plugin-transform-runtime</code> æ’ä»¶ï¼Œæ‰€æœ‰å¸®åŠ©ç¨‹åºéƒ½å°†å¼•ç”¨æ¨¡å— <code>@babel/runtime</code>ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…ç¼–è¯‘åçš„ä»£ç ä¸­å‡ºç°é‡å¤çš„å¸®åŠ©ç¨‹åºï¼Œæœ‰æ•ˆå‡å°‘åŒ…ä½“ç§¯ã€‚<br /><img src="https://cdn.nlark.com/yuque/0/2020/jpeg/186051/1585576545179-fbe6fba2-bab7-4b61-8a50-a19bab6d74d5.jpeg#align=left&display=inline&height=300&originHeight=300&originWidth=300&size=0&status=done&style=none&width=300"><br><a name="kGvQm"></a></p>
<h3 id="babel-plugin-transform-runtime"><a href="#babel-plugin-transform-runtime" class="headerlink" title="@babel/plugin-transform-runtime"></a>@babel/plugin-transform-runtime</h3><p><code>@babel/plugin-transform-runtime</code> æ˜¯ä¸€ä¸ªå¯ä»¥é‡å¤ä½¿ç”¨ <code>Babel</code> æ³¨å…¥çš„å¸®åŠ©ç¨‹åºï¼Œä»¥èŠ‚çœä»£ç å¤§å°çš„æ’ä»¶ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šè¯¸å¦‚ <code>Array.prototype.flat()</code> ç­‰å®ä¾‹æ–¹æ³•å°†ä¸èµ·ä½œç”¨ï¼Œå› ä¸ºè¿™éœ€è¦ä¿®æ”¹ç°æœ‰çš„å†…ç½®å‡½æ•°(å¯ä»¥ä½¿ç”¨ <code>@babel/polyfill</code> æ¥è§£å†³è¿™ä¸ªé—®é¢˜) â€”â€”&gt; å¯¹æ­¤éœ€è¦è¯´æ˜çš„æ˜¯å¦‚æœä½ é…ç½®çš„æ˜¯<code>corejs3</code>ï¼Œ <strong><code>core-js@3</code> ç°åœ¨å·²ç»æ”¯æŒåŸå‹æ–¹æ³•ï¼ŒåŒæ—¶ä¸æ±¡æŸ“åŸå‹</strong>ã€‚</p>
</blockquote>
<p>å¦å¤–ï¼Œ<code>@babel/plugin-transform-runtime</code> éœ€è¦å’Œ <code>@babel/runtime</code> é…åˆä½¿ç”¨ã€‚<br />é¦–å…ˆå®‰è£…ä¾èµ–ï¼Œ<code>@babel/plugin-transform-runtime</code> é€šå¸¸ä»…åœ¨å¼€å‘æ—¶ä½¿ç”¨ï¼Œä½†æ˜¯è¿è¡Œæ—¶æœ€ç»ˆä»£ç éœ€è¦ä¾èµ– <code>@babel/runtime</code>ï¼Œæ‰€ä»¥ <code>@babel/runtime</code> å¿…é¡»è¦ä½œä¸ºç”Ÿäº§ä¾èµ–è¢«å®‰è£…ï¼Œå¦‚ä¸‹ :</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev @babel/plugin-transform-runtime</span><br><span class="line">npm install --save @babel/runtime</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>é™¤äº†å‰æ–‡æ‰€è¯´çš„ï¼Œ<code>@babel/plugin-transform-runtime</code> å¯ä»¥å‡å°‘ç¼–è¯‘åä»£ç çš„ä½“ç§¯å¤–ï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒè¿˜æœ‰ä¸€ä¸ªå¥½å¤„ï¼Œå®ƒå¯ä»¥ä¸ºä»£ç åˆ›å»ºä¸€ä¸ªæ²™ç›’ç¯å¢ƒï¼Œå¦‚æœä½¿ç”¨ <code>@babel/polyfill</code> åŠå…¶æä¾›çš„å†…ç½®ç¨‹åºï¼ˆä¾‹å¦‚ <code>Promise</code> ï¼Œ<code>Set</code> å’Œ <code>Map</code> ï¼‰ï¼Œåˆ™å®ƒä»¬å°†æ±¡æŸ“å…¨å±€èŒƒå›´ã€‚è™½ç„¶è¿™å¯¹äºåº”ç”¨ç¨‹åºæˆ–å‘½ä»¤è¡Œå·¥å…·å¯èƒ½æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯å¦‚æœä½ çš„ä»£ç æ˜¯è¦å‘å¸ƒä¾›ä»–äººä½¿ç”¨çš„åº“ï¼Œæˆ–è€…æ— æ³•å®Œå…¨æ§åˆ¶ä»£ç è¿è¡Œçš„ç¯å¢ƒï¼Œåˆ™å°†æˆä¸ºä¸€ä¸ªé—®é¢˜ã€‚<br /><code>@babel/plugin-transform-runtime</code> ä¼šå°†è¿™äº›å†…ç½®åˆ«åä½œä¸º <code>core-js</code> çš„åˆ«åï¼Œå› æ­¤æ‚¨å¯ä»¥æ— ç¼ä½¿ç”¨å®ƒä»¬ï¼Œè€Œæ— éœ€ <code>polyfill</code>ã€‚<br />ä¿®æ”¹ <code>.babelrc</code> çš„é…ç½®ï¼Œå¦‚ä¸‹:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">//.babelrc</span><br><span class="line">&#123;</span><br><span class="line">    &quot;presets&quot;: [</span><br><span class="line">        [</span><br><span class="line">            &quot;@babel/preset-env&quot;,</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;useBuiltIns&quot;: &quot;usage&quot;,</span><br><span class="line">                &quot;corejs&quot;: 3</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    ],</span><br><span class="line">    &quot;plugins&quot;: [</span><br><span class="line">        [</span><br><span class="line">            &quot;@babel/plugin-transform-runtime&quot;</span><br><span class="line">        ]</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>é‡æ–°ç¼–è¯‘ <code>npm run compiler</code> , ç°åœ¨ï¼Œç¼–è¯‘å‡ºæ¥çš„å†…å®¹ä¸º(<code>lib/index.js</code>):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&quot;use strict&quot;;</span><br><span class="line">var _interopRequireDefault = require(&quot;@babel/runtime/helpers/interopRequireDefault&quot;);</span><br><span class="line">var _classCallCheck2 = _interopRequireDefault(require(&quot;@babel/runtime/helpers/classCallCheck&quot;));</span><br><span class="line">var _createClass2 = _interopRequireDefault(require(&quot;@babel/runtime/helpers/createClass&quot;));</span><br><span class="line">var Point =</span><br><span class="line">    /*#__PURE__*/</span><br><span class="line">    function () &#123;</span><br><span class="line">        function Point(x, y) &#123;</span><br><span class="line">            (0, _classCallCheck2.default)(this, Point);</span><br><span class="line">            this.x = x;</span><br><span class="line">            this.y = y;</span><br><span class="line">        &#125;</span><br><span class="line">        (0, _createClass2.default)(Point, [&#123;</span><br><span class="line">            key: &quot;getX&quot;,</span><br><span class="line">            value: function getX() &#123;</span><br><span class="line">                return this.x;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;]);</span><br><span class="line">        return Point;</span><br><span class="line">    &#125;();</span><br><span class="line">var cp = new ColorPoint(25, 8);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹å‡ºï¼Œå¸®åŠ©å‡½æ•°ç°åœ¨ä¸æ˜¯ç›´æ¥è¢« <code>inject</code> åˆ°ä»£ç ä¸­ï¼Œè€Œæ˜¯ä» <code>@babel/runtime</code> ä¸­å¼•å…¥ã€‚å‰æ–‡è¯´äº†ä½¿ç”¨ <code>@babel/plugin-transform-runtime</code> å¯ä»¥é¿å…å…¨å±€æ±¡æŸ“ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ˜¯å¦‚ä½•é¿å…æ±¡æŸ“çš„ã€‚<br />ä¿®æ”¹ <code>src/index.js</code> å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let isHas = [1,2,3].includes(2);</span><br><span class="line">new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">    resolve(100);</span><br><span class="line">&#125;);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>ç¼–è¯‘å‡ºæ¥çš„ä»£ç å¦‚ä¸‹(<code>lib/index.js</code>):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&quot;use strict&quot;;</span><br><span class="line">require(&quot;core-js/modules/es.array.includes&quot;);</span><br><span class="line">require(&quot;core-js/modules/es.object.to-string&quot;);</span><br><span class="line">require(&quot;core-js/modules/es.promise&quot;);</span><br><span class="line">var isHas = [1, 2, 3].includes(2);</span><br><span class="line">new Promise(function (resolve, reject) &#123;</span><br><span class="line">    resolve(100);</span><br><span class="line">&#125;);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p><code>Array.prototype</code> ä¸Šæ–°å¢äº† <code>includes</code> æ–¹æ³•ï¼Œå¹¶ä¸”æ–°å¢äº†å…¨å±€çš„ <code>Promise</code> æ–¹æ³•ï¼Œæ±¡æŸ“äº†å…¨å±€ç¯å¢ƒï¼Œè¿™è·Ÿä¸ä½¿ç”¨ <code>@babel/plugin-transform-runtime</code> æ²¡æœ‰åŒºåˆ«å˜›ã€‚<br /><img src="https://cdn.nlark.com/yuque/0/2020/jpeg/186051/1585576545179-2c767cc2-48ba-4f1a-8e42-aa3febf5604c.jpeg#align=left&display=inline&height=240&originHeight=240&originWidth=240&size=0&status=done&style=none&width=240"><br />å¦‚æœæˆ‘ä»¬å¸Œæœ› <code>@babel/plugin-transform-runtime</code> ä¸ä»…ä»…å¤„ç†å¸®åŠ©å‡½æ•°ï¼ŒåŒæ—¶ä¹Ÿèƒ½åŠ è½½ <code>polyfill</code> çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦ç»™ <code>@babel/plugin-transform-runtime</code> å¢åŠ é…ç½®ä¿¡æ¯ã€‚<br />é¦–å…ˆæ–°å¢ä¾èµ– <code>@babel/runtime-corejs3</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install @babel/runtime-corejs3 --save</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹é…ç½®æ–‡ä»¶å¦‚ä¸‹(ç§»é™¤äº† <code>@babel/preset-env</code> çš„ <code>useBuiltIns</code> çš„é…ç½®ï¼Œä¸ç„¶ä¸å°±é‡å¤äº†å˜›å˜›å˜›ï¼Œä¸ä¿¡çš„è¯ï¼Œä½ ç”¨ <code>async/await</code> ç¼–è¯‘ä¸‹è¯•è¯•å’¯):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;presets&quot;: [</span><br><span class="line">        [</span><br><span class="line">            &quot;@babel/preset-env&quot;</span><br><span class="line">        ]</span><br><span class="line">    ],</span><br><span class="line">    &quot;plugins&quot;: [</span><br><span class="line">        [</span><br><span class="line">            &quot;@babel/plugin-transform-runtime&quot;,&#123;</span><br><span class="line">                &quot;corejs&quot;: 3</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>ç„¶åé‡æ–°ç¼–è¯‘ï¼Œçœ‹ä¸€ä¸‹ï¼Œç¼–è¯‘å‡ºæ¥çš„ç»“æœ(<code>lib/index.js</code>):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&quot;use strict&quot;;</span><br><span class="line">var _interopRequireDefault = require(&quot;@babel/runtime-corejs3/helpers/interopRequireDefault&quot;);</span><br><span class="line">var _promise = _interopRequireDefault(require(&quot;@babel/runtime-corejs3/core-js-stable/promise&quot;));</span><br><span class="line">var _includes = _interopRequireDefault(require(&quot;@babel/runtime-corejs3/core-js-stable/instance/includes&quot;));</span><br><span class="line">var _context;</span><br><span class="line">var isHas = (0, _includes.default)(_context = [1, 2, 3]).call(_context, 2);</span><br><span class="line">new _promise.default(function (resolve, reject) &#123;</span><br><span class="line">  resolve(100);</span><br><span class="line">&#125;);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹å‡ºï¼Œæ²¡æœ‰ç›´æ¥å»ä¿®æ”¹ <code>Array.prototype</code>ï¼Œæˆ–è€…æ˜¯æ–°å¢ <code>Promise</code> æ–¹æ³•ï¼Œé¿å…äº†å…¨å±€æ±¡æŸ“ã€‚å¦‚æœä¸Šé¢ <code>@babel/plugin-transform-runtime</code> é…ç½®çš„ <code>core-js</code> æ˜¯ â€œ2â€ï¼Œå…¶ä¸­ä¸åŒ…å«å®ä¾‹çš„ <code>polyfill</code> éœ€è¦å•ç‹¬å¼•å…¥ã€‚</p>
<blockquote>
<p>åˆ’é‡ç‚¹ï¼šå¦‚æœæˆ‘ä»¬é…ç½®çš„ <code>corejs</code> æ˜¯ <code>3</code> ç‰ˆæœ¬ï¼Œé‚£ä¹ˆä¸ç®¡æ˜¯å®ä¾‹æ–¹æ³•è¿˜æ˜¯å…¨å±€æ–¹æ³•ï¼Œéƒ½ä¸ä¼šå†æ±¡æŸ“å…¨å±€ç¯å¢ƒã€‚</p>
</blockquote>
<p>çœ‹åˆ°è¿™é‡Œï¼Œä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰è¿™æ ·ä¸€ä¸ªç–‘é—®ï¼Ÿç»™ <code>@babel/plugin-transform-runtime</code> é…ç½® <code>corejs</code> æ˜¯å¦‚æ­¤çš„å®Œç¾ï¼Œæ—¢å¯ä»¥å°†å¸®åŠ©å‡½æ•°å˜æˆå¼•ç”¨çš„å½¢å¼ï¼Œåˆå¯ä»¥åŠ¨æ€å¼•å…¥ <code>polyfill</code>ï¼Œå¹¶ä¸”ä¸ä¼šæ±¡æŸ“å…¨å±€ç¯å¢ƒã€‚ä½•å¿…è¦ç»™ <code>@babel/preset-env</code> æä¾› <code>useBuiltIns</code> åŠŸèƒ½å‘¢ï¼Œçœ‹èµ·æ¥ä¼¼ä¹ä¸éœ€è¦å‘€ã€‚<br />å¸¦ç€è¿™æ ·çš„ç–‘é—®ï¼Œæˆ‘æ–°å»ºäº†å‡ ä¸ªæ–‡ä»¶(å†…å®¹ç®€å•ä¸”åŸºæœ¬ä¸€è‡´ï¼Œä½¿ç”¨äº†äº›æ–°ç‰¹æ€§)ï¼Œç„¶åä½¿ç”¨ <code>webpack</code> æ„å»ºï¼Œä»¥ä¸‹æ˜¯æˆ‘å¯¹æ¯”çš„æ•°æ®:</p>
<table>
<thead>
<tr>
<th align="left">åºå·</th>
<th align="left">.babelrc é…ç½®</th>
<th align="left">webpack mode production</th>
</tr>
</thead>
<tbody><tr>
<td align="left">0</td>
<td align="left">ä¸ä½¿ç”¨ <code>@babel/plugin-transform-runtime</code></td>
<td align="left">36KB</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">ä½¿ç”¨<code>@babel/plugin-transform-runtime</code>ï¼Œå¹¶é…ç½®å‚æ•° <code>corejs</code>: 3ã€‚ä¸ä¼šæ±¡æŸ“å…¨å±€ç¯å¢ƒ</td>
<td align="left">37KB</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">ä½¿ç”¨<code>@babel/plugin-transform-runtime</code>ï¼Œä¸é…ç½® <code>corejs</code></td>
<td align="left">22KB</td>
</tr>
</tbody></table>
<p>æˆ‘çŒœæµ‹æ˜¯ <code>@babel/runtime-corejs3/XXX</code> çš„åŒ…æœ¬èº«æ¯” <code>core-js/modules/XXX</code> è¦å¤§ä¸€äº›~<br /><img src="https://cdn.nlark.com/yuque/0/2020/jpeg/186051/1585576545195-d06e89e4-eee3-4316-8a96-244554496a45.jpeg#align=left&display=inline&height=180&originHeight=180&originWidth=180&size=0&status=done&style=none&width=180"><br><a name="V6jys"></a></p>
<h3 id="æ’ä»¶-é¢„è®¾è¡¥å……çŸ¥è¯†"><a href="#æ’ä»¶-é¢„è®¾è¡¥å……çŸ¥è¯†" class="headerlink" title="æ’ä»¶/é¢„è®¾è¡¥å……çŸ¥è¯†"></a>æ’ä»¶/é¢„è®¾è¡¥å……çŸ¥è¯†</h3><blockquote>
<p><strong>æ’ä»¶çš„æ’åˆ—é¡ºåºå¾ˆé‡è¦ï¼ï¼ï¼</strong></p>
</blockquote>
<p>å¦‚æœä¸¤ä¸ªè½¬æ¢æ’ä»¶éƒ½å°†å¤„ç†â€œç¨‹åºï¼ˆProgramï¼‰â€çš„æŸä¸ªä»£ç ç‰‡æ®µï¼Œåˆ™å°†æ ¹æ®è½¬æ¢æ’ä»¶æˆ– <code>preset</code> çš„æ’åˆ—é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚</p>
<ul>
<li>æ’ä»¶åœ¨ Presets å‰è¿è¡Œã€‚</li>
<li>æ’ä»¶é¡ºåºä»å‰å¾€åæ’åˆ—ã€‚</li>
<li>Preset é¡ºåºæ˜¯é¢ å€’çš„ï¼ˆä»åå¾€å‰ï¼‰ã€‚</li>
</ul>
<p>ä¾‹å¦‚:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;plugins&quot;: [&quot;@babel/plugin-proposal-class-properties&quot;, &quot;@babel/plugin-syntax-dynamic-import&quot;]</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>å…ˆæ‰§è¡Œ <code>@babel/plugin-proposal-class-properties</code>ï¼Œåæ‰§è¡Œ <code>@babel/plugin-syntax-dynamic-import</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;presets&quot;: [&quot;@babel/preset-env&quot;, &quot;@babel/preset-react&quot;]</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p><code>preset</code> çš„æ‰§è¡Œé¡ºåºæ˜¯<strong>é¢ å€’</strong>çš„ï¼Œå…ˆæ‰§è¡Œ <code>@babel/preset-react</code>ï¼Œ åæ‰§è¡Œ <code>@babel/preset-env</code>ã€‚<br><a name="b0nQx"></a></p>
<h4 id="æ’ä»¶å‚æ•°"><a href="#æ’ä»¶å‚æ•°" class="headerlink" title="æ’ä»¶å‚æ•°"></a>æ’ä»¶å‚æ•°</h4><p>æ’ä»¶å’Œ <code>preset</code> éƒ½å¯ä»¥æ¥å—å‚æ•°ï¼Œå‚æ•°ç”±æ’ä»¶åå’Œå‚æ•°å¯¹è±¡ç»„æˆä¸€ä¸ªæ•°ç»„ã€‚<code>preset</code> è®¾ç½®å‚æ•°ä¹Ÿæ˜¯è¿™ç§æ ¼å¼ã€‚<br />å¦‚:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;plugins&quot;: [</span><br><span class="line">        [</span><br><span class="line">            &quot;@babel/plugin-proposal-class-properties&quot;, </span><br><span class="line">            &#123; &quot;loose&quot;: true &#125;</span><br><span class="line">        ]</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p><a name="vpDVE"></a></p>
<h5 id="æ’ä»¶çš„çŸ­åç§°"><a href="#æ’ä»¶çš„çŸ­åç§°" class="headerlink" title="æ’ä»¶çš„çŸ­åç§°"></a>æ’ä»¶çš„çŸ­åç§°</h5><p>å¦‚æœæ’ä»¶åç§°ä¸º <code>@babel/plugin-XXX</code>ï¼Œå¯ä»¥ä½¿ç”¨çŸ­åç§°<code>@babel/XXX</code> :</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;plugins&quot;: [</span><br><span class="line">        &quot;@babel/transform-arrow-functions&quot; //åŒ &quot;@babel/plugin-transform-arrow-functions&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ’ä»¶åç§°ä¸º <code>babel-plugin-XXX</code>ï¼Œå¯ä»¥ä½¿ç”¨çŸ­åç§° <code>XXX</code>ï¼Œè¯¥è§„åˆ™åŒæ ·é€‚ç”¨äºå¸¦æœ‰ <code>scope</code> çš„æ’ä»¶:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;plugins&quot;: [</span><br><span class="line">        &quot;newPlugin&quot;, //åŒ &quot;babel-plugin-newPlugin&quot;</span><br><span class="line">        &quot;@scp/myPlugin&quot; //åŒ &quot;@scp/babel-plugin-myPlugin&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p><a name="vusUk"></a></p>
<h4 id="åˆ›å»º-Preset"><a href="#åˆ›å»º-Preset" class="headerlink" title="åˆ›å»º Preset"></a>åˆ›å»º Preset</h4><blockquote>
<p>å¯ä»¥ç®€å•çš„è¿”å›ä¸€ä¸ªæ’ä»¶æ•°ç»„</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">module.exports = function() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">        plugins: [</span><br><span class="line">            &quot;A&quot;,</span><br><span class="line">            &quot;B&quot;,</span><br><span class="line">            &quot;C&quot;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>preset</code> ä¸­ä¹Ÿå¯ä»¥åŒ…å«å…¶ä»–çš„ <code>preset</code>ï¼Œä»¥åŠå¸¦æœ‰å‚æ•°çš„æ’ä»¶ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">module.exports = function() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">        presets: [</span><br><span class="line">            require(&quot;@babel/preset-env&quot;)</span><br><span class="line">        ],</span><br><span class="line">        plugins: [</span><br><span class="line">            [require(&quot;@babel/plugin-proposal-class-properties&quot;), &#123; loose: true &#125;],</span><br><span class="line">            require(&quot;@babel/plugin-proposal-object-rest-spread&quot;)</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p><a name="SIthI"></a></p>
<h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><p>Babel æ”¯æŒå¤šç§æ ¼å¼çš„é…ç½®æ–‡ä»¶ã€‚è¿™éƒ¨åˆ†å†…å®¹è¡¥å……äº†è§£ä¸‹å³å¯ï¼Œè°ç®¡ä½ ç”¨å“ªç§é…ç½®æ–‡ä»¶ï¼Œåªè¦ä½ çš„é…ç½®æ˜¯OKçš„å°±å¯ä»¥äº†(æ•·è¡)~<br />æ‰€æœ‰çš„ <code>Babel</code> API å‚æ•°éƒ½å¯ä»¥è¢«é…ç½®ï¼Œä½†æ˜¯å¦‚æœè¯¥å‚æ•°éœ€è¦ä½¿ç”¨çš„ JS ä»£ç ï¼Œé‚£ä¹ˆå¯èƒ½éœ€è¦ä½¿ç”¨ JS ä»£ç ç‰ˆçš„é…ç½®æ–‡ä»¶ã€‚</p>
<blockquote>
<p>æ ¹æ®ä½¿ç”¨åœºæ™¯å¯ä»¥é€‰æ‹©ä¸åŒçš„é…ç½®æ–‡ä»¶:</p>
</blockquote>
<p>å¦‚æœå¸Œæœ›ä»¥ç¼–ç¨‹çš„æ–¹å¼åˆ›å»ºé…ç½®æ–‡ä»¶æˆ–è€…å¸Œæœ›ç¼–è¯‘ <code>node_modules</code> ç›®å½•ä¸‹çš„æ¨¡å—ï¼šé‚£ä¹ˆ <code>babel.config.js</code> å¯ä»¥æ»¡è¶³ä½ çš„éœ€æ±‚ã€‚<br />å¦‚æœåªæ˜¯éœ€è¦ä¸€ä¸ªç®€å•çš„å¹¶ä¸”ä¸­ç”¨äºå•ä¸ªè½¯ä»¶åŒ…çš„é…ç½®ï¼šé‚£ä¹ˆ <code>.babelrc</code> å³å¯æ»¡è¶³ä½ çš„éœ€æ±‚ã€‚<br><a name="XAeLF"></a></p>
<h4 id="babel-config-js"><a href="#babel-config-js" class="headerlink" title="babel.config.js"></a>babel.config.js</h4><p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º <code>babel.config.js</code> çš„æ–‡ä»¶ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">module.exports = function(api) &#123;</span><br><span class="line">    api.cache(true);</span><br><span class="line">    const presets = [...];</span><br><span class="line">    const plugins = [...];</span><br><span class="line">    return &#123;</span><br><span class="line">        presets,</span><br><span class="line">        plugins</span><br><span class="line">    &#125;;</span><br><span class="line">&#125; </span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>å…·ä½“çš„é…ç½®å¯ä»¥æŸ¥çœ‹ï¼š<a target="_blank" rel="noopener" href="https://www.babeljs.cn/docs/config-files#project-wide-configuration">babel.config.js æ–‡æ¡£</a><br><a name="otlk1"></a></p>
<h4 id="babelrc"><a href="#babelrc" class="headerlink" title=".babelrc"></a>.babelrc</h4><p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º <code>.babelrc</code> çš„æ–‡ä»¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;presets&quot;: [],</span><br><span class="line">    &quot;plugins&quot;: []</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>å…·ä½“çš„é…ç½®å¯ä»¥å‚è€ƒ <a target="_blank" rel="noopener" href="https://www.babeljs.cn/docs/config-files#file-relative-configuration">.babelrc æ–‡æ¡£ </a><br><a name="bSz1c"></a></p>
<h4 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h4><p>å¯ä»¥å°† <code>.babelrc</code> ä¸­çš„é…ç½®ä¿¡æ¯ä½œä¸º <code>babel</code> é”®(key) æ·»åŠ åˆ° <code>package.json</code> æ–‡ä»¶ä¸­:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;name&quot;: &quot;my-package&quot;,</span><br><span class="line">    &quot;babel&quot;: &#123;</span><br><span class="line">        &quot;presets&quot;: [],</span><br><span class="line">        &quot;plugins&quot;: []</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p><a name="VDxQV"></a></p>
<h4 id="babelrc-js"><a href="#babelrc-js" class="headerlink" title=".babelrc.js"></a>.babelrc.js</h4><p>ä¸ <code>.babelrc</code> é…ç½®ç›¸åŒï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨JSç¼–å†™ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//å¯ä»¥åœ¨å…¶ä¸­è°ƒç”¨ Node.js çš„API</span><br><span class="line">const presets = [];</span><br><span class="line">const plugins = [];</span><br><span class="line">module.exports = &#123; presets, plugins &#125;;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2020/gif/186051/1585576545181-dd51b87f-bc43-413d-815f-858922073cb7.gif#align=left&display=inline&height=300&originHeight=300&originWidth=300&size=0&status=done&style=none&width=300"><br />ä¸çŸ¥é“æ˜¯å¦å…¨é¢ï¼Œä¸è¿‡çœŸçš„å†™ä¸åŠ¨äº†ï¼ˆå¦‚æœ‰ä¸å…¨ï¼Œåç»­å†è¡¥å……ï¼‰<del>å°±é…±</del>å¦‚æœæœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£ã€‚</p>
<blockquote>
<p>å‚è€ƒé“¾æ¥</p>
</blockquote>
<ol>
<li><a target="_blank" rel="noopener" href="https://www.babeljs.cn/docs/">babelæ–‡æ¡£</a><br /></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/cbd48919a0cc">babel 7 çš„ä½¿ç”¨çš„ä¸ªäººç†è§£</a><br /></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5c19c5e0e51d4502a232c1c6">ä¸€å£(å¾ˆé•¿çš„)æ°”äº†è§£ babel</a><br /></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sefaultment/p/11631314.html">core-js@3å¸¦æ¥çš„æƒŠå–œ</a><br /></li>
</ol>
<p><br />ä½œè€…ï¼šåˆ˜å°å¤•<br />é“¾æ¥ï¼š<a target="_blank" rel="noopener" href="https://juejin.im/post/5ddff3abe51d4502d56bd143">https://juejin.im/post/5ddff3abe51d4502d56bd143</a><br />æ¥æºï¼šæ˜é‡‘<br />è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/04/15/202-%E3%80%90Babel%E3%80%91%E4%B8%8D%E5%AE%B9%E9%94%99%E8%BF%87%E7%9A%84Babel7%E7%9F%A5%E8%AF%86/" data-id="ckts3ejyo00n04d9k8nw3ewqd" data-title="202-ã€Babelã€‘ä¸å®¹é”™è¿‡çš„Babel7çŸ¥è¯†" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">å‰ç«¯å¼€å‘</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-201-ã€ç¼–è¯‘åŸç†ã€‘200è¡ŒJSä»£ç å¸¦ä½ å®ç°å¾®å‹ç¼–è¯‘å™¨ï¼ˆäººäººéƒ½èƒ½å­¦ä¼šï¼‰" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/03/30/201-%E3%80%90%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E3%80%91200%E8%A1%8CJS%E4%BB%A3%E7%A0%81%E5%B8%A6%E4%BD%A0%E5%AE%9E%E7%8E%B0%E5%BE%AE%E5%9E%8B%E7%BC%96%E8%AF%91%E5%99%A8%EF%BC%88%E4%BA%BA%E4%BA%BA%E9%83%BD%E8%83%BD%E5%AD%A6%E4%BC%9A%EF%BC%89/" class="article-date">
  <time class="dt-published" datetime="2020-03-30T13:31:34.000Z" itemprop="datePublished">2020-03-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/03/30/201-%E3%80%90%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E3%80%91200%E8%A1%8CJS%E4%BB%A3%E7%A0%81%E5%B8%A6%E4%BD%A0%E5%AE%9E%E7%8E%B0%E5%BE%AE%E5%9E%8B%E7%BC%96%E8%AF%91%E5%99%A8%EF%BC%88%E4%BA%BA%E4%BA%BA%E9%83%BD%E8%83%BD%E5%AD%A6%E4%BC%9A%EF%BC%89/">201-ã€ç¼–è¯‘åŸç†ã€‘200è¡ŒJSä»£ç å¸¦ä½ å®ç°å¾®å‹ç¼–è¯‘å™¨ï¼ˆäººäººéƒ½èƒ½å­¦ä¼šï¼‰</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><img src="http://images.pingan8787.com/TinyCompiler/1585365502950-d474962e-f17c-4aec-bcf4-1252dd5f0e5d.jpeg"><br /></p>
<blockquote>
<p>æœ€è¿‘çœ‹åˆ°æ˜é‡‘ã€å‰ç«¯å…¬ä¼—å·å¥½å¤š ES2020 çš„æ–‡ç« ï¼Œæƒ³è¯´ä¸€å¥ï¼šæ”¾å¼€æˆ‘ï¼Œæˆ‘è¿˜å­¦å¾—åŠ¨ï¼</p>
</blockquote>
<p><br />å…ˆé—®å¤§å®¶ä¸€å¥ï¼Œæ—¥å¸¸é¡¹ç›®å¼€å‘ä¸­ä½ èƒ½ç¦»å¼€ ES6 å—ï¼Ÿ<br /></p>
<h1 id="ä¸€ã€å‰è¨€"><a href="#ä¸€ã€å‰è¨€" class="headerlink" title="ä¸€ã€å‰è¨€"></a>ä¸€ã€å‰è¨€</h1><p>å¯¹äºå‰ç«¯åŒå­¦æ¥è¯´ï¼Œç¼–è¯‘å™¨å¯èƒ½é€‚åˆç¥å¥‡çš„é­”ç›’ğŸï¼Œè¡¨é¢æ™®é€šï¼Œä½†å¸¸å¸¸ç»™æˆ‘ä»¬æƒŠå–œã€‚<br />ç¼–è¯‘å™¨ï¼Œé¡¾åæ€ä¹‰ï¼Œç”¨æ¥ç¼–è¯‘ï¼Œç¼–è¯‘ä»€ä¹ˆå‘¢ï¼Ÿå½“ç„¶æ˜¯ç¼–è¯‘ä»£ç å’¯ğŸŒ¹ã€‚<br /><br><img src="https://st-gdx.dancf.com/gaodingx/0/design/20191125-144728-7a47.gif"><br><br />å…¶å®æˆ‘ä»¬ä¹Ÿç»å¸¸æ¥è§¦åˆ°ç¼–è¯‘å™¨çš„ä½¿ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>React ä¸­ JSX è½¬æ¢æˆ JS ä»£ç ï¼›</li>
<li>é€šè¿‡ Babel å°† ES6 åŠä»¥ä¸Šè§„èŒƒçš„ä»£ç è½¬æ¢æˆ ES5 ä»£ç ï¼›</li>
<li>é€šè¿‡å„ç§ Loader å°† Less / Scss ä»£ç è½¬æ¢æˆæµè§ˆå™¨æ”¯æŒçš„ CSS ä»£ç ï¼›</li>
<li>å°† TypeScript è½¬æ¢ä¸º JavaScript ä»£ç ã€‚</li>
<li>and so onâ€¦</li>
</ul>
<p><br />ä½¿ç”¨åœºæ™¯éå¸¸ä¹‹å¤šï¼Œæˆ‘çš„åŒæ‰‹éƒ½æ•°ä¸è¿‡æ¥äº†ã€‚ğŸ˜„<br />è™½ç„¶ç°åœ¨ç¤¾åŒºå·²ç»æœ‰éå¸¸å¤šå·¥å…·èƒ½ä¸ºæˆ‘ä»¬å®Œæˆä¸Šè¿°å·¥ä½œï¼Œä½†äº†è§£ä¸€äº›ç¼–è¯‘åŸç†æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚æ¥ä¸‹æ¥è¿›å…¥æœ¬æ–‡ä¸»é¢˜ï¼š<strong>200è¡ŒJSä»£ç ï¼Œå¸¦ä½ å®ç°ä»£ç ç¼–è¯‘å™¨</strong>ã€‚<br /></p>
<h1 id="äºŒã€ç¼–è¯‘å™¨ä»‹ç»"><a href="#äºŒã€ç¼–è¯‘å™¨ä»‹ç»" class="headerlink" title="äºŒã€ç¼–è¯‘å™¨ä»‹ç»"></a>äºŒã€ç¼–è¯‘å™¨ä»‹ç»</h1><h2 id="2-1-ç¨‹åºè¿è¡Œæ–¹å¼"><a href="#2-1-ç¨‹åºè¿è¡Œæ–¹å¼" class="headerlink" title="2.1 ç¨‹åºè¿è¡Œæ–¹å¼"></a>2.1 ç¨‹åºè¿è¡Œæ–¹å¼</h2><p>ç°ä»£ç¨‹åºä¸»è¦æœ‰ä¸¤ç§ç¼–è¯‘æ¨¡å¼ï¼šé™æ€ç¼–è¯‘å’ŒåŠ¨æ€è§£é‡Šã€‚æ¨èä¸€ç¯‡æ–‡ç« <a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000008739157">ã€ŠAngular 2 JIT vs AOTã€‹</a>ä»‹ç»å¾—éå¸¸è¯¦ç»†ã€‚<br /></p>
<h3 id="é™æ€ç¼–è¯‘"><a href="#é™æ€ç¼–è¯‘" class="headerlink" title="é™æ€ç¼–è¯‘"></a>é™æ€ç¼–è¯‘</h3><p>ç®€ç§° <strong>AOT</strong>ï¼ˆAhead-Of-Timeï¼‰å³ <strong>æå‰ç¼–è¯‘</strong> ï¼Œé™æ€ç¼–è¯‘çš„ç¨‹åºä¼šåœ¨æ‰§è¡Œå‰ï¼Œä¼šä½¿ç”¨æŒ‡å®šç¼–è¯‘å™¨ï¼Œå°†å…¨éƒ¨ä»£ç ç¼–è¯‘æˆæœºå™¨ç ã€‚<br /><img src="http://images.pingan8787.com/TinyCompiler/111.png"><br />ï¼ˆå›¾ç‰‡æ¥è‡ªï¼š<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000008739157">https://segmentfault.com/a/1190000008739157</a>ï¼‰<br /><br><br />åœ¨ Angular çš„ AOT ç¼–è¯‘æ¨¡å¼å¼€å‘æµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä½¿ç”¨ TypeScript å¼€å‘ Angular åº”ç”¨</li>
<li>è¿è¡Œ ngc ç¼–è¯‘åº”ç”¨ç¨‹åº<ul>
<li>ä½¿ç”¨ Angular Compiler ç¼–è¯‘æ¨¡æ¿ï¼Œä¸€èˆ¬è¾“å‡º TypeScript ä»£ç </li>
<li>è¿è¡Œ tsc ç¼–è¯‘ TypeScript ä»£ç </li>
</ul>
</li>
<li>ä½¿ç”¨ Webpack æˆ– Gulp ç­‰å…¶ä»–å·¥å…·æ„å»ºé¡¹ç›®ï¼Œå¦‚ä»£ç å‹ç¼©ã€åˆå¹¶ç­‰</li>
<li>éƒ¨ç½²åº”ç”¨</li>
</ul>
<h3 id="åŠ¨æ€è§£é‡Š"><a href="#åŠ¨æ€è§£é‡Š" class="headerlink" title="åŠ¨æ€è§£é‡Š"></a>åŠ¨æ€è§£é‡Š</h3><p>ç®€ç§° <strong>JIT</strong>ï¼ˆJust-In-Timeï¼‰å³ <strong>å³æ—¶ç¼–è¯‘</strong> ï¼ŒåŠ¨æ€è§£é‡Šçš„ç¨‹åºä¼šä½¿ç”¨æŒ‡å®šè§£é‡Šå™¨ï¼Œä¸€è¾¹ç¼–è¯‘ä¸€è¾¹æ‰§è¡Œç¨‹åºã€‚<br /><img src="http://images.pingan8787.com/TinyCompiler/112.png">ï¼ˆå›¾ç‰‡æ¥è‡ªï¼š<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000008739157" title="https://segmentfault.com/a/1190000008739157">https://segmentfault.com/a/1190000008739157</a>ï¼‰<br /><br><br />åœ¨ Angular çš„ JIT ç¼–è¯‘æ¨¡å¼å¼€å‘æµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä½¿ç”¨ TypeScript å¼€å‘ Angular åº”ç”¨</li>
<li>è¿è¡Œ tsc ç¼–è¯‘ TypeScript ä»£ç </li>
<li>ä½¿ç”¨ Webpack æˆ– Gulp ç­‰å…¶ä»–å·¥å…·æ„å»ºé¡¹ç›®ï¼Œå¦‚ä»£ç å‹ç¼©ã€åˆå¹¶ç­‰</li>
<li>éƒ¨ç½²åº”ç”¨</li>
</ul>
<h3 id="AOT-vs-JIT"><a href="#AOT-vs-JIT" class="headerlink" title="AOT vs JIT"></a>AOT vs JIT</h3><p><strong>AOT ç¼–è¯‘æµç¨‹ï¼š</strong><img src="http://images.pingan8787.com/TinyCompiler/113.png">ï¼ˆå›¾ç‰‡æ¥è‡ªï¼š<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000008739157">https://segmentfault.com/a/1190000008739157</a>ï¼‰</p>
<p><strong>JIT ç¼–è¯‘æµç¨‹ï¼š</strong><img src="http://images.pingan8787.com/TinyCompiler/114.png">ï¼ˆå›¾ç‰‡æ¥è‡ªï¼š<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000008739157">https://segmentfault.com/a/1190000008739157</a>ï¼‰</p>
<table>
<thead>
<tr>
<th align="center">ç‰¹æ€§</th>
<th align="center">AOT</th>
<th align="center">JIT</th>
</tr>
</thead>
<tbody><tr>
<td align="center">ç¼–è¯‘å¹³å°</td>
<td align="center">(Server) æœåŠ¡å™¨</td>
<td align="center">(Browser) æµè§ˆå™¨</td>
</tr>
<tr>
<td align="center">ç¼–è¯‘æ—¶æœº</td>
<td align="center">Build (æ„å»ºé˜¶æ®µ)</td>
<td align="center">Runtime (è¿è¡Œæ—¶)</td>
</tr>
<tr>
<td align="center">åŒ…å¤§å°</td>
<td align="center">è¾ƒå°</td>
<td align="center">è¾ƒå¤§</td>
</tr>
<tr>
<td align="center">æ‰§è¡Œæ€§èƒ½</td>
<td align="center">æ›´å¥½</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">å¯åŠ¨æ—¶é—´</td>
<td align="center">æ›´çŸ­</td>
<td align="center">-</td>
</tr>
</tbody></table>
<p>é™¤æ­¤ä¹‹å¤– AOT è¿˜æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p>
<ul>
<li>åœ¨å®¢æˆ·ç«¯æˆ‘ä»¬ä¸éœ€è¦å¯¼å…¥ä½“ç§¯åºå¤§çš„ angular ç¼–è¯‘å™¨ï¼Œè¿™æ ·å¯ä»¥å‡å°‘æˆ‘ä»¬ JS è„šæœ¬åº“çš„å¤§å°</li>
<li>ä½¿ç”¨ AOT ç¼–è¯‘åçš„åº”ç”¨ï¼Œä¸å†åŒ…å«ä»»ä½• HTML ç‰‡æ®µï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ç¼–è¯‘ç”Ÿæˆçš„ TypeScript ä»£ç ï¼Œè¿™æ ·çš„è¯ TypeScript ç¼–è¯‘å™¨å°±èƒ½æå‰å‘ç°é”™è¯¯ã€‚æ€»è€Œè¨€ä¹‹ï¼Œé‡‡ç”¨ AOT ç¼–è¯‘æ¨¡å¼ï¼Œæˆ‘ä»¬çš„æ¨¡æ¿æ˜¯ç±»å‹å®‰å…¨çš„ã€‚</li>
</ul>
<h2 id="2-2-ç°ä»£ç¼–è¯‘å™¨å·¥ä½œæµç¨‹"><a href="#2-2-ç°ä»£ç¼–è¯‘å™¨å·¥ä½œæµç¨‹" class="headerlink" title="2.2 ç°ä»£ç¼–è¯‘å™¨å·¥ä½œæµç¨‹"></a>2.2 ç°ä»£ç¼–è¯‘å™¨å·¥ä½œæµç¨‹</h2><p>æ‘˜æŠ„ç»´åŸºç™¾ç§‘ä¸­å¯¹ <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E7%B7%A8%E8%AD%AF%E5%99%A8?wprov=srpw1_0" title="ç¼–è¯‘å™¨">ç¼–è¯‘å™¨</a>å·¥ä½œæµç¨‹ä»‹ç»ï¼š</p>
<blockquote>
<p>ä¸€ä¸ªç°ä»£ç¼–è¯‘å™¨çš„ä¸»è¦å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š<br>æºä»£ç ï¼ˆsource codeï¼‰â†’ é¢„å¤„ç†å™¨ï¼ˆpreprocessorï¼‰â†’ ç¼–è¯‘å™¨ï¼ˆcompilerï¼‰â†’ æ±‡ç¼–ç¨‹åºï¼ˆassemblerï¼‰â†’ ç›®æ ‡ä»£ç ï¼ˆobject codeï¼‰â†’ é“¾æ¥å™¨ï¼ˆlinkerï¼‰â†’ å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆexecutablesï¼‰ï¼Œæœ€åæ‰“åŒ…å¥½çš„æ–‡ä»¶å°±å¯ä»¥ç»™ç”µè„‘å»åˆ¤è¯»è¿è¡Œäº†ã€‚</p>
</blockquote>
<p><img src="http://images.pingan8787.com/TinyCompiler/115.png"></p>
<p>è¿™é‡Œæ›´å¼ºè°ƒäº†ç¼–è¯‘å™¨çš„ä½œç”¨ï¼š<strong>å°†åŸå§‹ç¨‹åºä½œä¸ºè¾“å…¥ï¼Œç¿»è¯‘äº§ç”Ÿç›®æ ‡è¯­è¨€çš„ç­‰ä»·ç¨‹åº</strong>ã€‚</p>
<p><img src="http://images.pingan8787.com/TinyCompiler/%E7%BC%96%E8%AF%91%E5%99%A8%E4%B8%89%E4%B8%AA%E6%A0%B8%E5%BF%83%E9%98%B6%E6%AE%B5.png" alt="ç¼–è¯‘å™¨ä¸‰ä¸ªæ ¸å¿ƒé˜¶æ®µ.png"></p>
<p>ç›®å‰ç»å¤§å¤šæ•°ç°ä»£ç¼–è¯‘å™¨å·¥ä½œæµç¨‹åŸºæœ¬ç±»ä¼¼ï¼ŒåŒ…æ‹¬ä¸‰ä¸ªæ ¸å¿ƒé˜¶æ®µï¼š</p>
<ol>
<li><strong>è§£æï¼ˆ_Parsing_ï¼‰</strong> ï¼šé€šè¿‡è¯æ³•åˆ†æå’Œè¯­æ³•åˆ†æï¼Œå°†åŸå§‹ä»£ç å­—ç¬¦ä¸²è§£ææˆ<strong>æŠ½è±¡è¯­æ³•æ ‘ï¼ˆAbstract Syntax Treeï¼‰</strong>ï¼›</li>
<li><strong>è½¬æ¢ï¼ˆ_Transformation_ï¼‰</strong>ï¼šå¯¹æŠ½è±¡è¯­æ³•æ ‘è¿›è¡Œè½¬æ¢å¤„ç†æ“ä½œï¼›</li>
<li><strong>ç”Ÿæˆä»£ç ï¼ˆ_Code Generation_ï¼‰</strong>ï¼šå°†è½¬æ¢ä¹‹åçš„ AST å¯¹è±¡ç”Ÿæˆç›®æ ‡è¯­è¨€ä»£ç å­—ç¬¦ä¸²ã€‚</li>
</ol>
<h1 id="ä¸‰ã€ç¼–è¯‘å™¨å®ç°"><a href="#ä¸‰ã€ç¼–è¯‘å™¨å®ç°" class="headerlink" title="ä¸‰ã€ç¼–è¯‘å™¨å®ç°"></a>ä¸‰ã€ç¼–è¯‘å™¨å®ç°</h1><p>æœ¬æ–‡å°†é€šè¿‡ <strong><a target="_blank" rel="noopener" href="https://the-super-tiny-compiler.glitch.me/" title="The Super Tiny Compiler">The Super Tiny Compiler</a></strong> æºç è§£è¯»ï¼Œå­¦ä¹ å¦‚ä½•å®ç°ä¸€ä¸ªè½»é‡ç¼–è¯‘å™¨ï¼Œæœ€ç»ˆ<strong>å®ç°å°†ä¸‹é¢åŸå§‹ä»£ç å­—ç¬¦ä¸²ï¼ˆLisp é£æ ¼çš„å‡½æ•°è°ƒç”¨ï¼‰ç¼–è¯‘æˆ JavaScript å¯æ‰§è¡Œçš„ä»£ç </strong>ã€‚<br /></p>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="left">Lisp é£æ ¼ï¼ˆç¼–è¯‘å‰ï¼‰</th>
<th align="left">JavaScript é£æ ¼ï¼ˆç¼–è¯‘åï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td align="left">2 + 2</td>
<td align="left">(add 2 2)</td>
<td align="left">add(2, 2)</td>
</tr>
<tr>
<td align="left">4 - 2</td>
<td align="left">(subtract 4 2)</td>
<td align="left">subtract(4, 2)</td>
</tr>
<tr>
<td align="left">2 + (4 - 2)</td>
<td align="left">(add 2 (subtract 4 2))</td>
<td align="left">add(2, subtract(4, 2))</td>
</tr>
</tbody></table>
<p><br />è¯è¯´ <a target="_blank" rel="noopener" href="https://the-super-tiny-compiler.glitch.me/">The Super Tiny Compiler</a> å·ç§°<strong>å¯èƒ½æ˜¯æœ‰å²ä»¥æ¥æœ€å°çš„ç¼–è¯‘å™¨</strong>ï¼Œå¹¶ä¸”å…¶ä½œè€… James Kyle ä¹Ÿæ˜¯ Babel æ´»è·ƒç»´æŠ¤è€…ä¹‹ä¸€ã€‚<br /><img src="https://st-gdx.dancf.com/gaodingx/46/design/20191206-135932-505a.gif"><br><br />è®©æˆ‘ä»¬å¼€å§‹å§~<br /></p>
<h2 id="3-1-The-Super-Tiny-Compiler-å·¥ä½œæµç¨‹"><a href="#3-1-The-Super-Tiny-Compiler-å·¥ä½œæµç¨‹" class="headerlink" title="3.1 The Super Tiny Compiler å·¥ä½œæµç¨‹"></a>3.1 The Super Tiny Compiler å·¥ä½œæµç¨‹</h2><p>ç°åœ¨å¯¹ç…§å‰é¢ç¼–è¯‘å™¨çš„ä¸‰ä¸ªæ ¸å¿ƒé˜¶æ®µï¼Œäº†è§£ä¸‹ <a target="_blank" rel="noopener" href="https://the-super-tiny-compiler.glitch.me/">The Super Tiny Compiler</a> Â ç¼–è¯‘å™¨æ ¸å¿ƒå·¥ä½œæµç¨‹ï¼š<br /><img src="http://images.pingan8787.com/TinyCompiler/TheSuperTinyCompiler%E7%BC%96%E8%AF%91%E5%99%A8%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png" alt="The Super Tiny Compilerç¼–è¯‘å™¨å·¥ä½œæµç¨‹.png"><br /></p>
<p><strong>å›¾ä¸­è¯¦ç»†æµç¨‹å¦‚ä¸‹ï¼š</strong></p>
<ol>
<li>æ‰§è¡Œ<strong>å…¥å£å‡½æ•°</strong>ï¼Œè¾“å…¥<strong>åŸå§‹ä»£ç å­—ç¬¦ä¸²</strong>ä½œä¸ºå‚æ•°ï¼›</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŸå§‹ä»£ç å­—ç¬¦ä¸²</span></span><br><span class="line">(add <span class="number">2</span> (subtract <span class="number">4</span> <span class="number">2</span>))</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>è¿›å…¥<strong>è§£æé˜¶æ®µï¼ˆParsingï¼‰</strong>ï¼ŒåŸå§‹ä»£ç å­—ç¬¦ä¸²é€šè¿‡<strong>è¯æ³•åˆ†æå™¨ï¼ˆTokenizerï¼‰</strong>è½¬æ¢ä¸º<strong>è¯æ³•å•å…ƒæ•°ç»„ï¼Œ</strong>ç„¶åå†é€šè¿‡ <strong>è¯­æ³•åˆ†æå™¨ï¼ˆParserï¼‰</strong>å°†<strong>è¯æ³•å•å…ƒæ•°ç»„</strong>è½¬æ¢ä¸º<strong>æŠ½è±¡è¯­æ³•æ ‘ï¼ˆAbstract Syntax Tree ç®€ç§° ASTï¼‰</strong>ï¼Œå¹¶è¿”å›ï¼›</li>
</ol>
<p><img src="http://images.pingan8787.com/TinyCompiler/%E8%A7%A3%E6%9E%90%E9%98%B6%E6%AE%B5-%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90.png" alt="è§£æé˜¶æ®µ - è¯æ³•åˆ†æ.png"><br /><br><img src="http://images.pingan8787.com/TinyCompiler/%E8%A7%A3%E6%9E%90%E9%98%B6%E6%AE%B5-%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90.png" alt="è§£æé˜¶æ®µ - è¯­æ³•åˆ†æ.png"><br /></p>
<ol start="3">
<li>è¿›å…¥<strong>è½¬æ¢é˜¶æ®µï¼ˆTransformationï¼‰</strong>ï¼Œå°†ä¸Šä¸€æ­¥ç”Ÿæˆçš„ <strong>AST å¯¹è±¡</strong> å¯¼å…¥<strong>è½¬æ¢å™¨ï¼ˆTransformerï¼‰</strong>ï¼Œé€šè¿‡<strong>è½¬æ¢å™¨</strong>ä¸­çš„<strong>éå†å™¨ï¼ˆTraverserï¼‰</strong>ï¼Œå°†ä»£ç è½¬æ¢ä¸ºæˆ‘ä»¬æ‰€éœ€çš„<strong>æ–°çš„ AST å¯¹è±¡</strong>ï¼›</li>
</ol>
<p><img src="http://images.pingan8787.com/TinyCompiler/%E8%BD%AC%E6%8D%A2%E9%98%B6%E6%AE%B5.png" alt="è½¬æ¢é˜¶æ®µ.png"><br /></p>
<ol start="4">
<li>è¿›å…¥<strong>ä»£ç ç”Ÿæˆé˜¶æ®µï¼ˆCode Generationï¼‰</strong>ï¼Œå°†ä¸Šä¸€æ­¥è¿”å›çš„<strong>æ–° AST å¯¹è±¡</strong>é€šè¿‡<strong>ä»£ç ç”Ÿæˆå™¨ï¼ˆCodeGeneratorï¼‰</strong>ï¼Œè½¬æ¢æˆÂ <strong>JavaScript Code</strong>ï¼›</li>
</ol>
<p><img src="http://images.pingan8787.com/TinyCompiler/%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E9%98%B6%E6%AE%B5.png" alt="ä»£ç ç”Ÿæˆé˜¶æ®µ.png"><br /></p>
<ol start="5">
<li><strong>ä»£ç ç¼–è¯‘ç»“æŸ</strong>ï¼Œè¿”å› <strong>JavaScript Code</strong>ã€‚</li>
</ol>
<p><img src="https://st-gdx.dancf.com/gaodingx/0/uxms/design/20200320-163503-12b5.gif"><br /><br><br />ä¸Šè¿°æµç¨‹çœ‹å®Œåå¯èƒ½ä¸€è„¸æ‡µé€¼ï¼Œä¸è¿‡æ²¡äº‹ï¼Œè¯·ä¿æŒå¤´è„‘æ¸…é†’ï¼Œå…ˆæœ‰ä¸ªæ•´ä¸ªæµç¨‹çš„å°è±¡ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹é˜…è¯»ä»£ç ï¼š<br /></p>
<h2 id="3-2-å…¥å£æ–¹æ³•"><a href="#3-2-å…¥å£æ–¹æ³•" class="headerlink" title="3.2 å…¥å£æ–¹æ³•"></a>3.2 å…¥å£æ–¹æ³•</h2><p>é¦–å…ˆå®šä¹‰ä¸€ä¸ªå…¥å£æ–¹æ³• <code>compiler</code> ï¼Œæ¥æ”¶åŸå§‹ä»£ç å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œè¿”å›æœ€ç»ˆ JavaScript Codeï¼š<br /></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¼–è¯‘å™¨å…¥å£æ–¹æ³• å‚æ•°ï¼šåŸå§‹ä»£ç å­—ç¬¦ä¸² input</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compiler</span>(<span class="params">input</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> tokens = tokenizer(input);</span><br><span class="line">  <span class="keyword">let</span> ast    = parser(tokens);</span><br><span class="line">  <span class="keyword">let</span> newAst = transformer(ast);</span><br><span class="line">  <span class="keyword">let</span> output = codeGenerator(newAst);</span><br><span class="line">  <span class="keyword">return</span> output;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-3-è§£æé˜¶æ®µ"><a href="#3-3-è§£æé˜¶æ®µ" class="headerlink" title="3.3 è§£æé˜¶æ®µ"></a>3.3 è§£æé˜¶æ®µ</h2><p>åœ¨è§£æé˜¶æ®µä¸­ï¼Œæˆ‘ä»¬å®šä¹‰<strong>è¯æ³•åˆ†æå™¨æ–¹æ³•</strong> <code>tokenizer</code>Â  å’Œ<strong>è¯­æ³•åˆ†æå™¨æ–¹æ³•</strong> <code>parser</code> ç„¶ååˆ†åˆ«å®ç°ï¼š<br /></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¯æ³•åˆ†æå™¨ å‚æ•°ï¼šåŸå§‹ä»£ç å­—ç¬¦ä¸² input</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">tokenizer</span>(<span class="params">input</span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯­æ³•åˆ†æå™¨ å‚æ•°ï¼šè¯æ³•å•å…ƒæ•°ç»„tokens</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parser</span>(<span class="params">tokens</span>) </span>&#123;&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="è¯æ³•åˆ†æå™¨"><a href="#è¯æ³•åˆ†æå™¨" class="headerlink" title="è¯æ³•åˆ†æå™¨"></a>è¯æ³•åˆ†æå™¨</h3><p><strong>è¯æ³•åˆ†æå™¨æ–¹æ³•</strong> <code>tokenizer</code> çš„ä¸»è¦ä»»åŠ¡ï¼šéå†æ•´ä¸ªåŸå§‹ä»£ç å­—ç¬¦ä¸²ï¼Œå°†åŸå§‹ä»£ç å­—ç¬¦ä¸²è½¬æ¢ä¸º<strong>è¯æ³•å•å…ƒæ•°ç»„ï¼ˆtokensï¼‰</strong>ï¼Œå¹¶è¿”å›ã€‚<br />åœ¨éå†è¿‡ç¨‹ä¸­ï¼ŒåŒ¹é…æ¯ç§å­—ç¬¦å¹¶å¤„ç†æˆ<strong>è¯æ³•å•å…ƒ</strong>å‹å…¥<strong>è¯æ³•å•å…ƒæ•°ç»„</strong>ï¼Œå¦‚å½“åŒ¹é…åˆ°å·¦æ‹¬å·ï¼ˆ <code>(</code> ï¼‰æ—¶ï¼Œå°†å¾€<strong>è¯æ³•å•å…ƒæ•°ç»„ï¼ˆtokensï¼‰</strong>å‹å…¥ä¸€ä¸ª<strong>è¯æ³•å•å…ƒå¯¹è±¡</strong>ï¼ˆ<code>&#123;type: &#39;paren&#39;, value:&#39;(&#39;&#125;</code>ï¼‰ã€‚<br /><img src="http://images.pingan8787.com/TinyCompiler/%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90%E5%99%A8%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png" alt="è¯æ³•åˆ†æå™¨å·¥ä½œæµç¨‹.png"><br /></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¯æ³•åˆ†æå™¨ å‚æ•°ï¼šåŸå§‹ä»£ç å­—ç¬¦ä¸² input</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">tokenizer</span>(<span class="params">input</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> current = <span class="number">0</span>;  <span class="comment">// å½“å‰è§£æçš„å­—ç¬¦ç´¢å¼•ï¼Œä½œä¸ºæ¸¸æ ‡</span></span><br><span class="line">  <span class="keyword">let</span> tokens = [];  <span class="comment">// åˆå§‹åŒ–è¯æ³•å•å…ƒæ•°ç»„</span></span><br><span class="line">  <span class="comment">// å¾ªç¯éå†åŸå§‹ä»£ç å­—ç¬¦ä¸²ï¼Œè¯»å–è¯æ³•å•å…ƒæ•°ç»„</span></span><br><span class="line">  <span class="keyword">while</span> (current &lt; input.length) &#123;</span><br><span class="line">    <span class="keyword">let</span> char = input[current];</span><br><span class="line">    <span class="comment">// åŒ¹é…å·¦æ‹¬å·ï¼ŒåŒ¹é…æˆåŠŸåˆ™å‹å…¥å¯¹è±¡ &#123;type: &#x27;paren&#x27;, value:&#x27;(&#x27;&#125;</span></span><br><span class="line">    <span class="keyword">if</span> (char === <span class="string">&#x27;(&#x27;</span>) &#123;</span><br><span class="line">      tokens.push(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;paren&#x27;</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&#x27;(&#x27;</span></span><br><span class="line">      &#125;);</span><br><span class="line">      current++;</span><br><span class="line">      <span class="keyword">continue</span>; <span class="comment">// è‡ªå¢currentï¼Œå®Œæˆæœ¬æ¬¡å¾ªç¯ï¼Œè¿›å…¥ä¸‹ä¸€ä¸ªå¾ªç¯</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åŒ¹é…å³æ‹¬å·ï¼ŒåŒ¹é…æˆåŠŸåˆ™å‹å…¥å¯¹è±¡ &#123;type: &#x27;paren&#x27;, value:&#x27;)&#x27;&#125;</span></span><br><span class="line">    <span class="keyword">if</span> (char === <span class="string">&#x27;)&#x27;</span>) &#123;</span><br><span class="line">      tokens.push(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;paren&#x27;</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&#x27;)&#x27;</span></span><br><span class="line">      &#125;);</span><br><span class="line">      current++;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åŒ¹é…ç©ºç™½å­—ç¬¦ï¼ŒåŒ¹é…æˆåŠŸåˆ™è·³è¿‡</span></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ \s åŒ¹é…ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢é¡µç¬¦ã€æ¢è¡Œç¬¦ã€å‚ç›´åˆ¶è¡¨ç¬¦ç­‰</span></span><br><span class="line">    <span class="keyword">let</span> WHITESPACE = <span class="regexp">/\s/</span>;</span><br><span class="line">    <span class="keyword">if</span> (WHITESPACE.test(char)) &#123;</span><br><span class="line">      current++;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åŒ¹é…æ•°å­—å­—ç¬¦ï¼Œä½¿ç”¨ [0-9]ï¼šåŒ¹é…</span></span><br><span class="line">    <span class="comment">// åŒ¹é…æˆåŠŸåˆ™å‹å…¥&#123;type: &#x27;number&#x27;, value: value&#125;</span></span><br><span class="line">    <span class="comment">// å¦‚ (add 123 456) ä¸­ 123 å’Œ 456 ä¸ºä¸¤ä¸ªæ•°å€¼è¯æ³•å•å…ƒ</span></span><br><span class="line">    <span class="keyword">let</span> NUMBERS = <span class="regexp">/[0-9]/</span>;</span><br><span class="line">    <span class="keyword">if</span> (NUMBERS.test(char)) &#123;</span><br><span class="line">      <span class="keyword">let</span> value = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">      <span class="comment">// åŒ¹é…è¿ç»­æ•°å­—ï¼Œä½œä¸ºæ•°å€¼</span></span><br><span class="line">      <span class="keyword">while</span> (NUMBERS.test(char)) &#123;</span><br><span class="line">        value += char;</span><br><span class="line">        char = input[++current];</span><br><span class="line">      &#125;</span><br><span class="line">      tokens.push(&#123; <span class="attr">type</span>: <span class="string">&#x27;number&#x27;</span>, value &#125;);</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åŒ¹é…å½¢åŒå¼•å·åŒ…å›´çš„å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="comment">// åŒ¹é…æˆåŠŸåˆ™å‹å…¥ &#123; type: &#x27;string&#x27;, value: value &#125;</span></span><br><span class="line">    <span class="comment">// å¦‚ (concat &quot;foo&quot; &quot;bar&quot;) ä¸­ &quot;foo&quot; å’Œ &quot;bar&quot; ä¸ºä¸¤ä¸ªå­—ç¬¦ä¸²è¯æ³•å•å…ƒ</span></span><br><span class="line">    <span class="keyword">if</span> (char === <span class="string">&#x27;&quot;&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> value = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">      char = input[++current]; <span class="comment">// è·³è¿‡å·¦åŒå¼•å·</span></span><br><span class="line">      <span class="comment">// è·å–ä¸¤ä¸ªåŒå¼•å·ä¹‹é—´æ‰€æœ‰å­—ç¬¦</span></span><br><span class="line">      <span class="keyword">while</span> (char !== <span class="string">&#x27;&quot;&#x27;</span>) &#123;</span><br><span class="line">        value += char;</span><br><span class="line">        char = input[++current];</span><br><span class="line">      &#125;</span><br><span class="line">      char = input[++current];<span class="comment">// è·³è¿‡å³åŒå¼•å·</span></span><br><span class="line">      tokens.push(&#123; <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span>, value &#125;);</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åŒ¹é…å‡½æ•°åï¼Œè¦æ±‚åªå«å¤§å°å†™å­—æ¯ï¼Œä½¿ç”¨ [a-z] åŒ¹é… i æ¨¡å¼</span></span><br><span class="line">    <span class="comment">// åŒ¹é…æˆåŠŸåˆ™å‹å…¥ &#123; type: &#x27;name&#x27;, value: value &#125;</span></span><br><span class="line">    <span class="comment">// å¦‚ (add 2 4) ä¸­ add ä¸ºä¸€ä¸ªåç§°è¯æ³•å•å…ƒ</span></span><br><span class="line">    <span class="keyword">let</span> LETTERS = <span class="regexp">/[a-z]/i</span>;</span><br><span class="line">    <span class="keyword">if</span> (LETTERS.test(char)) &#123;</span><br><span class="line">      <span class="keyword">let</span> value = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">      <span class="comment">// è·å–è¿ç»­å­—ç¬¦</span></span><br><span class="line">      <span class="keyword">while</span> (LETTERS.test(char)) &#123;</span><br><span class="line">        value += char;</span><br><span class="line">        char = input[++current];</span><br><span class="line">      &#125;</span><br><span class="line">      tokens.push(&#123; <span class="attr">type</span>: <span class="string">&#x27;name&#x27;</span>, value &#125;);</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å½“é‡åˆ°æ— æ³•è¯†åˆ«çš„å­—ç¬¦ï¼ŒæŠ›å‡ºé”™è¯¯æç¤ºï¼Œå¹¶é€€å‡º</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">&#x27;I dont know what this character is: &#x27;</span> + char);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// è¯æ³•åˆ†æå™¨çš„æœ€åè¿”å›è¯æ³•å•å…ƒæ•°ç»„</span></span><br><span class="line">  <span class="keyword">return</span> tokens;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="è¯­æ³•åˆ†æå™¨"><a href="#è¯­æ³•åˆ†æå™¨" class="headerlink" title="è¯­æ³•åˆ†æå™¨"></a>è¯­æ³•åˆ†æå™¨</h3><p><strong>è¯­æ³•åˆ†æå™¨æ–¹æ³•</strong> <code>parser</code> çš„ä¸»è¦ä»»åŠ¡ï¼šå°†<strong>è¯æ³•åˆ†æå™¨</strong>è¿”å›çš„<strong>è¯æ³•å•å…ƒæ•°ç»„</strong>ï¼Œè½¬æ¢ä¸ºèƒ½å¤Ÿæè¿°è¯­æ³•æˆåˆ†åŠå…¶å…³ç³»çš„ä¸­é—´å½¢å¼ï¼ˆ<strong>æŠ½è±¡è¯­æ³•æ ‘ AST</strong>ï¼‰ã€‚<br /><img src="http://images.pingan8787.com/TinyCompiler/%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90%E5%99%A8%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png" alt="è¯­æ³•åˆ†æå™¨å·¥ä½œæµç¨‹.png"><br /></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¯­æ³•åˆ†æå™¨ å‚æ•°ï¼šè¯æ³•å•å…ƒæ•°ç»„tokens</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parser</span>(<span class="params">tokens</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> current = <span class="number">0</span>; <span class="comment">// è®¾ç½®å½“å‰è§£æçš„è¯æ³•å•å…ƒçš„ç´¢å¼•ï¼Œä½œä¸ºæ¸¸æ ‡</span></span><br><span class="line">  <span class="comment">// é€’å½’éå†ï¼ˆå› ä¸ºå‡½æ•°è°ƒç”¨å…è®¸åµŒå¥—ï¼‰ï¼Œå°†è¯æ³•å•å…ƒè½¬æˆ LISP çš„ AST èŠ‚ç‚¹</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">walk</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// è·å–å½“å‰ç´¢å¼•ä¸‹çš„è¯æ³•å•å…ƒ token</span></span><br><span class="line">    <span class="keyword">let</span> token = tokens[current]; </span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ•°å€¼ç±»å‹è¯æ³•å•å…ƒ</span></span><br><span class="line">    <span class="keyword">if</span> (token.type === <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">      current++; <span class="comment">// è‡ªå¢å½“å‰ current å€¼</span></span><br><span class="line">      <span class="comment">// ç”Ÿæˆä¸€ä¸ª ASTèŠ‚ç‚¹ &#x27;NumberLiteral&#x27;ï¼Œè¡¨ç¤ºæ•°å€¼å­—é¢é‡</span></span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;NumberLiteral&#x27;</span>,</span><br><span class="line">        <span class="attr">value</span>: token.value,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å­—ç¬¦ä¸²ç±»å‹è¯æ³•å•å…ƒ</span></span><br><span class="line">    <span class="keyword">if</span> (token.type === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">      current++;</span><br><span class="line">      <span class="comment">// ç”Ÿæˆä¸€ä¸ª ASTèŠ‚ç‚¹ &#x27;StringLiteral&#x27;ï¼Œè¡¨ç¤ºå­—ç¬¦ä¸²å­—é¢é‡</span></span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;StringLiteral&#x27;</span>,</span><br><span class="line">        <span class="attr">value</span>: token.value,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‡½æ•°ç±»å‹è¯æ³•å•å…ƒ</span></span><br><span class="line">    <span class="keyword">if</span> (token.type === <span class="string">&#x27;paren&#x27;</span> &amp;&amp; token.value === <span class="string">&#x27;(&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">// è·³è¿‡å·¦æ‹¬å·ï¼Œè·å–ä¸‹ä¸€ä¸ªè¯æ³•å•å…ƒä½œä¸ºå‡½æ•°å</span></span><br><span class="line">      token = tokens[++current];</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> node = &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;CallExpression&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: token.value,</span><br><span class="line">        <span class="attr">params</span>: []</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å†æ¬¡è‡ªå¢ current å˜é‡ï¼Œè·å–å‚æ•°è¯æ³•å•å…ƒ</span></span><br><span class="line">      token = tokens[++current];</span><br><span class="line"></span><br><span class="line">      <span class="comment">// éå†æ¯ä¸ªè¯æ³•å•å…ƒï¼Œè·å–å‡½æ•°å‚æ•°ï¼Œç›´åˆ°å‡ºç°å³æ‹¬å·&quot;ï¼‰&quot;</span></span><br><span class="line">      <span class="keyword">while</span> ((token.type !== <span class="string">&#x27;paren&#x27;</span>) || (token.type === <span class="string">&#x27;paren&#x27;</span> &amp;&amp; token.value !== <span class="string">&#x27;)&#x27;</span>)) &#123;</span><br><span class="line">        node.params.push(walk());</span><br><span class="line">        token = tokens[current];</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      current++; <span class="comment">// è·³è¿‡å³æ‹¬å·</span></span><br><span class="line">      <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ— æ³•è¯†åˆ«çš„å­—ç¬¦ï¼ŒæŠ›å‡ºé”™è¯¯æç¤º</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(token.type);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆå§‹åŒ– AST æ ¹èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">let</span> ast = &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;Program&#x27;</span>,</span><br><span class="line">    <span class="attr">body</span>: [],</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¾ªç¯å¡«å…… ast.body</span></span><br><span class="line">  <span class="keyword">while</span> (current &lt; tokens.length) &#123;</span><br><span class="line">    ast.body.push(walk());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æœ€åè¿”å›ast</span></span><br><span class="line">  <span class="keyword">return</span> ast;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="3-4-è½¬æ¢é˜¶æ®µ"><a href="#3-4-è½¬æ¢é˜¶æ®µ" class="headerlink" title="3.4 è½¬æ¢é˜¶æ®µ"></a>3.4 è½¬æ¢é˜¶æ®µ</h2><p>åœ¨è½¬æ¢é˜¶æ®µä¸­ï¼Œå®šä¹‰äº†è½¬æ¢å™¨ <code>transformer</code> å‡½æ•°ï¼Œä½¿ç”¨è¯æ³•åˆ†æå™¨è¿”å›çš„ LISP çš„ AST å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå°† AST å¯¹è±¡è½¬æ¢æˆä¸€ä¸ªæ–°çš„ AST å¯¹è±¡ã€‚<br /><br><br />ä¸ºäº†æ–¹ä¾¿ä»£ç ç»„ç»‡ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªéå†å™¨ <code>traverser</code> æ–¹æ³•ï¼Œç”¨æ¥å¤„ç†æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„æ“ä½œã€‚<br /></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// éå†å™¨ å‚æ•°ï¼šast å’Œ visitor</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">traverser</span>(<span class="params">ast, visitor</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å®šä¹‰æ–¹æ³• traverseArray </span></span><br><span class="line">  <span class="comment">// ç”¨äºéå† ASTèŠ‚ç‚¹æ•°ç»„ï¼Œå¯¹æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ è°ƒç”¨ traverseNode æ–¹æ³•ã€‚</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">traverseArray</span>(<span class="params">array, parent</span>) </span>&#123;</span><br><span class="line">    array.forEach(<span class="function"><span class="params">child</span> =&gt;</span> &#123;</span><br><span class="line">      traverseNode(child, parent);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®šä¹‰æ–¹æ³• traverseNode</span></span><br><span class="line">  <span class="comment">// ç”¨äºå¤„ç†æ¯ä¸ª AST èŠ‚ç‚¹ï¼Œæ¥å—ä¸€ä¸ª node å’Œå®ƒçš„çˆ¶èŠ‚ç‚¹ parent ä½œä¸ºå‚æ•°</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">traverseNode</span>(<span class="params">node, parent</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// è·å– visitor ä¸Šå¯¹åº”æ–¹æ³•çš„å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">let</span> methods = visitor[node.type];</span><br><span class="line">    <span class="comment">// è·å– visitor çš„ enter æ–¹æ³•ï¼Œå¤„ç†æ“ä½œå½“å‰ node</span></span><br><span class="line">    <span class="keyword">if</span> (methods &amp;&amp; methods.enter) &#123;</span><br><span class="line">      methods.enter(node, parent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (node.type) &#123;</span><br><span class="line">      <span class="comment">// æ ¹èŠ‚ç‚¹</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;Program&#x27;</span>:</span><br><span class="line">        traverseArray(node.body, node);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="comment">// å‡½æ•°è°ƒç”¨</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;CallExpression&#x27;</span>:</span><br><span class="line">        traverseArray(node.params, node);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="comment">// æ•°å€¼å’Œå­—ç¬¦ä¸²ï¼Œå¿½ç•¥</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;NumberLiteral&#x27;</span>:</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;StringLiteral&#x27;</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å½“é‡åˆ°æ— æ³•è¯†åˆ«çš„å­—ç¬¦ï¼ŒæŠ›å‡ºé”™è¯¯æç¤ºï¼Œå¹¶é€€å‡º</span></span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(node.type);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (methods &amp;&amp; methods.exit) &#123;</span><br><span class="line">      methods.exit(node, parent);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// é¦–æ¬¡æ‰§è¡Œï¼Œå¼€å§‹éå†</span></span><br><span class="line">  traverseNode(ast, <span class="literal">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨çœ‹<strong>éå†å™¨</strong> <code>traverser</code> æ–¹æ³•æ—¶ï¼Œå»ºè®®ç»“åˆä¸‹é¢ä»‹ç»çš„<strong>è½¬æ¢å™¨</strong> <code>transformer</code> æ–¹æ³•é˜…è¯»ï¼š<br /></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è½¬åŒ–å™¨ï¼Œå‚æ•°ï¼šast</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">transformer</span>(<span class="params">ast</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// åˆ›å»º newASTï¼Œä¸ä¹‹å‰ AST ç±»ä¼¼ï¼ŒProgramï¼šä½œä¸ºæ–° AST çš„æ ¹èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">let</span> newAst = &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;Program&#x27;</span>,</span><br><span class="line">    <span class="attr">body</span>: [],</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é€šè¿‡ _context ç»´æŠ¤æ–°æ—§ ASTï¼Œæ³¨æ„ _context æ˜¯ä¸€ä¸ªå¼•ç”¨ï¼Œä»æ—§çš„ AST åˆ°æ–°çš„ ASTã€‚</span></span><br><span class="line">  ast._context = newAst.body;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é€šè¿‡éå†å™¨éå† å¤„ç†æ—§çš„ AST</span></span><br><span class="line">  traverser(ast, &#123;</span><br><span class="line">    <span class="comment">// æ•°å€¼ï¼Œç›´æ¥åŸæ ·æ’å…¥æ–°ASTï¼Œç±»å‹åç§° NumberLiteral</span></span><br><span class="line">    <span class="attr">NumberLiteral</span>: &#123;</span><br><span class="line">      <span class="function"><span class="title">enter</span>(<span class="params">node, parent</span>)</span> &#123;</span><br><span class="line">        parent._context.push(&#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;NumberLiteral&#x27;</span>,</span><br><span class="line">          <span class="attr">value</span>: node.value,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// å­—ç¬¦ä¸²ï¼Œç›´æ¥åŸæ ·æ’å…¥æ–°ASTï¼Œç±»å‹åç§° StringLiteral</span></span><br><span class="line">    <span class="attr">StringLiteral</span>: &#123;</span><br><span class="line">      <span class="function"><span class="title">enter</span>(<span class="params">node, parent</span>)</span> &#123;</span><br><span class="line">        parent._context.push(&#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;StringLiteral&#x27;</span>,</span><br><span class="line">          <span class="attr">value</span>: node.value,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// å‡½æ•°è°ƒç”¨</span></span><br><span class="line">    <span class="attr">CallExpression</span>: &#123;</span><br><span class="line">      <span class="function"><span class="title">enter</span>(<span class="params">node, parent</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸åŒçš„ASTèŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">let</span> expression = &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;CallExpression&#x27;</span>,</span><br><span class="line">          <span class="attr">callee</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;Identifier&#x27;</span>,</span><br><span class="line">            <span class="attr">name</span>: node.name,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">arguments</span>: [],</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‡½æ•°è°ƒç”¨æœ‰å­ç±»ï¼Œå»ºç«‹èŠ‚ç‚¹å¯¹åº”å…³ç³»ï¼Œä¾›å­èŠ‚ç‚¹ä½¿ç”¨</span></span><br><span class="line">        node._context = expression.arguments;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é¡¶å±‚å‡½æ•°è°ƒç”¨ç®—æ˜¯è¯­å¥ï¼ŒåŒ…è£…æˆç‰¹æ®Šçš„ASTèŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (parent.type !== <span class="string">&#x27;CallExpression&#x27;</span>) &#123;</span><br><span class="line"></span><br><span class="line">          expression = &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;ExpressionStatement&#x27;</span>,</span><br><span class="line">            <span class="attr">expression</span>: expression,</span><br><span class="line">          &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        parent._context.push(expression);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> newAst;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‡è¦ä¸€ç‚¹ï¼Œè¿™é‡Œé€šè¿‡ <code>_context</code> å¼•ç”¨æ¥<strong>ç»´æŠ¤æ–°æ—§ AST å¯¹è±¡</strong>ï¼Œç®¡ç†æ–¹ä¾¿ï¼Œé¿å…æ±¡æŸ“æ—§ AST å¯¹è±¡ã€‚<br /></p>
<h2 id="3-5-ä»£ç ç”Ÿæˆ"><a href="#3-5-ä»£ç ç”Ÿæˆ" class="headerlink" title="3.5 ä»£ç ç”Ÿæˆ"></a>3.5 ä»£ç ç”Ÿæˆ</h2><p>æ¥ä¸‹æ¥åˆ°äº†æœ€åä¸€æ­¥ï¼Œæˆ‘ä»¬å®šä¹‰<strong>ä»£ç ç”Ÿæˆå™¨</strong> <code>codeGenerator</code> æ–¹æ³•ï¼Œé€šè¿‡é€’å½’ï¼Œå°†æ–°çš„ AST å¯¹è±¡ä»£ç è½¬æ¢æˆ JavaScript å¯æ‰§è¡Œä»£ç å­—ç¬¦ä¸²ã€‚<br /></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»£ç ç”Ÿæˆå™¨ å‚æ•°ï¼šæ–° AST å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">codeGenerator</span>(<span class="params">node</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> (node.type) &#123;</span><br><span class="line">    <span class="comment">// éå† body å±æ€§ä¸­çš„èŠ‚ç‚¹ï¼Œä¸”é€’å½’è°ƒç”¨ codeGeneratorï¼ŒæŒ‰è¡Œè¾“å‡ºç»“æœ</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Program&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> node.body.map(codeGenerator)</span><br><span class="line">        .join(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¡¨è¾¾å¼ï¼Œå¤„ç†è¡¨è¾¾å¼å†…å®¹ï¼Œå¹¶ç”¨åˆ†å·ç»“å°¾</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;ExpressionStatement&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        codeGenerator(node.expression) +</span><br><span class="line">        <span class="string">&#x27;;&#x27;</span></span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‡½æ•°è°ƒç”¨ï¼Œæ·»åŠ å·¦å³æ‹¬å·ï¼Œå‚æ•°ç”¨é€—å·éš”å¼€</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;CallExpression&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        codeGenerator(node.callee) +</span><br><span class="line">        <span class="string">&#x27;(&#x27;</span> +</span><br><span class="line">        node.arguments.map(codeGenerator)</span><br><span class="line">          .join(<span class="string">&#x27;, &#x27;</span>) +</span><br><span class="line">        <span class="string">&#x27;)&#x27;</span></span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ‡è¯†ç¬¦ï¼Œè¿”å›å…¶ name</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Identifier&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> node.name;</span><br><span class="line">    <span class="comment">// æ•°å€¼ï¼Œè¿”å›å…¶ value</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;NumberLiteral&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> node.value;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å­—ç¬¦ä¸²ï¼Œç”¨åŒå¼•å·åŒ…è£¹å†è¾“å‡º</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;StringLiteral&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;&quot;&#x27;</span> + node.value + <span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å½“é‡åˆ°æ— æ³•è¯†åˆ«çš„å­—ç¬¦ï¼ŒæŠ›å‡ºé”™è¯¯æç¤ºï¼Œå¹¶é€€å‡º</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(node.type);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-6-ç¼–è¯‘å™¨æµ‹è¯•"><a href="#3-6-ç¼–è¯‘å™¨æµ‹è¯•" class="headerlink" title="3.6 ç¼–è¯‘å™¨æµ‹è¯•"></a>3.6 ç¼–è¯‘å™¨æµ‹è¯•</h2><p>æˆªæ­¢ä¸Šä¸€æ­¥ï¼Œæˆ‘ä»¬å®Œæˆç®€æ˜“ç¼–è¯‘å™¨çš„ä»£ç å¼€å‘ã€‚æ¥ä¸‹æ¥é€šè¿‡å‰é¢åŸå§‹éœ€æ±‚çš„ä»£ç ï¼Œæµ‹è¯•ç¼–è¯‘å™¨æ•ˆæœå¦‚ä½•ï¼š<br /></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> add = <span class="function">(<span class="params">a, b</span>) =&gt;</span> a + b;</span><br><span class="line"><span class="keyword">const</span> subtract = <span class="function">(<span class="params">a, b</span>) =&gt;</span> a - b;</span><br><span class="line"><span class="keyword">const</span> source = <span class="string">&quot;(add 2 (subtract 4 2))&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> target = compiler(source); <span class="comment">// &quot;add(2, (subtract(4, 2));&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> result = <span class="built_in">eval</span>(target); <span class="comment">// Ok result is 4</span></span><br></pre></td></tr></table></figure>

<h2 id="3-7-å·¥ä½œæµç¨‹å°ç»“"><a href="#3-7-å·¥ä½œæµç¨‹å°ç»“" class="headerlink" title="3.7 å·¥ä½œæµç¨‹å°ç»“"></a>3.7 å·¥ä½œæµç¨‹å°ç»“</h2><p>æ€»ç»“ <a target="_blank" rel="noopener" href="https://the-super-tiny-compiler.glitch.me/">The Super Tiny Compiler</a> ç¼–è¯‘å™¨æ•´ä¸ªå·¥ä½œæµç¨‹ï¼š<br /><strong>1ã€input =&gt; tokenizer =&gt; tokens</strong><br /><strong>2ã€tokens =&gt; parser =&gt; ast</strong><br /><strong>3ã€ast =&gt; transformer =&gt; newAst</strong><br /><strong>4ã€newAst =&gt; generator =&gt; output</strong><br /></p>
<p>å…¶å®å¤šæ•°ç¼–è¯‘å™¨çš„å·¥ä½œæµç¨‹éƒ½å¤§è‡´ç›¸åŒï¼š<br><img src="http://images.pingan8787.com/TinyCompiler/TheSuperTinyCompiler%E7%BC%96%E8%AF%91%E5%99%A8%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%EF%BC%88%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0%EF%BC%89.png" alt="The Super Tiny Compilerç¼–è¯‘å™¨å·¥ä½œæµç¨‹ï¼ˆæ–¹æ³•å®ç°ï¼‰.png"></p>
<h1 id="å››ã€æ‰‹å†™-Webpack-ç¼–è¯‘å™¨"><a href="#å››ã€æ‰‹å†™-Webpack-ç¼–è¯‘å™¨" class="headerlink" title="å››ã€æ‰‹å†™ Webpack ç¼–è¯‘å™¨"></a>å››ã€æ‰‹å†™ Webpack ç¼–è¯‘å™¨</h1><p>æ ¹æ®ä¹‹å‰ä»‹ç»çš„ <a target="_blank" rel="noopener" href="https://the-super-tiny-compiler.glitch.me/">The Super Tiny Compiler</a>ç¼–è¯‘å™¨æ ¸å¿ƒå·¥ä½œæµç¨‹ï¼Œå†æ¥æ‰‹å†™ Webpack çš„ç¼–è¯‘å™¨ï¼Œä¼šè®©ä½ æœ‰ç§ä¼—äº«ä¸æ»‘çš„æ„Ÿè§‰~<br /><img src="https://st-gdx.dancf.com/gaodingx/0/design/20191030-163349-cca6.gif"></p>
<p><br />è¯è¯´ï¼Œæœ‰äº›é¢è¯•å®˜å–œæ¬¢é—®è¿™ä¸ªå‘¢ã€‚å½“ç„¶ï¼Œæ‰‹å†™ä¸€éèƒ½è®©æˆ‘ä»¬æ›´äº†è§£ Webpack çš„æ„å»ºæµç¨‹ï¼Œè¿™ä¸ªç« èŠ‚æˆ‘ä»¬ç®€è¦ä»‹ç»ä¸€ä¸‹ã€‚</p>
<h2 id="4-1-Webpack-æ„å»ºæµç¨‹åˆ†æ"><a href="#4-1-Webpack-æ„å»ºæµç¨‹åˆ†æ" class="headerlink" title="4.1 Webpack æ„å»ºæµç¨‹åˆ†æ"></a>4.1 Webpack æ„å»ºæµç¨‹åˆ†æ</h2><p>ä»å¯åŠ¨æ„å»ºåˆ°è¾“å‡ºç»“æœä¸€ç³»åˆ—è¿‡ç¨‹ï¼š</p>
<ol>
<li><strong>åˆå§‹åŒ–å‚æ•°</strong></li>
</ol>
<p>è§£æ Webpack é…ç½®å‚æ•°ï¼Œåˆå¹¶ Shell ä¼ å…¥å’Œ <code>webpack.config.js</code> æ–‡ä»¶é…ç½®çš„å‚æ•°ï¼Œå½¢æˆæœ€åçš„é…ç½®ç»“æœã€‚<br /></p>
<ol start="2">
<li><strong>å¼€å§‹ç¼–è¯‘</strong></li>
</ol>
<p>ä¸Šä¸€æ­¥å¾—åˆ°çš„å‚æ•°åˆå§‹åŒ– <code>compiler</code> å¯¹è±¡ï¼Œæ³¨å†Œæ‰€æœ‰é…ç½®çš„æ’ä»¶ï¼Œæ’ä»¶ç›‘å¬ Webpack æ„å»ºç”Ÿå‘½å‘¨æœŸçš„äº‹ä»¶èŠ‚ç‚¹ï¼Œåšå‡ºç›¸åº”çš„ååº”ï¼Œæ‰§è¡Œå¯¹è±¡çš„ <code>run</code> æ–¹æ³•å¼€å§‹æ‰§è¡Œç¼–è¯‘ã€‚<br /></p>
<ol start="3">
<li><strong>ç¡®å®šå…¥å£</strong></li>
</ol>
<p>ä»é…ç½®çš„ <code>entry</code> å…¥å£ï¼Œå¼€å§‹è§£ææ–‡ä»¶æ„å»º AST è¯­æ³•æ ‘ï¼Œæ‰¾å‡ºä¾èµ–ï¼Œé€’å½’ä¸‹å»ã€‚<br /></p>
<ol start="4">
<li><strong>ç¼–è¯‘æ¨¡å—</strong></li>
</ol>
<p>é€’å½’ä¸­æ ¹æ®<strong>æ–‡ä»¶ç±»å‹</strong>å’Œ <strong>loader é…ç½®</strong>ï¼Œè°ƒç”¨æ‰€æœ‰é…ç½®çš„ loader å¯¹æ–‡ä»¶è¿›è¡Œè½¬æ¢ï¼Œå†æ‰¾å‡ºè¯¥æ¨¡å—ä¾èµ–çš„æ¨¡å—ï¼Œå†é€’å½’æœ¬æ­¥éª¤ç›´åˆ°æ‰€æœ‰å…¥å£ä¾èµ–çš„æ–‡ä»¶éƒ½ç»è¿‡äº†æœ¬æ­¥éª¤çš„å¤„ç†ã€‚<br /></p>
<ol start="5">
<li><strong>å®Œæˆæ¨¡å—ç¼–è¯‘å¹¶è¾“å‡º</strong></li>
</ol>
<p>é€’å½’å®Œäº‹åï¼Œå¾—åˆ°æ¯ä¸ªæ–‡ä»¶ç»“æœï¼ŒåŒ…å«æ¯ä¸ªæ¨¡å—ä»¥åŠä»–ä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œæ ¹æ® <code>entry</code> é…ç½®ç”Ÿæˆä»£ç å— <code>chunk</code> ã€‚<br /></p>
<ol start="6">
<li><strong>è¾“å‡ºå®Œæˆ</strong></li>
</ol>
<p>è¾“å‡ºæ‰€æœ‰çš„ <code>chunk</code> åˆ°æ–‡ä»¶ç³»ç»Ÿã€‚<br /><br><br />æ³¨æ„ï¼šåœ¨æ„å»ºç”Ÿå‘½å‘¨æœŸä¸­æœ‰ä¸€ç³»åˆ—æ’ä»¶åœ¨åšåˆé€‚çš„æ—¶æœºåšåˆé€‚äº‹æƒ…ï¼Œæ¯”å¦‚ <code>UglifyPlugin</code> ä¼šåœ¨ loader è½¬æ¢é€’å½’å®Œå¯¹ç»“æœä½¿ç”¨ <code>UglifyJs</code> å‹ç¼©<strong>è¦†ç›–ä¹‹å‰çš„ç»“æœ</strong>ã€‚<br /><img src="http://images.pingan8787.com/TinyCompiler/Webpack%E6%9E%84%E5%BB%BA%E6%B5%81%E7%A8%8B1.png" alt="Webpackæ„å»ºæµç¨‹.png"></p>
<h2 id="4-2-ä»£ç å®ç°"><a href="#4-2-ä»£ç å®ç°" class="headerlink" title="4.2 ä»£ç å®ç°"></a>4.2 ä»£ç å®ç°</h2><p>æ‰‹å†™ Webpack éœ€è¦å®ç°ä»¥ä¸‹ä¸‰ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼š</p>
<ul>
<li><code>createAssets</code> : æ”¶é›†å’Œå¤„ç†æ–‡ä»¶çš„ä»£ç ï¼›</li>
<li><code>createGraph</code> ï¼šæ ¹æ®å…¥å£æ–‡ä»¶ï¼Œè¿”å›æ‰€æœ‰æ–‡ä»¶ä¾èµ–å›¾ï¼›</li>
<li><code>bundle</code> : æ ¹æ®ä¾èµ–å›¾æ•´ä¸ªä»£ç å¹¶è¾“å‡ºï¼›</li>
</ul>
<h3 id="1-createAssets"><a href="#1-createAssets" class="headerlink" title="1. createAssets"></a>1. createAssets</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createAssets</span>(<span class="params">filename</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> content = fs.readFileSync(filename, <span class="string">&quot;utf-8&quot;</span>); <span class="comment">// æ ¹æ®æ–‡ä»¶åè¯»å–æ–‡ä»¶å†…å®¹</span></span><br><span class="line">  </span><br><span class="line">  	<span class="comment">// å°†è¯»å–åˆ°çš„ä»£ç å†…å®¹ï¼Œè½¬æ¢ä¸º AST</span></span><br><span class="line">    <span class="keyword">const</span> ast = parser.parse(content, &#123;</span><br><span class="line">        <span class="attr">sourceType</span>: <span class="string">&quot;module&quot;</span> <span class="comment">// æŒ‡å®šæºç ç±»å‹</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> dependencies = []; <span class="comment">// ç”¨äºæ”¶é›†æ–‡ä»¶ä¾èµ–çš„è·¯å¾„</span></span><br><span class="line"></span><br><span class="line">  	<span class="comment">// é€šè¿‡ traverse æä¾›çš„æ“ä½œ AST çš„æ–¹æ³•ï¼Œè·å–æ¯ä¸ªèŠ‚ç‚¹çš„ä¾èµ–è·¯å¾„</span></span><br><span class="line">    traverse(ast, &#123;</span><br><span class="line">        <span class="attr">ImportDeclaration</span>: <span class="function">(<span class="params">&#123;node&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">            dependencies.push(node.source.value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// é€šè¿‡ AST å°† ES6 ä»£ç è½¬æ¢æˆ ES5 ä»£ç </span></span><br><span class="line">    <span class="keyword">const</span> &#123; code &#125; = babel.transformFromAstSync(ast, <span class="literal">null</span>, &#123;</span><br><span class="line">        <span class="attr">presets</span>: [<span class="string">&quot;@babel/preset-env&quot;</span>]</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> id = moduleId++;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        id,</span><br><span class="line">        filename,</span><br><span class="line">        code,</span><br><span class="line">        dependencies</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-createGraph"><a href="#2-createGraph" class="headerlink" title="2. createGraph"></a>2. createGraph</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createGraph</span>(<span class="params">entry</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> mainAsset = createAssets(entry); <span class="comment">// è·å–å…¥å£æ–‡ä»¶ä¸‹çš„å†…å®¹</span></span><br><span class="line">    <span class="keyword">const</span> queue = [mainAsset];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">const</span> asset <span class="keyword">of</span> queue)&#123;</span><br><span class="line">        <span class="keyword">const</span> dirname = path.dirname(asset.filename);</span><br><span class="line">        asset.mapping = &#123;&#125;;</span><br><span class="line">        asset.dependencies.forEach(<span class="function"><span class="params">relativePath</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> absolutePath = path.join(dirname, relativePath); <span class="comment">// è½¬æ¢æ–‡ä»¶è·¯å¾„ä¸ºç»å¯¹è·¯å¾„</span></span><br><span class="line">            <span class="keyword">const</span> child = createAssets(absolutePath);</span><br><span class="line">            asset.mapping[relativePath] = child.id;</span><br><span class="line">            queue.push(child); <span class="comment">// é€’å½’å»éå†æ‰€æœ‰å­èŠ‚ç‚¹çš„æ–‡ä»¶</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> queue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-bunlde"><a href="#3-bunlde" class="headerlink" title="3. bunlde"></a>3. bunlde</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bundle</span>(<span class="params">graph</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> modules = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    graph.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        modules += <span class="string">`</span></span><br><span class="line"><span class="string">            <span class="subst">$&#123;item.id&#125;</span>: [</span></span><br><span class="line"><span class="string">                function (require, module, exports)&#123;</span></span><br><span class="line"><span class="string">                    <span class="subst">$&#123;item.code&#125;</span></span></span><br><span class="line"><span class="string">                &#125;,</span></span><br><span class="line"><span class="string">                <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(item.mapping)&#125;</span></span></span><br><span class="line"><span class="string">            ],</span></span><br><span class="line"><span class="string">        `</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">        (function(modules)&#123;</span></span><br><span class="line"><span class="string">            function require(id)&#123;</span></span><br><span class="line"><span class="string">                const [fn, mapping] = modules[id];</span></span><br><span class="line"><span class="string">                function localRequire(relativePath)&#123;</span></span><br><span class="line"><span class="string">                    return require(mapping[relativePath]);</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                const module = &#123;</span></span><br><span class="line"><span class="string">                    exports: &#123;&#125;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                fn(localRequire, module, module.exports);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                return module.exports;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            require(0);</span></span><br><span class="line"><span class="string">        &#125;)(&#123;<span class="subst">$&#123;modules&#125;</span>&#125;)</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="äº”ã€æ€»ç»“"><a href="#äº”ã€æ€»ç»“" class="headerlink" title="äº”ã€æ€»ç»“"></a>äº”ã€æ€»ç»“</h1><p>æœ¬æ–‡ä»ç¼–è¯‘å™¨æ¦‚å¿µå’ŒåŸºæœ¬å·¥ä½œæµç¨‹å¼€å§‹ä»‹ç»ï¼Œç„¶åé€šè¿‡ <a target="_blank" rel="noopener" href="https://the-super-tiny-compiler.glitch.me/">The Super Tiny Compiler</a> è¯‘å™¨æºç ï¼Œè¯¦ç»†ä»‹ç»æ ¸å¿ƒå·¥ä½œæµç¨‹å®ç°ï¼ŒåŒ…æ‹¬<strong>è¯æ³•åˆ†æå™¨</strong>ã€<strong>è¯­æ³•åˆ†æå™¨</strong>ã€<strong>éå†å™¨</strong>å’Œ<strong>è½¬æ¢å™¨</strong>çš„åŸºæœ¬å®ç°ï¼Œæœ€åé€šè¿‡<strong>ä»£ç ç”Ÿæˆå™¨</strong>ï¼Œå°†å„ä¸ªé˜¶æ®µä»£ç ç»“åˆèµ·æ¥ï¼Œå®ç°äº†è¿™ä¸ªå·ç§°<strong>å¯èƒ½æ˜¯æœ‰å²ä»¥æ¥æœ€å°çš„ç¼–è¯‘å™¨ã€‚</strong><br />æœ¬æ–‡ä¹Ÿç®€è¦ä»‹ç»äº†<strong>æ‰‹å†™ Webpack çš„å®ç°</strong>ï¼Œéœ€è¦è¯»è€…è‡ªè¡Œå®Œå–„å’Œæ·±å…¥å“Ÿï¼<br>æ˜¯ä¸æ˜¯è§‰å¾—å¾ˆç¥å¥‡~<br /><br><img src="https://st0.dancf.com/csc/346/templets/20191106-155044-c33a.gif"><br /><br>å½“ç„¶é€šè¿‡æœ¬æ–‡å­¦ä¹ ï¼Œä¹Ÿä»…ä»…æ˜¯ç¼–è¯‘å™¨ç›¸å…³çŸ¥è¯†çš„è¾¹å±±ä¸€è„šï¼Œè¦å­¦çš„çŸ¥è¯†è¿˜æœ‰éå¸¸å¤šï¼Œä¸è¿‡å¥½çš„å¼€å¤´ï¼Œæ›´èƒ½ä¿ƒè¿›æˆ‘ä»¬å­¦ä¹ åŠ¨åŠ›ã€‚åŠ æ²¹ï¼<br /><br><br />æœ€åï¼Œæ–‡ä¸­ä»‹ç»åˆ°çš„ä»£ç ï¼Œæˆ‘å­˜æ”¾åœ¨ Github ä¸Šï¼š</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo-JavaScript/blob/master/Cute-Frontend/learningSourceCode/%5Blearning%5Dthe-super-tiny-compiler.js" title="[learning]the-super-tiny-compiler.js">[learning]the-super-tiny-compiler.js</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo-JavaScript/blob/master/Cute-Frontend/learningSourceCode/%5Bwriting%5Dwebpack-compiler.js" title="[writing]webpack-compiler.js">[writing]webpack-compiler.js</a></li>
</ol>
<h1 id="å…­ã€å‚è€ƒèµ„æ–™"><a href="#å…­ã€å‚è€ƒèµ„æ–™" class="headerlink" title="å…­ã€å‚è€ƒèµ„æ–™"></a>å…­ã€å‚è€ƒèµ„æ–™</h1><ol>
<li><a target="_blank" rel="noopener" href="https://the-super-tiny-compiler.glitch.me/" title="ã€ŠThe Super Tiny Compilerã€‹">ã€ŠThe Super Tiny Compilerã€‹</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000016402699" title="ã€Šæœ‰å²ä»¥æ¥æœ€å°çš„ç¼–è¯‘å™¨æºç è§£æã€‹">ã€Šæœ‰å²ä»¥æ¥æœ€å°çš„ç¼–è¯‘å™¨æºç è§£æã€‹</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000008739157" title="ã€ŠAngular 2 JIT vs AOTã€‹">ã€ŠAngular 2 JIT vs AOTã€‹</a></li>
</ol>
<h1 id="å…³äºæˆ‘"><a href="#å…³äºæˆ‘" class="headerlink" title="å…³äºæˆ‘"></a>å…³äºæˆ‘</h1><table>
<thead>
<tr>
<th>Author</th>
<th>ç‹å¹³å®‰</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#x70;&#105;&#110;&#103;&#x61;&#110;&#56;&#x37;&#56;&#x37;&#x40;&#113;&#x71;&#46;&#x63;&#111;&#x6d;">&#x70;&#105;&#110;&#103;&#x61;&#110;&#56;&#x37;&#56;&#x37;&#x40;&#113;&#x71;&#46;&#x63;&#111;&#x6d;</a></td>
</tr>
<tr>
<td>åš  å®¢</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>å¾®  ä¿¡</td>
<td>pingan8787</td>
</tr>
<tr>
<td>æ¯æ—¥æ–‡ç« æ¨è</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>ESå°å†Œ</td>
<td>js.pingan8787.com</td>
</tr>
</tbody></table>
<p><img src="https://user-gold-cdn.xitu.io/2020/2/22/1706bb1ea5f680ae?w=885&h=445&f=png&s=80093">  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/03/30/201-%E3%80%90%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E3%80%91200%E8%A1%8CJS%E4%BB%A3%E7%A0%81%E5%B8%A6%E4%BD%A0%E5%AE%9E%E7%8E%B0%E5%BE%AE%E5%9E%8B%E7%BC%96%E8%AF%91%E5%99%A8%EF%BC%88%E4%BA%BA%E4%BA%BA%E9%83%BD%E8%83%BD%E5%AD%A6%E4%BC%9A%EF%BC%89/" data-id="ckts3ejym00mx4d9kbv2j3lrr" data-title="201-ã€ç¼–è¯‘åŸç†ã€‘200è¡ŒJSä»£ç å¸¦ä½ å®ç°å¾®å‹ç¼–è¯‘å™¨ï¼ˆäººäººéƒ½èƒ½å­¦ä¼šï¼‰" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">å‰ç«¯å¼€å‘</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">åŸåˆ›</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/" rel="tag">ç¼–è¯‘åŸç†</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-200-ã€æ•°æ®ç»“æ„ã€‘8ç§å¸¸è§æ•°æ®ç»“æ„" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/03/24/200-%E3%80%90%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E3%80%918%E7%A7%8D%E5%B8%B8%E8%A7%81%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" class="article-date">
  <time class="dt-published" datetime="2020-03-24T13:27:48.000Z" itemprop="datePublished">2020-03-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/03/24/200-%E3%80%90%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E3%80%918%E7%A7%8D%E5%B8%B8%E8%A7%81%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">200-ã€æ•°æ®ç»“æ„ã€‘8ç§å¸¸è§æ•°æ®ç»“æ„</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>æ¥æº |Â <a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000020011987">https://segmentfault.com/a/1190000020011987</a></p>
<p>åšå‰ç«¯çš„åŒå­¦ä¸å°‘éƒ½æ˜¯è‡ªå­¦æˆæ‰æˆ–è€…åŠè·¯å‡ºå®¶ï¼Œè®¡ç®—æœºåŸºç¡€çš„çŸ¥è¯†æ¯”è¾ƒè–„å¼±ï¼Œå°¤å…¶æ˜¯æ•°æ®ç»“æ„å’Œç®—æ³•è¿™å—ï¼Œæ‰€ä»¥ä»Šå¤©æ•´ç†äº†ä¸€ä¸‹å¸¸è§çš„æ•°æ®ç»“æ„å’Œå¯¹åº”çš„Javascriptçš„å®ç°ï¼Œå¸Œæœ›èƒ½å¸®åŠ©å¤§å®¶å®Œå–„è¿™æ–¹é¢çš„çŸ¥è¯†ä½“ç³»ã€‚<br><a name="item-1"></a></p>
<h1 id="1-Stackï¼ˆæ ˆï¼‰"><a href="#1-Stackï¼ˆæ ˆï¼‰" class="headerlink" title="1. Stackï¼ˆæ ˆï¼‰"></a>1. Stackï¼ˆæ ˆï¼‰</h1><p><img src="https://cdn.nlark.com/yuque/0/2020/png/186051/1585055459424-fad002ec-8fbf-4b40-9f68-6f25b665be04.png#align=left&display=inline&height=281&originHeight=281&originWidth=391&size=0&status=done&style=none&width=391"><br />Stackçš„ç‰¹ç‚¹æ˜¯åè¿›å…ˆå‡ºï¼ˆlast in first outï¼‰ã€‚ç”Ÿæ´»ä¸­å¸¸è§çš„Stackçš„ä¾‹å­æ¯”å¦‚ä¸€æ‘ä¹¦ï¼Œä½ æœ€åæ”¾ä¸Šå»çš„é‚£æœ¬ä½ ä¹‹åä¼šæœ€å…ˆæ‹¿èµ°ï¼›åˆæ¯”å¦‚æµè§ˆå™¨çš„è®¿é—®å†å²ï¼Œå½“ç‚¹å‡»è¿”å›æŒ‰é’®ï¼Œæœ€åè®¿é—®çš„ç½‘ç«™æœ€å…ˆä»å†å²è®°å½•ä¸­å¼¹å‡ºã€‚<br />Stackä¸€èˆ¬å…·å¤‡ä»¥ä¸‹æ–¹æ³•ï¼š</p>
<ol>
<li><code>push</code>ï¼šå°†ä¸€ä¸ªå…ƒç´ æ¨å…¥æ ˆé¡¶</li>
<li><code>pop</code>ï¼šç§»é™¤æ ˆé¡¶å…ƒç´ ï¼Œå¹¶è¿”å›è¢«ç§»é™¤çš„å…ƒç´ </li>
<li><code>peek</code>ï¼šè¿”å›æ ˆé¡¶å…ƒç´ </li>
<li><code>length</code>ï¼šè¿”å›æ ˆä¸­å…ƒç´ çš„ä¸ªæ•°</li>
</ol>
<p>Javascriptçš„Arrayå¤©ç”Ÿå…·å¤‡äº†Stackçš„ç‰¹æ€§ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥ä»å¤´å®ç°ä¸€ä¸ª Stackç±»ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Stack</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.count = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">this</span>.storage = &#123;&#125;;</span><br><span class="line">  <span class="built_in">this</span>.push = <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.storage[<span class="built_in">this</span>.count] = value;</span><br><span class="line">    <span class="built_in">this</span>.count++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.pop = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.count === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.count--;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="built_in">this</span>.storage[<span class="built_in">this</span>.count];</span><br><span class="line">    <span class="keyword">delete</span> <span class="built_in">this</span>.storage[<span class="built_in">this</span>.count];</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.peek = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.storage[<span class="built_in">this</span>.count - <span class="number">1</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.size = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.count;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a name="item-2"></a></p>
<h1 id="2-Queueï¼ˆé˜Ÿåˆ—ï¼‰"><a href="#2-Queueï¼ˆé˜Ÿåˆ—ï¼‰" class="headerlink" title="2. Queueï¼ˆé˜Ÿåˆ—ï¼‰"></a>2. Queueï¼ˆé˜Ÿåˆ—ï¼‰</h1><p><img src="https://cdn.nlark.com/yuque/0/2020/png/186051/1585055459380-2dcc1113-6e64-4073-a85b-ea203380dad7.png#align=left&display=inline&height=196&originHeight=196&originWidth=300&size=0&status=done&style=none&width=300"><br />Queueå’ŒStackæœ‰ä¸€äº›ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯Stackæ˜¯å…ˆè¿›åå‡ºï¼Œè€ŒQueueæ˜¯å…ˆè¿›å…ˆå‡ºã€‚Queueåœ¨ç”Ÿæ´»ä¸­çš„ä¾‹å­æ¯”å¦‚æ’é˜Ÿä¸Šå…¬äº¤ï¼Œæ’åœ¨ç¬¬ä¸€ä¸ªçš„æ€»æ˜¯æœ€å…ˆä¸Šè½¦ï¼›åˆæ¯”å¦‚æ‰“å°æœºçš„æ‰“å°é˜Ÿåˆ—ï¼Œæ’åœ¨å‰é¢çš„æœ€å…ˆæ‰“å°ã€‚<br />Queueä¸€èˆ¬å…·æœ‰ä»¥ä¸‹å¸¸è§æ–¹æ³•ï¼š</p>
<ol>
<li><code>enqueue</code>ï¼šå…¥åˆ—ï¼Œå‘é˜Ÿåˆ—å°¾éƒ¨å¢åŠ ä¸€ä¸ªå…ƒç´ </li>
<li><code>dequeue</code>ï¼šå‡ºåˆ—ï¼Œç§»é™¤é˜Ÿåˆ—å¤´éƒ¨çš„ä¸€ä¸ªå…ƒç´ å¹¶è¿”å›è¢«ç§»é™¤çš„å…ƒç´ </li>
<li><code>front</code>ï¼šè·å–é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ </li>
<li><code>isEmpty</code>ï¼šåˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º</li>
<li><code>size</code>ï¼šè·å–é˜Ÿåˆ—ä¸­å…ƒç´ çš„ä¸ªæ•°</li>
</ol>
<p>Javascriptä¸­çš„Arrayå·²ç»å…·å¤‡äº†Queueçš„ä¸€äº›ç‰¹æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å€ŸåŠ©Arrayå®ç°ä¸€ä¸ªQueueç±»å‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Queue</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> collection = [];</span><br><span class="line">  <span class="built_in">this</span>.print = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(collection);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.enqueue = <span class="function"><span class="keyword">function</span> (<span class="params">element</span>) </span>&#123;</span><br><span class="line">    collection.push(element);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.dequeue = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> collection.shift();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.front = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> collection[<span class="number">0</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.isEmpty = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> collection.length === <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.size = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> collection.length;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a name="item-2-1"></a></p>
<h2 id="Priority-Queueï¼ˆä¼˜å…ˆé˜Ÿåˆ—ï¼‰"><a href="#Priority-Queueï¼ˆä¼˜å…ˆé˜Ÿåˆ—ï¼‰" class="headerlink" title="Priority Queueï¼ˆä¼˜å…ˆé˜Ÿåˆ—ï¼‰"></a>Priority Queueï¼ˆä¼˜å…ˆé˜Ÿåˆ—ï¼‰</h2><p>Queueè¿˜æœ‰ä¸ªå‡çº§ç‰ˆæœ¬ï¼Œç»™æ¯ä¸ªå…ƒç´ èµ‹äºˆä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§é«˜çš„å…ƒç´ å…¥åˆ—æ—¶å°†æ’åˆ°ä½ä¼˜å…ˆçº§å…ƒç´ ä¹‹å‰ã€‚åŒºåˆ«ä¸»è¦æ˜¯<code>enqueue</code>æ–¹æ³•çš„å®ç°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">PriorityQueue</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="built_in">this</span>.enqueue = <span class="function"><span class="keyword">function</span> (<span class="params">element</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.isEmpty()) &#123;</span><br><span class="line">      collection.push(element);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> added = <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; collection.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (element[<span class="number">1</span>] &lt; collection[i][<span class="number">1</span>]) &#123;</span><br><span class="line">          collection.splice(i, <span class="number">0</span>, element);</span><br><span class="line">          added = <span class="literal">true</span>;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (!added) &#123;</span><br><span class="line">        collection.push(element);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>æµ‹è¯•ä¸€ä¸‹ï¼š</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pQ = <span class="keyword">new</span> PriorityQueue();</span><br><span class="line">pQ.enqueue([<span class="string">&#x27;gannicus&#x27;</span>, <span class="number">3</span>]);</span><br><span class="line">pQ.enqueue([<span class="string">&#x27;spartacus&#x27;</span>, <span class="number">1</span>]);</span><br><span class="line">pQ.enqueue([<span class="string">&#x27;crixus&#x27;</span>, <span class="number">2</span>]);</span><br><span class="line">pQ.enqueue([<span class="string">&#x27;oenomaus&#x27;</span>, <span class="number">4</span>]);</span><br><span class="line">pQ.print();</span><br></pre></td></tr></table></figure>
<p><strong>ç»“æœï¼š</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  [ <span class="string">&#x27;spartacus&#x27;</span>, <span class="number">1</span> ],</span><br><span class="line">  [ <span class="string">&#x27;crixus&#x27;</span>, <span class="number">2</span> ],</span><br><span class="line">  [ <span class="string">&#x27;gannicus&#x27;</span>, <span class="number">3</span> ],</span><br><span class="line">  [ <span class="string">&#x27;oenomaus&#x27;</span>, <span class="number">4</span> ]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p><a name="item-3"></a></p>
<h1 id="3-Linked-Listï¼ˆé“¾è¡¨ï¼‰"><a href="#3-Linked-Listï¼ˆé“¾è¡¨ï¼‰" class="headerlink" title="3. Linked Listï¼ˆé“¾è¡¨ï¼‰"></a>3. Linked Listï¼ˆé“¾è¡¨ï¼‰</h1><p><img src="https://cdn.nlark.com/yuque/0/2020/png/186051/1585055459373-fd6b544e-135b-43c9-9785-b33be8806d46.png#align=left&display=inline&height=151&originHeight=151&originWidth=335&size=0&status=done&style=none&width=335"><br />é¡¾åæ€ä¹‰ï¼Œé“¾è¡¨æ˜¯ä¸€ç§é“¾å¼æ•°æ®ç»“æ„ï¼Œé“¾ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹åŒ…å«ä¸¤ç§ä¿¡æ¯ï¼šèŠ‚ç‚¹æœ¬èº«çš„æ•°æ®å’ŒæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆã€‚é“¾è¡¨å’Œä¼ ç»Ÿçš„æ•°ç»„éƒ½æ˜¯çº¿æ€§çš„æ•°æ®ç»“æ„ï¼Œå­˜å‚¨çš„éƒ½æ˜¯ä¸€ä¸ªåºåˆ—çš„æ•°æ®ï¼Œä½†ä¹Ÿæœ‰å¾ˆå¤šåŒºåˆ«ï¼Œå¦‚ä¸‹è¡¨ï¼š</p>
<table>
<thead>
<tr>
<th>æ¯”è¾ƒç»´åº¦</th>
<th>æ•°ç»„</th>
<th>é“¾è¡¨</th>
</tr>
</thead>
<tbody><tr>
<td>å†…å­˜åˆ†é…</td>
<td>é™æ€å†…å­˜åˆ†é…ï¼Œç¼–è¯‘æ—¶åˆ†é…ä¸”è¿ç»­</td>
<td>åŠ¨æ€å†…å­˜åˆ†é…ï¼Œè¿è¡Œæ—¶åˆ†é…ä¸”ä¸è¿ç»­</td>
</tr>
<tr>
<td>å…ƒç´ è·å–</td>
<td>é€šè¿‡Indexè·å–ï¼Œé€Ÿåº¦è¾ƒå¿«</td>
<td>é€šè¿‡éå†é¡ºåºè®¿é—®ï¼Œé€Ÿåº¦è¾ƒæ…¢</td>
</tr>
<tr>
<td>æ·»åŠ åˆ é™¤å…ƒç´ </td>
<td>å› ä¸ºå†…å­˜ä½ç½®è¿ç»­ä¸”å›ºå®šï¼Œé€Ÿåº¦è¾ƒæ…¢</td>
<td>å› ä¸ºå†…å­˜åˆ†é…çµæ´»ï¼Œåªæœ‰ä¸€ä¸ªå¼€é”€æ­¥éª¤ï¼Œé€Ÿåº¦æ›´å¿«</td>
</tr>
<tr>
<td>ç©ºé—´ç»“æ„</td>
<td>å¯ä»¥æ˜¯ä¸€ç»´æˆ–è€…å¤šç»´æ•°ç»„</td>
<td>å¯ä»¥æ˜¯å•å‘ã€åŒå‘æˆ–è€…å¾ªç¯é“¾è¡¨</td>
</tr>
</tbody></table>
<p>ä¸€ä¸ªå•å‘é“¾è¡¨é€šå¸¸å…·æœ‰ä»¥ä¸‹æ–¹æ³•ï¼š</p>
<ol>
<li><code>size</code>ï¼šè¿”å›é“¾è¡¨ä¸­èŠ‚ç‚¹çš„ä¸ªæ•°</li>
<li><code>head</code>ï¼šè¿”å›é“¾è¡¨ä¸­çš„å¤´éƒ¨å…ƒç´ </li>
<li><code>add</code>ï¼šå‘é“¾è¡¨å°¾éƒ¨å¢åŠ ä¸€ä¸ªèŠ‚ç‚¹</li>
<li><code>remove</code>ï¼šåˆ é™¤æŸä¸ªèŠ‚ç‚¹</li>
<li><code>indexOf</code>ï¼šè¿”å›æŸä¸ªèŠ‚ç‚¹çš„index</li>
<li><code>elementAt</code>ï¼šè¿”å›æŸä¸ªindexå¤„çš„èŠ‚ç‚¹</li>
<li><code>addAt</code>ï¼šåœ¨æŸä¸ªindexå¤„æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹</li>
<li><code>removeAt</code>ï¼šåˆ é™¤æŸä¸ªindexå¤„çš„èŠ‚ç‚¹</li>
</ol>
<p><strong>å•å‘é“¾è¡¨çš„Javascriptå®ç°ï¼š</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é“¾è¡¨ä¸­çš„èŠ‚ç‚¹ </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Node</span>(<span class="params">element</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// èŠ‚ç‚¹ä¸­çš„æ•°æ®</span></span><br><span class="line">  <span class="built_in">this</span>.element = element;</span><br><span class="line">  <span class="comment">// æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆ</span></span><br><span class="line">  <span class="built_in">this</span>.next = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">LinkedList</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> length = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">var</span> head = <span class="literal">null</span>;</span><br><span class="line">  <span class="built_in">this</span>.size = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> length;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.head = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.add = <span class="function"><span class="keyword">function</span> (<span class="params">element</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> node = <span class="keyword">new</span> Node(element);</span><br><span class="line">    <span class="keyword">if</span> (head == <span class="literal">null</span>) &#123;</span><br><span class="line">      head = node;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> currentNode = head;</span><br><span class="line">      <span class="keyword">while</span> (currentNode.next) &#123;</span><br><span class="line">        currentNode = currentNode.next;</span><br><span class="line">      &#125;</span><br><span class="line">      currentNode.next = node;</span><br><span class="line">    &#125;</span><br><span class="line">    length++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.remove = <span class="function"><span class="keyword">function</span> (<span class="params">element</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> currentNode = head;</span><br><span class="line">    <span class="keyword">var</span> previousNode;</span><br><span class="line">    <span class="keyword">if</span> (currentNode.element === element) &#123;</span><br><span class="line">      head = currentNode.next;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">while</span> (currentNode.element !== element) &#123;</span><br><span class="line">        previousNode = currentNode;</span><br><span class="line">        currentNode = currentNode.next;</span><br><span class="line">      &#125;</span><br><span class="line">      previousNode.next = currentNode.next;</span><br><span class="line">    &#125;</span><br><span class="line">    length--;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.isEmpty = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> length === <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.indexOf = <span class="function"><span class="keyword">function</span> (<span class="params">element</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> currentNode = head;</span><br><span class="line">    <span class="keyword">var</span> index = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (currentNode) &#123;</span><br><span class="line">      index++;</span><br><span class="line">      <span class="keyword">if</span> (currentNode.element === element) &#123;</span><br><span class="line">        <span class="keyword">return</span> index;</span><br><span class="line">      &#125;</span><br><span class="line">      currentNode = currentNode.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.elementAt = <span class="function"><span class="keyword">function</span> (<span class="params">index</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> currentNode = head;</span><br><span class="line">    <span class="keyword">var</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (count &lt; index) &#123;</span><br><span class="line">      count++;</span><br><span class="line">      currentNode = currentNode.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> currentNode.element;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.addAt = <span class="function"><span class="keyword">function</span> (<span class="params">index, element</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> node = <span class="keyword">new</span> Node(element);</span><br><span class="line">    <span class="keyword">var</span> currentNode = head;</span><br><span class="line">    <span class="keyword">var</span> previousNode;</span><br><span class="line">    <span class="keyword">var</span> currentIndex = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (index &gt; length) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (index === <span class="number">0</span>) &#123;</span><br><span class="line">      node.next = currentNode;</span><br><span class="line">      head = node;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">while</span> (currentIndex &lt; index) &#123;</span><br><span class="line">        currentIndex++;</span><br><span class="line">        previousNode = currentNode;</span><br><span class="line">        currentNode = currentNode.next;</span><br><span class="line">      &#125;</span><br><span class="line">      node.next = currentNode;</span><br><span class="line">      previousNode.next = node;</span><br><span class="line">    &#125;</span><br><span class="line">    length++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.removeAt = <span class="function"><span class="keyword">function</span> (<span class="params">index</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> currentNode = head;</span><br><span class="line">    <span class="keyword">var</span> previousNode;</span><br><span class="line">    <span class="keyword">var</span> currentIndex = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= length) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (index === <span class="number">0</span>) &#123;</span><br><span class="line">      head = currentIndex.next;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">while</span> (currentIndex &lt; index) &#123;</span><br><span class="line">        currentIndex++;</span><br><span class="line">        previousNode = currentNode;</span><br><span class="line">        currentNode = currentNode.next;</span><br><span class="line">      &#125;</span><br><span class="line">      previousNode.next = currentNode.next;</span><br><span class="line">    &#125;</span><br><span class="line">    length--;</span><br><span class="line">    <span class="keyword">return</span> currentNode.element;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a name="item-4"></a></p>
<h1 id="4-Setï¼ˆé›†åˆï¼‰"><a href="#4-Setï¼ˆé›†åˆï¼‰" class="headerlink" title="4. Setï¼ˆé›†åˆï¼‰"></a>4. Setï¼ˆé›†åˆï¼‰</h1><p><img src="https://cdn.nlark.com/yuque/0/2020/png/186051/1585055459561-531a1b4c-96d9-428a-8dd6-8cf87eb4509e.png#align=left&display=inline&height=163&originHeight=163&originWidth=397&size=0&status=done&style=none&width=397"><br />é›†åˆæ˜¯æ•°å­¦ä¸­çš„ä¸€ä¸ªåŸºæœ¬æ¦‚å¿µï¼Œè¡¨ç¤ºå…·æœ‰æŸç§ç‰¹æ€§çš„å¯¹è±¡æ±‡æ€»æˆçš„é›†ä½“ã€‚åœ¨ES6ä¸­ä¹Ÿå¼•å…¥äº†é›†åˆç±»å‹Setï¼ŒSetå’ŒArrayæœ‰ä¸€å®šç¨‹åº¦çš„ç›¸ä¼¼ï¼Œä¸åŒçš„æ˜¯Setä¸­ä¸å…è®¸å‡ºç°é‡å¤çš„å…ƒç´ è€Œä¸”æ˜¯æ— åºçš„ã€‚<br />ä¸€ä¸ªå…¸å‹çš„Setåº”è¯¥å…·æœ‰ä»¥ä¸‹æ–¹æ³•ï¼š</p>
<ol>
<li><code>values</code>ï¼šè¿”å›é›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ </li>
<li><code>size</code>ï¼šè¿”å›é›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°</li>
<li><code>has</code>ï¼šåˆ¤æ–­é›†åˆä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªå…ƒç´ </li>
<li><code>add</code>ï¼šå‘é›†åˆä¸­æ·»åŠ å…ƒç´ </li>
<li><code>remove</code>ï¼šä»é›†åˆä¸­ç§»é™¤æŸä¸ªå…ƒç´ </li>
<li><code>union</code>ï¼šè¿”å›ä¸¤ä¸ªé›†åˆçš„å¹¶é›†</li>
<li><code>intersection</code>ï¼šè¿”å›ä¸¤ä¸ªé›†åˆçš„äº¤é›†</li>
<li><code>difference</code>ï¼šè¿”å›ä¸¤ä¸ªé›†åˆçš„å·®é›†</li>
<li><code>subset</code>ï¼šåˆ¤æ–­ä¸€ä¸ªé›†åˆæ˜¯å¦ä¸ºå¦ä¸€ä¸ªé›†åˆçš„å­é›†</li>
</ol>
<p>ä½¿ç”¨Javascriptå¯ä»¥å°†Setè¿›è¡Œå¦‚ä¸‹å®ç°ï¼Œä¸ºäº†åŒºåˆ«äºES6ä¸­çš„Setå‘½åä¸ºMySetï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MySet</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> collection = [];</span><br><span class="line">  <span class="built_in">this</span>.has = <span class="function"><span class="keyword">function</span> (<span class="params">element</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (collection.indexOf(element) !== -<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.values = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> collection;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.size = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> collection.length;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.add = <span class="function"><span class="keyword">function</span> (<span class="params">element</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.has(element)) &#123;</span><br><span class="line">      collection.push(element);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.remove = <span class="function"><span class="keyword">function</span> (<span class="params">element</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.has(element)) &#123;</span><br><span class="line">      index = collection.indexOf(element);</span><br><span class="line">      collection.splice(index, <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.union = <span class="function"><span class="keyword">function</span> (<span class="params">otherSet</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> unionSet = <span class="keyword">new</span> MySet();</span><br><span class="line">    <span class="keyword">var</span> firstSet = <span class="built_in">this</span>.values();</span><br><span class="line">    <span class="keyword">var</span> secondSet = otherSet.values();</span><br><span class="line">    firstSet.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">      unionSet.add(e);</span><br><span class="line">    &#125;);</span><br><span class="line">    secondSet.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">      unionSet.add(e);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> unionSet;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.intersection = <span class="function"><span class="keyword">function</span> (<span class="params">otherSet</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> intersectionSet = <span class="keyword">new</span> MySet();</span><br><span class="line">    <span class="keyword">var</span> firstSet = <span class="built_in">this</span>.values();</span><br><span class="line">    firstSet.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (otherSet.has(e)) &#123;</span><br><span class="line">        intersectionSet.add(e);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> intersectionSet;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.difference = <span class="function"><span class="keyword">function</span> (<span class="params">otherSet</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> differenceSet = <span class="keyword">new</span> MySet();</span><br><span class="line">    <span class="keyword">var</span> firstSet = <span class="built_in">this</span>.values();</span><br><span class="line">    firstSet.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!otherSet.has(e)) &#123;</span><br><span class="line">        differenceSet.add(e);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> differenceSet;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.subset = <span class="function"><span class="keyword">function</span> (<span class="params">otherSet</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> firstSet = <span class="built_in">this</span>.values();</span><br><span class="line">    <span class="keyword">return</span> firstSet.every(<span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> otherSet.has(value);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a name="item-5"></a></p>
<h1 id="5-Hash-Tableï¼ˆå“ˆå¸Œè¡¨-æ•£åˆ—è¡¨ï¼‰"><a href="#5-Hash-Tableï¼ˆå“ˆå¸Œè¡¨-æ•£åˆ—è¡¨ï¼‰" class="headerlink" title="5. Hash Tableï¼ˆå“ˆå¸Œè¡¨/æ•£åˆ—è¡¨ï¼‰"></a>5. Hash Tableï¼ˆå“ˆå¸Œè¡¨/æ•£åˆ—è¡¨ï¼‰</h1><p><img src="https://cdn.nlark.com/yuque/0/2020/png/186051/1585055459382-b498aa21-cbcc-4ccb-b4cf-9b7827743a47.png#align=left&display=inline&height=230&originHeight=230&originWidth=315&size=0&status=done&style=none&width=315"><br />Hash Tableæ˜¯ä¸€ç§ç”¨äºå­˜å‚¨é”®å€¼å¯¹ï¼ˆkey value pairï¼‰çš„æ•°æ®ç»“æ„ï¼Œå› ä¸ºHash Tableæ ¹æ®keyæŸ¥è¯¢valueçš„é€Ÿåº¦å¾ˆå¿«ï¼Œæ‰€ä»¥å®ƒå¸¸ç”¨äºå®ç°Mapã€Dictinaryã€Objectç­‰æ•°æ®ç»“æ„ã€‚å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒHash Tableå†…éƒ¨ä½¿ç”¨ä¸€ä¸ªhashå‡½æ•°å°†ä¼ å…¥çš„é”®è½¬æ¢æˆä¸€ä¸²æ•°å­—ï¼Œè€Œè¿™ä¸²æ•°å­—å°†ä½œä¸ºé”®å€¼å¯¹å®é™…çš„keyï¼Œé€šè¿‡è¿™ä¸ªkeyæŸ¥è¯¢å¯¹åº”çš„valueéå¸¸å¿«ï¼Œæ—¶é—´å¤æ‚åº¦å°†è¾¾åˆ°O(1)ã€‚Hashå‡½æ•°è¦æ±‚ç›¸åŒè¾“å…¥å¯¹åº”çš„è¾“å‡ºå¿…é¡»ç›¸ç­‰ï¼Œè€Œä¸åŒè¾“å…¥å¯¹åº”çš„è¾“å‡ºå¿…é¡»ä¸ç­‰ï¼Œç›¸å½“äºå¯¹æ¯å¯¹æ•°æ®æ‰“ä¸Šå”¯ä¸€çš„æŒ‡çº¹ã€‚<br />ä¸€ä¸ªHash Tableé€šå¸¸å…·æœ‰ä¸‹åˆ—æ–¹æ³•ï¼š</p>
<ol>
<li><code>add</code>ï¼šå¢åŠ ä¸€ç»„é”®å€¼å¯¹</li>
<li><code>remove</code>ï¼šåˆ é™¤ä¸€ç»„é”®å€¼å¯¹</li>
<li><code>lookup</code>ï¼šæŸ¥æ‰¾ä¸€ä¸ªé”®å¯¹åº”çš„å€¼</li>
</ol>
<p><strong>ä¸€ä¸ªç®€æ˜“ç‰ˆæœ¬çš„Hash Tableçš„Javascriptå®ç°ï¼š</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hash</span>(<span class="params">string, max</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> hash = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; string.length; i++) &#123;</span><br><span class="line">    hash += string.charCodeAt(i);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> hash % max;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">HashTable</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> storage = [];</span><br><span class="line">  <span class="keyword">const</span> storageLimit = <span class="number">4</span>;</span><br><span class="line">  <span class="built_in">this</span>.add = <span class="function"><span class="keyword">function</span> (<span class="params">key, value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> index = hash(key, storageLimit);</span><br><span class="line">    <span class="keyword">if</span> (storage[index] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">      storage[index] = [</span><br><span class="line">        [key, value]</span><br><span class="line">      ];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> inserted = <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; storage[index].length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (storage[index][i][<span class="number">0</span>] === key) &#123;</span><br><span class="line">          storage[index][i][<span class="number">1</span>] = value;</span><br><span class="line">          inserted = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (inserted === <span class="literal">false</span>) &#123;</span><br><span class="line">        storage[index].push([key, value]);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.remove = <span class="function"><span class="keyword">function</span> (<span class="params">key</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> index = hash(key, storageLimit);</span><br><span class="line">    <span class="keyword">if</span> (storage[index].length === <span class="number">1</span> &amp;&amp; storage[index][<span class="number">0</span>][<span class="number">0</span>] === key) &#123;</span><br><span class="line">      <span class="keyword">delete</span> storage[index];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; storage[index]; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (storage[index][i][<span class="number">0</span>] === key) &#123;</span><br><span class="line">          <span class="keyword">delete</span> storage[index][i];</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.lookup = <span class="function"><span class="keyword">function</span> (<span class="params">key</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> index = hash(key, storageLimit);</span><br><span class="line">    <span class="keyword">if</span> (storage[index] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; storage[index].length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (storage[index][i][<span class="number">0</span>] === key) &#123;</span><br><span class="line">          <span class="keyword">return</span> storage[index][i][<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a name="item-6"></a></p>
<h1 id="6-Treeï¼ˆæ ‘ï¼‰"><a href="#6-Treeï¼ˆæ ‘ï¼‰" class="headerlink" title="6. Treeï¼ˆæ ‘ï¼‰"></a>6. Treeï¼ˆæ ‘ï¼‰</h1><p><img src="https://cdn.nlark.com/yuque/0/2020/png/186051/1585055459390-c69c0792-773f-45ac-bbb7-4656f1f516af.png#align=left&display=inline&height=424&originHeight=424&originWidth=708&size=0&status=done&style=none&width=708"><br />é¡¾åæ€ä¹‰ï¼ŒTreeçš„æ•°æ®ç»“æ„å’Œè‡ªç„¶ç•Œä¸­çš„æ ‘æå…¶ç›¸ä¼¼ï¼Œæœ‰æ ¹ã€æ ‘æã€å¶å­ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚Treeæ˜¯ä¸€ç§å¤šå±‚æ•°æ®ç»“æ„ï¼Œä¸Arrayã€Stackã€Queueç›¸æ¯”æ˜¯ä¸€ç§éçº¿æ€§çš„æ•°æ®ç»“æ„ï¼Œåœ¨è¿›è¡Œæ’å…¥å’Œæœç´¢æ“ä½œæ—¶å¾ˆé«˜æ•ˆã€‚åœ¨æè¿°ä¸€ä¸ªTreeæ—¶ç»å¸¸ä¼šç”¨åˆ°ä¸‹åˆ—æ¦‚å¿µï¼š</p>
<ol>
<li>Rootï¼ˆæ ¹ï¼‰ï¼šä»£è¡¨æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œæ ¹èŠ‚ç‚¹æ²¡æœ‰çˆ¶èŠ‚ç‚¹</li>
<li>Parent Nodeï¼ˆçˆ¶èŠ‚ç‚¹ï¼‰ï¼šä¸€ä¸ªèŠ‚ç‚¹çš„ç›´æ¥ä¸Šçº§èŠ‚ç‚¹ï¼Œåªæœ‰ä¸€ä¸ª</li>
<li>Child Nodeï¼ˆå­èŠ‚ç‚¹ï¼‰ï¼šä¸€ä¸ªèŠ‚ç‚¹çš„ç›´æ¥ä¸‹çº§èŠ‚ç‚¹ï¼Œå¯èƒ½æœ‰å¤šä¸ª</li>
<li>Siblingsï¼ˆå…„å¼ŸèŠ‚ç‚¹ï¼‰ï¼šå…·æœ‰ç›¸åŒçˆ¶èŠ‚ç‚¹çš„èŠ‚ç‚¹</li>
<li>Leafï¼ˆå¶èŠ‚ç‚¹ï¼‰ï¼šæ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹</li>
<li>Edgeï¼ˆè¾¹ï¼‰ï¼šä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥çº¿</li>
<li>Pathï¼ˆè·¯å¾„ï¼‰ï¼šä»æºèŠ‚ç‚¹åˆ°ç›®æ ‡èŠ‚ç‚¹çš„è¿ç»­è¾¹</li>
<li>Height of Nodeï¼ˆèŠ‚ç‚¹çš„é«˜åº¦ï¼‰ï¼šè¡¨ç¤ºèŠ‚ç‚¹ä¸å¶èŠ‚ç‚¹ä¹‹é—´çš„æœ€é•¿è·¯å¾„ä¸Šè¾¹çš„ä¸ªæ•°</li>
<li>Height of Treeï¼ˆæ ‘çš„é«˜åº¦ï¼‰ï¼šå³æ ¹èŠ‚ç‚¹çš„é«˜åº¦</li>
<li>Depth of Nodeï¼ˆèŠ‚ç‚¹çš„æ·±åº¦ï¼‰ï¼šè¡¨ç¤ºä»æ ¹èŠ‚ç‚¹åˆ°è¯¥èŠ‚ç‚¹çš„è¾¹çš„ä¸ªæ•°</li>
<li>Degree of Nodeï¼ˆèŠ‚ç‚¹çš„åº¦ï¼‰ï¼šè¡¨ç¤ºå­èŠ‚ç‚¹çš„ä¸ªæ•°</li>
</ol>
<p>æˆ‘ä»¬ä»¥äºŒå‰æŸ¥æ‰¾æ ‘ä¸ºä¾‹ï¼Œå±•ç¤ºæ ‘åœ¨Javascriptä¸­çš„å®ç°ã€‚åœ¨äºŒå‰æŸ¥æ‰¾æ ‘ä¸­ï¼Œå³æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šåªæœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œè€Œå·¦ä¾§å­èŠ‚ç‚¹å°äºå½“å‰èŠ‚ç‚¹ï¼Œè€Œå³ä¾§å­èŠ‚ç‚¹å¤§äºå½“å‰èŠ‚ç‚¹ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š<br /><img src="https://cdn.nlark.com/yuque/0/2020/png/186051/1585055459516-ce2e5d9a-f57e-4ef0-b30f-5b35ada54166.png#align=left&display=inline&height=333&originHeight=333&originWidth=562&size=0&status=done&style=none&width=562"><br />ä¸€ä¸ªäºŒå‰æŸ¥æ‰¾æ ‘åº”è¯¥å…·æœ‰ä»¥ä¸‹å¸¸ç”¨æ–¹æ³•ï¼š</p>
<ol>
<li><code>add</code>ï¼šå‘æ ‘ä¸­æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹</li>
<li><code>findMin</code>ï¼šæŸ¥æ‰¾æ ‘ä¸­æœ€å°çš„èŠ‚ç‚¹</li>
<li><code>findMax</code>ï¼šæŸ¥æ‰¾æ ‘ä¸­æœ€å¤§çš„èŠ‚ç‚¹</li>
<li><code>find</code>ï¼šæŸ¥æ‰¾æ ‘ä¸­çš„æŸä¸ªèŠ‚ç‚¹</li>
<li><code>isPresent</code>ï¼šåˆ¤æ–­æŸä¸ªèŠ‚ç‚¹åœ¨æ ‘ä¸­æ˜¯å¦å­˜åœ¨</li>
<li><code>remove</code>ï¼šç§»é™¤æ ‘ä¸­çš„æŸä¸ªèŠ‚ç‚¹</li>
</ol>
<p>ä»¥ä¸‹æ˜¯äºŒå‰æŸ¥æ‰¾æ ‘çš„Javascriptå®ç°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">data, left = <span class="literal">null</span>, right = <span class="literal">null</span></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.data = data;</span><br><span class="line">    <span class="built_in">this</span>.left = left;</span><br><span class="line">    <span class="built_in">this</span>.right = right;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BST</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.root = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">add</span>(<span class="params">data</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> node = <span class="built_in">this</span>.root;</span><br><span class="line">    <span class="keyword">if</span> (node === <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="built_in">this</span>.root = <span class="keyword">new</span> Node(data);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> searchTree = <span class="function"><span class="keyword">function</span> (<span class="params">node</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (data &lt; node.data) &#123;</span><br><span class="line">          <span class="keyword">if</span> (node.left === <span class="literal">null</span>) &#123;</span><br><span class="line">            node.left = <span class="keyword">new</span> Node(data);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (node.left !== <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> searchTree(node.left);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (data &gt; node.data) &#123;</span><br><span class="line">          <span class="keyword">if</span> (node.right === <span class="literal">null</span>) &#123;</span><br><span class="line">            node.right = <span class="keyword">new</span> Node(data);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (node.right !== <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> searchTree(node.right);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">return</span> searchTree(node);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">findMin</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> current = <span class="built_in">this</span>.root;</span><br><span class="line">    <span class="keyword">while</span> (current.left !== <span class="literal">null</span>) &#123;</span><br><span class="line">      current = current.left;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> current.data;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">findMax</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> current = <span class="built_in">this</span>.root;</span><br><span class="line">    <span class="keyword">while</span> (current.right !== <span class="literal">null</span>) &#123;</span><br><span class="line">      current = current.right;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> current.data;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">find</span>(<span class="params">data</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> current = <span class="built_in">this</span>.root;</span><br><span class="line">    <span class="keyword">while</span> (current.data !== data) &#123;</span><br><span class="line">      <span class="keyword">if</span> (data &lt; current.data) &#123;</span><br><span class="line">        current = current.left</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        current = current.right;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (current === <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> current;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">isPresent</span>(<span class="params">data</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> current = <span class="built_in">this</span>.root;</span><br><span class="line">    <span class="keyword">while</span> (current) &#123;</span><br><span class="line">      <span class="keyword">if</span> (data === current.data) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (data &lt; current.data) &#123;</span><br><span class="line">        current = current.left;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        current = current.right;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">remove</span>(<span class="params">data</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> removeNode = <span class="function"><span class="keyword">function</span> (<span class="params">node, data</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (data == node.data) &#123;</span><br><span class="line">        <span class="comment">// nodeæ²¡æœ‰å­èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (node.left == <span class="literal">null</span> &amp;&amp; node.right == <span class="literal">null</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// nodeæ²¡æœ‰å·¦ä¾§å­èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (node.left == <span class="literal">null</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> node.right;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// nodeæ²¡æœ‰å³ä¾§å­èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (node.right == <span class="literal">null</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> node.left;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// nodeæœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">var</span> tempNode = node.right;</span><br><span class="line">        <span class="keyword">while</span> (tempNode.left !== <span class="literal">null</span>) &#123;</span><br><span class="line">          tempNode = tempNode.left;</span><br><span class="line">        &#125;</span><br><span class="line">        node.data = tempNode.data;</span><br><span class="line">        node.right = removeNode(node.right, tempNode.data);</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (data &lt; node.data) &#123;</span><br><span class="line">        node.left = removeNode(node.left, data);</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        node.right = removeNode(node.right, data);</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.root = removeNode(<span class="built_in">this</span>.root, data);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>æµ‹è¯•ä¸€ä¸‹ï¼š</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bst = <span class="keyword">new</span> BST();</span><br><span class="line">bst.add(<span class="number">4</span>);</span><br><span class="line">bst.add(<span class="number">2</span>);</span><br><span class="line">bst.add(<span class="number">6</span>);</span><br><span class="line">bst.add(<span class="number">1</span>);</span><br><span class="line">bst.add(<span class="number">3</span>);</span><br><span class="line">bst.add(<span class="number">5</span>);</span><br><span class="line">bst.add(<span class="number">7</span>);</span><br><span class="line">bst.remove(<span class="number">4</span>);</span><br><span class="line"><span class="built_in">console</span>.log(bst.findMin());</span><br><span class="line"><span class="built_in">console</span>.log(bst.findMax());</span><br><span class="line">bst.remove(<span class="number">7</span>);</span><br><span class="line"><span class="built_in">console</span>.log(bst.findMax());</span><br><span class="line"><span class="built_in">console</span>.log(bst.isPresent(<span class="number">4</span>));</span><br></pre></td></tr></table></figure>
<p><strong>æ‰“å°ç»“æœï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">7</span><br><span class="line">6</span><br><span class="line">false</span><br></pre></td></tr></table></figure>
<p><a name="item-7"></a></p>
<h1 id="7-Trieï¼ˆå­—å…¸æ ‘ï¼Œè¯»éŸ³åŒtryï¼‰"><a href="#7-Trieï¼ˆå­—å…¸æ ‘ï¼Œè¯»éŸ³åŒtryï¼‰" class="headerlink" title="7. Trieï¼ˆå­—å…¸æ ‘ï¼Œè¯»éŸ³åŒtryï¼‰"></a>7. Trieï¼ˆå­—å…¸æ ‘ï¼Œè¯»éŸ³åŒtryï¼‰</h1><p><img src="https://cdn.nlark.com/yuque/0/2020/png/186051/1585055459493-dcf8b11b-5b4a-45f6-b5ce-df254b1390b4.png#align=left&display=inline&height=632&originHeight=632&originWidth=797&size=0&status=done&style=none&width=797"><br />Trieä¹Ÿå¯ä»¥å«åšPrefix Treeï¼ˆå‰ç¼€æ ‘ï¼‰ï¼Œä¹Ÿæ˜¯ä¸€ç§æœç´¢æ ‘ã€‚Trieåˆ†æ­¥éª¤å­˜å‚¨æ•°æ®ï¼Œæ ‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªæ­¥éª¤ï¼Œtrieå¸¸ç”¨äºå­˜å‚¨å•è¯ä»¥ä¾¿å¿«é€ŸæŸ¥æ‰¾ï¼Œæ¯”å¦‚å®ç°å•è¯çš„è‡ªåŠ¨å®ŒæˆåŠŸèƒ½ã€‚ Trieä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«ä¸€ä¸ªå•è¯çš„å­—æ¯ï¼Œè·Ÿç€æ ‘çš„åˆ†æ”¯å¯ä»¥å¯ä»¥æ‹¼å†™å‡ºä¸€ä¸ªå®Œæ•´çš„å•è¯ï¼Œæ¯ä¸ªèŠ‚ç‚¹è¿˜åŒ…å«ä¸€ä¸ªå¸ƒå°”å€¼è¡¨ç¤ºè¯¥èŠ‚ç‚¹æ˜¯å¦æ˜¯å•è¯çš„æœ€åä¸€ä¸ªå­—æ¯ã€‚<br />Trieä¸€èˆ¬æœ‰ä»¥ä¸‹æ–¹æ³•ï¼š</p>
<ol>
<li><code>add</code>ï¼šå‘å­—å…¸æ ‘ä¸­å¢åŠ ä¸€ä¸ªå•è¯</li>
<li><code>isWord</code>ï¼šåˆ¤æ–­å­—å…¸æ ‘ä¸­æ˜¯å¦åŒ…å«æŸä¸ªå•è¯</li>
<li><code>print</code>ï¼šè¿”å›å­—å…¸æ ‘ä¸­çš„æ‰€æœ‰å•è¯<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Trieçš„èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Node</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.keys = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">  <span class="built_in">this</span>.end = <span class="literal">false</span>;</span><br><span class="line">  <span class="built_in">this</span>.setEnd = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.end = <span class="literal">true</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="built_in">this</span>.isEnd = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.end;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Trie</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.root = <span class="keyword">new</span> Node();</span><br><span class="line">  <span class="built_in">this</span>.add = <span class="function"><span class="keyword">function</span> (<span class="params">input, node = <span class="built_in">this</span>.root</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (input.length === <span class="number">0</span>) &#123;</span><br><span class="line">      node.setEnd();</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!node.keys.has(input[<span class="number">0</span>])) &#123;</span><br><span class="line">      node.keys.set(input[<span class="number">0</span>], <span class="keyword">new</span> Node());</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.add(input.substr(<span class="number">1</span>), node.keys.get(input[<span class="number">0</span>]));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.add(input.substr(<span class="number">1</span>), node.keys.get(input[<span class="number">0</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.isWord = <span class="function"><span class="keyword">function</span> (<span class="params">word</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> node = <span class="built_in">this</span>.root;</span><br><span class="line">    <span class="keyword">while</span> (word.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!node.keys.has(word[<span class="number">0</span>])) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        node = node.keys.get(word[<span class="number">0</span>]);</span><br><span class="line">        word = word.substr(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (node.keys.has(word) &amp;&amp; node.keys.get(word).isEnd()) ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.print = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> words = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">    <span class="keyword">let</span> search = <span class="function"><span class="keyword">function</span> (<span class="params">node = <span class="built_in">this</span>.root, string</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (node.keys.size != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> letter <span class="keyword">of</span> node.keys.keys()) &#123;</span><br><span class="line">          search(node.keys.get(letter), string.concat(letter));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (node.isEnd()) &#123;</span><br><span class="line">          words.push(string);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        string.length &gt; <span class="number">0</span> ? words.push(string) : <span class="literal">undefined</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    search(<span class="built_in">this</span>.root, <span class="keyword">new</span> <span class="built_in">String</span>());</span><br><span class="line">    <span class="keyword">return</span> words.length &gt; <span class="number">0</span> ? words : <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<a name="item-8"></a><h1 id="8-Graphï¼ˆå›¾ï¼‰"><a href="#8-Graphï¼ˆå›¾ï¼‰" class="headerlink" title="8. Graphï¼ˆå›¾ï¼‰"></a>8. Graphï¼ˆå›¾ï¼‰</h1><img src="https://cdn.nlark.com/yuque/0/2020/png/186051/1585055459558-bd99813e-d9ce-412e-b569-f6f1316ff97f.png#align=left&display=inline&height=367&originHeight=367&originWidth=800&size=0&status=done&style=none&width=800"><br />Graphæ˜¯èŠ‚ç‚¹ï¼ˆæˆ–é¡¶ç‚¹ï¼‰ä»¥åŠå®ƒä»¬ä¹‹é—´çš„è¿æ¥ï¼ˆæˆ–è¾¹ï¼‰çš„é›†åˆã€‚Graphä¹Ÿå¯ä»¥ç§°ä¸ºNetworkï¼ˆç½‘ç»œï¼‰ã€‚æ ¹æ®èŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥æ˜¯å¦æœ‰æ–¹å‘åˆå¯ä»¥åˆ†ä¸ºDirected Graphï¼ˆæœ‰å‘å›¾ï¼‰å’ŒUndrected Graphï¼ˆæ— å‘å›¾ï¼‰ã€‚Graphåœ¨å®é™…ç”Ÿæ´»ä¸­æœ‰å¾ˆå¤šç”¨é€”ï¼Œæ¯”å¦‚ï¼šå¯¼èˆªè½¯ä»¶è®¡ç®—æœ€ä½³è·¯å¾„ï¼Œç¤¾äº¤è½¯ä»¶è¿›è¡Œå¥½å‹æ¨èç­‰ç­‰ã€‚<br />Graphé€šå¸¸æœ‰ä¸¤ç§è¡¨è¾¾æ–¹å¼ï¼š<br /><strong>Adjaceny Listï¼ˆé‚»æ¥åˆ—è¡¨ï¼‰</strong>ï¼š<br /><img src="https://cdn.nlark.com/yuque/0/2020/jpeg/186051/1585055459444-1e95771f-b986-496c-a08c-4db76bdb3820.jpeg#align=left&display=inline&height=220&originHeight=220&originWidth=600&size=0&status=done&style=none&width=600"><br />é‚»æ¥åˆ—è¡¨å¯ä»¥è¡¨ç¤ºä¸ºå·¦ä¾§æ˜¯èŠ‚ç‚¹çš„åˆ—è¡¨ï¼Œå³ä¾§åˆ—å‡ºå®ƒæ‰€è¿æ¥çš„æ‰€æœ‰å…¶ä»–èŠ‚ç‚¹ã€‚<br />å’Œ <strong>Adjacency Matrixï¼ˆé‚»æ¥çŸ©é˜µï¼‰</strong>ï¼š<br /><img src="https://cdn.nlark.com/yuque/0/2020/png/186051/1585055459540-fd0e2de2-1221-4479-a9d7-fdeb0709e0ea.png#align=left&display=inline&height=211&originHeight=211&originWidth=555&size=0&status=done&style=none&width=555"><br />é‚»æ¥çŸ©é˜µç”¨çŸ©é˜µæ¥è¡¨ç¤ºèŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥å…³ç³»ï¼Œæ¯è¡Œæˆ–è€…æ¯åˆ—è¡¨ç¤ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¡Œå’Œåˆ—çš„äº¤å‰å¤„çš„æ•°å­—è¡¨ç¤ºèŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»ï¼š0è¡¨ç¤ºæ²¡ç”¨è¿æ¥ï¼Œ1è¡¨ç¤ºæœ‰è¿æ¥ï¼Œå¤§äº1è¡¨ç¤ºä¸åŒçš„æƒé‡ã€‚<br />è®¿é—®Graphä¸­çš„èŠ‚ç‚¹éœ€è¦ä½¿ç”¨éå†ç®—æ³•ï¼Œéå†ç®—æ³•åˆåˆ†ä¸ºå¹¿åº¦ä¼˜å…ˆå’Œæ·±åº¦ä¼˜å…ˆï¼Œä¸»è¦ç”¨äºç¡®å®šç›®æ ‡èŠ‚ç‚¹å’Œæ ¹èŠ‚ç‚¹ä¹‹é—´çš„è·ç¦»ï¼Œ<br />åœ¨Javascriptä¸­ï¼ŒGraphå¯ä»¥ç”¨ä¸€ä¸ªçŸ©é˜µï¼ˆäºŒç»´æ•°ç»„ï¼‰è¡¨ç¤ºï¼Œå¹¿åº¦ä¼˜å…ˆæœç´¢ç®—æ³•å¯ä»¥å®ç°å¦‚ä¸‹ï¼š<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bfs</span>(<span class="params">graph, root</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> nodesLen = &#123;&#125;;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; graph.length; i++) &#123;</span><br><span class="line">    nodesLen[i] = <span class="literal">Infinity</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  nodesLen[root] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">var</span> queue = [root];</span><br><span class="line">  <span class="keyword">var</span> current;</span><br><span class="line">  <span class="keyword">while</span> (queue.length != <span class="number">0</span>) &#123;</span><br><span class="line">    current = queue.shift();</span><br><span class="line">    <span class="keyword">var</span> curConnected = graph[current];</span><br><span class="line">    <span class="keyword">var</span> neighborIdx = [];</span><br><span class="line">    <span class="keyword">var</span> idx = curConnected.indexOf(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">while</span> (idx != -<span class="number">1</span>) &#123;</span><br><span class="line">      neighborIdx.push(idx);</span><br><span class="line">      idx = curConnected.indexOf(<span class="number">1</span>, idx + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; neighborIdx.length; j++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (nodesLen[neighborIdx[j]] == <span class="literal">Infinity</span>) &#123;</span><br><span class="line">        nodesLen[neighborIdx[j]] = nodesLen[current] + <span class="number">1</span>;</span><br><span class="line">        queue.push(neighborIdx[j]);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> nodesLen;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>æµ‹è¯•ä¸€ä¸‹ï¼š</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> graph = [</span><br><span class="line">  [<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>],</span><br><span class="line">  [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">  [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">  [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>],</span><br><span class="line">  [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">];</span><br><span class="line"><span class="built_in">console</span>.log(bfs(graph, <span class="number">1</span>));</span><br></pre></td></tr></table></figure>
<p><strong>æ‰“å°ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  0: 2,</span><br><span class="line">  1: 0,</span><br><span class="line">  2: 1,</span><br><span class="line">  3: 3,</span><br><span class="line">  4: Infinity</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ¬æ–‡æ—¨åœ¨å‘å¹¿å¤§å‰ç«¯åŒå­¦æ™®åŠå¸¸è§çš„æ•°æ®ç»“æ„ï¼Œæœ¬äººå¯¹è¿™ä¸€é¢†åŸŸä¹Ÿåªæ˜¯åˆçª¥é—¨å¾„ï¼Œè¯´çš„æœ‰å·®æ± çš„åœ°æ–¹æ¬¢è¿æŒ‡å‡ºã€‚ä¹Ÿå¸Œæœ›å¤§å®¶èƒ½æ‰“ç‰¢åŸºç¡€ï¼Œåœ¨è¿™æ¡è·¯ä¸Šèµ°çš„æ›´é«˜æ›´è¿œï¼</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/03/24/200-%E3%80%90%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E3%80%918%E7%A7%8D%E5%B8%B8%E8%A7%81%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" data-id="ckts3ejyl00mv4d9k7gm01j36" data-title="200-ã€æ•°æ®ç»“æ„ã€‘8ç§å¸¸è§æ•°æ®ç»“æ„" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">å‰ç«¯å¼€å‘</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">æ•°æ®ç»“æ„</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-199-ã€Webpackã€‘å½»åº•ææ‡‚å¹¶å®ç°webpackçƒ­æ›´æ–°åŸç†" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/03/11/199-%E3%80%90Webpack%E3%80%91%E5%BD%BB%E5%BA%95%E6%90%9E%E6%87%82%E5%B9%B6%E5%AE%9E%E7%8E%B0webpack%E7%83%AD%E6%9B%B4%E6%96%B0%E5%8E%9F%E7%90%86/" class="article-date">
  <time class="dt-published" datetime="2020-03-11T15:20:35.000Z" itemprop="datePublished">2020-03-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/03/11/199-%E3%80%90Webpack%E3%80%91%E5%BD%BB%E5%BA%95%E6%90%9E%E6%87%82%E5%B9%B6%E5%AE%9E%E7%8E%B0webpack%E7%83%AD%E6%9B%B4%E6%96%B0%E5%8E%9F%E7%90%86/">199-ã€Webpackã€‘å½»åº•ææ‡‚å¹¶å®ç°webpackçƒ­æ›´æ–°åŸç†</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>åŸæ–‡åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000020310371">https://segmentfault.com/a/1190000020310371</a></p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000020310371#HMR%E6%98%AF%E4%BB%80%E4%B9%88">HMRæ˜¯ä»€ä¹ˆ</a></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000020310371#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF">ä½¿ç”¨åœºæ™¯</a></li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000020310371#%E9%85%8D%E7%BD%AE%E4%BD%BF%E7%94%A8HMR">é…ç½®ä½¿ç”¨HMR</a></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000020310371#%E9%85%8D%E7%BD%AEwebpack">é…ç½®webpack</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000020310371#%E8%A7%A3%E6%9E%90webpack%E6%89%93%E5%8C%85%E5%90%8E%E7%9A%84%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9">è§£æwebpackæ‰“åŒ…åçš„æ–‡ä»¶å†…å®¹</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000020310371#%E9%85%8D%E7%BD%AEHMR">é…ç½®HMR</a></li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000020310371#HMR%E5%8E%9F%E7%90%86">HMRåŸç†</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000020310371#debug%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%BA%90%E7%A0%81">debugæœåŠ¡ç«¯æºç </a></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000020310371#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%AE%80%E6%98%93%E5%AE%9E%E7%8E%B0">æœåŠ¡ç«¯ç®€æ˜“å®ç°</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000020310371#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%B0%83%E8%AF%95%E9%98%B6%E6%AE%B5">æœåŠ¡ç«¯è°ƒè¯•é˜¶æ®µ</a></li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000020310371#debug%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%BA%90%E7%A0%81">debugå®¢æˆ·ç«¯æºç </a></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000020310371#%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%AE%80%E6%98%93%E5%AE%9E%E7%8E%B0">å®¢æˆ·ç«¯ç®€æ˜“å®ç°</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000020310371#%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%B0%83%E8%AF%95%E9%98%B6%E6%AE%B5">å®¢æˆ·ç«¯è°ƒè¯•é˜¶æ®µ</a></li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000020310371#%E9%97%AE%E9%A2%98">é—®é¢˜</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000020310371#%E6%80%BB%E7%BB%93">æ€»ç»“</a><br><a name="item-2"></a></p>
<h2 id="HMRæ˜¯ä»€ä¹ˆ"><a href="#HMRæ˜¯ä»€ä¹ˆ" class="headerlink" title="HMRæ˜¯ä»€ä¹ˆ"></a>HMRæ˜¯ä»€ä¹ˆ</h2><p><code>HMR</code>å³<code>Hot Module Replacement</code>æ˜¯æŒ‡å½“ä½ å¯¹ä»£ç ä¿®æ”¹å¹¶ä¿å­˜åï¼Œ<code>webpack</code>å°†ä¼šå¯¹ä»£ç è¿›è¡Œé‡æ–°æ‰“åŒ…ï¼Œå¹¶å°†æ”¹åŠ¨çš„æ¨¡å—å‘é€åˆ°æµè§ˆå™¨ç«¯ï¼Œæµè§ˆå™¨ç”¨æ–°çš„æ¨¡å—æ›¿æ¢æ‰æ—§çš„æ¨¡å—ï¼Œå»å®ç°å±€éƒ¨æ›´æ–°é¡µé¢è€Œéæ•´ä½“åˆ·æ–°é¡µé¢ã€‚æ¥ä¸‹æ¥å°†ä»ä½¿ç”¨åˆ°å®ç°ä¸€ç‰ˆç®€æ˜“åŠŸèƒ½å¸¦é¢†å¤§å®¶æ·±å…¥æµ…å‡º<code>HMR</code>ã€‚<br />æ–‡ç« é¦–å‘äº<a target="_blank" rel="noopener" href="https://github.com/careteenL/webpack-hmr">@careteen/webpack-hmr</a>ï¼Œè½¬è½½è¯·æ³¨æ˜æ¥æºå³å¯ã€‚<br><a name="item-2-1"></a></p>
<h3 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><p><img src="https://cdn.nlark.com/yuque/0/2020/jpeg/186051/1583939666973-5b57ede4-45d0-4e23-b722-ad85fcc78f1a.jpeg#align=left&display=inline&height=548&originHeight=548&originWidth=800&size=0&status=done&style=none&width=800"><br />å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸€ä¸ªæ³¨å†Œé¡µé¢åŒ…å«<code>ç”¨æˆ·å</code>ã€<code>å¯†ç </code>ã€<code>é‚®ç®±</code>ä¸‰ä¸ªå¿…å¡«è¾“å…¥æ¡†ï¼Œä»¥åŠä¸€ä¸ª<code>æäº¤</code>æŒ‰é’®ï¼Œå½“ä½ åœ¨è°ƒè¯•<code>é‚®ç®±</code>æ¨¡å—æ”¹åŠ¨äº†ä»£ç æ—¶ï¼Œæ²¡åšä»»ä½•å¤„ç†æƒ…å†µä¸‹æ˜¯ä¼šåˆ·æ–°æ•´ä¸ªé¡µé¢ï¼Œé¢‘ç¹çš„æ”¹åŠ¨ä»£ç ä¼šæµªè´¹ä½ å¤§é‡æ—¶é—´å»é‡æ–°å¡«å†™å†…å®¹ã€‚é¢„æœŸæ˜¯ä¿ç•™<code>ç”¨æˆ·å</code>ã€<code>å¯†ç </code>çš„è¾“å…¥å†…å®¹ï¼Œè€Œåªæ›¿æ¢<code>é‚®ç®±</code>è¿™ä¸€æ¨¡å—ã€‚è¿™ä¸€è¯‰æ±‚å°±éœ€è¦å€ŸåŠ©<code>webpack-dev-server</code>çš„çƒ­æ¨¡å—æ›´æ–°åŠŸèƒ½ã€‚<br />ç›¸å¯¹äº<code>live reload</code>æ•´ä½“åˆ·æ–°é¡µé¢çš„æ–¹æ¡ˆï¼Œ<code>HMR</code>çš„ä¼˜ç‚¹åœ¨äºå¯ä»¥ä¿å­˜åº”ç”¨çš„çŠ¶æ€ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚<br><a name="item-3"></a></p>
<h2 id="é…ç½®ä½¿ç”¨HMR"><a href="#é…ç½®ä½¿ç”¨HMR" class="headerlink" title="é…ç½®ä½¿ç”¨HMR"></a>é…ç½®ä½¿ç”¨HMR</h2><p><a name="item-3-2"></a></p>
<h3 id="é…ç½®webpack"><a href="#é…ç½®webpack" class="headerlink" title="é…ç½®webpack"></a>é…ç½®webpack</h3><p>é¦–å…ˆå€ŸåŠ©<code>webpack</code>æ­å»ºé¡¹ç›®</p>
</li>
<li><p>åˆè¯†åŒ–é¡¹ç›®å¹¶å¯¼å…¥ä¾èµ–</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir webpack-hmr &amp;&amp; <span class="built_in">cd</span> webpack-hmr</span><br><span class="line">npm i -y</span><br><span class="line">npm i -S webpack webpack-cli webpack-dev-server html-webpack-plugin</span><br></pre></td></tr></table></figure></li>
<li><p>é…ç½®æ–‡ä»¶<code>webpack.config.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> htmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>, <span class="comment">// å¼€å‘æ¨¡å¼ä¸å‹ç¼©ä»£ç ï¼Œæ–¹ä¾¿è°ƒè¯•</span></span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>, <span class="comment">// å…¥å£æ–‡ä»¶</span></span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.join(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;main.js&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">contentBase</span>: path.join(__dirname, <span class="string">&#x27;dist&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> htmlWebpackPlugin(&#123;</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&#x27;./src/index.html&#x27;</span>,</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&#x27;index.html&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>æ–°å»º<code>src/index.html</code>æ¨¡æ¿æ–‡ä»¶</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Webpack Hot Module Replacement<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>æ–°å»º<code>src/index.js</code>å…¥å£æ–‡ä»¶ç¼–å†™ç®€å•é€»è¾‘</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> root = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  root.innerHTML = <span class="built_in">require</span>(<span class="string">&#x27;./content.js&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line">render()</span><br></pre></td></tr></table></figure></li>
<li><p>æ–°å»ºä¾èµ–æ–‡ä»¶<code>src/content.js</code>å¯¼å‡ºå­—ç¬¦ä¾›indexæ¸²æŸ“é¡µé¢</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ret = <span class="string">&#x27;Hello Webpack Hot Module Replacement&#x27;</span></span><br><span class="line"><span class="built_in">module</span>.exports = ret</span><br><span class="line"><span class="comment">// export default ret</span></span><br></pre></td></tr></table></figure></li>
<li><p>é…ç½®<code>package.json</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;dev&quot;</span>: <span class="string">&quot;webpack-dev-server&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;webpack&quot;</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>ç„¶å<code>npm run dev</code>å³å¯å¯åŠ¨é¡¹ç›®</p>
</li>
<li><p>é€šè¿‡<code>npm run build</code>æ‰“åŒ…ç”Ÿæˆé™æ€èµ„æºåˆ°<code>dist</code>ç›®å½•</p>
</li>
</ul>
<p>æ¥ä¸‹æ¥å…ˆåˆ†æä¸‹<code>dist</code>ç›®å½•ä¸­çš„æ–‡ä»¶<br><a name="item-3-3"></a></p>
<h3 id="è§£æwebpackæ‰“åŒ…åçš„æ–‡ä»¶å†…å®¹"><a href="#è§£æwebpackæ‰“åŒ…åçš„æ–‡ä»¶å†…å®¹" class="headerlink" title="è§£æwebpackæ‰“åŒ…åçš„æ–‡ä»¶å†…å®¹"></a>è§£æwebpackæ‰“åŒ…åçš„æ–‡ä»¶å†…å®¹</h3><ul>
<li>webpackè‡ªå·±å®ç°çš„ä¸€å¥—commonjsè§„èŒƒè®²è§£</li>
<li>åŒºåˆ†commonjså’Œesmodule</li>
</ul>
<p>distç›®å½•ç»“æ„</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ index.html</span><br><span class="line">â””â”€â”€ main.js</span><br></pre></td></tr></table></figure>
<p><a name="AsJuz"></a></p>
<h4 id="å…¶ä¸­index-htmlå†…å®¹å¦‚ä¸‹"><a href="#å…¶ä¸­index-htmlå†…å®¹å¦‚ä¸‹" class="headerlink" title="å…¶ä¸­index.htmlå†…å®¹å¦‚ä¸‹"></a>å…¶ä¸­<code>index.html</code>å†…å®¹å¦‚ä¸‹</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ... --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;main.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ... --&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨<code>html-webpack-plugin</code>æ’ä»¶å°†å…¥å£æ–‡ä»¶åŠå…¶ä¾èµ–é€šè¿‡<code>script</code>æ ‡ç­¾å¼•å…¥<br><a name="Tf06E"></a></p>
<h4 id="å…ˆå¯¹main-jså†…å®¹å»æ‰æ³¨é‡Šå’Œæ— å…³å†…å®¹è¿›è¡Œåˆ†æ"><a href="#å…ˆå¯¹main-jså†…å®¹å»æ‰æ³¨é‡Šå’Œæ— å…³å†…å®¹è¿›è¡Œåˆ†æ" class="headerlink" title="å…ˆå¯¹main.jså†…å®¹å»æ‰æ³¨é‡Šå’Œæ— å…³å†…å®¹è¿›è¡Œåˆ†æ"></a>å…ˆå¯¹<code>main.js</code>å†…å®¹å»æ‰æ³¨é‡Šå’Œæ— å…³å†…å®¹è¿›è¡Œåˆ†æ</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">modules</span>) </span>&#123; <span class="comment">// webpackBootstrap</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br><span class="line">(&#123;</span><br><span class="line">  <span class="string">&quot;./src/content.js&quot;</span>:</span><br><span class="line">    (<span class="function"><span class="keyword">function</span> (<span class="params"><span class="built_in">module</span>, <span class="built_in">exports</span></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">eval</span>(<span class="string">&quot;var ret = &#x27;Hello Webpack Hot Module Replacement&#x27;\n\nmodule.exports = ret\n// export default ret\n\n&quot;</span>);</span><br><span class="line">    &#125;),</span><br><span class="line">  <span class="string">&quot;./src/index.js&quot;</span>: (<span class="function"><span class="keyword">function</span> (<span class="params"><span class="built_in">module</span>, <span class="built_in">exports</span>, __webpack_require__</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">eval</span>(<span class="string">&quot;var root = document.getElementById(&#x27;root&#x27;)\nfunction render () &#123;\n  root.innerHTML = __webpack_require__(/*! ./content.js */ \&quot;./src/content.js\&quot;)\n&#125;\nrender()\n\n\n&quot;</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>å¯è§webpackæ‰“åŒ…åä¼šäº§å‡ºä¸€ä¸ªè‡ªæ‰§è¡Œå‡½æ•°ï¼Œå…¶å‚æ•°ä¸ºä¸€ä¸ªå¯¹è±¡</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;./src/content.js&quot;</span>: (<span class="function"><span class="keyword">function</span> (<span class="params"><span class="built_in">module</span>, <span class="built_in">exports</span></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">eval</span>(<span class="string">&quot;...&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é”®ä¸ºå…¥å£æ–‡ä»¶æˆ–ä¾èµ–æ–‡ä»¶ç›¸å¯¹äºæ ¹ç›®å½•çš„ç›¸å¯¹è·¯å¾„ï¼Œå€¼åˆ™æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå…¶ä¸­ä½¿ç”¨<code>eval</code>æ‰§è¡Œæ–‡ä»¶çš„å†…å®¹å­—ç¬¦ã€‚</p>
<ul>
<li><p>å†è¿›å…¥è‡ªæ‰§è¡Œå‡½æ•°ä½“å†…ï¼Œå¯è§webpackè‡ªå·±å®ç°äº†ä¸€å¥—<code>commonjs</code>è§„èŒƒ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">modules</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// æ¨¡å—ç¼“å­˜</span></span><br><span class="line">  <span class="keyword">var</span> installedModules = &#123;&#125;;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__webpack_require__</span>(<span class="params">moduleId</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦æœ‰ç¼“å­˜</span></span><br><span class="line">    <span class="keyword">if</span> (installedModules[moduleId]) &#123;</span><br><span class="line">      <span class="keyword">return</span> installedModules[moduleId].exports;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ²¡æœ‰ç¼“å­˜åˆ™åˆ›å»ºä¸€ä¸ªæ¨¡å—å¯¹è±¡å¹¶å°†å…¶æ”¾å…¥ç¼“å­˜</span></span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">module</span> = installedModules[moduleId] = &#123;</span><br><span class="line">      <span class="attr">i</span>: moduleId,</span><br><span class="line">      <span class="attr">l</span>: <span class="literal">false</span>, <span class="comment">// æ˜¯å¦å·²åŠ è½½</span></span><br><span class="line">      <span class="attr">exports</span>: &#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// æ‰§è¡Œæ¨¡å—å‡½æ•°</span></span><br><span class="line">    modules[moduleId].call(<span class="built_in">module</span>.exports, <span class="built_in">module</span>, <span class="built_in">module</span>.exports, __webpack_require__);</span><br><span class="line">    <span class="comment">// å°†çŠ¶æ€ç½®ä¸ºå·²åŠ è½½</span></span><br><span class="line">    <span class="built_in">module</span>.l = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// è¿”å›æ¨¡å—å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">module</span>.exports;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// åŠ è½½å…¥å£æ–‡ä»¶</span></span><br><span class="line">  <span class="keyword">return</span> __webpack_require__(__webpack_require__.s = <span class="string">&quot;./src/index.js&quot;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>å¦‚æœå¯¹ä¸Šé¢&gt; <code>commonjs</code>è§„èŒƒæ„Ÿå…´è¶£å¯ä»¥å‰å¾€æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« &gt; <a target="_blank" rel="noopener" href="https://github.com/careteenL/blog/blob/master/src/20181201-node/module.md">æ‰‹æ‘¸æ‰‹å¸¦ä½ å®ç°commonjsè§„èŒƒ</a><br>ç»™å‡ºä¸Šé¢ä»£ç ä¸»è¦æ˜¯å…ˆå¯¹webpackçš„äº§å‡ºæ–‡ä»¶æ··ä¸ªçœ¼ç†Ÿï¼Œä¸è¦æƒ§æ€•ã€‚å…¶å®ä»»ä½•ä¸€ä¸ªä¸ç®¡å¤šå¤æ‚çš„äº‹ç‰©éƒ½æ˜¯ç”±æ›´å°æ›´ç®€å•çš„ä¸œè¥¿ç»„æˆï¼Œå‰–å¼€å®ƒè®¤è¯†å®ƒçˆ±ä¸Šå®ƒã€‚<br><a name="item-3-4"></a></p>
<h3 id="é…ç½®HMR"><a href="#é…ç½®HMR" class="headerlink" title="é…ç½®HMR"></a>é…ç½®HMR</h3><p>æ¥ä¸‹æ¥é…ç½®å¹¶æ„Ÿå—ä¸€ä¸‹çƒ­æ›´æ–°å¸¦æ¥çš„ä¾¿æ·å¼€å‘<br /><code>webpack.config.js</code>é…ç½®</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">hot</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br></pre></td></tr></table></figure>
<p><code>./src/index.js</code>é…ç½®</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">  <span class="built_in">module</span>.hot.accept([<span class="string">&#x27;./content.js&#x27;</span>], <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    render()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“æ›´æ”¹<code>./content.js</code>çš„å†…å®¹å¹¶ä¿å­˜æ—¶ï¼Œå¯ä»¥çœ‹åˆ°é¡µé¢æ²¡æœ‰åˆ·æ–°ï¼Œä½†æ˜¯å†…å®¹å·²ç»è¢«æ›¿æ¢äº†ã€‚<br />è¿™å¯¹æé«˜å¼€å‘æ•ˆç‡æ„ä¹‰é‡å¤§ã€‚æ¥ä¸‹æ¥å°†ä¸€å±‚å±‚å‰–å¼€å®ƒï¼Œè®¤è¯†å®ƒçš„å®ç°åŸç†ã€‚<br><a name="item-4"></a></p>
<h2 id="HMRåŸç†"><a href="#HMRåŸç†" class="headerlink" title="HMRåŸç†"></a>HMRåŸç†</h2><p><img src="https://cdn.nlark.com/yuque/0/2020/jpeg/186051/1583939666081-f8da2fc1-bc9b-494d-9376-0c5a4c129876.jpeg#align=left&display=inline&height=1430&originHeight=1430&originWidth=2088&size=0&status=done&style=none&width=2088"><br />å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå³ä¾§<code>Server</code>ç«¯ä½¿ç”¨<code>webpack-dev-server</code>å»å¯åŠ¨æœ¬åœ°æœåŠ¡ï¼Œå†…éƒ¨å®ç°ä¸»è¦ä½¿ç”¨äº†<code>webpack</code>ã€<code>express</code>ã€<code>websocket</code>ã€‚</p>
</li>
<li><p>ä½¿ç”¨<code>express</code>å¯åŠ¨æœ¬åœ°æœåŠ¡ï¼Œå½“æµè§ˆå™¨è®¿é—®èµ„æºæ—¶å¯¹æ­¤åšå“åº”ã€‚</p>
</li>
<li><p>æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä½¿ç”¨<code>websocket</code>å®ç°é•¿è¿æ¥</p>
</li>
<li><p><code>webpack</code>ç›‘å¬æºæ–‡ä»¶çš„å˜åŒ–ï¼Œå³å½“å¼€å‘è€…ä¿å­˜æ–‡ä»¶æ—¶è§¦å‘<code>webpack</code>çš„é‡æ–°ç¼–è¯‘ã€‚</p>
<ul>
<li>æ¯æ¬¡ç¼–è¯‘éƒ½ä¼šç”Ÿæˆ<code>hashå€¼</code>ã€<code>å·²æ”¹åŠ¨æ¨¡å—çš„jsonæ–‡ä»¶</code>ã€<code>å·²æ”¹åŠ¨æ¨¡å—ä»£ç çš„jsæ–‡ä»¶</code></li>
<li>ç¼–è¯‘å®Œæˆåé€šè¿‡<code>socket</code>å‘å®¢æˆ·ç«¯æ¨é€å½“å‰ç¼–è¯‘çš„<code>hashæˆ³</code></li>
</ul>
</li>
<li><p>å®¢æˆ·ç«¯çš„<code>websocket</code>ç›‘å¬åˆ°æœ‰æ–‡ä»¶æ”¹åŠ¨æ¨é€è¿‡æ¥çš„<code>hashæˆ³</code>ï¼Œä¼šå’Œä¸Šä¸€æ¬¡å¯¹æ¯”</p>
<ul>
<li>ä¸€è‡´åˆ™èµ°ç¼“å­˜</li>
<li>ä¸ä¸€è‡´åˆ™é€šè¿‡<code>ajax</code>å’Œ<code>jsonp</code>å‘æœåŠ¡ç«¯è·å–æœ€æ–°èµ„æº</li>
</ul>
</li>
<li><p>ä½¿ç”¨<code>å†…å­˜æ–‡ä»¶ç³»ç»Ÿ</code>å»æ›¿æ¢æœ‰ä¿®æ”¹çš„å†…å®¹å®ç°å±€éƒ¨åˆ·æ–°</p>
</li>
</ul>
<p>ä¸Šå›¾å…ˆåªçœ‹ä¸ªå¤§æ¦‚ï¼Œä¸‹é¢å°†ä»æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¸¤ä¸ªæ–¹é¢è¿›è¡Œè¯¦ç»†åˆ†æ<br><a name="item-5"></a></p>
<h2 id="debugæœåŠ¡ç«¯æºç "><a href="#debugæœåŠ¡ç«¯æºç " class="headerlink" title="debugæœåŠ¡ç«¯æºç "></a>debugæœåŠ¡ç«¯æºç </h2><p><img src="https://cdn.nlark.com/yuque/0/2020/jpeg/186051/1583939666100-67768253-890b-4e3f-abd3-8b313b9dcd75.jpeg#align=left&display=inline&height=1430&originHeight=1430&originWidth=2088&size=0&status=done&style=none&width=2088"><br /><strong>ç°åœ¨ä¹Ÿåªéœ€è¦å…³æ³¨ä¸Šå›¾çš„å³ä¾§æœåŠ¡ç«¯éƒ¨åˆ†ï¼Œå·¦ä¾§å¯ä»¥æš‚æ—¶å¿½ç•¥ã€‚ä¸‹é¢æ­¥éª¤ä¸»è¦æ˜¯debugæœåŠ¡ç«¯æºç åˆ†æå…¶è¯¦ç»†æ€è·¯ï¼Œä¹Ÿç»™å‡ºäº†ä»£ç æ‰€å¤„çš„å…·ä½“ä½ç½®ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å…ˆè¡Œå®šä½åˆ°ä¸‹é¢çš„ä»£ç å¤„è®¾ç½®æ–­ç‚¹ï¼Œç„¶åè§‚å¯Ÿæ•°æ®çš„å˜åŒ–æƒ…å†µã€‚ä¹Ÿå¯ä»¥å…ˆè·³è¿‡é˜…è¯»æ­¤æ­¥éª¤ã€‚</strong></p>
<ol>
<li><p>å¯åŠ¨<code>webpack-dev-server</code>æœåŠ¡å™¨ï¼Œæºä»£ç åœ°å€<a target="_blank" rel="noopener" href="https://github.com/webpack/webpack-dev-server/blob/v3.7.2/bin/webpack-dev-server.js#L173">@webpack-dev-server/webpack-dev-server.js#L173</a></p>
</li>
<li><p>åˆ›å»ºwebpackå®ä¾‹ï¼Œæºä»£ç åœ°å€<a target="_blank" rel="noopener" href="https://github.com/webpack/webpack-dev-server/blob/v3.7.2/bin/webpack-dev-server.js#L89">@webpack-dev-server/webpack-dev-server.js#L89</a></p>
</li>
<li><p>åˆ›å»ºServeræœåŠ¡å™¨ï¼Œæºä»£ç åœ°å€<a target="_blank" rel="noopener" href="https://github.com/webpack/webpack-dev-server/blob/v3.7.2/bin/webpack-dev-server.js#L107">@webpack-dev-server/webpack-dev-server.js#L107</a></p>
</li>
<li><p>æ·»åŠ webpackçš„doneäº‹ä»¶å›è°ƒï¼Œæºä»£ç åœ°å€<a target="_blank" rel="noopener" href="https://github.com/webpack/webpack-dev-server/blob/v3.7.2/lib/Server.js#L122">@webpack-dev-server/Server.js#L122</a></p>
</li>
<li><p>ç¼–è¯‘å®Œæˆå‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼Œæºä»£ç åœ°å€<a target="_blank" rel="noopener" href="https://github.com/webpack/webpack-dev-server/blob/v3.7.2/lib/Server.js#L184">@webpack-dev-server/Server.js#L184</a></p>
</li>
<li><p>åˆ›å»ºexpressåº”ç”¨appï¼Œæºä»£ç åœ°å€<a target="_blank" rel="noopener" href="https://github.com/webpack/webpack-dev-server/blob/v3.7.2/lib/Server.js#L123">@webpack-dev-server/Server.js#L123</a></p>
</li>
<li><p>è®¾ç½®æ–‡ä»¶ç³»ç»Ÿä¸ºå†…å­˜æ–‡ä»¶ç³»ç»Ÿï¼Œæºä»£ç åœ°å€<a target="_blank" rel="noopener" href="https://github.com/webpack/webpack-dev-middleware/blob/v3.7.0/lib/fs.js#L115">@webpack-dev-middleware/fs.js#L115</a></p>
</li>
<li><p>æ·»åŠ webpack-dev-middlewareä¸­é—´ä»¶ï¼Œæºä»£ç åœ°å€<a target="_blank" rel="noopener" href="https://github.com/webpack/webpack-dev-server/blob/v3.7.2/lib/Server.js#L125">@webpack-dev-server/Server.js#L125</a></p>
</li>
<li><p>ä¸­é—´ä»¶è´Ÿè´£è¿”å›ç”Ÿæˆçš„æ–‡ä»¶ï¼Œæºä»£ç åœ°å€<a target="_blank" rel="noopener" href="https://github.com/webpack/webpack-dev-middleware/blob/v3.7.0/lib/middleware.js#L20">@webpack-dev-middleware/middleware.js#L20</a></p>
</li>
<li><p>å¯åŠ¨webpackç¼–è¯‘ï¼Œæºä»£ç åœ°å€<a target="_blank" rel="noopener" href="https://github.com/webpack/webpack-dev-middleware/blob/v3.7.0/index.js#L51">@webpack-dev-middleware/index.js#L51</a></p>
</li>
<li><p>åˆ›å»ºhttpæœåŠ¡å™¨å¹¶å¯åŠ¨æœåŠ¡ï¼Œæºä»£ç åœ°å€<a target="_blank" rel="noopener" href="https://github.com/webpack/webpack-dev-server/blob/v3.7.2/lib/Server.js#L135">@webpack-dev-server/Server.js#L135</a></p>
</li>
<li><p>ä½¿ç”¨sockjsåœ¨æµè§ˆå™¨ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´å»ºç«‹ä¸€ä¸ª websocket é•¿è¿æ¥ï¼Œæºä»£ç åœ°å€<a target="_blank" rel="noopener" href="https://github.com/webpack/webpack-dev-server/blob/v3.7.2/lib/Server.js#L745">@webpack-dev-server/Server.js#L745</a></p>
</li>
<li><p>åˆ›å»ºsocketæœåŠ¡å™¨ï¼Œæºä»£ç åœ°å€<a target="_blank" rel="noopener" href="https://github.com/webpack/webpack-dev-server/blob/v3.7.2/lib/servers/SockJSServer.js#L34">@webpack-dev-server/SockJSServer.js#L34</a><br><a name="item-5-5"></a></p>
<h3 id="æœåŠ¡ç«¯ç®€æ˜“å®ç°"><a href="#æœåŠ¡ç«¯ç®€æ˜“å®ç°" class="headerlink" title="æœåŠ¡ç«¯ç®€æ˜“å®ç°"></a>æœåŠ¡ç«¯ç®€æ˜“å®ç°</h3><p>ä¸Šé¢æ˜¯æˆ‘é€šè¿‡debugå¾—å‡ºdev-serverè¿è¡Œæµç¨‹æ¯”è¾ƒæ ¸å¿ƒçš„å‡ ä¸ªç‚¹ï¼Œä¸‹é¢å°†å…¶<a target="_blank" rel="noopener" href="https://github.com/careteenL/webpack-hmr/blob/master/dev-server.js">æŠ½è±¡æ•´åˆåˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­</a>ã€‚<br><a name="2zgyu"></a></p>
<h4 id="å¯åŠ¨webpack-dev-serveræœåŠ¡å™¨"><a href="#å¯åŠ¨webpack-dev-serveræœåŠ¡å™¨" class="headerlink" title="å¯åŠ¨webpack-dev-serveræœåŠ¡å™¨"></a>å¯åŠ¨webpack-dev-serveræœåŠ¡å™¨</h4><p>å…ˆå¯¼å…¥æ‰€æœ‰ä¾èµ–</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>) <span class="comment">// è§£ææ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>) <span class="comment">// å¯åŠ¨æœ¬åœ°æœåŠ¡</span></span><br><span class="line"><span class="keyword">const</span> mime = <span class="built_in">require</span>(<span class="string">&#x27;mime&#x27;</span>) <span class="comment">// è·å–æ–‡ä»¶ç±»å‹ å®ç°ä¸€ä¸ªé™æ€æœåŠ¡å™¨</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>) <span class="comment">// è¯»å–é…ç½®æ–‡ä»¶è¿›è¡Œæ‰“åŒ…</span></span><br><span class="line"><span class="keyword">const</span> MemoryFileSystem = <span class="built_in">require</span>(<span class="string">&#x27;memory-fs&#x27;</span>) <span class="comment">// ä½¿ç”¨å†…å­˜æ–‡ä»¶ç³»ç»Ÿæ›´å¿«ï¼Œæ–‡ä»¶ç”Ÿæˆåœ¨å†…å­˜ä¸­è€ŒéçœŸå®æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.config&#x27;</span>) <span class="comment">// è·å–webpacké…ç½®æ–‡ä»¶</span></span><br></pre></td></tr></table></figure>
<p><a name="juOkB"></a></p>
<h4 id="åˆ›å»ºwebpackå®ä¾‹"><a href="#åˆ›å»ºwebpackå®ä¾‹" class="headerlink" title="åˆ›å»ºwebpackå®ä¾‹"></a>åˆ›å»ºwebpackå®ä¾‹</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> compiler = webpack(config)</span><br></pre></td></tr></table></figure>
<p>compilerä»£è¡¨æ•´ä¸ªwebpackç¼–è¯‘ä»»åŠ¡ï¼Œå…¨å±€åªæœ‰ä¸€ä¸ª<br><a name="zSNHn"></a></p>
<h4 id="åˆ›å»ºServeræœåŠ¡å™¨"><a href="#åˆ›å»ºServeræœåŠ¡å™¨" class="headerlink" title="åˆ›å»ºServeræœåŠ¡å™¨"></a>åˆ›å»ºServeræœåŠ¡å™¨</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Server</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">compiler</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.compiler = compiler</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">listen</span>(<span class="params">port</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.server.listen(port, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`æœåŠ¡å™¨å·²ç»åœ¨<span class="subst">$&#123;port&#125;</span>ç«¯å£ä¸Šå¯åŠ¨äº†`</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> server = <span class="keyword">new</span> Server(compiler)</span><br><span class="line">server.listen(<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>
<p>åœ¨åé¢æ˜¯é€šè¿‡expressæ¥å½“å¯åŠ¨æœåŠ¡çš„<br><a name="1u6aE"></a></p>
<h4 id="æ·»åŠ webpackçš„doneäº‹ä»¶å›è°ƒ"><a href="#æ·»åŠ webpackçš„doneäº‹ä»¶å›è°ƒ" class="headerlink" title="æ·»åŠ webpackçš„doneäº‹ä»¶å›è°ƒ"></a>æ·»åŠ webpackçš„doneäº‹ä»¶å›è°ƒ</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">constructor</span>(<span class="params">compiler</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> sockets = []</span><br><span class="line">    <span class="keyword">let</span> lasthash</span><br><span class="line">    compiler.hooks.done.tap(<span class="string">&#x27;webpack-dev-server&#x27;</span>, <span class="function">(<span class="params">stats</span>) =&gt;</span> &#123;</span><br><span class="line">      lasthash = stats.hash</span><br><span class="line">      <span class="comment">// æ¯å½“æ–°ä¸€ä¸ªç¼–è¯‘å®Œæˆåéƒ½ä¼šå‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</span></span><br><span class="line">      sockets.forEach(<span class="function"><span class="params">socket</span> =&gt;</span> &#123;</span><br><span class="line">        socket.emit(<span class="string">&#x27;hash&#x27;</span>, stats.hash) <span class="comment">// å…ˆå‘å®¢æˆ·ç«¯å‘é€æœ€æ–°çš„hashå€¼</span></span><br><span class="line">        socket.emit(<span class="string">&#x27;ok&#x27;</span>) <span class="comment">// å†å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªok</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p><code>webpack</code>ç¼–è¯‘åæä¾›æä¾›äº†ä¸€ç³»åˆ—é’©å­å‡½æ•°ï¼Œä»¥ä¾›æ’ä»¶èƒ½è®¿é—®åˆ°å®ƒçš„å„ä¸ªç”Ÿå‘½å‘¨æœŸèŠ‚ç‚¹ï¼Œå¹¶å¯¹å…¶æ‰“åŒ…å†…å®¹åšä¿®æ”¹ã€‚<code>compiler.hooks.done</code>åˆ™æ˜¯æ’ä»¶èƒ½ä¿®æ”¹å…¶å†…å®¹çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ã€‚<br />ç¼–è¯‘å®Œæˆé€šè¿‡<code>socket</code>å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼Œæ¨é€æ¯æ¬¡ç¼–è¯‘äº§ç”Ÿçš„<code>hash</code>ã€‚å¦å¤–å¦‚æœæ˜¯çƒ­æ›´æ–°çš„è¯ï¼Œè¿˜ä¼šäº§å‡ºäºŒä¸ªè¡¥ä¸æ–‡ä»¶ï¼Œé‡Œé¢æè¿°äº†ä»ä¸Šä¸€æ¬¡ç»“æœåˆ°è¿™ä¸€æ¬¡ç»“æœéƒ½æœ‰å“ªäº›chunkå’Œæ¨¡å—å‘ç”Ÿäº†å˜åŒ–ã€‚<br />ä½¿ç”¨<code>let sockets = []</code>æ•°ç»„å»å­˜æ”¾å½“æ‰“å¼€äº†å¤šä¸ªTabæ—¶æ¯ä¸ªTabçš„<code>socketå®ä¾‹</code>ã€‚<br><a name="xz9K1"></a></p>
<h4 id="åˆ›å»ºexpressåº”ç”¨app"><a href="#åˆ›å»ºexpressåº”ç”¨app" class="headerlink" title="åˆ›å»ºexpressåº”ç”¨app"></a>åˆ›å»ºexpressåº”ç”¨app</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> app = <span class="keyword">new</span> express()</span><br></pre></td></tr></table></figure>
<p><a name="szEAX"></a></p>
<h4 id="è®¾ç½®æ–‡ä»¶ç³»ç»Ÿä¸ºå†…å­˜æ–‡ä»¶ç³»ç»Ÿ"><a href="#è®¾ç½®æ–‡ä»¶ç³»ç»Ÿä¸ºå†…å­˜æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="è®¾ç½®æ–‡ä»¶ç³»ç»Ÿä¸ºå†…å­˜æ–‡ä»¶ç³»ç»Ÿ"></a>è®¾ç½®æ–‡ä»¶ç³»ç»Ÿä¸ºå†…å­˜æ–‡ä»¶ç³»ç»Ÿ</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fs = <span class="keyword">new</span> MemoryFileSystem()</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨<code>MemoryFileSystem</code>å°†<code>compiler</code>çš„äº§å‡ºæ–‡ä»¶æ‰“åŒ…åˆ°å†…å­˜ä¸­ã€‚<br><a name="bUYUN"></a></p>
<h4 id="æ·»åŠ webpack-dev-middlewareä¸­é—´ä»¶"><a href="#æ·»åŠ webpack-dev-middlewareä¸­é—´ä»¶" class="headerlink" title="æ·»åŠ webpack-dev-middlewareä¸­é—´ä»¶"></a>æ·»åŠ webpack-dev-middlewareä¸­é—´ä»¶</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">middleware</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (req.url === <span class="string">&#x27;/favicon.ico&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.sendStatus(<span class="number">404</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// /index.html   dist/index.html</span></span><br><span class="line">    <span class="keyword">let</span> filename = path.join(config.output.path, req.url.slice(<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">let</span> stat = fs.statSync(filename)</span><br><span class="line">    <span class="keyword">if</span> (stat.isFile()) &#123; <span class="comment">// åˆ¤æ–­æ˜¯å¦å­˜åœ¨è¿™ä¸ªæ–‡ä»¶,å¦‚æœåœ¨çš„è¯ç›´æ¥æŠŠè¿™ä¸ªè¯»å‡ºæ¥å‘ç»™æµè§ˆå™¨</span></span><br><span class="line">      <span class="keyword">let</span> content = fs.readFileSync(filename)</span><br><span class="line">      <span class="keyword">let</span> contentType = mime.getType(filename)</span><br><span class="line">      res.setHeader(<span class="string">&#x27;Content-Type&#x27;</span>, contentType)</span><br><span class="line">      res.statusCode = res.statusCode || <span class="number">200</span></span><br><span class="line">      res.send(content)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> res.sendStatus(<span class="number">404</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  app.use(middleware)</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨expreså¯åŠ¨äº†æœ¬åœ°å¼€å‘æœåŠ¡åï¼Œä½¿ç”¨ä¸­é—´ä»¶å»ä¸ºå…¶æ„é€ ä¸€ä¸ªé™æ€æœåŠ¡å™¨ï¼Œå¹¶ä½¿ç”¨äº†å†…å­˜æ–‡ä»¶ç³»ç»Ÿï¼Œä½¿è¯»å–æ–‡ä»¶åå­˜æ”¾åˆ°å†…å­˜ä¸­ï¼Œæé«˜è¯»å†™æ•ˆç‡ï¼Œæœ€ç»ˆè¿”å›ç”Ÿæˆçš„æ–‡ä»¶ã€‚<br><a name="Vjj1z"></a></p>
<h4 id="å¯åŠ¨webpackç¼–è¯‘"><a href="#å¯åŠ¨webpackç¼–è¯‘" class="headerlink" title="å¯åŠ¨webpackç¼–è¯‘"></a>å¯åŠ¨webpackç¼–è¯‘</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">compiler.watch(&#123;&#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;åˆä¸€æ¬¡ç¼–è¯‘ä»»åŠ¡æˆåŠŸå®Œæˆäº†&#x27;</span>)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p>ä»¥ç›‘æ§çš„æ¨¡å¼å¯åŠ¨ä¸€æ¬¡webpackç¼–è¯‘ï¼Œå½“ç¼–è¯‘æˆåŠŸä¹‹åæ‰§è¡Œå›è°ƒ<br><a name="CLwCf"></a></p>
<h4 id="åˆ›å»ºhttpæœåŠ¡å™¨å¹¶å¯åŠ¨æœåŠ¡"><a href="#åˆ›å»ºhttpæœåŠ¡å™¨å¹¶å¯åŠ¨æœåŠ¡" class="headerlink" title="åˆ›å»ºhttpæœåŠ¡å™¨å¹¶å¯åŠ¨æœåŠ¡"></a>åˆ›å»ºhttpæœåŠ¡å™¨å¹¶å¯åŠ¨æœåŠ¡</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">constructor</span>(<span class="params">compiler</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="built_in">this</span>.server = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>).createServer(app)</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">listen</span>(<span class="params">port</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.server.listen(port, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`æœåŠ¡å™¨å·²ç»åœ¨<span class="subst">$&#123;port&#125;</span>ç«¯å£ä¸Šå¯åŠ¨äº†`</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p><a name="2ghPp"></a></p>
<h4 id="ä½¿ç”¨sockjsåœ¨æµè§ˆå™¨ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´å»ºç«‹ä¸€ä¸ª-websocket-é•¿è¿æ¥"><a href="#ä½¿ç”¨sockjsåœ¨æµè§ˆå™¨ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´å»ºç«‹ä¸€ä¸ª-websocket-é•¿è¿æ¥" class="headerlink" title="ä½¿ç”¨sockjsåœ¨æµè§ˆå™¨ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´å»ºç«‹ä¸€ä¸ª websocket é•¿è¿æ¥"></a>ä½¿ç”¨sockjsåœ¨æµè§ˆå™¨ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´å»ºç«‹ä¸€ä¸ª websocket é•¿è¿æ¥</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">constructor</span>(<span class="params">compiler</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="built_in">this</span>.server = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>).createServer(app)</span><br><span class="line">    <span class="keyword">let</span> io = <span class="built_in">require</span>(<span class="string">&#x27;socket.io&#x27;</span>)(<span class="built_in">this</span>.server)</span><br><span class="line">    io.on(<span class="string">&#x27;connection&#x27;</span>, <span class="function">(<span class="params">socket</span>) =&gt;</span> &#123;</span><br><span class="line">      sockets.push(socket)</span><br><span class="line">      socket.emit(<span class="string">&#x27;hash&#x27;</span>, lastHash)</span><br><span class="line">      socket.emit(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨ä¸€ä¸ª websocketæœåŠ¡å™¨ï¼Œç„¶åç­‰å¾…è¿æ¥æ¥åˆ°ï¼Œè¿æ¥åˆ°æ¥ä¹‹åå­˜è¿›socketsæ± <br />å½“æœ‰æ–‡ä»¶æ”¹åŠ¨ï¼Œwebpacké‡æ–°ç¼–è¯‘æ—¶ï¼Œå‘å®¢æˆ·ç«¯æ¨é€<code>hash</code>å’Œ<code>ok</code>ä¸¤ä¸ªäº‹ä»¶<br><a name="item-5-6"></a></p>
<h3 id="æœåŠ¡ç«¯è°ƒè¯•é˜¶æ®µ"><a href="#æœåŠ¡ç«¯è°ƒè¯•é˜¶æ®µ" class="headerlink" title="æœåŠ¡ç«¯è°ƒè¯•é˜¶æ®µ"></a>æœåŠ¡ç«¯è°ƒè¯•é˜¶æ®µ</h3><p>æ„Ÿå…´è¶£çš„å¯ä»¥æ ¹æ®ä¸Šé¢<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000020310371#debug%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%BA%90%E7%A0%81">debugæœåŠ¡ç«¯æºç </a>æ‰€å¸¦çš„æºç ä½ç½®ï¼Œå¹¶åœ¨æµè§ˆå™¨çš„è°ƒè¯•æ¨¡å¼ä¸‹è®¾ç½®æ–­ç‚¹æŸ¥çœ‹æ¯ä¸ªé˜¶æ®µçš„å€¼ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node dev-server.js</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨æˆ‘ä»¬è‡ªå·±ç¼–è¯‘çš„<code>dev-server.js</code>å¯åŠ¨æœåŠ¡ï¼Œå¯çœ‹åˆ°é¡µé¢å¯ä»¥æ­£å¸¸å±•ç¤ºï¼Œä½†è¿˜æ²¡æœ‰å®ç°çƒ­æ›´æ–°ã€‚<br />ä¸‹é¢å°†è°ƒå¼å®¢æˆ·ç«¯çš„æºä»£ç åˆ†æå…¶å®ç°æµç¨‹ã€‚<br><a name="item-6"></a></p>
<h2 id="debugå®¢æˆ·ç«¯æºç "><a href="#debugå®¢æˆ·ç«¯æºç " class="headerlink" title="debugå®¢æˆ·ç«¯æºç "></a>debugå®¢æˆ·ç«¯æºç </h2><p><img src="https://cdn.nlark.com/yuque/0/2020/jpeg/186051/1583939666119-c372f841-c5ce-41ac-835c-ec0dbaa8031c.jpeg#align=left&display=inline&height=1430&originHeight=1430&originWidth=2088&size=0&status=done&style=none&width=2088"><br /><strong>ç°åœ¨ä¹Ÿåªéœ€è¦å…³æ³¨ä¸Šå›¾çš„å·¦ä¾§å®¢æˆ·ç«¯éƒ¨åˆ†ï¼Œå³ä¾§å¯ä»¥æš‚æ—¶å¿½ç•¥ã€‚ä¸‹é¢æ­¥éª¤ä¸»è¦æ˜¯debugå®¢æˆ·ç«¯æºç åˆ†æå…¶è¯¦ç»†æ€è·¯ï¼Œä¹Ÿç»™å‡ºäº†ä»£ç æ‰€å¤„çš„å…·ä½“ä½ç½®ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å…ˆè¡Œå®šä½åˆ°ä¸‹é¢çš„ä»£ç å¤„è®¾ç½®æ–­ç‚¹ï¼Œç„¶åè§‚å¯Ÿæ•°æ®çš„å˜åŒ–æƒ…å†µã€‚ä¹Ÿå¯ä»¥å…ˆè·³è¿‡é˜…è¯»æ­¤æ­¥éª¤ã€‚</strong><br />debugå®¢æˆ·ç«¯æºç åˆ†æå…¶è¯¦ç»†æ€è·¯</p>
</li>
<li><p>webpack-dev-server/clientç«¯ä¼šç›‘å¬åˆ°æ­¤hashæ¶ˆæ¯ï¼Œæºä»£ç åœ°å€<a target="_blank" rel="noopener" href="https://github.com/webpack/webpack-dev-server/blob/v3.7.2/client-src/default/index.js#L54">@webpack-dev-server/index.js#L54</a></p>
</li>
<li><p>å®¢æˆ·ç«¯æ”¶åˆ°okçš„æ¶ˆæ¯åä¼šæ‰§è¡ŒreloadAppæ–¹æ³•è¿›è¡Œæ›´æ–°ï¼Œæºä»£ç åœ°å€<a target="_blank" rel="noopener" href="https://github.com/webpack/webpack-dev-server/blob/v3.7.2/client-src/default/index.js#L101">index.js#L101</a></p>
</li>
<li><p>åœ¨reloadAppä¸­ä¼šè¿›è¡Œåˆ¤æ–­ï¼Œæ˜¯å¦æ”¯æŒçƒ­æ›´æ–°ï¼Œå¦‚æœæ”¯æŒçš„è¯å‘å°„webpackHotUpdateäº‹ä»¶ï¼Œå¦‚æœä¸æ”¯æŒåˆ™ç›´æ¥åˆ·æ–°æµè§ˆå™¨ï¼Œæºä»£ç åœ°å€<a target="_blank" rel="noopener" href="https://github.com/webpack/webpack-dev-server/blob/v3.7.2/client-src/default/utils/reloadApp.js#L7">reloadApp.js#L7</a></p>
</li>
<li><p>åœ¨webpack/hot/dev-server.jsä¼šç›‘å¬webpackHotUpdateäº‹ä»¶ï¼Œæºä»£ç åœ°å€<a target="_blank" rel="noopener" href="https://github.com/webpack/webpack/blob/v4.39.1/hot/dev-server.js#L55">dev-server.js#L55</a></p>
</li>
<li><p>åœ¨checkæ–¹æ³•é‡Œä¼šè°ƒç”¨module.hot.checkæ–¹æ³•ï¼Œæºä»£ç åœ°å€<a target="_blank" rel="noopener" href="https://github.com/webpack/webpack/blob/v4.39.1/hot/dev-server.js#L13">dev-server.js#L13</a></p>
</li>
<li><p>HotModuleReplacement.runtimeè¯·æ±‚Manifestï¼Œæºä»£ç åœ°å€<a target="_blank" rel="noopener" href="https://github.com/webpack/webpack/blob/v4.39.1/lib/HotModuleReplacement.runtime.js#L180">HotModuleReplacement.runtime.js#L180</a></p>
</li>
<li><p>å®ƒé€šè¿‡è°ƒç”¨ JsonpMainTemplate.runtimeçš„hotDownloadManifestæ–¹æ³•ï¼Œæºä»£ç åœ°å€<a target="_blank" rel="noopener" href="https://github.com/webpack/webpack/blob/v4.39.1/lib/web/JsonpMainTemplate.runtime.js#L23">JsonpMainTemplate.runtime.js#L23</a></p>
</li>
<li><p>è°ƒç”¨JsonpMainTemplate.runtimeçš„hotDownloadUpdateChunkæ–¹æ³•é€šè¿‡JSONPè¯·æ±‚è·å–åˆ°æœ€æ–°çš„æ¨¡å—ä»£ç ï¼Œæºä»£ç åœ°å€<a target="_blank" rel="noopener" href="https://github.com/webpack/webpack/blob/v4.39.1/lib/web/JsonpMainTemplate.runtime.js#L14">JsonpMainTemplate.runtime.js#L14</a></p>
</li>
<li><p>è¡¥ä¸JSå–å›æ¥åä¼šè°ƒç”¨JsonpMainTemplate.runtime.jsçš„webpackHotUpdateæ–¹æ³•ï¼Œæºä»£ç åœ°å€<a target="_blank" rel="noopener" href="https://github.com/webpack/webpack/blob/v4.39.1/lib/web/JsonpMainTemplate.runtime.js#L8">JsonpMainTemplate.runtime.js#L8</a></p>
</li>
<li><p>ç„¶åä¼šè°ƒç”¨HotModuleReplacement.runtime.jsçš„hotAddUpdateChunkæ–¹æ³•åŠ¨æ€æ›´æ–°æ¨¡å—ä»£ç ï¼Œæºä»£ç åœ°å€<a target="_blank" rel="noopener" href="https://github.com/webpack/webpack/blob/v4.39.1/lib/HotModuleReplacement.runtime.js#L222">HotModuleReplacement.runtime.js#L222</a></p>
</li>
<li><p>ç„¶åè°ƒç”¨hotApplyæ–¹æ³•è¿›è¡Œçƒ­æ›´æ–°ï¼Œæºä»£ç åœ°å€<a target="_blank" rel="noopener" href="https://github.com/webpack/webpack/blob/v4.39.1/lib/HotModuleReplacement.runtime.js#L257">HotModuleReplacement.runtime.js#L257</a>ã€<a target="_blank" rel="noopener" href="https://github.com/webpack/webpack/blob/v4.39.1/lib/HotModuleReplacement.runtime.js#L278">HotModuleReplacement.runtime.js#L278</a><br><a name="item-6-7"></a></p>
<h3 id="å®¢æˆ·ç«¯ç®€æ˜“å®ç°"><a href="#å®¢æˆ·ç«¯ç®€æ˜“å®ç°" class="headerlink" title="å®¢æˆ·ç«¯ç®€æ˜“å®ç°"></a>å®¢æˆ·ç«¯ç®€æ˜“å®ç°</h3><p>ä¸Šé¢æ˜¯æˆ‘é€šè¿‡debugå¾—å‡ºdev-serverè¿è¡Œæµç¨‹æ¯”è¾ƒæ ¸å¿ƒçš„å‡ ä¸ªç‚¹ï¼Œä¸‹é¢å°†å…¶<a target="_blank" rel="noopener" href="https://github.com/careteenL/webpack-hmr/blob/master/src/client.js">æŠ½è±¡æ•´åˆæˆä¸€ä¸ªæ–‡ä»¶</a>ã€‚<br><a name="NUr0h"></a></p>
<h4 id="webpack-dev-server-clientç«¯ä¼šç›‘å¬åˆ°æ­¤hashæ¶ˆæ¯"><a href="#webpack-dev-server-clientç«¯ä¼šç›‘å¬åˆ°æ­¤hashæ¶ˆæ¯" class="headerlink" title="webpack-dev-server/clientç«¯ä¼šç›‘å¬åˆ°æ­¤hashæ¶ˆæ¯"></a>webpack-dev-server/clientç«¯ä¼šç›‘å¬åˆ°æ­¤hashæ¶ˆæ¯</h4><p>åœ¨å¼€å‘å®¢æˆ·ç«¯åŠŸèƒ½ä¹‹å‰ï¼Œéœ€è¦åœ¨<code>src/index.html</code>ä¸­å¼•å…¥<code>socket.io</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/socket.io/socket.io.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢è¿æ¥socketå¹¶æ¥å—æ¶ˆæ¯</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> socket = io(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">socket.on(<span class="string">&#x27;connect&#x27;</span>, onConnected)</span><br><span class="line"><span class="keyword">const</span> onConnected = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;å®¢æˆ·ç«¯è¿æ¥æˆåŠŸ&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> hotCurrentHash <span class="comment">// lastHash ä¸Šä¸€æ¬¡ hashå€¼ </span></span><br><span class="line"><span class="keyword">let</span> currentHash <span class="comment">// è¿™ä¸€æ¬¡çš„hashå€¼</span></span><br><span class="line">socket.on(<span class="string">&#x27;hash&#x27;</span>, <span class="function">(<span class="params">hash</span>) =&gt;</span> &#123;</span><br><span class="line">  currentHash = hash</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>å°†æœåŠ¡ç«¯webpackæ¯æ¬¡ç¼–è¯‘æ‰€äº§ç”Ÿ<code>hash</code>è¿›è¡Œç¼“å­˜<br><a name="uvtiH"></a></p>
<h4 id="å®¢æˆ·ç«¯æ”¶åˆ°okçš„æ¶ˆæ¯åä¼šæ‰§è¡ŒreloadAppæ–¹æ³•è¿›è¡Œæ›´æ–°"><a href="#å®¢æˆ·ç«¯æ”¶åˆ°okçš„æ¶ˆæ¯åä¼šæ‰§è¡ŒreloadAppæ–¹æ³•è¿›è¡Œæ›´æ–°" class="headerlink" title="å®¢æˆ·ç«¯æ”¶åˆ°okçš„æ¶ˆæ¯åä¼šæ‰§è¡ŒreloadAppæ–¹æ³•è¿›è¡Œæ›´æ–°"></a>å®¢æˆ·ç«¯æ”¶åˆ°okçš„æ¶ˆæ¯åä¼šæ‰§è¡ŒreloadAppæ–¹æ³•è¿›è¡Œæ›´æ–°</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">socket.on(<span class="string">&#x27;ok&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  reloadApp(<span class="literal">true</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><a name="ZbSqA"></a></p>
<h4 id="reloadAppä¸­åˆ¤æ–­æ˜¯å¦æ”¯æŒçƒ­æ›´æ–°"><a href="#reloadAppä¸­åˆ¤æ–­æ˜¯å¦æ”¯æŒçƒ­æ›´æ–°" class="headerlink" title="reloadAppä¸­åˆ¤æ–­æ˜¯å¦æ”¯æŒçƒ­æ›´æ–°"></a>reloadAppä¸­åˆ¤æ–­æ˜¯å¦æ”¯æŒçƒ­æ›´æ–°</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å½“æ”¶åˆ°okäº‹ä»¶åï¼Œä¼šé‡æ–°åˆ·æ–°app</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reloadApp</span>(<span class="params">hot</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (hot) &#123; <span class="comment">// å¦‚æœhotä¸ºtrue èµ°çƒ­æ›´æ–°çš„é€»è¾‘</span></span><br><span class="line">    hotEmitter.emit(<span class="string">&#x27;webpackHotUpdate&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// å¦‚æœä¸æ”¯æŒçƒ­æ›´æ–°ï¼Œåˆ™ç›´æ¥é‡æ–°åŠ è½½</span></span><br><span class="line">    <span class="built_in">window</span>.location.reload()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨reloadAppä¸­ä¼šè¿›è¡Œåˆ¤æ–­ï¼Œæ˜¯å¦æ”¯æŒçƒ­æ›´æ–°ï¼Œå¦‚æœæ”¯æŒçš„è¯å‘å°„webpackHotUpdateäº‹ä»¶ï¼Œå¦‚æœä¸æ”¯æŒåˆ™ç›´æ¥åˆ·æ–°æµè§ˆå™¨ã€‚<br><a name="KZYCi"></a></p>
<h4 id="åœ¨webpack-hot-dev-server-jsä¼šç›‘å¬webpackHotUpdateäº‹ä»¶"><a href="#åœ¨webpack-hot-dev-server-jsä¼šç›‘å¬webpackHotUpdateäº‹ä»¶" class="headerlink" title="åœ¨webpack/hot/dev-server.jsä¼šç›‘å¬webpackHotUpdateäº‹ä»¶"></a>åœ¨webpack/hot/dev-server.jsä¼šç›‘å¬webpackHotUpdateäº‹ä»¶</h4><p>é¦–å…ˆéœ€è¦ä¸€ä¸ªå‘å¸ƒè®¢é˜…å»ç»‘å®šäº‹ä»¶å¹¶åœ¨åˆé€‚çš„æ—¶æœºè§¦å‘ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Emitter</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.listeners = &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">on</span>(<span class="params">type, listener</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.listeners[type] = listener</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">emit</span>(<span class="params">type</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.listeners[type] &amp;&amp; <span class="built_in">this</span>.listeners[type]()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> hotEmitter = <span class="keyword">new</span> Emitter()</span><br><span class="line">hotEmitter.on(<span class="string">&#x27;webpackHotUpdate&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!hotCurrentHash || hotCurrentHash == currentHash) &#123;</span><br><span class="line">    <span class="keyword">return</span> hotCurrentHash = currentHash</span><br><span class="line">  &#125;</span><br><span class="line">  hotCheck()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>ä¼šåˆ¤æ–­æ˜¯å¦ä¸ºç¬¬ä¸€æ¬¡è¿›å…¥é¡µé¢å’Œä»£ç æ˜¯å¦æœ‰æ›´æ–°ã€‚<br>ä¸Šé¢çš„å‘å¸ƒè®¢é˜…è¾ƒä¸ºç®€å•ï¼Œä¸”åªæ”¯æŒå…ˆå‘å¸ƒåè®¢é˜…åŠŸèƒ½ã€‚å¯¹äºä¸€äº›è¾ƒä¸ºå¤æ‚çš„åœºæ™¯å¯èƒ½éœ€è¦å…ˆè®¢é˜…åå‘å¸ƒï¼Œæ­¤æ—¶å¯ä»¥ç§»æ­¥&gt; <a target="_blank" rel="noopener" href="https://github.com/careteenL/event-emitter">@careteen/event-emitter</a>ã€‚å…¶å®ç°åŸç†ä¹ŸæŒºç®€å•ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªç¦»çº¿äº‹ä»¶æ ˆå­˜æ”¾è¿˜æ²¡å‘å¸ƒå°±è®¢é˜…çš„äº‹ä»¶ï¼Œç­‰åˆ°è®¢é˜…æ—¶å¯ä»¥å–å‡ºæ‰€æœ‰äº‹ä»¶æ‰§è¡Œã€‚<br><a name="IOT6r"></a></p>
<h4 id="åœ¨checkæ–¹æ³•é‡Œä¼šè°ƒç”¨module-hot-checkæ–¹æ³•"><a href="#åœ¨checkæ–¹æ³•é‡Œä¼šè°ƒç”¨module-hot-checkæ–¹æ³•" class="headerlink" title="åœ¨checkæ–¹æ³•é‡Œä¼šè°ƒç”¨module.hot.checkæ–¹æ³•"></a>åœ¨checkæ–¹æ³•é‡Œä¼šè°ƒç”¨module.hot.checkæ–¹æ³•</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hotCheck</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  hotDownloadManifest().then(<span class="function"><span class="params">update</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> chunkIds = <span class="built_in">Object</span>.keys(update.c)</span><br><span class="line">    chunkIds.forEach(<span class="function"><span class="params">chunkId</span> =&gt;</span> &#123;</span><br><span class="line">      hotDownloadUpdateChunk(chunkId)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä¹Ÿæåˆ°è¿‡webpackæ¯æ¬¡ç¼–è¯‘éƒ½ä¼šäº§ç”Ÿ<code>hashå€¼</code>ã€<code>å·²æ”¹åŠ¨æ¨¡å—çš„jsonæ–‡ä»¶</code>ã€<code>å·²æ”¹åŠ¨æ¨¡å—ä»£ç çš„jsæ–‡ä»¶</code>ï¼Œ<br />æ­¤æ—¶å…ˆä½¿ç”¨<code>ajax</code>è¯·æ±‚<code>Manifest</code>å³æœåŠ¡å™¨è¿™ä¸€æ¬¡ç¼–è¯‘ç›¸å¯¹äºä¸Šä¸€æ¬¡ç¼–è¯‘æ”¹å˜äº†å“ªäº›moduleå’Œchunkã€‚<br />ç„¶åå†é€šè¿‡<code>jsonp</code>è·å–è¿™äº›å·²æ”¹åŠ¨çš„moduleå’Œchunkçš„ä»£ç ã€‚<br><a name="vjb3D"></a></p>
<h4 id="è°ƒç”¨hotDownloadManifestæ–¹æ³•"><a href="#è°ƒç”¨hotDownloadManifestæ–¹æ³•" class="headerlink" title="è°ƒç”¨hotDownloadManifestæ–¹æ³•"></a>è°ƒç”¨hotDownloadManifestæ–¹æ³•</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hotDownloadManifest</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> request = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">    <span class="comment">//hot-update.jsonæ–‡ä»¶é‡Œå­˜æ”¾ç€ä»ä¸Šä¸€æ¬¡ç¼–è¯‘åˆ°è¿™ä¸€æ¬¡ç¼–è¯‘ å–åˆ°å·®å¼‚</span></span><br><span class="line">    <span class="keyword">let</span> requestPath = <span class="string">&#x27;/&#x27;</span> + hotCurrentHash + <span class="string">&quot;.hot-update.json&quot;</span></span><br><span class="line">    request.open(<span class="string">&#x27;GET&#x27;</span>, requestPath, <span class="literal">true</span>)</span><br><span class="line">    request.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (request.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> update = <span class="built_in">JSON</span>.parse(request.responseText)</span><br><span class="line">        resolve(update)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    request.send()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a name="ndg3N"></a></p>
<h4 id="è°ƒç”¨hotDownloadUpdateChunkæ–¹æ³•é€šè¿‡JSONPè¯·æ±‚è·å–åˆ°æœ€æ–°çš„æ¨¡å—ä»£ç "><a href="#è°ƒç”¨hotDownloadUpdateChunkæ–¹æ³•é€šè¿‡JSONPè¯·æ±‚è·å–åˆ°æœ€æ–°çš„æ¨¡å—ä»£ç " class="headerlink" title="è°ƒç”¨hotDownloadUpdateChunkæ–¹æ³•é€šè¿‡JSONPè¯·æ±‚è·å–åˆ°æœ€æ–°çš„æ¨¡å—ä»£ç "></a>è°ƒç”¨hotDownloadUpdateChunkæ–¹æ³•é€šè¿‡JSONPè¯·æ±‚è·å–åˆ°æœ€æ–°çš„æ¨¡å—ä»£ç </h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hotDownloadUpdateChunk</span>(<span class="params">chunkId</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> script = <span class="built_in">document</span>.createElement(<span class="string">&#x27;script&#x27;</span>)</span><br><span class="line">  script.charset = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">  <span class="comment">// /main.xxxx.hot-update.js</span></span><br><span class="line">  script.src = <span class="string">&#x27;/&#x27;</span> + chunkId + <span class="string">&quot;.&quot;</span> + hotCurrentHash + <span class="string">&quot;.hot-update.js&quot;</span></span><br><span class="line">  <span class="built_in">document</span>.head.appendChild(script)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œè§£é‡Šä¸‹ä¸ºä»€ä¹ˆä½¿ç”¨<code>JSONP</code>è·å–è€Œä¸ç›´æ¥åˆ©ç”¨<code>socket</code>è·å–æœ€æ–°ä»£ç ï¼Ÿä¸»è¦æ˜¯å› ä¸º<code>JSONP</code>è·å–çš„ä»£ç å¯ä»¥ç›´æ¥æ‰§è¡Œã€‚<br><a name="ztLF2"></a></p>
<h4 id="è°ƒç”¨webpackHotUpdateæ–¹æ³•"><a href="#è°ƒç”¨webpackHotUpdateæ–¹æ³•" class="headerlink" title="è°ƒç”¨webpackHotUpdateæ–¹æ³•"></a>è°ƒç”¨webpackHotUpdateæ–¹æ³•</h4><p>å½“å®¢æˆ·ç«¯æŠŠæœ€æ–°çš„ä»£ç æ‹‰åˆ°æµè§ˆä¹‹å</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.webpackHotUpdate = <span class="function"><span class="keyword">function</span> (<span class="params">chunkId, moreModules</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å¾ªç¯æ–°æ‹‰æ¥çš„æ¨¡å—</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> moduleId <span class="keyword">in</span> moreModules) &#123;</span><br><span class="line">    <span class="comment">// ä»æ¨¡å—ç¼“å­˜ä¸­å–åˆ°è€çš„æ¨¡å—å®šä¹‰</span></span><br><span class="line">    <span class="keyword">let</span> oldModule = __webpack_require__.c[moduleId]</span><br><span class="line">    <span class="comment">// parentså“ªäº›æ¨¡å—å¼•ç”¨è¿™ä¸ªæ¨¡å— childrenè¿™ä¸ªæ¨¡å—å¼•ç”¨äº†å“ªäº›æ¨¡å—</span></span><br><span class="line">    <span class="comment">// parents=[&#x27;./src/index.js&#x27;]</span></span><br><span class="line">    <span class="keyword">let</span> &#123;</span><br><span class="line">      parents,</span><br><span class="line">      children</span><br><span class="line">    &#125; = oldModule</span><br><span class="line">    <span class="comment">// æ›´æ–°ç¼“å­˜ä¸ºæœ€æ–°ä»£ç  ç¼“å­˜è¿›è¡Œæ›´æ–°</span></span><br><span class="line">    <span class="keyword">let</span> <span class="built_in">module</span> = __webpack_require__.c[moduleId] = &#123;</span><br><span class="line">      <span class="attr">i</span>: moduleId,</span><br><span class="line">      <span class="attr">l</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">exports</span>: &#123;&#125;,</span><br><span class="line">      parents,</span><br><span class="line">      children,</span><br><span class="line">      <span class="attr">hot</span>: <span class="built_in">window</span>.hotCreateModule(moduleId)</span><br><span class="line">    &#125;</span><br><span class="line">    moreModules[moduleId].call(<span class="built_in">module</span>.exports, <span class="built_in">module</span>, <span class="built_in">module</span>.exports, __webpack_require__)</span><br><span class="line">    <span class="built_in">module</span>.l = <span class="literal">true</span> <span class="comment">// çŠ¶æ€å˜ä¸ºåŠ è½½å°±æ˜¯ç»™module.exports èµ‹å€¼äº†</span></span><br><span class="line">    parents.forEach(<span class="function"><span class="params">parent</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// parents=[&#x27;./src/index.js&#x27;]</span></span><br><span class="line">      <span class="keyword">let</span> parentModule = __webpack_require__.c[parent]</span><br><span class="line">      <span class="comment">// _acceptedDependencies=&#123;&#x27;./src/title.js&#x27;,render&#125;</span></span><br><span class="line">      parentModule &amp;&amp; parentModule.hot &amp;&amp; parentModule.hot._acceptedDependencies[moduleId] &amp;&amp; parentModule.hot._acceptedDependencies[moduleId]()</span><br><span class="line">    &#125;)</span><br><span class="line">    hotCurrentHash = currentHash</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a name="nMRoh"></a></p>
<h4 id="hotCreateModuleçš„å®ç°"><a href="#hotCreateModuleçš„å®ç°" class="headerlink" title="hotCreateModuleçš„å®ç°"></a>hotCreateModuleçš„å®ç°</h4><p>å®ç°æˆ‘ä»¬å¯ä»¥åœ¨ä¸šåŠ¡ä»£ç ä¸­å®šä¹‰éœ€è¦çƒ­æ›´æ–°çš„æ¨¡å—ä»¥åŠå›è°ƒå‡½æ•°ï¼Œå°†å…¶å­˜æ”¾åœ¨<code>hot._acceptedDependencies</code>ä¸­ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.hotCreateModule = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> hot = &#123;</span><br><span class="line">    <span class="attr">_acceptedDependencies</span>: &#123;&#125;,</span><br><span class="line">    <span class="function"><span class="title">dispose</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="comment">// é”€æ¯è€çš„å…ƒç´ </span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">accept</span>: <span class="function"><span class="keyword">function</span> (<span class="params">deps, callback</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; deps.length; i++) &#123;</span><br><span class="line">        <span class="comment">// hot._acceptedDependencies=&#123;&#x27;./title&#x27;: render&#125;</span></span><br><span class="line">        hot._acceptedDependencies[deps[i]] = callback</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> hot</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨<code>webpackHotUpdate</code>ä¸­è¿›è¡Œè°ƒç”¨</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">parents.forEach(<span class="function"><span class="params">parent</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// parents=[&#x27;./src/index.js&#x27;]</span></span><br><span class="line">      <span class="keyword">let</span> parentModule = __webpack_require__.c[parent]</span><br><span class="line">      <span class="comment">// _acceptedDependencies=&#123;&#x27;./src/title.js&#x27;,render&#125;</span></span><br><span class="line">      parentModule &amp;&amp; parentModule.hot &amp;&amp; parentModule.hot._acceptedDependencies[moduleId] &amp;&amp; parentModule.hot._acceptedDependencies[moduleId]()</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
<p>æœ€åè°ƒç”¨hotApplyæ–¹æ³•è¿›è¡Œçƒ­æ›´æ–°<br><a name="item-6-8"></a></p>
<h3 id="å®¢æˆ·ç«¯è°ƒè¯•é˜¶æ®µ"><a href="#å®¢æˆ·ç«¯è°ƒè¯•é˜¶æ®µ" class="headerlink" title="å®¢æˆ·ç«¯è°ƒè¯•é˜¶æ®µ"></a>å®¢æˆ·ç«¯è°ƒè¯•é˜¶æ®µ</h3><p>ç»è¿‡ä¸Šè¿°å®ç°äº†ä¸€ä¸ªåŸºæœ¬ç‰ˆçš„HMRï¼Œå¯æ›´æ”¹ä»£ç ä¿å­˜çš„åŒæ—¶æŸ¥çœ‹æµè§ˆå™¨å¹¶éæ•´ä½“åˆ·æ–°ï¼Œè€Œæ˜¯å±€éƒ¨æ›´æ–°ä»£ç è¿›è€Œæ›´æ–°è§†å›¾ã€‚åœ¨æ¶‰åŠåˆ°å¤§é‡è¡¨å•çš„éœ€æ±‚æ—¶å¤§å¤§æé«˜äº†å¼€å‘æ•ˆç‡ã€‚<br><a name="item-7"></a></p>
<h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2></li>
</ol>
<ul>
<li><p>å¦‚ä½•å®ç°commonjsè§„èŒƒï¼Ÿ<br>æ„Ÿå…´è¶£çš„å¯å‰å¾€&gt; <a target="_blank" rel="noopener" href="https://github.com/careteenL/blog/blob/master/src/20181201-node/module.md">debug CommonJsè§„èŒƒ</a>äº†è§£å…¶å®ç°åŸç†ã€‚</p>
</li>
<li><p>webpackå®ç°æµç¨‹ä»¥åŠå„ä¸ªç”Ÿå‘½å‘¨æœŸçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ<br>webpackä¸»è¦å€ŸåŠ©äº†&gt; <code>tapable</code>è¿™ä¸ªåº“æ‰€æä¾›çš„ä¸€ç³»åˆ—åŒæ­¥/å¼‚æ­¥é’©å­å‡½æ•°è´¯ç©¿æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚&gt; <img src="https://cdn.nlark.com/yuque/0/2020/jpeg/186051/1583939666129-b464ba02-d967-42db-a140-2b8321df9985.jpeg#align=left&display=inline&height=4244&originHeight=4244&originWidth=4436&size=0&status=done&style=none&width=4436">åŸºäºæ­¤æˆ‘å®ç°äº†ä¸€ç‰ˆç®€æ˜“çš„&gt; <a target="_blank" rel="noopener" href="https://github.com/careteenL/webpack">webpack</a>ï¼Œæºç 100+è¡Œï¼Œé£Ÿç”¨æ—¶ä¼´ç€æ³¨é‡Šå¾ˆå®¹æ˜“æ¶ˆåŒ–ï¼Œæ„Ÿå…´è¶£çš„å¯å‰å¾€çœ‹ä¸ªæ€è·¯ã€‚</p>
</li>
<li><p>å‘å¸ƒè®¢é˜…çš„ä½¿ç”¨å’Œå®ç°ï¼Œå¹¶ä¸”å¦‚ä½•å®ç°ä¸€ä¸ªå¯å…ˆè®¢é˜…åå‘å¸ƒçš„æœºåˆ¶ï¼Ÿ<br>ä¸Šé¢ä¹Ÿæåˆ°éœ€è¦ä½¿ç”¨åˆ°å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œä¸”åªæ”¯æŒå…ˆå‘å¸ƒåè®¢é˜…åŠŸèƒ½ã€‚å¯¹äºä¸€äº›è¾ƒä¸ºå¤æ‚çš„åœºæ™¯å¯èƒ½éœ€è¦å…ˆè®¢é˜…åå‘å¸ƒï¼Œæ­¤æ—¶å¯ä»¥ç§»æ­¥&gt; <a target="_blank" rel="noopener" href="https://github.com/careteenL/event-emitter">@careteen/event-emitter</a>ã€‚å…¶å®ç°åŸç†ä¹ŸæŒºç®€å•ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªç¦»çº¿äº‹ä»¶æ ˆå­˜æ”¾è¿˜æ²¡å‘å¸ƒå°±è®¢é˜…çš„äº‹ä»¶ï¼Œç­‰åˆ°è®¢é˜…æ—¶å¯ä»¥å–å‡ºæ‰€æœ‰äº‹ä»¶æ‰§è¡Œã€‚</p>
</li>
<li><p>ä¸ºä»€ä¹ˆä½¿ç”¨JSONPè€Œä¸ç”¨sockeé€šä¿¡è·å–æ›´æ–°è¿‡çš„ä»£ç ï¼Ÿ<br>å› ä¸ºé€šè¿‡socketé€šä¿¡è·å–çš„æ˜¯ä¸€ä¸²å­—ç¬¦ä¸²éœ€è¦å†åšå¤„ç†ã€‚è€Œé€šè¿‡&gt; <code>JSONP</code>è·å–çš„ä»£ç å¯ä»¥ç›´æ¥æ‰§è¡Œã€‚<br><a name="item-7-9"></a></p>
<h3 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h3></li>
<li><p>ç å³°æ¶æ„è¯¾</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://webpack.docschina.org/api/hot-module-replacement/#src/components/Sidebar/Sidebar.jsx">æ¨¡å—çƒ­æ›¿æ¢ - webpackå®˜ç½‘</a></p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/03/11/199-%E3%80%90Webpack%E3%80%91%E5%BD%BB%E5%BA%95%E6%90%9E%E6%87%82%E5%B9%B6%E5%AE%9E%E7%8E%B0webpack%E7%83%AD%E6%9B%B4%E6%96%B0%E5%8E%9F%E7%90%86/" data-id="ckts3ejyk00mt4d9kalne8c9k" data-title="199-ã€Webpackã€‘å½»åº•ææ‡‚å¹¶å®ç°webpackçƒ­æ›´æ–°åŸç†" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Webpack/" rel="tag">Webpack</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">å‰ç«¯å¼€å‘</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">åŸåˆ›</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-198-ã€Webpackã€‘Webpackæ’ä»¶å¼€å‘å¦‚æ­¤ç®€å•ï¼" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/24/198-%E3%80%90Webpack%E3%80%91Webpack%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%A6%82%E6%AD%A4%E7%AE%80%E5%8D%95%EF%BC%81/" class="article-date">
  <time class="dt-published" datetime="2020-02-23T23:42:27.000Z" itemprop="datePublished">2020-02-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/24/198-%E3%80%90Webpack%E3%80%91Webpack%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%A6%82%E6%AD%A4%E7%AE%80%E5%8D%95%EF%BC%81/">198-ã€Webpackã€‘Webpackæ’ä»¶å¼€å‘å¦‚æ­¤ç®€å•ï¼</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>æœ¬æ–‡ä½¿ç”¨çš„<a target="_blank" rel="noopener" href="https://github.com/pingan8787/Webpack-Quickly-Starter"><strong>Webpack-Quickly-Starter</strong></a>å¿«é€Ÿæ­å»º Webpack4 æœ¬åœ°å­¦ä¹ ç¯å¢ƒã€‚<br>å»ºè®®å¤šé˜…è¯» Webpack æ–‡æ¡£ã€Š<a target="_blank" rel="noopener" href="https://webpack.js.org/contribute/writing-a-plugin/"><strong>Writing a Plugin</strong></a>ã€‹ç« èŠ‚ï¼Œå­¦ä¹ å¼€å‘ç®€å•æ’ä»¶ã€‚</p>
</blockquote>
<p>æœ¬æ–‡å°†å¸¦ä½ ä¸€èµ·å¼€å‘ä½ çš„ç¬¬ä¸€ä¸ª Webpack æ’ä»¶ï¼Œä»Â Webpack é…ç½®å·¥ç¨‹å¸ˆï¼Œè¿ˆå‘ Webpack å¼€å‘å·¥ç¨‹å¸ˆï¼<br />åšè‡ªå·±çš„è½®å­ï¼Œè®©åˆ«äººç”¨å»å§ã€‚</p>
<p>å®Œæ•´ä»£ç å­˜æ”¾åœ¨ï¼š<a target="_blank" rel="noopener" href="https://github.com/pingan8787/script-timestamp-webpack-plugin">https://github.com/pingan8787/script-timestamp-webpack-plugin</a></p>
<p><img src="https://user-gold-cdn.xitu.io/2020/2/24/1707463e4ec11bce?w=800&h=400&f=png&s=30184"></p>
<h2 id="ä¸€ã€èƒŒæ™¯ä»‹ç»"><a href="#ä¸€ã€èƒŒæ™¯ä»‹ç»" class="headerlink" title="ä¸€ã€èƒŒæ™¯ä»‹ç»"></a>ä¸€ã€èƒŒæ™¯ä»‹ç»</h2><p>æœ¬æ–‡çµæ„Ÿæºè‡ªä¸šåŠ¡ä¸­çš„ç»éªŒæ€»ç»“ï¼Œ<strong>ä¸æ€•ç¥ä¸€æ ·çš„äº§å“ï¼Œåªæ€•ä¸€æ ¹ç­‹çš„å¼€å‘</strong>ã€‚</p>
<p>åœ¨é¡¹ç›®æ‰“åŒ…é‡åˆ°é—®é¢˜ï¼šâ€œå½“é¡¹ç›®æ‰˜ç®¡åˆ° CDN å¹³å°ï¼Œå¸Œæœ›å®ç°é¡¹ç›®ä¸­çš„ index.js ä¸è¢«ç¼“å­˜â€ã€‚å› ä¸ºæˆ‘ä»¬éœ€è¦ä¿®æ”¹ <code>index.js</code>Â ä¸­çš„å†…å®¹ï¼Œä¸æƒ³ç”¨æˆ·è¢«ç¼“å­˜ã€‚</p>
<p>æ€è€ƒä¸€é˜µï¼Œæœ‰è¿™ä¹ˆå‡ ç§æ€è·¯ï¼š</p>
<ol>
<li>åœ¨ CDN å¹³å°ä¸­è¿‡æ»¤è¯¥æ–‡ä»¶çš„ç¼“å­˜è®¾ç½®ï¼›</li>
<li>æŸ¥æ‰¾ DOM å…ƒç´ ï¼Œä¿®æ”¹è¯¥ <code>script</code> æ ‡ç­¾çš„ <code>src</code> å€¼ï¼Œå¹¶æ·»åŠ æ—¶æ—¶é—´æˆ³ï¼›</li>
<li>æ‰“åŒ…æ—¶åŠ¨æ€åˆ›å»º <code>script</code>Â æ ‡ç­¾å¼•å…¥æ–‡ä»¶ï¼Œå¹¶æ·»åŠ æ—¶æ—¶é—´æˆ³ã€‚</li>
</ol>
<p>ï¼ˆèªæ˜çš„ä½ è¿˜æœ‰å…¶ä»–æ–¹æ³•ï¼Œæ¬¢è¿è®¨è®ºï¼‰</p>
<p>æ€è·¯åˆ†æï¼š</p>
<ol>
<li>æ˜¾ç„¶ä¿®æ”¹ CDN è®¾ç½®çš„è¯ï¼Œæ²»æ ‡ä¸æ²»æœ¬ï¼›</li>
<li>åœ¨æ¨¡ç‰ˆæ–‡ä»¶ä¸­ï¼Œæ·»åŠ  <code>script</code>Â æ ‡ç­¾ï¼Œæ‰§è¡Œè·å– Webpack è‡ªåŠ¨æ·»åŠ çš„ <code>script</code>Â æ ‡ç­¾å¹¶ä¸ºå…¶ <code>src</code>Â å€¼æ·»åŠ æ—¶é—´æˆ³ã€‚ä½†äº‹å®æ˜¯è¿˜æ²¡ç­‰ä½ ä¿®æ”¹å®Œï¼Œ js æ–‡ä»¶å·²ç»åŠ è½½å®Œæ¯•ï¼Œæ‰€ä»¥æ”¾å¼ƒ</li>
<li>éœ€è¦åœ¨ <code>index.html</code>Â ç”Ÿæˆä¹‹å‰ï¼Œä¿®æ”¹ js æ–‡ä»¶çš„è·¯å¾„ï¼Œå¹¶æ·»åŠ æ—¶é—´æˆ³ã€‚</li>
</ol>
<p>äºæ˜¯æˆ‘å‡†å¤‡ä½¿ç”¨ç¬¬ä¸‰ç§æ–¹å¼ï¼Œåœ¨ <code>index.html</code>Â ç”Ÿæˆä¹‹å‰å®Œæˆä¸‹é¢ä¿®æ”¹ï¼š<br /><img src="https://user-gold-cdn.xitu.io/2020/2/24/170745f867efcd61?w=951&h=328&f=png&s=86717" alt="image.png"></p>
<p>é—®é¢˜ç®€å•ï¼Œå®é™…è¿˜æ˜¯æƒ³è¯•è¯•å¼€å‘ Webpack Pluginã€‚</p>
<h2 id="äºŒã€åŸºç¡€çŸ¥è¯†"><a href="#äºŒã€åŸºç¡€çŸ¥è¯†" class="headerlink" title="äºŒã€åŸºç¡€çŸ¥è¯†"></a>äºŒã€åŸºç¡€çŸ¥è¯†</h2><p>WebpackÂ ä½¿ç”¨é˜¶æ®µå¼çš„æ„å»ºå›è°ƒï¼Œå¼€å‘è€…å¯ä»¥å¼•å…¥å®ƒä»¬è‡ªå·±çš„è¡Œä¸ºåˆ° Webpack æ„å»ºæµç¨‹ä¸­ã€‚<br />åœ¨å¼€å‘ä¹‹å‰ï¼Œéœ€è¦äº†è§£ä»¥ä¸‹ Webpack ç›¸å…³æ¦‚å¿µï¼š</p>
<h3 id="2-1-Webpack-æ’ä»¶ç»„æˆ"><a href="#2-1-Webpack-æ’ä»¶ç»„æˆ" class="headerlink" title="2.1 Webpack æ’ä»¶ç»„æˆ"></a>2.1 Webpack æ’ä»¶ç»„æˆ</h3><p>åœ¨è‡ªå®šä¹‰æ’ä»¶ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ï¼Œä¸€ä¸ª Webpack æ’ä»¶ç”±å“ªäº›æ„æˆï¼Œä¸‹é¢æ‘˜æŠ„æ–‡æ¡£ï¼š</p>
<ul>
<li>ä¸€ä¸ªå…·å JavaScript å‡½æ•°ï¼›</li>
<li>åœ¨å®ƒçš„åŸå‹ä¸Šå®šä¹‰Â applyÂ æ–¹æ³•ï¼›</li>
<li>æŒ‡å®šä¸€ä¸ªè§¦åŠåˆ° Webpack æœ¬èº«çš„<a target="_blank" rel="noopener" href="https://webpack.docschina.org/api/compiler-hooks/">äº‹ä»¶é’©å­</a>ï¼›</li>
<li>æ“ä½œ Webpack å†…éƒ¨çš„å®ä¾‹ç‰¹å®šæ•°æ®ï¼›</li>
<li>åœ¨å®ç°åŠŸèƒ½åè°ƒç”¨ Webpack æä¾›çš„ callbackã€‚Â </li>
</ul>
<h3 id="2-2-Webpack-æ’ä»¶åŸºæœ¬æ¶æ„"><a href="#2-2-Webpack-æ’ä»¶åŸºæœ¬æ¶æ„" class="headerlink" title="2.2 Webpack æ’ä»¶åŸºæœ¬æ¶æ„"></a>2.2 Webpack æ’ä»¶åŸºæœ¬æ¶æ„</h3><p>æ’ä»¶ç”±ä¸€ä¸ªæ„é€ å‡½æ•°å®ä¾‹åŒ–å‡ºæ¥ã€‚æ„é€ å‡½æ•°å®šä¹‰ <code>apply</code> æ–¹æ³•ï¼Œåœ¨å®‰è£…æ’ä»¶æ—¶ï¼Œ<code>apply</code> æ–¹æ³•ä¼šè¢« Webpack <code>compiler</code> è°ƒç”¨ä¸€æ¬¡ã€‚<code>apply</code> æ–¹æ³•å¯ä»¥æ¥æ”¶ä¸€ä¸ª Webpack <code>compiler </code>å¯¹è±¡çš„å¼•ç”¨ï¼Œä»è€Œå¯ä»¥åœ¨å›è°ƒå‡½æ•°ä¸­è®¿é—®åˆ° <code>compiler</code> å¯¹è±¡ã€‚</p>
<p>å®˜æ–¹æ–‡æ¡£æä¾›ä¸€ä¸ªç®€å•çš„æ’ä»¶ç»“æ„ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorldPlugin</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">apply</span>(<span class="params">compiler</span>)</span> &#123;</span><br><span class="line">    compiler.hooks.done.tap(<span class="string">&#x27;Hello World Plugin&#x27;</span>, <span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">      stats <span class="comment">/* åœ¨ hook è¢«è§¦åŠæ—¶ï¼Œä¼šå°† stats ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚ */</span></span></span></span><br><span class="line"><span class="params"><span class="function">    </span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;Hello World!&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = HelloWorldPlugin;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨æ’ä»¶ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">var</span> HelloWorldPlugin = <span class="built_in">require</span>(<span class="string">&#x27;hello-world&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ... è¿™é‡Œæ˜¯å…¶ä»–é…ç½® ...</span></span><br><span class="line">  <span class="attr">plugins</span>: [<span class="keyword">new</span> HelloWorldPlugin(&#123; <span class="attr">options</span>: <span class="literal">true</span> &#125;)]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-HtmlWebpackPlugin-ä»‹ç»"><a href="#2-3-HtmlWebpackPlugin-ä»‹ç»" class="headerlink" title="2.3 HtmlWebpackPlugin ä»‹ç»"></a>2.3 HtmlWebpackPlugin ä»‹ç»</h3><blockquote>
<p>HtmlWebpackPlugin ç®€åŒ–äº† HTML æ–‡ä»¶çš„åˆ›å»ºï¼Œä»¥ä¾¿ä¸ºä½ çš„ Webpack åŒ…æä¾›æœåŠ¡ã€‚è¿™å¯¹äºåœ¨æ–‡ä»¶åä¸­åŒ…å«æ¯æ¬¡ä¼šéšç€ç¼–è¯‘è€Œå‘ç”Ÿå˜åŒ–å“ˆå¸Œçš„ webpack bundle å°¤å…¶æœ‰ç”¨ã€‚</p>
</blockquote>
<p>æ’ä»¶çš„åŸºæœ¬ä½œç”¨æ¦‚æ‹¬ï¼š<strong>ç”Ÿæˆ HTML æ–‡ä»¶</strong>ã€‚</p>
<p><code>html-webapck-plugin</code> æ’ä»¶<strong>ä¸¤ä¸ªä¸»è¦ä½œç”¨ï¼š</strong></p>
<ul>
<li>ä¸º HTML æ–‡ä»¶å¼•å…¥å¤–éƒ¨èµ„æºï¼ˆå¦‚ <code>script</code> / <code>link</code> ï¼‰åŠ¨æ€æ·»åŠ æ¯æ¬¡ç¼–è¯‘åçš„ hashï¼Œé˜²æ­¢å¼•ç”¨æ–‡ä»¶çš„ç¼“å­˜é—®é¢˜ï¼›</li>
<li>åŠ¨æ€åˆ›å»º HTML å…¥å£æ–‡ä»¶ï¼Œå¦‚å•é¡µåº”ç”¨çš„ <code>index.html </code>æ–‡ä»¶ã€‚</li>
</ul>
<p><code>html-webapck-plugin</code> æ’ä»¶<strong>åŸç†ä»‹ç»ï¼š</strong></p>
<ul>
<li>è¯»å– Webpack ä¸­ <code>entry</code> é…ç½®çš„ç›¸å…³å…¥å£ <code>chunk</code> å’Œ <code>extract-text-webpack-plugin</code> æ’ä»¶æŠ½å–çš„ CSS æ ·å¼ï¼›</li>
<li>å°†æ ·å¼æ’å…¥åˆ°æ’ä»¶æä¾›çš„ <code>template</code> æˆ– <code>templateContent</code> é…ç½®æŒ‡å®šçš„æ¨¡ç‰ˆæ–‡ä»¶ä¸­ï¼›</li>
<li>æ’å…¥æ–¹å¼æ˜¯ï¼šé€šè¿‡ <code>link</code> æ ‡ç­¾å¼•å…¥æ ·å¼ï¼Œé€šè¿‡ <code>script</code> æ ‡ç­¾å¼•å…¥è„šæœ¬æ–‡ä»¶ï¼›</li>
</ul>
<h2 id="ä¸‰ã€å¼€å‘æµç¨‹"><a href="#ä¸‰ã€å¼€å‘æµç¨‹" class="headerlink" title="ä¸‰ã€å¼€å‘æµç¨‹"></a>ä¸‰ã€å¼€å‘æµç¨‹</h2><p>æœ¬æ–‡å¼€å‘çš„ <strong>è‡ªåŠ¨æ·»åŠ æ—¶é—´æˆ³å¼•ç”¨è„šæœ¬æ–‡ä»¶ï¼ˆSetScriptTimestampPluginï¼‰</strong> æ’ä»¶å®ç°çš„åŸç†ï¼šé€šè¿‡ <strong>HtmlWebpackPlugin</strong> ç”Ÿæˆ HTML æ–‡ä»¶å‰ï¼Œå°†æ¨¡ç‰ˆæ–‡ä»¶<strong>é¢„ç•™ä½ç½®æ›¿æ¢æˆè„šæœ¬</strong>ï¼Œè„šæœ¬ä¸­æ‰§è¡Œè‡ªåŠ¨æ·»åŠ æ—¶é—´æˆ³æ¥å¼•ç”¨è„šæœ¬æ–‡ä»¶ã€‚</p>
<h3 id="3-1-æ’ä»¶è¿è¡Œæœºåˆ¶"><a href="#3-1-æ’ä»¶è¿è¡Œæœºåˆ¶" class="headerlink" title="3.1 æ’ä»¶è¿è¡Œæœºåˆ¶"></a>3.1 æ’ä»¶è¿è¡Œæœºåˆ¶</h3><p><img src="https://user-gold-cdn.xitu.io/2020/2/24/170745f8681eb3b6?w=2244&h=1604&f=png&s=269681" alt="SetScriptTimestampPlugin è¿è¡Œæœºåˆ¶.png"></p>
<h3 id="3-2-åˆå§‹åŒ–æ’ä»¶æ–‡ä»¶"><a href="#3-2-åˆå§‹åŒ–æ’ä»¶æ–‡ä»¶" class="headerlink" title="3.2 åˆå§‹åŒ–æ’ä»¶æ–‡ä»¶"></a>3.2 åˆå§‹åŒ–æ’ä»¶æ–‡ä»¶</h3><p>æ–°å»º <code>SetScriptTimestampPlugin.js</code>Â  æ–‡ä»¶ï¼Œå¹¶å‚è€ƒå®˜æ–¹æ–‡æ¡£ä¸­æ’ä»¶çš„åŸºæœ¬ç»“æ„ï¼Œåˆå§‹åŒ–æ’ä»¶ä»£ç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SetScriptTimestampPlugin.js</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SetScriptTimestampPlugin</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">apply</span>(<span class="params">compiler</span>)</span> &#123;</span><br><span class="line">    compiler.hooks.done.tap(<span class="string">&#x27;SetScriptTimestampPlugin&#x27;</span>,</span><br><span class="line">     <span class="function">(<span class="params">compilation, callback</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;SetScriptTimestampPlugin!&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = SetScriptTimestampPlugin;</span><br></pre></td></tr></table></figure>

<p><code>apply</code>Â æ–¹æ³•ä¸ºæ’ä»¶åŸå‹æ–¹æ³•ï¼Œæ¥æ”¶ <code>compiler</code>Â ä½œä¸ºå‚æ•°ã€‚</p>
<h3 id="3-3-é€‰æ‹©æ’ä»¶è§¦å‘æ—¶æœº"><a href="#3-3-é€‰æ‹©æ’ä»¶è§¦å‘æ—¶æœº" class="headerlink" title="3.3 é€‰æ‹©æ’ä»¶è§¦å‘æ—¶æœº"></a>3.3 é€‰æ‹©æ’ä»¶è§¦å‘æ—¶æœº</h3><p>é€‰æ‹©æ’ä»¶è§¦å‘æ—¶æœºï¼Œå…¶å®æ˜¯é€‰æ‹©æ’ä»¶è§¦å‘çš„ compiler é’©å­ï¼ˆå³ä½•æ—¶è§¦å‘æ’ä»¶ï¼‰ã€‚<br />Webpack æä¾›é’©å­æœ‰å¾ˆå¤šï¼Œè¿™é‡Œç®€å•ä»‹ç»å‡ ä¸ªï¼Œå®Œæ•´å…·ä½“å¯å‚è€ƒæ–‡æ¡£ã€Š<a target="_blank" rel="noopener" href="https://webpack.js.org/api/compiler-hooks/">Compiler Hooks</a>ã€‹ï¼š</p>
<ul>
<li><code>entryOption</code>Â : åœ¨ webpack é€‰é¡¹ä¸­çš„ <code>entry</code> é…ç½®é¡¹ å¤„ç†è¿‡ä¹‹åï¼Œæ‰§è¡Œæ’ä»¶ã€‚</li>
<li><code>afterPlugins</code>Â :Â è®¾ç½®å®Œåˆå§‹æ’ä»¶ä¹‹åï¼Œæ‰§è¡Œæ’ä»¶ã€‚</li>
<li><code>compilation</code>Â :Â ç¼–è¯‘åˆ›å»ºä¹‹åï¼Œç”Ÿæˆæ–‡ä»¶ä¹‹å‰ï¼Œæ‰§è¡Œæ’ä»¶ã€‚ã€‚</li>
<li><code>emit</code>Â :Â ç”Ÿæˆèµ„æºåˆ° <code>output</code> ç›®å½•ä¹‹å‰ã€‚</li>
<li><code>done</code>Â :Â ç¼–è¯‘å®Œæˆã€‚</li>
</ul>
<p>æˆ‘ä»¬æ’ä»¶åº”è¯¥æ˜¯è¦åœ¨ HTML è¾“å‡ºä¹‹å‰ï¼ŒåŠ¨æ€æ·»åŠ  <code>script</code>Â æ ‡ç­¾ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©é’©å…¥Â <code>compilation</code>Â é˜¶æ®µï¼Œä»£ç ä¿®æ”¹ï¼š</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// SetScriptTimestampPlugin.js</span><br><span class="line"></span><br><span class="line">class SetScriptTimestampPlugin &#123;</span><br><span class="line">  apply(compiler) &#123;</span><br><span class="line"><span class="deletion">-   compiler.hooks.done.tap(&#x27;SetScriptTimestampPlugin&#x27;,</span></span><br><span class="line"><span class="addition">+   compiler.hooks.compilation.tap(&#x27;SetScriptTimestampPlugin&#x27;, </span></span><br><span class="line">      (compilation, callback) =&gt; &#123;</span><br><span class="line">      console.log(&#x27;SetScriptTimestampPlugin!&#x27;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">module.exports = SetScriptTimestampPlugin;</span><br></pre></td></tr></table></figure>

<p>åœ¨ <code>compiler.hooks</code>Â ä¸‹æŒ‡å®š<strong>äº‹ä»¶é’©å­å‡½æ•°</strong>ï¼Œä¾¿ä¼šè§¦å‘é’©å­æ—¶ï¼Œæ‰§è¡Œå›è°ƒå‡½æ•°ã€‚<br />Webpack æä¾›ä¸‰ç§è§¦å‘é’©å­çš„æ–¹æ³•ï¼š</p>
<ul>
<li><code>tap</code> ï¼šä»¥<strong>åŒæ­¥æ–¹å¼</strong>è§¦å‘é’©å­ï¼›</li>
<li><code>tapAsync</code> ï¼šä»¥<strong>å¼‚æ­¥æ–¹å¼</strong>è§¦å‘é’©å­ï¼›</li>
<li><code>tapPromise</code> ï¼šä»¥<strong>å¼‚æ­¥æ–¹å¼</strong>è§¦å‘é’©å­ï¼Œè¿”å› Promiseï¼›</li>
</ul>
<p>è¿™ä¸‰ç§æ–¹å¼èƒ½é€‰æ‹©çš„é’©å­æ–¹æ³•ä¹Ÿä¸åŒï¼Œç”±äº <code>compilation</code>Â æ˜¯ <code>SyncHook</code>Â åŒæ­¥é’©å­ï¼Œæ‰€ä»¥é‡‡ç”¨ <code>tap</code> è§¦å‘æ–¹å¼ã€‚<br /><code>tap</code> æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šæ’ä»¶åç§°å’Œå›è°ƒå‡½æ•°ã€‚</p>
<h3 id="3-4-æ·»åŠ æ’ä»¶æ›¿æ¢å…¥å£"><a href="#3-4-æ·»åŠ æ’ä»¶æ›¿æ¢å…¥å£" class="headerlink" title="3.4 æ·»åŠ æ’ä»¶æ›¿æ¢å…¥å£"></a>3.4 æ·»åŠ æ’ä»¶æ›¿æ¢å…¥å£</h3><p>æˆ‘ä»¬åŸç†ä¸Šæ˜¯å°†æ¨¡ç‰ˆæ–‡ä»¶ä¸­ï¼ŒæŒ‡å®šæ›¿æ¢å…¥å£ï¼Œå†æ›¿æ¢æˆéœ€è¦æ‰§è¡Œçš„è„šæœ¬ã€‚</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/2/24/170745f8680672ef?w=947&h=340&f=png&s=83858" alt="image.png"></p>
<p>æ‰€ä»¥æˆ‘ä»¬åœ¨æ¨¡ç‰ˆæ–‡ä»¶ <code>template.html</code>Â ä¸­æ·»åŠ  <code>&lt;!--SetScriptTimestampPlugin inset script--&gt;</code>Â ä½œä¸ºæ ‡è¯†æ›¿æ¢å…¥å£ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Webpack æ’ä»¶å¼€å‘å…¥é—¨<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!-- other code --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SetScriptTimestampPlugin inset script--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-5-ç¼–å†™æ’ä»¶é€»è¾‘"><a href="#3-5-ç¼–å†™æ’ä»¶é€»è¾‘" class="headerlink" title="3.5 ç¼–å†™æ’ä»¶é€»è¾‘"></a>3.5 ç¼–å†™æ’ä»¶é€»è¾‘</h3><p>åˆ°è¿™ä¸€æ­¥ï¼Œæ‰å¼€å§‹ç¼–å†™æ’ä»¶çš„é€»è¾‘ã€‚<br />ä»ä¸Šä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“åœ¨ <code>tap</code>Â ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸ªå›è°ƒå‡½æ•°ï¼Œå¹¶ä¸”è¿™ä¸ªå›è°ƒå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼š <code>compilation</code>Â å’Œ <code>callback</code>Â ã€‚</p>
<p><code>compilation</code> ç»§æ‰¿äº<code>compiler</code>ï¼ŒåŒ…å« <code>compiler</code> æ‰€æœ‰å†…å®¹ï¼ˆä¹Ÿæœ‰ Webpack çš„ <code>options</code>ï¼‰ï¼Œè€Œä¸”ä¹Ÿæœ‰ <code>plugin</code> å‡½æ•°æ¥å…¥ä»»åŠ¡ç‚¹ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SetScriptTimestampPlugin.js</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SetScriptTimestampPlugin</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">apply</span>(<span class="params">compiler</span>)</span> &#123;</span><br><span class="line">    compiler.hooks.compilation.tap(<span class="string">&#x27;SetScriptTimestampPlugin&#x27;</span>, </span><br><span class="line">      <span class="function">(<span class="params">compilation, callback</span>) =&gt;</span> &#123;</span><br><span class="line">      	<span class="comment">// æ’ä»¶é€»è¾‘ è°ƒç”¨compilationæä¾›çš„pluginæ–¹æ³•</span></span><br><span class="line">        compilation.plugin(</span><br><span class="line">          <span class="string">&quot;html-webpack-plugin-before-html-processing&quot;</span>,</span><br><span class="line">          <span class="function"><span class="keyword">function</span>(<span class="params">htmlPluginData, callback</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// è¯»å–å¹¶ä¿®æ”¹ script ä¸Š src åˆ—è¡¨</span></span><br><span class="line">            <span class="keyword">let</span> jsScr = htmlPluginData.assets.js[<span class="number">0</span>];</span><br><span class="line">            htmlPluginData.assets.js = [];</span><br><span class="line">            <span class="keyword">let</span> result = <span class="string">`</span></span><br><span class="line"><span class="string">                &lt;script&gt;</span></span><br><span class="line"><span class="string">                    let scriptDOM = document.createElement(&quot;script&quot;);</span></span><br><span class="line"><span class="string">                    let jsScr = &quot;./<span class="subst">$&#123;jsScr&#125;</span>&quot;;</span></span><br><span class="line"><span class="string">                    scriptDOM.src = jsScr + &quot;?&quot; + new Date().getTime();</span></span><br><span class="line"><span class="string">                    document.body.appendChild(scriptDOM)</span></span><br><span class="line"><span class="string">                &lt;/script&gt;</span></span><br><span class="line"><span class="string">            `</span>;</span><br><span class="line">            <span class="keyword">let</span> resultHTML = htmlPluginData.html.replace(</span><br><span class="line">              <span class="string">&quot;&lt;!--SetScriptTimestampPlugin inset script--&gt;&quot;</span>, result</span><br><span class="line">            );</span><br><span class="line">            <span class="comment">// è¿”å›ä¿®æ”¹åçš„ç»“æœ</span></span><br><span class="line">            htmlPluginData.html = resultHTML;</span><br><span class="line">          &#125;</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = SetScriptTimestampPlugin;</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šé¢æ’ä»¶é€»è¾‘ä¸­ï¼Œå…·ä½“åšäº†è¿™äº›äº‹ï¼š</p>
<ol>
<li><strong>æ‰§è¡Œ <strong><code>compilation.plugin</code></strong>Â  æ–¹æ³•ï¼Œå¹¶ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼šæ’ä»¶äº‹ä»¶å’Œå›è°ƒæ–¹æ³•ã€‚</strong></li>
</ol>
<p>æ‰€è°“â€œæ’ä»¶äº‹ä»¶â€å³æ’ä»¶æ‰€æä¾›çš„ä¸€äº›äº‹ä»¶ï¼Œç”¨äºç›‘å¬æ’ä»¶çŠ¶æ€ï¼Œè¿™é‡Œåˆ—ä¸¾å‡ ä¸ª <code>html-webpack-plugin</code> æä¾›çš„äº‹ä»¶ï¼ˆå®Œæ•´å¯æŸ¥çœ‹ã€Š<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/html-webpack-plugin">html-webpack-plugin</a>ã€‹ï¼‰ï¼š<br />Async:</p>
<ul>
<li><code>html-webpack-plugin-before-html-generation</code></li>
<li><code>html-webpack-plugin-before-html-processing</code></li>
<li><code>html-webpack-plugin-alter-asset-tags</code></li>
</ul>
<p>Sync:</p>
<ul>
<li><code>html-webpack-plugin-alter-chunks</code></li>
</ul>
<ol start="2">
<li><strong>è·å–è„šæœ¬æ–‡ä»¶åç§°åˆ—è¡¨å¹¶æ¸…ç©ºã€‚</strong></li>
</ol>
<p>åœ¨å›è°ƒæ–¹æ³•ä¸­ï¼Œé€šè¿‡ <code>htmlPluginData.assets.js</code> è·å–éœ€è¦é€šè¿‡ <code>script</code> å¼•å…¥çš„è„šæœ¬æ–‡ä»¶åç§°åˆ—è¡¨ï¼Œæ‹·è´ä¸€ä»½ï¼Œå¹¶æ¸…ç©ºåŸæœ‰åˆ—è¡¨ã€‚</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/2/24/170745f86a2d7bbe?w=334&h=93&f=png&s=27216" alt="image.png"></p>
<ol start="3">
<li><strong>ç¼–å†™æ›¿æ¢é€»è¾‘ã€‚</strong></li>
</ol>
<p>æ›¿æ¢é€»è¾‘å³ï¼šåŠ¨æ€åˆ›å»ºä¸€ä¸ª <code>script</code>Â æ ‡ç­¾ï¼Œå°†å…¶ <code>src</code>Â å€¼è®¾ç½®ä¸ºä¸Šä¸€æ­¥è¯»å–åˆ°çš„è„šæœ¬æ–‡ä»¶åï¼Œå¹¶åœ¨åé¢æ‹¼æ¥ <strong>æ—¶é—´æˆ³</strong>Â ä½œä¸ºå‚æ•°ã€‚</p>
<ol start="4">
<li><strong>æ’å…¥æ›¿æ¢é€»è¾‘ã€‚</strong></li>
</ol>
<p>é€šè¿‡ <code>htmlPluginData.html</code>Â å¯ä»¥è·å–åˆ°æ¨¡ç‰ˆæ–‡ä»¶çš„å­—ç¬¦ä¸²è¾“å‡ºï¼Œæˆ‘ä»¬åªéœ€è¦å°†æ¨¡ç‰ˆå­—ç¬¦ä¸²ä¸­æ›¿æ¢å…¥å£ <code>&lt;!--SetScriptTimestampPlugin inset script--&gt;</code>Â æ›¿æ¢æˆæˆ‘ä»¬ä¸Šä¸€æ­¥ç¼–å†™çš„æ›¿æ¢é€»è¾‘å³å¯ã€‚</p>
<ol start="5">
<li><strong>è¿”å›HTMLæ–‡ä»¶ã€‚</strong></li>
</ol>
<p>æœ€åå°†ä¿®æ”¹åçš„ HTML å­—ç¬¦ä¸²ï¼Œèµ‹å€¼ç»™åŸæ¥çš„ <code>htmlPluginData.html</code>Â è¾¾åˆ°ä¿®æ”¹æ•ˆæœã€‚</p>
<h3 id="3-5-ä½¿ç”¨æ’ä»¶"><a href="#3-5-ä½¿ç”¨æ’ä»¶" class="headerlink" title="3.5 ä½¿ç”¨æ’ä»¶"></a>3.5 ä½¿ç”¨æ’ä»¶</h3><p>è‡ªå®šä¹‰æ’ä»¶ä½¿ç”¨æ–¹å¼ï¼Œä¸å…¶ä»–æ’ä»¶ä¸€è‡´ï¼Œåœ¨ <code>plugins</code>Â æ•°ç»„ä¸­å®ä¾‹åŒ–ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> SetScriptTimestampPlugin = <span class="built_in">require</span>(<span class="string">&quot;./SetScriptTimestampPlugin.js&quot;</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">	<span class="comment">// ... çœç•¥å…¶ä»–é…ç½®</span></span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">  	<span class="comment">// ... çœç•¥å…¶ä»–æ’ä»¶</span></span><br><span class="line">    <span class="keyword">new</span> SetScriptTimestampPlugin()  </span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ°è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å·²ç»å®ç°éœ€æ±‚â€œå½“é¡¹ç›®æ‰˜ç®¡åˆ° CDN å¹³å°ï¼Œå¸Œæœ›å®ç°é¡¹ç›®ä¸­çš„ index.js ä¸è¢«ç¼“å­˜â€ã€‚<br /><img src="https://user-gold-cdn.xitu.io/2020/2/24/170745f86a7fdfd0?w=467&h=291&f=png&s=44616" alt="image.png"></p>
<h2 id="å››ã€æ¡ˆä¾‹æ‹“å±•"><a href="#å››ã€æ¡ˆä¾‹æ‹“å±•" class="headerlink" title="å››ã€æ¡ˆä¾‹æ‹“å±•"></a>å››ã€æ¡ˆä¾‹æ‹“å±•</h2><p>è¿™é‡Œä»¥ä¹‹å‰Â <strong>SetScriptTimestampPlugin</strong> æ’ä»¶ä¸ºä¾‹å­ï¼Œç»§ç»­æ‹“å±•ã€‚</p>
<h3 id="4-1-è¯»å–æ’ä»¶é…ç½®å‚æ•°"><a href="#4-1-è¯»å–æ’ä»¶é…ç½®å‚æ•°" class="headerlink" title="4.1 è¯»å–æ’ä»¶é…ç½®å‚æ•°"></a>4.1 è¯»å–æ’ä»¶é…ç½®å‚æ•°</h3><p>æ¯ä¸ªæ’ä»¶æœ¬è´¨æ˜¯ä¸€ä¸ªç±»ï¼Œè·Ÿä¸€ä¸ªç±»å®ä¾‹åŒ–ç›¸åŒï¼Œå¯ä»¥åœ¨å®ä¾‹åŒ–æ—¶ä¼ å…¥é…ç½®å‚æ•°ï¼Œåœ¨æ„é€ å‡½æ•°ä¸­æ“ä½œï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SetScriptTimestampPlugin.js</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SetScriptTimestampPlugin</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">options</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.options = options;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">apply</span>(<span class="params">compiler</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.options.filename); <span class="comment">// &quot;index.js&quot;</span></span><br><span class="line">    <span class="comment">// ... çœç•¥å…¶ä»–ä»£ç </span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = SetScriptTimestampPlugin;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨æ—¶ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> SetScriptTimestampPlugin = <span class="built_in">require</span>(<span class="string">&quot;./SetScriptTimestampPlugin.js&quot;</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">	<span class="comment">// ... çœç•¥å…¶ä»–é…ç½®</span></span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">  	<span class="comment">// ... çœç•¥å…¶ä»–æ’ä»¶</span></span><br><span class="line">    <span class="keyword">new</span> SetScriptTimestampPlugin(&#123;</span><br><span class="line">    	<span class="attr">filename</span>: <span class="string">&quot;index.js&quot;</span></span><br><span class="line">    &#125;)  </span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-æ·»åŠ å¤šè„šæœ¬æ–‡ä»¶çš„æ—¶é—´æˆ³"><a href="#4-2-æ·»åŠ å¤šè„šæœ¬æ–‡ä»¶çš„æ—¶é—´æˆ³" class="headerlink" title="4.2 æ·»åŠ å¤šè„šæœ¬æ–‡ä»¶çš„æ—¶é—´æˆ³"></a>4.2 æ·»åŠ å¤šè„šæœ¬æ–‡ä»¶çš„æ—¶é—´æˆ³</h3><p>å¦‚æœæˆ‘ä»¬æ­¤æ—¶éœ€è¦åŒæ—¶ä¿®æ”¹å¤šä¸ªè„šæœ¬æ–‡ä»¶çš„æ—¶é—´æˆ³ï¼Œä¹Ÿåªéœ€è¦å°†å‚æ•°ç±»å‹å’Œæ‰§è¡Œè„šæœ¬åšä¸‹è°ƒæ•´ã€‚<br />å…·ä½“ä¿®æ”¹è„šæœ¬ï¼Œè¿™é‡Œä¸å…·ä½“å±•å¼€ï¼Œç¯‡å¹…æœ‰é™ï¼Œå¯ä»¥è‡ªè¡Œæ€è€ƒå®ç°å’¯~<br />è¿™é‡Œå±•ç¤ºä½¿ç”¨æ’ä»¶æ—¶çš„å‚æ•°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> SetScriptTimestampPlugin = <span class="built_in">require</span>(<span class="string">&quot;./SetScriptTimestampPlugin.js&quot;</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">	<span class="comment">// ... çœç•¥å…¶ä»–é…ç½®</span></span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">  	<span class="comment">// ... çœç•¥å…¶ä»–æ’ä»¶</span></span><br><span class="line">    <span class="keyword">new</span> SetScriptTimestampPlugin(&#123;</span><br><span class="line">    	<span class="attr">filename</span>: [<span class="string">&quot;index.js&quot;</span>, <span class="string">&quot;boundle.js&quot;</span>, <span class="string">&quot;pingan.js&quot;</span>]</span><br><span class="line">    &#125;)  </span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”Ÿæˆç»“æœï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./index.js?1582425467655&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./boundle.js?1582425467655&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./pingan.js?1582425467655&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="äº”ã€æ€»ç»“"><a href="#äº”ã€æ€»ç»“" class="headerlink" title="äº”ã€æ€»ç»“"></a>äº”ã€æ€»ç»“</h2><p>æœ¬æ–‡é€šç”¨è‡ªå®šä¹‰ Webpack æ’ä»¶æ¥å®ç°æ—¥å¸¸ä¸€äº›æ¯”è¾ƒæ£˜æ‰‹çš„éœ€æ±‚ã€‚ä¸»è¦ä¸ºå¤§å®¶ä»‹ç»äº† Webpack æ’ä»¶çš„åŸºæœ¬ç»„æˆå’Œç®€å•æ¶æ„ï¼Œä¹Ÿä»‹ç»äº† HtmlWebpackPlugin æ’ä»¶ã€‚å¹¶é€šè¿‡è¿™äº›åŸºç¡€çŸ¥è¯†ï¼Œå®Œæˆäº†ä¸€ä¸ª HTML æ–‡æœ¬æ›¿æ¢æ’ä»¶ï¼Œæœ€åé€šè¿‡ä¸¤ä¸ªåœºæ™¯æ¥æ‹“å±•æ’ä»¶ä½¿ç”¨èŒƒå›´ã€‚</p>
<p>æœ€åï¼Œå…³äº Webpack æ’ä»¶å¼€å‘ï¼Œè¿˜æœ‰æ›´å¤šçŸ¥è¯†å¯ä»¥å­¦ä¹ ï¼Œå»ºè®®å¤šçœ‹çœ‹å®˜æ–¹æ–‡æ¡£ã€Š<a target="_blank" rel="noopener" href="https://webpack.js.org/contribute/writing-a-plugin/">Writing a Plugin</a>ã€‹è¿›è¡Œå­¦ä¹ ã€‚</p>
<p>æœ¬æ–‡çº¯å±ä¸ªäººç»éªŒæ€»ç»“ï¼Œå¦‚æœ‰å¼‚è®®ï¼Œæ¬¢è¿æŒ‡ç‚¹ã€‚</p>
<h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h2><ol>
<li>ã€Š<a target="_blank" rel="noopener" href="https://webpack.js.org/contribute/writing-a-plugin/">Writing a Plugin</a>ã€‹</li>
<li>ã€Š<a target="_blank" rel="noopener" href="https://webpack.js.org/plugins/html-webpack-plugin/">HtmlWebpackPlugin - Webpack</a>ã€‹</li>
<li>ã€Š<a target="_blank" rel="noopener" href="https://www.cnblogs.com/mjian/p/9250095.html">æ‰©å±• HtmlwebpackPlugin æ’å…¥è‡ªå®šä¹‰çš„è„šæœ¬</a>ã€‹</li>
</ol>
<h2 id="å…³äºæˆ‘"><a href="#å…³äºæˆ‘" class="headerlink" title="å…³äºæˆ‘"></a>å…³äºæˆ‘</h2><table>
<thead>
<tr>
<th>Author</th>
<th>ç‹å¹³å®‰</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#112;&#105;&#110;&#103;&#97;&#110;&#56;&#55;&#x38;&#x37;&#64;&#x71;&#113;&#x2e;&#x63;&#111;&#x6d;">&#112;&#105;&#110;&#103;&#97;&#110;&#56;&#55;&#x38;&#x37;&#64;&#x71;&#113;&#x2e;&#x63;&#111;&#x6d;</a></td>
</tr>
<tr>
<td>åš  å®¢</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>å¾®  ä¿¡</td>
<td>pingan8787</td>
</tr>
<tr>
<td>æ¯æ—¥æ–‡ç« æ¨è</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>ESå°å†Œ</td>
<td>js.pingan8787.com</td>
</tr>
</tbody></table>
<h2 id="å¾®ä¿¡å…¬ä¼—å·"><a href="#å¾®ä¿¡å…¬ä¼—å·" class="headerlink" title="å¾®ä¿¡å…¬ä¼—å·"></a>å¾®ä¿¡å…¬ä¼—å·</h2><p><img src="https://user-gold-cdn.xitu.io/2020/2/22/1706bb1ea5f680ae?w=885&h=445&f=png&s=80093" alt="bg">  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/24/198-%E3%80%90Webpack%E3%80%91Webpack%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%A6%82%E6%AD%A4%E7%AE%80%E5%8D%95%EF%BC%81/" data-id="ckts3eju2005j4d9k346s7az9" data-title="198-ã€Webpackã€‘Webpackæ’ä»¶å¼€å‘å¦‚æ­¤ç®€å•ï¼" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Webpack/" rel="tag">Webpack</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">å‰ç«¯å¼€å‘</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">åŸåˆ›</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/2/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><a class="extend next" rel="next" href="/page/4/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Angular/" rel="tag">Angular</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/" rel="tag">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS%E5%8A%A8%E7%94%BB/" rel="tag">CSSåŠ¨ç”»</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Chrome/" rel="tag">Chrome</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES6-ES7-ES8/" rel="tag">ES6/ES7/ES8</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Eslint/" rel="tag">Eslint</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Express/" rel="tag">Express</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GraphQL/" rel="tag">GraphQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/H5/" rel="tag">H5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML/" rel="tag">HTML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/" rel="tag">HTTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP%E5%8D%8F%E8%AE%AE/" rel="tag">HTTPåè®®</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hybrid/" rel="tag">Hybrid</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NPM/" rel="tag">NPM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nodejs/" rel="tag">Nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Numpy/" rel="tag">Numpy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/" rel="tag">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tensorflow/" rel="tag">Tensorflow</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TyeScript/" rel="tag">TyeScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TypeScript/" rel="tag">TypeScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vuejs/" rel="tag">Vuejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebSocket/" rel="tag">WebSocket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Webpack/" rel="tag">Webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/demo/" rel="tag">demo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" rel="tag">ä¸­é—´ä»¶</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" rel="tag">äººå·¥æ™ºèƒ½</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/" rel="tag">å…¨æ ˆå¼€å‘</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">å‰ç«¯å¼€å‘</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E6%8E%A2%E7%B4%A2/" rel="tag">å‰ç«¯æ¢ç´¢</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E7%9F%A5%E4%B9%8E%E7%B3%BB%E5%88%97/" rel="tag">å‰ç«¯çŸ¥ä¹ç³»åˆ—</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">åŸåˆ›</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B8%B8%E7%94%A8%E6%8A%80%E6%9C%AF/" rel="tag">å¸¸ç”¨æŠ€æœ¯</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BE%AE%E5%89%8D%E7%AB%AF/" rel="tag">å¾®å‰ç«¯</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%BB%E7%BB%93/" rel="tag">æ€»ç»“</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">æ•°æ®ç»“æ„</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">æœºå™¨å­¦ä¹ </a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/" rel="tag">æ„å»ºå·¥å…·</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" rel="tag">æ­£åˆ™è¡¨è¾¾å¼</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BA%90%E7%A0%81/" rel="tag">æºç </a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BA%90%E7%A0%81%E7%B2%BE%E8%AF%BB/" rel="tag">æºç ç²¾è¯»</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%83%AD%E9%97%A8/" rel="tag">çƒ­é—¨</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%94%9F%E6%B4%BB%E6%9D%82%E8%AE%B0/" rel="tag">ç”Ÿæ´»æ‚è®°</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">ç®—æ³•</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/" rel="tag">ç¼–è¯‘åŸç†</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/" rel="tag">ç½‘ç»œè¯·æ±‚</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">è®¾è®¡æ¨¡å¼</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag">è¯»ä¹¦ç¬”è®°</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%87%8D%E6%B8%A9%E5%9F%BA%E7%A1%80/" rel="tag">é‡æ¸©åŸºç¡€</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" rel="tag">é¢è¯•é¢˜</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Angular/" style="font-size: 11.88px;">Angular</a> <a href="/tags/CSS/" style="font-size: 18.13px;">CSS</a> <a href="/tags/CSS%E5%8A%A8%E7%94%BB/" style="font-size: 12.5px;">CSSåŠ¨ç”»</a> <a href="/tags/Chrome/" style="font-size: 10px;">Chrome</a> <a href="/tags/ES6-ES7-ES8/" style="font-size: 10.63px;">ES6/ES7/ES8</a> <a href="/tags/Eslint/" style="font-size: 10px;">Eslint</a> <a href="/tags/Express/" style="font-size: 10px;">Express</a> <a href="/tags/GraphQL/" style="font-size: 10px;">GraphQL</a> <a href="/tags/H5/" style="font-size: 10px;">H5</a> <a href="/tags/HTML/" style="font-size: 10px;">HTML</a> <a href="/tags/HTTP/" style="font-size: 11.88px;">HTTP</a> <a href="/tags/HTTP%E5%8D%8F%E8%AE%AE/" style="font-size: 11.25px;">HTTPåè®®</a> <a href="/tags/Hybrid/" style="font-size: 10.63px;">Hybrid</a> <a href="/tags/JavaScript/" style="font-size: 19.38px;">JavaScript</a> <a href="/tags/NPM/" style="font-size: 10px;">NPM</a> <a href="/tags/Nodejs/" style="font-size: 11.25px;">Nodejs</a> <a href="/tags/Numpy/" style="font-size: 10.63px;">Numpy</a> <a href="/tags/Python/" style="font-size: 17.5px;">Python</a> <a href="/tags/React/" style="font-size: 12.5px;">React</a> <a href="/tags/Tensorflow/" style="font-size: 10.63px;">Tensorflow</a> <a href="/tags/TyeScript/" style="font-size: 10px;">TyeScript</a> <a href="/tags/TypeScript/" style="font-size: 11.25px;">TypeScript</a> <a href="/tags/Vuejs/" style="font-size: 14.38px;">Vuejs</a> <a href="/tags/WebSocket/" style="font-size: 10px;">WebSocket</a> <a href="/tags/Webpack/" style="font-size: 15.63px;">Webpack</a> <a href="/tags/demo/" style="font-size: 10.63px;">demo</a> <a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 10px;">ä¸­é—´ä»¶</a> <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" style="font-size: 16.25px;">äººå·¥æ™ºèƒ½</a> <a href="/tags/%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/" style="font-size: 11.25px;">å…¨æ ˆå¼€å‘</a> <a href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" style="font-size: 20px;">å‰ç«¯å¼€å‘</a> <a href="/tags/%E5%89%8D%E7%AB%AF%E6%8E%A2%E7%B4%A2/" style="font-size: 11.25px;">å‰ç«¯æ¢ç´¢</a> <a href="/tags/%E5%89%8D%E7%AB%AF%E7%9F%A5%E4%B9%8E%E7%B3%BB%E5%88%97/" style="font-size: 10.63px;">å‰ç«¯çŸ¥ä¹ç³»åˆ—</a> <a href="/tags/%E5%8E%9F%E5%88%9B/" style="font-size: 18.75px;">åŸåˆ›</a> <a href="/tags/%E5%B8%B8%E7%94%A8%E6%8A%80%E6%9C%AF/" style="font-size: 10.63px;">å¸¸ç”¨æŠ€æœ¯</a> <a href="/tags/%E5%BE%AE%E5%89%8D%E7%AB%AF/" style="font-size: 10px;">å¾®å‰ç«¯</a> <a href="/tags/%E6%80%BB%E7%BB%93/" style="font-size: 13.75px;">æ€»ç»“</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 10px;">æ•°æ®ç»“æ„</a> <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" style="font-size: 15px;">æœºå™¨å­¦ä¹ </a> <a href="/tags/%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/" style="font-size: 10.63px;">æ„å»ºå·¥å…·</a> <a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 10.63px;">æ­£åˆ™è¡¨è¾¾å¼</a> <a href="/tags/%E6%BA%90%E7%A0%81/" style="font-size: 10px;">æºç </a> <a href="/tags/%E6%BA%90%E7%A0%81%E7%B2%BE%E8%AF%BB/" style="font-size: 10px;">æºç ç²¾è¯»</a> <a href="/tags/%E7%83%AD%E9%97%A8/" style="font-size: 10px;">çƒ­é—¨</a> <a href="/tags/%E7%94%9F%E6%B4%BB%E6%9D%82%E8%AE%B0/" style="font-size: 10px;">ç”Ÿæ´»æ‚è®°</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 13.13px;">ç®—æ³•</a> <a href="/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/" style="font-size: 10px;">ç¼–è¯‘åŸç†</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/" style="font-size: 10px;">ç½‘ç»œè¯·æ±‚</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 15px;">è®¾è®¡æ¨¡å¼</a> <a href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" style="font-size: 14.38px;">è¯»ä¹¦ç¬”è®°</a> <a href="/tags/%E9%87%8D%E6%B8%A9%E5%9F%BA%E7%A1%80/" style="font-size: 16.88px;">é‡æ¸©åŸºç¡€</a> <a href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" style="font-size: 10px;">é¢è¯•é¢˜</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/07/28/227-%E3%80%90%E6%80%BB%E7%BB%93%E3%80%91%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E5%9C%A8%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%BD%BF%E7%94%A8SVG%E5%AD%97%E4%BD%93%E5%9B%BE%E6%A0%87/">227-ã€æ€»ç»“ã€‘å¦‚ä½•ä¼˜é›…çš„åœ¨å¾®ä¿¡å°ç¨‹åºä½¿ç”¨SVGå­—ä½“å›¾æ ‡</a>
          </li>
        
          <li>
            <a href="/2021/07/28/226-%E3%80%90HTTP%E3%80%91%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E7%AE%A1%E7%90%86HTTP%E8%AF%B7%E6%B1%82%E5%92%8C%E5%93%8D%E5%BA%94%E6%8B%A6%E6%88%AA%E5%99%A8%EF%BC%9F/">226-ã€HTTPã€‘å¦‚ä½•ä¼˜é›…çš„ç®¡ç†HTTPè¯·æ±‚å’Œå“åº”æ‹¦æˆªå™¨ï¼Ÿ</a>
          </li>
        
          <li>
            <a href="/2021/07/28/225-%E3%80%90Vue%E3%80%91%E4%BB%8E%E6%89%8B%E5%86%99Vue3%E7%9A%84Reactivity%E5%BC%80%E5%A7%8B%E6%B7%B1%E5%85%A5Vue3%E6%BA%90%E7%A0%81/">225-ã€Vueã€‘ä»æ‰‹å†™Vue3çš„Reactivityå¼€å§‹æ·±å…¥Vue3æºç </a>
          </li>
        
          <li>
            <a href="/2021/05/30/224-%E3%80%90Chrome%E3%80%915%E4%B8%AAChrome%E8%B0%83%E8%AF%95%E6%B7%B7%E5%90%88%E5%BA%94%E7%94%A8%E7%9A%84%E6%8A%80%E5%B7%A7/">224-ã€Chromeã€‘5ä¸ªChromeè°ƒè¯•æ··åˆåº”ç”¨çš„æŠ€å·§</a>
          </li>
        
          <li>
            <a href="/2021/03/19/223-%E3%80%90%E5%89%8D%E7%AB%AF%E6%8E%A2%E7%B4%A2%E3%80%91%E6%8E%A2%E7%B4%A2Snabbdom%E6%A8%A1%E5%9D%97%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/">223-ã€å‰ç«¯æ¢ç´¢ã€‘æ¢ç´¢Snabbdomæ¨¡å—ç³»ç»ŸåŸç†</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>