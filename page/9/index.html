<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/9/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-147-【CuteJavaScript】设计模式——工厂模式" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/03/03/147-%E3%80%90CuteJavaScript%E3%80%91%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E2%80%94%E2%80%94%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/" class="article-date">
  <time class="dt-published" datetime="2019-03-03T13:55:13.000Z" itemprop="datePublished">2019-03-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/03/03/147-%E3%80%90CuteJavaScript%E3%80%91%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E2%80%94%E2%80%94%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/">147-【CuteJavaScript】设计模式——工厂模式</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <hr>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#x70;&#105;&#x6e;&#103;&#x61;&#110;&#56;&#x37;&#x38;&#55;&#64;&#x71;&#113;&#46;&#x63;&#x6f;&#x6d;">&#x70;&#105;&#x6e;&#103;&#x61;&#110;&#56;&#x37;&#x38;&#55;&#64;&#x71;&#113;&#46;&#x63;&#x6f;&#x6d;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>微信公众号</td>
<td>前端自习课</td>
</tr>
</tbody></table>
<h2 id="二、工厂模式-Factory-Pattern"><a href="#二、工厂模式-Factory-Pattern" class="headerlink" title="二、工厂模式(Factory Pattern)"></a>二、工厂模式(Factory Pattern)</h2><h3 id="1-概念介绍"><a href="#1-概念介绍" class="headerlink" title="1.概念介绍"></a>1.概念介绍</h3><p><strong>工厂模式</strong>的目的在于创建对象，实现下列目标：   </p>
<ul>
<li>可重复执行，来创建相似对象；</li>
<li>当编译时位置具体类型（类）时，为调用者提供一种创建对象的接口；   </li>
</ul>
<p>通过工厂方法（或类）创建的对象，都继承父对象，下面一个简单工厂方法理解：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age, sex</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> p = &#123;&#125;; <span class="comment">// 或 let p = new Object(); 创建一个初始对象</span></span><br><span class="line">    p.name = name;</span><br><span class="line">    p.age = age;</span><br><span class="line">    p.sex = sex;</span><br><span class="line">    p.ask = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;my name is&#x27;</span> + <span class="built_in">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> leo = <span class="keyword">new</span> Person(<span class="string">&#x27;leo&#x27;</span>, <span class="number">18</span>, <span class="string">&#x27;boy&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> pingan = <span class="keyword">new</span> Person(<span class="string">&#x27;pingan&#x27;</span>, <span class="number">18</span>, <span class="string">&#x27;boy&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(leo.name, leo.age, leo.sex);          <span class="comment">// &#x27;leo&#x27;, 18, &#x27;boy&#x27;</span></span><br><span class="line"><span class="built_in">console</span>.log(pingan.name, pingan.age, pingan.sex); <span class="comment">// &#x27;pingan&#x27;, 18, &#x27;boy&#x27;</span></span><br></pre></td></tr></table></figure>
<p>通过调用<code>Person</code>构造函数，我们可以像工厂那样，生产出无数个包含三个属性和一个方法的对象。<br>可以看出，<strong>工厂模式</strong>可以解决创建多个类似对象的问题。    </p>
<h3 id="2-优缺点"><a href="#2-优缺点" class="headerlink" title="2.优缺点"></a>2.优缺点</h3><h4 id="2-1优点"><a href="#2-1优点" class="headerlink" title="2.1优点"></a>2.1优点</h4><ul>
<li>一个调用者想创建一个对象，只要知道其名称就可以了。 </li>
<li>扩展性高，如果想增加一个产品，只要扩展一个工厂类就可以。 </li>
<li>屏蔽产品的具体实现，调用者只关心产品的接口。</li>
</ul>
<h4 id="2-2缺点"><a href="#2-2缺点" class="headerlink" title="2.2缺点"></a>2.2缺点</h4><p>每次增加一个产品时，都需要增加一个具体类和对象实现工厂，使得系统中类的个数成倍增加，在一定程度上增加了系统的复杂度，同时也增加了系统具体类的依赖。这并不是什么好事。</p>
<h3 id="3-实现复杂工厂模式"><a href="#3-实现复杂工厂模式" class="headerlink" title="3.实现复杂工厂模式"></a>3.实现复杂工厂模式</h3><p>在复杂工厂模式中，我们将其成员对象的实列化推迟到子类中，子类可以重写父类接口方法以便创建的时候指定自己的对象类型。<br>父类类似一个公共函数，只处理创建过程中的问题，并且这些处理将被子类继承，然后在子类实现专门功能。   </p>
<p>比如这里我们需要实现这么一个实例：   </p>
<ul>
<li>需要一个公共父函数<code>CarMaker</code>；</li>
<li>父函数<code>CarMaker</code>有个<code>factor</code>静态方法，用于创建<code>car</code>对象；</li>
<li>定义三个静态属性，值为三个函数，用于继承父函数<code>CarMaker</code>；</li>
</ul>
<p>然后我们希望这么使用这个函数：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> c1 = CarMaker.factory(<span class="string">&#x27;Car1&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> c2 = CarMaker.factory(<span class="string">&#x27;Car2&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> c3 = CarMaker.factory(<span class="string">&#x27;Car3&#x27;</span>);</span><br><span class="line">c1.drirve();  <span class="comment">// &#x27;我的编号是6&#x27;</span></span><br><span class="line">c2.drirve();  <span class="comment">// &#x27;我的编号是3&#x27;</span></span><br><span class="line">c3.drirve();  <span class="comment">// &#x27;我的编号是12&#x27;</span></span><br></pre></td></tr></table></figure>
<p>可以看出，调用时接收以字符串形式指定类型，并返回请求类型的对象，并且这样使用是不需要用<code>new</code>操作符。   </p>
<p>下面看代码实现：    </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建父构造函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CarMaker</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line">CarMaker.prototype.drive = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`我的编号是<span class="subst">$&#123;<span class="built_in">this</span>.id&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 添加静态工厂方法</span></span><br><span class="line">CarMaker.factory = <span class="function"><span class="keyword">function</span> (<span class="params">type</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> types = type, newcar;</span><br><span class="line">    <span class="comment">// 若构造函数不存在 则发生错误</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> CarMaker[types] !== <span class="string">&#x27;function&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span>&#123; <span class="attr">name</span>: <span class="string">&#x27;Error&#x27;</span>, <span class="attr">message</span>: <span class="string">`<span class="subst">$&#123;types&#125;</span>不存在`</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 若构造函数存在，则让原型继承父类，但仅继承一次</span></span><br><span class="line">    <span class="keyword">if</span>(CarMaker[types].prototype.drive !== <span class="string">&#x27;function&#x27;</span>)&#123;</span><br><span class="line">        CarMaker[types].prototype = <span class="keyword">new</span> CarMaker();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 创建新实例，并返回</span></span><br><span class="line">    newcar = <span class="keyword">new</span> CarMaker[types]();</span><br><span class="line">    <span class="keyword">return</span> newcar;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 调用</span></span><br><span class="line">CarMaker.c1 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.id = <span class="number">6</span>;</span><br><span class="line">&#125;</span><br><span class="line">CarMaker.c2 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.id = <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line">CarMaker.c3 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.id = <span class="number">12</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>定义完成后，我们再执行前面的代码：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> c1 = CarMaker.factory(<span class="string">&#x27;Car1&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> c2 = CarMaker.factory(<span class="string">&#x27;Car2&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> c3 = CarMaker.factory(<span class="string">&#x27;Car3&#x27;</span>);</span><br><span class="line">c1.drirve();  <span class="comment">// &#x27;我的编号是6&#x27;</span></span><br><span class="line">c2.drirve();  <span class="comment">// &#x27;我的编号是3&#x27;</span></span><br><span class="line">c3.drirve();  <span class="comment">// &#x27;我的编号是12&#x27;</span></span><br></pre></td></tr></table></figure>
<p>就能正常打印结果了。   </p>
<p>实现该工厂模式并不困难，主要是要找到能够穿件所需类型对象的构造函数。<br>这里使用简单的映射来创建该对象的构造函数。     </p>
<h3 id="4-内置对象工厂"><a href="#4-内置对象工厂" class="headerlink" title="4.内置对象工厂"></a>4.内置对象工厂</h3><p>内置的对象工厂，就像全局的<code>Object()</code>构造函数，也是工厂模式的行为，根据输入类型创建不同对象。<br>如传入一个原始数字，返回一个<code>Number()</code>构造函数创建一个对象，传入一个字符串或布尔值也成立。<br>对于传入任何其他值，包括无输入的值，都会创建一个常规的对象。    </p>
<p>无论是否使用<code>new</code>操作符，都可以调用<code>Object()</code>，我们这么测试：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="built_in">Object</span>(), b = <span class="keyword">new</span> <span class="built_in">Object</span>(<span class="number">1</span>),</span><br><span class="line">    c = <span class="built_in">Object</span>(<span class="string">&#x27;1&#x27;</span>),  d = <span class="built_in">Object</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">a.constructor === <span class="built_in">Object</span>;  <span class="comment">// true </span></span><br><span class="line">b.constructor === <span class="built_in">Number</span>;  <span class="comment">// true </span></span><br><span class="line">c.constructor === <span class="built_in">String</span>;  <span class="comment">// true </span></span><br><span class="line">d.constructor === <span class="built_in">Boolean</span>; <span class="comment">// true </span></span><br></pre></td></tr></table></figure>
<p>事实上，<code>Object()</code>用途不大，这里列出来是因为它是我们比较常见的工厂模式。    </p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li>《JavaScript Patterns》</li>
</ol>
<p><strong>本部分内容到这结束</strong></p>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#112;&#105;&#x6e;&#103;&#97;&#110;&#56;&#55;&#x38;&#55;&#64;&#113;&#113;&#x2e;&#x63;&#x6f;&#x6d;">&#112;&#105;&#x6e;&#103;&#97;&#110;&#56;&#55;&#x38;&#55;&#64;&#113;&#113;&#x2e;&#x63;&#x6f;&#x6d;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>JS小册</td>
<td>js.pingan8787.com</td>
</tr>
<tr>
<td>微信公众号</td>
<td>前端自习课</td>
</tr>
</tbody></table>
<p><img src="http://images.pingan8787.com/2019_07_12guild_page.png" alt="bg">  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/03/03/147-%E3%80%90CuteJavaScript%E3%80%91%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E2%80%94%E2%80%94%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/" data-id="ckts3ejt5002w4d9k6dtsfgp4" data-title="147-【CuteJavaScript】设计模式——工厂模式" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-146-【CuteJavaScript】设计模式——单体模式" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/03/03/146-%E3%80%90CuteJavaScript%E3%80%91%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E2%80%94%E2%80%94%E5%8D%95%E4%BD%93%E6%A8%A1%E5%BC%8F/" class="article-date">
  <time class="dt-published" datetime="2019-03-03T13:51:56.000Z" itemprop="datePublished">2019-03-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/03/03/146-%E3%80%90CuteJavaScript%E3%80%91%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E2%80%94%E2%80%94%E5%8D%95%E4%BD%93%E6%A8%A1%E5%BC%8F/">146-【CuteJavaScript】设计模式——单体模式</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <hr>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#112;&#105;&#110;&#x67;&#x61;&#x6e;&#56;&#55;&#x38;&#55;&#64;&#x71;&#113;&#46;&#99;&#111;&#x6d;">&#112;&#105;&#110;&#x67;&#x61;&#x6e;&#56;&#55;&#x38;&#55;&#64;&#x71;&#113;&#46;&#99;&#111;&#x6d;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>微信公众号</td>
<td>前端自习课</td>
</tr>
</tbody></table>
<h2 id="一、单体模式-Singleton-Pattern"><a href="#一、单体模式-Singleton-Pattern" class="headerlink" title="一、单体模式(Singleton Pattern)"></a>一、单体模式(Singleton Pattern)</h2><h3 id="1-概念介绍"><a href="#1-概念介绍" class="headerlink" title="1.概念介绍"></a>1.概念介绍</h3><p><strong>单体模式(Singleton Pattern)<strong>的思想在于</strong>保证一个特定类仅有一个实例</strong>，即不管使用这个类创建多少个新对象，都会得到<strong>与第一次创建的对象完全相同</strong>。 </p>
<p>它让我们能将代码组织成一个逻辑单元，并可以通过单一变量进行访问。   </p>
<p>单体模式有以下优点：   </p>
<ul>
<li>用来划分命名空间，减少全局变量数量。   </li>
<li>使代码组织的更一致，提高代码阅读性和维护性。</li>
<li>只能被实例化一次。</li>
</ul>
<p>但在JavaScript中没有类，只有对象。当我们创建一个新对象，它都是个新的单体，因为JavaScript中永远不会有完全相等的对象，除非它们是同一个对象。<br>因此，<strong>我们每次使用对象字面量创建对象的时候，实际上就是在创建一个单例</strong>。   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a1 = &#123; <span class="attr">name</span> : <span class="string">&#x27;leo&#x27;</span> &#125;;</span><br><span class="line"><span class="keyword">let</span> a2 = &#123; <span class="attr">name</span> : <span class="string">&#x27;leo&#x27;</span> &#125;;</span><br><span class="line">a1 === a2;  <span class="comment">// false</span></span><br><span class="line">a1 == a2;   <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<p>这里需要注意，单体模式有个条件，是该对象能被实例化，比如下面这样就不是单体模式，因为它不能被实例化：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a1 = &#123;</span><br><span class="line">    <span class="attr">b1</span>: <span class="number">1</span>, <span class="attr">b2</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">m1</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.b1;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">m2</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.b2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> a1();  <span class="comment">// Uncaught TypeError: a1 is not a constructor</span></span><br></pre></td></tr></table></figure>
<p>下面展示一个单体模式的基本结构：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> Singleton = <span class="function"><span class="keyword">function</span> (<span class="params">name</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">    <span class="built_in">this</span>.obj = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">Singleton.prototype.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getObj</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.obj || (<span class="built_in">this</span>.obj = <span class="keyword">new</span> Singleton(name));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> g1 = getObj(<span class="string">&#x27;leo&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> g2 = getObj(<span class="string">&#x27;pingan&#x27;</span>);</span><br><span class="line">g1 === g2;    <span class="comment">// true</span></span><br><span class="line">g1 == g2;     <span class="comment">// true</span></span><br><span class="line">g1.getName(); <span class="comment">// &#x27;leo&#x27;</span></span><br><span class="line">g2.getName(); <span class="comment">// &#x27;leo&#x27;</span></span><br></pre></td></tr></table></figure>
<p>从这里可以看出，单体模式只能实例化一次，后面再调用的话，都是使用第一次实例化的结果。   </p>
<h3 id="2-应用场景"><a href="#2-应用场景" class="headerlink" title="2.应用场景"></a>2.应用场景</h3><p>单例模式只允许实例化一次，能提高对象访问速度并且节约内存，通常被用于下面场景：</p>
<ul>
<li>需要频繁创建再销毁的对象，或频繁使用的对象：如：弹窗，文件；   </li>
<li>常用的工具类对象；   </li>
<li>常用的资源消耗大的对象；   </li>
</ul>
<h3 id="3-实现弹框案例"><a href="#3-实现弹框案例" class="headerlink" title="3.实现弹框案例"></a>3.实现弹框案例</h3><p>这里我们要用单体模式，创建一个弹框，大概需要实现：元素值创建一次，使用的时候直接调用。<br>因此我们这么做：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> create = (<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> div;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(!div)&#123;</span><br><span class="line">            div = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">            div.innderHTML = <span class="string">&#x27;我是leo创建的弹框&#x27;</span>;</span><br><span class="line">            div.style.display = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">            div.setAttribute(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;leo&quot;</span>);</span><br><span class="line">            <span class="built_in">document</span>.body.appendChild(div);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> div;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">// 触发事件</span></span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">&#x27;otherBtn&#x27;</span>).onclick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> first = create();</span><br><span class="line">    first.style.display = <span class="string">&#x27;block&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-使用new操作符"><a href="#4-使用new操作符" class="headerlink" title="4.使用new操作符"></a>4.使用new操作符</h3><p>由于JavaScript中没有类，但JavaScript有<code>new</code>语法来用构造函数创建对象，并可以使用这种方法实现单体模式。<br>当使用同一个构造函数以<code>new</code>操作符创建多个对象，获得的是指向完全相同的对象的新指针。</p>
<p>通常我们使用<code>new</code>操作符创建单体模式的三种选择，让构造函数总返回最初的对象：   </p>
<ul>
<li><p>使用全局对象来存储该实例（不推荐，容易全局污染）。   </p>
</li>
<li><p>使用静态属性存储该实例，无法保证该静态属性的私有性。    </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Leo</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> Leo.obj === <span class="string">&#x27;object&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> Leo.obj;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">    Leo.obj = <span class="built_in">this</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a1 = <span class="keyword">new</span> Leo(<span class="string">&#x27;leo&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> a2 = <span class="keyword">new</span> Leo(<span class="string">&#x27;pingan&#x27;</span>);</span><br><span class="line">a1 === a2 ; <span class="comment">// true</span></span><br><span class="line">a1 ==  a2 ; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>唯一的缺点就是<code>obj</code>属性是公开的，容易被修改。   </p>
</li>
<li><p>使用闭包将该实例包裹，保证实例是私有性并不会被外界修改。  </p>
</li>
</ul>
<p>我们这通过重写上面的方法，加入闭包：    </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Leo</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> obj;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">    obj = <span class="built_in">this</span>;       <span class="comment">// 1.存储第一次创建的对象</span></span><br><span class="line">    Leo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">// 2.修改原来的构造函数</span></span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a1 = <span class="keyword">new</span> Leo(<span class="string">&#x27;leo&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> a2 = <span class="keyword">new</span> Leo(<span class="string">&#x27;pingan&#x27;</span>);</span><br><span class="line">a1 === a2 ; <span class="comment">// true</span></span><br><span class="line">a1 ==  a2 ; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>当我们第一次调用构造函数，像往常一样返回this，而后面再调用的话，都将重写构造函数，并访问私有变量<code>obj</code>并返回。   </p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li>《JavaScript Patterns》</li>
</ol>
<p><strong>本部分内容到这结束</strong></p>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#x70;&#x69;&#110;&#x67;&#x61;&#x6e;&#x38;&#x37;&#x38;&#x37;&#x40;&#113;&#x71;&#x2e;&#x63;&#111;&#x6d;">&#x70;&#x69;&#110;&#x67;&#x61;&#x6e;&#x38;&#x37;&#x38;&#x37;&#x40;&#113;&#x71;&#x2e;&#x63;&#111;&#x6d;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>JS小册</td>
<td>js.pingan8787.com</td>
</tr>
<tr>
<td>微信公众号</td>
<td>前端自习课</td>
</tr>
</tbody></table>
<p><img src="http://images.pingan8787.com/2019_07_12guild_page.png" alt="bg">  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/03/03/146-%E3%80%90CuteJavaScript%E3%80%91%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E2%80%94%E2%80%94%E5%8D%95%E4%BD%93%E6%A8%A1%E5%BC%8F/" data-id="ckts3ejt5002u4d9kezte41od" data-title="146-【CuteJavaScript】设计模式——单体模式" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-145-【CuteJavaScript】Angular6入门项目（4-改造组件和添加HTTP服务）" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/02/23/145-%E3%80%90CuteJavaScript%E3%80%91Angular6%E5%85%A5%E9%97%A8%E9%A1%B9%E7%9B%AE%EF%BC%884-%E6%94%B9%E9%80%A0%E7%BB%84%E4%BB%B6%E5%92%8C%E6%B7%BB%E5%8A%A0HTTP%E6%9C%8D%E5%8A%A1%EF%BC%89/" class="article-date">
  <time class="dt-published" datetime="2019-02-23T03:18:33.000Z" itemprop="datePublished">2019-02-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/02/23/145-%E3%80%90CuteJavaScript%E3%80%91Angular6%E5%85%A5%E9%97%A8%E9%A1%B9%E7%9B%AE%EF%BC%884-%E6%94%B9%E9%80%A0%E7%BB%84%E4%BB%B6%E5%92%8C%E6%B7%BB%E5%8A%A0HTTP%E6%9C%8D%E5%8A%A1%EF%BC%89/">145-【CuteJavaScript】Angular6入门项目（4.改造组件和添加HTTP服务）</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><img src="http://images.pingan8787.com/angular%E7%B3%BB%E5%88%97%E5%B0%81%E9%9D%A2.png" alt="Angular封面"></p>
<hr>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#x70;&#105;&#x6e;&#x67;&#97;&#x6e;&#x38;&#55;&#56;&#x37;&#64;&#113;&#x71;&#46;&#99;&#111;&#109;">&#x70;&#105;&#x6e;&#x67;&#97;&#x6e;&#x38;&#55;&#56;&#x37;&#64;&#113;&#x71;&#46;&#99;&#111;&#109;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>微信公众号</td>
<td>前端自习课</td>
</tr>
</tbody></table>
<h2 id="本文目录"><a href="#本文目录" class="headerlink" title="本文目录"></a>本文目录</h2><ul>
<li>一、<a target="_blank" rel="noopener" href="https://juejin.im/post/5c70ae586fb9a049c64476a0">项目起步</a></li>
<li>二、<a target="_blank" rel="noopener" href="https://juejin.im/post/5c70ae586fb9a049c64476a0">编写路由组件</a></li>
<li>三、<a target="_blank" rel="noopener" href="https://juejin.im/post/5c70b48d6fb9a04a0b22cbce">编写页面组件</a>   <ul>
<li>1.<a target="_blank" rel="noopener" href="https://juejin.im/post/5c70b48d6fb9a04a0b22cbce">编写单一组件</a></li>
<li>2.<a target="_blank" rel="noopener" href="https://juejin.im/post/5c70b48d6fb9a04a0b22cbce">模拟数据</a></li>
<li>3.<a target="_blank" rel="noopener" href="https://juejin.im/post/5c70b48d6fb9a04a0b22cbce">编写主从组件</a></li>
</ul>
</li>
<li>四、<a target="_blank" rel="noopener" href="https://juejin.im/post/5c70b5486fb9a049d7484fdf">编写服务</a><ul>
<li>1.<a target="_blank" rel="noopener" href="https://juejin.im/post/5c70b5486fb9a049d7484fdf">为什么需要服务</a></li>
<li>2.<a target="_blank" rel="noopener" href="https://juejin.im/post/5c70b5486fb9a049d7484fdf">编写服务</a></li>
</ul>
</li>
<li>五、<a target="_blank" rel="noopener" href="https://juejin.im/post/5c70b5486fb9a049d7484fdf">引入RxJS</a><ul>
<li>1.<a target="_blank" rel="noopener" href="https://juejin.im/post/5c70b5486fb9a049d7484fdf">关于RxJS</a></li>
<li>2.<a target="_blank" rel="noopener" href="https://juejin.im/post/5c70b5486fb9a049d7484fdf">引入RxJS</a></li>
<li>3.<a target="_blank" rel="noopener" href="https://juejin.im/post/5c70b5486fb9a049d7484fdf">改造数据获取方式</a></li>
</ul>
</li>
<li>六、<strong>改造组件</strong><ul>
<li>1.<strong>添加历史记录组件</strong></li>
<li>2.<strong>添加和删除历史记录</strong></li>
</ul>
</li>
<li>七、<strong>HTTP改造</strong><ul>
<li>1.<strong>引入HTTP</strong></li>
<li>2.<strong>通过HTTP请求数据</strong></li>
<li>3.<strong>通过HTTP修改数据</strong></li>
<li>4.<strong>通过HTTP增加数据</strong></li>
<li>5.<strong>通过HTTP删除数据</strong></li>
<li>6.<strong>通过HTTP查找数据</strong></li>
</ul>
</li>
</ul>
<h2 id="六、改造组件"><a href="#六、改造组件" class="headerlink" title="六、改造组件"></a>六、改造组件</h2><p>从这里开始，我们要使用RxJS来改造组件和添加新功能了，让整个项目更加完善。    </p>
<h3 id="1-添加历史记录组件"><a href="#1-添加历史记录组件" class="headerlink" title="1.添加历史记录组件"></a>1.添加历史记录组件</h3><ul>
<li>创建<code>HistoryComponent</code>组件<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng g component hostory</span><br></pre></td></tr></table></figure>
然后在<code>app.component.html</code>文件夹中添加组件：   <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- app.component.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">app-history</span>&gt;</span><span class="tag">&lt;/<span class="name">app-history</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-添加增删改查功能"><a href="#2-添加增删改查功能" class="headerlink" title="2.添加增删改查功能"></a>2.添加增删改查功能</h3><p>这里我们要开始做书本的增删改查功能，需要先创建一个<code>HistoryService</code>服务，方便我们实现这几个功能：   </p>
<ul>
<li><p>创建<code>HistoryService</code>服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng g service <span class="built_in">history</span></span><br></pre></td></tr></table></figure>
<p>然后在生成的ts文件中，增加<code>add</code>和<code>clear</code>方法，<code>add</code>方法用来添加历史记录到<code>history</code>数组中，<code>clear</code>方法则是清空<code>history</code>数组：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// history.service.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">HistoryService</span> </span>&#123;</span><br><span class="line">    <span class="attr">history</span>: string[] = [];</span><br><span class="line">    <span class="function"><span class="title">add</span>(<span class="params">history: string</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.history.push(history);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">clear</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.history = [];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>使用<code>HistoryService</code>服务</p>
</li>
</ul>
<p>在将这个服务，注入到<code>BooksService</code>中，并改造<code>getBooks</code>方法：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// books.service.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; HistoryService &#125; <span class="keyword">from</span> <span class="string">&#x27;./history.service&#x27;</span>;</span><br><span class="line"><span class="function"><span class="title">constructor</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    private historyservice: HistoryService</span></span></span><br><span class="line"><span class="params"><span class="function"></span>)</span> &#123; &#125;</span><br><span class="line">getBooks(): <span class="keyword">void</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.historyservice.add(<span class="string">&#x27;请求书本数据&#x27;</span>)</span><br><span class="line">    <span class="built_in">this</span>.booksservice.getBookList()</span><br><span class="line">        .subscribe(<span class="function"><span class="params">books</span> =&gt;</span> <span class="built_in">this</span>.books = books);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也可以用相同方法，在<code>IndexComponent</code>中添加<code>访问首页书本列表</code>的记录。    </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.component.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; HistoryService &#125; <span class="keyword">from</span> <span class="string">&#x27;../history.service&#x27;</span>;</span><br><span class="line"><span class="function"><span class="title">constructor</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    private booksservice: BooksService,</span></span></span><br><span class="line"><span class="params"><span class="function">    private historyservice: HistoryService</span></span></span><br><span class="line"><span class="params"><span class="function"></span>)</span> &#123; &#125;</span><br><span class="line">getBooks(): <span class="keyword">void</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.historyservice.add(<span class="string">&#x27;访问首页书本列表&#x27;</span>);</span><br><span class="line">    <span class="built_in">this</span>.booksservice.getBookList()</span><br><span class="line">        .subscribe(<span class="function"><span class="params">books</span> =&gt;</span> <span class="built_in">this</span>.books = books);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来，将我们的<code>HistoryService</code>注入到<code>HistoryComponent</code>中，然后才能将历史数据显示到页面上：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// history.component.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; HistoryService &#125; <span class="keyword">from</span> <span class="string">&#x27;../history.service&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">HistoryComponent</span> <span class="title">implements</span> <span class="title">OnInit</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">private historyservice: HistoryService</span>)</span> &#123; &#125;</span><br><span class="line">    <span class="function"><span class="title">ngOnInit</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- history.component.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngIf</span>=<span class="string">&quot;historyservice.history.length&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>操作历史：<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;clear&quot;</span></span></span><br><span class="line"><span class="tag">        (<span class="attr">click</span>)=<span class="string">&quot;historyservice.clear()&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span>清除<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngFor</span>=<span class="string">&quot;let item of historyservice.history&quot;</span>&gt;</span>&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>代码解释</strong>：<br><code>*ngIf=&quot;historyservice.history.length&quot;</code>，是为了防止还没有拿到历史数据，导致后面的报错。<br><code>(click)=&quot;historyservice.clear()&quot;</code>, 绑定我们服务中的<code>clear</code>事件，实现清除缓存。<br><code>*ngFor=&quot;let item of historyservice.history&quot;</code>，将我们的历史数据渲染到页面上。   </p>
<p>到了这一步，就能看到历史数据了，每次也换到首页，都会增加一条。    </p>
<p><img src="http://images.pingan8787.com/angular_books_5_1.png" alt="图片5-1"></p>
<p>接下来，我们要在书本详情页也加上历史记录的统计，导入文件，注入服务，然后改造<code>getBooks</code>方法，实现历史记录的统计：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// detail.component.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; HistoryService &#125; <span class="keyword">from</span> <span class="string">&#x27;../history.service&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">DetailComponent</span> <span class="title">implements</span> <span class="title">OnInit</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">        private route: ActivatedRoute,</span></span></span><br><span class="line"><span class="params"><span class="function">        private location: Location,</span></span></span><br><span class="line"><span class="params"><span class="function">        private booksservice: BooksService,</span></span></span><br><span class="line"><span class="params"><span class="function">        private historyservice: HistoryService</span></span></span><br><span class="line"><span class="params"><span class="function">    </span>)</span> &#123; &#125;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    getBooks(id: number): <span class="keyword">void</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.books = <span class="built_in">this</span>.booksservice.getBook(id);</span><br><span class="line">        <span class="built_in">this</span>.historyservice.add(<span class="string">`查看书本<span class="subst">$&#123;<span class="built_in">this</span>.books.title&#125;</span>，id为<span class="subst">$&#123;<span class="built_in">this</span>.books.id&#125;</span>`</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>.books)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://images.pingan8787.com/angular_books_5_2.png" alt="图片5-2"></p>
<p>这时候就可以在历史记录中，看到这些操作的记录了，并且<strong>清除</strong>按钮也正常使用。   </p>
<h2 id="七、HTTP改造"><a href="#七、HTTP改造" class="headerlink" title="七、HTTP改造"></a>七、HTTP改造</h2><p>原本我只想写到上一章，但是想到，我们实际开发中，哪有什么本地数据，基本上数据都是要从服务端去请求，所以这边也有必要引入这一张，模拟实际的HTTP请求。   </p>
<h3 id="1-引入HTTP"><a href="#1-引入HTTP" class="headerlink" title="1.引入HTTP"></a>1.引入HTTP</h3><p>在这一章，我们使用Angular提供的 <code>HttpClient</code> 来添加一些数据持久化特性。<br>然后实现对书本数据进行<strong>获取，增加，修改，删除和查找</strong>功能。 </p>
<p><code>HttpClient</code>是Angular通过 HTTP 与远程服务器通讯的机制。    </p>
<p>这里我们为了让<code>HttpClient</code>在整个应用全局使用，所以将<code>HttpClient</code>导入到根模块<code>app.module.ts</code>中，然后把它加入 <code>@NgModule.imports</code> 数组：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; HttpClientModule &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common/http&#x27;</span>;</span><br><span class="line">@NgModule(&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="attr">imports</span>: [</span><br><span class="line">        BrowserModule,</span><br><span class="line">        AppRoutingModule,</span><br><span class="line">        HttpClientModule</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>这边我们使用 <a target="_blank" rel="noopener" href="https://github.com/angular/in-memory-web-api">内存 Web API（In-memory Web API） </a>模拟出的远程数据服务器通讯。<br><strong>注意：</strong> 这个内存 Web API 模块与 Angular 中的 HTTP 模块无关。</p>
<p>通过下面命令来安装：   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install angular-in-memory-web-api --save</span><br></pre></td></tr></table></figure>
<p>然后在<code>app.module.ts</code>中导入 <code>HttpClientInMemoryWebApiModule</code> 和 <code>InMemoryDataService</code> 类（后面创建）：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.module.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; HttpClientInMemoryWebApiModule &#125; <span class="keyword">from</span> <span class="string">&#x27;angular-in-memory-web-api&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; InMemoryDataService &#125;  <span class="keyword">from</span> <span class="string">&#x27;./in-memory-data.service&#x27;</span>;</span><br><span class="line">@NgModule(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="attr">imports</span>: [</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        HttpClientInMemoryWebApiModule.forRoot(</span><br><span class="line">        InMemoryDataService, &#123;<span class="attr">dataEncapsulation</span>:<span class="literal">false</span>&#125;</span><br><span class="line">        )</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">AppModule</span> </span>&#123; &#125;</span><br></pre></td></tr></table></figure>
<p><strong>知识点：</strong><br><code>forRoot()</code> 配置方法接受一个 InMemoryDataService 类（初期的内存数据库）作为参数。   </p>
<p>然后我们要创建<code>InMemoryDataService</code>类：   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng g service InMemoryData</span><br></pre></td></tr></table></figure>
<p>并将生成的<code>in-memory-data.service.ts</code>修改为：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in-memory-data.service.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Injectable &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; InMemoryDbService &#125; <span class="keyword">from</span> <span class="string">&#x27;angular-in-memory-web-api&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Books &#125; <span class="keyword">from</span> <span class="string">&#x27;./books&#x27;</span>;</span><br><span class="line">@Injectable(&#123;</span><br><span class="line">  <span class="attr">providedIn</span>: <span class="string">&#x27;root&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">InMemoryDataService</span> <span class="title">implements</span> <span class="title">InMemoryDbService</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">createDb</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> books = [</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="attr">id</span>: <span class="number">1</span>, </span><br><span class="line">          <span class="attr">url</span>: <span class="string">&#x27;https://img3.doubanio.com/view/subject/m/public/s29988481.jpg&#x27;</span>,</span><br><span class="line">          <span class="attr">title</span>: <span class="string">&#x27;像火焰像灰烬&#x27;</span>,</span><br><span class="line">          <span class="attr">author</span>: <span class="string">&#x27;程姬&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 省略其他9条数据</span></span><br><span class="line">    ];</span><br><span class="line">    <span class="keyword">return</span> &#123;books&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里先总结<code>InMemoryDbService</code>所提供的RESTful API，后面都要用到：<br>例如如果<code>url</code>是<code>api/books</code>，那么  </p>
<ul>
<li>查询所有成员：以<strong>GET</strong>方法访问<code>api/books</code>    </li>
<li>查询某个成员：以<strong>GET</strong>方法访问<code>api/books/id</code>，比如<code>id</code>是<code>1</code>，那么访问<code>api/books/1</code>  </li>
<li>更新某个成员：以<strong>PUT</strong>方法访问<code>api/books/id</code>   </li>
<li>删除某个成员：以<strong>DELETE</strong>方法访问<code>api/books/id</code>    </li>
<li>增加一个成员：以<strong>POST</strong>方法访问<code>api/books</code>   </li>
</ul>
<h3 id="2-通过HTTP请求数据"><a href="#2-通过HTTP请求数据" class="headerlink" title="2.通过HTTP请求数据"></a>2.通过HTTP请求数据</h3><p>现在要为接下来的网络请求做一些准备，先在<code>books.service.ts</code>中引入HTTP符号，然后注入<code>HttpClient</code>并改造：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// books.service.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; HttpClient, HttpHeaders&#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common/http&#x27;</span>;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">BooksService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">        private historyservice: HistoryService,</span></span></span><br><span class="line"><span class="params"><span class="function">        private http: HttpClient</span></span></span><br><span class="line"><span class="params"><span class="function">    </span>)</span> &#123; &#125;</span><br><span class="line">    private <span class="function"><span class="title">log</span>(<span class="params">histories: string</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.historyservice.add(<span class="string">`正在执行：<span class="subst">$&#123;histories&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    private booksUrl = <span class="string">&#x27;api/books&#x27;</span>; <span class="comment">// 提供一个API供调用</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里我们还新增一个私有方法<code>log</code>和一个私有变量<code>booksUrl</code>。    </p>
<p>接下来我们要开始发起http请求数据，开始改造<code>getBookList</code>方法：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// books.service.ts</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">getBookList(): Observable&lt;Books[]&gt; &#123;</span><br><span class="line">    <span class="built_in">this</span>.historyservice.add(<span class="string">&#x27;请求书本数据&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.http.get&lt;Books[]&gt;(<span class="built_in">this</span>.booksUrl);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>
<p>这里我们使用 <code>http.get</code> 替换了 <code>of</code>，其它没修改，但是应用仍然在正常工作，这是因为这两个函数都返回了 <code>Observable&lt;Hero[]&gt;</code>。   </p>
<p>实际开发中，我们还需要考虑到<strong>请求的错误处理</strong>，要捕获错误，我们就要使用 RxJS 的 <code>catchError()</code> 操作符来建立对 Observable 结果的处理管道（pipe）。   </p>
<p>我们引入<code>catchError </code>并改造原本<code>getBookList</code>方法：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// books.service.ts</span></span><br><span class="line">getBookList(): Observable&lt;Books[]&gt; &#123;</span><br><span class="line">    <span class="built_in">this</span>.historyservice.add(<span class="string">&#x27;请求书本数据&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.http.get&lt;Books[]&gt;(<span class="built_in">this</span>.booksUrl).pipe(</span><br><span class="line">        catchError(<span class="built_in">this</span>.handleError&lt;Books[]&gt;(<span class="string">&#x27;getHeroes&#x27;</span>, []))</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line">private handleError&lt;T&gt; (operation = <span class="string">&#x27;operation&#x27;</span>, result?: T) &#123;</span><br><span class="line">    <span class="keyword">return</span> (error: any): Observable&lt;T&gt; =&gt; &#123;</span><br><span class="line">        <span class="built_in">this</span>.log(<span class="string">`<span class="subst">$&#123;operation&#125;</span> 失败: <span class="subst">$&#123;error.message&#125;</span>`</span>); <span class="comment">// 发出错误通知</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">of</span>(result <span class="keyword">as</span> T); <span class="comment">// 返回空结果避免程序出错</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>知识点</strong>：<br><code>.pipe()</code> 方法用来扩展 <code>Observable</code> 的结果。<br><code>catchError()</code> 操作符会拦截失败的 Observable。并把错误对象传给错误处理器，错误处理器会处理这个错误。<br><code>handleError()</code> 错误处理函数做了两件事，发出错误通知和返回空结果避免程序出错。   </p>
<p>这里还需要使用<code>tap</code>操作符改造<code>getBookList</code>方法，来窥探<code>Observable</code>数据流，它会查看<code>Observable</code>的值，然后我们使用<code>log</code>方法，记录一条历史记录。<br><code>tap</code> 回调不会改变这些值本身。   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// books.service.ts</span></span><br><span class="line">getBookList(): Observable&lt;Books[]&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.http.get&lt;Books[]&gt;(<span class="built_in">this</span>.booksUrl)</span><br><span class="line">        .pipe(</span><br><span class="line">            tap( <span class="function"><span class="params">_</span> =&gt;</span> <span class="built_in">this</span>.log(<span class="string">&#x27;请求书本数据&#x27;</span>)),</span><br><span class="line">            catchError(<span class="built_in">this</span>.handleError&lt;Books[]&gt;(<span class="string">&#x27;getHeroes&#x27;</span>, []))</span><br><span class="line">        );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-通过HTTP修改数据"><a href="#3-通过HTTP修改数据" class="headerlink" title="3.通过HTTP修改数据"></a>3.通过HTTP修改数据</h3><p>这里我们需要在原来<code>DetailComponent</code>上面，添加一个输入框、保存按钮和返回按钮，就像这样：   </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- detail.component.html --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 前面代码省略 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>修改信息：<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span>新标题：</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> [(<span class="attr">ngModel</span>)]=<span class="string">&quot;books.title&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入新标题&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> (<span class="attr">click</span>)=<span class="string">&quot;save()&quot;</span>&gt;</span>保存<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> (<span class="attr">click</span>)=<span class="string">&quot;goBack()&quot;</span>&gt;</span>返回<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这边切记一点，一定要在<code>app.module.ts</code>中引入 <code>FormsModule</code>模块，并在<code>@NgModule</code>的<code>imports</code>中引入，不然要报错了。 </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.module.ts</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">import</span> &#123; FormsModule &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/forms&#x27;</span>; </span><br><span class="line">@NgModule(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="attr">imports</span>: [</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        FormsModule</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><code>input</code>框绑定书本的标题<code>books.title</code>，而保存按钮绑定一个<code>save()</code>方法，这里还要实现这个方法：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// detail.component.ts</span></span><br><span class="line">save(): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.historyservice.updateBooks(<span class="built_in">this</span>.books)</span><br><span class="line">        .subscribe(<span class="function">() =&gt;</span> <span class="built_in">this</span>.goBack());</span><br><span class="line">&#125;</span><br><span class="line">goBack(): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.location.back();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里通过调用<code>BooksService</code>的<code>updateBooks</code>方法，将当前修改后的书本信息修改到源数据中，这里我们需要去<code>books.service.ts</code>中添加<code>updateBooks</code>方法：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// books.service.ts</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">updateBooks(books: Books): Observable&lt;any&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.http.put(<span class="built_in">this</span>.booksUrl, books, httpOptions).pipe(</span><br><span class="line">        tap(<span class="function"><span class="params">_</span> =&gt;</span> <span class="built_in">this</span>.log(<span class="string">`修改书本的id是<span class="subst">$&#123;books.id&#125;</span>`</span>)),</span><br><span class="line">        catchError(<span class="built_in">this</span>.handleError&lt;Books&gt;(<span class="string">`getBooks请求是id为<span class="subst">$&#123;books.id&#125;</span>`</span>))</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>
<p><strong>知识点</strong>：<br><code>HttpClient.put()</code> 方法接受三个参数：<code>URL 地址</code>、<code>要修改的数据</code>和<code>其他选项</code>。<br><code>httpOptions</code> 常量需要定义在<code>@Injectable</code>修饰器之前。   </p>
<p>现在，我们点击首页，选择一本书进入详情，修改标题然后保存，会发现，首页上这本书的名称也会跟着改变呢。这算是好了。     </p>
<h3 id="4-通过HTTP增加数据"><a href="#4-通过HTTP增加数据" class="headerlink" title="4.通过HTTP增加数据"></a>4.通过HTTP增加数据</h3><p>我们可以新增一个页面，并添加上路由和按钮：   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng g component add</span><br></pre></td></tr></table></figure>
<p>添加路由：     </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app-routing.module.ts</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">import</span> &#123; AddComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;./add/add.component&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes: Routes = [</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">redirectTo</span>:<span class="string">&#x27;/index&#x27;</span>, <span class="attr">pathMatch</span>:<span class="string">&#x27;full&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;index&#x27;</span>, <span class="attr">component</span>: IndexComponent&#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;detail/:id&#x27;</span>, <span class="attr">component</span>: DetailComponent&#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;add&#x27;</span>, <span class="attr">component</span>: AddComponent&#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>添加路由入口：   </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- app.component.html --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 省略一些代码 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">routerLink</span>=<span class="string">&quot;/add&quot;</span>&gt;</span>添加书本<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>编辑添加书本的页面：    </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- add.component.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;add&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>添加书本：<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span>标题：</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> [(<span class="attr">ngModel</span>)]=<span class="string">&quot;books.title&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入标题&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span>作者：</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> [(<span class="attr">ngModel</span>)]=<span class="string">&quot;books.author&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入作者&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span>书本id：</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> [(<span class="attr">ngModel</span>)]=<span class="string">&quot;books.id&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入书本id&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span>封面地址：</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> [(<span class="attr">ngModel</span>)]=<span class="string">&quot;books.url&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入封面地址&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> (<span class="attr">click</span>)=<span class="string">&quot;add(books)&quot;</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>初始化添加书本的数据：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add.component.ts</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">import</span> &#123; Books &#125; <span class="keyword">from</span> <span class="string">&#x27;../books&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; BooksService &#125; <span class="keyword">from</span> <span class="string">&#x27;../books.service&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; HistoryService &#125; <span class="keyword">from</span> <span class="string">&#x27;../history.service&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Location &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">AddComponent</span> <span class="title">implements</span> <span class="title">OnInit</span> </span>&#123;</span><br><span class="line">    <span class="attr">books</span>: Books = &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">author</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">        private location: Location,</span></span></span><br><span class="line"><span class="params"><span class="function">        private booksservice: BooksService,</span></span></span><br><span class="line"><span class="params"><span class="function">        private historyservice: HistoryService</span></span></span><br><span class="line"><span class="params"><span class="function">    </span>)</span> &#123; &#125;</span><br><span class="line">    <span class="function"><span class="title">ngOnInit</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line">    add(books: Books): <span class="keyword">void</span>&#123;</span><br><span class="line">        books.title = books.title.trim();</span><br><span class="line">        books.author = books.author.trim();</span><br><span class="line">        <span class="built_in">this</span>.booksservice.addBooks(books)</span><br><span class="line">        .subscribe( <span class="function"><span class="params">book</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.historyservice.add(<span class="string">`新增书本<span class="subst">$&#123;books.title&#125;</span>，id为<span class="subst">$&#123;books.id&#125;</span>`</span>);</span><br><span class="line">            <span class="built_in">this</span>.location.back();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在<code>books.service.ts</code>中添加<code>addBooks</code>方法，来添加一本书本的数据：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// books.service.ts</span></span><br><span class="line">addBooks(books: Books): Observable&lt;Books&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.http.post&lt;Books&gt;(<span class="built_in">this</span>.booksUrl, books, httpOptions).pipe(</span><br><span class="line">        tap(<span class="function">(<span class="params">newBook: Books</span>) =&gt;</span> <span class="built_in">this</span>.log(<span class="string">`新增书本的id为<span class="subst">$&#123;newBook.id&#125;</span>`</span>)),</span><br><span class="line">        catchError(<span class="built_in">this</span>.handleError&lt;Books&gt;(<span class="string">&#x27;添加新书&#x27;</span>))</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>现在就可以正常添加书本啦。   </p>
<p><img src="http://images.pingan8787.com/angular_books_5_3.png" alt="图片5-3"></p>
<h3 id="5-通过HTTP删除数据"><a href="#5-通过HTTP删除数据" class="headerlink" title="5.通过HTTP删除数据"></a>5.通过HTTP删除数据</h3><p>这里我们先为每个书本后面添加一个删除按钮，并绑定删除事件<code>delete</code>：   </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- books.component.html --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 省略一些代码 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;delete&quot;</span> (<span class="attr">click</span>)=<span class="string">&quot;delete(list)&quot;</span>&gt;</span>X<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// books.component.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; BooksService &#125; <span class="keyword">from</span> <span class="string">&#x27;../books.service&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">BooksComponent</span> <span class="title">implements</span> <span class="title">OnInit</span> </span>&#123;</span><br><span class="line">  @Input() list: Books;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    private booksservice: BooksService</span></span></span><br><span class="line"><span class="params"><span class="function">  </span>)</span> &#123; &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">delete</span>(books: Books): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.booksservice.deleteBooks(books)</span><br><span class="line">      .subscribe();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后还要再<code>books.service.ts</code>中添加<code>deleteBooks</code>方法来删除：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// books.service.ts</span></span><br><span class="line">deleteBooks(books: Books): Observable&lt;Books&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> id = books.id;</span><br><span class="line">    <span class="keyword">const</span> url = <span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.booksUrl&#125;</span>/<span class="subst">$&#123;id&#125;</span>`</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.http.delete&lt;Books&gt;(url, httpOptions).pipe(</span><br><span class="line">        tap(<span class="function"><span class="params">_</span> =&gt;</span> <span class="built_in">this</span>.log(<span class="string">`删除书本<span class="subst">$&#123;books.title&#125;</span>，id为<span class="subst">$&#123;books.id&#125;</span>`</span>)),</span><br><span class="line">        catchError(<span class="built_in">this</span>.handleError&lt;Books&gt;(<span class="string">&#x27;删除书本&#x27;</span>))</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里需要在删除书本结束后，通知<code>IndexComponent</code>将数据列表中的这条数据删除，这里还需要再了解一下<a target="_blank" rel="noopener" href="https://blog.csdn.net/u010730126/article/details/68080139">Angular 父子组件数据通信</a>。<br>然后我们在父组件<code>IndexComponent</code>上添加<code>change</code>事件监听，并传入本地的<code>funChange</code>：   </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.component.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">app-books</span> *<span class="attr">ngFor</span>=<span class="string">&quot;let item of books&quot;</span> [<span class="attr">list</span>]=<span class="string">&quot;item&quot;</span></span></span><br><span class="line"><span class="tag">    (<span class="attr">change</span>) = <span class="string">&quot;funChange(item, $event)&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">app-books</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在对应的<code>index.component.ts</code>中添加<code>funChange</code>方法：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.component.ts</span></span><br><span class="line"><span class="function"><span class="title">funChange</span>(<span class="params">books, $event</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.books = <span class="built_in">this</span>.books.filter(<span class="function"><span class="params">h</span> =&gt;</span> h.id !== books.id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再来，我们在子组件<code>BooksComponent</code>上多导入<code>Output</code>和<code>EventEmitter</code>，并添加<code>@Output()</code>修饰器和调用<code>emit</code>：    </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component, OnInit, Input, Output, EventEmitter &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">BooksComponent</span> <span class="title">implements</span> <span class="title">OnInit</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ... </span></span><br><span class="line">    @Output()</span><br><span class="line">    change = <span class="keyword">new</span> EventEmitter()</span><br><span class="line">    <span class="comment">// ... </span></span><br><span class="line">    <span class="keyword">delete</span>(books: Books): <span class="keyword">void</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.booksservice.deleteBooks(books)</span><br><span class="line">        .subscribe(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.change.emit(books);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样就实现了我们父子组件之间的事件传递啦，现在我们的页面还是正常运行，并且删除一条数据后，页面数据会更新。   </p>
<h3 id="6-通过HTTP查找数据"><a href="#6-通过HTTP查找数据" class="headerlink" title="6.通过HTTP查找数据"></a>6.通过HTTP查找数据</h3><p>还是在<code>books.service.ts</code>，我们添加一个方法<code>getBooks</code>，来实现通过ID来查找指定书本，因为我们是通过ID查找，所以返回的是单个数据，这里就是<code>Observable&lt;Books&gt;</code>类型：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// books.service.ts</span></span><br><span class="line">getBooks(id: number): Observable&lt;Books&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> url = <span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.booksUrl&#125;</span>/<span class="subst">$&#123;id&#125;</span>`</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.http.get&lt;Books&gt;(url).pipe(</span><br><span class="line">        tap( <span class="function"><span class="params">_</span> =&gt;</span> <span class="built_in">this</span>.log(<span class="string">`请求书本的id为<span class="subst">$&#123;id&#125;</span>`</span>)),</span><br><span class="line">        catchError(<span class="built_in">this</span>.handleError&lt;Books&gt;(<span class="string">`getBooks请求是id为<span class="subst">$&#123;id&#125;</span>`</span>))</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意，这里 <code>getBooks</code> 会返回 <code>Observable&lt;Books&gt;</code>，是一个可观察的单个对象，而不是一个可观察的对象数组。    </p>
<h2 id="八、结语"><a href="#八、结语" class="headerlink" title="八、结语"></a>八、结语</h2><p>这个项目其实很简单，但是我还是一步一步的写下来，一方面让自己更熟悉Angular，另一方面也是希望能帮助到更多朋友哈~<br>最终效果：    </p>
<p><img src="http://images.pingan8787.com/angular_books_result.png" alt="图片结果"></p>
<p><strong>本部分内容到这结束</strong></p>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#112;&#105;&#x6e;&#103;&#x61;&#110;&#x38;&#x37;&#x38;&#55;&#64;&#113;&#113;&#x2e;&#x63;&#x6f;&#x6d;">&#112;&#105;&#x6e;&#103;&#x61;&#110;&#x38;&#x37;&#x38;&#55;&#64;&#113;&#113;&#x2e;&#x63;&#x6f;&#x6d;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>JS小册</td>
<td>js.pingan8787.com</td>
</tr>
<tr>
<td>微信公众号</td>
<td>前端自习课</td>
</tr>
</tbody></table>
<p><img src="http://images.pingan8787.com/2019_07_12guild_page.png" alt="bg">  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/02/23/145-%E3%80%90CuteJavaScript%E3%80%91Angular6%E5%85%A5%E9%97%A8%E9%A1%B9%E7%9B%AE%EF%BC%884-%E6%94%B9%E9%80%A0%E7%BB%84%E4%BB%B6%E5%92%8C%E6%B7%BB%E5%8A%A0HTTP%E6%9C%8D%E5%8A%A1%EF%BC%89/" data-id="ckts3ejy100lu4d9k6sw59q7p" data-title="145-【CuteJavaScript】Angular6入门项目（4.改造组件和添加HTTP服务）" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Angular/" rel="tag">Angular</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-144-【CuteJavaScript】Angular6入门项目（3-编写服务和引入RxJS）" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/02/23/144-%E3%80%90CuteJavaScript%E3%80%91Angular6%E5%85%A5%E9%97%A8%E9%A1%B9%E7%9B%AE%EF%BC%883-%E7%BC%96%E5%86%99%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BC%95%E5%85%A5RxJS%EF%BC%89/" class="article-date">
  <time class="dt-published" datetime="2019-02-23T03:18:17.000Z" itemprop="datePublished">2019-02-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/02/23/144-%E3%80%90CuteJavaScript%E3%80%91Angular6%E5%85%A5%E9%97%A8%E9%A1%B9%E7%9B%AE%EF%BC%883-%E7%BC%96%E5%86%99%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BC%95%E5%85%A5RxJS%EF%BC%89/">144-【CuteJavaScript】Angular6入门项目（3.编写服务和引入RxJS）</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><img src="http://images.pingan8787.com/angular%E7%B3%BB%E5%88%97%E5%B0%81%E9%9D%A2.png" alt="Angular封面"></p>
<hr>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#112;&#105;&#110;&#x67;&#x61;&#x6e;&#56;&#55;&#x38;&#x37;&#x40;&#113;&#x71;&#46;&#x63;&#x6f;&#109;">&#112;&#105;&#110;&#x67;&#x61;&#x6e;&#56;&#55;&#x38;&#x37;&#x40;&#113;&#x71;&#46;&#x63;&#x6f;&#109;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>微信公众号</td>
<td>前端自习课</td>
</tr>
</tbody></table>
<h2 id="本文目录"><a href="#本文目录" class="headerlink" title="本文目录"></a>本文目录</h2><ul>
<li>一、<a target="_blank" rel="noopener" href="https://juejin.im/post/5c70ae586fb9a049c64476a0">项目起步</a></li>
<li>二、<a target="_blank" rel="noopener" href="https://juejin.im/post/5c70ae586fb9a049c64476a0">编写路由组件</a></li>
<li>三、<a target="_blank" rel="noopener" href="https://juejin.im/post/5c70b48d6fb9a04a0b22cbce">编写页面组件</a>   <ul>
<li>1.<a target="_blank" rel="noopener" href="https://juejin.im/post/5c70b48d6fb9a04a0b22cbce">编写单一组件</a></li>
<li>2.<a target="_blank" rel="noopener" href="https://juejin.im/post/5c70b48d6fb9a04a0b22cbce">模拟数据</a></li>
<li>3.<a target="_blank" rel="noopener" href="https://juejin.im/post/5c70b48d6fb9a04a0b22cbce">编写主从组件</a></li>
</ul>
</li>
<li>四、<strong>编写服务</strong><ul>
<li>1.<strong>为什么需要服务</strong></li>
<li>2.<strong>编写服务</strong></li>
</ul>
</li>
<li>五、<strong>引入RxJS</strong><ul>
<li>1.<strong>关于RxJS</strong></li>
<li>2.<strong>引入RxJS</strong></li>
<li>3.<strong>改造数据获取方式</strong></li>
</ul>
</li>
<li>六、改造组件<ul>
<li>1.添加历史记录组件</li>
<li>2.添加和删除历史记录</li>
</ul>
</li>
<li>七、HTTP改造<ul>
<li>1.引入HTTP</li>
<li>2.通过HTTP请求数据</li>
<li>3.通过HTTP修改数据</li>
<li>4.通过HTTP增加数据</li>
<li>5.通过HTTP删除数据</li>
<li>6.通过HTTP查找数据</li>
</ul>
</li>
</ul>
<h2 id="四、编写服务"><a href="#四、编写服务" class="headerlink" title="四、编写服务"></a>四、编写服务</h2><p>截止到这部分，我们的<code>BooksComponent</code>组件获取和显示的都是本地模拟的数据。<br>接下来我们要开始对这些进行重构，让聚焦于为它的视图提供支持，这也让它更容易使用模拟服务进行单元测试。    </p>
<h3 id="1-为什么需要服务"><a href="#1-为什么需要服务" class="headerlink" title="1.为什么需要服务"></a>1.为什么需要服务</h3><p>我们不应该让组件来直接获取或保存数据，它们应该聚焦于展示数据，而数据访问的工作交给其他服务来做。<br>这里我们需要创建一个名为<code>BooksService</code>的服务，让我们应用中所有的类都使用它来获取书本列表的数据，使用的时候，只需要将它通过Angular的<strong>依赖注入机制</strong>注入到需要用的组件的构造函数中。    </p>
<p><strong>知识点：</strong><br>服务可以实现多个不同组件之间信息共享，后面我们还会将它注入到两个地方：<br><code>BooksService</code>中，使用该服务发送消息。<br><code>IndexService</code>中，使用该服务来展示消息。   </p>
<p>接下来我们使用命令行，创建<code>BooksService </code>：  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng g service books</span><br></pre></td></tr></table></figure>
<p>在生成的<code>books.service.ts</code>文件中：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// books.service.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Injectable &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line">@Injectable(&#123;</span><br><span class="line">  <span class="attr">providedIn</span>: <span class="string">&#x27;root&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>新导入了<code>@Injectable</code>装饰器，是为了让<code>BooksService</code>提供一个可注入的服务，并且它还可以拥有自己的待注入的依赖，简单理解就是<strong>如果你的服务需要依赖，那么你就需要导入它</strong>。<br>并且它接收该服务的元数据对象。    </p>
<h3 id="2-编写服务"><a href="#2-编写服务" class="headerlink" title="2.编写服务"></a>2.编写服务</h3><p>接下来我们开始编写<code>books.service.ts</code>服务。    </p>
<ul>
<li>导入服务所需组件</li>
</ul>
<p>这里我们导入<code>Books</code>和<code>BookList</code>，并添加一个<code>getBooks</code>方法来返回所有书本的数据，并且还需要添加一个<code>getBooks</code>方法来返回指定id的书本信息:   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.component.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Books &#125; <span class="keyword">from</span> <span class="string">&#x27;./books&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; BookList &#125; <span class="keyword">from</span> <span class="string">&#x27;./mock-books&#x27;</span>;</span><br><span class="line">@Injectable(&#123;</span><br><span class="line">  <span class="attr">providedIn</span>: <span class="string">&#x27;root&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">BooksService</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123; &#125;</span><br><span class="line">  getBookList(): Books[] &#123;</span><br><span class="line">    <span class="keyword">return</span> BookList;</span><br><span class="line">  &#125;</span><br><span class="line">  getBook(id: number): Books&#123;</span><br><span class="line">    <span class="keyword">return</span> BookList.find(<span class="function"><span class="params">book</span> =&gt;</span> book.id === id)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在我们使用这个服务之前，需要先注册该服务，因为我们在使用<code>ng g service books</code>命令创建服务时，CLI已经默认为我们添加了注册了，这是方法就是上面代码中的：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">providedIn: <span class="string">&#x27;root&#x27;</span></span><br></pre></td></tr></table></figure>
<p>表示将我们的服务注册在<strong>根注入器</strong>上，这样我们就可以把这个服务注入到任何享用的类上了。   </p>
<ul>
<li>修改<code>IndexComponent</code>   </li>
</ul>
<p>先删除<code>BookList</code>的引入，并修改<code>books</code>属性的定义：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.component.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; BooksService &#125; <span class="keyword">from</span> <span class="string">&#x27;../books.service&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">IndexComponent</span> <span class="title">implements</span> <span class="title">OnInit</span> </span>&#123;</span><br><span class="line">  <span class="attr">books</span> : Books[];</span><br><span class="line">  <span class="function"><span class="title">ngOnInit</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后注入我们的<code>BooksService</code>服务，需要先往构造函数中添加一个私有的<code>booksservice</code>，使用注入的<code>BooksService</code>作为类型，理解成一个注入点：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.component.ts</span></span><br><span class="line"><span class="function"><span class="title">constructor</span>(<span class="params">private booksservice: BooksService</span>)</span> &#123; &#125;</span><br></pre></td></tr></table></figure>

<p>之后我们需要添加一个<code>getBooks</code>方法来获取这些书本数据，并在生命周期函数<code>ngOnInit</code>中调用：    </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">IndexComponent</span> <span class="title">implements</span> <span class="title">OnInit</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">ngOnInit</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.getBooks();</span><br><span class="line">  &#125;</span><br><span class="line">  getBooks(): <span class="keyword">void</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.books = <span class="built_in">this</span>.booksservice.getBookList();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>修改<code>DetailComponent</code><br>我们先改造书本详情页的HTML结构：   <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- detail.component.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngIf</span>=<span class="string">&quot;books&quot;</span> <span class="attr">class</span>=<span class="string">&quot;detail&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>《&#123;&#123;books.title&#125;&#125;》介绍<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;books.url&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>书本标题: &#123;&#123;books.title&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>书本作者: &#123;&#123;books.author&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>书本id: &#123;&#123;books.id&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngIf</span>=<span class="string">&quot;!books&quot;</span> <span class="attr">class</span>=<span class="string">&quot;detail&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>暂无信息<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>*知识点**：<br>这里使用了<code>*ngIf</code>指令，当条件为<code>true</code>则显示其HTML内容。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// detail.component.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Books &#125; <span class="keyword">from</span> <span class="string">&#x27;../books&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; BooksService &#125; <span class="keyword">from</span> <span class="string">&#x27;../books.service&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">DetailComponent</span> <span class="title">implements</span> <span class="title">OnInit</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    private route: ActivatedRoute,</span></span></span><br><span class="line"><span class="params"><span class="function">    private location: Location,</span></span></span><br><span class="line"><span class="params"><span class="function">    private booksservice: BooksService  <span class="comment">// 引入BooksService服务</span></span></span></span><br><span class="line"><span class="params"><span class="function">  </span>)</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="attr">books</span>: Books;  <span class="comment">// 定义books类型</span></span><br><span class="line">  <span class="function"><span class="title">ngOnInit</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.getDetail()</span><br><span class="line">  &#125;</span><br><span class="line">  getDetail(): <span class="keyword">void</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> id = +<span class="built_in">this</span>.route.snapshot.paramMap.get(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">    <span class="built_in">this</span>.getBooks(id);</span><br><span class="line">  &#125;</span><br><span class="line">  getBooks(id: number): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.books = <span class="built_in">this</span>.booksservice.getBook(id);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这段代码，主要定义了<code>getBooks</code>方法，当刚进入页面时，将书本<code>id</code>传入<code>getBooks</code>方法，去<code>BooksService</code>去获取对应id的书本信息，并复制给变量<code>books</code>，然后展示到页面。   </p>
<p>改造之后，我们的页面显示依旧正常。   </p>
<p><img src="http://images.pingan8787.com/angular_books_3_2.png" alt="图片3-2"></p>
<p>但是我们要知道，这背后的逻辑已经改变了。   </p>
<h2 id="五、引入RxJS改造项目"><a href="#五、引入RxJS改造项目" class="headerlink" title="五、引入RxJS改造项目"></a>五、引入RxJS改造项目</h2><h3 id="1-关于RxJS"><a href="#1-关于RxJS" class="headerlink" title="1.关于RxJS"></a>1.关于RxJS</h3><p>这里简单介绍关键概念，具体可以查看 <a target="_blank" rel="noopener" href="https://rxjs.dev/">RxJS 官网</a>，也可以参考 <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/36d85f8cafdd">浅析Angular之RxJS</a>。    </p>
<h4 id="什么是RxJS"><a href="#什么是RxJS" class="headerlink" title="什么是RxJS"></a>什么是RxJS</h4><p>RxJS全称<code>Reactive Extensions for JavaScript</code>，中文意思: JavaScript的响应式扩展。<br>RxJS主要是提供一种更加强大和优雅的方式，来利用响应式编程的模式，实现JavaScript的异步编程。   </p>
<h4 id="RxJS优点"><a href="#RxJS优点" class="headerlink" title="RxJS优点"></a>RxJS优点</h4><ul>
<li>纯净性；   </li>
<li>流动性；    </li>
</ul>
<h4 id="RxJS核心概念"><a href="#RxJS核心概念" class="headerlink" title="RxJS核心概念"></a>RxJS核心概念</h4><p>RxJS 是基于观察者模式和迭代器模式以函数式编程思维来实现的。RxJS 中含有两个基本概念：<code>Observables</code> 与 <code>Observer</code>。<br><code>Observables</code> 作为被观察者，是一个值或事件的流集合；而 <code>Observer</code> 则作为观察者，根据 <code>Observables</code> 进行处理。它们之间的订阅发布关系(观察者模式) 如下：<br><strong>订阅</strong>：<code>Observer</code> 通过 <code>Observable</code> 提供的 <code>subscribe()</code> 方法订阅 <code>Observable</code>。<br><strong>发布</strong>：<code>Observable</code> 通过回调 <code>next</code> 方法向 <code>Observer</code> 发布事件。   </p>
<p>———— 来源<a target="_blank" rel="noopener" href="http://www.semlinker.com/rxjs-observable/">Angular修仙之路 RxJS Observable</a> </p>
<p>另外这里列出来一些核心，具体还是看官网咯，并且下面使用到的时候会具体介绍。   </p>
<ul>
<li><code>Observable</code> (可观察对象): 表示一个概念，这个概念是一个可调用的未来值或事件的集合。   </li>
<li><code>Observer</code>(观察者): 一个回调函数的集合，它知道如何去监听由 <code>Observable</code> 提供的值。    </li>
<li><code>Subscription</code> (订阅): 表示 <code>Observable</code> 的执行，主要用于取消 <code>Observable</code> 的执行。    </li>
<li><code>Operators</code> (操作符): 采用函数式编程风格的纯函数 (<code>pure function</code>)，使用像 <code>map</code>、<code>filter</code>、<code>concat</code>、<code>flatMap</code> 等这样的操作符来处理集合。   </li>
<li><code>Subject</code> (主体): 相当于 <code>EventEmitter</code>，并且是将值或事件多路推送给多个 <code>Observer</code> 的唯一方式。   </li>
<li><code>Schedulers</code> (调度器): 用来控制并发并且是中央集权的调度员，允许我们在发生计算时进行协调，例如 <code>setTimeout</code> 或<code>requestAnimationFrame</code>或其他。   </li>
</ul>
<h3 id="2-引入RxJS"><a href="#2-引入RxJS" class="headerlink" title="2.引入RxJS"></a>2.引入RxJS</h3><p>在我们的真实应用中，我们必须要等到服务器响应后，我们才能获取到数据，因此这天生就需要用异步思维来操作。   </p>
<p>由于Angular中已经自带RxJS，所以我们只要在需要使用的时候，引入即可使用：   </p>
<h3 id="3-改造数据获取方式"><a href="#3-改造数据获取方式" class="headerlink" title="3.改造数据获取方式"></a>3.改造数据获取方式</h3><p>了解完RxJS的一些概念后，我们开始改造下这些书本的数据获取方式。   </p>
<ul>
<li>改造<code>BooksService</code>   </li>
</ul>
<p>首先我们从 RxJS 中导入 <code>Observable</code> 和 <code>of</code> 符号：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// books.service.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Observable, <span class="keyword">of</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><strong>知识点</strong>：<br><code>Observable</code>:  观察者模式中的观察者，具体可以参考 <a target="_blank" rel="noopener" href="http://www.semlinker.com/rxjs-observable/">Angular修仙之路 RxJS Observable</a><br><code>of</code>:  用来获取观察者拿到的数据，通常是一个<code>Observable</code>。   </p>
<p>然后修改<code>getBookList</code>方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// books.service.ts</span></span><br><span class="line">getBookList(): Observable&lt;Books[]&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">of</span>(BookList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里 <code>of(BookList)</code> 返回一个<code> Observable&lt;Books[]&gt;</code>，它会发出单个值，这个值就是这些模拟书本的数组。   </p>
<ul>
<li>改造<code>IndexComponent</code>   </li>
</ul>
<p>这里也要修改<code>getBooks</code>方法，使用<code>subscribe</code>去订阅服务返回回来的值：    </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.component.ts</span></span><br><span class="line">getBooks(): <span class="keyword">void</span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.booksservice.getBookList()</span><br><span class="line">    .subscribe(<span class="function"><span class="params">books</span> =&gt;</span> <span class="built_in">this</span>.books = books);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于原本直接赋值数据，在实际场景中是不可能这样同步的，所以这里<code>subscribe</code>函数，会在<code>Observable</code>发出数据以后，再把书本列表传到里面的回调函数，再复制给<code>books</code>属性。<br>使用这种异步方式，当 <code>BooksService</code> 从远端服务器获取英雄数据时，不用担心还没拿到数据就执行后面。   </p>
<p>下一步，我们就要改造一下项目了。   </p>
<p><strong>本部分内容到这结束</strong></p>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#x70;&#105;&#x6e;&#103;&#x61;&#x6e;&#x38;&#55;&#56;&#x37;&#64;&#x71;&#113;&#x2e;&#99;&#111;&#x6d;">&#x70;&#105;&#x6e;&#103;&#x61;&#x6e;&#x38;&#55;&#56;&#x37;&#64;&#x71;&#113;&#x2e;&#99;&#111;&#x6d;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>JS小册</td>
<td>js.pingan8787.com</td>
</tr>
<tr>
<td>微信公众号</td>
<td>前端自习课</td>
</tr>
</tbody></table>
<p><img src="http://images.pingan8787.com/2019_07_12guild_page.png" alt="bg">  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/02/23/144-%E3%80%90CuteJavaScript%E3%80%91Angular6%E5%85%A5%E9%97%A8%E9%A1%B9%E7%9B%AE%EF%BC%883-%E7%BC%96%E5%86%99%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BC%95%E5%85%A5RxJS%EF%BC%89/" data-id="ckts3ejt4002r4d9k6jj29uz4" data-title="144-【CuteJavaScript】Angular6入门项目（3.编写服务和引入RxJS）" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Angular/" rel="tag">Angular</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-143-【CuteJavaScript】Angular6入门项目（2-构建项目页面和组件）" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/02/23/143-%E3%80%90CuteJavaScript%E3%80%91Angular6%E5%85%A5%E9%97%A8%E9%A1%B9%E7%9B%AE%EF%BC%882-%E6%9E%84%E5%BB%BA%E9%A1%B9%E7%9B%AE%E9%A1%B5%E9%9D%A2%E5%92%8C%E7%BB%84%E4%BB%B6%EF%BC%89/" class="article-date">
  <time class="dt-published" datetime="2019-02-23T03:18:01.000Z" itemprop="datePublished">2019-02-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/02/23/143-%E3%80%90CuteJavaScript%E3%80%91Angular6%E5%85%A5%E9%97%A8%E9%A1%B9%E7%9B%AE%EF%BC%882-%E6%9E%84%E5%BB%BA%E9%A1%B9%E7%9B%AE%E9%A1%B5%E9%9D%A2%E5%92%8C%E7%BB%84%E4%BB%B6%EF%BC%89/">143-【CuteJavaScript】Angular6入门项目（2.构建项目页面和组件）</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><img src="http://images.pingan8787.com/angular%E7%B3%BB%E5%88%97%E5%B0%81%E9%9D%A2.png" alt="Angular封面"></p>
<hr>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#112;&#x69;&#110;&#x67;&#x61;&#110;&#56;&#x37;&#x38;&#55;&#x40;&#x71;&#113;&#x2e;&#99;&#x6f;&#x6d;">&#112;&#x69;&#110;&#x67;&#x61;&#110;&#56;&#x37;&#x38;&#55;&#x40;&#x71;&#113;&#x2e;&#99;&#x6f;&#x6d;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>微信公众号</td>
<td>前端自习课</td>
</tr>
</tbody></table>
<h2 id="本文目录"><a href="#本文目录" class="headerlink" title="本文目录"></a>本文目录</h2><ul>
<li>一、<a target="_blank" rel="noopener" href="https://juejin.im/post/5c70ae586fb9a049c64476a0">项目起步</a></li>
<li>二、<a target="_blank" rel="noopener" href="https://juejin.im/post/5c70ae586fb9a049c64476a0">编写路由组件</a></li>
<li>三、<strong>编写页面组件</strong>   <ul>
<li>1.<strong>编写单一组件</strong></li>
<li>2.<strong>模拟数据</strong></li>
<li>3.<strong>编写主从组件</strong></li>
</ul>
</li>
<li>四、编写服务<ul>
<li>1.为什么需要服务</li>
<li>2.编写服务</li>
</ul>
</li>
<li>五、引入RxJS<ul>
<li>1.关于RxJS</li>
<li>2.引入RxJS</li>
<li>3.改造数据获取方式</li>
</ul>
</li>
<li>六、改造组件<ul>
<li>1.添加历史记录组件</li>
<li>2.添加和删除历史记录</li>
</ul>
</li>
<li>七、HTTP改造<ul>
<li>1.引入HTTP</li>
<li>2.通过HTTP请求数据</li>
<li>3.通过HTTP修改数据</li>
<li>4.通过HTTP增加数据</li>
<li>5.通过HTTP删除数据</li>
<li>6.通过HTTP查找数据</li>
</ul>
</li>
</ul>
<h2 id="三、编写页面组件"><a href="#三、编写页面组件" class="headerlink" title="三、编写页面组件"></a>三、编写页面组件</h2><p>接下来开始编写页面组件，这里我们挑重点来写，一些布局的样式，后面可以看源码。   </p>
<h3 id="1-编写单一组件"><a href="#1-编写单一组件" class="headerlink" title="1.编写单一组件"></a>1.编写单一组件</h3><p>我们首先写一个书本信息的组件，代码如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.component.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;books_box&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 单个课本 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;books_item&quot;</span> *<span class="attr">ngFor</span>=<span class="string">&quot;let item of [1,2,3,4,5,6,7,8,9,10]&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;cover&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://img3.doubanio.com/view/subject/m/public/s29988481.jpg&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span>&gt;</span>像火焰像灰烬<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;author&quot;</span>&gt;</span>程姬<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>知识点</strong>：<br><code>*ngFor</code> 是一个 Angular 的复写器（repeater）指令，就像<strong>angular1</strong>中的<code>ng-for</code>和<strong>vuejs</strong>中的<code>v-for</code>。 它会为列表中的每项数据复写它的宿主元素。<br>这时候可以看到页面变成下面这个样子：<br><img src="http://images.pingan8787.com/angular_books_3_1.png" alt="图片3-1">     </p>
<p>接下来我们要把写死在HTML上面的数据，抽到JS中：    </p>
<p>现在先新建一个<code>books.ts</code>文件来定义一个<code>Book</code>类，并添加<code>id</code>，<code>url</code>，<code>title</code>和<code>author</code>四个属性：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/app/books.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">    <span class="attr">id</span>: number;</span><br><span class="line">    url: string;</span><br><span class="line">    title: string;</span><br><span class="line">    author: string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后回到<code>index.component.ts</code>文件去引入它，并定义一个<code>books</code>属性，使用导入进来的<code>Book</code>类作为类型：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.component.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Book &#125; <span class="keyword">from</span> <span class="string">&#x27;../books&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">IndexComponent</span> <span class="title">implements</span> <span class="title">OnInit</span> </span>&#123;</span><br><span class="line">  <span class="attr">books</span>: Book = &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;https://img3.doubanio.com/view/subject/m/public/s29988481.jpg&#x27;</span>,</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;像火焰像灰烬&#x27;</span>,</span><br><span class="line">    <span class="attr">author</span>: <span class="string">&#x27;程姬&#x27;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后再改造前面的组件文件<code>index.component.html</code>:   </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.component.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;books_item&quot;</span> *<span class="attr">ngFor</span>=<span class="string">&quot;let item of [1,2,3,4,5,6,7,8,9,10]&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;cover&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;books.url&#125;&#125;&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&#123;&#123;books.id&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span>&gt;</span>&#123;&#123;books.title&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;author&quot;</span>&gt;</span>&#123;&#123;books.author&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>接着，我们再为每个课本添加一个点击事件，来实现点击封面图能查看大图的效果，现在<code>index.component.ts</code>中定义一个<code>getDetailImage</code>方法，并在<code>index.component.html</code>中绑定该方法：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.component.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">IndexComponent</span> <span class="title">implements</span> <span class="title">OnInit</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">getDetailImage</span>(<span class="params">books</span>)</span>&#123;</span><br><span class="line">    alert(<span class="string">`正在查看id为<span class="subst">$&#123;books.id&#125;</span>的大图！`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这边方法的具体实现，不写，不是本文重点。下面是增加点击事件的绑定：     </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.component.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;cover&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;books.url&#125;&#125;&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&#123;&#123;books.id&#125;&#125;&quot;</span> (<span class="attr">click</span>)=<span class="string">&quot;getDetailImage(books)&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>知识点</strong>：<br><code>(click)</code>是Angular用来绑定事件，它会让 Angular 监听这个<code> &lt;img&gt;</code> 元素的 <code>click</code> 事件。 当用户点击 <code>&lt;img&gt;</code> 时，Angular 就会执行表达式 <code>getDetailImage(books)</code>。    </p>
<p>再来，我们引入前面学到的<strong>路由链接</strong>指令来改造HTML：   </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.component.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">routerLink</span>=<span class="string">&quot;/detail/&#123;&#123;books.id&#125;&#125;&quot;</span>&gt;</span>&#123;&#123;books.title&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这时候，我们在点击书本的标题，发现页面跳转到URL地址为<code>http://localhost:4200/detail/1</code>的页面，这就说明，我们页面的路由跳转也成功了~    </p>
<p>改造完成后，可以看到，页面显示的还是一样，接下来我们先这样放着，因为我们后面会进行数据模拟，和模拟服务器请求。    </p>
<p>我们就这样写好第一个单一组件，并且数据是从JS中读取的。   </p>
<h3 id="2-模拟数据"><a href="#2-模拟数据" class="headerlink" title="2.模拟数据"></a>2.模拟数据</h3><p>这时候为了方便后面数据渲染，我们这里需要模拟一些本地数据，我们创建一个本地<code> mock-books.ts</code>文件来存放模拟的数据：    </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/mock-books.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Books &#125; <span class="keyword">from</span> <span class="string">&#x27;./books&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> BookList: Books[] = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">1</span>, </span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;https://img3.doubanio.com/view/subject/m/public/s29988481.jpg&#x27;</span>,</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;像火焰像灰烬&#x27;</span>,</span><br><span class="line">        <span class="attr">author</span>: <span class="string">&#x27;程姬&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 省略其他9条</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>然后在<code>index.component.ts</code>中导入模拟的数据，并将原有的<code>books</code>值修改成导入的模拟数据<code>BookList</code>：    </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.component.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; BookList &#125; <span class="keyword">from</span> <span class="string">&#x27;../mock-books&#x27;</span>;</span><br><span class="line">books = BookList;</span><br></pre></td></tr></table></figure>
<p>并将原本的<code>*ngFor</code>中修改成这样，绑定真正的数据：   </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.component.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;books_item&quot;</span> *<span class="attr">ngFor</span>=<span class="string">&quot;let item of books&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;cover&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;item.url&#125;&#125;&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&#123;&#123;item.id&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span>&gt;</span>&#123;&#123;item.title&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;author&quot;</span>&gt;</span>&#123;&#123;item.author&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-编写主从组件"><a href="#3-编写主从组件" class="headerlink" title="3.编写主从组件"></a>3.编写主从组件</h3><p>当我们写完一个单一组件后，我们会发现，如果我们把每个组件都写到同一个HTML文件中，这是很糟糕的事情，这样做有缺点：   </p>
<ul>
<li>代码复用性差；（导致每次相同功能要重新写）   </li>
<li>代码难维护；（因为一个文件会非常长）</li>
<li>影响性能；（打开每个页面都要重复加载很多）</li>
</ul>
<p>为了解决这个问题，我们这里就要开始使用真正的<strong>组件化思维</strong>，将通用常用组件抽离出来，通过参数传递来控制组件的不同业务形态。<br>这便是我们接下来要写的主从组件。    </p>
<p>思考一下，我们这里现在能抽成组件作为公共代码的，就是这个单个书本的内容，因为每个书本的内容都一致，只是里面数据的差异，于是我们再新建一个组件：   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng g component books</span><br></pre></td></tr></table></figure>
<p>并将前面<code>index.component.html</code>中关于课本的代码剪切到<code>books.component.html</code>中来，然后删除掉<code>*ngFor</code>的内容，并将原本本地的变量<code>books</code>替换成<code>list</code>，这个变量我们等会会取到：   </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- books.component.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;books_item&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;cover&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;list.url&#125;&#125;&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&#123;&#123;list.id&#125;&#125;&quot;</span> (<span class="attr">click</span>)=<span class="string">&quot;getDetailImage(list)&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">routerLink</span>=<span class="string">&quot;/detail/&#123;&#123;list.id&#125;&#125;&quot;</span>&gt;</span>&#123;&#123;list.title&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;author&quot;</span>&gt;</span>&#123;&#123;list.author&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>再将这个组件，引用到它的父组件中，这里是要引用到<code>index.component.html</code>的组件中，并将前面的<code>*ngFor</code>再次传入<code>&lt;app-books&gt;</code>：   </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;books_box&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">app-books</span> *<span class="attr">ngFor</span>=<span class="string">&quot;let item of books&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">app-books</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>接下来要做的就是获取到<code>list</code>变量的值，显然这个值是要从外面组件传进来的，我们需要在<code>books.component.ts</code>引入前面定义的 <code>Books</code>类 和 <code>@Input() 装饰器</code>，还要添加一个带有 <code>@Input() 装饰器</code>的 <code>list</code> 属性，另外还要记得将<code>getDetailImage</code>方法也剪切过来：    </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// books.component.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Component, OnInit, Input &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Books &#125; <span class="keyword">from</span> <span class="string">&#x27;../books&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">BooksComponent</span> <span class="title">implements</span> <span class="title">OnInit</span> </span>&#123;</span><br><span class="line">  @Input() list: Books;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123; &#125;</span><br><span class="line">  <span class="function"><span class="title">ngOnInit</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line">  <span class="function"><span class="title">getDetailImage</span>(<span class="params">books</span>)</span>&#123;</span><br><span class="line">    alert(<span class="string">`正在查看id为<span class="subst">$&#123;books.id&#125;</span>的大图！`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>@Input() 装饰器</code>介绍具体可以查看 <a target="_blank" rel="noopener" href="https://angular.cn/guide/template-syntax#inputs-outputs">手册</a>   </p>
<p>我们要获取的 <code>list</code> 属性必须是一个带有<code>@Input()</code>装饰器的输入属性，因为外部的 <code>IndexComponent</code> 组件将会绑定到它。就像这样：   </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">app-books</span> *<span class="attr">ngFor</span>=<span class="string">&quot;let list of books&quot;</span> [<span class="attr">list</span>]=<span class="string">&quot;item&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">app-books</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>知识点</strong>：<br><code>[list]=&quot;item&quot;</code> 是 <code>Angular</code> 的<strong>属性绑定</strong>语法。这是一种<strong>单向数据绑定</strong>。从 <code>IndexComponent</code> 的 <code>item</code> 属性绑定到目标元素的 <code>list</code> 属性，并映射到了 <code>BooksComponent</code> 的 <code>list</code> 属性。</p>
<p>做到这里，我们已经将<code>BooksComponent</code>作为<code>IndexComponent</code>的子组件来引用了，在实际开发过程中，这样的父子组件关系，会用的非常多。    </p>
<p>写到这里，看看我们项目，还是一样正常在运行，只是现在项目中组件分工更加明确了。   </p>
<p>现在的效果图：<br><img src="http://images.pingan8787.com/angular_books_3_2.png" alt="图片3-2"></p>
<p><strong>本部分内容到这结束</strong></p>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#x70;&#105;&#x6e;&#103;&#x61;&#110;&#56;&#x37;&#56;&#55;&#64;&#113;&#113;&#46;&#x63;&#x6f;&#109;">&#x70;&#105;&#x6e;&#103;&#x61;&#110;&#56;&#x37;&#56;&#55;&#64;&#113;&#113;&#46;&#x63;&#x6f;&#109;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>JS小册</td>
<td>js.pingan8787.com</td>
</tr>
<tr>
<td>微信公众号</td>
<td>前端自习课</td>
</tr>
</tbody></table>
<p><img src="http://images.pingan8787.com/2019_07_12guild_page.png" alt="bg">  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/02/23/143-%E3%80%90CuteJavaScript%E3%80%91Angular6%E5%85%A5%E9%97%A8%E9%A1%B9%E7%9B%AE%EF%BC%882-%E6%9E%84%E5%BB%BA%E9%A1%B9%E7%9B%AE%E9%A1%B5%E9%9D%A2%E5%92%8C%E7%BB%84%E4%BB%B6%EF%BC%89/" data-id="ckts3ejt3002p4d9k60rwhfj8" data-title="143-【CuteJavaScript】Angular6入门项目（2.构建项目页面和组件）" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Angular/" rel="tag">Angular</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-142-【CuteJavaScript】Angular6入门项目（1-构建项目和创建路由）" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/02/23/142-%E3%80%90CuteJavaScript%E3%80%91Angular6%E5%85%A5%E9%97%A8%E9%A1%B9%E7%9B%AE%EF%BC%881-%E6%9E%84%E5%BB%BA%E9%A1%B9%E7%9B%AE%E5%92%8C%E5%88%9B%E5%BB%BA%E8%B7%AF%E7%94%B1%EF%BC%89/" class="article-date">
  <time class="dt-published" datetime="2019-02-23T03:14:53.000Z" itemprop="datePublished">2019-02-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/02/23/142-%E3%80%90CuteJavaScript%E3%80%91Angular6%E5%85%A5%E9%97%A8%E9%A1%B9%E7%9B%AE%EF%BC%881-%E6%9E%84%E5%BB%BA%E9%A1%B9%E7%9B%AE%E5%92%8C%E5%88%9B%E5%BB%BA%E8%B7%AF%E7%94%B1%EF%BC%89/">142-【CuteJavaScript】Angular6入门项目（1.构建项目和创建路由）</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><img src="http://images.pingan8787.com/angular%E7%B3%BB%E5%88%97%E5%B0%81%E9%9D%A2.png" alt="Angular封面"></p>
<hr>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#112;&#105;&#110;&#x67;&#x61;&#x6e;&#56;&#x37;&#x38;&#55;&#64;&#x71;&#113;&#46;&#x63;&#111;&#109;">&#112;&#105;&#110;&#x67;&#x61;&#x6e;&#56;&#x37;&#x38;&#55;&#64;&#x71;&#113;&#46;&#x63;&#111;&#109;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>微信公众号</td>
<td>前端自习课</td>
</tr>
</tbody></table>
<h2 id="本文目录"><a href="#本文目录" class="headerlink" title="本文目录"></a>本文目录</h2><ul>
<li><strong>一、项目起步</strong></li>
<li><strong>二、编写路由组件</strong></li>
<li>三、编写页面组件   <ul>
<li>1.编写单一组件</li>
<li>2.模拟数据</li>
<li>3.编写主从组件</li>
</ul>
</li>
<li>四、编写服务<ul>
<li>1.为什么需要服务</li>
<li>2.编写服务</li>
</ul>
</li>
<li>五、引入RxJS<ul>
<li>1.关于RxJS</li>
<li>2.引入RxJS</li>
<li>3.改造数据获取方式</li>
</ul>
</li>
<li>六、改造组件<ul>
<li>1.添加历史记录组件</li>
<li>2.添加和删除历史记录</li>
</ul>
</li>
<li>七、HTTP改造<ul>
<li>1.引入HTTP</li>
<li>2.通过HTTP请求数据</li>
<li>3.通过HTTP修改数据</li>
<li>4.通过HTTP增加数据</li>
<li>5.通过HTTP删除数据</li>
<li>6.通过HTTP查找数据</li>
</ul>
</li>
<li>八、结语</li>
</ul>
<p>这个入门项目是我学习完<a target="_blank" rel="noopener" href="https://angular.cn/tutorial">Angular 英雄指南教程</a>后，自己手写的一个练习项目，一步一步来，最终的<a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo-JavaScript/tree/master/Cute-Angular/books%E9%A1%B9%E7%9B%AEdemo">项目源码可以这里查看</a>，大佬们请指点啦。    </p>
<p>推荐两个Angular学习网站：   </p>
<ol>
<li><a target="_blank" rel="noopener" href="https://angular.cn/">Angular 中文网</a>   </li>
<li><a target="_blank" rel="noopener" href="http://www.semlinker.com/">Angular 修仙之路</a>   </li>
</ol>
<p>还有呢，我没怎么关注到样式，所以样式会有点丑，主要都放在核心逻辑中了。<br><strong>最终实现：</strong>    </p>
<ul>
<li>首页书本列表数据展示</li>
<li>各个页面静态/动态路由跳转</li>
<li>本地模拟数据服务</li>
<li>书本数据的增删改查</li>
<li>父子组件通信</li>
<li>常用指令使用和介绍</li>
</ul>
<p><img src="https://camo.githubusercontent.com/ded9be340188be8d3cb8ee2fd6adfe614f07e043/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031392f322f32332f313639313832386637643766663866373f773d38393526683d38343726663d706e6726733d313031303632" alt="图片结果"></p>
<p>后面我将把这个系列的文章，收录到我的<a target="_blank" rel="noopener" href="http://js.pingan8787.com/">【CuteJavaScript】</a>中，里面有整理了<strong>ES6/7/8/9知识点</strong>和<strong>重温JS基础系列</strong>文章。   </p>
<p>那么，快跟我一步步来完成这个入门项目吧。</p>
<h2 id="零、Angular安装"><a href="#零、Angular安装" class="headerlink" title="零、Angular安装"></a>零、Angular安装</h2><p>Angular 需要 <code>Node.js</code> 的 <code>8.x</code> 或 <code>10.x</code> 版本。<br>检查你的<code>Node.js</code>版本，请在终端/控制台窗口中运行 <code>node -v</code> 命令。<br>要想安装<code> Node.js</code>，请访问 nodejs.org。   </p>
<ol>
<li>安装Angular CLI   </li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g @angular/cli</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>常用命令</li>
</ol>
<p>后续用到会详细介绍这些命令。</p>
<ul>
<li><p>启动服务，并打开新窗口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ng serve --open</span><br><span class="line"><span class="comment"># --open 可简写 -o</span></span><br></pre></td></tr></table></figure></li>
<li><p>创建新组件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ng generate component books</span><br><span class="line"><span class="comment"># generate 可简写 g</span></span><br></pre></td></tr></table></figure></li>
<li><p>创建新服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng generate service books</span><br></pre></td></tr></table></figure></li>
<li><p>创建路由模块</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng generate module app-routing --flat --module=app</span><br></pre></td></tr></table></figure></li>
<li><p>其他<br>另外Angular CLI还有很多的命令提供，详细可以查阅官方文档 <a target="_blank" rel="noopener" href="https://angular.cn/cli">Angular CLI 命令</a>。</p>
</li>
</ul>
<p>最后搭建完是这样：    </p>
<p><img src="https://camo.githubusercontent.com/9c67d00f8b707eae15fd6c5d1a907942641909ad/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031392f322f32332f313639313832386637633431386237393f773d35373926683d36333126663d706e6726733d3239313137" alt="图片创建"></p>
<h2 id="一、项目起步"><a href="#一、项目起步" class="headerlink" title="一、项目起步"></a>一、项目起步</h2><ol>
<li><p>创建项目    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ng new books</span><br><span class="line"><span class="built_in">cd</span> books</span><br></pre></td></tr></table></figure></li>
<li><p>创建所需的两个页面组件  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ng g component index</span><br><span class="line">ng g component detail</span><br></pre></td></tr></table></figure>
<p><code>g</code>是<code>generate</code>的简写。   </p>
</li>
</ol>
<h2 id="二、编写路由组件"><a href="#二、编写路由组件" class="headerlink" title="二、编写路由组件"></a>二、编写路由组件</h2><p>这里为了项目结构先起来，所以先简单配置一下路由，后面路由会调整，如果遇到什么不懂，可以查看<a target="_blank" rel="noopener" href="https://angular.cn/guide/router">Angular 路由与导航</a>。  </p>
<ol>
<li>安装<strong>路由模块</strong>    <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng g module app-routing --flat --module=app</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>知识点：</strong><br><code>--flat</code> 把这个文件放进了 <code>src/app</code> 中，而不是单独的目录中。<br><code>--module=app</code> 告诉 CLI 把它注册到 <code>AppModule</code> 的 <code>imports</code> 数组中。   </p>
<ol start="2">
<li>引入<strong>路由模块</strong>    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app-routing.module.ts  </span></span><br><span class="line"><span class="keyword">import</span> &#123; RouterModule, Routes &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/router&#x27;</span>;</span><br></pre></td></tr></table></figure></li>
<li>导出<strong>路由模块</strong>的指令  </li>
</ol>
<p>这里需要添加一个 <code>@NgModule.exports</code> 数组，并传入<code>RouterModule</code>，导出 <code>RouterModule</code> 让路由器的相关指令可以在 <code>AppModule</code> 中的组件中使用。   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app-routing.module.ts  </span></span><br><span class="line">@NgModule(&#123;</span><br><span class="line">  <span class="attr">imports</span>: [CommonModule],</span><br><span class="line">  <span class="attr">declarations</span>: [],</span><br><span class="line">  <span class="attr">exports</span>: [RouterModule]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>添加定义路由    </li>
</ol>
<p>这里添加路由的时候，记得将所需要指向的组件也引入进来，这里我们需要引入两个页面的组件：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app-routing.module.ts  </span></span><br><span class="line"><span class="keyword">import</span> &#123; IndexComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;./index/index.component&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; DetailComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;./detail/detail.component&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>然后将我们所需要的路由定义在<code>routes</code>变量中，类型是我们引入的<code>Routes</code>：    </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app-routing.module.ts  </span></span><br><span class="line"><span class="keyword">const</span> routes: Routes = [</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">redirectTo</span>:<span class="string">&#x27;/index&#x27;</span>, <span class="attr">pathMatch</span>:<span class="string">&#x27;full&#x27;</span> &#125;,    <span class="comment">// 1</span></span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;index&#x27;</span>, <span class="attr">component</span>: IndexComponent&#125;,            <span class="comment">// 2</span></span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;detail/:id&#x27;</span>, <span class="attr">component</span>: DetailComponent&#125;,      <span class="comment">// 3 </span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p><strong>知识点</strong>：<br><code>angular</code>的路由接收两个参数：   </p>
<ul>
<li><code>path</code>：用于匹配浏览器地址栏中 <code>URL</code> 的字符串。   </li>
<li><code>component</code>：当导航到此路由时，路由器展示的组件名称。   </li>
</ul>
<p><strong>第1行代码</strong>：<br>作为路由系统的默认路由，当所有路由都不匹配的话，就会重定向到这个路由，并展示对应的组件。<br><strong>第2行代码</strong>：<br>正常情况下的路由配置。<br><strong>第3行代码</strong>：<br>配置的是携带参数的路由，在路由<code>/</code>后，用 <code>:</code> 拼接参数名来实现，<strong>获取这个参数的值的方法后面会介绍</strong>。</p>
<p>另外，我们还可以这么传递参数，直接将数据通过路由传入，后面还会介绍：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="attr">path</span>: <span class="string">&#x27;pathname&#x27;</span>, <span class="attr">component</span>: DemoComponent, <span class="attr">data</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;pingan8787&#x27;</span> &#125; &#125;,</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>添加路由监视   </li>
</ol>
<p>配置好路由还不能使用，需要一个监视路由变化的工具，这时候需要把<code>RouterModule</code>添加到 <code>@NgModule.imports</code> 数组中，并用 <code>routes</code> 来配置它。<br>这里只需要调用<code>imports</code>数组中的 <code>RouterModule.forRoot()</code> 函数就行了，就像这样：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app-routing.module.ts  </span></span><br><span class="line"><span class="attr">imports</span>: [ RouterModule.forRoot(routes) ],</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>添加路由出口   </li>
</ol>
<p>所谓的路由出口，就是路由所对应的组件展示的地方，接下来我们在<code>app.component.html</code>内容中，添加<code>&lt;router-outlet&gt;&lt;/router-outlet&gt;</code>：   </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- app.component.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span> 欢迎来到我的个人书屋! <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">router-outlet</span>&gt;</span><span class="tag">&lt;/<span class="name">router-outlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里的<code>&lt;router-outlet&gt;&lt;/router-outlet&gt;</code>就是我们路由输出的地方，也是组件展示的地方，简单理解就是，它会告诉路由器要在哪里显示路由的视图。   </p>
<ol start="7">
<li>添加路由链接   </li>
</ol>
<p>所谓的路由链接，就是出发路由跳转事件的地方，比如一个按钮，一张图片等，我们还是在<code>app.component.html</code>中，使用<code>&lt;a routerLink=&quot;/path&quot;&gt;&lt;/a&gt;</code>添加3个按钮：   </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- app.component.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span> 欢迎来到我的个人书屋! <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">routerLink</span>=<span class="string">&quot;&quot;</span>&gt;</span>重定向<span class="tag">&lt;/<span class="name">a</span>&gt;</span> | </span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">routerLink</span>=<span class="string">&quot;/index&quot;</span>&gt;</span>打开首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span> | </span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">routerLink</span>=<span class="string">&quot;/detail/1&quot;</span>&gt;</span>打开书本详情<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">router-outlet</span>&gt;</span><span class="tag">&lt;/<span class="name">router-outlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这边3个按钮的路由，我们将上面定义的3种路由，传入到<code>routerLink</code>参数中，现在就项目就可以实现页面跳转了。    </p>
<p>另外，这里还可以传入一个可选参数<code>routerLinkActive=&quot;className&quot;</code>，表示当这个<code>&lt;a&gt;</code>标签激活的时候显示的样式，值是一个字符串，为样式的类名：   </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">routerLink</span>=<span class="string">&quot;/index&quot;</span> <span class="attr">routerLinkActive</span>=<span class="string">&quot;activeClass&quot;</span>&gt;</span>打开首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span> | </span><br></pre></td></tr></table></figure>

<ol start="8">
<li>获取带参数路由的参数    </li>
</ol>
<p>在第7步中，我们点击 <strong>打开书本详情</strong> 按钮中，在路由中带了参数，这时候我们需要这么来获取这个参数：    </p>
<ul>
<li><p>先导出模块<code>ActivatedRoute</code>和<code>Location</code>：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// detail.component.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; ActivatedRoute &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Location &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common&#x27;</span>;</span><br></pre></td></tr></table></figure></li>
<li><p>再注入到构造函数中，并将值作为私有变量：    </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// detail.component.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">DetailComponent</span> <span class="title">implements</span> <span class="title">OnInit</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    private route: ActivatedRoute,</span></span></span><br><span class="line"><span class="params"><span class="function">    private location: Location</span></span></span><br><span class="line"><span class="params"><span class="function">  </span>)</span> &#123; &#125;</span><br><span class="line">  <span class="function"><span class="title">ngOnInit</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p><em>知识点：</em>*<br><code>ActivatedRoute</code> 保存该 <code>DetailComponent</code> 实例的路由信息。可以从这个组件获取URL中的路由参数和其他数据。<br><code>Location</code> 是一个 <code>Angular</code> 的服务，用来与浏览器打交道。后续会使用它来导航回上一个视图。    </p>
</li>
<li><p>提取路由参数：  </p>
</li>
</ul>
<p>这里声明<code>getDetail</code>方法，提取路由参数，并<code>ngOnInit</code><strong>生命周期钩子方法</strong>在中执行。    </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// detail.component.ts</span></span><br><span class="line"><span class="function"><span class="title">ngOnInit</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.getDetail()</span><br><span class="line">&#125;</span><br><span class="line">getDetail(): <span class="keyword">void</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> id = +<span class="built_in">this</span>.route.snapshot.paramMap.get(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`此课本的id是<span class="subst">$&#123;id&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>知识点</strong>：<br><code>route.snapshot</code> 是一个路由信息的<strong>静态快照</strong>，抓取自组件刚刚创建完毕之后。<br><code>paramMap</code> 是一个URL中路由所携带的参数值的对象。”id”对应的值就是要获取的书本的 id。<br><strong>注意</strong>：<br>路由参数总会是字符串。这里我们使用 (+) 操作符，将字符串转换成数字。     </p>
<p>现在在浏览器上刷新下页面，再点击 <strong>打开书本详情</strong> 按钮，可以看到控制台输出了<code>此课本的id是1</code>的结果。<br>到这一步，我们算是把路由配置完成了，接下来可以开始做页面的逻辑了。    </p>
<p><strong>本部分内容到这结束</strong></p>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#112;&#x69;&#x6e;&#x67;&#x61;&#110;&#56;&#55;&#x38;&#x37;&#64;&#113;&#113;&#46;&#x63;&#111;&#x6d;">&#112;&#x69;&#x6e;&#x67;&#x61;&#110;&#56;&#55;&#x38;&#x37;&#64;&#113;&#113;&#46;&#x63;&#111;&#x6d;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>JS小册</td>
<td>js.pingan8787.com</td>
</tr>
<tr>
<td>微信公众号</td>
<td>前端自习课</td>
</tr>
</tbody></table>
<p><img src="http://images.pingan8787.com/2019_07_12guild_page.png" alt="bg">  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/02/23/142-%E3%80%90CuteJavaScript%E3%80%91Angular6%E5%85%A5%E9%97%A8%E9%A1%B9%E7%9B%AE%EF%BC%881-%E6%9E%84%E5%BB%BA%E9%A1%B9%E7%9B%AE%E5%92%8C%E5%88%9B%E5%BB%BA%E8%B7%AF%E7%94%B1%EF%BC%89/" data-id="ckts3ejt2002m4d9kamf93s3r" data-title="142-【CuteJavaScript】Angular6入门项目（1.构建项目和创建路由）" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Angular/" rel="tag">Angular</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-141-【Nodejs】Nodejs文件管理模块fs" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/02/18/141-%E3%80%90Nodejs%E3%80%91Nodejs%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97fs/" class="article-date">
  <time class="dt-published" datetime="2019-02-18T13:20:14.000Z" itemprop="datePublished">2019-02-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/02/18/141-%E3%80%90Nodejs%E3%80%91Nodejs%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97fs/">141-【Nodejs】Nodejs文件管理模块fs</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://juejin.im/post/5c676ba3e51d45798b51d65c#comment">阅读原文</a>   </p>
<h2 id="一、fs-基础方法："><a href="#一、fs-基础方法：" class="headerlink" title="一、fs 基础方法："></a>一、fs 基础方法：</h2><ul>
<li><code>fs.stat</code> 检测是文件还是目录。   </li>
<li><code>fs.mkdir</code> 创建目录。   </li>
<li><code>fs.writeFile</code> 创建写入文件。   </li>
<li><code>fs.appendFile</code> 追加文件。   </li>
<li><code>fs.readFile</code> 读取文件（异步）。   </li>
<li><code>fs.readFileSync</code> 读取文件（同步）。   </li>
<li><code>fs.readdir</code> 读取目录。   </li>
<li><code>fs.rename</code> 重命名。   </li>
<li><code>fs.rmdir</code> 删除目录。   </li>
<li><code>fs.unlink</code> 删除文件。   </li>
</ul>
<h3 id="1、fs-stat：检测是文件还是目录"><a href="#1、fs-stat：检测是文件还是目录" class="headerlink" title="1、fs.stat：检测是文件还是目录"></a>1、fs.stat：检测是文件还是目录</h3><p>fs.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line">fs.stat(<span class="string">&#x27;fs.js&#x27;</span>, <span class="function">(<span class="params">error, stats</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(error);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(stats);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`文件：<span class="subst">$&#123;stats.isFile()&#125;</span>`</span>); <span class="comment">// 文件：true</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`目录：<span class="subst">$&#123;stats.isDirectory()&#125;</span>`</span>); <span class="comment">// 目录：false</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>执行 node fs.js。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(stats)：</span><br><span class="line">&#123; <span class="attr">dev</span>: <span class="number">636204</span>,</span><br><span class="line">  <span class="attr">mode</span>: <span class="number">33206</span>,</span><br><span class="line">  <span class="attr">nlink</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">uid</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">gid</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">rdev</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">blksize</span>: <span class="literal">undefined</span>,</span><br><span class="line">  <span class="attr">ino</span>: <span class="number">1407374883609714</span>,</span><br><span class="line">  <span class="attr">size</span>: <span class="number">242</span>,</span><br><span class="line">  <span class="attr">blocks</span>: <span class="literal">undefined</span>,</span><br><span class="line">  <span class="attr">atime</span>: <span class="number">2018</span>-<span class="number">12</span>-25T09:<span class="number">14</span>:<span class="number">40.</span>866Z,</span><br><span class="line">  <span class="attr">mtime</span>: <span class="number">2019</span>-<span class="number">01</span>-15T09:<span class="number">18</span>:<span class="number">06</span>.561Z,</span><br><span class="line">  <span class="attr">ctime</span>: <span class="number">2019</span>-<span class="number">01</span>-15T09:<span class="number">18</span>:<span class="number">06</span>.561Z,</span><br><span class="line">  <span class="attr">birthtime</span>: <span class="number">2018</span>-<span class="number">12</span>-25T09:<span class="number">14</span>:<span class="number">40.</span>866Z &#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`文件：<span class="subst">$&#123;stats.isFile()&#125;</span>`</span>); <span class="comment">// 文件：true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`目录：<span class="subst">$&#123;stats.isDirectory()&#125;</span>`</span>); <span class="comment">// 目录：false</span></span><br></pre></td></tr></table></figure>

<h3 id="补充："><a href="#补充：" class="headerlink" title="补充："></a>补充：</h3><ul>
<li><code>stats.isFile()</code>  如果是文件返回 <code>true</code>，否则返回 <code>false</code>。   </li>
<li><code>stats.isDirectory()</code> 如果是目录返回 <code>true</code>，否则返回 <code>false</code>。  </li>
<li><code>stats.isBlockDevice()</code> 如果是块设备返回 <code>true</code>，否则返回 <code>false</code>。   </li>
<li><code>stats.isCharacterDevice()</code> 如果是字符设备返回 <code>true</code>，否则返回 <code>false</code>。   </li>
<li><code>stats.isSymbolicLink()</code>  如果是软链接返回 <code>true</code>，否则返回 <code>false</code>。   </li>
<li><code>stats.isFIFO()</code>  如果是<code>FIFO</code>，返回<code>true</code>，否则返回 <code>false</code>，<code>FIFO</code>是<code>UNIX</code>中的一种特殊类型的命令管道。   </li>
<li><code>stats.isSocket()</code>  如果是 Socket 返回 <code>true</code>，否则返回 <code>false</code>。   </li>
</ul>
<h3 id="2、fs-mkdir：创建目录"><a href="#2、fs-mkdir：创建目录" class="headerlink" title="2、fs.mkdir：创建目录"></a>2、fs.mkdir：创建目录</h3><p>fs.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line">fs.mkdir(<span class="string">&#x27;images&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;目录创建成功！&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>接收参数：</p>
<ul>
<li><code>path</code>：将创建的目录路径。   </li>
<li><code>mode</code>：目录权限（读写权限），默认 0777。   </li>
<li><code>callback</code>：回调，传递异常参数 err。   </li>
</ul>
<p>执行 <code>node fs.js</code>。<br>会发现目录下多了一个 images 文件夹。   </p>
<h3 id="3、fs-rmdir：删除目录"><a href="#3、fs-rmdir：删除目录" class="headerlink" title="3、fs.rmdir：删除目录"></a>3、fs.rmdir：删除目录</h3><p>fs.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line">fs.rmdir(<span class="string">&#x27;images&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;目录删除成功！&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>执行<code> node fs.js</code>。<br>会发现目录下 images 文件夹被删除。   </p>
<h3 id="4、fs-writeFile：创建写入文件"><a href="#4、fs-writeFile：创建写入文件" class="headerlink" title="4、fs.writeFile：创建写入文件"></a>4、fs.writeFile：创建写入文件</h3><p>fs.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line">fs.writeFile(<span class="string">&quot;index.js&quot;</span>, <span class="string">&quot;hello NodeJS！&quot;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;文件写入成功！&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>接收参数：</p>
<ul>
<li>``filename` (String) 文件名称。   </li>
<li>``data` (String | Buffer) 将要写入的内容，可以是字符串或者 buffer 数据。   </li>
<li>``encoding<code>(String) 可选。默认</code>‘utf-8’`，当 data 是 buffer 时，该值应该为 ignored。   </li>
<li>``mode<code>(Number) 文件读写权限，默认</code>438`。   </li>
<li>``flag<code>(String) 默认值</code>‘w’`。   </li>
<li>``callback<code> &#123; Function &#125; 回调，传递一个异常参数</code> err`。   </li>
</ul>
<p>执行 <code>node fs.js</code>。<br>会发现目录下多了一个 index.js 文件夹，并且添加了“hello NodeJS！”的内容。   </p>
<p>注意，这样的写入，是清空原文件中的所有数据，然后添加“hello NodeJS！”这句话，即：存在即覆盖，不存在即创建。   </p>
<h3 id="5、fs-unlink：删除文件"><a href="#5、fs-unlink：删除文件" class="headerlink" title="5、fs.unlink：删除文件"></a>5、fs.unlink：删除文件</h3><p>fs.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line">fs.unlink(<span class="string">&quot;index.js&quot;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;删除成功！&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>执行 <code>node fs.js</code>。<br>会发现目录下 index.js 文件被删除。   </p>
<h3 id="6、fs-appendFile：追加文件"><a href="#6、fs-appendFile：追加文件" class="headerlink" title="6、fs.appendFile：追加文件"></a>6、fs.appendFile：追加文件</h3><p>fs.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line">fs.appendFile(<span class="string">&quot;index.js&quot;</span>, <span class="string">&quot;追加的内容&quot;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;追加成功！&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>执行 <code>node fs.js</code>。<br>会发现目录下 index.js 文件后有追加了一段话“追加的内容”。   </p>
<h3 id="7、fs-readFile：读取文件"><a href="#7、fs-readFile：读取文件" class="headerlink" title="7、fs.readFile：读取文件"></a>7、fs.readFile：读取文件</h3><p>fs.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line">fs.readFile(<span class="string">&quot;index.js&quot;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;读取文件成功！&quot;</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(data); <span class="comment">// &lt;Buffer 68 65 6c 6c 6f 20 4e 6f 64 65 4a 53 ef bc 81 e8 bf bd e5 8a a0 e7 9a 84 e5 86 85 e5 ae b9&gt;</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>执行 <code>node fs.js</code>。   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(data)</span><br><span class="line">&lt;Buffer <span class="number">68</span> <span class="number">65</span> 6c 6c 6f <span class="number">20</span> 4e 6f <span class="number">64</span> <span class="number">65</span> 4a <span class="number">53</span> ef bc <span class="number">81</span> e8 bf bd e5 8a a0 e7 9a <span class="number">84</span> e5 <span class="number">86</span> <span class="number">85</span> e5 ae b9&gt;</span><br></pre></td></tr></table></figure>

<h3 id="8、fs-readdir：读取目录"><a href="#8、fs-readdir：读取目录" class="headerlink" title="8、fs.readdir：读取目录"></a>8、fs.readdir：读取目录</h3><p>fs.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line">fs.readdir(<span class="string">&quot;node_modules&quot;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;读取目录成功！&quot;</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(data); <span class="comment">// [ &#x27;03_tool_multiply.js&#x27;, &#x27;my_module&#x27; ]</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>执行 <code>node fs.js</code>。   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(data) </span><br><span class="line">[ <span class="string">&#x27;03_tool_multiply.js&#x27;</span>, <span class="string">&#x27;my_module&#x27;</span> ]</span><br></pre></td></tr></table></figure>

<h3 id="9、fs-rename：重命名"><a href="#9、fs-rename：重命名" class="headerlink" title="9、fs.rename：重命名"></a>9、fs.rename：重命名</h3><p>fs.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line">fs.rename(<span class="string">&quot;index.js&quot;</span>, <span class="string">&quot;new_index.js&quot;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;重命名成功！&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>执行 <code>node fs.js</code>。<br>会发现目录下 index.js 文件被修改为 new_index.js。   </p>
<h3 id="10、补充：fs-rename-还可以剪切"><a href="#10、补充：fs-rename-还可以剪切" class="headerlink" title="10、补充：fs.rename 还可以剪切"></a>10、补充：fs.rename 还可以剪切</h3><p>fs.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line">fs.rename(<span class="string">&quot;new_index.js&quot;</span>, <span class="string">&quot;node_modules/new_index.js&quot;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;剪切成功！&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>执行 <code>node fs.js</code>。<br>会发现目录下 new_index.js 文件被移动到了 node_modules 目录下。   </p>
<h2 id="二、fs-案例"><a href="#二、fs-案例" class="headerlink" title="二、fs 案例"></a>二、fs 案例</h2><h3 id="1、判断是否有-upload-目录"><a href="#1、判断是否有-upload-目录" class="headerlink" title="1、判断是否有 upload 目录"></a>1、判断是否有 upload 目录</h3><p>fsDemo.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line">fs.stat(<span class="string">&quot;upload&quot;</span>, <span class="function">(<span class="params">err, stats</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="comment">// 如果没有，创建 upload 目录</span></span><br><span class="line">        fs.mkdir(<span class="string">&quot;upload&quot;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(err);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;创建成功！&quot;</span>);</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(stats.isDirectory()); <span class="comment">// true</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;有 upload 目录，你可以做更多操作！&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>执行 fsDemo.js。<br>打印结果：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(stats.isDirectory()); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>有 upload 目录，你可以做更多操作！   </p>
<h3 id="2、读取目录全部文件"><a href="#2、读取目录全部文件" class="headerlink" title="2、读取目录全部文件"></a>2、读取目录全部文件</h3><p>fsDemo.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line">fs.readdir(<span class="string">&quot;../05fs/&quot;</span>, <span class="function">(<span class="params">err, files</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(files);</span><br><span class="line">        <span class="keyword">let</span> filesArr = [];</span><br><span class="line"></span><br><span class="line">        (<span class="function"><span class="keyword">function</span> <span class="title">getFile</span>(<span class="params">i</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// 循环结束</span></span><br><span class="line">            <span class="keyword">if</span> (i == files.length) &#123;</span><br><span class="line">                <span class="comment">// 打印出所有目录</span></span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;目录&quot;</span>);</span><br><span class="line">                <span class="built_in">console</span>.log(filesArr);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 判断目录是文件还是文件夹</span></span><br><span class="line">            fs.stat(<span class="string">&quot;../05fs/&quot;</span> + files[i], <span class="function">(<span class="params">err, stats</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (stats.isDirectory()) &#123;</span><br><span class="line">                    filesArr.push(files[i]);</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="comment">// 递归调用</span></span><br><span class="line">                getFile(i + <span class="number">1</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)(<span class="number">0</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>执行 fsDemo.js。<br>打印结果：   </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[ &#x27;fs.js&#x27;, &#x27;fsDemo.js&#x27;, &#x27;fsStream.js&#x27;, &#x27;upload&#x27; ]</span><br><span class="line">目录</span><br><span class="line">[ &#x27;upload&#x27; ]</span><br></pre></td></tr></table></figure>

<h2 id="三、fs-流"><a href="#三、fs-流" class="headerlink" title="三、fs 流"></a>三、fs 流</h2><h3 id="1、fs-流及其读取"><a href="#1、fs-流及其读取" class="headerlink" title="1、fs 流及其读取"></a>1、fs 流及其读取</h3><p>首先创建一个 index.js 文件，并添加测试文本。<br>fsStream.js   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="comment">// 流的方式读取文件</span></span><br><span class="line"><span class="keyword">const</span> fileReadStream = fs.createReadStream(<span class="string">&quot;index.js&quot;</span>);</span><br><span class="line"><span class="comment">// 读取次数</span></span><br><span class="line"><span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// 保存数据</span></span><br><span class="line"><span class="keyword">let</span> str = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="comment">// 开始读取</span></span><br><span class="line">fileReadStream.on(<span class="string">&quot;data&quot;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;++count&#125;</span> 接收到：<span class="subst">$&#123;chunk.length&#125;</span>`</span>);</span><br><span class="line">    str += chunk;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 读取完成</span></span><br><span class="line">fileReadStream.on(<span class="string">&quot;end&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;结束&quot;</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(count);</span><br><span class="line">    <span class="built_in">console</span>.log(str);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 读取失败</span></span><br><span class="line">fileReadStream.on(<span class="string">&quot;err&quot;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>执行 fsStream.js。<br>打印结果：   </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1 接收到：18</span><br><span class="line">结束</span><br><span class="line">1</span><br><span class="line">fs 流及其读取</span><br></pre></td></tr></table></figure>

<h3 id="2、流的写入"><a href="#2、流的写入" class="headerlink" title="2、流的写入"></a>2、流的写入</h3><p>fsStream.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> data = <span class="string">&quot;存入数据...&quot;</span>;</span><br><span class="line"><span class="comment">// 创建一个可以写入的流，写入到 index.js</span></span><br><span class="line"><span class="keyword">let</span> fileWriteStream = fs.createWriteStream(<span class="string">&quot;index.js&quot;</span>);</span><br><span class="line"><span class="comment">// 开始写入</span></span><br><span class="line">fileWriteStream.write(data, <span class="string">&quot;utf8&quot;</span>);</span><br><span class="line"><span class="comment">// 写入完成</span></span><br><span class="line">fileWriteStream.end();</span><br><span class="line">fileWriteStream.on(<span class="string">&quot;finish&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;写入完成！&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>执行 fsStream.js。<br>打开 index.js 文件，发现里面内容变成了“存入数据…”。<br>打印结果：   </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">写入完成！   </span><br></pre></td></tr></table></figure>

<p>以上我们就通过流的形式进行了读取和写入的操作。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/02/18/141-%E3%80%90Nodejs%E3%80%91Nodejs%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97fs/" data-id="ckts3ejt1002k4d9k5b09f8xi" data-title="141-【Nodejs】Nodejs文件管理模块fs" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Nodejs/" rel="tag">Nodejs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-140-【JavaScript】【重温基础】22-内存管理" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/02/16/140-%E3%80%90JavaScript%E3%80%91%E3%80%90%E9%87%8D%E6%B8%A9%E5%9F%BA%E7%A1%80%E3%80%9122-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" class="article-date">
  <time class="dt-published" datetime="2019-02-16T04:56:58.000Z" itemprop="datePublished">2019-02-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/02/16/140-%E3%80%90JavaScript%E3%80%91%E3%80%90%E9%87%8D%E6%B8%A9%E5%9F%BA%E7%A1%80%E3%80%9122-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/">140-【JavaScript】【重温基础】22.内存管理</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><img src="http://images.pingan8787.com/%E9%87%8D%E6%B8%A9%E5%9F%BA%E7%A1%80%E5%B0%81%E9%9D%A2.png" alt="重温基础封面"></p>
<hr>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#112;&#105;&#110;&#103;&#x61;&#110;&#56;&#55;&#x38;&#55;&#64;&#113;&#113;&#x2e;&#99;&#111;&#109;">&#112;&#105;&#110;&#103;&#x61;&#110;&#56;&#55;&#x38;&#55;&#64;&#113;&#113;&#x2e;&#99;&#111;&#109;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>微信公众号</td>
<td>前端自习课</td>
</tr>
</tbody></table>
<p>本文是 <strong>重温基础</strong> 系列文章的第二十二篇。<br>今日感受：优化学习方法。    </p>
<p><strong>本章节复习的是JS中的内存管理，这对于我们开发非常有帮助。</strong>   </p>
<p><strong>前置知识</strong><br>绝大多数的程序语言，他们的内存生命周期基本一致：  </p>
<p><img src="http://images.pingan8787.com/20190216_memory_manage1.png" alt="memory lifecycle"> </p>
<ol>
<li>分配所需使用的内存 ——（<strong>分配内存</strong>）   </li>
<li>使用分配到的内存（读、写） ——（<strong>使用内存</strong>）   </li>
<li>不需要时将其释放\归还 ——（<strong>释放内存</strong>）   </li>
</ol>
<p>对于所有的编程语言，第二部分都是明确的。而第一和第三部分在底层语言中是明确的。<br>但在像<code>JavaScript</code>这些高级语言中，大部分都是隐含的，因为<code>JavaScript</code>具有自动垃圾回收机制（Garbage collected）。<br>因此在做<code>JavaScript</code>开发时，不需要关心内存的使用问题，所需内存分配和无用内存回收，都完全实现自动管理。   </p>
<h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1.概述"></a>1.概述</h2><blockquote>
<p>像C语言这样的高级语言一般都有底层的内存管理接口，比如 <code>malloc()</code>和<code>free()</code>。另一方面，JavaScript创建变量（对象，字符串等）时分配内存，并且在不再使用它们时“自动”释放。 后一个过程称为<strong>垃圾回收</strong>。这个“自动”是混乱的根源，并让JavaScript（和其他高级语言）开发者感觉他们可以不关心内存管理。 这是错误的。<br>——《MDN JavaScript 内存管理》   </p>
</blockquote>
<p>MDN中的介绍告诉我们，作为<code>JavaScript</code>开发者，还是需要去了解内存管理，虽然<code>JavaScript</code>已经给我们做好自动管理。   </p>
<h2 id="2-JavaScript内存生命周期"><a href="#2-JavaScript内存生命周期" class="headerlink" title="2.JavaScript内存生命周期"></a>2.JavaScript内存生命周期</h2><h3 id="2-1-分配内存"><a href="#2-1-分配内存" class="headerlink" title="2.1 分配内存"></a>2.1 分配内存</h3><p>在做<code>JavaScript</code>开发时，我们定义变量的时候，<code>JavaScript</code>便为我们完成了内存分配：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> num = <span class="number">100</span>;      <span class="comment">// 为数值变量分配内存</span></span><br><span class="line"><span class="keyword">var</span> str = <span class="string">&#x27;pingan&#x27;</span>; <span class="comment">// 为字符串变量分配内存</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span> : <span class="string">&#x27;pingan&#x27;</span></span><br><span class="line">&#125;;                  <span class="comment">// 为对象变量及其包含的值分配内存</span></span><br><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="literal">null</span>, <span class="string">&#x27;hi&#x27;</span>]; <span class="comment">// 为数组变量及其包含的值分配内存</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params">num</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> num + <span class="number">2</span>;</span><br><span class="line">&#125;;                  <span class="comment">// 为函数（可调用的对象）分配内存</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数表达式也能分配一个对象</span></span><br><span class="line">someElement.addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  someElement.style.backgroundColor = <span class="string">&#x27;blue&#x27;</span>;</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<p>另外，通过调用函数，也会分配内存：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类型1. 分配对象内存</span></span><br><span class="line"><span class="keyword">var</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();   <span class="comment">// 分配一个Date对象</span></span><br><span class="line"><span class="keyword">var</span> elem = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>); <span class="comment">// 分配一个DOM元素</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 类型2. 分配新变量或者新对象</span></span><br><span class="line"><span class="keyword">var</span> str1 = <span class="string">&quot;pingan&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> str2 = str1.substr(<span class="number">0</span>, <span class="number">3</span>); <span class="comment">// str2 是一个新的字符串</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr1 = [<span class="string">&quot;hi&quot;</span>, <span class="string">&quot;pingan&quot;</span>];</span><br><span class="line"><span class="keyword">var</span> arr2 = [<span class="string">&quot;hi&quot;</span>, <span class="string">&quot;leo&quot;</span>];</span><br><span class="line"><span class="keyword">var</span> arr3 = arr1.concat(arr2); <span class="comment">// arr3 是一个新的数组（arr1和arr2连接的结果）</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-使用内存"><a href="#2-2-使用内存" class="headerlink" title="2.2 使用内存"></a>2.2 使用内存</h3><p>使用内存的过程实际上是对分配的内存进行读取与写入的操作。<br>通常表现就是使用定义的值。<br>读取与写入可能是写入一个变量或者一个对象的属性值，甚至传递函数的参数。  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> num = <span class="number">1</span>;</span><br><span class="line">num ++; <span class="comment">// 使用已经定义的变量，做递增操作</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-释放内存"><a href="#2-3-释放内存" class="headerlink" title="2.3 释放内存"></a>2.3 释放内存</h3><p>当我们前面定义好的变量或函数（分配的内存）已经不需要使用的时候，便需要释放掉这些内存。这也是内存管理中最难的任务，因为我们不知道什么时候这些内存不使用。<br>很好的是，在高级语言解释器中，已经嵌入“<strong>垃圾回收器</strong>”，用来<strong>跟踪内存的分配和使用</strong>，以便在内存不使用时自动释放（这并不是百分百跟踪到，只是个近似过程）。</p>
<h2 id="3-垃圾回收机制"><a href="#3-垃圾回收机制" class="headerlink" title="3.垃圾回收机制"></a>3.垃圾回收机制</h2><p>就像前面提到的，“<strong>垃圾回收器</strong>”只能解决一般情况，接下来我们需要了解主要的垃圾回收算法和它们局限性。   </p>
<h3 id="3-1-引用"><a href="#3-1-引用" class="headerlink" title="3.1 引用"></a>3.1 引用</h3><p>垃圾回收算法主要依赖于<strong>引用</strong>的概念。<br>即在内存管理环境中，一个对象如果有权限访问另一个对象，不论显式还是隐式，称为一个对象<strong>引用</strong>另一个对象。<br>例如：一个JS对象具有对它<strong>原型的引用</strong>（隐式引用）和对它<strong>属性的引用</strong>（显式引用）。<br><strong>注意：</strong><br>这里的对象，不仅包含JS对象，也包含函数作用域（或全局词法作用域）。   </p>
<h3 id="3-2-引用计数垃圾收集"><a href="#3-2-引用计数垃圾收集" class="headerlink" title="3.2 引用计数垃圾收集"></a>3.2 引用计数垃圾收集</h3><p>这个算法，把“<strong>对象是否不再需要</strong>”定义为：当一个对象没有被其他对象所引用的时候，回收该对象。这是最初级的垃圾收集算法。   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    <span class="attr">leo</span> : &#123;</span><br><span class="line">        <span class="attr">age</span> : <span class="number">18</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这里创建2个对象，一个作为<code>leo</code>的属性被引用，另一个被分配给变量<code>obj</code>。   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 省略上面的代码</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">我们将前面的</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">        leo : &#123;</span></span><br><span class="line"><span class="comment">            age : 18</span></span><br><span class="line"><span class="comment">        &#125;;</span></span><br><span class="line"><span class="comment">    &#125;;</span></span><br><span class="line"><span class="comment">称为“这个对象”</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">var</span> obj2 = obj;  <span class="comment">// obj2变量是第二个对“这个对象”的引用</span></span><br><span class="line">obj = <span class="string">&#x27;pingan&#x27;</span>;  <span class="comment">// 将“这个对象”的原始是引用obj换成obj2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> leo2 = obj2.leo;  <span class="comment">// 引用“这个对象”的leo属性</span></span><br></pre></td></tr></table></figure>
<p>可以看出，现在的“这个对象”已经有2个引用，一个是<code>obj2</code>，另一个是<code>leo2</code>。   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">obj2 = <span class="string">&#x27;hi&#x27;</span>; </span><br><span class="line"><span class="comment">// 将obj2变成零引用，因此，obj2可以被垃圾回收</span></span><br><span class="line"><span class="comment">// 但是它的属性leo还在被leo2对象引用，所以还不能回收</span></span><br><span class="line"></span><br><span class="line">leo2 = <span class="literal">null</span>;</span><br><span class="line"><span class="comment">// 将leo变成零引用，这样obj2和leo2都可以被垃圾回收</span></span><br></pre></td></tr></table></figure>

<p><strong>这个算法有个限制</strong>：<br>无法处理<strong>循环引用</strong>。即两个对象创建时相互引用形成一个循环。   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> obj1 = &#123;&#125;, obj2 = &#123;&#125;;</span><br><span class="line">    obj1.leo = obj2;  <span class="comment">// obj1引用obj2</span></span><br><span class="line">    obj2.leo = obj1;  <span class="comment">// obj2引用obj1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hi pingan&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">fun();</span><br></pre></td></tr></table></figure>
<p><img src="http://images.pingan8787.com/20190216_memory_manage2.png" alt="Cyclic Reference"> </p>
<p>可以看出，它们被调用之后，会离开函数作用域，已经没有用了可以被回收，然而<strong>引用计数算法</strong>考虑到它们之间相互至少引用一次，所以它们不会被回收。   </p>
<p><strong>实际案例</strong>：<br>在IE6，7中，使用引用计数方式对DOM对象进行垃圾回收，常常造成对象被循环引用导致内存泄露：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj;</span><br><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    obj = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;myId&#x27;</span>);</span><br><span class="line">    obj.leo = obj;</span><br><span class="line">    obj.data = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">100000</span>).join(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>可以看出，DOM元素<code>obj</code>中的<code>leo</code>属性引用了自己<code>obj</code>，造成循环引用，若该属性（<code>leo</code>）没有移除或设置为<code>null</code>，垃圾回收器总是且至少有一个引用，并一直占用内存，即使从DOM树删除，如果这个DOM元素含大量数据（如<code>data</code>属性）则会导致占用内存永远无法释放，出现内存泄露。   </p>
<h3 id="3-3-标记清除算法"><a href="#3-3-标记清除算法" class="headerlink" title="3.3 标记清除算法"></a>3.3 标记清除算法</h3><p>这个算法，将“<strong>对象是否不再需要</strong>”定义为：对象是否可以获得。    </p>
<p><img src="http://images.pingan8787.com/20190216_memory_manage3.png" alt="Mark and Sweep"></p>
<p>标记清除算法，是假定设置一个根对象（root），在JS中是全局对象。垃圾回收器定时找所有从根开始引用的对象，然后再找这些对象引用的对象…直到找到所有<strong>可以获得的对象</strong>和<strong>搜集所有不能获得的对象</strong>。   </p>
<p>它比<strong>引用计数垃圾收集</strong>更好，因为“有零引用的对象”总是不可获得的，但是相反却不一定，参考“循环引用”。   </p>
<p><strong>循环引用不再是问题：</strong>   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> obj1 = &#123;&#125;, obj2 = &#123;&#125;;</span><br><span class="line">    obj1.leo = obj2;  <span class="comment">// obj1引用obj2</span></span><br><span class="line">    obj2.leo = obj1;  <span class="comment">// obj2引用obj1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hi pingan&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">fun();</span><br></pre></td></tr></table></figure>
<p>还是这个代码，可以看出，使用<strong>标记清除算法</strong>来看，函数调用之后，两个对象无法从全局对象获取，因此将被回收。相同的，下面案例，一旦 <code>obj</code> 和其事件处理无法从根获取到，他们将会被垃圾回收器回收。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj;</span><br><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    obj = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;myId&#x27;</span>);</span><br><span class="line">    obj.leo = obj;</span><br><span class="line">    obj.data = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">100000</span>).join(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong> 那些无法从根对象查询到的对象都将被清除。</p>
<h3 id="3-4-个人小结"><a href="#3-4-个人小结" class="headerlink" title="3.4 个人小结"></a>3.4 个人小结</h3><p>在日常开发中，应该注意及时切断需要回收对象与根的联系，虽然标记清除算法已经足够强壮，就像下面代码：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj,ele=<span class="built_in">document</span>.getElementById(<span class="string">&#x27;myId&#x27;</span>);</span><br><span class="line">obj.div = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">ele.appendChild(obj.div);</span><br><span class="line"><span class="comment">// 删除DOM元素</span></span><br><span class="line">ele.removeChild(obj.div);</span><br></pre></td></tr></table></figure>
<p>如果我们只是做小型项目开发，JS用的比较少的话，内存管理可以不用太在意，但是如果是大项目（SPA，服务器或桌面应用），那就需要考虑好内存管理问题了。</p>
<h2 id="4-内存泄露（Memory-Leak）"><a href="#4-内存泄露（Memory-Leak）" class="headerlink" title="4.内存泄露（Memory Leak）"></a>4.内存泄露（Memory Leak）</h2><h3 id="4-1-内存泄露概念"><a href="#4-1-内存泄露概念" class="headerlink" title="4.1 内存泄露概念"></a>4.1 内存泄露概念</h3><blockquote>
<p>在计算机科学中，内存泄漏指由于疏忽或错误造成程序未能释放已经不再使用的内存。内存泄漏并非指内存在物理上的消失，而是应用程序分配某段内存后，由于设计错误，导致在释放该段内存之前就失去了对该段内存的控制，从而造成了内存的浪费。 ——维基百科</p>
</blockquote>
<p>其实简单理解：<strong>一些不再使用的内存无法被释放</strong>。<br>当内存占用越来越多，不仅影响系统性能，严重的还会导致进程奔溃。    </p>
<h3 id="4-2-内存泄露案例"><a href="#4-2-内存泄露案例" class="headerlink" title="4.2 内存泄露案例"></a>4.2 内存泄露案例</h3><ol>
<li>全局变量    </li>
</ol>
<p>未定义的变量，会被定义到全局，当页面关闭才会销毁，这样就造成内存泄露。如下：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    name = <span class="string">&#x27;pingan&#x27;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>未销毁的定时器和回调函数<br>如果这里举一个定时器的案例，如果定时器没有回收，则不仅整个定时器无法被内存回收，定时器函数的依赖也无法回收：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> data = &#123;&#125;;</span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> render = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;myId&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(render)&#123;</span><br><span class="line">        render.innderHTML = <span class="built_in">JSON</span>.stringify(data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>闭包</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">var</span> fun = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> str2 = str;</span><br><span class="line">    <span class="keyword">var</span> unused = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(str2) <span class="built_in">console</span>.log(<span class="string">&#x27;is unused&#x27;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    str = &#123;</span><br><span class="line">        my_str = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">100000</span>).join(<span class="string">&#x27;--&#x27;</span>);</span><br><span class="line">        my_fun = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;is my_fun&#x27;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">setInterval</span>(fun, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>
<p>定时器中每次调用<code>fun</code>，<code>str</code>都会获得一个包含巨大的数组和一个对于新闭包<code>my_fun</code>的对象，并且<code>unused</code>是一个引用了<code>str2</code>的闭包。<br>整个案例中，闭包之间共享作用域，尽管<code>unused</code>可能一直没有调用，但<code>my_fun</code>可能被调用，就会导致内存无法回收，内存增长导致泄露。   </p>
</li>
<li><p>DOM引用<br>当我们把DOM的引用保存在一个数组或Map中，即使移除了元素，但仍然有引用，导致无法回收内存。例如：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ele = &#123;</span><br><span class="line">    <span class="attr">img</span> : <span class="built_in">document</span>.getElementById(<span class="string">&#x27;my_img&#x27;</span>)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    ele.img.src = <span class="string">&quot;http://www.baidu.com/1.png&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">document</span>.body.removeChild(<span class="built_in">document</span>.getElementById(<span class="string">&#x27;my_img&#x27;</span>));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>即使<code>foo</code>方法将<code>my_img</code>元素移除，但<code>fun</code>仍有引用，无法回收。   </p>
</li>
</ol>
<h3 id="4-3-内存泄露识别方法"><a href="#4-3-内存泄露识别方法" class="headerlink" title="4.3 内存泄露识别方法"></a>4.3 内存泄露识别方法</h3><ol>
<li>浏览器</li>
</ol>
<p>通过Chrome浏览器查看内存占用：   </p>
<p><img src="http://images.pingan8787.com/20190216_memory_manage4.png" alt="内存泄露识别方法1"></p>
<p>步骤如下：   </p>
<ul>
<li>打开开发者工具，选择 <strong>Timeline</strong> 面板   </li>
<li>在顶部的<strong>Capture</strong>字段里面勾选 <strong>Memory</strong>    </li>
<li>点击左上角的录制按钮   </li>
<li>在页面上进行各种操作，模拟用户的使用情况   </li>
<li>一段时间后，点击对话框的 **stop **按钮，面板上就会显示这段时间的内存占用情况   </li>
</ul>
<p>如果内存占用基本平稳，接近水平，就说明不存在内存泄漏。</p>
<p><img src="http://images.pingan8787.com/20190216_memory_manage5.png" alt="内存泄露识别方法1"></p>
<p>反之，就是内存泄漏了。   </p>
<p><img src="http://images.pingan8787.com/20190216_memory_manage6.png" alt="内存泄露识别方法1"></p>
<ol start="2">
<li>命令行</li>
</ol>
<p>命令行可以使用 <strong>Node</strong> 提供的<code>process.memoryUsage</code>方法。   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(process.memoryUsage());</span><br><span class="line"><span class="comment">// &#123; rss: 27709440,</span></span><br><span class="line"><span class="comment">//  heapTotal: 5685248,</span></span><br><span class="line"><span class="comment">//  heapUsed: 3449392,</span></span><br><span class="line"><span class="comment">//  external: 8772 &#125;</span></span><br></pre></td></tr></table></figure>
<p><code>process.memoryUsage</code>返回一个对象，包含了 <strong>Node</strong> 进程的内存占用信息。该对象包含四个字段，单位是字节，含义如下。    </p>
<p><img src="http://images.pingan8787.com/20190216_memory_manage7.png" alt="内存泄露识别方法1"></p>
<ul>
<li><code>rss（resident set size）</code>：所有内存占用，包括指令区和堆栈。   </li>
<li><code>heapTotal</code>：”堆”占用的内存，包括用到的和没用到的。   </li>
<li><code>heapUsed</code>：用到的堆的部分。   </li>
<li><code>external</code>： V8 引擎内部的 C++ 对象占用的内存。   </li>
</ul>
<p>判断内存泄漏，以<code>heapUsed</code>字段为准。</p>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><ol>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Memory_Management">MDN JavaScript指南 内存管理</a>  </li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/30552148">精读《JS 中的内存管理》</a> </li>
<li>阮一峰老师<a href="www.ruanyifeng.com/blog/2017/04/memory-leak.html">JavaScript 内存泄漏教程</a></li>
</ol>
<p><strong>本部分内容到这结束</strong></p>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#x70;&#x69;&#x6e;&#103;&#x61;&#110;&#56;&#x37;&#56;&#x37;&#x40;&#x71;&#113;&#x2e;&#x63;&#x6f;&#109;">&#x70;&#x69;&#x6e;&#103;&#x61;&#110;&#56;&#x37;&#56;&#x37;&#x40;&#x71;&#113;&#x2e;&#x63;&#x6f;&#109;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>JS小册</td>
<td>js.pingan8787.com</td>
</tr>
<tr>
<td>微信公众号</td>
<td>前端自习课</td>
</tr>
</tbody></table>
<p><img src="http://images.pingan8787.com/fe_img.png" alt="前端自习课"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/02/16/140-%E3%80%90JavaScript%E3%80%91%E3%80%90%E9%87%8D%E6%B8%A9%E5%9F%BA%E7%A1%80%E3%80%9122-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" data-id="ckts3ejt0002i4d9k2zvr01e8" data-title="140-【JavaScript】【重温基础】22.内存管理" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%87%8D%E6%B8%A9%E5%9F%BA%E7%A1%80/" rel="tag">重温基础</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-139-【Nodejs】Nodejs中各个获取路径方法的区别" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/02/11/139-%E3%80%90Nodejs%E3%80%91Nodejs%E4%B8%AD%E5%90%84%E4%B8%AA%E8%8E%B7%E5%8F%96%E8%B7%AF%E5%BE%84%E6%96%B9%E6%B3%95%E7%9A%84%E5%8C%BA%E5%88%AB/" class="article-date">
  <time class="dt-published" datetime="2019-02-11T13:45:01.000Z" itemprop="datePublished">2019-02-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/02/11/139-%E3%80%90Nodejs%E3%80%91Nodejs%E4%B8%AD%E5%90%84%E4%B8%AA%E8%8E%B7%E5%8F%96%E8%B7%AF%E5%BE%84%E6%96%B9%E6%B3%95%E7%9A%84%E5%8C%BA%E5%88%AB/">139-【Nodejs】Nodejs中各个获取路径方法的区别</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>这里主要区分：<code>module.filename</code>、<code>__filename</code>、<code>__dirname</code>、<code>process.cwd()</code>和<code>require.main.filename</code></p>
<p>它们的区别如下：   </p>
<ul>
<li><code>module.filename</code>：开发期间，该行代码所在的文件。   </li>
<li><code>__filename</code>：始终等于 <code>module.filename</code>。   </li>
<li><code>__dirname</code>：开发期间，该行代码所在的目录。   </li>
<li><code>process.cwd()</code>：运行node的工作目录，可以使用 <code> cd /d</code> 修改工作目录。   </li>
<li><code>require.main.filename</code>：用<code>node命令</code>启动的<code>module</code>的<code>filename</code>, 如 <code>node xxx</code>，这里的<code>filename</code>就是这个<code>xxx</code>。   </li>
</ul>
<p>案例如下：   </p>
<ul>
<li><p>文件结构<br><img src="http://images.pingan8787.com/2019021101.png" alt="文件结构">    </p>
</li>
<li><p>app.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//执行 node E:\node_study\file_path_study\app.js</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;*** app start ***&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;***      module.filename = &#x27;</span> + <span class="built_in">module</span>.filename + <span class="string">&#x27; ***&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;***           __filename = &#x27;</span> + __filename + <span class="string">&#x27; ***&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;***            __dirname = &#x27;</span> + __dirname + <span class="string">&#x27; ***&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;***        process.cwd() = &#x27;</span> + process.cwd() + <span class="string">&#x27; ***&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;*** require.main.filename= &#x27;</span> + <span class="built_in">require</span>.main.filename + <span class="string">&#x27; ***&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;*** app end ***&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;./lib/test&#x27;</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>test.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;*** app start ***&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;***      module.filename = &#x27;</span> + <span class="built_in">module</span>.filename + <span class="string">&#x27; ***&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;***           __filename = &#x27;</span> + __filename + <span class="string">&#x27; ***&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;***            __dirname = &#x27;</span> + __dirname + <span class="string">&#x27; ***&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;***        process.cwd() = &#x27;</span> + process.cwd() + <span class="string">&#x27; ***&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;*** require.main.filename= &#x27;</span> + <span class="built_in">require</span>.main.filename + <span class="string">&#x27; ***&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;*** app end ***&#x27;</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>输出结果<br><img src="http://images.pingan8787.com/2019021102.png" alt="输出结果">    </p>
</li>
</ul>
<p><strong>Nodejs官方文档介绍</strong>：   </p>
<ul>
<li><code>__dirname</code><br>当前模块的目录名。相当于 __filename 的 path.dirname()。</li>
</ul>
<p>例子，在 /Users/mjr 目录下运行 node example.js：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(__dirname);</span><br><span class="line"><span class="comment">// 输出: /Users/mjr</span></span><br><span class="line"><span class="built_in">console</span>.log(path.dirname(__filename));</span><br><span class="line"><span class="comment">// 输出: /Users/mjr</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>__filename</code><br>当前模块的文件名（处理后的绝对路径）。</li>
</ul>
<p>不一定与命令行中使用的名称一致。   </p>
<p>当前模块的目录名可以使用<code>__dirname</code>获取。   </p>
<p>例子：</p>
<p>在 <code>/Users/mjr</code> 目录下运行 <code>node example.js</code>：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(__filename);</span><br><span class="line"><span class="comment">// 输出: /Users/mjr/example.js</span></span><br><span class="line"><span class="built_in">console</span>.log(__dirname);</span><br><span class="line"><span class="comment">// 输出: /Users/mjr</span></span><br></pre></td></tr></table></figure>
<p>假设两个模块 <code>a</code> 和 <code>b</code>, 其中<code> b</code> 是 <code>a</code> 的依赖文件，且目录结构如下：</p>
<ul>
<li><code>/Users/mjr/app/a.js</code>   </li>
<li><code>/Users/mjr/app/node_modules/b/b.js</code>   </li>
</ul>
<p>则 <code>b.js</code> 中的 <code>__filename</code> 会返回 <code>/Users/mjr/app/node_modules/b/b.js</code>，<code>a.js </code>中的 <code>__filename</code> 会返回 <code>/Users/mjr/app/a.js</code>。</p>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><ol>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/happyframework/archive/2013/05/16/3080910.html">NodeJs：module.filename、__filename、__dirname、process.cwd()和require.main.filename 解惑</a>   </li>
<li><a target="_blank" rel="noopener" href="http://nodejs.cn/api/modules.html#modules_dirname">NodeJs 中文网</a></li>
</ol>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#112;&#x69;&#110;&#103;&#97;&#x6e;&#x38;&#55;&#x38;&#55;&#x40;&#x71;&#113;&#46;&#99;&#111;&#109;">&#112;&#x69;&#110;&#103;&#97;&#x6e;&#x38;&#55;&#x38;&#55;&#x40;&#x71;&#113;&#46;&#99;&#111;&#109;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>JS小册</td>
<td>js.pingan8787.com</td>
</tr>
</tbody></table>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/02/11/139-%E3%80%90Nodejs%E3%80%91Nodejs%E4%B8%AD%E5%90%84%E4%B8%AA%E8%8E%B7%E5%8F%96%E8%B7%AF%E5%BE%84%E6%96%B9%E6%B3%95%E7%9A%84%E5%8C%BA%E5%88%AB/" data-id="ckts3ejsz002e4d9k0cgm1be0" data-title="139-【Nodejs】Nodejs中各个获取路径方法的区别" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Nodejs/" rel="tag">Nodejs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-138-【JavaScript】【重温基础】21-高阶函数" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/01/31/138-%E3%80%90JavaScript%E3%80%91%E3%80%90%E9%87%8D%E6%B8%A9%E5%9F%BA%E7%A1%80%E3%80%9121-%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0/" class="article-date">
  <time class="dt-published" datetime="2019-01-31T14:50:46.000Z" itemprop="datePublished">2019-01-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/01/31/138-%E3%80%90JavaScript%E3%80%91%E3%80%90%E9%87%8D%E6%B8%A9%E5%9F%BA%E7%A1%80%E3%80%9121-%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0/">138-【JavaScript】【重温基础】21.高阶函数</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><img src="http://images.pingan8787.com/%E9%87%8D%E6%B8%A9%E5%9F%BA%E7%A1%80%E5%B0%81%E9%9D%A2.png" alt="重温基础封面"></p>
<hr>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#x70;&#105;&#110;&#103;&#97;&#x6e;&#56;&#x37;&#x38;&#x37;&#x40;&#113;&#113;&#x2e;&#99;&#111;&#x6d;">&#x70;&#105;&#110;&#103;&#97;&#x6e;&#56;&#x37;&#x38;&#x37;&#x40;&#113;&#113;&#x2e;&#99;&#111;&#x6d;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
</tbody></table>
<p>本人自己整理的【<a target="_blank" rel="noopener" href="http://js.pingan8787.com/">Cute-JavaScript</a>】资料，包含：【ES6/ES7/ES8/ES9】，【JavaScript基础（初级/中级/高级）】以及后面会添加的【JS面试题】三个系列。<br>欢迎您的支持！   </p>
<p><strong>本章节复习的是JS中的高阶函数，可以提高我们的开发效率。</strong>           </p>
<h2 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1.介绍"></a>1.介绍</h2><p>个人简单理解为，一个函数可以接收其他函数作为参数，这种函数便称为<strong>高阶函数</strong>，而主要目的就是为了能接收其他函数作为参数。    </p>
<blockquote>
<p>Q： 为什么可以接收一个函数作为参数？<br>A： 因为函数可以接收变量作为参数，而变量可以声明一个方法。  </p>
</blockquote>
<p><strong>简单实例：</strong>  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span> (<span class="params">x</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hi &#x27;</span> + x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span> (<span class="params">a, b</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a(b);</span><br><span class="line">&#125;</span><br><span class="line">f(a, <span class="string">&#x27;leo&#x27;</span>);   <span class="comment">// &quot;hi leo&quot;</span></span><br></pre></td></tr></table></figure>
<p><strong>这段代码的意思</strong>：定义方法<code>f</code>，接收两个参数，方法<code>a</code>和变量<code>b</code>，在方法<code>a</code>中返回一段字符串，当执行方法<code>f</code>并传入参数方法<code>a</code>和参数<code>b</code>的时候，返回<code>&quot;hi leo&quot;</code>。 </p>
<p>也可以直接调用JS内置方法：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">3</span>, b = -<span class="number">2</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">my_abs</span> (<span class="params">val, fun</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> fun(val);</span><br><span class="line">&#125;</span><br><span class="line">my_abs(a, <span class="built_in">Math</span>.abs);  <span class="comment">// 3</span></span><br><span class="line">my_abs(b, <span class="built_in">Math</span>.abs);  <span class="comment">// 2 </span></span><br></pre></td></tr></table></figure>

<h2 id="2-常用高阶函数"><a href="#2-常用高阶函数" class="headerlink" title="2.常用高阶函数"></a>2.常用高阶函数</h2><h3 id="2-1-map"><a href="#2-1-map" class="headerlink" title="2.1 map()"></a>2.1 map()</h3><p><code>map()</code>方法的作用是：接收一个函数作为参数，对数组中每个元素按顺序调用一次传入的函数并返回结果，<strong>不改变原数组，返回一个新数组</strong>。<br>通常使用方式：<code>arr.map(callback())</code>，更多详细介绍可以参考 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/map">MDN  Array.map()</a>。<br><strong>参数</strong>：   </p>
<ul>
<li><code>arr</code> : 需要操作的数组；   </li>
<li><code>callback(currentValue, index, array, thisArg)</code> : 处理的方法，四个参数；  <ul>
<li><ol>
<li> <code>currentValue</code> 当前处理的元素的<strong>值</strong>  </li>
</ol>
</li>
<li><ol start="2">
<li> <code>index</code> 当前处理的元素的<strong>索引</strong>，可选  </li>
</ol>
</li>
<li><ol start="3">
<li> <code>array</code> 调用<code>map()</code>方法的<strong>数组</strong>，可选  </li>
</ol>
</li>
<li><ol start="4">
<li> <code>currentVthisArgalue</code> 执行 <code>callback</code> 函数时使用的 <code>this</code> 值，可选    </li>
</ol>
</li>
</ul>
</li>
</ul>
<p><strong>返回值</strong>：<br>返回一个处理后的新数组。   </p>
<p><strong>实例</strong>：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">3</span>, -<span class="number">5</span>];</span><br><span class="line"><span class="keyword">let</span> a1 = arr.map(<span class="built_in">Math</span>.abs);  </span><br><span class="line"><span class="comment">// a1 =&gt; [1, 3, 5];</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a2 = arr.map(<span class="built_in">String</span>);</span><br><span class="line"><span class="comment">// a2 =&gt; [&quot;1&quot;, &quot;3&quot;, &quot;-5&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a3 = arr.map(<span class="function"><span class="keyword">function</span> (<span class="params">x</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + <span class="number">1</span>;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 等价于 a3=arr.map(x =&gt; x+1)</span></span><br><span class="line"><span class="comment">// a3 =&gt; [2, 4, -4]</span></span><br></pre></td></tr></table></figure>
<p>对比 <code>for...in</code> 循环，<code>map()</code>书写起来更加简洁：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">3</span>, -<span class="number">5</span>];</span><br><span class="line"><span class="keyword">let</span> a1 = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;arr.length; i++)&#123;</span><br><span class="line">    a1.push(arr[i] + <span class="number">1</span>); </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// a1 =&gt; [2, 4, -4]</span></span><br></pre></td></tr></table></figure>
<p><code>map()</code>作为高阶函数，事实上它把运算规则抽象了。   </p>
<h3 id="2-2-reduce"><a href="#2-2-reduce" class="headerlink" title="2.2 reduce()"></a>2.2 reduce()</h3><p><code>reduce()</code>方法的作用是：接收一个函数，对数组进行累加操作，把累计结果和下一个值进行操作，最后返回最终的单个结果值。   </p>
<p>通常使用方式：<code>arr.reduce(callback(), initValue)</code>，更多详细介绍可以参考 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce">MDN  Array.reduce()</a></p>
<p><strong>参数</strong>：  </p>
<ul>
<li><code>callback(returnValue, currentValue, currentIndex, array)</code> : 累记器的方法，四个参数：  <ul>
<li><ol>
<li><code>returnValue</code> 上一次处理的返回值，或者初始值   </li>
</ol>
</li>
<li><ol start="2">
<li><code>currentValue</code> 当前处理的元素的<strong>值</strong>，可选    </li>
</ol>
</li>
<li><ol start="3">
<li><code>currentIndex</code> 当前处理的元素的<strong>索引</strong>，可选    </li>
</ol>
</li>
<li><ol start="4">
<li><code>array</code> 调用<code>reduce()</code>方法的<strong>数组</strong>，可选   </li>
</ol>
</li>
</ul>
</li>
<li><code>initValue</code> 初次调用<code>callback()</code>时候<code>returnValue</code>参数的初始值，默认数组第一个元素，可选    </li>
</ul>
<p><strong>返回值</strong>：<br>返回一个最终的累计值。   </p>
<p><strong>实例</strong>：   </p>
<ol>
<li>数组求和<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">3</span>, -<span class="number">5</span>];</span><br><span class="line"><span class="keyword">let</span> sum1 = arr.reduce(<span class="function">(<span class="params">res, cur</span>) =&gt;</span> res + cur);</span><br><span class="line"><span class="comment">// sum1 =&gt; -1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sum2 = arr.reduce(<span class="function">(<span class="params">res, cur</span>) =&gt;</span> res + cur , <span class="number">1</span>);</span><br><span class="line"><span class="comment">// sum1 =&gt; 0</span></span><br></pre></td></tr></table></figure></li>
<li>二维数组转化为一维<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">6</span>]];</span><br><span class="line"><span class="keyword">let</span> con = arr.reduce(<span class="function">(<span class="params">res, cur</span>) =&gt;</span> res.concat(cur));</span><br><span class="line"><span class="comment">// con =&gt; [1, 2, 3, 4, 5, 6]</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="2-3-filter"><a href="#2-3-filter" class="headerlink" title="2.3 filter()"></a>2.3 filter()</h3><p><code>filter()</code>方法的作用是：接收一个函数，依次作用数组每个元素，并过滤符合函数条件的元素，将剩下的数组作为一个新数组返回。   </p>
<p>通常使用方式：<code>arr.filter(callback(), thisArg)</code>，更多详细介绍可以参考 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/filter">MDN  Array.filter()</a></p>
<p><strong>参数</strong>：  </p>
<ul>
<li><code>callback(ele, index, array)</code> : 过滤条件的方法，当返回<code>true</code>则保存该元素，反之不保留，三个参数：  <ul>
<li><ol>
<li><code>ele</code> 当前处理的元素   </li>
</ol>
</li>
<li><ol start="2">
<li><code>index</code> 当前处理的元素的<strong>索引</strong>，可选    </li>
</ol>
</li>
<li><ol start="3">
<li><code>array</code> 调用<code>filter()</code>方法的<strong>数组</strong>，可选   </li>
</ol>
</li>
</ul>
</li>
<li><code>thisArg</code> 执行 <code>callback</code> 时的用于 <code>this</code> 的值，可选    </li>
</ul>
<p><strong>返回值</strong>：<br>返回一个过滤剩下的元素组成的新数组。   </p>
<p><strong>实例</strong>：   </p>
<ol>
<li>过滤奇数值    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>];</span><br><span class="line"><span class="keyword">let</span> res = arr.filter(<span class="function"><span class="params">x</span> =&gt;</span> x % <span class="number">2</span> != <span class="number">0</span>);</span><br><span class="line"><span class="comment">// res =&gt; [1, 3, 5]</span></span><br></pre></td></tr></table></figure></li>
<li>过滤不满足条件的值   <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>];</span><br><span class="line"><span class="keyword">let</span> res = arr.filter(<span class="function"><span class="params">x</span> =&gt;</span> x &gt; <span class="number">3</span>);</span><br><span class="line"><span class="comment">// res =&gt; [4, 5, 6]</span></span><br></pre></td></tr></table></figure></li>
<li>过滤空字符串    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="literal">null</span>, <span class="literal">undefined</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> tri = arr.filter(<span class="function"><span class="params">x</span> =&gt;</span> x &amp;&amp; x.trim());</span><br><span class="line"><span class="comment">// tri =&gt; [&quot;a&quot;, &quot;b&quot;]</span></span><br></pre></td></tr></table></figure>
总结下： <code>filter()</code>主要作为<strong>筛选功能</strong>，因此核心就是正确实现一个“筛选”函数。   </li>
</ol>
<h3 id="2-4-sort"><a href="#2-4-sort" class="headerlink" title="2.4 sort()"></a>2.4 sort()</h3><p><code>sort()</code>方法的作用是：接收一个函数，对数组的元素进行排序，并返回排序后的新数组。<strong>默认排序顺序是根据字符串Unicode码点</strong>。     </p>
<p>通常使用方式：<code>arr.sort(fun())</code>，更多详细介绍可以参考 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/sort">MDN  Array.sort()</a><br>compareFunction 可选<br>用来指定按某种顺序进行排列的函数。如果省略，元素按照转换为的字符串的各个字符的Unicode位点进行排序。<br><strong>参数</strong>：  </p>
<ul>
<li><code>fun(a, b)</code> : 指定按某种顺序进行排列的函数，若省略则按照转换为的字符串的各个字符的Unicode位点进行排序，两个可选参数：<br><code>fun()</code> 返回 <code>a</code>和<code>b</code>两个值的大小的比较结果，<code>sort()</code>根据返回结果进行排序：   </li>
<li>若 <code>fun(a, b)</code> 小于 0 ，则 <code>a</code> 排在 <code>b</code> 前面；  </li>
<li>若 <code>fun(a, b)</code> 等于 0 ，则 <code>a</code> <code>b</code> 位置不变；  </li>
<li>若 <code>fun(a, b)</code> 大于 0 ，则 <code>a</code> 排在 <code>b</code> 后面；  </li>
</ul>
<p><strong>返回值</strong>：<br>返回排序后的新数组，并<strong>修改原数组</strong>。    </p>
<p><strong>实例</strong>：   </p>
<ol>
<li>升序降序数组    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> sort1 = arr.sort();</span><br><span class="line"><span class="comment">// 等同于 let sort1 = arr.sort((a, b) =&gt; a - b);</span></span><br><span class="line"><span class="comment">// sort1 =&gt; [1, 2, 3, 5]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sort2 = arr.sort(<span class="function">(<span class="params">a, b</span>) =&gt;</span> b - a);</span><br><span class="line"><span class="comment">// sort2 =&gt; [5, 3, 2, 1]</span></span><br></pre></td></tr></table></figure></li>
<li>字符串排序  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr1 = [<span class="string">&#x27;AA&#x27;</span>, <span class="string">&#x27;CC&#x27;</span>, <span class="string">&#x27;BB&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> sort1 = arr1.sort();</span><br><span class="line"><span class="comment">// sort1 =&gt; [&quot;AA&quot;, &quot;BB&quot;, &quot;CC&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> arr2 = [<span class="string">&#x27;AA&#x27;</span>, <span class="string">&#x27;aa&#x27;</span>, <span class="string">&#x27;BB&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> sort2 = arr2.sort();</span><br><span class="line"><span class="comment">// sort2 =&gt; [&quot;AA&quot;, &quot;BB&quot;, &quot;aa&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> arr3 = [<span class="string">&#x27;AA&#x27;</span>, <span class="string">&#x27;aa&#x27;</span>, <span class="string">&#x27;BB&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> sort3 = arr3.sort(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a.toLowerCase() &gt; b.toLowerCase());</span><br><span class="line"><span class="comment">// sort3 =&gt; [&quot;AA&quot;, &quot;aa&quot;, &quot;BB&quot;]</span></span><br><span class="line"><span class="comment">// 也可以写成：</span></span><br><span class="line"><span class="keyword">let</span> sort3 = arr3.sort(<span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> s1 = a.toLowerCase();</span><br><span class="line">    <span class="keyword">let</span> s2 = b.toLowerCase();</span><br><span class="line">    <span class="keyword">return</span> s1 &gt; s2 ? <span class="number">1</span> : s1 &lt; s2 ? -<span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
总结下： <code>sort()</code>主要作为<strong>排序功能</strong>，因此核心就是正确实现一个“排序”函数。   </li>
</ol>
<h2 id="3-参考文章"><a href="#3-参考文章" class="headerlink" title="3. 参考文章"></a>3. 参考文章</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.liaoxuefeng.com/wiki/001434446689867b27157e896e74d51a89c25cc8b43bdb3000/001434499355829ead974e550644e2ebd9fd8bb1b0dd721000">阮一峰 JS高阶函数</a></li>
</ul>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#112;&#105;&#x6e;&#x67;&#97;&#110;&#x38;&#x37;&#x38;&#x37;&#x40;&#x71;&#x71;&#x2e;&#x63;&#x6f;&#109;">&#112;&#105;&#x6e;&#x67;&#97;&#110;&#x38;&#x37;&#x38;&#x37;&#x40;&#x71;&#x71;&#x2e;&#x63;&#x6f;&#109;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>JS小册</td>
<td>js.pingan8787.com</td>
</tr>
</tbody></table>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/01/31/138-%E3%80%90JavaScript%E3%80%91%E3%80%90%E9%87%8D%E6%B8%A9%E5%9F%BA%E7%A1%80%E3%80%9121-%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0/" data-id="ckts3ejsy002c4d9k3isz0evr" data-title="138-【JavaScript】【重温基础】21.高阶函数" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%87%8D%E6%B8%A9%E5%9F%BA%E7%A1%80/" rel="tag">重温基础</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/8/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><a class="extend next" rel="next" href="/page/10/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Angular/" rel="tag">Angular</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/" rel="tag">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS%E5%8A%A8%E7%94%BB/" rel="tag">CSS动画</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Chrome/" rel="tag">Chrome</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES6-ES7-ES8/" rel="tag">ES6/ES7/ES8</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Eslint/" rel="tag">Eslint</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Express/" rel="tag">Express</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GraphQL/" rel="tag">GraphQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/H5/" rel="tag">H5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML/" rel="tag">HTML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/" rel="tag">HTTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP%E5%8D%8F%E8%AE%AE/" rel="tag">HTTP协议</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hybrid/" rel="tag">Hybrid</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NPM/" rel="tag">NPM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nodejs/" rel="tag">Nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Numpy/" rel="tag">Numpy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/" rel="tag">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tensorflow/" rel="tag">Tensorflow</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TyeScript/" rel="tag">TyeScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TypeScript/" rel="tag">TypeScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vuejs/" rel="tag">Vuejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebSocket/" rel="tag">WebSocket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Webpack/" rel="tag">Webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/demo/" rel="tag">demo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" rel="tag">中间件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" rel="tag">人工智能</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/" rel="tag">全栈开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E6%8E%A2%E7%B4%A2/" rel="tag">前端探索</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E7%9F%A5%E4%B9%8E%E7%B3%BB%E5%88%97/" rel="tag">前端知乎系列</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B8%B8%E7%94%A8%E6%8A%80%E6%9C%AF/" rel="tag">常用技术</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BE%AE%E5%89%8D%E7%AB%AF/" rel="tag">微前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%BB%E7%BB%93/" rel="tag">总结</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/" rel="tag">构建工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" rel="tag">正则表达式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BA%90%E7%A0%81/" rel="tag">源码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BA%90%E7%A0%81%E7%B2%BE%E8%AF%BB/" rel="tag">源码精读</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%83%AD%E9%97%A8/" rel="tag">热门</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%94%9F%E6%B4%BB%E6%9D%82%E8%AE%B0/" rel="tag">生活杂记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/" rel="tag">编译原理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/" rel="tag">网络请求</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag">读书笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%87%8D%E6%B8%A9%E5%9F%BA%E7%A1%80/" rel="tag">重温基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" rel="tag">面试题</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Angular/" style="font-size: 11.88px;">Angular</a> <a href="/tags/CSS/" style="font-size: 18.13px;">CSS</a> <a href="/tags/CSS%E5%8A%A8%E7%94%BB/" style="font-size: 12.5px;">CSS动画</a> <a href="/tags/Chrome/" style="font-size: 10px;">Chrome</a> <a href="/tags/ES6-ES7-ES8/" style="font-size: 10.63px;">ES6/ES7/ES8</a> <a href="/tags/Eslint/" style="font-size: 10px;">Eslint</a> <a href="/tags/Express/" style="font-size: 10px;">Express</a> <a href="/tags/GraphQL/" style="font-size: 10px;">GraphQL</a> <a href="/tags/H5/" style="font-size: 10px;">H5</a> <a href="/tags/HTML/" style="font-size: 10px;">HTML</a> <a href="/tags/HTTP/" style="font-size: 11.88px;">HTTP</a> <a href="/tags/HTTP%E5%8D%8F%E8%AE%AE/" style="font-size: 11.25px;">HTTP协议</a> <a href="/tags/Hybrid/" style="font-size: 10.63px;">Hybrid</a> <a href="/tags/JavaScript/" style="font-size: 19.38px;">JavaScript</a> <a href="/tags/NPM/" style="font-size: 10px;">NPM</a> <a href="/tags/Nodejs/" style="font-size: 11.25px;">Nodejs</a> <a href="/tags/Numpy/" style="font-size: 10.63px;">Numpy</a> <a href="/tags/Python/" style="font-size: 17.5px;">Python</a> <a href="/tags/React/" style="font-size: 12.5px;">React</a> <a href="/tags/Tensorflow/" style="font-size: 10.63px;">Tensorflow</a> <a href="/tags/TyeScript/" style="font-size: 10px;">TyeScript</a> <a href="/tags/TypeScript/" style="font-size: 11.25px;">TypeScript</a> <a href="/tags/Vuejs/" style="font-size: 14.38px;">Vuejs</a> <a href="/tags/WebSocket/" style="font-size: 10px;">WebSocket</a> <a href="/tags/Webpack/" style="font-size: 15.63px;">Webpack</a> <a href="/tags/demo/" style="font-size: 10.63px;">demo</a> <a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 10px;">中间件</a> <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" style="font-size: 16.25px;">人工智能</a> <a href="/tags/%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/" style="font-size: 11.25px;">全栈开发</a> <a href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" style="font-size: 20px;">前端开发</a> <a href="/tags/%E5%89%8D%E7%AB%AF%E6%8E%A2%E7%B4%A2/" style="font-size: 11.25px;">前端探索</a> <a href="/tags/%E5%89%8D%E7%AB%AF%E7%9F%A5%E4%B9%8E%E7%B3%BB%E5%88%97/" style="font-size: 10.63px;">前端知乎系列</a> <a href="/tags/%E5%8E%9F%E5%88%9B/" style="font-size: 18.75px;">原创</a> <a href="/tags/%E5%B8%B8%E7%94%A8%E6%8A%80%E6%9C%AF/" style="font-size: 10.63px;">常用技术</a> <a href="/tags/%E5%BE%AE%E5%89%8D%E7%AB%AF/" style="font-size: 10px;">微前端</a> <a href="/tags/%E6%80%BB%E7%BB%93/" style="font-size: 13.75px;">总结</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 10px;">数据结构</a> <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" style="font-size: 15px;">机器学习</a> <a href="/tags/%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/" style="font-size: 10.63px;">构建工具</a> <a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 10.63px;">正则表达式</a> <a href="/tags/%E6%BA%90%E7%A0%81/" style="font-size: 10px;">源码</a> <a href="/tags/%E6%BA%90%E7%A0%81%E7%B2%BE%E8%AF%BB/" style="font-size: 10px;">源码精读</a> <a href="/tags/%E7%83%AD%E9%97%A8/" style="font-size: 10px;">热门</a> <a href="/tags/%E7%94%9F%E6%B4%BB%E6%9D%82%E8%AE%B0/" style="font-size: 10px;">生活杂记</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 13.13px;">算法</a> <a href="/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/" style="font-size: 10px;">编译原理</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/" style="font-size: 10px;">网络请求</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 15px;">设计模式</a> <a href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" style="font-size: 14.38px;">读书笔记</a> <a href="/tags/%E9%87%8D%E6%B8%A9%E5%9F%BA%E7%A1%80/" style="font-size: 16.88px;">重温基础</a> <a href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" style="font-size: 10px;">面试题</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/07/28/227-%E3%80%90%E6%80%BB%E7%BB%93%E3%80%91%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E5%9C%A8%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%BD%BF%E7%94%A8SVG%E5%AD%97%E4%BD%93%E5%9B%BE%E6%A0%87/">227-【总结】如何优雅的在微信小程序使用SVG字体图标</a>
          </li>
        
          <li>
            <a href="/2021/07/28/226-%E3%80%90HTTP%E3%80%91%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E7%AE%A1%E7%90%86HTTP%E8%AF%B7%E6%B1%82%E5%92%8C%E5%93%8D%E5%BA%94%E6%8B%A6%E6%88%AA%E5%99%A8%EF%BC%9F/">226-【HTTP】如何优雅的管理HTTP请求和响应拦截器？</a>
          </li>
        
          <li>
            <a href="/2021/07/28/225-%E3%80%90Vue%E3%80%91%E4%BB%8E%E6%89%8B%E5%86%99Vue3%E7%9A%84Reactivity%E5%BC%80%E5%A7%8B%E6%B7%B1%E5%85%A5Vue3%E6%BA%90%E7%A0%81/">225-【Vue】从手写Vue3的Reactivity开始深入Vue3源码</a>
          </li>
        
          <li>
            <a href="/2021/05/30/224-%E3%80%90Chrome%E3%80%915%E4%B8%AAChrome%E8%B0%83%E8%AF%95%E6%B7%B7%E5%90%88%E5%BA%94%E7%94%A8%E7%9A%84%E6%8A%80%E5%B7%A7/">224-【Chrome】5个Chrome调试混合应用的技巧</a>
          </li>
        
          <li>
            <a href="/2021/03/19/223-%E3%80%90%E5%89%8D%E7%AB%AF%E6%8E%A2%E7%B4%A2%E3%80%91%E6%8E%A2%E7%B4%A2Snabbdom%E6%A8%A1%E5%9D%97%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/">223-【前端探索】探索Snabbdom模块系统原理</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>