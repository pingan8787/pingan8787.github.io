<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/7/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-167-【Webpack】Webpack怎么运行" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/07/18/167-%E3%80%90Webpack%E3%80%91Webpack%E6%80%8E%E4%B9%88%E8%BF%90%E8%A1%8C/" class="article-date">
  <time class="dt-published" datetime="2019-07-18T00:10:24.000Z" itemprop="datePublished">2019-07-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/07/18/167-%E3%80%90Webpack%E3%80%91Webpack%E6%80%8E%E4%B9%88%E8%BF%90%E8%A1%8C/">167-【Webpack】Webpack怎么运行</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>原文地址：<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000019117897">《Webpack 是怎样运行的?》</a></p>
</blockquote>
<p>在平时开发中我们经常会用到 <code>Webpack </code>这个时下最流行的前端打包工具。它打包开发代码，输出能在各种浏览器运行的代码，提升了开发至发布过程的效率。</p>
<p>我们知道一份Webpack配置文件主要包含入口（ <code>entry </code>）、输出文件（ <code>output </code>）、模式、加载器（ <code>Loader </code>）、插件（ <code>Plugin </code>）等几个部分。但如果只需要组织 JS 文件的话，指定入口和输出文件路径即可完成一个迷你项目的打包。下面我们来通过一个简单的项目来看一下Webpack是怎样运行的。</p>
<h3 id="同步加载"><a href="#同步加载" class="headerlink" title="同步加载"></a>同步加载</h3><blockquote>
<p>本文使用 webpack ^4.30.0 作示例.为了更好地观察产出的文件，我们将模式设置为 development 关闭代码压缩，再开启 source-map 支持原始源代码调试。除此之外。我们还简单的写了一个插件 <code>MyPlugin </code>来去除源码中的注释。</p>
</blockquote>
<p>新建 <code>src/index.js</code>:    </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;Hello webpack!&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>新建 <code>webpack </code>配置文件 <code>webpack.config.js </code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> MyPlugin = <span class="built_in">require</span>(<span class="string">&#x27;./src/MyPlugin.js&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&#x27;source-map&#x27;</span>,</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.resolve(__dirname, <span class="string">&#x27;dist&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>:[</span><br><span class="line">    <span class="keyword">new</span> MyPlugin()</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>新建 <code>src/MyPlugin.js </code>。<a target="_blank" rel="noopener" href="https://github.com/xiangxingchen/blog/issues/18">了解webpack插件更多信息</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPlugin</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">options</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.options = options</span><br><span class="line">    <span class="built_in">this</span>.externalModules = &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">apply</span>(<span class="params">compiler</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> reg = <span class="regexp">/(&quot;([^\\\&quot;]*(\\.)?)*&quot;)|(&#x27;([^\\\&#x27;]*(\\.)?)*&#x27;)|(\/&#123;2,&#125;.*?(\r|\n))|(\/\*(\n|.)*?\*\/)|(\/\*\*\*\*\*\*\/)/g</span></span><br><span class="line">    compiler.hooks.emit.tap(<span class="string">&#x27;CodeBeautify&#x27;</span>, <span class="function">(<span class="params">compilation</span>)=&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">Object</span>.keys(compilation.assets).forEach(<span class="function">(<span class="params">data</span>)=&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> content = compilation.assets[data].source() <span class="comment">// 欲处理的文本</span></span><br><span class="line">        content = content.replace(reg, <span class="function"><span class="keyword">function</span> (<span class="params">word</span>) </span>&#123; <span class="comment">// 去除注释后的文本</span></span><br><span class="line">          <span class="keyword">return</span> <span class="regexp">/^\/&#123;2,&#125;/</span>.test(word) || <span class="regexp">/^\/\*!/</span>.test(word) || <span class="regexp">/^\/\*&#123;3,&#125;\//</span>.test(word) ? <span class="string">&quot;&quot;</span> : word;</span><br><span class="line">        &#125;);</span><br><span class="line">        compilation.assets[data] = &#123;</span><br><span class="line">          <span class="function"><span class="title">source</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> content</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="function"><span class="title">size</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> content.length</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = MyPlugin</span><br></pre></td></tr></table></figure>

<p>现在我们运行命令 <code>webpack --config webpack.config.js</code> ，打包完成后会多出一个输出目录 <code>dist</code>：<code>dist/main.js</code>。<code>main</code> 是 <code>webpack</code> 默认设置的输出文件名，我们快速瞄一眼这个文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">modules</span>)</span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)(&#123;</span><br><span class="line">  <span class="string">&quot;./src/index.js&quot;</span>: (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>整个文件只含一个立即执行函数（<code>IIFE</code>），我们称它为 <code>webpackBootstrap</code>，它仅接收一个对象 —— 未加载的 模块集合（<code>modules</code>），这个<code> modules</code> 对象的 <code>key</code> 是一个路径，<code>value</code> 是一个函数。你也许会问，这里的模块是什么？它们又是如何加载的呢？</p>
<p>在细看产出代码前，我们先丰富一下源代码：</p>
<p>新文件 <code>src/utils/math.js</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> plus = <span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>修改 <code>src/index.js</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; plus &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils/math.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;Hello webpack!&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;1 + 2: &#x27;</span>, plus(<span class="number">1</span>, <span class="number">2</span>));</span><br></pre></td></tr></table></figure>
<p>我们按照 ES 规范的模块化语法写了一个简单的模块 <code>src/utils/math.js</code>，给 <code>src/index.js</code> 引用。<code>Webpack</code> 用自己的方式支持了 <code>ES6 Module</code> 规范，前面提到的 <code>modul</code>e 就是和 <code>ES6 module</code> 对应的概念。</p>
<p>接下来我们看一下这些模块是如何通 ES5 代码实现的。再次运行命令 <code>webpack --config webpack.config.js</code> 后查看输出文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">modules</span>)</span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)(&#123;</span><br><span class="line">  <span class="string">&quot;./src/index.js&quot;</span>: (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="string">&quot;./src/utils/math.js&quot;</span>: (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><code>IIFE</code> 传入的 <code>modules</code> 对象里多了一个键值对，对应着新模块 <code>src/utils/math.js</code>，这和我们在源代码中拆分的模块互相呼应。然而，有了 <code>modules</code> 只是第一步，这份文件最终达到的效果应该是让各个模块按开发者编排的顺序运行。</p>
<h3 id="探究-webpackBootstrap"><a href="#探究-webpackBootstrap" class="headerlink" title="探究 webpackBootstrap"></a>探究 <code>webpackBootstrap</code></h3><p>接下来看看 <code>webpackBootstrap</code> 函数中有些什么：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpackBootstrap</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">modules</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 缓存 __webpack_require__ 函数加载过的模块</span></span><br><span class="line">  <span class="keyword">var</span> installedModules = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Webpack 加载函数，用来加载 webpack 定义的模块</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>moduleId 模块 ID，一般为模块的源码路径，如 &quot;./src/index.js&quot;</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns <span class="type">&#123;Object&#125;</span> </span>exports 导出对象</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__webpack_require__</span>(<span class="params">moduleId</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 在 __webpack_require__ 函数对象上挂载一些变量及函数 ...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 传入表达式的值为 &quot;./src/index.js&quot;</span></span><br><span class="line">  <span class="keyword">return</span> __webpack_require__(__webpack_require__.s = <span class="string">&quot;./src/index.js&quot;</span>);</span><br><span class="line">&#125;)(<span class="comment">/* modules */</span>);</span><br></pre></td></tr></table></figure>

<p>可以看到其实主要做了两件事：</p>
<ol>
<li>定义一个模块加载函数<code> __webpack_require__</code>。</li>
<li>使用加载函数加载入口模块 <code>&quot;./src/index.js&quot;</code>。</li>
</ol>
<p>整个 <code>webpackBootstrap</code> 中只出现了入口模块的影子，那其他模块又是如何加载的呢？我们顺着 <code>__webpack_require__(&quot;./src/index.js&quot;)</code> 细看加载函数的内部逻辑：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__webpack_require__</span>(<span class="params">moduleId</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 重复加载则利用缓存</span></span><br><span class="line">  <span class="keyword">if</span> (installedModules[moduleId]) &#123;</span><br><span class="line">    <span class="keyword">return</span> installedModules[moduleId].exports;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 如果是第一次加载，则初始化模块对象，并缓存</span></span><br><span class="line">  <span class="keyword">var</span> <span class="built_in">module</span> = installedModules[moduleId] = &#123;</span><br><span class="line">    <span class="attr">i</span>: moduleId,  <span class="comment">// 模块 ID</span></span><br><span class="line">    <span class="attr">l</span>: <span class="literal">false</span>,     <span class="comment">// 模块加载标识</span></span><br><span class="line">    <span class="attr">exports</span>: &#123;&#125;   <span class="comment">// 模块导出对象</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 执行模块</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param </span>module.exports -- 模块导出对象引用，改变模块包裹函数内部的 this 指向</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param <span class="variable">module</span></span> -- 当前模块对象引用</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param </span>module.exports -- 模块导出对象引用</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param <span class="variable">__webpack_require__</span></span> -- 用于在模块中加载其他模块</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  modules[moduleId].call(<span class="built_in">module</span>.exports, <span class="built_in">module</span>, <span class="built_in">module</span>.exports, __webpack_require__);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 模块加载标识置为已加载</span></span><br><span class="line">  <span class="built_in">module</span>.l = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 返回当前模块的导出对象引用</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">module</span>.exports;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先，加载函数使用了闭包变量 <code>installedModules</code>，用来将已加载过的模块保存在内存中。 接着是初始化模块对象，并把它挂载到缓存里。然后是模块的执行过程，加载入口文件时 <code>modules[moduleId]</code> 其实就是<code>./src/index.js</code>对应的模块函数。执行模块函数前传入了跟模块相关的几个实参，让模块可以导出内容，以及加载其他模块的导出。最后标识该模块加载完成，返回模块的导出内容。</p>
<p>根据 <code>__webpack_require__</code> 的缓存和导出逻辑，我们得知在整个 <code>IIFE</code> 运行过程中，加载已缓存的模块时，都会直接返回<code>installedModules[moduleId].exports</code>，换句话说，相同的模块只有在第一次引用的时候才会执行模块本身。</p>
<h3 id="模块执行函数"><a href="#模块执行函数" class="headerlink" title="模块执行函数"></a>模块执行函数</h3><p><code>__webpack_require__ </code>中通过 <code>modules[moduleId].call()</code> 运行了模块执行函数，下面我们就进入到<code>webpackBootstrap</code> 的参数部分，看看模块的执行函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*** 入口模块 ./src/index.js ***/</span></span><br><span class="line"><span class="string">&quot;./src/index.js&quot;</span>: (<span class="function"><span class="keyword">function</span> (<span class="params"><span class="built_in">module</span>, __webpack_exports__, __webpack_require__</span>) </span>&#123;</span><br><span class="line"><span class="meta">  &quot;use strict&quot;</span>;</span><br><span class="line"><span class="comment">// 用于区分 ES 模块和其他模块规范，不影响理解 demo，战略跳过。</span></span><br><span class="line">  __webpack_require__.r(__webpack_exports__);</span><br><span class="line">  <span class="comment">/* harmony import */</span></span><br><span class="line"> <span class="comment">// 源模块代码中，`import &#123;plus&#125; from &#x27;./utils/math.js&#x27;;` 语句被 loader 解析转化。</span></span><br><span class="line">    <span class="comment">// 加载 &quot;./src/utils/math.js&quot; 模块，</span></span><br><span class="line">  <span class="keyword">var</span> _utils_math_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(<span class="string">&quot;./src/utils/math.js&quot;</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Hello webpack!&#x27;</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;1 + 2: &#x27;</span>, <span class="built_in">Object</span>(_utils_math_js__WEBPACK_IMPORTED_MODULE_0__[<span class="string">&quot;plus&quot;</span>])(<span class="number">1</span>, <span class="number">2</span>));</span><br><span class="line">&#125;),</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;./src/utils/math.js&quot;</span>: (<span class="function"><span class="keyword">function</span> (<span class="params"><span class="built_in">module</span>, __webpack_exports__, __webpack_require__</span>) </span>&#123;</span><br><span class="line"><span class="meta">  &quot;use strict&quot;</span>;</span><br><span class="line">  __webpack_require__.r(__webpack_exports__);</span><br><span class="line">  <span class="comment">/* harmony export (binding) */</span></span><br><span class="line"><span class="comment">// 源模块代码中，`export` 语句被 loader 解析转化。</span></span><br><span class="line">  __webpack_require__.d(__webpack_exports__, <span class="string">&quot;plus&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> plus;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">const</span> plus = <span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>执行顺序是：入口模块 -&gt; 工具模块 -&gt; 入口模块。入口模块中首先就通过 <code>__webpack_require__(&quot;./src/utils/math.js&quot;)</code> 拿到了工具模块的 exports 对象。再看工具模块，ES 导出语法转化成了<code>__webpack_require__.d(__webpack_exports__, [key], [getter])</code>，而 <code>__webpack_require__.d</code> 函数的定义在 <code>webpackBootstrap</code> 内：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义 exports 对象导出的属性。</span></span><br><span class="line">  __webpack_require__.d = <span class="function"><span class="keyword">function</span> (<span class="params"><span class="built_in">exports</span>, name, getter</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果 exports （不含原型链上）没有 [name] 属性，定义该属性的 getter。</span></span><br><span class="line">    <span class="keyword">if</span> (!__webpack_require__.o(<span class="built_in">exports</span>, name)) &#123;</span><br><span class="line">      <span class="built_in">Object</span>.defineProperty(<span class="built_in">exports</span>, name, &#123;</span><br><span class="line">        <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">get</span>: getter</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 包装 Object.prototype.hasOwnProperty 函数。</span></span><br><span class="line">  __webpack_require__.o = <span class="function"><span class="keyword">function</span> (<span class="params">object, property</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.hasOwnProperty.call(object, property);</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>

<p>可见 <code>__webpack_require__.d</code> 其实就是 <code>Object.defineProperty</code> 的简单包装.<br>引用工具模块导出的变量后，入口模块再执行它剩余的部分。至此，<code>Webpack</code> 基本的模块执行过程就结束了。</p>
<p>好了，我们用流程图总结一下<code> Webpack</code> 模块的加载思路：</p>
<p><img src="http://images.pingan8787.com/20190718_articlex1.jpg" alt="图片描述"></p>
<h3 id="异步加载"><a href="#异步加载" class="headerlink" title="异步加载"></a>异步加载</h3><p>有上面的打包我们发现将不同的打包进一个 <code>main.js</code> 文件。<code>main.js</code> 会集中消耗太多网络资源，导致用户需要等待很久才可以开始与网页交互。</p>
<p>一般的解决方式是：根据需求降低首次加载文件的体积，在需要时（如切换前端路由器，交互事件回调）异步加载其他文件并使用其中的模块。</p>
<p>Webpack 推荐用 ES <code>import()</code> 规范来异步加载模块，我们根据 ES 规范修改一下入口模块的 import 方式，让其能够异步加载模块：</p>
<p><code>src/index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;Hello webpack!&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.setTimeout(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">import</span>(<span class="string">&#x27;./utils/math&#x27;</span>).then(<span class="function"><span class="params">mathUtil</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;1 + 2: &#x27;</span> + mathUtil.plus(<span class="number">1</span>, <span class="number">2</span>));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;, <span class="number">2000</span>);</span><br><span class="line">工具模块（src/utils/math.js）依然不变，在webpack 配置里，我们指定一下资源文件的公共资源路径（publicPath），后面的探索过程中会遇到。</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> MyPlugin = <span class="built_in">require</span>(<span class="string">&#x27;./src/MyPlugin.js&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&#x27;source-map&#x27;</span>,</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.resolve(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">    <span class="attr">publicPath</span>: <span class="string">&#x27;/dist/&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>:[</span><br><span class="line">    <span class="keyword">new</span> MyPlugin()</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>接着执行一下打包，可以看到除了 <code>dist/main.js</code> 外，又多了一个 <code>dist/0.js</code> <code>./src/utils/math.js</code>。模块从<code>main chunk</code> 迁移到了 <code>0 chunk</code> 中。而与 <code>demo1</code> 不同的是，<code>main chunk</code> 中添加了一些用于异步加载的代码，我们概览一下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpackBootstrap</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">modules</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 加载其他 chunk 后的回调函数</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">webpackJsonpCallback</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 用于缓存 chunk 的加载状态，0 为已加载</span></span><br><span class="line">  <span class="keyword">var</span> installedChunks = &#123;</span><br><span class="line">    <span class="string">&quot;main&quot;</span>: <span class="number">0</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 拼接 chunk 的请求地址</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">jsonpScriptSrc</span>(<span class="params">chunkId</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 同步 require 函数，内容不变</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__webpack_require__</span>(<span class="params">moduleId</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 异步加载 chunk，返回封装加载过程的 promise</span></span><br><span class="line">  __webpack_require__.e = <span class="function"><span class="keyword">function</span> <span class="title">requireEnsure</span>(<span class="params">chunkId</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// defineProperty 的包装，内容不变</span></span><br><span class="line">  __webpack_require__.d = <span class="function"><span class="keyword">function</span> (<span class="params"><span class="built_in">exports</span>, name, getter</span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 根据配置文件确定的 publicPath</span></span><br><span class="line">  __webpack_require__.p = <span class="string">&quot;/dist/&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**** JSONP 初始化 ****/</span></span><br><span class="line">  <span class="keyword">var</span> jsonpArray = <span class="built_in">window</span>[<span class="string">&quot;webpackJsonp&quot;</span>] = <span class="built_in">window</span>[<span class="string">&quot;webpackJsonp&quot;</span>] || [];</span><br><span class="line">  <span class="keyword">var</span> oldJsonpFunction = jsonpArray.push.bind(jsonpArray);</span><br><span class="line">  jsonpArray.push = webpackJsonpCallback;</span><br><span class="line">  jsonpArray = jsonpArray.slice();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);</span><br><span class="line">  <span class="keyword">var</span> parentJsonpFunction = oldJsonpFunction;</span><br><span class="line">  <span class="comment">/**** JSONP 初始化 ****/</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> __webpack_require__(__webpack_require__.s = <span class="string">&quot;./src/index.js&quot;</span>);</span><br><span class="line">&#125;)(&#123;</span><br><span class="line">  <span class="string">&quot;./src/index.js&quot;</span>: (<span class="function"><span class="keyword">function</span>(<span class="params"><span class="built_in">module</span>, <span class="built_in">exports</span>, __webpack_require__</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">document</span>.write(<span class="string">&#x27;Hello webpack!\n&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">window</span>.setTimeout(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      __webpack_require__.e(<span class="comment">/*! import() */</span> <span class="number">0</span>).then(__webpack_require__.bind(<span class="literal">null</span>, <span class="comment">/*! ./utils/math */</span> <span class="string">&quot;./src/utils/math.js&quot;</span>)).then(<span class="function"><span class="params">mathUtil</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;1 + 2: &#x27;</span> + mathUtil.plus(<span class="number">1</span>, <span class="number">2</span>));</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;, <span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>可以看到 <code>webpackBootstrap</code> 的函数体部分增加了一些内容，参数部分移除了<code>&quot;./src/utils/math.js&quot;</code>模块。跟着包裹函数的执行顺序，我们先聚焦到「<code>JSONP 初始化</code>」部分：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 存储 jsonp 的数组，首次运行为 []</span></span><br><span class="line"><span class="keyword">var</span> jsonpArray = <span class="built_in">window</span>[<span class="string">&quot;webpackJsonp&quot;</span>] = <span class="built_in">window</span>[<span class="string">&quot;webpackJsonp&quot;</span>] || [];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 保存 jsonpArray 的 push 函数，首次运行为 Array.prototype.push</span></span><br><span class="line"><span class="keyword">var</span> oldJsonpFunction = jsonpArray.push.bind(jsonpArray);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将 jsonpArray 的 push 重写为 webpackJsonpCallback （加载其他 chunk 后的回调函数）</span></span><br><span class="line">jsonpArray.push = webpackJsonpCallback;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将 jsonpArray 重置为正常数组，push 重置为 Array.prototype.push</span></span><br><span class="line">jsonpArray = jsonpArray.slice();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 由于 jsonpArray 为 []，不做任何事</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Array.prototype.push</span></span><br><span class="line"><span class="keyword">var</span> parentJsonpFunction = oldJsonpFunction;</span><br></pre></td></tr></table></figure>

<p>初始化结束后，变化就是 <code>window</code> 上挂载了一个 <code>webpackJsonp</code> 数组，它的值为<code> []</code>；此外，这个数组的 <code>push</code> 被改写为 <code>webpackJsonpCallback</code> 函数，我们在后面会提到这些准备工作的作用。</p>
<p>接着是 <code>__webpack_require__ </code>入口模块，由于 <code>__webpack_require__</code> 函数没有改变，我们继续观察入口模块执行函数有了什么变化。</p>
<p>显然，<code>import(&#39;../utils/math.js&#39;)</code> 被转化为<code>__webpack_require__.e(0).then(__webpack_require__.bind(null, &quot;./src/utils/math.js&quot;))</code>。0 是 <code>./src/utils/math.js</code> 所在 <code>chunk</code> 的<code>id</code>，「同步加载模块」的逻辑拆分成了「先加载 <code>chunk</code>，完成后再加载模块」。</p>
<p>我们翻到 <code>__webpack_require__.e </code>的定义位置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">__webpack_require__.e = <span class="function"><span class="keyword">function</span> <span class="title">requireEnsure</span>(<span class="params">chunkId</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> promises = [];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// installedChunks 是在 webpackBootstrap 中维护的 chunk 缓存</span></span><br><span class="line">  <span class="keyword">var</span> installedChunkData = installedChunks[chunkId];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// chunk 未加载</span></span><br><span class="line">  <span class="keyword">if</span>(installedChunkData !== <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// installedChunkData 为 promise 表示 chunk 加载中</span></span><br><span class="line">    <span class="keyword">if</span>(installedChunkData) &#123;</span><br><span class="line">      promises.push(installedChunkData[<span class="number">2</span>]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">/*** 首次加载 chunk: ***/</span></span><br><span class="line">      <span class="comment">// 初始化 promise 对象</span></span><br><span class="line">      <span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">        installedChunkData = installedChunks[chunkId] = [resolve, reject];</span><br><span class="line">      &#125;);</span><br><span class="line">      promises.push(installedChunkData[<span class="number">2</span>] = promise);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 创建 script 标签加载 chunk</span></span><br><span class="line">      <span class="keyword">var</span> head = <span class="built_in">document</span>.getElementsByTagName(<span class="string">&#x27;head&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">      <span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">&#x27;script&#x27;</span>);</span><br><span class="line">      <span class="keyword">var</span> onScriptComplete;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ... 省略一些 script 属性设置</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// src 根据 publicPath 和 chunkId 拼接</span></span><br><span class="line">      script.src = jsonpScriptSrc(chunkId);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 加载结束回调函数，处理 script 加载完成、加载超时、加载失败的情况</span></span><br><span class="line">      onScriptComplete = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">        script.onerror = script.onload = <span class="literal">null</span>; <span class="comment">// 避免 IE 内存泄漏问题</span></span><br><span class="line">        <span class="built_in">clearTimeout</span>(timeout);</span><br><span class="line">        <span class="keyword">var</span> chunk = installedChunks[chunkId];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 处理 script 加载完成，但 chunk 没有加载完成的情况</span></span><br><span class="line">        <span class="keyword">if</span>(chunk !== <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="comment">// chunk 加载中</span></span><br><span class="line">          <span class="keyword">if</span>(chunk) &#123;</span><br><span class="line">            <span class="keyword">var</span> errorType = event &amp;&amp; (event.type === <span class="string">&#x27;load&#x27;</span> ? <span class="string">&#x27;missing&#x27;</span> : event.type);</span><br><span class="line">            <span class="keyword">var</span> realSrc = event &amp;&amp; event.target &amp;&amp; event.target.src;</span><br><span class="line">            <span class="keyword">var</span> error = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;Loading chunk &#x27;</span> + chunkId + <span class="string">&#x27; failed.\n(&#x27;</span> + errorType + <span class="string">&#x27;: &#x27;</span> + realSrc + <span class="string">&#x27;)&#x27;</span>);</span><br><span class="line">            error.type = errorType;</span><br><span class="line">            error.request = realSrc;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// reject(error)</span></span><br><span class="line">            chunk[<span class="number">1</span>](error);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 统一将没有加载的 chunk 标记为未加载</span></span><br><span class="line">          installedChunks[chunkId] = <span class="literal">undefined</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 设置 12 秒超时时间</span></span><br><span class="line">      <span class="keyword">var</span> timeout = <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        onScriptComplete(&#123; <span class="attr">type</span>: <span class="string">&#x27;timeout&#x27;</span>, <span class="attr">target</span>: script &#125;);</span><br><span class="line">      &#125;, <span class="number">120000</span>);</span><br><span class="line"></span><br><span class="line">      script.onerror = script.onload = onScriptComplete;</span><br><span class="line">      head.appendChild(script);</span><br><span class="line"></span><br><span class="line">      <span class="comment">/*** 首次加载 chunk ***/</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.all(promises);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>看起来有点长，我们一步步剖析，先从第一行和最后一行来看，整个函数将异步加载的过程封装到了 <code>promise</code> 中，最终导出。</p>
<p>接着从第二行开始，<code>installedChunkData</code> 从缓存中取值，显然首次加载 <code>chunk</code> 时此处是 <code>undefined</code>。接下来，<code>installedChunkData</code> 的 <code>undefined</code> 值触发了第一层 <code>if</code> 语句的判断条件。紧接着进行到第二层 <code>if</code> 语句，此时根据判断条件走入 <code>else </code>块，这里 <code>if</code> 块里的内容我们先战略跳过，<code>else </code>里主要有两块内容，一是 <code>chunk</code> 脚本加载过程，这个过程创建了一个 <code>script</code> 标签，使其请求 <code>chunk</code>所在地址并执行<code> chunk</code> 内容；二是初始化 <code>promise</code> ，并用 <code>promis</code> 控制 <code>chunk</code> 文件加载过程。</p>
<p>不过，我们只在这段 <code>else</code> 代码块中找到了 <code>reject</code> 的使用处，也就是在 chunk 加载异常时<code> chunk[1](error)</code> 的地方，但并没发现更重要的 <code>resolve </code>的使用地点，仅仅是把 <code>resolve</code> 挂在了缓存上（<code>installedChunks[chunkId] = [resolve, reject]</code>）。</p>
<p>这里的 <code>chunk</code> 文件加载下来会发生什么呢？让我们打开<code>dist/0.js </code>一探究竟：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">(<span class="built_in">window</span>[<span class="string">&quot;webpackJsonp&quot;</span>] = <span class="built_in">window</span>[<span class="string">&quot;webpackJsonp&quot;</span>] || []).push([[<span class="number">0</span>], &#123;</span><br><span class="line">  <span class="string">&quot;./src/utils/math.js&quot;</span>:</span><br><span class="line">    (<span class="function"><span class="keyword">function</span> (<span class="params"><span class="built_in">module</span>, __webpack_exports__, __webpack_require__</span>) </span>&#123;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">      &quot;use strict&quot;</span>;</span><br><span class="line">      __webpack_require__.r(__webpack_exports__);</span><br><span class="line">      <span class="comment">/* harmony export (binding) */</span></span><br><span class="line">      __webpack_require__.d(__webpack_exports__, <span class="string">&quot;plus&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> plus;</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">const</span> plus = <span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">&#125;]);</span><br></pre></td></tr></table></figure>
<p>我们发现了：</p>
<ol>
<li>久违的 <code>./src/utils/math.js</code> 模块</li>
<li><code>window[&quot;webpackJsonp&quot;]</code> 数组的使用地点</li>
</ol>
<p>这段代码开始执行，把异步加载相关的 <code>chunk id</code> 与模块传给<code> push</code> 函数。而前面已经提到过，<code>window[&quot;webpackJsonp&quot;] </code>数组的 <code>push</code> 函数已被重写为 <code>webpackJsonpCallback</code> 函数，它的定义位置在 <code>webpackBootstrap</code> 中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">webpackJsonpCallback</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> chunkIds = data[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">var</span> moreModules = data[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// then flag all &quot;chunkIds&quot; as loaded and fire callback</span></span><br><span class="line">  <span class="keyword">var</span> moduleId, chunkId, i = <span class="number">0</span>, resolves = [];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 将 chunk 标记为已加载</span></span><br><span class="line">  <span class="keyword">for</span>(;i &lt; chunkIds.length; i++) &#123;</span><br><span class="line">    chunkId = chunkIds[i];</span><br><span class="line">    <span class="keyword">if</span>(installedChunks[chunkId]) &#123;</span><br><span class="line">      resolves.push(installedChunks[chunkId][<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    installedChunks[chunkId] = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 把 &quot;moreModules&quot; 加到 webpackBootstrap 中的 modules 闭包变量中。</span></span><br><span class="line">  <span class="keyword">for</span>(moduleId <span class="keyword">in</span> moreModules) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">Object</span>.prototype.hasOwnProperty.call(moreModules, moduleId)) &#123;</span><br><span class="line">      modules[moduleId] = moreModules[moduleId];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// parentJsonpFunction 是 window[&quot;webpackJsonp&quot;] 的原生 push</span></span><br><span class="line">  <span class="comment">// 将 data 加入全局数组，缓存 chunk 内容</span></span><br><span class="line">  <span class="keyword">if</span>(parentJsonpFunction) parentJsonpFunction(data);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 执行 resolve 后，加载 chunk 的 promise 状态变为 resolved，then 内的函数开始执行。</span></span><br><span class="line">  <span class="keyword">while</span>(resolves.length) &#123;</span><br><span class="line">    resolves.shift()();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>走进这个函数中，意味着异步加载的 <code>chunk</code> 内容已经拿到，这个时候我们要完成两件事，一是让依赖这次异步加载结果的模块继续执行，二是缓存加载结果。</p>
<p>关于第一点，我们回忆一下之前 <code>__webpack_require__.e</code> 的内容，此时 <code>chunk</code> 还处于「加载中」的状态，也就是说对应的 <code>installedChunks[chunkId]</code> 的值此时为<code> [resolve, reject, promise]</code>。 而这里，<code>chunk</code> 已经加载，但 <code>promise</code> 还未决议，于是 <code>webpackJsonpCallback</code> 内部定义了一个 <code>resolves</code> 变量用来收集 <code>installedChunks</code> 上的 <code>resolve</code> 并执行它。`</p>
<p>接下来说到第二点，就要涉及几个层面的缓存了。</p>
<p>首先是 <code>chunk</code> 层面，这里有两个相关操作，操作一将 <code>installedChunks[chunkId]</code> 置为 0 可以让 <code>__webpack_require__.e </code>在第二次加载同一 <code>chunk</code> 时返回一个立即决议的 <code>promise</code>（<code>Promise.all([])</code>）；操作二将 <code>chunk data</code> 添加进 <code>window[&quot;webpackJsonp&quot;]</code> 数组，可以在多入口模式时，方便地拿到已加载过的 <code>chunk</code> 缓存。通过以下代码实现：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*** 缓存执行部分 ***/</span></span><br><span class="line"><span class="keyword">var</span> jsonpArray = <span class="built_in">window</span>[<span class="string">&quot;webpackJsonp&quot;</span>] = <span class="built_in">window</span>[<span class="string">&quot;webpackJsonp&quot;</span>] || [];</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);</span><br><span class="line"><span class="keyword">var</span> parentJsonpFunction = oldJsonpFunction;</span><br><span class="line"><span class="comment">/*** 缓存执行部分 ***/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*** 缓存添加部分 ***/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">webpackJsonpCallback</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">    <span class="comment">// 此处的 parentJsonpFunction 是 window[&quot;webpackJsonp&quot;] 数组的原生 push</span></span><br><span class="line">    <span class="keyword">if</span> (parentJsonpFunction) parentJsonpFunction(data);</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*** 缓存添加部分 ***/</span></span><br></pre></td></tr></table></figure>
<p>而在 <code>modules</code> 层面，<code>chunk</code> 中的 <code>moreModule</code>s 被合入入口文件的<code> modules</code> 中，可供下一个微任务中的 <code>__webpack_require__</code> 同步加载模块。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(&#123;</span><br><span class="line"></span><br><span class="line">  <span class="string">&quot;./src/index.js&quot;</span>:</span><br><span class="line">    (<span class="function"><span class="keyword">function</span> (<span class="params"><span class="built_in">module</span>, <span class="built_in">exports</span>, __webpack_require__</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;Hello webpack!&#x27;</span>);</span><br><span class="line">      <span class="built_in">window</span>.setTimeout(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        __webpack_require__.e(<span class="number">0</span>).then(__webpack_require__.bind(<span class="literal">null</span>, <span class="string">&quot;./src/utils/math.js&quot;</span>)).then(<span class="function"><span class="params">mathUtil</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">&#x27;1 + 2: &#x27;</span> + mathUtil.plus(<span class="number">1</span>, <span class="number">2</span>));</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;, <span class="number">2000</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><code>__webpack_require__.e(0) </code>返回的 <code>promise</code> 决议后，<code>__webpack_require__.bind(null, &quot;./src/utils/math.js&quot;)</code> 可以加载到<code>chunk</code>携带的模块，并返回模块作为下一个微任务函数的入参，接下来就是 <code>Webpack Loader</code> 翻译过的其他业务代码了。</p>
<p>现在让我们把异步流程梳理一下：</p>
<p><img src="http://images.pingan8787.com/20190718_articlex2.jpg" alt="图片描述"></p>
<p><img src="http://images.pingan8787.com/2019_07_12guild_page.png" alt="2019_07_12guild_page"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/07/18/167-%E3%80%90Webpack%E3%80%91Webpack%E6%80%8E%E4%B9%88%E8%BF%90%E8%A1%8C/" data-id="ckts3ejy800m74d9khpyx1281" data-title="167-【Webpack】Webpack怎么运行" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Webpack/" rel="tag">Webpack</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-166-【Hybrid】HybirdApp应用开发中9个必备知识点复习（WebView-调试等）" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/07/13/166-%E3%80%90Hybrid%E3%80%91HybirdApp%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E4%B8%AD9%E4%B8%AA%E5%BF%85%E5%A4%87%E7%9F%A5%E8%AF%86%E7%82%B9%E5%A4%8D%E4%B9%A0%EF%BC%88WebView-%E8%B0%83%E8%AF%95%E7%AD%89%EF%BC%89/" class="article-date">
  <time class="dt-published" datetime="2019-07-13T02:19:54.000Z" itemprop="datePublished">2019-07-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/07/13/166-%E3%80%90Hybrid%E3%80%91HybirdApp%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E4%B8%AD9%E4%B8%AA%E5%BF%85%E5%A4%87%E7%9F%A5%E8%AF%86%E7%82%B9%E5%A4%8D%E4%B9%A0%EF%BC%88WebView-%E8%B0%83%E8%AF%95%E7%AD%89%EF%BC%89/">166-【Hybrid】HybirdApp应用开发中9个必备知识点复习（WebView/调试等）</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <hr>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#x70;&#x69;&#110;&#103;&#x61;&#x6e;&#x38;&#x37;&#56;&#55;&#64;&#113;&#113;&#x2e;&#99;&#111;&#x6d;">&#x70;&#x69;&#110;&#103;&#x61;&#x6e;&#x38;&#x37;&#56;&#55;&#64;&#113;&#113;&#x2e;&#99;&#111;&#x6d;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>微信公众号</td>
<td>前端自习课</td>
</tr>
<tr>
<td><img src="http://images.pingan8787.com/Hybrid%E5%B0%81%E9%9D%A22.png" alt="bg"></td>
<td></td>
</tr>
</tbody></table>
<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>我们大前端团队内部 📖<strong>每周一练</strong> 的知识复习计划继续加油，本篇文章是 <strong>《Hybrid APP 混合应用专题》</strong> 主题的第二期和第三期的合集。  </p>
<p>这一期共整理了 10 个问题，和相应的参考答案，文字和图片较多，<strong>建议大家可以收藏，根据文章目录来阅读</strong>。</p>
<p>之前分享的每周内容，我都整理到掘金收藏集 <a target="_blank" rel="noopener" href="https://juejin.im/collection/5cd11b0af265da0346227e24">📔《EFT每周一练》</a> 上啦，欢迎点赞收藏咯💕💕。  </p>
<p><strong>内容回顾：</strong></p>
<ol>
<li><p><a target="_blank" rel="noopener" href="https://juejin.im/post/5d125306e51d45773e418aab">《EFT 每周分享 —— Hybrid App 应用开发中 5 个必备知识点复习》</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://juejin.im/post/5d0de954e51d4556be5b3a6f">《EFT 每周分享 —— HTTP 的15个常见知识点复习》</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://juejin.im/collection/5cd11b0af265da0346227e24">《EFT 每周分享 —— 数据结构与算法合集》</a></p>
</li>
</ol>
<p><strong>文章收录：</strong> </p>
<p>本系列所有文章，都将收录在 Github 上，<a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo-EveryWeek">欢迎点击查阅</a>。   </p>
<blockquote>
<p>注：本文整理部分资料来源网络，有些图片/段落找不到原文出处，如有侵权，联系删除。</p>
</blockquote>
<h3 id="一、iOS-平台中-UIWebView-与-WKWebView-有什么区别？"><a href="#一、iOS-平台中-UIWebView-与-WKWebView-有什么区别？" class="headerlink" title="一、iOS 平台中 UIWebView 与 WKWebView 有什么区别？"></a>一、iOS 平台中 UIWebView 与 WKWebView 有什么区别？</h3><blockquote>
<p>参考文章：<a target="_blank" rel="noopener" href="http://www.cocoachina.com/articles/17337">《UIWebView与WKWebView》</a></p>
</blockquote>
<p><code>UIWebView</code> 是苹果继承于 <code>UIView</code> 封装的一个加载 web 内容的类,它可以加载任何远端的web数据展示在你的页面上，你可以像浏览器一样前进后退刷新等操作。不过苹果在 iOS8 以后推出了 <code>WKWebView</code> 来加载 Web，并应用于 iOS 和 OSX 中，它取代了 <code>UIWebView</code> 和 <code>WebView</code> ，在两个平台上支持同一套 API。</p>
<p>它脱离于 <code>UIWebView</code> 的设计，将原本的设计拆分成14个类，和3个代理协议，虽然是这样但是了解之后其实用法比较简单，依照职责单一的原则，每个协议做的事情根据功能分类。</p>
<p><img src="http://cdn.cocimg.com/ueditor/upload/image/20160810/1470807807124957.png" alt="UIWebView"></p>
<p><code>WKWebView</code> 与 <code>UIWebView</code> 的区别：  </p>
<ul>
<li><p><code>WKWebView</code> 的内存远远没有 <code>UIWebView</code> 的开销大,而且没有缓存；</p>
</li>
<li><p><code>WKWebView</code> 拥有高达 60FPS 滚动刷新率及内置手势；</p>
</li>
<li><p><code>WKWebView</code> 支持了更多的 HTML5 特性；</p>
</li>
<li><p><code>WKWebView</code> 高效的 app 和 web 信息交换通道；</p>
</li>
<li><p><code>WKWebView</code> 允许 <code>JavaScript</code> 的 <code>Nitro</code> 库加载并使用, <code>UIWebView</code> 中限制了；</p>
</li>
<li><p><code>WKWebView</code> 目前缺少关于页码相关的 API；</p>
</li>
<li><p><code>WKWebView</code> 提供加载网页进度的属性；</p>
</li>
<li><p><code>WKWebView</code> 使用 Safari 相同的 JavaScript 引擎；  </p>
</li>
<li><p><code>WKWebView</code> 增加加载进度属性： <code>estimatedProgress</code> ；</p>
</li>
<li><p><code>WKWebView</code> 不支持页面缓存，需要自己注入 <code>cookie</code> , 而 <code>UIWebView</code> 是自动注入 <code>cookie</code> ；</p>
</li>
<li><p><code>WKWebView</code> 无法发送 <code>POST</code> 参数问题；</p>
</li>
<li><p><code>WKWebView</code> 可以和js直接互调函数，不像 <code>UIWebView</code> 需要第三方库 <code>WebViewJavascriptBridge</code> 来协助处理和 js 的交互；</p>
</li>
</ul>
<p><strong>注意：</strong></p>
<p>大多数App需要支持 <code>iOS7</code> 以上的版本，而 <code>WKWebView</code> 只在 <code>iOS8</code> 后才能用，所以需要一个兼容性方案，既 <code>iOS7</code> 下用 <code>UIWebView</code> ，<code>iOS8</code> 后用 <code>WKWebView</code> 。但是目前 <code>IOS10</code> 以下的系统以及很少了，</p>
<p><strong>小结：</strong>   </p>
<p><code>WKWebView</code> 相较于 <code>UIWebView</code> 在整体上有较大的提升，满足 iOS 上面使用同一套控件的功能，同时对整个内存的开销以及滚动刷新率和 JS 交互做了优化的处理。</p>
<p>依据<strong>职责单一原则</strong>，拆分成了三个协议去实现 <code>WebView</code> 的响应，解耦了 JS 交互和加载进度的响应处理。 </p>
<p><code>WKWebView</code> 没有做缓存处理,所以<strong>对网页需要缓存的加载性能要求没那么高</strong>的还是可以考虑 <code>UIWebView</code> 。</p>
<h3 id="二、WKWebView-有哪一些坑？"><a href="#二、WKWebView-有哪一些坑？" class="headerlink" title="二、WKWebView 有哪一些坑？"></a>二、WKWebView 有哪一些坑？</h3><blockquote>
<p>参考文章：<a target="_blank" rel="noopener" href="https://kknews.cc/tech/x2rzg3g.html">《WKWebView 那些坑》</a></p>
</blockquote>
<h4 id="1-WKWebView-白屏问题"><a href="#1-WKWebView-白屏问题" class="headerlink" title="1. WKWebView 白屏问题"></a>1. WKWebView 白屏问题</h4><p><code>WKWebView</code> 实际上是个多进程组件，这也是它加载速度更快，内存暂用更低的原因。</p>
<p>在 <code>UIWebView</code> 上当内存占用太大的时候，App Process 会 crash；而在 <code>WKWebView</code> 上当总体的内存占用比较大的时候，WebContent Process 会 crash，从而出现白屏现象。</p>
<p><strong>解决办法：</strong></p>
<ol>
<li><strong>借助 WKNavigtionDelegate</strong>  </li>
</ol>
<p>当 <code>WKWebView</code> 总体内存占用过大，页面即将白屏的时候，系统会调用上面的回调函数，我们在该函数里执行<code>[webView reload]</code>(这个时候 <code>webView.URL</code> 取值尚不为<code> nil</code>）解决白屏问题。在一些高内存消耗的页面可能会频繁刷新当前页面，H5侧也要做相应的适配操作。</p>
<ol start="2">
<li><strong>检测 webView.title 是否为空</strong></li>
</ol>
<p>并不是所有 H5 页面白屏的时候都会调用上面的回调函数，比如，最近遇到在一个高内存消耗的 H5 页面上 present 系统相机，拍照完毕后返回原来页面的时候出现白屏现象（拍照过程消耗了大量内存，导致内存紧张，WebContent Process 被系统挂起），但上面的回调函数并没有被调用。在 <code>WKWebView</code> 白屏的时候，另一种现象是 <code>webView.titile</code> 会被置空, 因此，可以在 <code>viewWillAppear</code> 的时候检测 <code>webView.title</code> 是否为空来 <code>reload</code> 页面。</p>
<h4 id="2-WKWebView-Cookie-问题"><a href="#2-WKWebView-Cookie-问题" class="headerlink" title="2. WKWebView Cookie 问题"></a>2. WKWebView Cookie 问题</h4><p><code>WKWebView</code> <code>Cookie</code> 问题在于 <code>WKWebView</code> 发起的请求不会自动带上存储于 <code>NSHTTPCookieStorage</code> 容器中的 <code>Cookie</code>，而在 <code>UIWebView</code> 会自动带上 <code>Cookie</code>。  </p>
<p><strong>原因是：</strong>   </p>
<p><code>WKWebView</code> 拥有自己的私有存储，不会将 <code>Cookie</code> 存入到标准的 <code>Cookie</code> 容器<code>NSHTTPCookieStorage</code> 中。</p>
<p>实践发现 <code>WKWebView</code> 实例其实也会将 <code>Cookie</code> 存储于 <code>NSHTTPCookieStorage</code> 中，但存储时机有延迟，在 <code>iOS 8 </code>上，当页面跳转的时候，当前页面的 <code>Cookie</code> 会写入 <code>NSHTTPCookieStorage</code> 中，而在 <code>iOS 10</code> 上，JS 执行 <code>document.cookie</code> 或服务器 <code>set-cookie</code> 注入的 <code>Cookie</code> 会很快同步到 <code>NSHTTPCookieStorage</code> 中，FireFox 工程师曾建议通过 <code>reset WKProcessPool</code> 来触发 <code>Cookie</code> 同步到 <code>NSHTTPCookieStorage</code> 中，实践发现不起作用，并可能会引发当前页面 <code>session cookie </code>丢失等问题。</p>
<p><strong>解决办法1：</strong>  </p>
<p><code>WKWebView loadRequest</code> 前，在 <code>request header</code> 中设置 <code>Cookie</code>, 解决首个请求 <code>Cookie</code> 带不上的问题；</p>
<p><strong>解决办法2：</strong>  </p>
<p>通过 <code>document.cookie</code> 设置 <code>Cookie</code> 解决后续页面(同域)<code>Ajax``、iframe</code> 请求的 <code>Cookie</code> 问题；(注意：<code>document.cookie()</code> 无法跨域设置 <code>cookie</code>)。</p>
<h4 id="3-WKWebView-loadRequest-问题"><a href="#3-WKWebView-loadRequest-问题" class="headerlink" title="3. WKWebView loadRequest 问题"></a>3. WKWebView loadRequest 问题</h4><p>在 <code>WKWebView</code> 上通过 <code>loadRequest</code> 发起的 <code>post</code> 请求 <code>body</code> 数据会丢失，同样是由于<strong>进程间通信性能问题</strong>， <code>HTTPBody</code> 字段被丢弃。</p>
<h4 id="4-WKWebView-NSURLProtocol问题"><a href="#4-WKWebView-NSURLProtocol问题" class="headerlink" title="4. WKWebView NSURLProtocol问题"></a>4. WKWebView NSURLProtocol问题</h4><p><code>WKWebView</code> 在独立于 app 进程之外的进程中执行网络请求，请求数据不经过主进程，因此，在 <code>WKWebView</code> 上直接使用 <code>NSURLProtocol</code> 无法拦截请求。</p>
<p><strong>解决办法：</strong>  </p>
<p>由于 <code>WKWebView</code> 在独立进程里执行网络请求。一旦注册 <code>http(s) scheme</code> 后，网络请求将从 <code>Network Process</code> 发送到 <code>App Process</code>，这样 <code>NSURLProtocol</code> 才能拦截网络请求。在 <code>webkit2</code> 的设计里使用 <code>MessageQueue</code> 进行进程之间的通信，Network Process 会将请求 <code>encode</code> 成一个 <code>Message</code>,然后通过 IPC 发送给<code> App Process</code>。出于性能的原因，<code>encode</code> 的时候 <code>HTTPBody</code> 和 <code>HTTPBodyStream</code> 这两个字段会被丢弃掉了。</p>
<h4 id="5-WKWebView-页面样式问题"><a href="#5-WKWebView-页面样式问题" class="headerlink" title="5. WKWebView 页面样式问题"></a>5. WKWebView 页面样式问题</h4><p>在 <code>WKWebView</code> 适配过程中，我们发现部分 H5 页面元素位置向下偏移或被拉伸变形，追踪后发现主要是 H5 页面高度值异常导致。</p>
<p><strong>解决办法：</strong>  </p>
<p>调整 <code>WKWebView</code> 布局方式，避免调整<code> webView.scrollView.contentInset</code> 。实际上，即便在  <code>UIWebView</code>  上也不建议直接调整 <code>webView.scrollView.contentInset</code> 的值，这确实会带来一些奇怪的问题。如果某些特殊情况下非得调整 <code>contentInset</code> 不可的话，可以通过下面方式让H5页面恢复正常显示。</p>
<h4 id="6-WKWebView-截屏问题"><a href="#6-WKWebView-截屏问题" class="headerlink" title="6. WKWebView 截屏问题"></a>6. WKWebView 截屏问题</h4><p>WKWebView 下通过 -[CALayer renderInContext:]实现截屏的方式失效，需要通过以下方式实现截屏功能：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@implementation UIView (ImageSnapshot) </span><br><span class="line">- (UIImage*)imageSnapshot &#123; </span><br><span class="line">    UIGraphicsBeginImageContextWithOptions(self.bounds.size,YES,self.contentScaleFactor);</span><br><span class="line">    [self drawViewHierarchyInRect:self.bounds afterScreenUpdates:YES]; </span><br><span class="line">    UIImage* newImage = UIGraphicsGetImageFromCurrentImageContext(); </span><br><span class="line">    UIGraphicsEndImageContext(); </span><br><span class="line">    return newImage; </span><br><span class="line">&#125; </span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<p>然而这种方式依然解决不了 <code>webGL</code> 页面的截屏问题，截屏结果不是空白就是纯黑图片。  </p>
<p><strong>解决办法：</strong>  </p>
<p>无奈之下，我们只能约定一个JS接口，让游戏开发商实现该接口，具体是通过 <code>canvas</code> <code>getImageData()</code>方法取得图片数据后返回 <code>base64</code> 格式的数据，客户端在需要截图的时候，调用这个JS接口获取<code>base64 String</code>并转换成 <code>UIImage</code>。</p>
<h4 id="7-WKWebView-crash问题"><a href="#7-WKWebView-crash问题" class="headerlink" title="7. WKWebView crash问题"></a>7. WKWebView crash问题</h4><p>如果 <code>WKWebView</code> 退出的时候，JS刚好执行了 <code>window.alert()</code>,  alert 框可能弹不出来，<code>completionHandler</code> 最后没有被执行，导致<code> crash</code>；</p>
<p>另一种情况是在 <code>WKWebView</code> 一打开，JS就执行 <code>window.alert()</code>，这个时候由于 <code>WKWebView</code> 所在的 <code>UIViewController</code> 出现（ <code>push</code> 或 <code>present</code> ）的动画尚未结束，alert 框可能弹不出来，<code>completionHandler </code>最后没有被执行，导致 <code>crash</code>。   </p>
<h4 id="8-视频自动播放"><a href="#8-视频自动播放" class="headerlink" title="8. 视频自动播放"></a>8. 视频自动播放</h4><p><code>WKWebView</code> 需要通过 <code>WKWebViewConfiguration.mediaPlaybackRequiresUserAction</code> 设置是否允许自动播放，但一定要在 <code>WKWebView</code> 初始化之前设置，在 <code>WKWebView</code> 初始化之后设置无效。</p>
<h4 id="9-goBack-API问题"><a href="#9-goBack-API问题" class="headerlink" title="9. goBack API问题"></a>9. goBack API问题</h4><p><code>WKWebView</code> 上调用 <code>-[WKWebView goBack]</code>, 回退到上一个页面后不会触发<code>window.onload()</code> 函数、不会执行JS。</p>
<h4 id="10-页面滚动速率"><a href="#10-页面滚动速率" class="headerlink" title="10. 页面滚动速率"></a>10. 页面滚动速率</h4><p><code>WKWebView</code> 需要通过 <code>scrollView delegate</code> 调整滚动速率：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (void)scrollViewWillBeginDragging:(UIScrollView *)scrollView &#123;</span><br><span class="line">    scrollView.decelerationRate = UIScrollViewDecelerationRateNormal; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="三、Crosswalk-是什么，它有什么作用？"><a href="#三、Crosswalk-是什么，它有什么作用？" class="headerlink" title="三、Crosswalk 是什么，它有什么作用？"></a>三、Crosswalk 是什么，它有什么作用？</h3><blockquote>
<p>参考网站： <a target="_blank" rel="noopener" href="https://crosswalk-project.org/">《Crosswalk Github》</a><br>参考文章： <a target="_blank" rel="noopener" href="https://www.mobibrw.com/2015/1934">《Crosswalk入门》</a></p>
</blockquote>
<p><strong>Crosswalk</strong> 是一款开源的 web 引擎。目前 <strong>Crosswalk</strong> 正式支持的移动操作系统包括 Android 和 Tizen ，在 Android 4.0 及以上的系统中使用 <strong>Crosswalk</strong> 的 Web 应用程序在 HTML5 方面可以有一致的体验，<strong>同时和系统的整合交互方面（比如启动画面、权限管理、应用切换、社交分享等等）可以做到类似原生应用</strong>。</p>
<p>现在 <strong>Crosswalk</strong> 已经成为众多知名 HTML5 平台和应用的推荐引擎，包括 Google Mobile Chrome App 、 Intel XDK 、 Famo.us 和 Construct2 等等，未来的 Cordova 4.0 也计划集成 <strong>Crosswalk</strong> 。</p>
<h3 id="四、常见的-WebView-性能优化方案有哪一些？"><a href="#四、常见的-WebView-性能优化方案有哪一些？" class="headerlink" title="四、常见的 WebView 性能优化方案有哪一些？"></a>四、常见的 WebView 性能优化方案有哪一些？</h3><h4 id="0-问题分析"><a href="#0-问题分析" class="headerlink" title="0. 问题分析"></a>0. 问题分析</h4><p>首先需要了解，对于一个普通用户来讲，打开一个 WebView 通常会经历哪几个阶段，一般有这些：</p>
<ol>
<li><p>交互无反馈;</p>
</li>
<li><p>到达新的页面，页面白屏;</p>
</li>
<li><p>页面基本框架出现，但是没有数据；页面处于loading状态;</p>
</li>
<li><p>出现所需的数据;</p>
</li>
</ol>
<p><img src="http://images.pingan8787.com/20190712Hybrid01.jpeg" alt="webview1">   </p>
<p>当 App 首次打开时，默认是并不初始化浏览器内核的；只有当创建 <code>WebView</code> 实例的时候，才会创建 <code>WebView</code> 的基础框架。</p>
<p>所以与浏览器不同，App 中打开 <code>WebView</code> 的第一步并不是建立连接，而是启动浏览器内核。</p>
<p>于是我们找到了“<strong>为什么WebView总是很慢</strong>”的原因之一：</p>
<ul>
<li><p>在浏览器中，我们输入地址时（甚至在之前），浏览器就可以开始加载页面。</p>
</li>
<li><p>而在客户端中，客户端需要先花费时间初始化 <code>WebView</code> 完成后，才开始加载。</p>
</li>
</ul>
<p>而这段时间，由于WebView还不存在，所有后续的过程是完全阻塞的。因此由于这段过程发生在 native 的代码中，单纯靠前端代码是无法优化的；大部分的方案都是前端和客户端协作完成，以下是几个业界采用过的方案：   </p>
<h4 id="1-全局-WebView"><a href="#1-全局-WebView" class="headerlink" title="1. 全局 WebView"></a>1. 全局 WebView</h4><p>在客户端刚启动时，就初始化一个全局的 <code>WebView</code> 待用，并隐藏，当用户访问了 <code>WebView</code> 时，直接使用这个 <code>WebView</code> 加载对应网页，并展示。</p>
<p>这种方法可以<strong>比较有效的减少 WebView 在App中的首次打开时间</strong>。当用户访问页面时，不需要初始化 WebView 的时间。</p>
<p>当然这也带来了一些问题，包括：</p>
<ul>
<li><p>额外的内存消耗。</p>
</li>
<li><p>页面间跳转需要清空上一个页面的痕迹，更容易内存泄露。</p>
</li>
</ul>
<h4 id="2-WebView-动态加载"><a href="#2-WebView-动态加载" class="headerlink" title="2. WebView 动态加载"></a>2. WebView 动态加载</h4><blockquote>
<p>参考文章：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/f64e1b1c90d9">《WebView常用优化方案》</a></p>
</blockquote>
<p><code>WebView</code> 动态加载。就是不在 <code>xml</code> 中写 <code>WebView</code> ，写一个 <code>layout</code> ，然后把 <code>WebView</code> add 进去。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">WebView mWebView = <span class="keyword">new</span> WebView(getApplicationgContext());</span><br><span class="line">LinearLayout mll = findViewById(R.id.xxx);</span><br><span class="line">mll.addView(mWebView);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onDestroy();</span><br><span class="line">    mWebView.removeAllViews();</span><br><span class="line">    mWebView.destroy()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里用的 <code>getApplicationContext()</code> 也是防止内存溢出，这种方法有一个问题。如果你需要在 <code>WebView</code> 中打开链接或者你打开的页面带有 flash，获得你的 <code>WebView</code> 想弹出一个 <code>dialog</code> ，都会导致从 <code>ApplicationContext</code> 到 <code>ActivityContext</code> 的强制类型转换错误，从而导致你应用崩溃。</p>
<p>这是因为在加载 flash 的时候，系统会首先把你的 <code>WebView</code> 作为父控件，然后在该控件上绘制 flash ，他想找一个 <code>Activity</code> 的 <code>Context</code> 来绘制他，但是你传入的是 <code>ApplicationContext</code> 。然后就崩溃了。</p>
<h4 id="3-独立的web进程，与主进程隔开"><a href="#3-独立的web进程，与主进程隔开" class="headerlink" title="3. 独立的web进程，与主进程隔开"></a>3. 独立的web进程，与主进程隔开</h4><blockquote>
<p>参考文章：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/f64e1b1c90d9">《WebView常用优化方案》</a></p>
</blockquote>
<p>这个方法被运用于类似 qq ，微信这样的超级 app 中，这也是解决任何 <code>WebView</code> 内存问题屡试不爽的方法 对于封装的 <code>webactivity</code> ，在<code> manifest.xml</code> 中设置。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;.webview.WebViewActivity&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">android:launchMode</span>=<span class="string">&quot;singleTop&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">android:process</span>=<span class="string">&quot;:remote&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">android:screenOrientation</span>=<span class="string">&quot;unspecified&quot;</span> </span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后在关闭 <code>webactivity</code> 时销毁进程：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Overrideprotected</span> <span class="function"><span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;                </span><br><span class="line"><span class="keyword">super</span>.onDestroy(); </span><br><span class="line">    System.exit(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>关闭浏览器后便销毁整个进程，这样一般 95% 的情况下不会造成内存泄漏之类的问题，但这就涉及到 android 进程间通讯，比较不方便处理，优劣参半，也是可选的一个方案。   </p>
<h4 id="4-WebView-释放"><a href="#4-WebView-释放" class="headerlink" title="4. WebView 释放"></a>4. WebView 释放</h4><blockquote>
<p>参考文章：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/f64e1b1c90d9">《WebView常用优化方案》</a></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mWebView != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 如果先调用destroy()方法，则会命中if (isDestroyed()) return;这一行代码，需要先onDetachedFromWindow()，再</span></span><br><span class="line">        <span class="comment">// destory()</span></span><br><span class="line">        ViewParent parent = mWebView.getParent();</span><br><span class="line">        <span class="keyword">if</span> (parent != <span class="keyword">null</span>) &#123;</span><br><span class="line">            ((ViewGroup) parent).removeView(mWebView);</span><br><span class="line">        &#125;</span><br><span class="line">​</span><br><span class="line">        mWebView.stopLoading();</span><br><span class="line">        <span class="comment">// 退出时调用此方法，移除绑定的服务，否则某些特定系统会报错</span></span><br><span class="line">        mWebView.getSettings().setJavaScriptEnabled(<span class="keyword">false</span>);</span><br><span class="line">        mWebView.clearHistory();</span><br><span class="line">        mWebView.clearView();</span><br><span class="line">        mWebView.removeAllViews();</span><br><span class="line">​</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            mWebView.destroy();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">​</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="五、在-Android-平台下如何调试-WebView？"><a href="#五、在-Android-平台下如何调试-WebView？" class="headerlink" title="五、在 Android 平台下如何调试 WebView？"></a>五、在 Android 平台下如何调试 WebView？</h3><h4 id="1-在-Chrome-浏览器上调试"><a href="#1-在-Chrome-浏览器上调试" class="headerlink" title="1. 在 Chrome 浏览器上调试"></a>1. 在 Chrome 浏览器上调试</h4><blockquote>
<p>参考文章：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/3591eebbe797">《Android调试webview》</a>     </p>
</blockquote>
<p><strong>1.1 条件：</strong>   </p>
<ul>
<li><p>在 Android 设备或模拟器运行 Android4.4 或更高版本，Android 设备上启用 <strong>USB调试模式</strong>。</p>
</li>
<li><p>Chrome 30 或更高版本。更强大的 WebView 界面调试功能需要 Chrome31 或更高版本。</p>
</li>
<li><p>Android 应用程序中的 WebView 配置为<strong>可调试模式</strong>。</p>
</li>
</ul>
<p><strong>1.2 Android 代码中配置 WebView 为可调试：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT) &#123;  </span><br><span class="line">    WebView.setWebContentsDebuggingEnabled(<span class="keyword">true</span>);  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<p>注意 web 调测不受 <code>app manifest</code> 文件中 <code>debuggable</code> 标记状态的影响，如果希望仅 <code>debuggable</code> 为 <code>true</code> 时才能使用 web 调测，那么运行时检测此标记，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT) &#123;  </span><br><span class="line">    <span class="keyword">if</span> ( <span class="number">0</span> != ( getApplcationInfo().flags &amp;= ApplicationInfo.FLAG_DEBUGGABLE ) ) &#123;  </span><br><span class="line">        WebView.setWebContentsDebuggingEnabled(<span class="keyword">true</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<p><strong>1.3 手机开启 USB 调试选项，并用 USB 连接电脑：</strong>   </p>
<p>开启 Android 手机的开发者选项，一般在 <strong>系统设置</strong> - <strong>Android版本</strong> 进行多次点击会触发开启开发者选项，然后进入开发者选项页面，开启USB调试。</p>
<p>为了避免每次调试时看到此警告，勾选“<strong>总是允许从这台计算机</strong>”，并单击“<strong>确定</strong>”。</p>
<p><strong>1.4 在 Chrome 中启用设置“USB web debugging”（不会影响WebView）：</strong>  </p>
<p>在 Chrome 上访问 <code>chrome://inspect/#devices</code> 或 <code>about:inspect</code> 访问已启用调试的 WebView 列表，<strong>需要翻墙</strong>。</p>
<p>然后在 WebView 列表中选择你要调试的页面，点击“ <code>Inspect</code> ”选项，跟调试 PC 网页一样，使用 Chrome 控制台进行调试。   </p>
<p><img src="http://images.pingan8787.com/20190707hybrid01.png" alt="Chrome 控制台"></p>
<p><img src="http://images.pingan8787.com/20190707hybrid02.png" alt="Chrome 控制台"></p>
<p><strong>1.5 小技巧：</strong>   </p>
<p>（1）访问 <code>chrome://inspect/#devices</code> 如果 chrome 没有检测到 <code>Remote Target</code> 中的页面，可能需要安装一下 Chrome 的 ADB 插件，也可以在 Chrome 翻墙访问 <code>https://chrome-devtools-frontend.appspot.com</code>；</p>
<p>（2）对于腾讯系的 APP，默认采用 X5内核 ，需要将 <code>WebViewDebugHook</code> 的 git 目录下的 <code>debug.conf</code> 文件拷贝到 SD卡 的根目录下即可。</p>
<h4 id="2-使用-DebugGap-调试"><a href="#2-使用-DebugGap-调试" class="headerlink" title="2. 使用 DebugGap 调试"></a>2. 使用 DebugGap 调试</h4><blockquote>
<p>参考文章：<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000009240637">《Android下的webview调试》</a></p>
</blockquote>
<p><strong>2.1 Windows 下载 DebugGap 并配置：</strong>   </p>
<p>在电脑上面下载 Windows 版本的 <code>DebugGap</code> 软件包（下载链接：<a target="_blank" rel="noopener" href="http://www.debuggap.com/">DebugGap</a>），下载完成后解压下来。</p>
<p>安装完成后，运行 <code>DebugGap</code> ，开始配置：</p>
<ul>
<li>通常情况下，<code>DebugGap</code> 可以自动获取IP，并设置默认的端口，如果没有，你可以手动设置；</li>
<li>点击“<strong>连接</strong>”按钮启动各种客户端的侦听器；</li>
</ul>
<p><img src="http://images.pingan8787.com/20190707hybrid03.png" alt="DebugGap"></p>
<p><strong>2.2 在客户端上配置：</strong></p>
<p>在调试项目中要进行测试的 HTML 界面中引入 <code>debuggap.js</code>。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;debuggap.js&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>当调试项目的加载时，您的应用程序将会有一个蓝色的地方，点击会出现一个四叶三叶草的东西，点击“<strong>配置</strong>”，显示配置页面。输入与远程 DebugGap 上的主机和端口相同的主机和端口，例如 <code>192.168.1.4:11111</code>，然后点击“<strong>连接</strong>”按钮。</p>
<p><img src="http://images.pingan8787.com/20190707hybrid04.png" alt="DebugGap"></p>
<p>1.4电脑端远程 DebugGap 将检测即将到来的客户端，开发人员可以单击每个客户端进行调试。</p>
<p><img src="http://images.pingan8787.com/20190707hybrid05.png" alt="DebugGap"></p>
<h3 id="六、在-iOS-平台下如何调试-WebView？"><a href="#六、在-iOS-平台下如何调试-WebView？" class="headerlink" title="六、在 iOS 平台下如何调试 WebView？"></a>六、在 iOS 平台下如何调试 WebView？</h3><blockquote>
<p>参考文章：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/dianming/p/6902442.html">《iOS之Safari调试webView/H5页面》</a></p>
</blockquote>
<p>一般我们通过 Mac 的 Safari浏览器 来调试，但是要注意两点：</p>
<ul>
<li><p>如果调试的是 APP 中 WebView 的页面，则需要这个 APP 的包支持调试，如果不能调试，需要让 iOS 开发人员重签名 APP（可能需要将我们 iOS 设备的 ID 写入到可信任设备列表中，然后使用 iTunes 安装客户端提供的测试包即可）。</p>
</li>
<li><p>如果调试的是 H5 页面，可以直接在手机的 Safari浏览器 打开直接调试。   </p>
</li>
</ul>
<p>下面开始说说在 Mac 上如何调试：   </p>
<h4 id="1-开启-Safari-开发菜单"><a href="#1-开启-Safari-开发菜单" class="headerlink" title="1. 开启 Safari 开发菜单"></a>1. 开启 Safari 开发菜单</h4><p>先将 iPhone 连接到 Mac，在 Mac 的 Safari 偏好设置中，开启开发菜单。具体步骤为：Safari -&gt; 偏好设置… -&gt; 高级 -&gt; 勾选在菜单栏显示“<strong>开发</strong>”菜单。</p>
<p><img src="http://images.pingan8787.com/20190707hybrid06.jpg" alt="Safari"></p>
<h4 id="2-iPhone-开启-Web检查器"><a href="#2-iPhone-开启-Web检查器" class="headerlink" title="2. iPhone 开启 Web检查器"></a>2. iPhone 开启 Web检查器</h4><p>具体步骤为：设置 -&gt; Safari -&gt; 高级 -&gt; Web 检查器。</p>
<p><img src="http://images.pingan8787.com/20190707hybrid07.jpg" alt="Safari"></p>
<h4 id="3-调试-APP-内的-WebView"><a href="#3-调试-APP-内的-WebView" class="headerlink" title="3. 调试 APP 内的 WebView"></a>3. 调试 APP 内的 WebView</h4><blockquote>
<p>参考文章：<a target="_blank" rel="noopener" href="https://imnerd.org/ios-webview-debug.html">《前端 WEBVIEW 指南之 IOS 调试篇》</a></p>
</blockquote>
<p>在 Safari-&gt; 开发中，看到自己的设备以及 WebView 中网页，点击后即可开启对应页面的 <code>Inspector</code> ，可以用来进行断点调试。   </p>
<p><img src="http://images.pingan8787.com/20190707hybrid09.png" alt="Safari"></p>
<p><img src="http://images.pingan8787.com/20190707hybrid10.png" alt="Safari"></p>
<h3 id="七、在内嵌版调试过程中，Fiddler-或-Charles-能起到什么作用？"><a href="#七、在内嵌版调试过程中，Fiddler-或-Charles-能起到什么作用？" class="headerlink" title="七、在内嵌版调试过程中，Fiddler 或 Charles 能起到什么作用？"></a>七、在内嵌版调试过程中，Fiddler 或 Charles 能起到什么作用？</h3><p>这两者都是强大的抓包工具，原理是以<strong>web代理服务器</strong>的形式进行工作的，使用的代理地址是：<code>127.0.0.1</code>，端口默认为<code>8888</code>，我们也可以通过设置进行修改。</p>
<p><strong>代理</strong>就是在客户端和服务器之间设置一道关卡，客户端先将请求数据发送出去后，代理服务器会将数据包进行拦截，代理服务器再冒充客户端发送数据到服务器；同理，服务器将响应数据返回，代理服务器也会将数据拦截，再返回给客户端。</p>
<p>Fiddler 或 Charles 的主要作用有：   </p>
<ul>
<li>可以代理请求，用来查看页面发送的请求和接收的响应；</li>
<li>可以修改请求的响应，用来模拟自己想要的数据；</li>
<li>可以模拟网络请求的速度；</li>
<li>可以代理服务器的静态资源请求，指向本地文件，省去频繁发布 H5 包，达到快速调试目的；</li>
</ul>
<blockquote>
<p>补充链接：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/miantest/p/7289694.html">《Fiddler工具使用介绍一》</a></p>
</blockquote>
<h3 id="八、调试企业微信、微信和钉钉版时，可以使用哪些工具？"><a href="#八、调试企业微信、微信和钉钉版时，可以使用哪些工具？" class="headerlink" title="八、调试企业微信、微信和钉钉版时，可以使用哪些工具？"></a>八、调试企业微信、微信和钉钉版时，可以使用哪些工具？</h3><h4 id="1-调试企业微信、微信"><a href="#1-调试企业微信、微信" class="headerlink" title="1. 调试企业微信、微信"></a>1. 调试企业微信、微信</h4><ul>
<li>**<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html">微信开发者工具</a>**，可以用来调试页面基本功能；</li>
<li>**<a target="_blank" rel="noopener" href="https://work.weixin.qq.com/api/devtools/devtool.php">企业微信接口调试工具</a>**，可以用来调试企业微信的接口；</li>
</ul>
<h4 id="2-调试钉钉"><a href="#2-调试钉钉" class="headerlink" title="2. 调试钉钉"></a>2. 调试钉钉</h4><ul>
<li>**<a target="_blank" rel="noopener" href="https://files.alicdn.com/tpsservice/76ac853fc96075414a837d8bbae89030.pdf">钉钉Android开发版</a>**，用来调试Android上的钉钉应用；</li>
</ul>
<h4 id="3-通用"><a href="#3-通用" class="headerlink" title="3. 通用"></a>3. 通用</h4><ul>
<li><strong>Fiddler 或 Charles</strong>，可以拦截接口替换文件，来调试应用；</li>
</ul>
<h3 id="九、常见的调试技巧有哪些？"><a href="#九、常见的调试技巧有哪些？" class="headerlink" title="九、常见的调试技巧有哪些？"></a>九、常见的调试技巧有哪些？</h3><h4 id="1-Chrome-控制台调试"><a href="#1-Chrome-控制台调试" class="headerlink" title="1. Chrome 控制台调试"></a>1. Chrome 控制台调试</h4><blockquote>
<p>参考文章：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenbeibei520/p/9959555.html">《前端常见调试技巧篇总结（持续更新…）》</a></p>
</blockquote>
<p><strong>1.1 Source 面板断点调试 JS</strong><br>从左到右，各个图标表示的功能分别为：</p>
<ul>
<li><code>Pause/Resume script execution</code>：暂停/恢复脚本执行（程序执行到下一断点停止）。</li>
<li><code>Step over next function call</code>：执行到下一步的函数调用（跳到下一行）。</li>
<li><code>Step into next function call</code>：进入当前函数。</li>
<li><code>Step out of current function</code>：跳出当前执行函数。</li>
<li><code>Deactive/Active all breakpoints</code>：关闭/开启所有断点（不会取消）。</li>
<li><code>Pause on exceptions</code>：异常情况自动断点设置。</li>
</ul>
<p><strong>1.2 Element 面板调试 DOM：</strong>   </p>
<p>右击元素，选择 <code>break on</code> 选项：  </p>
<p><img src="http://images.pingan8787.com/20190707hybrid14.png" alt="break on"></p>
<ul>
<li><code>Subtree modifications</code> 选项，是指<strong>当节点内部子节点变化时断点</strong>；    </li>
</ul>
<p><img src="http://images.pingan8787.com/20190707hybrid11.gif" alt="break on"></p>
<ul>
<li><code>Attributes modifications</code> 选项，是指<strong>当节点属性发生变化时断点</strong>；   </li>
</ul>
<p><img src="http://images.pingan8787.com/20190707hybrid12.gif" alt="break on"></p>
<ul>
<li><code>node removal</code> 选项，是指<strong>当节点被移除时断点</strong>；   </li>
</ul>
<p><img src="http://images.pingan8787.com/20190707hybrid13.png" alt="break on"></p>
<h4 id="2-console-调试"><a href="#2-console-调试" class="headerlink" title="2. console 调试"></a>2. console 调试</h4><blockquote>
<p>参考文章：<a target="_blank" rel="noopener" href="https://blog.csdn.net/a0405221/article/details/85248433">《Console调试常用用法》</a></p>
</blockquote>
<p><strong>2.1 显示信息的命令：</strong> </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;normal&quot;</span>);         <span class="comment">// 用于输出普通信息</span></span><br><span class="line"><span class="built_in">console</span>.info(<span class="string">&quot;information&quot;</span>);   <span class="comment">// 用于输出提示性信息</span></span><br><span class="line"><span class="built_in">console</span>.error(<span class="string">&quot;error&quot;</span>);        <span class="comment">// 用于输出错误信息</span></span><br><span class="line"><span class="built_in">console</span>.warn(<span class="string">&quot;warn&quot;</span>);          <span class="comment">// 用于输出警示信息</span></span><br><span class="line"><span class="built_in">console</span>.clear();               <span class="comment">// 清空控制台信息</span></span><br></pre></td></tr></table></figure>

<p><strong>2.2 计时功能：</strong>   </p>
<p><code>console.time()</code> 和 <code>console.timeEnd()</code> ：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.time(<span class="string">&quot;控制台计时器&quot;</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; <span class="number">10000</span>; j++)&#123;&#125;       </span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="string">&quot;控制台计时器&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>2.3 信息分组：</strong>   </p>
<p><code>console.group()</code> 和 <code>console.groupEnd()</code>：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.group(<span class="string">&quot;第一组信息&quot;</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;第一组第一条：我的博客&quot;</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;第一组第二条：CSDN&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.groupEnd();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.group(<span class="string">&quot;第二组信息&quot;</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;第二组第一条：程序爱好者QQ群&quot;</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;第二组第二条：欢迎你加入&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.groupEnd();</span><br></pre></td></tr></table></figure>

<p><strong>2.4 将对象以树状结构展现：</strong>   </p>
<p><code>console.dir()</code> 可以显示一个对象所有的属性和方法：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> info = &#123;</span><br><span class="line">    <span class="attr">name</span> : <span class="string">&quot;Alan&quot;</span>,</span><br><span class="line">    <span class="attr">age</span> : <span class="string">&quot;27&quot;</span>,</span><br><span class="line">    <span class="attr">grilFriend</span> : <span class="string">&quot;nothing&quot;</span>,</span><br><span class="line">    <span class="attr">getName</span> : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.dir(info);</span><br></pre></td></tr></table></figure>

<p><strong>2.5 显示某个节点的内容：</strong>   </p>
<p><code>console.dirxml()</code> 用来显示网页的某个节点( <code>node</code>) 所包含的 <code>html/xml</code> 代码：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> node = <span class="built_in">document</span>.getElementById(<span class="string">&quot;info&quot;</span>);</span><br><span class="line">node.innerHTML += <span class="string">&quot;&lt;p&gt;追加的元素显示吗&lt;/p&gt;&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.dirxml(node);</span><br></pre></td></tr></table></figure>

<p><strong>2.5 统计代码被执行的次数：</strong>  </p>
<p>使用 <code>console.count()</code>：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFunction</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.count(<span class="string">&quot;myFunction 被执行的次数&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">myFunction();       <span class="comment">//myFunction 被执行的次数: 1</span></span><br><span class="line">myFunction();       <span class="comment">//myFunction 被执行的次数: 2</span></span><br><span class="line">myFunction();       <span class="comment">//myFunction 被执行的次数: 3</span></span><br></pre></td></tr></table></figure>

<p><strong>2.6 输出表格：</strong>   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.table(mytable);</span><br></pre></td></tr></table></figure>

<h4 id="3-调试各种页面尺寸"><a href="#3-调试各种页面尺寸" class="headerlink" title="3. 调试各种页面尺寸"></a>3. 调试各种页面尺寸</h4><p>虽然把各种各样的手机都摆在桌子上看起来很酷，但却很不现实。但是，浏览器内却提供了你所需要的一切。进入检查面板点击“<strong>切换设备模式</strong>”按钮。这样，就可以在窗口内调整视窗的大小。</p>
<h4 id="4-debugger-断点"><a href="#4-debugger-断点" class="headerlink" title="4. debugger 断点"></a>4. debugger 断点</h4><p>具体的说就是通过在代码中添加” <code>debugger; </code>“语句，当代码执行到该语句的时候就会自动断点。  </p>
<p><img src="http://images.pingan8787.com/20190712Hybrid02.gif" alt="debugger"></p>
<h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>对于初入混合应用开发的小伙伴，还有经常需要调试混合应用的小伙伴，相信会有帮助😁</p>
<p>大家加油~</p>
<h3 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h3><blockquote>
<p>本文首发在 <a target="_blank" rel="noopener" href="http://www.pingan8787.com/">pingan8787个人博客</a>，如需转载请保留个人介绍。</p>
</blockquote>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#112;&#105;&#110;&#103;&#97;&#110;&#x38;&#55;&#56;&#55;&#x40;&#113;&#x71;&#46;&#99;&#x6f;&#x6d;">&#112;&#105;&#110;&#103;&#97;&#110;&#x38;&#55;&#56;&#55;&#x40;&#113;&#x71;&#46;&#99;&#x6f;&#x6d;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>ES小册</td>
<td>js.pingan8787.com</td>
</tr>
</tbody></table>
<h3 id="微信公众号"><a href="#微信公众号" class="headerlink" title="微信公众号"></a>微信公众号</h3><p><img src="http://images.pingan8787.com/2019_07_12guild_page.png" alt="bg">  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/07/13/166-%E3%80%90Hybrid%E3%80%91HybirdApp%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E4%B8%AD9%E4%B8%AA%E5%BF%85%E5%A4%87%E7%9F%A5%E8%AF%86%E7%82%B9%E5%A4%8D%E4%B9%A0%EF%BC%88WebView-%E8%B0%83%E8%AF%95%E7%AD%89%EF%BC%89/" data-id="ckts3ejy700m54d9k32fq1sj9" data-title="166-【Hybrid】HybirdApp应用开发中9个必备知识点复习（WebView/调试等）" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTTP/" rel="tag">HTTP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hybrid/" rel="tag">Hybrid</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-165-【Hybrid】HybridApp应用开发中5个必备知识点复习" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/06/26/165-%E3%80%90Hybrid%E3%80%91HybridApp%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E4%B8%AD5%E4%B8%AA%E5%BF%85%E5%A4%87%E7%9F%A5%E8%AF%86%E7%82%B9%E5%A4%8D%E4%B9%A0/" class="article-date">
  <time class="dt-published" datetime="2019-06-25T17:03:20.000Z" itemprop="datePublished">2019-06-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/06/26/165-%E3%80%90Hybrid%E3%80%91HybridApp%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E4%B8%AD5%E4%B8%AA%E5%BF%85%E5%A4%87%E7%9F%A5%E8%AF%86%E7%82%B9%E5%A4%8D%E4%B9%A0/">165-【Hybrid】HybridApp应用开发中5个必备知识点复习</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <hr>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#x70;&#105;&#110;&#x67;&#x61;&#x6e;&#56;&#55;&#56;&#55;&#64;&#x71;&#x71;&#46;&#x63;&#111;&#109;">&#x70;&#105;&#110;&#x67;&#x61;&#x6e;&#56;&#55;&#56;&#55;&#64;&#x71;&#x71;&#46;&#x63;&#111;&#109;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>微信公众号</td>
<td>前端自习课</td>
</tr>
</tbody></table>
<p><img src="http://images.pingan8787.com/Hybird%E5%B0%81%E9%9D%A2.png" alt="封面"></p>
<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>我们大前端团队内部 📖<strong>每周一练</strong> 的知识复习计划还在继续，本周主题是 <strong>《Hybrid APP 混合应用专题》</strong> ，这期内容比较多，篇幅也相对较长，每个知识点内容也比较多。</p>
<p>之前分享的每周内容，我都整理到掘金收藏集 <a target="_blank" rel="noopener" href="https://juejin.im/collection/5cd11b0af265da0346227e24">📔《EFT每周一练》</a> 上啦，欢迎点赞收藏咯💕💕。  </p>
<blockquote>
<p>注：本文整理资料来源网络，有些图片/段落找不到原文出处，如有侵权，联系删除。</p>
</blockquote>
<h3 id="一、什么是-Hybrid-App，与-Native-App-及-Web-App-有什么区别"><a href="#一、什么是-Hybrid-App，与-Native-App-及-Web-App-有什么区别" class="headerlink" title="一、什么是 Hybrid App，与 Native App 及 Web App 有什么区别"></a>一、什么是 Hybrid App，与 Native App 及 Web App 有什么区别</h3><p>参考文章：</p>
<ol>
<li><p><a target="_blank" rel="noopener" href="http://www.ionic.wang/article-index-id-58.html">《Web App Hybrid App和 Native App的区别》</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/dailc/p/5930238.html">《Hybrid APP基础篇(二) -&gt; Native、Hybrid、React Native、Web App方案的分析比较》</a></p>
</li>
</ol>
<h4 id="1-1-主流应用类型"><a href="#1-1-主流应用类型" class="headerlink" title="1.1 主流应用类型"></a>1.1 主流应用类型</h4><p>随着现在移动互联网的快速发展，市面上目前主流移动应用程序主要分三类：<strong>Web App</strong>、 <strong>Native App</strong> 和 <strong>Hybrid App</strong>。</p>
<p>三者大致关系如下：   </p>
<p><img src="http://images.pingan8787.com/20190623HybridApp1.png" alt="关系图">   </p>
<h4 id="1-2-Web-App"><a href="#1-2-Web-App" class="headerlink" title="1.2 Web App"></a>1.2 Web App</h4><p><strong>Web App</strong>，即<strong>移动端网站</strong>，一般指的是基于 Web 的应用，基于<strong>浏览器运行</strong>，<strong>无需下载安装</strong>，基本上可以说是触屏版的网页应用。这类应用基本上是一个网页或一系列网页，旨在在移动屏幕上工作。</p>
<p><strong>Web 网站</strong>一般分为两种：</p>
<ol>
<li><p><strong>MPA</strong>(Multi-page Application)</p>
</li>
<li><p><strong>SPA</strong>(Single-page Application)</p>
</li>
</ol>
<p>一般的 <strong>Web App</strong> 是指 <strong>SPA</strong> 形式开发的网站。  </p>
<p><strong>优点：</strong></p>
<ul>
<li><strong>开发和维护成本低，可以跨平台，调试方便；</strong></li>
</ul>
<p>前端人员开发的代码，可应用于各大主流浏览器(特殊情况可以代码进行下兼容)，没有新的学习成本，而且可以直接在浏览器中调试。 </p>
<ul>
<li><strong>更新最为快速；</strong></li>
</ul>
<p>由于web app资源是直接部署在服务器端的，所以只需替换服务器端文件，用户访问是就已经更新了(当然需要解决一些缓存问题)。 </p>
<ul>
<li><strong>无需安装App，不会占用手机内存；</strong></li>
</ul>
<p>通过浏览器即可访问，无需安装，用户使用成本更低。 </p>
<p><strong>缺点：</strong></p>
<ul>
<li><strong>性能低，用户体验差；</strong></li>
</ul>
<p>由于是直接通过的浏览器访问，所以无法使用原生的API，操作体验不好。 </p>
<ul>
<li><strong>依赖于网络，页面访问速度慢，耗费流量；</strong></li>
</ul>
<p>Web App每次访问都必须依赖网络，从服务端加载资源，当网速慢时访问速度很不理想，特别是在移动端，对网站性能优化要求比较高。 </p>
<ul>
<li><strong>功能受限，大量功能无法实现；</strong></li>
</ul>
<p>只能使用 HTML5 的一些特殊 API ，无法调用原生 API ，所以很多功能存在无法实现情况。 </p>
<ul>
<li><strong>临时性入口，用户留存率低；</strong></li>
</ul>
<p>这既是它的优点，也是缺点，优点是无需安装，确定是用完后有时候很难再找到，或者说很难专门为某个web app留存一个入口，导致用户很难再次使用。 </p>
<h4 id="1-3-Native-App"><a href="#1-3-Native-App" class="headerlink" title="1.3 Native App"></a>1.3 Native App</h4><p><strong>Native APP</strong> 指的是原生程序，需要用户下载安装使用，一般依托于操作系统，有很强的交互，是一个完整的App，可拓展性强，能发布应用商店。</p>
<p>目前市面上主流的平台有：<strong>Android</strong> 和 <strong>iOS</strong>。</p>
<p><strong>优点：</strong>  </p>
<ul>
<li><p>直接依托于操作系统，<strong>用户体验好</strong>，<strong>操作流畅</strong>，<strong>性能稳定</strong>；</p>
</li>
<li><p>用户留存率高；  </p>
</li>
<li><p>功能最为强大，特别是在与系统交互中，几乎所有功能都能实现；</p>
</li>
</ul>
<p>由于 <strong>Native APP</strong> 是直接依托于系统，所以可以直接调用官方提供的API，功能最为全面(比如本地资源操作，通知，动画等)。</p>
<p><strong>缺点：</strong>   </p>
<ul>
<li>开发和维护成本高，无法跨平台，需要各平台各自独立开发；</li>
</ul>
<p><strong>Android</strong> 上基于 <strong>Java</strong> 开发，<strong>iOS</strong> 上基 <strong>OC</strong> 或 <strong>Swift</strong> 开发，相互之间独立，必须要有各自的开发人员。</p>
<ul>
<li>门槛较高，原生人员有一定的入门门槛，人才较少；</li>
</ul>
<p>原生的一个很大特点就是独立，所以不太容易入门，而且 <strong>Android</strong>， <strong>iOS</strong>都需要独立学习。</p>
<ul>
<li>分发成本高，更新缓慢，特别是发布应用商店后，需要等到审核周期；</li>
</ul>
<p>原生应用更新是一个很大的问题， <strong>Android</strong>中还能直接下载整包APK进行更新，但是 <strong>iOS</strong>中，如果是发布 <strong>AppStore</strong> ，必须通过 <strong>AppStore</strong>地址更新，而每次更新都需要审核，所以无法达到及时更新。</p>
<h4 id="1-4-Hybrid-App"><a href="#1-4-Hybrid-App" class="headerlink" title="1.4 Hybrid App"></a>1.4 Hybrid App</h4><p><strong>Hybrid App</strong> 指的是<strong>混合开发</strong>，也就是半原生半 Web 的开发模式，有跨平台效果，当然了，实质最终发布的仍然是独立的原生APP(各种的平台有各种的SDK)。  </p>
<p><strong>优点：</strong></p>
<ul>
<li><strong>学习和开发成本较低，可以跨平台，调试方便</strong>；  </li>
</ul>
<p>Hybrid 开发模式下，由原生提供统一的 API 给 JS 调用，实际的主要逻辑由 HTML 和 JS 完成，最终放在 webview 中显示，这样只需要写一套代码即可，达到跨平台效果，另外也可以直接在浏览器中调试，很方便。  </p>
<p>一般 Hybrid 中的跨平台最少可以跨三个平台: Android App ，iOS App ，普通 webkit 浏览器。 </p>
<p>需要前端人员关注一些原生提供的API，具体的实现无需关心，没有新的学习内容。  </p>
<ul>
<li><strong>维护成本低</strong>，功能可复用，并且更容易更新；  </li>
</ul>
<p>虽然没有 web app 更新那么快速，但是 Hybrid 中也可以通过原生提供 api ，进行资源主动下载，达到只更新资源文件，不更新 apk(ipa) 的效果。  </p>
<ul>
<li>功能更加完善，性能和体验要比起 web app 好太多；  </li>
</ul>
<p>因为可以调用原生api，所以很多功能只要原生提供出就可以实现，另外性能也比较接近原生。  </p>
<ul>
<li>部分性能要求的页面可用原生实现；  </li>
</ul>
<p>这种模式是原生混合 web ，所以我们完全可以将交互强，性能要求高的页面用原生写，然后一些其它页面用 JS 写，嵌入 webview 中，达到最佳体验。  </p>
<p><strong>缺点：</strong></p>
<ul>
<li>相比原生，性能仍然有较大损耗；</li>
</ul>
<p>这种模式受限于 webview 的性能，相比原生而言有不少损耗，体验无法和原生相比。</p>
<ul>
<li>不适用于交互性较强的app；</li>
</ul>
<p>这种模式的主要适用：一些新闻阅读类，信息展示类的 app ，不适用于一些交互较强或者性能要求较高的 app (比如动画较多就不适合)。</p>
<h4 id="1-5-三者区别"><a href="#1-5-三者区别" class="headerlink" title="1.5 三者区别"></a>1.5 三者区别</h4><p><strong>三者使用场景对比：</strong></p>
<p><img src="http://images.pingan8787.com/20190623HybridApp7.png" alt="对比图"></p>
<p><strong>三者技术特征对比：</strong></p>
<p><img src="http://images.pingan8787.com/20190623HybridApp2.png" alt="对比图"></p>
<p><strong>另外增加 ReactNative 一起放入作对比。</strong></p>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="left">NativeApp</th>
<th align="left">WebApp</th>
<th align="left">HybridApp</th>
<th>ReactNativeApp</th>
</tr>
</thead>
<tbody><tr>
<td align="left">原生功能体验</td>
<td align="left">优秀</td>
<td align="left">差</td>
<td align="left">良好</td>
<td>接近优秀</td>
</tr>
<tr>
<td align="left">渲染性能</td>
<td align="left">非常快</td>
<td align="left">慢</td>
<td align="left">接近快</td>
<td>快</td>
</tr>
<tr>
<td align="left">是否支持设备底层访问</td>
<td align="left">支持</td>
<td align="left">不支持</td>
<td align="left">支持</td>
<td>支持</td>
</tr>
<tr>
<td align="left">网络要求</td>
<td align="left">支持离线</td>
<td align="left">依赖网络</td>
<td align="left">支持离线(资源存本地情况)</td>
<td>支持离线</td>
</tr>
<tr>
<td align="left">更新复杂度</td>
<td align="left">高(几乎总是通过应用商店更新)</td>
<td align="left">低(服务器端直接更新)</td>
<td align="left">较低(可以进行资源包更新)</td>
<td>较低(可以进行资源包更新)</td>
</tr>
<tr>
<td align="left">编程语言</td>
<td align="left">Android(Java)，iOS(OC/Swift)</td>
<td align="left">js+html+css3</td>
<td align="left">js+html+css3</td>
<td>主要使用JS编写，语法规则JSX</td>
</tr>
<tr>
<td align="left">社区资源</td>
<td align="left">丰富(Android，iOS单独学习)</td>
<td align="left">丰富(大量前端资源)</td>
<td align="left">有局限(不同的Hybrid相互独立)</td>
<td>丰富(统一的活跃社区)</td>
</tr>
<tr>
<td align="left">上手难度</td>
<td align="left">难(不同平台需要单独学习)</td>
<td align="left">简单(写一次，支持不同平台访问)</td>
<td align="left">简单(写一次，运行任何平台)</td>
<td>中等(学习一次，写任何平台)</td>
</tr>
<tr>
<td align="left">开发周期</td>
<td align="left">长</td>
<td align="left">短</td>
<td align="left">较短</td>
<td>中等</td>
</tr>
<tr>
<td align="left">开发成本</td>
<td align="left">昂贵</td>
<td align="left">便宜</td>
<td align="left">较为便宜</td>
<td>中等</td>
</tr>
<tr>
<td align="left">跨平台</td>
<td align="left">不跨平台</td>
<td align="left">所有H5浏览器</td>
<td align="left">Android，iOS，h5浏览器</td>
<td>Android，iOS</td>
</tr>
<tr>
<td align="left">APP发布</td>
<td align="left">AppStore</td>
<td align="left">Web服务器</td>
<td align="left">AppStore</td>
<td>AppStore</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td></td>
</tr>
</tbody></table>
<h4 id="1-6-三者如何选择"><a href="#1-6-三者如何选择" class="headerlink" title="1.6 三者如何选择"></a>1.6 三者如何选择</h4><p>这里简单介绍几种情况，具体还是要以实际项目技术评估结果为主。  </p>
<ul>
<li>选择纯 Native App 模式的情况：</li>
</ul>
<p><strong>性能要求极高，体验要求极好，不追求开发效率</strong>。</p>
<ul>
<li>选择 Web App 模式的情况：</li>
</ul>
<p>不追求用户体验和性能，对离线访问没要求，正常来说，如果追求性能和体验，都不会选用web app。</p>
<ul>
<li>选择 Hybrid App 模式的情况</li>
</ul>
<p><strong>大部分情况下的App都推荐采用这种模式</strong>，这种模式可以用原生来实现要求高的界面，对于一些比较通用型，展示型的页面完全可以用web来实现，达到跨平台效果，<strong>提升效率</strong>。一般好一点的Hybrid方案，都会<strong>把资源放在本地</strong>的，可以<strong>减少网络流量消耗</strong>。</p>
<ul>
<li>选择React Native App模式的情况</li>
</ul>
<p>追求性能，体验，同时追求开发效率，而且有一定的技术资本，舍得前期投入。</p>
<p>React Native这种模式学习成本较高，所以需要前期投入不少时间才能达到较好水平，但是有了一定水准后，开发起来它的优势就体现出来了，性能不逊色原生，而且开发速度也很快</p>
<h3 id="二、什么是-Cordova，它的优缺点是什么"><a href="#二、什么是-Cordova，它的优缺点是什么" class="headerlink" title="二、什么是 Cordova，它的优缺点是什么"></a>二、什么是 Cordova，它的优缺点是什么</h3><p>参考文章： <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_37730482/article/details/73920722">《浅谈Cordova框架》</a></p>
<h4 id="2-1-Cordova-简介"><a href="#2-1-Cordova-简介" class="headerlink" title="2.1 Cordova 简介"></a>2.1 Cordova 简介</h4><p>Cordova 是一个用基于 HTML、CSS 和 JavaScript 的，<strong>用于创建跨平台移动应用程序的快速开发平台</strong>。它使开发者能够利用iPhone、Android、Palm、Symbian、WP7、Bada和Blackberry等智能手机的核心功能——包括地理定位、加速器、联系人、声音和振动等，此外 Cordova 拥有丰富的插件，可以调用。</p>
<p>也可以用来开发<strong>原生和WebView组件之间的插件接口</strong>。</p>
<p><strong>来源：</strong><br>Cordova 是 PhoneGap 贡献给 Apache 后的开源项目，是从 PhoneGap 中抽出的核心代码，是驱动 PhoneGap 的核心引擎。可以把它们的关系想象成类似于 Webkit 和 Google Chrome 的关系。</p>
<h4 id="2-2-Cordova-架构图"><a href="#2-2-Cordova-架构图" class="headerlink" title="2.2 Cordova 架构图"></a>2.2 Cordova 架构图</h4><p><img src="http://images.pingan8787.com/20190623HybridApp3.jpg" alt="Cordova架构图">  </p>
<p><strong>架构图介绍：</strong>   </p>
<ul>
<li><strong>Web App</strong></li>
</ul>
<p>用于存放我们程序的代码，包括业务逻辑，还有一些运行需要的资源（如：CSS，JavaScript，图片，媒体文件等）。<br>应用的实现是通过 web 页面，默认的本地文件名称是 <code>index.html</code> ，应用执行在原生应用包装的 WebView 中，这个原生应用是你分发到应用商店中的。</p>
<ul>
<li><strong>WebView</strong></li>
</ul>
<p>Cordova 用的 WebView 可以给应用提供完整用户访问界面，使得应用混合了 Webview 和原生的应用组件。</p>
<ul>
<li><strong>Cordova Plugins</strong></li>
</ul>
<p>插件是 Cordova 生态系统的重要组成部分。它<strong>提供了 Cordova 和原生组件相互通信的接口</strong>，并绑定到了标准的设备API上，这使你能够<strong>通过 JavaScript 调用原生代码</strong>。</p>
<h4 id="2-3-优缺点"><a href="#2-3-优缺点" class="headerlink" title="2.3 优缺点"></a>2.3 优缺点</h4><p><strong>优点：</strong>  </p>
<ul>
<li>跨平台，开发简单，学习成本低；</li>
<li>框架多，插件多，可自定义插件；</li>
<li>发展最早，社区资源丰富；</li>
</ul>
<p><strong>缺点：</strong>  </p>
<ul>
<li>WebView性能低下时，用户体验差，反应慢；</li>
<li>中文文档资源少；</li>
<li>调试不方便，既不像原生那么好调试，也不像纯web那种调试；</li>
</ul>
<h3 id="三、Cordova-插件的原理是什么"><a href="#三、Cordova-插件的原理是什么" class="headerlink" title="三、Cordova 插件的原理是什么"></a>三、Cordova 插件的原理是什么</h3><p>Cordova 插件就是一些附加代码用来提供原生组件的 JavaScript 接口，它允许你的 App 可以使用原生设备的能力，超越了纯粹的 Web App。</p>
<p><strong>Cordova 在 iOS 上的实现原理：</strong><br><img src="http://images.pingan8787.com/20190623HybridApp6.png" alt="cordova"></p>
<h4 id="3-1-工作流程"><a href="#3-1-工作流程" class="headerlink" title="3.1 工作流程"></a>3.1 工作流程</h4><ol>
<li>Cordova 发起对原生的请求：   </li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cordova.exec(successCallback, failCallback, service, action, actionArgs); </span><br><span class="line"><span class="comment">// successCallback: 成功回调方法</span></span><br><span class="line"><span class="comment">// failCallback: 失败回调方法</span></span><br><span class="line"><span class="comment">// server: 所要请求的服务名字</span></span><br><span class="line"><span class="comment">// action: 所要请求的服务具体操作</span></span><br><span class="line"><span class="comment">// actionArgs: 请求操作所带的参数</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>这五个参数并不是直接传给原生，Cordova JS 端会做以下处理：</p>
<ul>
<li>为每个请求生成一个唯一标识( <code>callbackId</code> )，并传给原生端，原生端处理完后，会把 <code>callbackId</code> 连同处理结果一起返回给 JS 端；</li>
<li>以 <code>callbackId</code> 为 <code>key</code>，<code>&#123;success:successCallback, fail:failCallback&#125;</code> 为 <code>value</code>，把这个键值对保存在 JS 端的字典里，<code>successCallback</code> 与 <code>failCallback</code> 这两个参数不需要传给原生，原生返回结果时带上<code> callbackId</code>，JS 端就可以根据 <code>callbackId</code> 找到回调方法；</li>
<li>每次 JS 请求，最后发到原生的数据包括：<code>callbackId</code>, <code>service</code>, <code>action</code>, <code>actionArgs</code>；</li>
</ul>
</li>
</ol>
<p><img src="http://images.pingan8787.com/20190623HybridApp12.png" alt="iOS"></p>
<ol start="3">
<li><p>原生代码拿到 <code>callbackId</code>、<code>service</code>、<code>action</code> 及 <code>actionArgs</code> 后，会做以下处理：</p>
<ul>
<li>根据 <code>service</code> 参数找到对应插件类；</li>
<li>根据 <code>action</code> 参数找到插件类中对应的处理方法，并把 <code>actionArgs</code> 作为处理方法请求参数的一部分传给处理方法；</li>
<li>处理完成后，把处理结果及 <code>callbackId</code> 返回给 JS 端，JS 端收到后会根据 <code>callbackId</code> 找到回调方法，并把处理结果传给回调方法；</li>
</ul>
</li>
</ol>
<p><img src="http://images.pingan8787.com/20190623HybridApp13.png" alt="iOS"></p>
<ol start="4">
<li>JS 端根据 <code>callbackId</code> 回调 <code>cordova.js</code></li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据 callbackId 及是否成功标识，找到回调方法，并把处理结果传给回调方法</span></span><br><span class="line"><span class="attr">callbackFromNative</span>: <span class="function"><span class="keyword">function</span>(<span class="params">callbackId, success, status, args, keepCallback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> callback = cordova.callbacks[callbackId];</span><br><span class="line">    <span class="keyword">if</span> (callback) &#123;</span><br><span class="line">        <span class="keyword">if</span> (success &amp;&amp; status == cordova.callbackStatus.OK) &#123;</span><br><span class="line">            callback.success &amp;&amp; callback.success.apply(<span class="literal">null</span>, args);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">            callback.fail &amp;&amp; callback.fail.apply(<span class="literal">null</span>, args);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Clear callback if not expecting any more results</span></span><br><span class="line">        <span class="keyword">if</span> (!keepCallback) &#123;</span><br><span class="line">            <span class="keyword">delete</span> cordova.callbacks[callbackId];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="四、什么是-JS-Bridge，它的作用是什么"><a href="#四、什么是-JS-Bridge，它的作用是什么" class="headerlink" title="四、什么是 JS Bridge，它的作用是什么"></a>四、什么是 JS Bridge，它的作用是什么</h3><p>参考文章：<a target="_blank" rel="noopener" href="https://juejin.im/post/5abca877f265da238155b6bc">《JSBridge的原理》</a></p>
<h4 id="4-1-JS-Bridge-介绍"><a href="#4-1-JS-Bridge-介绍" class="headerlink" title="4.1 JS Bridge 介绍"></a>4.1 JS Bridge 介绍</h4><p>JSBridge 简单来讲，主要是 <strong>给 JavaScript 提供调用 Native 功能的接口</strong>，让混合开发中的<strong>前端部分</strong>可以方便地使用地址位置、摄像头甚至支付等 Native 功能。</p>
<p>JSBridge 就像其名称中的 <strong>“Bridge”</strong> 的意义一样，<strong>是 Native 和非 Native 之间的桥梁</strong>，它的核心是 <strong>构建 Native 和非 Native 间消息通信的通道，而且是 双向通信的通道</strong>。</p>
<p>JSBridge 另一个叫法及大家熟知的 Hybrid app 技术。</p>
<p><img src="http://images.pingan8787.com/20190623HybridApp4.png" alt="brige"></p>
<p>所谓 <strong>双向通信的通道</strong>:</p>
<ul>
<li>JS 向 Native 发送消息 : </li>
</ul>
<p>调用相关功能、通知 Native 当前 JS 的相关状态等。</p>
<ul>
<li>Native 向 JS 发送消息 : </li>
</ul>
<p>回溯调用结果、消息推送、通知 JS 当前 Native 的状态等。</p>
<h4 id="4-2-JS-Bridge-实现原理"><a href="#4-2-JS-Bridge-实现原理" class="headerlink" title="4.2. JS Bridge 实现原理"></a>4.2. JS Bridge 实现原理</h4><p>参考文章：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/dailc/p/5931324.html">《Hybrid APP基础篇(四)-&gt;JSBridge的原理》</a></p>
<p><strong>Android 和 iOS 的 JSBridge 实现方式：</strong>  </p>
<p><img src="http://images.pingan8787.com/20190623HybridApp9.jpeg" alt="brige原理"></p>
<h5 id="4-2-1-基本流程"><a href="#4-2-1-基本流程" class="headerlink" title="4.2.1 基本流程"></a>4.2.1 基本流程</h5><p><img src="http://images.pingan8787.com/20190623HybridApp5.png" alt="brige原理"></p>
<ul>
<li>H5 页面通过某种方式触发一个 <code>url scheme </code>；  </li>
<li>Native 捕获到 <code>url scheme</code>，并进行分析和处理；  </li>
<li>Native 调用 H5 的 JSBridge 对象传递回调；  </li>
</ul>
<p>原生的 WebView/UIWebView 控件已经能够和 JS 实现数据通信了，那为什么还要 JSBridge呢？</p>
<p>其实使用JSBridge有很多方面的考虑：</p>
<ul>
<li>Android4.2以下，<code>addJavascriptInterface</code> 方式有安全漏掉。</li>
<li>iOS7以下，JS 无法调用 Native。</li>
<li><code>url scheme</code> 交互方式是一套现有的成熟方案，可以完美兼容各种版本，对以前老版本技术的兼容。</li>
</ul>
<h5 id="4-2-1-实现流程-Android-为例"><a href="#4-2-1-实现流程-Android-为例" class="headerlink" title="4.2.1 实现流程(Android 为例)"></a>4.2.1 实现流程(Android 为例)</h5><p><img src="http://images.pingan8787.com/20190623HybridApp10.png" alt="brige原理"></p>
<ol>
<li>拟定协议，参考 http 制定的协议为：<code>jsbridge://className:port/methodName?jsonObj</code>；   </li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">className   // Android端实现暴露给前端的类名</span><br><span class="line">port        // Android返回结果给前端的端口</span><br><span class="line">methodName  // 前端需要调用的函数</span><br><span class="line">jsonObj     // 前端给Android传递的参数</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>新建 HTML 文件命名为 <code>index.html</code>, 编写一个 <code>button</code> 绑定 <code>click</code> 事件；</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;JSBridge.call(</span></span></span><br><span class="line"><span class="string"><span class="tag">    &#x27;bridge&#x27;,</span></span></span><br><span class="line"><span class="string"><span class="tag">    &#x27;showToast&#x27;,</span></span></span><br><span class="line"><span class="string"><span class="tag">    &#123;&#x27;msg&#x27;:&#x27;Hello JSBridge&#x27;&#125;,</span></span></span><br><span class="line"><span class="string"><span class="tag">    function(res)&#123;</span></span></span><br><span class="line"><span class="string"><span class="tag">        alert(JSON.stringify(res))</span></span></span><br><span class="line"><span class="string"><span class="tag">    &#125;</span></span></span><br><span class="line"><span class="string"><span class="tag">)&quot;</span>&gt;</span></span><br><span class="line">    测试showToast </span><br><span class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>新建 JS 文件命名为 <code>JSBridge.js</code>， 第2步中的 <code>JSBridge.call</code> 即为调用 <code>JSBridge.js </code>中的 <code>call</code> 方法，后面带了四个参数；   </li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">call: <span class="function"><span class="keyword">function</span> (<span class="params">obj, method, params, callback</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(obj+<span class="string">&quot; &quot;</span>+method+<span class="string">&quot; &quot;</span>+params+<span class="string">&quot; &quot;</span>+callback);</span><br><span class="line">    <span class="keyword">var</span> port = Util.getPort();</span><br><span class="line">    <span class="built_in">console</span>.log(port);</span><br><span class="line">    <span class="built_in">this</span>.callbacks[port] = callback;</span><br><span class="line">    <span class="keyword">var</span> uri=Util.getUri(obj,method,params,port);</span><br><span class="line">    <span class="built_in">console</span>.log(uri);</span><br><span class="line">    <span class="built_in">window</span>.prompt(uri, <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p><code>JSBridge.js</code> 中的 <code>call</code> 方法，最后调用了<code> window.prompt</code> 方法，这个方法就是触发 Android 端 <code>webChromeClient </code>的回调函数用的。</p>
<ol start="4">
<li><code>window.prompt</code> 触发了 <code>WebChromeClient</code>（这个需要使用函数<code>WebView.setWebChromeClient</code>( <code>new WebChromeClietn()</code> )进行设定）；</li>
</ol>
<p>类中的如下回调 <code>onJsPrompt</code>。这时就完成了前端与 Android端 的通信了，因为前端的信息都顺利通过这个函数传递给Android了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onJsPrompt</span><span class="params">(WebView view, String url, String message, String defaultValue, JsPromptResult result)</span> </span>&#123;</span><br><span class="line">    result.confirm(JSBridge.callJava(view,message));</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>Android 中会定义一个类 <code>JSBridge.java</code> 来管理暴露给前端使用的函数；</li>
</ol>
<p>这个类有两个功能：</p>
<ul>
<li>暴露给前端的函数的动态注册功能。</li>
<li>解析前端信息，调用了 Android 端对应的函数，这个示例中是：<code>showToast</code> 函数。</li>
</ul>
<p>解析前端的信息，获取前端调用的函数名：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Uri uri = Uri.parse(uriString);</span><br><span class="line">className = uri.getHost();</span><br><span class="line">param = uri.getQuery();</span><br><span class="line">port = uri.getPort() + <span class="string">&quot;&quot;</span>;</span><br><span class="line">String path = uri.getPath();</span><br><span class="line">HashMap&lt; String, Method&gt; methodHashMap = exposedMethod.get(className);</span><br><span class="line">Method method = methodHashMap.get(methodName);</span><br></pre></td></tr></table></figure>
<p>通过获取的函数名，这里是 <code>showToast </code>，调用 Android 端的 <code>showToast </code>函数。   </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">method.invoke(<span class="keyword">null</span>,webView,<span class="keyword">new</span> JSONObject(param),<span class="keyword">new</span> Callback(webView,port));</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>定义类 <code>BridgeImpl.java</code> 来具体的实现暴露给前端的所有函数。这里的 <code>showToast </code>函数如下:</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public <span class="keyword">static</span> <span class="keyword">void</span> <span class="function"><span class="title">showToast</span>(<span class="params">WebView webView, JSONObject param, final JSBridge.Callback callback</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">String</span> message = param.optString(<span class="string">&quot;msg&quot;</span>);</span><br><span class="line">    Toast.makeText(webView.getContext(),message,Toast.LENGTH_LONG).show();</span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">null</span> != callback)&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            JSONObject object = <span class="keyword">new</span> JSONObject();</span><br><span class="line">            object.put(<span class="string">&quot;key&quot;</span>,<span class="string">&quot;value&quot;</span>);</span><br><span class="line">            object.put(<span class="string">&quot;key1&quot;</span>,<span class="string">&quot;vaule1&quot;</span>);</span><br><span class="line">            callback.apply(getJSONObject(<span class="number">0</span>,<span class="string">&quot;ok&quot;</span>,object));</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="五、请列举-Android-与-iOS-平台下-JS-Bridge-的实现方式"><a href="#五、请列举-Android-与-iOS-平台下-JS-Bridge-的实现方式" class="headerlink" title="五、请列举 Android 与 iOS 平台下 JS Bridge 的实现方式"></a>五、请列举 Android 与 iOS 平台下 JS Bridge 的实现方式</h3><blockquote>
<p>这边代码比较多，我使用图片来展示，大家可以放大来查看。   </p>
</blockquote>
<h4 id="5-1-Android-实现方式"><a href="#5-1-Android-实现方式" class="headerlink" title="5.1 Android 实现方式"></a>5.1 Android 实现方式</h4><h5 id="5-1-1-Android-调用-JS-的-2-种方式"><a href="#5-1-1-Android-调用-JS-的-2-种方式" class="headerlink" title="5.1.1 Android 调用 JS 的 2 种方式"></a>5.1.1 Android 调用 JS 的 2 种方式</h5><ol>
<li><strong>通过</strong> <code>WebView</code> <strong>的</strong> <code>loadUrl()</code>:   </li>
</ol>
<p>JS 代码调用一定要在 <code>onPageFinished()</code> 回调之后才能调用，否则不会调用。    </p>
<p><strong>Web 端代码：</strong>   </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>前端代码<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// Android需要调用的方法</span></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">callJS</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            alert(<span class="string">&quot;Android调用了JS的callJS方法&quot;</span>);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>Android 端代码：</strong>   </p>
<p><img src="http://images.pingan8787.com/20190623HybridApp11.png" alt="Android"></p>
<ol start="2">
<li><strong>通过</strong> <code>WebView</code> <strong>的</strong>  <code>evaluateJavascript()</code>：  </li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 只需要将第一种方法的loadUrl()换成下面该方法即可</span></span><br><span class="line">mWebView.evaluateJavascript(</span><br><span class="line">    <span class="string">&quot;javascript:callJS()&quot;</span>, </span><br><span class="line">    <span class="keyword">new</span> ValueCallback&lt;<span class="built_in">String</span>&gt;() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public <span class="keyword">void</span> <span class="function"><span class="title">onReceiveValue</span>(<span class="params"><span class="built_in">String</span> value</span>)</span> &#123;</span><br><span class="line">            <span class="comment">//此处为 js 返回的结果</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h5 id="5-1-2-JS-调用-Android-的-3-种方式"><a href="#5-1-2-JS-调用-Android-的-3-种方式" class="headerlink" title="5.1.2 JS 调用 Android 的 3 种方式"></a>5.1.2 JS 调用 Android 的 3 种方式</h5><ol>
<li><strong>通过 <code>WebView</code> 的 <code>addJavascriptInterface()</code> 进行对象映射</strong>:   </li>
</ol>
<p><strong>Android 映射：</strong>   </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 继承自Object类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AndroidtoJs</span> <span class="keyword">extends</span> <span class="title">Object</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 定义JS需要调用的方法</span></span><br><span class="line">    <span class="comment">// 被JS调用的方法必须加入@JavascriptInterface注解</span></span><br><span class="line">    <span class="meta">@JavascriptInterface</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;JS调用了Android的hello方法&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Web：</strong>   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="xml">   <span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">title</span>&gt;</span>前端代码<span class="tag">&lt;/<span class="name">title</span>&gt;</span>  </span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span></span><br><span class="line"><span class="javascript"><span class="xml">         <span class="function"><span class="keyword">function</span> <span class="title">callAndroid</span>(<span class="params"></span>)</span>&#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">        <span class="comment">// 由于对象映射，所以调用test对象等于调用Android映射的对象</span></span></span></span><br><span class="line"><span class="javascript"><span class="xml">            test.hello(<span class="string">&quot;js调用了android中的hello方法&quot;</span>);</span></span></span><br><span class="line"><span class="javascript"><span class="xml">         &#125;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">      </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="xml">   <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml">   <span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml">      //点击按钮则调用callAndroid函数</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;button1&quot;</span> &quot;<span class="attr">callAndroid</span>()&quot;&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">   <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p><strong>Android 端：</strong>   </p>
<p><img src="http://images.pingan8787.com/20190623HybridApp15.png" alt="Android"></p>
<ol start="2">
<li><strong>通过 <code>WebViewClient</code> 的 <code>shouldOverrideUrlLoading ()</code> 方法回调拦截 <code>url</code>：</strong></li>
</ol>
<p><strong>Web 端：</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>前端代码<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">            <span class="function"><span class="keyword">function</span> <span class="title">callAndroid</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">/*约定的url协议为：js://webview?arg1=111&amp;arg2=222*/</span></span></span><br><span class="line"><span class="javascript">                <span class="built_in">document</span>.location = <span class="string">&quot;js://webview?arg1=111&amp;arg2=222&quot;</span>;</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 点击按钮则调用callAndroid（）方法  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;button1&quot;</span> </span></span><br><span class="line"><span class="tag">            <span class="attr">onclick</span>=<span class="string">&quot;callAndroid()&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span>点击调用Android代码<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>Android 端：</strong>  </p>
<p><img src="http://images.pingan8787.com/20190623HybridApp16.png" alt="Android"></p>
<ol start="3">
<li><strong>通过 WebChromeClient 的方法回调拦截JS对话框方法：</strong></li>
</ol>
<p>通过 WebChromeClient 的 <code>onJsAlert()</code> 、<code>onJsConfirm()</code> 、<code>onJsPrompt()</code>方法回调拦截JS对话框 <code>alert()</code> 、<code>confirm()</code>、<code>prompt()</code> 消息。   </p>
<p><strong>Web 端：</strong>   </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>前端代码<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">            <span class="function"><span class="keyword">function</span> <span class="title">clickprompt</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// 调用prompt（）</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> result=prompt(<span class="string">&quot;js://demo?arg1=111&amp;arg2=222&quot;</span>);</span></span><br><span class="line"><span class="javascript">                alert(<span class="string">&quot;demo &quot;</span> + result);</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 点击按钮则调用clickprompt()  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;button1&quot;</span> </span></span><br><span class="line"><span class="tag">            <span class="attr">onclick</span>=<span class="string">&quot;clickprompt()&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span>点击调用Android代码<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>Android 端：</strong>  </p>
<p><img src="http://images.pingan8787.com/20190623HybridApp17.png" alt="Android"></p>
<h4 id="5-2-iOS-实现方式"><a href="#5-2-iOS-实现方式" class="headerlink" title="5.2 iOS 实现方式"></a>5.2 iOS 实现方式</h4><h5 id="5-2-1-JS-调用-iOS-的-2-种方式"><a href="#5-2-1-JS-调用-iOS-的-2-种方式" class="headerlink" title="5.2.1 JS 调用 iOS 的 2 种方式"></a>5.2.1 JS 调用 iOS 的 2 种方式</h5><ol>
<li><strong>使用 <code>XMLHttpRequest</code> 发起请求的方式：</strong></li>
</ol>
<p><strong>Web 端：</strong>   </p>
<p><img src="http://images.pingan8787.com/20190623HybridApp18.png" alt="iOS"></p>
<p><strong>XMLHttpRequest bridge：</strong></p>
<p>JS 端使用 <code>XMLHttpRequest</code> 发起了一个请求：<code>execXhr.open(&#39;HEAD&#39;, &quot;/!gap_exec?&quot; + (+new Date()), true);</code>，请求的地址是 <code>/!gap_exec</code>；并把请求的数据放在了请求的 header 里面，见这句代码：<code>execXhr.setRequestHeader(&#39;cmds&#39;, iOSExec.nativeFetchMessages());</code>。</p>
<p>而在 Objective-C 端使用一个 <code>NSURLProtocol</code> 的子类来检查每个请求，如果地址是 <code>/!gap_exec</code> 的话，则认为是 Cordova 通信的请求，直接拦截，拦截后就可以通过分析请求的数据，分发到不同的插件类(CDVPlugin 类的子类)的方法中：</p>
<p><img src="http://images.pingan8787.com/20190623HybridApp19.png" alt="iOS"></p>
<p>Cordova 中优先使用这种方式，<code> Cordova.js</code>  中的注释有提及为什么优先使用 <code> XMLHttpRequest</code>  的方式，及为什么保留第二种 <code>iframe bridge</code> 的通信方式:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// XHR mode does not work on iOS 4.2, so default to IFRAME_NAV for such devices.</span><br><span class="line">// XHR mode’s main advantage is working around a bug in -webkit-scroll, which</span><br><span class="line">// doesn’t exist in 4.X devices anyways123</span><br></pre></td></tr></table></figure>

<p><strong>iframe bridge：</strong></p>
<p>在 JS 端创建一个透明的 <code>iframe</code>，设置这个 <code>ifame</code> 的 <code>src</code> 为自定义的协议，而 <code>ifame </code>的 <code>src</code> 更改时，<code>UIWebView</code> 会先回调其 <code>delegate</code> 的 <code>webView:shouldStartLoadWithRequest:navigationType:</code> 方法，关键代码如下：</p>
<p><img src="http://images.pingan8787.com/20190623HybridApp20.png" alt="iOS"></p>
<ol start="2">
<li><strong>通过设置透明的 <code>iframe</code> 的 <code>src</code> 属性：</strong></li>
</ol>
<h5 id="5-2-2-iOS-调用-JS-的方式"><a href="#5-2-2-iOS-调用-JS-的方式" class="headerlink" title="5.2.2 iOS 调用 JS 的方式"></a>5.2.2 iOS 调用 JS 的方式</h5><p><code>UIWebView</code> 有一个这样的方法 <code>stringByEvaluatingJavaScriptFromString:</code>，这个方法可以让一个 <code>UIWebView</code> 对象执行一段 JS 代码，这样就可以达到 Objective-C 跟 JS 通信的效果，在 Cordova 的代码中多处用到了这个方法，其中最重要的两处如下：</p>
<ol>
<li><strong>获取 JS 的请求数据：</strong></li>
</ol>
<p><img src="http://images.pingan8787.com/20190623HybridApp21.png" alt="iOS"></p>
<ol start="2">
<li><strong>把 JS 请求的结果返回给 JS 端：</strong></li>
</ol>
<p><img src="http://images.pingan8787.com/20190623HybridApp22.png" alt="iOS"></p>
<h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>对于初入混合应用开发的小伙伴，这些会有点难度，但是好好理解下那几张流程图，再理一理思路，相信会有帮助😁</p>
<p>给大家加加油~~</p>
<h3 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h3><blockquote>
<p>本文首发在 <a target="_blank" rel="noopener" href="http://www.pingan8787.com/">pingan8787个人博客</a>，如需转载请保留个人介绍</p>
</blockquote>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#x70;&#105;&#x6e;&#103;&#x61;&#x6e;&#56;&#x37;&#x38;&#x37;&#64;&#x71;&#x71;&#46;&#99;&#111;&#x6d;">&#x70;&#105;&#x6e;&#103;&#x61;&#x6e;&#56;&#x37;&#x38;&#x37;&#64;&#x71;&#x71;&#46;&#99;&#111;&#x6d;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>ES小册</td>
<td>js.pingan8787.com</td>
</tr>
</tbody></table>
<h2 id="微信公众号"><a href="#微信公众号" class="headerlink" title="微信公众号"></a>微信公众号</h2><p><img src="http://images.pingan8787.com/2019_07_12guild_page.png" alt="bg">  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/06/26/165-%E3%80%90Hybrid%E3%80%91HybridApp%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E4%B8%AD5%E4%B8%AA%E5%BF%85%E5%A4%87%E7%9F%A5%E8%AF%86%E7%82%B9%E5%A4%8D%E4%B9%A0/" data-id="ckts3ejy500m24d9k1thxdbbq" data-title="165-【Hybrid】HybridApp应用开发中5个必备知识点复习" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTTP/" rel="tag">HTTP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hybrid/" rel="tag">Hybrid</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-164-【HTTP】HTTP的15个常见知识点复习" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/06/22/164-%E3%80%90HTTP%E3%80%91HTTP%E7%9A%8415%E4%B8%AA%E5%B8%B8%E8%A7%81%E7%9F%A5%E8%AF%86%E7%82%B9%E5%A4%8D%E4%B9%A0/" class="article-date">
  <time class="dt-published" datetime="2019-06-22T08:45:24.000Z" itemprop="datePublished">2019-06-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/06/22/164-%E3%80%90HTTP%E3%80%91HTTP%E7%9A%8415%E4%B8%AA%E5%B8%B8%E8%A7%81%E7%9F%A5%E8%AF%86%E7%82%B9%E5%A4%8D%E4%B9%A0/">164-【HTTP】HTTP的15个常见知识点复习</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <hr>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#112;&#x69;&#110;&#x67;&#97;&#x6e;&#x38;&#x37;&#56;&#55;&#64;&#x71;&#113;&#x2e;&#x63;&#x6f;&#109;">&#112;&#x69;&#110;&#x67;&#97;&#x6e;&#x38;&#x37;&#56;&#55;&#64;&#x71;&#113;&#x2e;&#x63;&#x6f;&#109;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>微信公众号</td>
<td>前端自习课</td>
</tr>
</tbody></table>
<p><img src="http://images.pingan8787.com/HTTP%E5%B0%81%E9%9D%A2.png" alt="封面"></p>
<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>自从入职新公司到现在，我们前端团队内部一直在做 📖<strong>每周一练</strong> 的知识复习计划，我之前整理了一个 <strong><a target="_blank" rel="noopener" href="https://juejin.im/post/5ce2a20e6fb9a07ebb05061c">每周一练 之 数据结构与算法</a></strong> 学习内容，大家也快去看看~~</p>
<p>最近三周，主要复习 <strong>网络基础</strong> 相关的知识，今天我把这三周复习的知识和参考答案，整理成本文，欢迎各位朋友互相学习和指点，觉得本文不错，也欢迎点赞哈💕💕。   </p>
<p>特别喜欢现在的每周学习和分享，哈哈哈~~😄</p>
<p>📅推荐一个 github 仓库 —— <a target="_blank" rel="noopener" href="https://github.com/semlinker/awesome-http">《awesome-http》</a>，内容挺棒的。</p>
<blockquote>
<p>注：本文整理资料来源网络，有些图片/段落找不到原文出处，如有侵权，联系删除。</p>
</blockquote>
<h3 id="一-简述浏览器输入-URL-地址后发生的事情"><a href="#一-简述浏览器输入-URL-地址后发生的事情" class="headerlink" title="一. 简述浏览器输入 URL 地址后发生的事情"></a>一. 简述浏览器输入 URL 地址后发生的事情</h3><h4 id="1-1-描述"><a href="#1-1-描述" class="headerlink" title="1.1 描述"></a>1.1 描述</h4><ol>
<li>浏览器向 DNS 服务器查找输入 URL 对应的 IP 地址。</li>
<li>NS 服务器返回网站的 IP 地址。</li>
<li>浏览器根据 IP 地址与目标 web 服务器在 80 端口上建立 TCP 连接。</li>
<li>浏览器获取请求页面的 HTML 代码。</li>
<li>浏览器在显示窗口内渲染 HTML 。</li>
<li>窗口关闭时，浏览器终止与服务器的连接。</li>
</ol>
<h4 id="1-2-TCP-知识点补充"><a href="#1-2-TCP-知识点补充" class="headerlink" title="1.2 TCP 知识点补充"></a>1.2 TCP 知识点补充</h4><p>参考文章：<a target="_blank" rel="noopener" href="http://swiftlet.net/archives/1082">《TCP三次握手和四次挥手协议》</a></p>
<p>建立 TCP 需要三次握手才能建立，而断开连接则需要四次握手。整个过程如下图所示：</p>
<p><img src="http://images.pingan8787.com/20190622http3.jpg" alt="http3"></p>
<p><strong>TCP三次握手</strong>：   </p>
<p>所谓的三次握手，是指建立一个 TCP 连接时，需要客户端和服务器端总共发送三个包，三次握手的目的是连接服务器的指定端口，建立 TCP 连接，并同步连接双方的序列号和确认号并交换 TCP 窗口大小信息，在 SOCKET 编程中，客户端执行 connect() 时，将会触发三次握手：   </p>
<p><img src="http://images.pingan8787.com/20190622http1.png" alt="http1"></p>
<p><strong>TCP四次挥手：</strong></p>
<p>TCP连接的拆除需要发送四个包，客户端或者服务器端均可主动发起挥手动作，在SOCKET编程中，任何一方执行close()即可产生挥手操作。    </p>
<p><img src="http://images.pingan8787.com/20190622http2.jpg" alt="http2"></p>
<h3 id="2-请介绍常见的-HTTP-状态码-至少五个"><a href="#2-请介绍常见的-HTTP-状态码-至少五个" class="headerlink" title="2. 请介绍常见的 HTTP 状态码(至少五个)"></a>2. 请介绍常见的 HTTP 状态码(至少五个)</h3><p>状态码是由 3 位数组成，第一个数字定义了响应的类别，且有五种可能取值:   </p>
<p><strong>1xx：指示信息–表示请求已接收，继续处理。</strong></p>
<ul>
<li><p>100 客户必须继续发出请求</p>
</li>
<li><p>101 客户要求服务器根据请求转换HTTP协议版本</p>
</li>
</ul>
<p><strong>2xx：成功–表示请求已被成功接收、理解、接受。</strong></p>
<ul>
<li><p>200 （成功） 服务器已成功处理了请求。 通常，这表示服务器提供了请求的网页。</p>
</li>
<li><p>201 （已创建） 请求成功并且服务器创建了新的资源。</p>
</li>
<li><p>202 （已接受） 服务器已接受请求，但尚未处理。</p>
</li>
</ul>
<p><strong>3xx：重定向–要完成请求必须进行更进一步的操作。</strong></p>
<ul>
<li><p>300 （多种选择） 针对请求，服务器可执行多种操作。 服务器可根据请求者 (user agent) 选择一项操作，或提供操作列表供请求者选择。</p>
</li>
<li><p>301 （永久移动） 请求的网页已永久移动到新位置。 服务器返回此响应（对 GET 或 HEAD 请求的响应）时，会自动将请求者转到新位置。</p>
</li>
<li><p>302 （临时移动） 服务器目前从不同位置的网页响应请求，但请求者应继续使用原有位置来进行以后的请求。</p>
</li>
</ul>
<p><strong>4xx：客户端错误–请求有语法错误或请求无法实现。</strong></p>
<ul>
<li><p>400 （错误请求） 服务器不理解请求的语法。</p>
</li>
<li><p>401 （未授权） 请求要求身份验证。 对于需要登录的网页，服务器可能返回此响应。</p>
</li>
<li><p>403 （禁止） 服务器拒绝请求。</p>
</li>
</ul>
<p><strong>5xx：服务器端错误–服务器未能实现合法的请求。</strong></p>
<ul>
<li><p>500 （服务器内部错误） 服务器遇到错误，无法完成请求。</p>
</li>
<li><p>501 （尚未实施） 服务器不具备完成请求的功能。 例如，服务器无法识别请求方法时可能会返回此代码。</p>
</li>
<li><p>502 （错误网关） 服务器作为网关或代理，从上游服务器收到无效响应。</p>
</li>
<li><p>503 （服务不可用） 服务器目前无法使用（由于超载或停机维护）。 通常，这只是暂时状态。</p>
</li>
<li><p>504 （网关超时） 服务器作为网关或代理，但是没有及时从上游服务器收到请求。</p>
</li>
<li><p>505 （HTTP 版本不受支持） 服务器不支持请求中所用的 HTTP 协议版本。</p>
</li>
</ul>
<h3 id="3-请介绍常见的-HTTP-头部-至少五个"><a href="#3-请介绍常见的-HTTP-头部-至少五个" class="headerlink" title="3. 请介绍常见的 HTTP 头部(至少五个)"></a>3. 请介绍常见的 HTTP 头部(至少五个)</h3><h3 id="3-1-HTTP-头部"><a href="#3-1-HTTP-头部" class="headerlink" title="3.1 HTTP 头部"></a>3.1 HTTP 头部</h3><p>更多完整内容，可以查看 <a href="tools.jb51.net/table/http_header">《HTTP响应头和请求头信息对照表》</a></p>
<table>
<thead>
<tr>
<th align="center">首部字段名</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>Accept</code></td>
<td>告诉服务器，客户端支持的数据类型。</td>
</tr>
<tr>
<td align="center"><code>Accept-Charset</code></td>
<td>告诉服务器，客户端采用的编码。</td>
</tr>
<tr>
<td align="center"><code>Accept-Encoding</code></td>
<td>告诉服务器，客户机支持的数据压缩格式。</td>
</tr>
<tr>
<td align="center"><code>Accept-Language</code></td>
<td>告诉服务器，客户机的语言环境。</td>
</tr>
<tr>
<td align="center"><code>Host</code></td>
<td>客户机通过这个头告诉服务器，想访问的主机名。</td>
</tr>
<tr>
<td align="center"><code>If-Modified-Since</code></td>
<td>客户机通过这个头告诉服务器，资源的缓存时间。</td>
</tr>
<tr>
<td align="center"><code>Referer</code></td>
<td>客户机通过这个头告诉服务器，它是从哪个资源来访问服务器的。（一般用于防盗链）</td>
</tr>
<tr>
<td align="center"><code>User-Agent</code></td>
<td>客户机通过这个头告诉服务器，客户机的软件环境。</td>
</tr>
<tr>
<td align="center"><code>Cookie</code></td>
<td>客户机通过这个头告诉服务器，可以向服务器带数据。</td>
</tr>
<tr>
<td align="center"><code>Connection</code></td>
<td>客户机通过这个头告诉服务器，请求完后是关闭还是保持链接。</td>
</tr>
<tr>
<td align="center"><code>Date</code></td>
<td>客户机通过这个头告诉服务器，客户机当前请求时间</td>
</tr>
</tbody></table>
<h3 id="3-2-Request-Header"><a href="#3-2-Request-Header" class="headerlink" title="3.2 Request Header"></a>3.2 Request Header</h3><p>参考文章：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/amiezhang/p/9389840.html">《HTTP常用头部信息》</a>   </p>
<p>举例：<br>| Request Header |描述|<br>|—|—|<br>|<code>GET /sample.Jsp HTTP/1.1</code>  |请求行|<br>|<code>Host: www.uuid.online/</code>  |请求的目标域名和端口号|<br>|<code>Origin: http://localhost:8081/</code>  |请求的来源域名和端口号 （跨域请求时，浏览器会自动带上这个头信息）|<br>|<code>Referer: https:/localhost:8081/link?query=xxxxx</code>  |请求资源的完整URI|<br>|<code>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36</code> |浏览器信息|<br>|<code>Cookie: BAIDUID=FA89F036:FG=1; BD_HOME=1; sugstore=0</code>  |当前域名下的Cookie|<br>|<code>Accept: text/html,image/apng</code>  |代表客户端希望接受的数据类型是html或者是png图片类型 |<br>|<code>Accept-Encoding: gzip, deflate</code>  |代表客户端能支持 gzip 和 deflate 格式的压缩|<br>|<code>Accept-Language: zh-CN,zh;q=0.9</code> |代表客户端可以支持语言 zh-CN 或者 zh (值得一提的是q(0~1)是优先级权重的意思，不写默认为1，这里 zh-CN 是1， zh 是0.9)|<br>|<code>Connection: keep-alive</code>  |告诉服务器，客户端需要的 tcp 连接是一个长连接|</p>
<h3 id="3-3-Response-Header"><a href="#3-3-Response-Header" class="headerlink" title="3.3 Response Header"></a>3.3 Response Header</h3><p>参考文章：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/amiezhang/p/9389840.html">《HTTP常用头部信息》</a>   </p>
<p>举例：</p>
<table>
<thead>
<tr>
<th>Response Header</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>HTTP/1.1 200 OK</code></td>
<td>响应状态行</td>
</tr>
<tr>
<td><code>Date: Mon, 30 Jul 2018 02:50:55 GMT</code></td>
<td>服务端发送资源时的服务器时间</td>
</tr>
<tr>
<td><code>Expires: Wed, 31 Dec 1969 23:59:59 GMT</code></td>
<td>较过时的一种验证缓存的方式，与浏览器（客户端）的时间比较，超过这个时间就不用缓存（不和服务器进行验证），适合版本比较稳定的网页</td>
</tr>
<tr>
<td><code>Cache-Control:  no-cache</code></td>
<td>现在最多使用的控制缓存的方式，会和服务器进行缓存验</td>
</tr>
<tr>
<td><code>etag: &quot;fb8ba2f80b1d324bb997cbe188f28187-ssl-df&quot;</code></td>
<td>一般是Nginx静态服务器发来的静态文件签名，浏览在没有 “Disabled cache” 情况下，接收到 etag 后，同一个 url 第二次请求就会自动带上 “If-None-Match”</td>
</tr>
<tr>
<td><code>Last-Modified: Fri, 27 Jul 2018 11:04:55 GMT</code></td>
<td>服务器发来的当前资源最后一次修改的时间，下次请求时，如果服务器上当前资源的修改时间大于这个时间，就返回新的资源内容</td>
</tr>
<tr>
<td><code>Content-Type: text/html; charset=utf-8</code></td>
<td>如果返回是流式的数据，我们就必须告诉浏览器这个头，不然浏览器会下载这个页面，同时告诉浏览器是utf8编码，否则可能出现乱码</td>
</tr>
<tr>
<td><code>Content-Encoding: gzip</code></td>
<td>告诉客户端，应该采用gzip对资源进行解码</td>
</tr>
<tr>
<td><code>Connection: keep-alive</code></td>
<td>告诉客户端服务器的tcp连接也是一个长连接</td>
</tr>
</tbody></table>
<h3 id="4-请列举常用的-HTTP-方法，并介绍-GET-与-POST-请求之间的区别"><a href="#4-请列举常用的-HTTP-方法，并介绍-GET-与-POST-请求之间的区别" class="headerlink" title="4. 请列举常用的 HTTP 方法，并介绍 GET 与 POST 请求之间的区别"></a>4. 请列举常用的 HTTP 方法，并介绍 GET 与 POST 请求之间的区别</h3><h4 id="4-1-HTTP-Request-Method"><a href="#4-1-HTTP-Request-Method" class="headerlink" title="4.1 HTTP Request Method"></a>4.1 HTTP Request Method</h4><p>参考文章：<a target="_blank" rel="noopener" href="http://tools.jb51.net/table/http_request_method/">《HTTP请求方法对照表》</a>   </p>
<p>根据 HTTP 标准，HTTP 请求可以使用多种请求方法。<br>HTTP1.0 定义了三种请求方法： GET, POST 和 HEAD方法。<br>HTTP/1.1 新增了五种请求方法：OPTIONS, PUT, DELETE, TRACE 和 CONNECT 方法。</p>
<table>
<thead>
<tr>
<th align="center">序号</th>
<th align="center">方法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">GET</td>
<td>请求指定的页面信息，并返回实体主体。</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">HEAD</td>
<td>类似于get请求，只不过返回的响应中没有具体的内容，用于获取报头</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">POST</td>
<td>向指定资源提交数据进行处理请求（例如提交表单或者上传文件）。数据被包含在请求体中。POST请求可能会导致新的资源的建立和/或已有资源的修改。</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">PUT</td>
<td>从客户端向服务器传送的数据取代指定的文档的内容。</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">DELETE</td>
<td>请求服务器删除指定的页面。</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">CONNECT</td>
<td>HTTP/1.1协议中预留给能够将连接改为管道方式的代理服务器。</td>
</tr>
<tr>
<td align="center">7</td>
<td align="center">OPTIONS</td>
<td>允许客户端查看服务器的性能。</td>
</tr>
<tr>
<td align="center">8</td>
<td align="center">TRACE</td>
<td>回显服务器收到的请求，主要用于测试或诊断。</td>
</tr>
<tr>
<td align="center">9</td>
<td align="center">PATCH</td>
<td>实体中包含一个表，表中说明与该URI所表示的原内容的区别。</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">MOVE</td>
<td>请求服务器将指定的页面移至另一个网络地址。</td>
</tr>
<tr>
<td align="center">11</td>
<td align="center">COPY</td>
<td>请求服务器将指定的页面拷贝至另一个网络地址。</td>
</tr>
<tr>
<td align="center">12</td>
<td align="center">LINK</td>
<td>请求服务器建立链接关系。</td>
</tr>
<tr>
<td align="center">13</td>
<td align="center">UNLINK</td>
<td>断开链接关系。</td>
</tr>
<tr>
<td align="center">14</td>
<td align="center">WRAPPED</td>
<td>允许客户端发送经过封装的请求。</td>
</tr>
<tr>
<td align="center">15</td>
<td align="center">Extension-mothed</td>
<td>在不改动协议的前提下，可增加另外的方法。</td>
</tr>
</tbody></table>
<h4 id="4-2-GET-与-POST-请求之间的区别"><a href="#4-2-GET-与-POST-请求之间的区别" class="headerlink" title="4.2 GET 与 POST 请求之间的区别"></a>4.2 GET 与 POST 请求之间的区别</h4><table>
<thead>
<tr>
<th align="center">区别内容</th>
<th>GET</th>
<th>POST</th>
</tr>
</thead>
<tbody><tr>
<td align="center">点击返回/刷新按钮</td>
<td>没有影响</td>
<td>数据会重新发送（浏览器将会提示“数据被重新提交”）</td>
</tr>
<tr>
<td align="center">添加书签</td>
<td>可以</td>
<td>不可以</td>
</tr>
<tr>
<td align="center">缓存</td>
<td>可以</td>
<td>不可以</td>
</tr>
<tr>
<td align="center">编码类型（Encoding type）</td>
<td><code>application/x-www-form-rulencoded</code></td>
<td><code>application/x-www-form-rulencoded</code> or <code>multipart/form-data</code> 请为二进制数据使用 <code>multipart</code> 编码</td>
</tr>
<tr>
<td align="center">历史记录</td>
<td>有</td>
<td>没有</td>
</tr>
<tr>
<td align="center">长度限制</td>
<td>有</td>
<td>没有</td>
</tr>
<tr>
<td align="center">数据类型限制</td>
<td>只允许 ASCLll 字符类型</td>
<td>没有限制，允许二进制数据</td>
</tr>
<tr>
<td align="center">安全性</td>
<td>查询字符串会显示在地址栏的 URL 上，不安全，<strong>请不要使用 GET 请求提交敏感数据</strong></td>
<td>因为数据不会显示在地址栏中，也不会缓存下来或保存在浏览记录中，所以 POST 请求比 GET 请求安全，但也不是最安全的方式，如需要传送敏感数据，<strong>请使用数据加密</strong>。</td>
</tr>
<tr>
<td align="center">可见性</td>
<td>查询字符串在地址栏的 URL 中可见</td>
<td>查询字符串在地址栏的 URL 中不可见</td>
</tr>
</tbody></table>
<h3 id="5-请分别介绍-Cookie-和-Session-的作用及它们之间的区别"><a href="#5-请分别介绍-Cookie-和-Session-的作用及它们之间的区别" class="headerlink" title="5. 请分别介绍 Cookie 和 Session 的作用及它们之间的区别"></a>5. 请分别介绍 Cookie 和 Session 的作用及它们之间的区别</h3><p>参考文章： <a target="_blank" rel="noopener" href="https://juejin.im/post/5cbf0749e51d456e781f2023">《3分钟搞懂Cookie与Session》</a>   </p>
<h4 id="5-1-Cookie简单介绍"><a href="#5-1-Cookie简单介绍" class="headerlink" title="5.1 Cookie简单介绍"></a>5.1 Cookie简单介绍</h4><p>Cookie是存储在用户本地计算机上，用于保存一些用户操作的历史信息，当用户再次访问我们的服务器的时候，浏览器通过HTTP协议，将他们本地的Cookie内容也发到咱们服务器上，从而完成验证。</p>
<p><img src="http://images.pingan8787.com/20190622http4.jpg" alt="http4"></p>
<ul>
<li><code>Cookie</code> 是存储在浏览器客户的一小片数据；</li>
<li><code>Cookie</code> 可以同时被前台与后台操作；</li>
<li><code>Cookie</code> 可以跨页面存取；</li>
<li><code>Cookie</code> 是不可以跨服务器访问的；</li>
<li><code>Cookie</code> 有限制； 每个浏览器存储的个数不能超过300个，每个服务器不能超过20个，数据量不能超过4K；</li>
<li><code>Cookie</code> 是有生命周期的，默认与浏览器相同，如果进程退出，cookie会被销毁</li>
</ul>
<h4 id="5-2-Session"><a href="#5-2-Session" class="headerlink" title="5.2 Session"></a>5.2 Session</h4><p>Session 存储在我们的服务器上，就是在我们的服务器上保存用户的操作信息。</p>
<p>当用户访问我们的网站时，我们的服务器会成一个 <code>Session ID</code>，然后把 <code>Session ID</code> 存储起来，再把这个 <code>Session ID </code>发给我们的用户，用户再次访问我们的服务器的时候，拿着这个 <code>Session ID就 </code>能验证了，当这个ID能与我们服务器上存储的ID对应起来时，我们就可以认为是自己人。</p>
<p><img src="http://images.pingan8787.com/20190622http5.jpg" alt="http5"></p>
<ul>
<li><code>seesion</code> 数据存储在服务器端；</li>
<li>每一个会话分配一个单独的 <code>session_id</code>;</li>
<li>该 <code>session_id</code> 通过 <code>cookie</code> 传送到前台，默认的 <code>session_id</code> 名称是<code>PHPSESSIONID</code>;  </li>
<li>前台只能看到 <code>Session</code> 的 <code>ID</code>，而不能修改 <code>Session</code> 值;</li>
<li>使用 <code>Session </code>之前需要先开启会话;</li>
<li> <code>Session </code>存储在 <code>Session </code>数组 <code>$_SESSION </code>;</li>
<li> <code>Session </code>存储方式比较安全，但是如果 <code>Session </code>数量过多，会导致服务器性能下降;</li>
</ul>
<h4 id="5-3-两者区别"><a href="#5-3-两者区别" class="headerlink" title="5.3 两者区别"></a>5.3 两者区别</h4><table>
<thead>
<tr>
<th></th>
<th>Cookie</th>
<th>session</th>
</tr>
</thead>
<tbody><tr>
<td>定义</td>
<td>浏览器保存用户信息的文件，存储的数量和字符数都有限制</td>
<td>服务器把<code>sessionID</code> 和用户信息、用户操作，记录在服务器上，这些记录就称为<code>session</code></td>
</tr>
<tr>
<td>相同点</td>
<td>都是为了存储用户相关的信息</td>
<td></td>
</tr>
<tr>
<td>存储</td>
<td>客户端</td>
<td>服务器</td>
</tr>
<tr>
<td>安全性</td>
<td>安全性不高，任何人都能直接查看</td>
<td>安全性高</td>
</tr>
</tbody></table>
<h4 id="5-4-两者结合使用"><a href="#5-4-两者结合使用" class="headerlink" title="5.4 两者结合使用"></a>5.4 两者结合使用</h4><ul>
<li><p>存储在服务端：通过 <code>cookie </code>存储一个 <code>session_id </code>，然后具体的数据则是保存在 <code>session </code>中。如果用户已经登录，则服务器会在 <code>cookie </code>中保存一个 <code>session_id </code>，下次再次请求的时候，会把该 <code>session_id </code>携带上来，服务器根据 <code>session_id </code>在 <code>session </code>库中获取用户的 <code>session </code>数据。就能知道该用户到底是谁，以及之前保存的一些状态信息。这种专业术语叫做 <code>server side session </code>。</p>
</li>
<li><p>将 <code>session </code>数据加密，然后存储在 <code>cookie </code>中。这种专业术语叫做 <code>client side session </code>。</p>
</li>
</ul>
<h3 id="6-请介绍-HTTP-请求报文与响应报文格式"><a href="#6-请介绍-HTTP-请求报文与响应报文格式" class="headerlink" title="6. 请介绍 HTTP 请求报文与响应报文格式"></a>6. 请介绍 HTTP 请求报文与响应报文格式</h3><h4 id="6-1-请求报文"><a href="#6-1-请求报文" class="headerlink" title="6.1 请求报文"></a>6.1 请求报文</h4><p><img src="http://images.pingan8787.com/20190622http6.png" alt="http6"></p>
<p>请求报文由<strong>请求行</strong>、<strong>请求头部</strong>和<strong>请求正文</strong>组成：  </p>
<ul>
<li><strong>请求行</strong>  </li>
</ul>
<p>格式为：   </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">请求方法 + 空格 + URL + 空格 + 协议版本 + 回车符 + 换行符</span><br></pre></td></tr></table></figure>

<p>例如：   </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET www.baidu.com HTTP/1.1  </span><br></pre></td></tr></table></figure>

<p>常见的请求方法有：GET，HEAD，PUT，POST，TRACE，OPTIONS，DELETE以及扩展方法。   </p>
<ul>
<li><strong>请求头部</strong>    </li>
</ul>
<p>格式为：   </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">头部字段名 + 冒号（:） + 值 + 回车符 + 换行符</span><br></pre></td></tr></table></figure>

<p>请求头部为请求报文添加了一些附加信息，由“<strong>名/值</strong>”对组成，每行一对，名和值之间使用<strong>冒号</strong>分隔。   </p>
<p>并且，在<strong>请求头部的最后会有一个空行</strong>，表示请求头部结束，这一行必不可少。</p>
<p>典型的请求头部有：   </p>
<table>
<thead>
<tr>
<th>请求头部</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Host</td>
<td>接受请求的服务器地址，可以是IP:端口号，也可以是域名</td>
</tr>
<tr>
<td>User-Agent</td>
<td>发送请求的应用程序名称</td>
</tr>
<tr>
<td>Connection</td>
<td>指定与连接相关的属性，如Connection:Keep-Alive</td>
</tr>
<tr>
<td>Accept-Charset</td>
<td>通知服务端可以发送的编码格式</td>
</tr>
<tr>
<td>Accept-Encoding</td>
<td>通知服务端可以发送的数据压缩格式</td>
</tr>
<tr>
<td>Accept-Language</td>
<td>通知服务端可以发送的语言</td>
</tr>
</tbody></table>
<ul>
<li><strong>请求正文</strong>    </li>
</ul>
<p>一般使用在 <code>POST</code> 方法中， <code>GET</code> 方法不存在请求正文。<br><code>POST</code> 方法适用于需要客户填写表单的场合。与请求数据相关的最常使用的请求头是 <code>Content-Type</code> 和 <code>Content-Length</code> 。</p>
<h4 id="6-2-响应报文"><a href="#6-2-响应报文" class="headerlink" title="6.2 响应报文"></a>6.2 响应报文</h4><p><img src="http://images.pingan8787.com/20190622http7.png" alt="http7"></p>
<p>响应报文由<strong>状态行</strong>、<strong>响应头部</strong>和<strong>响应正文</strong>组成：    </p>
<ul>
<li><strong>状态行</strong>  </li>
</ul>
<p>格式为：   </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">协议版本 + 空格 + 状态码 + 空格 + 状态码描述 + 回车符 + 换行符</span><br></pre></td></tr></table></figure>

<p>状态码划分：   </p>
<p>100〜199的状态码是 HTTP / 1.1 向协议中引入了<strong>信息性状态码</strong>；<br>200〜299的状态码表示<strong>成功</strong>；<br>300〜399的状态码指<strong>资源重定向</strong>；<br>400〜499的状态码指<strong>客户端请求出错</strong>；<br>500〜599的状态码指<strong>服务端出错</strong>；  </p>
<p>常见的状态码：   </p>
<table>
<thead>
<tr>
<th>状态码</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>200</td>
<td>响应成功</td>
</tr>
<tr>
<td>302</td>
<td>跳转，跳转地址通过响应头中的位置属性指定（JSP中Forward和Redirect之间的区别）</td>
</tr>
<tr>
<td>400</td>
<td>客户端请求有语法错误，不能被服务器识别</td>
</tr>
<tr>
<td>403</td>
<td>服务器接收到请求，但是拒绝提供服务（认证失败）</td>
</tr>
<tr>
<td>404</td>
<td>请求资源不存在</td>
</tr>
<tr>
<td>500</td>
<td>服务器内部错误</td>
</tr>
</tbody></table>
<ul>
<li><strong>响应头部</strong>    </li>
</ul>
<p>格式为：   </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">头部字段名 + 冒号（:） + 值 + 回车符 + 换行符</span><br></pre></td></tr></table></figure>

<p>常见响应头部：   </p>
<table>
<thead>
<tr>
<th>响应头部</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>Server</code></td>
<td>服务器应用程序软件的名称和版本</td>
</tr>
<tr>
<td><code>Content-Type</code></td>
<td>响应正文的类型（是图片还是二进制字符串）</td>
</tr>
<tr>
<td><code>Content-Length</code></td>
<td>响应正文长度</td>
</tr>
<tr>
<td><code>Content-Charset</code></td>
<td>响应正文使用的编码</td>
</tr>
<tr>
<td><code>Content-Encoding</code></td>
<td>响应正文使用的数据压缩格式</td>
</tr>
<tr>
<td><code>Content-Language</code></td>
<td>响应正文使用的语言</td>
</tr>
</tbody></table>
<h3 id="7-HTTP-1-1-有什么优缺点"><a href="#7-HTTP-1-1-有什么优缺点" class="headerlink" title="7. HTTP/1.1 有什么优缺点"></a>7. HTTP/1.1 有什么优缺点</h3><p>参考文章：<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000013028798?utm_source=tag-newest">《HTTP/1.0 HTTP/1.1 HTTP/2.0 主要特性对比》</a></p>
<p>对于 <code>HTTP/1.1 </code>，不仅继承了 <code>HTTP1.0 </code>简单的特点，还克服了诸多 <code>HTTP1.0 </code>性能上的问题。 </p>
<h4 id="7-1-HTTP-1-1-优点"><a href="#7-1-HTTP-1-1-优点" class="headerlink" title="7.1 HTTP/1.1 优点"></a>7.1 HTTP/1.1 优点</h4><ol>
<li>增加持久性连接</li>
</ol>
<p>也就是多个请求和响应可以利用同一个 TCP 连接，而不是每一次请求响应都要新建一个TCP连接，减少了建立和关闭连接的消耗和延迟。   </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Connection: keep-alive</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>增加管道机制</li>
</ol>
<p>增加了管道机制，请求可以同时发出，但是响应必须按照请求发出的顺序依次返回，性能在一定程度上得到了改善。   </p>
<p><img src="http://images.pingan8787.com/20190609http01.png" alt="管道">   </p>
<ol start="3">
<li>分块传输</li>
</ol>
<p>在 HTTP/1.1 版本中，可以不必等待数据完全处理完毕再返回，服务器产生部分数据，那么就发送部分数据，很明此种方式更加优秀一些，可以节省很多等待时间。   </p>
<ol start="4">
<li>增加 <code>host</code> 字段</li>
</ol>
<p>使得一个服务器能够用来创建多个 Web 站点。   </p>
<ol start="5">
<li>错误提示</li>
</ol>
<p>HTTP/1.1 引入了一个 <code>Warning</code> 头域，增加对错误或警告信息的描述，此外，在 HTTP/1.1 中新增了24个状态响应码(100，101，203，205，206，301，305… )。   </p>
<ol start="6">
<li>带宽优化</li>
</ol>
<p>HTTP/1.1 中在请求消息中引入了 <code>range </code>头域，它允许只请求资源的某个部分。</p>
<p>在响应消息中 <code>Content-Range </code>头域声明了返回的这部分对象的偏移值和长度。如果服务器相应地返回了对象所请求范围的内容，则响应码为 <code>206（Partial Content） </code>，它可以防止 <code>Cache </code>将响应误以为是完整的一个对象，HTTP/1.1 加入了一个新的状态码 <code>100（Continue）</code>。客户端事先发送一个只带头域的请求，如果服务器因为权限拒绝了请求，就回送响应码 <code>401（Unauthorized</code>）；如果服务器接收此请求就回送响应码 <code>100 </code>，客户端就可以继续发送带实体的完整请求了。</p>
<p>注意，HTTP/1.0 的客户端不支持 100 响应码。但可以让客户端在请求消息中加入 <code>Expect </code>头域，并将它的值设置为 <code>100-continue</code>。</p>
<h4 id="7-2-HTTP-1-1-缺点"><a href="#7-2-HTTP-1-1-缺点" class="headerlink" title="7.2 HTTP/1.1 缺点"></a>7.2 HTTP/1.1 缺点</h4><ol>
<li>队头阻塞</li>
</ol>
<p>此版本的网络延迟问题主要由于队头堵塞导致，虽然通过持久性连接得到改善，但是每一个请求的响应依然需要按照顺序排队，如果前面的响应处理较为耗费时间，那么同样非常耗费性能。</p>
<ol start="2">
<li>技术不成熟</li>
</ol>
<p>还有此版本虽然引进了管道机制，但是当前存在诸多问题，且默认处于关闭状态。</p>
<ol start="3">
<li>浪费资源</li>
</ol>
<p>http/1.1 请求会携带大量冗余的头信息，浪费了很多宽带资源。</p>
<h3 id="8-相比-HTTP-1-1，HTTP-2-0-有哪些新特性"><a href="#8-相比-HTTP-1-1，HTTP-2-0-有哪些新特性" class="headerlink" title="8. 相比 HTTP/1.1，HTTP/2.0 有哪些新特性"></a>8. 相比 HTTP/1.1，HTTP/2.0 有哪些新特性</h3><p>参考文章：<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000013028798?utm_source=tag-newest">《HTTP1.0 HTTP/1.1 HTTP2.0 主要特性对比》</a></p>
<ul>
<li><strong>二进制分帧</strong></li>
</ul>
<p>在应用层（HTTP/2.0）和传输层（TCP or UDP）之间增加一个二进制分帧层，从而突破 HTTP1.1 的性能限制，改进<strong>传输性能</strong>，<strong>实现低延迟</strong>和<strong>高吞吐量</strong>。</p>
<p><img src="http://images.pingan8787.com/20190622http12.jpg" alt="http12"></p>
<p>可见，虽然 HTTP/2.0 的协议和 HTTP1.x 协议之间的规范完全不同了，但是实际上 HTTP/2.0并 没有改变 HTTP1.x 的语义。 </p>
<p>简单来说，HTTP/2.0 只是把原来 HTTP1.x 的 <code>header</code> 和 <code>body</code> 部分用 <code>frame</code> 重新封装了一层而已。</p>
<ul>
<li><strong>多路复用（连接共享）</strong></li>
</ul>
<p>允许同时通过单一的 HTTP/2 连接发起多重的请求-响应消息，这个强大的功能则是基于“二进制分帧”的特性。</p>
<p><img src="http://images.pingan8787.com/20190622http11.jpg" alt="http11"></p>
<p>从图中可见，所有的 HTTP/2.0 通信都在一个 TCP 连接上完成，这个连接可以承载任意数量的双向数据流。</p>
<p>每个数据流以消息的形式发送，而消息由一或多个帧组成。这些帧可以乱序发送，然后再根据每个帧头部的流标识符（<code>stream id</code>）重新组装。</p>
<ul>
<li><strong>首部压缩</strong></li>
</ul>
<p>HTTP1.1 不支持 <code>header</code> 数据的压缩，HTTP/2.0 使用 <code>HPACK</code> 算法对 <code>header</code> 的数据进行压缩，这样数据体积小了，在网络上传输就会更快。高效的压缩算法可以很大的压缩 <code>header</code> ，减少发送包的数量从而降低延迟。</p>
<ul>
<li><strong>服务器推送</strong></li>
</ul>
<p>在 HTTP/2 中，服务器可以对客户端的一个请求发送多个响应，即服务器可以额外的向客户端推送资源，而无需客户端明确的请求。</p>
<h3 id="9-请简述-HTTPS-工作原理"><a href="#9-请简述-HTTPS-工作原理" class="headerlink" title="9. 请简述 HTTPS 工作原理"></a>9. 请简述 HTTPS 工作原理</h3><h4 id="9-1-HTTPS-简介"><a href="#9-1-HTTPS-简介" class="headerlink" title="9.1 HTTPS 简介"></a>9.1 HTTPS 简介</h4><p>参考文章：<a href="developer.51cto.com/art/201812/589283.htm">《深入浅出讲解HTTPS工作原理》</a></p>
<p>HTTPS 并非是应用层的一种新协议。只是 HTTP 通信接口部分用 SSL(Secure Socket Layer)和 TLS(Transport Layer Security)协议代替而已。</p>
<p>通常，HTTP 直接和 TCP 通信。当使用 SSL 时，则演变成先和 SSL 通信，再由 SSL 和 TCP 通信了。简言之，所谓 HTTPS，其实就是身披 SSL 协议这层外壳的 HTTP。</p>
<p><img src="http://images.pingan8787.com/20190622http13.jpg" alt="http13"></p>
<p>在采用 SSL 后，HTTP 就拥有了 HTTPS 的加密、证书和完整性保护这些功能。也就是说HTTP 加上加密处理和认证以及完整性保护后即是 HTTPS。</p>
<p><img src="http://images.pingan8787.com/20190622http14.jpg" alt="http14"></p>
<p>HTTPS 协议的主要功能基本都依赖于 TLS/SSL 协议，TLS/SSL 的功能实现主要依赖于三类基本算法：<strong>散列函数</strong> 、<strong>对称加密</strong>和<strong>非对称加密</strong>，其利用非对称加密实现身份认证和密钥协商，对称加密算法采用协商的密钥对数据加密，基于散列函数验证信息的完整性。</p>
<p><img src="http://images.pingan8787.com/20190622http15.jpg" alt="http15"></p>
<h4 id="9-2-HTTPS-工作原理"><a href="#9-2-HTTPS-工作原理" class="headerlink" title="9.2 HTTPS 工作原理"></a>9.2 HTTPS 工作原理</h4><p>HTTPS 其实是有两部分组成：<strong>HTTP</strong> + <strong>SSL / TLS</strong>，也就是在 HTTP 上又加了一层处理加密信息的模块。服务端和客户端的信息传输都会通过 TLS 进行加密，所以<strong>传输的数据都是加密后的数据</strong>。</p>
<p><img src="http://images.pingan8787.com/20190622http16.jpeg" alt="http16"></p>
<ol>
<li>客户端发起HTTPS请求</li>
</ol>
<p>浏览器里面输入一个HTTPS网址，然后连接到服务端的443端口上。注意这个过程中客户端会发送一个密文族给服务端，密文族是浏览器所支持的加密算法的清单。</p>
<ol start="2">
<li>服务端配置</li>
</ol>
<p>采用HTTPS协议的服务器必须要有一套数字证书，可以自己制作，也可以向组织申请。区别就是自己颁发的证书需要客户端验证通过才可以继续访问，而使用受信任的公司申请的证书则不会弹出提示页面。</p>
<p>这套证书其实就是一对公钥和私钥，可以这么理解，公钥就是一把锁头，私钥就是这把锁的钥匙，锁头可以给别人对某个东西进行加锁，但是加锁完毕之后，只有持有这把锁的钥匙才可以解锁看到加锁的内容。</p>
<ol start="3">
<li>传送证书</li>
</ol>
<p>这个证书其实就是公钥，只是包含了很多信息，如证书的颁发机构、过期时间等等。</p>
<ol start="4">
<li>客户端解析证书</li>
</ol>
<p>这部分工作是由客户端的TLS来完成的，首先会验证公钥是否有效，如颁发机构、过期时间等等，如果发现异常则会弹出一个警告框，提示证书存在问题。如果证书没有问题，那么就生成一个随机值，然后用证书对该随机值进行加密。</p>
<p>注意一下上面提到的”发现异常”。证书中会包含数字签名，该数字签名是加密过的，是用颁发机构的私钥对本证书的公钥、名称及其他信息做hash散列加密而生成的。客户端浏览器会首先找到该证书的根证书颁发机构，如果有，则用该根证书的公钥解密服务器下发的证书，如果不能正常解密，则就是”发现异常”，说明该证书是伪造的。</p>
<ol start="5">
<li>传送加密信息</li>
</ol>
<p>这部分传送的是用证书加密后的随机值，目的就是让服务端得到这个随机值，然后客户端和服务端的通信就可以通过这个随机值来进行加密和解密了。</p>
<ol start="6">
<li>服务端解密信息</li>
</ol>
<p>服务端用私钥解密后，得到了客户端传过来的随机值，至此一个非对称加密的过程结束，看到TLS利用非对称加密实现了身份认证和密钥协商。然后把内容通过该值进行对称加密。</p>
<ol start="7">
<li>传输加密后的信息</li>
</ol>
<p>这部分是服务端用随机值加密后的信息，可以在客户端被还原。</p>
<ol start="8">
<li>客户端解密信息</li>
</ol>
<p>客户端用之前生成的随机值解密服务端传送过来的信息，于是获取了解密后的内容，至此一个对称加密的过程结束，看到对称加密是用于对服务器待传送给客户端的数据进行加密用的。整个过程即使第三方监听了数据，也束手无策。</p>
<h3 id="10-HTTP-和-HTTPS-的共同点和区别"><a href="#10-HTTP-和-HTTPS-的共同点和区别" class="headerlink" title="10. HTTP 和 HTTPS 的共同点和区别"></a>10. HTTP 和 HTTPS 的共同点和区别</h3><ol>
<li><p> https 协议需要到 ca 申请证书，一般免费证书较少，因而需要一定费用。</p>
</li>
<li><p> http 是超文本传输协议，信息是明文传输， https 则是具有安全性的ssl加密传输协议。</p>
</li>
<li><p> http 和 https 使用的是完全不同的连接方式，用的端口也不一样，前者是80，后者是443。</p>
</li>
<li><p> http 的连接很简单，是无状态的； HTTPS 协议是由 SSL+HTTP 协议构建的可进行加密传输、身份认证的网络协议，比 http 协议安全。</p>
</li>
</ol>
<h3 id="11-什么是跨域，如何解决跨域"><a href="#11-什么是跨域，如何解决跨域" class="headerlink" title="11. 什么是跨域，如何解决跨域"></a>11. 什么是跨域，如何解决跨域</h3><p>参考文章：<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000011145364">《前端常见跨域解决方案（全）》</a></p>
<h4 id="11-1-什么是跨域"><a href="#11-1-什么是跨域" class="headerlink" title="11.1 什么是跨域"></a>11.1 什么是跨域</h4><p>跨域，指的是浏览器不能执行其他网站的脚本。它是由<strong>浏览器的同源策略</strong>造成的，是浏览器对JavaScript施加的安全限制。   </p>
<ul>
<li><strong>什么是同源策略？</strong>   </li>
</ul>
<p>同源策略/SOP（Same origin policy）是一种约定，由Netscape公司1995年引入浏览器，它是浏览器最核心也最基本的安全功能，如果缺少了同源策略，浏览器很容易受到 XSS 、 CSFR 等攻击。所谓同源是指”协议+域名+端口”三者相同，即便两个不同的域名指向同一个ip地址，也非同源。   </p>
<ul>
<li><strong>同源策略</strong>限制了以下行为：   </li>
</ul>
<ol>
<li><code>Cookie</code>、<code>LocalStorage</code> 和 <code>IndexDB</code> 无法读取   </li>
<li><code>DOM</code> 和 <code>JS </code>对象无法获取    </li>
<li><code>Ajax</code>请求发送不出去  </li>
</ol>
<ul>
<li><strong>常见跨域场景：</strong>   </li>
</ul>
<p>所谓的同源是指：<strong>域名</strong>、<strong>协议</strong>、<strong>端口</strong>均为相同。</p>
<ul>
<li><p><code>http://www.a.cn/index.html</code> 调用  <code> http://www.a.cn/server.php</code>  非跨域。   </p>
</li>
<li><p><code>http://www.a.cn/index.html</code> 调用   <code>http://www.b.cn/server.php</code>  跨域，主域不同。   </p>
</li>
<li><p><code>http://abc.a.cn/index.html</code> 调用   <code>http://def.b.cn/server.php</code>  跨域，子域名不同。   </p>
</li>
<li><p><code>http://www.a.cn:8080/index.html</code> 调用   <code>http://www.a.cn/server.php</code>  跨域，端口不同。   </p>
</li>
<li><p><code>https://www.a.cn/index.html</code> 调用   <code>http://www.a.cn/server.php</code>  跨域,协议不同。   </p>
</li>
<li><p><code>localhost</code> 调用 <code>127.0.0.1</code> 跨域。   </p>
</li>
</ul>
<h4 id="11-2-解决跨域"><a href="#11-2-解决跨域" class="headerlink" title="11.2 解决跨域"></a>11.2 解决跨域</h4><ol>
<li><code>jsonp</code> 跨域</li>
<li><code>document.domain</code> + <code>iframe</code> 跨域</li>
<li><code>window.name</code> + <code>iframe</code> 跨域</li>
<li><code>location.hash</code> + <code>iframe</code> 跨域</li>
<li><code>postMessage</code> 跨域</li>
<li>跨域资源共享<code> CORS</code></li>
<li><code>withCredentials</code> 属性</li>
<li><code>WebSocket</code> 协议跨域</li>
<li><code>node</code> 代理跨域</li>
<li><code>nginx</code> 代理跨域</li>
</ol>
<p>具体每一种解决方法，可以参考：<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000011145364">《前端常见跨域解决方案（全）》</a></p>
<h3 id="12-HTTP-中与缓存相关的头部有哪些，它们有什么区别"><a href="#12-HTTP-中与缓存相关的头部有哪些，它们有什么区别" class="headerlink" title="12. HTTP 中与缓存相关的头部有哪些，它们有什么区别"></a>12. HTTP 中与缓存相关的头部有哪些，它们有什么区别</h3><table>
<thead>
<tr>
<th>头部</th>
<th>优势和特点</th>
<th>劣势和问题</th>
</tr>
</thead>
<tbody><tr>
<td><code>Expires</code></td>
<td>1、<code>HTTP 1.0</code> 产物，可以在<code>HTTP 1.0</code>和<code>1.1</code>中使用，简单易用。2、以时刻标识失效时间。</td>
<td>1、时间是由服务器发送的(<code>UTC</code>)，如果服务器时间和客户端时间存在不一致，可能会出现问题。2、存在版本问题，到期之前的修改客户端是不可知的。</td>
</tr>
<tr>
<td><code>Cache-Control</code></td>
<td>1、<code>HTTP 1.1</code> 产物，以时间间隔标识失效时间，解决了<code>Expires</code>服务器和客户端相对时间的问题。2、比<code>Expires</code>多了很多选项设置。</td>
<td>1、<code>HTTP 1.1 </code>才有的内容，不适用于<code>HTTP 1.0</code> 。2、存在版本问题，到期之前的修改客户端是不可知的。</td>
</tr>
<tr>
<td><code>Last-Modified</code></td>
<td>1、不存在版本问题，每次请求都会去服务器进行校验。服务器对比最后修改时间如果相同则返回304，不同返回200以及资源内容。</td>
<td>1、只要资源修改，无论内容是否发生实质性的变化，都会将该资源返回客户端。例如周期性重写，这种情况下该资源包含的数据实际上一样的。2、以时刻作为标识，无法识别一秒内进行多次修改的情况。3、某些服务器不能精确的得到文件的最后修改时间。</td>
</tr>
<tr>
<td><code>ETag</code></td>
<td>1、可以更加精确的判断资源是否被修改，可以识别一秒内多次修改的情况。2、不存在版本问题，每次请求都回去服务器进行校验。</td>
<td>1、计算<code>ETag</code>值需要性能损耗。2、分布式服务器存储的情况下，计算<code>ETag</code>的算法如果不一样，会导致浏览器从一台服务器上获得页面内容后到另外一台服务器上进行验证时发现<code>ETag</code>不匹配的情况。</td>
</tr>
</tbody></table>
<h3 id="13-分别介绍强缓存和协商缓存"><a href="#13-分别介绍强缓存和协商缓存" class="headerlink" title="13. 分别介绍强缓存和协商缓存"></a>13. 分别介绍强缓存和协商缓存</h3><p>浏览器缓存主要分为<strong>强缓存</strong>（也称<strong>本地缓存</strong>）和<strong>协商缓存</strong>（也称<strong>弱缓存</strong>）。</p>
<h4 id="13-1-强缓存"><a href="#13-1-强缓存" class="headerlink" title="13.1 强缓存"></a>13.1 强缓存</h4><p><strong>强缓存</strong>是利用 <code>http</code> 头中的 <code>Expires</code> 和 <code>Cache-Control</code> 两个字段来控制的，用来表示资源的缓存时间。</p>
<p>强缓存中，普通刷新会忽略它，但不会清除它，需要强制刷新。浏览器强制刷新，请求会带上 <code>Cache-Control:no-cache</code> 和 <code>Pragma:no-cache</code>。   </p>
<p>通常，<strong>强缓存</strong>不会向服务器发送请求，直接从缓存中读取资源，在chrome控制台的network选项中可以看到该请求返回200的状态码。分为 <code>from disk cache</code> 和 <code>from memory cache</code>。  </p>
<ul>
<li><p><code>from disk cache</code> ：一般非脚本会存在内存当中，如css，html等</p>
</li>
<li><p><code>from memory cache</code> ：资源在内存当中，一般脚本、字体、图片会存在内存当</p>
</li>
</ul>
<p>有<strong>缓存命中</strong>和<strong>缓存未命中</strong>状态:   </p>
<p><img src="http://images.pingan8787.com/20190622http17.png" alt="http17"></p>
<p><img src="http://images.pingan8787.com/20190622http18.png" alt="http18"></p>
<h4 id="13-2-协商缓存"><a href="#13-2-协商缓存" class="headerlink" title="13.2 协商缓存"></a>13.2 协商缓存</h4><p><strong>协商缓存</strong>就是由服务器来确定缓存资源是否可用，所以客户端与服务器端要通过某种标识来进行通信，从而让服务器判断请求资源是否可以缓存访问。    </p>
<p>普通刷新会启用弱缓存，忽略强缓存。只有在地址栏或收藏夹输入网址、通过链接引用资源等情况下，浏览器才会启用强缓存，这也是为什么有时候我们更新一张图片、一个js文件，页面内容依然是旧的，但是直接浏览器访问那个图片或文件，看到的内容却是新的。</p>
<p>这个主要涉及到两组 <code>header</code> 字段： <code>Etag</code> 和 <code>If-None-Match </code>、 <code>Last-Modified </code>和 <code>If-Modified-Since </code>。</p>
<p>向服务器发送请求，服务器会根据这个请求的request header的一些参数来判断是否命中协商缓存。</p>
<p>有<strong>缓存命中</strong>和<strong>缓存未命中</strong>状态:   </p>
<p><img src="http://images.pingan8787.com/20190622http19.png" alt="http19"></p>
<p><img src="http://images.pingan8787.com/20190622http20.png" alt="http20"></p>
<h4 id="13-3-流程"><a href="#13-3-流程" class="headerlink" title="13.3 流程"></a>13.3 流程</h4><p>浏览器第一次发起请求，本地有缓存情况：  在浏览器第一次发起请求时，本地无缓存，向web服务器发送请求，服务器起端响应请求，浏览器端缓存。过程如下：</p>
<p><img src="http://images.pingan8787.com/20190615http1.png" alt="1"></p>
<p>在第一次请求时，服务器会将页面最后修改时间通过 <code>Last-Modified </code>标识由服务器发送给客户端，客户端记录修改时间；服务器还会生成一个Etag，并发送给客户端。</p>
<p>浏览器后续再次进行请求时：</p>
<p><img src="http://images.pingan8787.com/20190615http2.png" alt="2"></p>
<h3 id="14-请简单介绍一下-LRU-（Least-recently-used）算法"><a href="#14-请简单介绍一下-LRU-（Least-recently-used）算法" class="headerlink" title="14. 请简单介绍一下 LRU （Least recently used）算法"></a>14. 请简单介绍一下 LRU （Least recently used）算法</h3><p>参考文章：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/d533d8a66795">《LRU算法》</a></p>
<h4 id="14-1-原理"><a href="#14-1-原理" class="headerlink" title="14.1 原理"></a>14.1 原理</h4><p>LRU（Least recently used，最近最少使用）算法根据数据的历史访问记录来进行淘汰数据，其核心思想是“如果数据最近被访问过，那么将来被访问的几率也更高”。</p>
<p><img src="http://images.pingan8787.com/20190622http21.png" alt="http21"></p>
<p>这里有一张比较卡通的图片：   </p>
<p><img src="http://images.pingan8787.com/20190622http22.png" alt="http22"></p>
<h4 id="14-2-实现"><a href="#14-2-实现" class="headerlink" title="14.2 实现"></a>14.2 实现</h4><p>最常见的实现是使用一个链表保存缓存数据，详细算法实现如下：</p>
<ol>
<li><p>新数据插入到链表头部；</p>
</li>
<li><p>每当缓存命中（即缓存数据被访问），则将数据移到链表头部；</p>
</li>
<li><p>当链表满的时候，将链表尾部的数据丢弃。</p>
</li>
</ol>
<h4 id="14-3-分析"><a href="#14-3-分析" class="headerlink" title="14.3 分析"></a>14.3 分析</h4><ul>
<li>命中率</li>
</ul>
<p>当存在热点数据时，LRU的效率很好，但偶发性的、周期性的批量操作会导致LRU命中率急剧下降，缓存污染情况比较严重。</p>
<ul>
<li>复杂度</li>
</ul>
<p>实现简单。</p>
<ul>
<li>代价</li>
</ul>
<p>命中时需要遍历链表，找到命中的数据块索引，然后需要将数据移到头部。</p>
<h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>本文主要复习了 HTTP/HTTPS 的一些基础知识，还有 HTTP 的其他版本的知识，对于面试也好，知识沉淀也好，这些也是我们作为开发者必须懂的。  </p>
<p>作为一名前端开发者，说实话对 HTTP/HTTPS 了解还是太少，可能和平常工作内容有关。</p>
<h3 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h3><blockquote>
<p>本文首发在 <a target="_blank" rel="noopener" href="http://www.pingan8787.com/">pingan8787个人博客</a>，如需转载请保留个人介绍</p>
</blockquote>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#x70;&#105;&#110;&#103;&#97;&#110;&#x38;&#x37;&#56;&#x37;&#64;&#113;&#x71;&#46;&#99;&#111;&#109;">&#x70;&#105;&#110;&#103;&#97;&#110;&#x38;&#x37;&#56;&#x37;&#64;&#113;&#x71;&#46;&#99;&#111;&#109;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>ES小册</td>
<td>js.pingan8787.com</td>
</tr>
</tbody></table>
<h2 id="微信公众号"><a href="#微信公众号" class="headerlink" title="微信公众号"></a>微信公众号</h2><p><img src="http://images.pingan8787.com/fe_bg.png" alt="bg">  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/06/22/164-%E3%80%90HTTP%E3%80%91HTTP%E7%9A%8415%E4%B8%AA%E5%B8%B8%E8%A7%81%E7%9F%A5%E8%AF%86%E7%82%B9%E5%A4%8D%E4%B9%A0/" data-id="ckts3ejzp00r14d9k1qn932d2" data-title="164-【HTTP】HTTP的15个常见知识点复习" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTTP/" rel="tag">HTTP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-163-【TypeScript】TS学习笔记" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/06/12/163-%E3%80%90TypeScript%E3%80%91TS%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2019-06-12T14:29:28.000Z" itemprop="datePublished">2019-06-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/06/12/163-%E3%80%90TypeScript%E3%80%91TS%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">163-【TypeScript】TS学习笔记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>视频地址  <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av38379328/?p=3">https://www.bilibili.com/video/av38379328/?p=3</a></p>
<h3 id="1-数据类型"><a href="#1-数据类型" class="headerlink" title="1. 数据类型"></a>1. 数据类型</h3><ul>
<li>定义未赋值，设置默认值</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a:number | <span class="literal">undefined</span>;</span><br><span class="line">a;<span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line">a = <span class="number">3</span>;</span><br><span class="line">a; <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>

<ul>
<li>定义数组</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方式1</span></span><br><span class="line"><span class="keyword">let</span> arr: string = [<span class="string">&quot;aa&quot;</span>, <span class="string">&quot;bb&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式2</span></span><br><span class="line"><span class="keyword">let</span> arr:<span class="built_in">Array</span>&lt;<span class="built_in">String</span>&gt; = [<span class="string">&quot;aa&quot;</span>, <span class="string">&quot;bb&quot;</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>定义枚举</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">enum flag &#123;<span class="attr">success</span>: <span class="number">1</span>, <span class="attr">error</span>: <span class="number">2</span>&#125;</span><br><span class="line"><span class="keyword">let</span> leo:flag = flag.error</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">enum Color &#123;blue , red, <span class="string">&#x27;orange&#x27;</span>&#125;</span><br><span class="line"><span class="keyword">let</span> c:Color = Color.red</span><br><span class="line">c; <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<p>如果标识没有赋值 则它的值就是下标</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">enum Color &#123;blue , red = <span class="number">3</span>, <span class="string">&#x27;orange&#x27;</span>&#125;</span><br><span class="line"><span class="keyword">let</span> c:Color = Color.red</span><br><span class="line">c; <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>

<ul>
<li>定义 void 类型，没有返回值</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params"></span>):<span class="title">void</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 不能使用undefined</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params"></span>):<span class="title">undefined</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>定义 <code>never</code> 类型</li>
</ul>
<p>包括 <code>null</code> 和 <code>undefined</code> 类型，是其他类型的子类型，代表从不会出现的值。<br>用 <code>never</code> 声明的变量只能用 <code>never</code> 类型的值所赋值。   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a:never;</span><br><span class="line">a = <span class="number">11</span>; <span class="comment">// err</span></span><br></pre></td></tr></table></figure>

<h3 id="2-函数"><a href="#2-函数" class="headerlink" title="2. 函数"></a>2. 函数</h3><ul>
<li>可选参数</li>
</ul>
<p>必须定义在参数最后一个</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params">name:string, age?:number</span>)</span>&#123;</span><br><span class="line">  <span class="comment">// ....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>剩余参数   </li>
</ul>
<p>三点运算符</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params">...res:number[]</span>):<span class="title">number</span></span>&#123;</span><br><span class="line">  <span class="comment">// ....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>函数重载</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params">name:string</span>)</span>&#123;</span><br><span class="line">  <span class="comment">// ....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params">age:number</span>)</span>&#123;</span><br><span class="line">  <span class="comment">// ....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时候 <code>fun</code> 方法 就有2个参数，重载不会覆盖</p>
<h3 id="3-类"><a href="#3-类" class="headerlink" title="3. 类"></a>3. 类</h3><ul>
<li>实例方法和静态方法  </li>
</ul>
<p>以 jquery 为例：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 静态方法 直接使用</span></span><br><span class="line">$.get(....)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例方法 需要先实例化</span></span><br><span class="line">$(<span class="string">&#x27;.dom&#x27;</span>).css(....)</span><br></pre></td></tr></table></figure>

<p>ts 中静态方法：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Per</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> leo = <span class="string">&quot;hi&quot;</span></span><br><span class="line">  <span class="keyword">static</span> print () &#123;</span><br><span class="line">     <span class="built_in">console</span>.log(Per.leo)  </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 使用静态属性</span></span><br><span class="line">Per.leo</span><br><span class="line"><span class="comment">// 使用静态方法</span></span><br><span class="line">Per.print()</span><br></pre></td></tr></table></figure>


<ul>
<li>多态</li>
</ul>
<p>父类定义一个方法不去实现，让继承它的子类去实现，每个子类有不同的表现。  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">  <span class="attr">name</span>: string</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name:string</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name</span><br><span class="line">  &#125;</span><br><span class="line">  eat ()&#123; <span class="built_in">console</span>.log(<span class="string">&#x27;吃···&#x27;</span>) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name:string</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">super</span>(name)</span><br><span class="line">  &#125;</span><br><span class="line">  eat ()&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.name + <span class="string">&#x27;哈哈哈&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>抽象类</li>
</ul>
<p>它提供其他类继承的基类，不能直接实例化。</p>
<p>用 <code>abstract</code> 关键字定义<strong>抽象类</strong>和<strong>抽象方法</strong>。    </p>
<p>可以说<strong>抽象类</strong>和<strong>抽象方法</strong>使用来定义标准。   </p>
<p><strong>抽象类</strong>中的<strong>抽象方法</strong>不包含具体实现并且必须在派生类中实现。   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象类必须有抽象方法</span></span><br><span class="line"><span class="comment">// 抽象方法必须在抽象类中</span></span><br><span class="line"></span><br><span class="line">abstract <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">  public name: string</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name:string</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name</span><br><span class="line">  &#125;</span><br><span class="line">  abstract eat ()&#123; <span class="built_in">console</span>.log(<span class="string">&#x27;吃···&#x27;</span>) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象类的子类必须实现抽象类里面的抽象方法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name:string</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">super</span>(name)</span><br><span class="line">  &#125;</span><br><span class="line">  eat ()&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.name + <span class="string">&#x27;哈哈哈&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> aa = <span class="keyword">new</span> B(<span class="string">&#x27; hello &#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="4-接口"><a href="#4-接口" class="headerlink" title="4. 接口"></a>4. 接口</h3><p>行为和动作的规范，对批量方法进行约束。   </p>
<ul>
<li>属性类型接口<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">interface Name &#123;</span><br><span class="line">  <span class="attr">fName</span>: string; <span class="comment">// 必须</span></span><br><span class="line">  sName?: string; <span class="comment">// 可选</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params">name:Name</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name.fName, name.sName)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>函数类型接口<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">interface f&#123;</span><br><span class="line">    (key: string, <span class="attr">value</span>: string): string</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> md5:f = <span class="function"><span class="keyword">function</span>(<span class="params">key: string, value: string</span>): <span class="title">string</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> key + value</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>可索引接口 （约束数组、对象）<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">interface Arr &#123;</span><br><span class="line">    [index: number]: string</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a: Arr = [<span class="string">&quot;aa&quot;</span>, <span class="string">&quot;bb&quot;</span>]</span><br><span class="line"></span><br><span class="line">interface Obj &#123;</span><br><span class="line">    [index: string]: string</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> o: Obj = &#123;</span><br><span class="line">    <span class="attr">aa</span>: <span class="string">&#x27;aaa&#x27;</span>,</span><br><span class="line">    <span class="attr">bb</span>: <span class="string">&#x27;bbb&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>类类型接口</li>
</ul>
<p><code>implements</code>  实现后面的接口。   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">interface C &#123;</span><br><span class="line">    <span class="attr">name</span>: string;</span><br><span class="line">    fun(str: string):<span class="keyword">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> <span class="title">implements</span> <span class="title">C</span> </span>&#123;</span><br><span class="line">    <span class="attr">name</span>: string</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">name: string</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="function"><span class="title">fun</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.name + <span class="string">&#x27;in here~&#x27;</span>)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> aa = <span class="keyword">new</span> P(<span class="string">&#x27;leo&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>接口拓展</li>
</ul>
<p>接口继承其他接口。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">interface A &#123;</span><br><span class="line">    fun1():<span class="keyword">void</span>;</span><br><span class="line">&#125;</span><br><span class="line">interface B <span class="keyword">extends</span> A&#123;</span><br><span class="line">    fun2():<span class="keyword">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> <span class="title">implements</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">    public name: string;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">name: string</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">fun1</span>(<span class="params"></span>)</span>&#123; <span class="built_in">console</span>.log(<span class="built_in">this</span>.name) &#125;</span><br><span class="line">    <span class="function"><span class="title">fun2</span>(<span class="params"></span>)</span>&#123; <span class="built_in">console</span>.log(<span class="built_in">this</span>.name) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> C()</span><br><span class="line">p.fun1(<span class="string">&#x27;leo&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="5-泛型"><a href="#5-泛型" class="headerlink" title="5. 泛型"></a>5. 泛型</h3><p>简单理解：泛型就是解决类、接口和方法的复用性，以及对不特定数据类型的支持。<br>可以使用泛型来创建可重用的组件，一个组件支持多种类型的数据。   </p>
<h4 id="5-1-泛型函数"><a href="#5-1-泛型函数" class="headerlink" title="5.1 泛型函数"></a>5.1 泛型函数</h4><ul>
<li><p>普通写法：    </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 只能返回一种类型</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun1</span> (<span class="params">name: string</span>): <span class="title">string</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> name; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以返回多种类型 </span></span><br><span class="line"><span class="comment">// 使用 any  则放弃使用类型检查</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun2</span> (<span class="params">name: any</span>): <span class="title">any</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> name; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>使用泛型：    </p>
</li>
</ul>
<p>由于如果使用 <code>any</code> 可能出现可以传入 <code>string</code> 返回 <code>number</code> ，所以需要使用泛型，使得传入参数和返回类型参数一致。    </p>
<p><code>T</code> 表示泛型，具体什么类型是调用这个方法的时候决定的。   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun3</span>&lt;<span class="title">T</span>&gt;(<span class="params">name: T</span>): <span class="title">T</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> name;</span><br><span class="line">&#125;</span><br><span class="line">fun3&lt;number&gt;(<span class="number">123</span>); <span class="comment">// 调用方法的时候决定</span></span><br><span class="line">fun3&lt;string&gt;(<span class="string">&#x27;123&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="5-2-泛型类"><a href="#5-2-泛型类" class="headerlink" title="5.2 泛型类"></a>5.2 泛型类</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">    public list:T[] = [];</span><br><span class="line">    fun1(name: T):<span class="keyword">void</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.list.push(name)</span><br><span class="line">    &#125;</span><br><span class="line">    fun2():T&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.list[<span class="number">0</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a1 = <span class="keyword">new</span> C&lt;number&gt;()</span><br></pre></td></tr></table></figure>

<h4 id="5-3-泛型接口"><a href="#5-3-泛型接口" class="headerlink" title="5.3 泛型接口"></a>5.3 泛型接口</h4><ul>
<li><p>方法1：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">interface Config&#123;</span><br><span class="line">    &lt;T&gt;(name: T): T;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> getData : Config = <span class="function"><span class="keyword">function</span>&lt;<span class="title">T</span>&gt;(<span class="params">name: T</span>): <span class="title">T</span></span>&#123; <span class="keyword">return</span> name; &#125;</span><br><span class="line"></span><br><span class="line">getData&lt;number&gt;(<span class="number">123</span>);</span><br><span class="line">getData&lt;string&gt;(<span class="string">&#x27;aaa&#x27;</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>方法2： </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">interface Config&#123;</span><br><span class="line">    (name: T): T;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getData</span>&lt;<span class="title">T</span>&gt;(<span class="params">name: T</span>): <span class="title">T</span></span>&#123; <span class="keyword">return</span> name; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> fun1: Config&lt;string&gt; = getData;</span><br><span class="line">fun1(<span class="string">&#x27;aaa&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="5-4-把类作为参数类型的泛型类"><a href="#5-4-把类作为参数类型的泛型类" class="headerlink" title="5.4 把类作为参数类型的泛型类"></a>5.4 把类作为参数类型的泛型类</h4><ul>
<li>以前将类作为参数类型，可以检查参数是否类型符合</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="attr">name</span>: string | <span class="literal">undefined</span>;</span><br><span class="line">    pwd: string | <span class="literal">undefined</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Db</span> </span>&#123;</span><br><span class="line">    add(data: User): boolean&#123; <span class="keyword">return</span> <span class="literal">true</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> dd = <span class="keyword">new</span> Data();</span><br><span class="line">dd.name = <span class="string">&quot;aaa&quot;</span>;</span><br><span class="line">dd.pwd = <span class="string">&quot;1233&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> D = <span class="keyword">new</span> Db()</span><br><span class="line">D.add(dd);</span><br></pre></td></tr></table></figure>

<ul>
<li>把类作为参数类型的泛型类<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Db</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">    add(data: T): boolean&#123; <span class="keyword">return</span> <span class="literal">true</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Data</span></span>&#123;</span><br><span class="line">    <span class="attr">name</span>: string | <span class="literal">undefined</span>;</span><br><span class="line">    pwd: string | <span class="literal">undefined</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> dd = <span class="keyword">new</span> Data();</span><br><span class="line">dd.name = <span class="string">&quot;aaa&quot;</span>;</span><br><span class="line">dd.pwd = <span class="string">&quot;1233&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> D = <span class="keyword">new</span> Db&lt;Data&gt;()</span><br><span class="line">D.add(dd);</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="6-模块"><a href="#6-模块" class="headerlink" title="6. 模块"></a>6. 模块</h3><p><code>export</code> 暴露模块， <code>import</code> 导入模块。   </p>
<ul>
<li>方式1</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="title">fun</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> a = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; fun, a  &#125; <span class="keyword">from</span> <span class="string">&#x27;./1.js&#x27;</span></span><br><span class="line">fun()</span><br></pre></td></tr></table></figure>

<ul>
<li>方式2</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.js</span></span><br><span class="line"><span class="function"><span class="title">fun</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"><span class="keyword">let</span> a = <span class="number">1</span></span><br><span class="line"><span class="keyword">export</span> &#123; fun, a &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; fun, a <span class="keyword">as</span> ha  &#125; <span class="keyword">from</span> <span class="string">&#x27;./1.js&#x27;</span> <span class="comment">// 将 a 重命名为 ha</span></span><br><span class="line">fun()</span><br></pre></td></tr></table></figure>

<ul>
<li>方式3 默认导出</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> fun ()&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.js</span></span><br><span class="line"><span class="keyword">import</span> fun <span class="keyword">from</span> <span class="string">&#x27;./1.js&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="7-命名空间"><a href="#7-命名空间" class="headerlink" title="7. 命名空间"></a>7. 命名空间</h3><p>在模块内部，用于组织代码，避免命名冲突。   </p>
<p>使用 <code>namespace</code> 关键字作为划分，将指定的代码放到命名空间中，并使用 <code>export</code> 暴露其中变量和方法（类似将命名空间当做模块），调用的时候，需要使用 <strong>空间名称</strong> 来获取对应变量方法。   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">namespace A&#123;</span><br><span class="line">    interface Leo&#123;</span><br><span class="line">        <span class="attr">name</span>: string</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">let</span> aa = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// ....</span></span><br><span class="line">&#125;</span><br><span class="line">namespace B&#123;</span><br><span class="line">    interface Leo&#123;</span><br><span class="line">        <span class="attr">name</span>: string</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">let</span> aa = <span class="number">2</span>;</span><br><span class="line">    <span class="comment">// ....</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(A.aa) <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">console</span>.log(B.aa) <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>

<h3 id="8-装饰器"><a href="#8-装饰器" class="headerlink" title="8. 装饰器"></a>8. 装饰器</h3><p>是一种特殊类型的声明，能够被附加到类生命，方法，属性或参数上，可以修改类的行为。</p>
<p>常见：类装饰器，属性装饰器，方法装饰器，参数装饰器。    </p>
<p>装饰器写法：普通装饰器（无法传参），装饰器工厂（可传参）</p>
<h4 id="8-1-普通装饰器（无法传参）"><a href="#8-1-普通装饰器（无法传参）" class="headerlink" title="8.1 普通装饰器（无法传参）"></a>8.1 普通装饰器（无法传参）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类装饰器</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myClass</span>(<span class="params">params: any</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// params 当前类</span></span><br><span class="line">    params.prototype.url = <span class="string">&#x27;www.xxx.com&#x27;</span></span><br><span class="line">    params.prototype.fun1 =<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;fun&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@myClass</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FunClass</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span>&#123; &#125;</span><br><span class="line">    <span class="function"><span class="title">fun</span>(<span class="params"></span>)</span>&#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a: any = <span class="keyword">new</span> FunClass()</span><br><span class="line">a.url; <span class="comment">//  &#x27;www.xxx.com&#x27;</span></span><br><span class="line">a.fun1(); <span class="comment">// &#x27;fun&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="8-2-装饰器工厂（可传参）"><a href="#8-2-装饰器工厂（可传参）" class="headerlink" title="8.2 装饰器工厂（可传参）"></a>8.2 装饰器工厂（可传参）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类装饰器</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myClass</span>(<span class="params">params: string</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// params 传入参数</span></span><br><span class="line">    <span class="comment">// target 当前类</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">target: any</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(params, target)</span><br><span class="line">        target.prototype.url = params</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@myClass(<span class="string">&#x27;www.xxx.com&#x27;</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FunClass</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span>&#123; &#125;</span><br><span class="line">    <span class="function"><span class="title">fun</span>(<span class="params"></span>)</span>&#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a: any = <span class="keyword">new</span> FunClass()</span><br></pre></td></tr></table></figure>

<h4 id="8-3-重载构造函数"><a href="#8-3-重载构造函数" class="headerlink" title="8.3 重载构造函数"></a>8.3 重载构造函数</h4><p>用来修改当前类的构造函数，属性和方法。   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类装饰器</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myClass</span>(<span class="params">target: any</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// target 当前类</span></span><br><span class="line">    <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">target</span></span>&#123;</span><br><span class="line">        <span class="attr">link</span> : any = <span class="string">&#x27;bbbbbb&#x27;</span></span><br><span class="line">    <span class="function"><span class="title">fun1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;-----&#x27;</span> + <span class="built_in">this</span>.link)</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@myClass</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FunClass</span></span>&#123;</span><br><span class="line">    public link : string | <span class="literal">undefined</span>;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.link = <span class="string">&#x27;aaaaaaaaaaaa&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">fun</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>.link)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a: any = <span class="keyword">new</span> FunClass()</span><br><span class="line">a.fun1(); <span class="comment">//  &#x27;-----bbbbbb&#x27;</span></span><br></pre></td></tr></table></figure>


<h4 id="8-4-属性装饰器"><a href="#8-4-属性装饰器" class="headerlink" title="8.4 属性装饰器"></a>8.4 属性装饰器</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类装饰器</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myClass</span>(<span class="params">params: string</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">target: any</span>)</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 属性装饰器</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myAttr</span>(<span class="params">params: any</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span>  <span class="function"><span class="keyword">function</span> (<span class="params">target:any , attr:any</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// target 当前类原型对象 ， attr 当前属性</span></span><br><span class="line">        target[attr] = params</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@myClass(<span class="string">&#x27;www.xxx.com&#x27;</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FunClass</span></span>&#123;</span><br><span class="line">    @myAttr(<span class="string">&#x27;leo&#x27;</span>)</span><br><span class="line">    public link : any | <span class="literal">undefined</span></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span>&#123; &#125;</span><br><span class="line">    <span class="function"><span class="title">fun</span>(<span class="params"></span>)</span>&#123; <span class="built_in">console</span>.log(<span class="built_in">this</span>.link) &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a: any = <span class="keyword">new</span> FunClass()</span><br><span class="line">a.fun(); <span class="comment">//  &#x27;leo&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="8-5-方法装饰器"><a href="#8-5-方法装饰器" class="headerlink" title="8.5 方法装饰器"></a>8.5 方法装饰器</h4><p>用来监视、修改或替换方法的定义。<br>方法装饰会在运行时，传入三个参数：   </p>
<ul>
<li>对于静态方法来说是类的构造函数，对于实例方法是类的原型对象。   </li>
<li>方法的名称。</li>
<li>方法的属性描述符。   </li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logMethod</span>(<span class="params">params: any</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">target:any, methodName:any, desc:any</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(target, methodName, desc)</span><br><span class="line">        <span class="comment">// 拓展原型方法和属性</span></span><br><span class="line">        target.url = <span class="string">&#x27;www.baidu.com&#x27;</span></span><br><span class="line">        target.leo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;hi leo~~~&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 修改原型方法 eg将参数转换成 string 类型</span></span><br><span class="line">        <span class="keyword">let</span> old = desc.value;</span><br><span class="line">        desc.value = <span class="function"><span class="keyword">function</span>(<span class="params">...args:any[]</span>)</span>&#123;</span><br><span class="line">            args = args.map(<span class="function"><span class="params">val</span> =&gt;</span> <span class="built_in">String</span>(val))</span><br><span class="line">            <span class="built_in">console</span>.log(args)</span><br><span class="line">            old.apply(<span class="built_in">this</span>,args)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Myclass</span> </span>&#123;</span><br><span class="line">    public url: any | <span class="literal">undefined</span>;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">    @logMethod(<span class="string">&#x27;hi leo&#x27;</span>)</span><br><span class="line">    <span class="function"><span class="title">getData</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;this.url&#x27;</span>,<span class="built_in">this</span>.url)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> my:any = <span class="keyword">new</span> Myclass()</span><br><span class="line"><span class="built_in">console</span>.log(my.url)</span><br><span class="line">my.leo()</span><br><span class="line">my.getData(<span class="number">123</span>,<span class="string">&#x27;aaa&#x27;</span>)</span><br></pre></td></tr></table></figure>


<h4 id="8-6-方法参数装饰器"><a href="#8-6-方法参数装饰器" class="headerlink" title="8.6 方法参数装饰器"></a>8.6 方法参数装饰器</h4><p>方法参数装饰器表达式会在运行时当做函数被调用，可以使用参数装饰器为<strong>类的原型</strong>添加一些元素数据。   </p>
<p>方法装饰会在运行时，也是传入三个参数，和<strong>方法装饰器</strong>一样。   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logMethod</span>(<span class="params">params: any</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">target:any, methodName:any, paramsIndex:any</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(params, target, methodName, paramsIndex)</span><br><span class="line">        target.url = <span class="string">&#x27;www.baidu.com&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Myclass</span> </span>&#123;</span><br><span class="line">    public url: any | <span class="literal">undefined</span>;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="title">getData</span>(<span class="params"> @logMethod(<span class="string">&#x27;uuid&#x27;</span>) uuid:any</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;this.uuid&#x27;</span>,uuid)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> my:any = <span class="keyword">new</span> Myclass()</span><br><span class="line">my.getData(<span class="number">123</span>)</span><br><span class="line"><span class="built_in">console</span>.log(my.url)</span><br></pre></td></tr></table></figure>

<h4 id="8-7-装饰器执行顺序"><a href="#8-7-装饰器执行顺序" class="headerlink" title="8.7 装饰器执行顺序"></a>8.7 装饰器执行顺序</h4><p>属性装饰器 - 方法装饰器 - 方法参数装饰器 - 类装饰器</p>
<p>多个相同类型装饰器，会从下开始执行，比如：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@fun1(<span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">@fun2(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hello</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>则先执行装饰器 <code>fun2</code> 再执行装饰器 <code>fun1</code> 。  </p>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#x70;&#105;&#110;&#103;&#97;&#110;&#56;&#55;&#56;&#x37;&#x40;&#x71;&#113;&#x2e;&#99;&#111;&#109;">&#x70;&#105;&#110;&#103;&#97;&#110;&#56;&#55;&#56;&#x37;&#x40;&#x71;&#113;&#x2e;&#99;&#111;&#109;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>JS小册</td>
<td>js.pingan8787.com</td>
</tr>
<tr>
<td>微信公众号</td>
<td>前端自习课</td>
</tr>
</tbody></table>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/06/12/163-%E3%80%90TypeScript%E3%80%91TS%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" data-id="ckts3ejti003y4d9k2b666qwy" data-title="163-【TypeScript】TS学习笔记" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TypeScript/" rel="tag">TypeScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-162-【算法】每周一练之数据结构与算法（Tree）" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/05/20/162-%E3%80%90%E7%AE%97%E6%B3%95%E3%80%91%E6%AF%8F%E5%91%A8%E4%B8%80%E7%BB%83%E4%B9%8B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%EF%BC%88Tree%EF%BC%89/" class="article-date">
  <time class="dt-published" datetime="2019-05-20T13:11:45.000Z" itemprop="datePublished">2019-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/05/20/162-%E3%80%90%E7%AE%97%E6%B3%95%E3%80%91%E6%AF%8F%E5%91%A8%E4%B8%80%E7%BB%83%E4%B9%8B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%EF%BC%88Tree%EF%BC%89/">162-【算法】每周一练之数据结构与算法（Tree）</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <hr>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#x70;&#x69;&#x6e;&#103;&#97;&#x6e;&#56;&#55;&#x38;&#x37;&#64;&#x71;&#113;&#x2e;&#x63;&#111;&#x6d;">&#x70;&#x69;&#x6e;&#103;&#97;&#x6e;&#56;&#55;&#x38;&#x37;&#64;&#x71;&#113;&#x2e;&#x63;&#111;&#x6d;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>微信公众号</td>
<td>前端自习课</td>
</tr>
</tbody></table>
<p><img src="http://images.pingan8787.com/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E5%B0%81%E9%9D%A2.png" alt="封面"></p>
<p>这是第六周的练习题，最近加班比较多，上周主要完成一篇 <a target="_blank" rel="noopener" href="https://juejin.im/post/5cd56b1f6fb9a0321e16bde3">GraphQL入门教程</a> ，有兴趣的小伙伴可以看下哈。    </p>
<p>下面是之前分享的链接：   </p>
<ul>
<li>1.<a target="_blank" rel="noopener" href="https://juejin.im/post/5cb2df0c5188251aca7340a0">每周一练 之 数据结构与算法（Stack）</a>   </li>
<li>2.<a target="_blank" rel="noopener" href="https://juejin.im/post/5cbdbb1af265da036d79bb35">每周一练 之 数据结构与算法（LinkedList）</a>   </li>
<li>3.<a target="_blank" rel="noopener" href="https://juejin.im/post/5cc3cbaaf265da03a85ac7f8">每周一练 之 数据结构与算法（Queue）</a>   </li>
<li>4.<a target="_blank" rel="noopener" href="https://juejin.im/post/5cceee526fb9a0323a01c72e">每周一练 之 数据结构与算法（Set）</a>   </li>
<li>5.<a target="_blank" rel="noopener" href="https://juejin.im/post/5ce2a196f265da1b7638738b">每周一练 之 数据结构与算法（Dictionary 和 HashTable）</a>   </li>
</ul>
<blockquote>
<p>欢迎关注我的 <a target="_blank" rel="noopener" href="https://github.com/pingan8787">个人主页</a> &amp;&amp;  <a target="_blank" rel="noopener" href="http://www.pingan8787.com/">个人博客</a> &amp;&amp; <a target="_blank" rel="noopener" href="http://js.pingan8787.com/">个人知识库</a> &amp;&amp; 微信公众号“前端自习课”</p>
</blockquote>
<p><strong>本周练习内容：数据结构与算法 —— Tree</strong>   </p>
<p>这些都是数据结构与算法，一部分方法是团队其他成员实现的，一部分我自己做的，有什么其他实现方法或错误，欢迎各位大佬指点，感谢。   </p>
<h2 id="一、什么是树？"><a href="#一、什么是树？" class="headerlink" title="一、什么是树？"></a>一、什么是树？</h2><p>1.树有什么特点，什么是二叉树和二叉搜索树（BST: Binary Search Tree）？<br>2.生活中常见的例子有哪些？</p>
<hr>
<p>解析：   </p>
<ol>
<li>树有什么特点，什么是二叉树和二叉搜索树：     </li>
</ol>
<ul>
<li><p><strong>树</strong>是一种<strong>非线性的数据结构</strong>，以<strong>分层方式存储数据</strong>，用来表示<strong>有层级关系的数据</strong>。   </p>
</li>
<li><p>每棵树至多只有一个<strong>根结点</strong>，<strong>根结点</strong>会有很多<strong>子节点</strong>，每个<strong>子节点只有一个父结点</strong>。   </p>
</li>
<li><p><strong>父结点</strong>和<strong>子节点</strong>是相对的。   </p>
</li>
</ul>
<ol start="2">
<li>生活中的例子：<br>如：家谱、公司组织架构图。    </li>
</ol>
<h2 id="二、请实现二叉搜索树（BST），并实现以下方法："><a href="#二、请实现二叉搜索树（BST），并实现以下方法：" class="headerlink" title="二、请实现二叉搜索树（BST），并实现以下方法："></a>二、请实现二叉搜索树（BST），并实现以下方法：</h2><ul>
<li><code>insert(key)</code>：向树中插入一个新的键；    </li>
<li><code>search(key)</code>：树中查找一个键，如果节点存在返回true，不存在返回false；    </li>
<li><code>min()</code>：返回树中最小的值/键；    </li>
<li><code>max()</code>：返回树中最大的值/键；    </li>
<li><code>remove(key)</code>：移除某个键；    </li>
</ul>
<blockquote>
<p>提示：所谓的键对应于之前章节所学的节点（Node）</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">key</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.key = key</span><br><span class="line">        <span class="built_in">this</span>.left = <span class="literal">null</span></span><br><span class="line">        <span class="built_in">this</span>.right = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BST</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.root = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 插入一个节点</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>node 插入的位置节点</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>newNode 插入的节点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    insertNode (node, newNode)&#123;</span><br><span class="line">        <span class="keyword">if</span>(newNode.key &lt; node.key)&#123;</span><br><span class="line">            <span class="keyword">if</span>(node.left === <span class="literal">null</span> &amp;&amp; node.right === <span class="literal">null</span>)&#123;</span><br><span class="line">                node.left = newNode</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(node.left !== <span class="literal">null</span> &amp;&amp; node.right === <span class="literal">null</span>)&#123;</span><br><span class="line">                node.right = newNode</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="built_in">this</span>.insertNode(node.left, newNode)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(node.left === <span class="literal">null</span> &amp;&amp; node.right === <span class="literal">null</span>)&#123;</span><br><span class="line">                node.left = newNode</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(node.left !== <span class="literal">null</span> &amp;&amp; node.right === <span class="literal">null</span>)&#123;</span><br><span class="line">                node.right = newNode</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="built_in">this</span>.insertNode(node.right, newNode)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 插入操作</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>key </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    insert (key)&#123;</span><br><span class="line">        <span class="keyword">let</span> newNode = <span class="keyword">new</span> Node(key)</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">this</span>.root === <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="built_in">this</span>.root = newNode</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.insertNode(<span class="built_in">this</span>.root, newNode)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    searchNode (node, key)&#123;</span><br><span class="line">        <span class="keyword">if</span>(node === <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        <span class="keyword">if</span>(key &lt; node.key)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.searchNode(node.left, key)</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(key &gt; node.key)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.searchNode(node.right, key)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 搜索操作</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>key </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    search (key)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.searchNode(<span class="built_in">this</span>.root, key)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 最小值的节点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    min ()&#123;</span><br><span class="line">        <span class="keyword">let</span> node = <span class="built_in">this</span>.root</span><br><span class="line">        <span class="keyword">if</span>(node === <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">        <span class="keyword">while</span>(node &amp;&amp; node.left !== <span class="literal">null</span>)&#123;</span><br><span class="line">            node = node.left</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> node.key</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 最大值的节点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    max ()&#123;</span><br><span class="line">        <span class="keyword">let</span> node = <span class="built_in">this</span>.root</span><br><span class="line">        <span class="keyword">if</span>(node === <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">        <span class="keyword">while</span>(node &amp;&amp; node.right !== <span class="literal">null</span>)&#123;</span><br><span class="line">            node = node.right</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> node.key</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 找到最小节点</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>node </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    findMinNode (node)&#123;</span><br><span class="line">        <span class="keyword">if</span>(node === <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">        <span class="keyword">while</span>(node &amp;&amp; node.left !== <span class="literal">null</span>)&#123;</span><br><span class="line">            node = node.left</span><br><span class="line">        &#125;   </span><br><span class="line">        <span class="keyword">return</span> node</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除一个节点</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>node </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>key </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    removeNode (node, key)&#123;</span><br><span class="line">        <span class="keyword">if</span>(node === <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">        <span class="keyword">if</span>(key &lt; node.key)&#123;</span><br><span class="line">            node.left = <span class="built_in">this</span>.removeNode(node.left, key)</span><br><span class="line">            <span class="keyword">return</span> node</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(key &gt; node.key)&#123;</span><br><span class="line">            node.right = <span class="built_in">this</span>.removeNode(node.right, key)</span><br><span class="line">            <span class="keyword">return</span> node</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">// 1.叶节点</span></span><br><span class="line">            <span class="keyword">if</span>(node.left === <span class="literal">null</span> &amp;&amp; node.right === <span class="literal">null</span>)&#123;</span><br><span class="line">                node = <span class="literal">null</span></span><br><span class="line">                <span class="keyword">return</span> node</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 2.只有一个子节点</span></span><br><span class="line">            <span class="keyword">if</span>(node.left === <span class="literal">null</span>)&#123;</span><br><span class="line">                node = node.right</span><br><span class="line">                <span class="keyword">return</span> node</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(node.right === <span class="literal">null</span>)&#123;</span><br><span class="line">                node = node.left</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 3.有两个子节点</span></span><br><span class="line">            <span class="keyword">let</span> curNode = <span class="built_in">this</span>.findMinNode(node.right)</span><br><span class="line">            node.key = curNode.key</span><br><span class="line">            node.right = <span class="built_in">this</span>.removeNode(node.right, curNode.key)</span><br><span class="line">            <span class="keyword">return</span> node</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除一个节点</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>key </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    remove (key)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">this</span>.root === <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">        <span class="built_in">this</span>.root = <span class="built_in">this</span>.removeNode(<span class="built_in">this</span>.root, key)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="三、基于题二实现二叉搜索树扩展以下方法："><a href="#三、基于题二实现二叉搜索树扩展以下方法：" class="headerlink" title="三、基于题二实现二叉搜索树扩展以下方法："></a>三、基于题二实现二叉搜索树扩展以下方法：</h2><ul>
<li><code>preOrderTraverse()</code>：  通过先序遍历方式遍历所有节点；    </li>
<li><code>inOrderTraverse()</code>： 通过中序遍历方式遍历所有节点；    </li>
<li><code>postOrderTraverse()</code>： 通过后序遍历方式遍历所有节点；    </li>
</ul>
<p>提示：</p>
<ul>
<li>先序：先访问根节点，然后以同样方式访问左子树和右子树；（根==&gt;左==&gt;右） </li>
</ul>
<p>输出 =》 11 7 5 3 6 9 8 10 15 13 12 14 20 18 25<br><img src="http://images.pingan8787.com/20190520tree_pre.png" alt="tree_pre"></p>
<ul>
<li>中序：先访问左子树，再访问根节点，最后访问右字数；以升序访问所有节点；（左==&gt;根==&gt;右）    </li>
</ul>
<p>输出 =》 3 5 6 7 8 9 10 11 12 13 14 15 18 20 25</p>
<p><img src="http://images.pingan8787.com/20190520tree_in.png" alt="tree_in"></p>
<ul>
<li>后序：先访问叶子节点，从左子树到右子树，再到根节点。（左==&gt;右==&gt;根）    </li>
</ul>
<p>输出 =》 3 6 5 8 10 9 7 12 14 13 18 25 20 15 11</p>
<p><img src="http://images.pingan8787.com/20190520tree_post.png" alt="tree_post"></p>
<hr>
<p>解析：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 先序</span></span><br><span class="line">BST.prototype.preOrderTraverseNode = <span class="function"><span class="keyword">function</span>(<span class="params">node, callback</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(node !== <span class="literal">null</span>)&#123;</span><br><span class="line">        callback(node.key)</span><br><span class="line">        <span class="built_in">this</span>.preOrderTraverseNode(node.left, callback)</span><br><span class="line">        <span class="built_in">this</span>.preOrderTraverseNode(node.right, callback)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">BST.prototype.preOrderTraverse = <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.preOrderTraverseNode(<span class="built_in">this</span>.root, callback)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 中序</span></span><br><span class="line">BST.prototype.inOrderTraverseNode = <span class="function"><span class="keyword">function</span>(<span class="params">node, callback</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(node !== <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="built_in">this</span>.inOrderTraverseNode(node.left, callback)</span><br><span class="line">        callback(node.key)</span><br><span class="line">        <span class="built_in">this</span>.inOrderTraverseNode(node.right, callback)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">BST.prototype.inOrderTraverse = <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.inOrderTraverseNode(<span class="built_in">this</span>.root, callback)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 后序</span></span><br><span class="line">BST.prototype.postOrderTraverseNode = <span class="function"><span class="keyword">function</span>(<span class="params">node, callback</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(node !== <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="built_in">this</span>.postOrderTraverseNode(node.left, callback)</span><br><span class="line">        <span class="built_in">this</span>.postOrderTraverseNode(node.right, callback)</span><br><span class="line">        callback(node.key)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">BST.prototype.postOrderTraverse = <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.postOrderTraverseNode(<span class="built_in">this</span>.root, callback)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="四、请实现从上往下打印二叉树"><a href="#四、请实现从上往下打印二叉树" class="headerlink" title="四、请实现从上往下打印二叉树"></a>四、请实现从上往下打印二叉树</h2><p>给定的二叉树为：[3, 9 , 20, null, null, 15, 7]</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  3</span><br><span class="line"> / \</span><br><span class="line">9  20</span><br><span class="line">   / \</span><br><span class="line">  15  7</span><br></pre></td></tr></table></figure>

<p>请实现一个 <code>printLevelOrder</code> 方法，输出以下结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  [3],</span><br><span class="line">  [9, 20],</span><br><span class="line">  [15, 7]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<hr>
<p>来源：<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/binary-tree-level-order-traversal/">102.二叉树的层次遍历</a><br>解析：    </p>
<ul>
<li><p>方法一：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">BST.prototype.printLevelOrder = <span class="function"><span class="keyword">function</span> (<span class="params">root, arr = [], i = <span class="number">0</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (root &amp;&amp; (root.key || root.key === <span class="number">0</span>)) &#123;</span><br><span class="line">      !arr[i] &amp;&amp; (arr[i] = [])</span><br><span class="line">      arr[i].push(root.key)</span><br><span class="line">      i++</span><br><span class="line">      root.left &amp;&amp; <span class="built_in">this</span>.printLevelOrder(root.left, arr, i)</span><br><span class="line">      root.right &amp;&amp; <span class="built_in">this</span>.printLevelOrder(root.right, arr, i)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>方法二：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">BST.prototype.printLevelOrder = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">this</span>.root === <span class="literal">null</span>) <span class="keyword">return</span> []</span><br><span class="line">    <span class="keyword">let</span> result = [], queue = [<span class="built_in">this</span>.root]</span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> len = queue.length, arr = []</span><br><span class="line">        <span class="keyword">while</span>(len &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(queue)</span><br><span class="line">            <span class="keyword">let</span> node = queue.shift()</span><br><span class="line">            len -= <span class="number">1</span></span><br><span class="line">            arr.push(node.key)</span><br><span class="line">            <span class="keyword">if</span>(node.left !== <span class="literal">null</span>) queue.push(node.left)</span><br><span class="line">            <span class="keyword">if</span>(node.right !== <span class="literal">null</span>) queue.push(node.right)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(arr.length === <span class="number">0</span>) <span class="keyword">return</span> result</span><br><span class="line">        result.push([...arr])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="五、给定一个二叉树，判断其是否是一个有效的二叉搜索树。"><a href="#五、给定一个二叉树，判断其是否是一个有效的二叉搜索树。" class="headerlink" title="五、给定一个二叉树，判断其是否是一个有效的二叉搜索树。"></a>五、给定一个二叉树，判断其是否是一个有效的二叉搜索树。</h2><p>假设一个二叉搜索树具有如下特征：   </p>
<ul>
<li>节点的左子树只包含<strong>小于</strong>当前节点的数。</li>
<li>节点的右子树只包含<strong>大于</strong>当前节点的数。</li>
<li>所有左子树和右子树自身必须也是二叉搜索树。</li>
</ul>
<p>示例 1：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">输入:</span><br><span class="line">    2</span><br><span class="line">   / \</span><br><span class="line">  1   3</span><br><span class="line">输出: true</span><br></pre></td></tr></table></figure>

<p>示例 2：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">输入:</span><br><span class="line">    5</span><br><span class="line">   / \</span><br><span class="line">  1   4</span><br><span class="line">     / \</span><br><span class="line">    3   6</span><br><span class="line">输出: false</span><br><span class="line">解释: 输入为: [5,1,4,null,null,3,6]。</span><br><span class="line">根节点的值为 5 ，但是其右子节点值为 4 。</span><br></pre></td></tr></table></figure>

<p>代码实现：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 二叉树节点定义</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">TreeNode</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.val = val;</span><br><span class="line">  <span class="built_in">this</span>.left = <span class="built_in">this</span>.right = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">- <span class="doctag">@param <span class="type">&#123;TreeNode&#125;</span> <span class="variable">root</span></span></span></span><br><span class="line"><span class="comment">- <span class="doctag">@return <span class="type">&#123;boolean&#125;</span></span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isValidBST</span>(<span class="params">root</span>) </span>&#123;&#125;;</span><br></pre></td></tr></table></figure>

<hr>
<p>来源：<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/validate-binary-search-tree/">99.验证二叉搜索树</a><br>解析：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isValidBST</span>(<span class="params">root</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> arr = []</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">inOrderTraverse</span>(<span class="params">node</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(node === <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">        node.left &amp;&amp; inOrderTraverse(node.left);</span><br><span class="line">        arr.push(node.val);</span><br><span class="line">        node.right &amp;&amp; inOrderTraverse(node.right);</span><br><span class="line">    &#125;</span><br><span class="line">    inOrderTraverse(root)</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.length - <span class="number">1</span>; i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(arr[i] &gt;= arr[i+<span class="number">1</span>]) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/05/20/162-%E3%80%90%E7%AE%97%E6%B3%95%E3%80%91%E6%AF%8F%E5%91%A8%E4%B8%80%E7%BB%83%E4%B9%8B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%EF%BC%88Tree%EF%BC%89/" data-id="ckts3ejti003v4d9k90yz24pa" data-title="162-【算法】每周一练之数据结构与算法（Tree）" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-161-【算法】每周一练之数据结构与算法（Dictionary和HashTable）" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/05/20/161-%E3%80%90%E7%AE%97%E6%B3%95%E3%80%91%E6%AF%8F%E5%91%A8%E4%B8%80%E7%BB%83%E4%B9%8B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%EF%BC%88Dictionary%E5%92%8CHashTable%EF%BC%89/" class="article-date">
  <time class="dt-published" datetime="2019-05-20T13:09:46.000Z" itemprop="datePublished">2019-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/05/20/161-%E3%80%90%E7%AE%97%E6%B3%95%E3%80%91%E6%AF%8F%E5%91%A8%E4%B8%80%E7%BB%83%E4%B9%8B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%EF%BC%88Dictionary%E5%92%8CHashTable%EF%BC%89/">161-【算法】每周一练之数据结构与算法（Dictionary和HashTable）</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <hr>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#112;&#x69;&#x6e;&#x67;&#x61;&#x6e;&#x38;&#55;&#56;&#x37;&#x40;&#113;&#x71;&#x2e;&#x63;&#111;&#x6d;">&#112;&#x69;&#x6e;&#x67;&#x61;&#x6e;&#x38;&#55;&#56;&#x37;&#x40;&#113;&#x71;&#x2e;&#x63;&#111;&#x6d;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>微信公众号</td>
<td>前端自习课</td>
</tr>
</tbody></table>
<p><img src="http://images.pingan8787.com/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E5%B0%81%E9%9D%A2.png" alt="封面"></p>
<p>这是第五周的练习题，上周忘记发啦，这周是复习 <strong>Dictionary 和 HashTable</strong>。    </p>
<p>下面是之前分享的链接：   </p>
<ul>
<li>1.<a target="_blank" rel="noopener" href="https://juejin.im/post/5cb2df0c5188251aca7340a0">每周一练 之 数据结构与算法（Stack）</a>   </li>
<li>2.<a target="_blank" rel="noopener" href="https://juejin.im/post/5cbdbb1af265da036d79bb35">每周一练 之 数据结构与算法（LinkedList）</a>   </li>
<li>3.<a target="_blank" rel="noopener" href="https://juejin.im/post/5cc3cbaaf265da03a85ac7f8">每周一练 之 数据结构与算法（Queue）</a>   </li>
<li>4.<a target="_blank" rel="noopener" href="https://juejin.im/post/5cceee526fb9a0323a01c72e">每周一练 之 数据结构与算法（Set）</a>   </li>
</ul>
<blockquote>
<p>欢迎关注我的 <a target="_blank" rel="noopener" href="https://github.com/pingan8787">个人主页</a> &amp;&amp;  <a target="_blank" rel="noopener" href="http://www.pingan8787.com/">个人博客</a> &amp;&amp; <a target="_blank" rel="noopener" href="http://js.pingan8787.com/">个人知识库</a> &amp;&amp; 微信公众号“前端自习课”</p>
</blockquote>
<p><strong>本周练习内容：数据结构与算法 —— Dictionary 和 HashTable</strong>   </p>
<p>这些都是数据结构与算法，一部分方法是团队其他成员实现的，一部分我自己做的，有什么其他实现方法或错误，欢迎各位大佬指点，感谢。   </p>
<h2 id="一、字典和散列表的概念"><a href="#一、字典和散列表的概念" class="headerlink" title="一、字典和散列表的概念"></a>一、字典和散列表的概念</h2><ol>
<li><p>字典是什么？</p>
</li>
<li><p>字典和集合有什么异同？</p>
</li>
<li><p>什么是散列表和散列函数？</p>
</li>
<li><p>散列表的特点是什么？</p>
</li>
</ol>
<hr>
<p>解析：   </p>
<ol>
<li>字典是什么？    </li>
</ol>
<p>字典是一种以 <strong>键-值对</strong> 形式存储数据的数据格式，其中键名用来查询特定元素。</p>
<ol start="2">
<li>字典和集合有什么异同？</li>
</ol>
<p>相同：都是用来存储不同元素的数据格式；<br>区别：集合是以 <strong>值-值</strong> 的数据格式存储，而字典是以 <strong>键-值</strong> 的数据格式存储。   </p>
<ol start="3">
<li>什么是散列表和散列函数？</li>
</ol>
<p>哈希表（<code>Hash table</code>，也叫散列表），是根据关键码值(·Key value·)而直接进行访问的数据结构。也就是说，它通过把关键码值映射到表中一个位置来访问记录，以加快查找的速度。这个映射函数叫做<strong>散列函数</strong>，存放记录的数组叫做<strong>散列表</strong>。   </p>
<ol start="4">
<li>散列表的特点是什么？</li>
</ol>
<p>特点：数组和链接优点的结合，查询速度非常的快，几乎是O(1)的时间复杂度，并且插入和删除也容易。</p>
<h2 id="二、请实现一个字典"><a href="#二、请实现一个字典" class="headerlink" title="二、请实现一个字典"></a>二、请实现一个字典</h2><p><code>set(key,value)</code>：向字典中添加新元素。<br><code>delete(key)</code>：通过使用键值从字典中移除键值对应的值。<br><code>has(key)</code>：如果某个键值存在于这个字典中，则返回 true，否则返回 false。<br><code>get(key)</code>：使用键值查找对应的值并返回。<br><code>clear()</code>：删除字典中的所有元素。<br><code>size()</code>：返回字典包含的元素数量，与数组的 length 属性类似。<br><code>keys()</code>：将字典的所有键名以数组的形式返回。<br><code>values()</code>：将字典包含的所有数值以数组形式返回。   </p>
<p>使用示例：    </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> dictionary = <span class="keyword">new</span> Dictionary();</span><br><span class="line"></span><br><span class="line">dictionary.set(<span class="string">&quot;Gandalf&quot;</span>, <span class="string">&quot;gandalf@email.com&quot;</span>);</span><br><span class="line">dictionary.set(<span class="string">&quot;John&quot;</span>, <span class="string">&quot;johnsnow@email.com&quot;</span>);</span><br><span class="line">dictionary.set(<span class="string">&quot;Tyrion&quot;</span>, <span class="string">&quot;tyrion@email.com&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(dictionary.has(<span class="string">&quot;Gandalf&quot;</span>));</span><br><span class="line"><span class="built_in">console</span>.log(dictionary.size());</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(dictionary.keys());</span><br><span class="line"><span class="built_in">console</span>.log(dictionary.values());</span><br><span class="line"><span class="built_in">console</span>.log(dictionary.get(<span class="string">&quot;Tyrion&quot;</span>));</span><br><span class="line"></span><br><span class="line">dictionary.delete(<span class="string">&quot;John&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(dictionary.keys());</span><br><span class="line"><span class="built_in">console</span>.log(dictionary.values());</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>提示：Web 端优先使用 ES6 以上的语法实现。</strong>   </p>
<hr>
<p>解析：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 二、请实现一个字典</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dictionary</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.items = []</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向字典中添加新元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>key 添加的键名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>value 添加的值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    set (key, value) &#123;</span><br><span class="line">        <span class="keyword">if</span> ( !key ) <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;请指定插入的key&#x27;</span>)</span><br><span class="line">        <span class="built_in">this</span>.items[key] = value</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询某个键值存在于这个字典</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>key 查询的键名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return <span class="type">&#123;Boolean&#125;</span> </span>是否存在</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    has (key) &#123;</span><br><span class="line">        <span class="keyword">return</span> key <span class="keyword">in</span> <span class="built_in">this</span>.items </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过使用键值从字典中移除键值对应的值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>key 移除的键名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return <span class="type">&#123;Boolean&#125;</span> </span>是否移除成功</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">delete</span> (key) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!key || !<span class="built_in">this</span>.has(key)) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        <span class="keyword">delete</span> <span class="built_in">this</span>.items[key]</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用键值查找对应的值并返回</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>key 查找的键名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return <span class="type">&#123;*&#125;</span> </span>查找的结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    get (key) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.has(key) ? <span class="built_in">this</span>.items[key] : <span class="literal">undefined</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除字典中的所有元素</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    clear () &#123;</span><br><span class="line">        <span class="built_in">this</span>.items = &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将字典的所有键名以数组的形式返回</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return <span class="type">&#123;Array&#125;</span> </span>所有键名的数组</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    keys () &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Object</span>.keys(<span class="built_in">this</span>.items)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将字典的所有键值以数组的形式返回</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return <span class="type">&#123;Array&#125;</span> </span>所有键值的数组</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    values () &#123;</span><br><span class="line">        <span class="keyword">let</span> result = []</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> k <span class="keyword">in</span> <span class="built_in">this</span>.items)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">this</span>.has[k])&#123;</span><br><span class="line">                result.push(<span class="built_in">this</span>.items[k])</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回字典包含的元素数量</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return <span class="type">&#123;Number&#125;</span> </span>元素数量</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    size () &#123;</span><br><span class="line">        <span class="keyword">const</span> values = <span class="built_in">this</span>.values()</span><br><span class="line">        <span class="keyword">return</span> values.length</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三、请实现一个散列表"><a href="#三、请实现一个散列表" class="headerlink" title="三、请实现一个散列表"></a>三、请实现一个散列表</h2><p><code>put(key,value)</code>：向散列表增加/更新一个新的项。<br><code>remove(key)</code>：根据键值从散列表中移除值。<br><code>get(key)</code>：根据键值检索到特定的值。<br><code>print()</code>：打印散列表中已保存的值。   </p>
<p>散列表内部的散列算法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hashCode</span>(<span class="params">key</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> hash = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; key.length; i++) &#123;</span><br><span class="line">      hash += key.charCodeAt(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> hash % <span class="number">37</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> hashTable = <span class="keyword">new</span> HashTable();</span><br><span class="line"></span><br><span class="line">hashTable.put(<span class="string">&quot;Gandalf&quot;</span>, <span class="string">&quot;gandalf@email.com&quot;</span>);</span><br><span class="line">hashTable.put(<span class="string">&quot;John&quot;</span>, <span class="string">&quot;johnsnow@email.com&quot;</span>);</span><br><span class="line">hashTable.put(<span class="string">&quot;Tyrion&quot;</span>, <span class="string">&quot;tyrion@email.com&quot;</span>);</span><br><span class="line">hashTable.print();</span><br></pre></td></tr></table></figure>

<hr>
<p>解析：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 三、请实现一个散列表</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HashTable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.table = []</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 散列函数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>key 键名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="title">hashCode</span>(<span class="params">key</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> hash = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; key.length; i++) &#123;</span><br><span class="line">          hash += key.charCodeAt(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> hash % <span class="number">37</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向散列表增加/更新一个新的项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>key 添加的键名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>value 添加的值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    put (key, value) &#123;</span><br><span class="line">        <span class="keyword">let</span> position = <span class="built_in">this</span>.hashCode(key)</span><br><span class="line">        <span class="built_in">this</span>.table[position] = value</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据键值从散列表中移除值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>key 移除的键名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return <span class="type">&#123;Boolean&#125;</span> </span>是否成功移除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    remove (key) &#123;</span><br><span class="line">        <span class="keyword">if</span> ( !key ) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        <span class="keyword">let</span> position = <span class="built_in">this</span>.hashCode(key)</span><br><span class="line">        <span class="built_in">this</span>.table[position] = <span class="literal">undefined</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据键值检索到特定的值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>key 查找的键名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return <span class="type">&#123;*&#125;</span> </span>查找的值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    get (key) &#123;</span><br><span class="line">        <span class="keyword">let</span> position = <span class="built_in">this</span>.hashCode(key)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.table[position]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 打印散列表中已保存的值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return <span class="type">&#123;*&#125;</span> </span>散列表的值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    print () &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.table</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="四、请利用之前已实现的链表，实现一个分离链接的散列表"><a href="#四、请利用之前已实现的链表，实现一个分离链接的散列表" class="headerlink" title="四、请利用之前已实现的链表，实现一个分离链接的散列表"></a>四、请利用之前已实现的链表，实现一个分离链接的散列表</h2><p>分离链接是为散列表的每一个位置创建一个链表储存元素的方式来处理散列表中的冲突：</p>
<p><img src="https://cdn.nlark.com/yuque/0/2019/png/102778/1556970090828-8bc73588-76b8-49c3-b39e-34928db5c5ae.png" alt="separate-chaining.png"></p>
<p>请实现新的散列表方法：</p>
<p><code>put(key,value)</code>：将 <code>key 和 </code>value<code>存在一个</code>ValuePair<code>对象中（即可定义一个包含</code>key<code>和</code>value<code>属性的</code>ValuePair` 类），并将其加入对应位置的链表中。   </p>
<p><code>get(key)</code>：返回键值对应的值，没有则返回 <code>undefined</code>。  </p>
<p><code>remove(key)</code>：从散列表中移除键值对应的元素。  </p>
<p><code>print()</code>：打印散列表中已保存的值。   </p>
<p><strong>提示：先找到元素储存位置所对应的链表，再找到对应的值。</strong>   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> hashTable = <span class="keyword">new</span> HashTable();</span><br><span class="line"></span><br><span class="line">hashTable.put(<span class="string">&quot;Gandalf&quot;</span>, <span class="string">&quot;gandalf@email.com&quot;</span>);</span><br><span class="line">hashTable.put(<span class="string">&quot;Tyrion&quot;</span>, <span class="string">&quot;tyrion@email.com&quot;</span>);</span><br><span class="line">hashTable.put(<span class="string">&quot;Aaron&quot;</span>, <span class="string">&quot;aaron@email.com&quot;</span>);</span><br><span class="line">hashTable.put(<span class="string">&quot;Ana&quot;</span>, <span class="string">&quot;ana@email.com&quot;</span>);</span><br><span class="line">hashTable.put(<span class="string">&quot;Mindy&quot;</span>, <span class="string">&quot;mindy@email.com&quot;</span>);</span><br><span class="line">hashTable.put(<span class="string">&quot;Paul&quot;</span>, <span class="string">&quot;paul@email.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">hashTable.print();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(hashTable.get(<span class="string">&quot;Tyrion&quot;</span>));</span><br><span class="line"><span class="built_in">console</span>.log(hashTable.get(<span class="string">&quot;Aaron&quot;</span>));</span><br><span class="line"></span><br><span class="line">hashTable.remove(<span class="string">&quot;Tyrion&quot;</span>);</span><br><span class="line"></span><br><span class="line">hashTable.print();</span><br></pre></td></tr></table></figure>

<hr>
<p>解析：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 链表的实现代码省略 可以查看之前的代码</span></span><br><span class="line"><span class="keyword">let</span> ValuePair = <span class="function"><span class="keyword">function</span> (<span class="params">key, value</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.key = key</span><br><span class="line">    <span class="built_in">this</span>.value = value</span><br><span class="line">    <span class="built_in">this</span>.toString = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`[<span class="subst">$&#123;<span class="built_in">this</span>.key&#125;</span> - <span class="subst">$&#123;<span class="built_in">this</span>.value&#125;</span>]`</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HashTable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.table = []</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 散列函数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>key 键名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="title">hashCode</span>(<span class="params">key</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> hash = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; key.length; i++) &#123;</span><br><span class="line">          hash += key.charCodeAt(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> hash % <span class="number">37</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向散列表增加/更新一个新的项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>key 添加的键名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>value 添加的值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    put (key, value) &#123;</span><br><span class="line">        <span class="keyword">let</span> position = <span class="built_in">this</span>.hashCode(key)</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">this</span>.table[position] == <span class="literal">undefined</span>)&#123;</span><br><span class="line">            <span class="built_in">this</span>.table[position] = <span class="keyword">new</span> LinkedList()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.table[position].append(<span class="keyword">new</span> ValuePair(key, value))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据键值从散列表中移除值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>key 移除的键名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return <span class="type">&#123;Boolean&#125;</span> </span>是否成功移除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    remove (key) &#123;</span><br><span class="line">        <span class="keyword">let</span> position = <span class="built_in">this</span>.hashCode(key)</span><br><span class="line">        <span class="keyword">if</span> ( !key || <span class="built_in">this</span>.table[position] === <span class="literal">undefined</span> ) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        <span class="keyword">let</span> current = <span class="built_in">this</span>.table[position].getHead()</span><br><span class="line">        <span class="keyword">while</span>(current.next)&#123;</span><br><span class="line">            <span class="keyword">if</span>(current.element.key === key)&#123;</span><br><span class="line">                <span class="built_in">this</span>.table[position].remove(current.element)</span><br><span class="line">                <span class="keyword">if</span>(<span class="built_in">this</span>.table[position].isEmpty)&#123;</span><br><span class="line">                    <span class="built_in">this</span>.table[position] = <span class="literal">undefined</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">            current = current.next</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据键值检索到特定的值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>key 查找的键名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return <span class="type">&#123;*&#125;</span> </span>查找的值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    get (key) &#123;</span><br><span class="line">        <span class="keyword">let</span> position = <span class="built_in">this</span>.hashCode(key)</span><br><span class="line">        <span class="keyword">if</span>(!key || <span class="built_in">this</span>.table[position] === <span class="literal">undefined</span>) <span class="keyword">return</span> <span class="literal">undefined</span></span><br><span class="line">        <span class="keyword">let</span> current = <span class="built_in">this</span>.table[position].getHead()</span><br><span class="line">        <span class="keyword">while</span>(current.next())&#123;</span><br><span class="line">            <span class="keyword">if</span>(current.element.key === key)&#123;</span><br><span class="line">                <span class="keyword">return</span> current.element.value</span><br><span class="line">            &#125;</span><br><span class="line">            current = current.next</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 打印散列表中已保存的值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return <span class="type">&#123;*&#125;</span> </span>散列表的值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    print () &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.table</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="五、实现一个线性探查的散列表"><a href="#五、实现一个线性探查的散列表" class="headerlink" title="五、实现一个线性探查的散列表"></a>五、实现一个线性探查的散列表</h2><p>线性探查是解决散列表中冲突的另一种方法，当向表中某一个位置加入新元素的时候，如果索引为 <code>index</code> 的位置已经被占据了，就尝试 <code>index+1</code> 的位置。如果 <code>index+1</code> 的位置也被占据，就尝试 <code>index+2</code>，以此类推。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2019/png/102778/1556970188250-d9f8542a-5084-42e7-8bc7-ac57f52e537b.png" alt="separate-chaining.png"></p>
<p>请实现散列表：   </p>
<p><code>put(key,value)</code>：将 <code>key</code> 和 <code>value</code> 存在一个 <code>ValuePair</code> 对象中（即可定义一个包含 <code>key</code> 和 <code>value</code> 属性的 <code>ValuePair</code> 类）并分配到散列表。    </p>
<p><code>get(key)</code>：返回键值对应的值，没有则返回 <code>undefined</code>。   </p>
<p><code>remove(key)</code>：从散列表中移除键值对应的元素。   </p>
<p><strong>提示：移除一个元素，只需要将其赋值为 undefined。</strong>   </p>
<p>使用示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> hashTable = <span class="keyword">new</span> HashTable();</span><br><span class="line"></span><br><span class="line">hashTable.put(<span class="string">&quot;Gandalf&quot;</span>, <span class="string">&quot;gandalf@email.com&quot;</span>);</span><br><span class="line">hashTable.put(<span class="string">&quot;Tyrion&quot;</span>, <span class="string">&quot;tyrion@email.com&quot;</span>);</span><br><span class="line">hashTable.put(<span class="string">&quot;Aaron&quot;</span>, <span class="string">&quot;aaron@email.com&quot;</span>);</span><br><span class="line">hashTable.put(<span class="string">&quot;Ana&quot;</span>, <span class="string">&quot;ana@email.com&quot;</span>);</span><br><span class="line">hashTable.put(<span class="string">&quot;Mindy&quot;</span>, <span class="string">&quot;mindy@email.com&quot;</span>);</span><br><span class="line">hashTable.put(<span class="string">&quot;Paul&quot;</span>, <span class="string">&quot;paul@email.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">hashTable.print();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(hashTable.get(<span class="string">&quot;Tyrion&quot;</span>));</span><br><span class="line"><span class="built_in">console</span>.log(hashTable.get(<span class="string">&quot;Aaron&quot;</span>));</span><br><span class="line"></span><br><span class="line">hashTable.remove(<span class="string">&quot;Tyrion&quot;</span>);</span><br><span class="line"></span><br><span class="line">hashTable.print();</span><br></pre></td></tr></table></figure>
<hr>
<p>解析：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ValuePair = <span class="function"><span class="keyword">function</span> (<span class="params">key, value</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.key = key</span><br><span class="line">    <span class="built_in">this</span>.value = value</span><br><span class="line">    <span class="built_in">this</span>.toString = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`[<span class="subst">$&#123;<span class="built_in">this</span>.key&#125;</span> - <span class="subst">$&#123;<span class="built_in">this</span>.value&#125;</span>]`</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HashTable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.table = []</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 散列函数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>key 键名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="title">hashCode</span>(<span class="params">key</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> hash = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; key.length; i++) &#123;</span><br><span class="line">          hash += key.charCodeAt(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> hash % <span class="number">37</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向散列表增加/更新一个新的项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>key 添加的键名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>value 添加的值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    put (key, value) &#123;</span><br><span class="line">        <span class="keyword">let</span> position = <span class="built_in">this</span>.hashCode(key)</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">this</span>.table[position] == <span class="literal">undefined</span>)&#123;</span><br><span class="line">            <span class="built_in">this</span>.table[position] = <span class="keyword">new</span> ValuePair(key, value)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">let</span> index = ++position</span><br><span class="line">            <span class="keyword">while</span>(<span class="built_in">this</span>.table[index] !== <span class="literal">undefined</span>)&#123;</span><br><span class="line">                index ++</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">this</span>.table[index] = <span class="keyword">new</span> ValuePair(key, value)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据键值从散列表中移除值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>key 移除的键名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return <span class="type">&#123;Boolean&#125;</span> </span>是否成功移除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    remove (key) &#123;</span><br><span class="line">        <span class="keyword">let</span> position = <span class="built_in">this</span>.hashCode(key)</span><br><span class="line">        <span class="keyword">if</span>( !key || <span class="built_in">this</span>.table[position] === <span class="literal">undefined</span> ) <span class="keyword">return</span> <span class="literal">undefined</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">this</span>.table[position].key === key)&#123;</span><br><span class="line">            <span class="built_in">this</span>.table[index] = <span class="literal">undefined</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">let</span> index = ++position</span><br><span class="line">            <span class="keyword">while</span>(</span><br><span class="line">                <span class="built_in">this</span>.table[index] === <span class="literal">undefined</span> ||</span><br><span class="line">                <span class="built_in">this</span>.table[index].key !== key</span><br><span class="line">            )&#123;</span><br><span class="line">                index ++</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">this</span>.table[index].key === key)&#123;</span><br><span class="line">                <span class="built_in">this</span>.table[index] = <span class="literal">undefined</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据键值检索到特定的值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>key 查找的键名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return <span class="type">&#123;*&#125;</span> </span>查找的值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    get (key) &#123;</span><br><span class="line">        <span class="keyword">let</span> position = <span class="built_in">this</span>.hashCode(key)</span><br><span class="line">        <span class="keyword">if</span>( !key || <span class="built_in">this</span>.table[position] === <span class="literal">undefined</span> ) <span class="keyword">return</span> <span class="literal">undefined</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">this</span>.table[position].key === key)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.table[position].value</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">let</span> index = ++position</span><br><span class="line">            <span class="keyword">while</span>(</span><br><span class="line">                <span class="built_in">this</span>.table[index] === <span class="literal">undefined</span> ||</span><br><span class="line">                <span class="built_in">this</span>.table[index].key !== key</span><br><span class="line">            )&#123;</span><br><span class="line">                index ++</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">this</span>.table[index].key === key)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">this</span>.table[index].value</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 打印散列表中已保存的值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return <span class="type">&#123;*&#125;</span> </span>散列表的值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    print () &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.table</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="下周预告"><a href="#下周预告" class="headerlink" title="下周预告"></a>下周预告</h2><p>下周将练习 <strong>Tree</strong> 的题目。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/05/20/161-%E3%80%90%E7%AE%97%E6%B3%95%E3%80%91%E6%AF%8F%E5%91%A8%E4%B8%80%E7%BB%83%E4%B9%8B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%EF%BC%88Dictionary%E5%92%8CHashTable%EF%BC%89/" data-id="ckts3ejth003t4d9k7f06grc8" data-title="161-【算法】每周一练之数据结构与算法（Dictionary和HashTable）" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-160-【GraphQL】GraphQL真香入门教程" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/05/10/160-%E3%80%90GraphQL%E3%80%91GraphQL%E7%9C%9F%E9%A6%99%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/" class="article-date">
  <time class="dt-published" datetime="2019-05-10T12:13:08.000Z" itemprop="datePublished">2019-05-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/05/10/160-%E3%80%90GraphQL%E3%80%91GraphQL%E7%9C%9F%E9%A6%99%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/">160-【GraphQL】GraphQL真香入门教程</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <hr>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#x70;&#x69;&#x6e;&#103;&#x61;&#110;&#x38;&#55;&#x38;&#x37;&#x40;&#113;&#113;&#46;&#99;&#111;&#109;">&#x70;&#x69;&#x6e;&#103;&#x61;&#110;&#x38;&#55;&#x38;&#x37;&#x40;&#113;&#113;&#46;&#99;&#111;&#109;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>微信公众号</td>
<td>前端自习课</td>
</tr>
</tbody></table>
<p><img src="http://images.pingan8787.com/graph_demo.png" alt="封面"></p>
<p>看完复联四，我整理了这份 GraphQL 入门教程</p>
<blockquote>
<p>欢迎关注我的 <a target="_blank" rel="noopener" href="https://github.com/pingan8787">个人主页</a> &amp;&amp;  <a target="_blank" rel="noopener" href="http://www.pingan8787.com/">个人博客</a> &amp;&amp; <a target="_blank" rel="noopener" href="http://js.pingan8787.com/">个人知识库</a> &amp;&amp; 微信公众号“前端自习课”</p>
</blockquote>
<p>首先有请阿爸镇贴！哈哈哈，需要高清原图的小伙伴可以 <a target="_blank" rel="noopener" href="http://images.pingan8787.com/iron_man1.jpg">点我下载 阿爸无敌</a> 。   </p>
<p><img src="http://images.pingan8787.com/iron_man1.jpg" alt="iron_man">   </p>
<p>下面开始本文内容：   </p>
<h2 id="一、GraphQL介绍"><a href="#一、GraphQL介绍" class="headerlink" title="一、GraphQL介绍"></a>一、GraphQL介绍</h2><p><code>GraphQL</code> 是 Facebook 开发的一种 <strong>API 的查询语言</strong>，与 2015 年公开发布，是 REST API 的替代品。      </p>
<p><code>GraphQL</code> 既是一种用于 API 的<strong>查询语言</strong>也是一个满足你数据查询的<strong>运行时</strong>。 <code>GraphQL</code> 对你的 API 中的数据提供了一套易于理解的完整描述，使得客户端能够准确地获得它需要的数据，而且<strong>没有任何冗余</strong>，也让 API 更容易地随着时间推移而演进，还能用于构建强大的开发者工具。    </p>
<p>官网： <a target="_blank" rel="noopener" href="http://graphql.org/">http://graphql.org/</a><br>中文网： <a target="_blank" rel="noopener" href="http://graphql.cn/">http://graphql.cn/</a></p>
<h3 id="1-特点"><a href="#1-特点" class="headerlink" title="1. 特点"></a>1. 特点</h3><ul>
<li>请求你所要的数据，不多不少；   </li>
</ul>
<p>如：<code>hero</code> 中有 <code>name</code>, <code>age</code>, <code>sex</code> 等，可以只取得需要的字段。</p>
<ul>
<li>获取多个资源，只用一个请求；   </li>
</ul>
<p>典型的 <code>REST API</code> 请求多个资源时得载入多个 URL，而 <code>GraphQL</code> 可以通过一次请求就获取你应用所需的所有数据。这样也能保证在较慢的移动网络连接下，使用 <code>GraphQL</code> 的应用也能表现得足够迅速。   </p>
<ul>
<li>描述所有可能类型的系统。便于维护，根据需求平滑演进，添加或隐藏字段；    </li>
</ul>
<p><code>GraphQL</code> 使用类型来保证应用只请求可能的数据，还提供了清晰的辅助性错误信息。应用可以使用类型，而避免编写手动解析代码。</p>
<h3 id="2-简单案例"><a href="#2-简单案例" class="headerlink" title="2. 简单案例"></a>2. 简单案例</h3><p>这里先看下简单案例，体验下 <code>GraphQL</code> 的神奇之处（后面详细介绍）。<br>我们这样定义查询语句：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">query &#123;</span><br><span class="line">    hero</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后得到的就是我们所要查询的 <code>hero</code> 字段：    </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;hero&quot;</span>: <span class="string">&quot;I&#x27;m iron man&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样用起来，是不是更舒服呢？</p>
<h2 id="二、GraphQL与restful对比"><a href="#二、GraphQL与restful对比" class="headerlink" title="二、GraphQL与restful对比"></a>二、GraphQL与restful对比</h2><h3 id="1-restful介绍"><a href="#1-restful介绍" class="headerlink" title="1. restful介绍"></a>1. restful介绍</h3><p>全称：<code>Representational State Transfer</code> 表属性状态转移。<br>本质上就是定义 uri ，通过 API 接口来取得资源。通用系统架构，不受语言限制。    </p>
<p>例子： 饿了吗接口。<br>如：接口 <code>restapi/shopping/v3/restaurants?latitude=13</code> 就是个典型的 <code>restful</code> 接口，定义资源 + 查询条件。   </p>
<h3 id="2-与-GraphQL-比较"><a href="#2-与-GraphQL-比较" class="headerlink" title="2. 与 GraphQL 比较"></a>2. 与 GraphQL 比较</h3><ul>
<li><p><code>restful</code> 一个接口只能返回一个资源，<code>GraphQL </code>一次可以获取多个资源。    </p>
</li>
<li><p><code>restful</code> 用不同 url 来区分资源，<code>GraphQL</code> 用类型区分资源。   </p>
</li>
</ul>
<h2 id="三、使用express构建基本helloworld"><a href="#三、使用express构建基本helloworld" class="headerlink" title="三、使用express构建基本helloworld"></a>三、使用express构建基本helloworld</h2><h3 id="1-简单案例"><a href="#1-简单案例" class="headerlink" title="1. 简单案例"></a>1. 简单案例</h3><p>首先创建一个文件夹 <code>demo</code> ，并初始化一个 <code>package.json</code>，安装 <code>express</code> / <code>graphql</code> / <code>express-graphql</code> 依赖包：   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br><span class="line">npm install express graphql express-graphql -S</span><br></pre></td></tr></table></figure>

<p>新建一个 <code>hello.js</code>，引入文件：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; buildSchema &#125; = <span class="built_in">require</span>(<span class="string">&#x27;graphql&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> graphqlHTTP = <span class="built_in">require</span>(<span class="string">&#x27;express-graphql&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>创建一个 <code>schema</code> 来定义查询语句和类型，<code>buildSchema()</code> 方法需要传入的参数是<strong>字符串</strong>类型，如下面的 <code>hero</code> 查询字段，后面的 <code>String</code> 类型表示字段返回的数据类型：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> schema = buildSchema(<span class="string">`</span></span><br><span class="line"><span class="string">    type Query &#123;</span></span><br><span class="line"><span class="string">        hero: String</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span>)</span><br></pre></td></tr></table></figure>

<p>创建一个 <code>root</code> 处理器，处理对应的查询，这里的 <code>hello</code> 处理器对应的是 <code>schema</code> 中的 <code>hero</code> 字段查询的处理，这里直接返回 <code>I&#39;m iron man</code> 的结果：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> root = &#123;</span><br><span class="line">    <span class="attr">hero</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;I&#x27;m iron man&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当然，处理器中也可以是其他复杂操作，后面会介绍。   </p>
<p>然后实例化 <code>express</code> ，并且将路由转发给 <code>graphqlHTTP</code> 处理：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line">app.use(<span class="string">&#x27;/graphql&#x27;</span>, graphqlHTTP(&#123;</span><br><span class="line">    schema,</span><br><span class="line">    <span class="attr">rootValue</span>: root,</span><br><span class="line">    <span class="attr">graphiql</span>: <span class="literal">true</span></span><br><span class="line">&#125;))</span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>
<p><code>graphqlHTTP</code> 中的三个参数介绍：   </p>
<ul>
<li><code>schema</code>：定义的查询语句和类型   </li>
<li><code>rootValue</code>：处理对应查询的处理器    </li>
<li><code>graphiql</code>：是否开启调试窗口，开发阶段开启，生产阶段关闭</li>
</ul>
<p>接下来运行项目，在命令行中执行 <code>node hello.js</code>，这里可以在 <code>graphiql</code> 上做调试，打开地址 <code>localhost:3000/graphiql</code> 就可以愉快的查询了。     </p>
<p><img src="http://images.pingan8787.com/graphql_1.png" alt="1">    </p>
<p>另外我们可以在 <code>graphiql</code> 界面右侧打开 <strong>Docs</strong> 查看我们定义的所有字段和描述信息。   </p>
<p><img src="http://images.pingan8787.com/graphql_2.png" alt="2">    </p>
<p><img src="http://images.pingan8787.com/graphql_3.png" alt="3">    </p>
<p>最终代码：    </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; buildSchema &#125; = <span class="built_in">require</span>(<span class="string">&#x27;graphql&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> graphqlHTTP = <span class="built_in">require</span>(<span class="string">&#x27;express-graphql&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构建schema，这里定义查询的语句和类型</span></span><br><span class="line"><span class="keyword">const</span> schema = buildSchema(<span class="string">`</span></span><br><span class="line"><span class="string">    type Query &#123;</span></span><br><span class="line"><span class="string">        hero: String</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义查询所对应的 resolver，也就是查询对应的处理器</span></span><br><span class="line"><span class="keyword">const</span> root = &#123;</span><br><span class="line">    <span class="attr">hero</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;I&#x27;m iron man&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将路由转发给 graphqlHTTP 处理</span></span><br><span class="line">app.use(<span class="string">&#x27;/graphql&#x27;</span>, graphqlHTTP(&#123;</span><br><span class="line">    <span class="attr">schema</span>: schema,</span><br><span class="line">    <span class="attr">rootValue</span>: root,</span><br><span class="line">    <span class="attr">graphiql</span>: <span class="literal">true</span></span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>

<h3 id="2-自定义类型查询"><a href="#2-自定义类型查询" class="headerlink" title="2. 自定义类型查询"></a>2. 自定义类型查询</h3><p>我们前面的查询中，已经将 <code>hero</code> 字段定义为 <code>String</code> 类型，但是常常开发中，我们又会碰到字段是多个类型，即<strong>字段也能指代对象类型（Object）</strong>，比如一个 <code>user</code> 字段会有 <code>name</code> 、<code>age</code> 等字段，而 <code>name</code> 返回字符串类型，<code>age</code> 返回数值类型。    </p>
<p>这时候，我们可以对这个对象的字段进行<strong>次级选择（sub-selection）</strong>。GraphQL 查询能够遍历相关对象及其字段，使得客户端可以一次请求查询大量相关数据，而不像传统 REST 架构中那样需要多次往返查询。</p>
<p>我们可以新建一个查询类型来定义 <code>user</code> 字段返回的类型：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> schema = buildSchema(<span class="string">`</span></span><br><span class="line"><span class="string">    type User &#123;</span></span><br><span class="line"><span class="string">        # 查询可以有备注！</span></span><br><span class="line"><span class="string">        name: String</span></span><br><span class="line"><span class="string">        age: Int</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    type Query &#123;</span></span><br><span class="line"><span class="string">        hero: String</span></span><br><span class="line"><span class="string">        user: User</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span>)</span><br></pre></td></tr></table></figure>

<p>在处理器中我们也要加上：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> root = &#123;</span><br><span class="line">    <span class="attr">hero</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;I&#x27;m iron man&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">user</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;leo&#x27;</span>,</span><br><span class="line">            <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>这边 Int/String 参数类型的问题，下一章介绍</strong>    </p>
<h2 id="四、参数类型和参数传递"><a href="#四、参数类型和参数传递" class="headerlink" title="四、参数类型和参数传递"></a>四、参数类型和参数传递</h2><h3 id="1-基本参数类型"><a href="#1-基本参数类型" class="headerlink" title="1. 基本参数类型"></a>1. 基本参数类型</h3><p><code>String</code>, <code>Int</code>, <code>Float</code>, <code>Boolean</code> 和 <code>ID</code>，这些基本参数类型可以在 <code>schema</code> 声明中直接使用。   </p>
<ul>
<li><code>Int</code>：有符号 32 位整数。  </li>
<li><code>Float</code>：有符号双精度浮点值。  </li>
<li><code>String</code>：<code>UTF‐8</code> 字符序列。   </li>
<li><code>Boolean</code>：<code>true</code> 或者 <code>false</code>。   </li>
<li><code>ID</code>：<code>ID</code> 标量类型表示一个<strong>唯一标识符</strong>，通常用以重新获取对象或者作为缓存中的键。<code>ID</code> 类型使用和 <code>String</code> 一样的方式序列化；然而将其定义为 <code>ID</code> 意味着并<strong>不需要人类可读型</strong>。</li>
</ul>
<p>另外，我们可以使用 <code>[类型]</code> 来表示一类数组，如：   </p>
<ul>
<li><code>[Int]</code> 表示整型数组；    </li>
<li><code>[String]</code> 表示字符串型数组；   </li>
</ul>
<h3 id="2-参数传递"><a href="#2-参数传递" class="headerlink" title="2. 参数传递"></a>2. 参数传递</h3><p>使用方式和 JS 参数传递一样，小括号内定义形参，但是<strong>参数需要定义类型</strong>。    </p>
<p>使用 <code>!</code> 代表参数不能为空。  </p>
<p>下面案例：参数 <code>teamName</code> 是 <code>String</code> 类型，必须传递，而 <code>number</code> 参数也是 <code>Int</code> 类型，但是是非必须传递，最后输出的结果也是 <code>String</code> 类型。   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">type Query &#123;</span><br><span class="line">    getHero(teamName: <span class="built_in">String</span>!, number: Int): [<span class="built_in">String</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面一个案例：    </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...省略其他</span></span><br><span class="line"><span class="keyword">const</span> schema = buildSchema(<span class="string">`</span></span><br><span class="line"><span class="string">    type Query &#123;</span></span><br><span class="line"><span class="string">        getHero(teamName: String!): [String]</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> root = &#123;</span><br><span class="line">    <span class="attr">getHero</span>: <span class="function">(<span class="params">&#123;teamName&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 这里的操作 实际开发中常常用在请求数据库</span></span><br><span class="line">        <span class="keyword">const</span> hero = &#123;</span><br><span class="line">            <span class="string">&#x27;三国&#x27;</span>: [<span class="string">&#x27;张飞&#x27;</span>, <span class="string">&#x27;刘备&#x27;</span>, <span class="string">&#x27;关羽&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;复仇者联盟&#x27;</span>: [<span class="string">&#x27;钢铁侠&#x27;</span>, <span class="string">&#x27;美国队长&#x27;</span>, <span class="string">&#x27;绿巨人&#x27;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> hero[teamName]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//...省略其他</span></span><br></pre></td></tr></table></figure>
<p>这时候我们在 <strong>GraphiQL</strong> 上输入查询，就会得到 <strong>复仇者联盟</strong> 的英雄数据了。    </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询</span></span><br><span class="line">query &#123;</span><br><span class="line">	getHero(teamName:<span class="string">&quot;复仇者联盟&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结果</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;getHero&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;钢铁侠&quot;</span>,</span><br><span class="line">            <span class="string">&quot;美国队长&quot;</span>,</span><br><span class="line">            <span class="string">&quot;绿巨人&quot;</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-自定义返回类型"><a href="#3-自定义返回类型" class="headerlink" title="3. 自定义返回类型"></a>3. 自定义返回类型</h3><p>在实际开发中，我们返回的数据类型可能是一个对象，对象中可能既有 <code>Int</code> 类型的属性，也有 <code>String</code> 类型的值，等等，这里我们可以使用 <strong>自定义返回类型</strong> 来处理：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...省略其他</span></span><br><span class="line"><span class="keyword">const</span> schema = buildSchema(<span class="string">`</span></span><br><span class="line"><span class="string">    type Hero &#123;</span></span><br><span class="line"><span class="string">        name: String</span></span><br><span class="line"><span class="string">        age: Int</span></span><br><span class="line"><span class="string">        doSomething(thing: String): String</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    type Query &#123;</span></span><br><span class="line"><span class="string">        getSuperHero(heroName: String!): Hero</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span>)</span><br><span class="line"><span class="keyword">const</span> root = &#123;</span><br><span class="line">    <span class="attr">getSuperHero</span>: <span class="function">(<span class="params">&#123;heroName&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 这里的操作 实际开发中常常用在请求数据库</span></span><br><span class="line">        <span class="keyword">const</span> name = heroName</span><br><span class="line">        <span class="keyword">const</span> age = <span class="number">18</span></span><br><span class="line">        <span class="keyword">const</span> doSomething = <span class="function">(<span class="params">&#123;thing&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">`I&#x27;m <span class="subst">$&#123;name&#125;</span>, I&#x27;m <span class="subst">$&#123;thing&#125;</span> now`</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> &#123; name, age, doSomething &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//...省略其他</span></span><br></pre></td></tr></table></figure>

<p>这里指定了 <code>getSuperHero</code> 字段的返回类型是 <code>Hero</code> 类型，随后在上面定义了 <code>Hero</code>。    </p>
<p>其中 <code>Hero</code> 类型中的 <code>doSomething</code>也是可以传递指定类型参数，并且指定返回类型。   </p>
<p>下面看下输出情况：    </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询</span></span><br><span class="line">query &#123;</span><br><span class="line">	<span class="function"><span class="title">getSuperHero</span>(<span class="params">heroName:<span class="string">&quot;IronMan&quot;</span></span>)</span> &#123;</span><br><span class="line">        name</span><br><span class="line">        age</span><br><span class="line">        doSomething</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结果</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;getSuperHero&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;IronMan&quot;</span>,</span><br><span class="line">            <span class="string">&quot;age&quot;</span>: <span class="number">46</span>,</span><br><span class="line">            <span class="string">&quot;doSomething&quot;</span>: <span class="string">&quot;I&#x27;m IronMan, I&#x27;m undefined now&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里也可以给 <code>doSomething</code> 传递参数，就会获取到不同结果：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询</span></span><br><span class="line">query &#123;</span><br><span class="line">	<span class="function"><span class="title">getSuperHero</span>(<span class="params">heroName:<span class="string">&quot;IronMan&quot;</span></span>)</span> &#123;</span><br><span class="line">        name</span><br><span class="line">        age</span><br><span class="line">	    doSomething(thing:<span class="string">&quot;watching TV&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结果</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;getSuperHero&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;IronMan&quot;</span>,</span><br><span class="line">            <span class="string">&quot;age&quot;</span>: <span class="number">46</span>,</span><br><span class="line">            <span class="string">&quot;doSomething&quot;</span>: <span class="string">&quot;I&#x27;m IronMan, I&#x27;m watching TV now&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="五、GraphQL客户端"><a href="#五、GraphQL客户端" class="headerlink" title="五、GraphQL客户端"></a>五、GraphQL客户端</h2><p>这一节我们学习如何在客户端中访问 <code>graphql</code> 的接口。     </p>
<h3 id="1-后端定义接口"><a href="#1-后端定义接口" class="headerlink" title="1. 后端定义接口"></a>1. 后端定义接口</h3><p>我们先在后端将接口开发完成，这里跟前面差不多，但需要多一步，使用 <code>express</code> 向外暴露一个文件夹，供用户访问静态资源文件：   </p>
<p><strong>这里直接使用前一节的代码啦~</strong>    </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js  开发 graphql 接口</span></span><br><span class="line"><span class="comment">//...省略其他</span></span><br><span class="line"><span class="keyword">const</span> schema = buildSchema(<span class="string">`</span></span><br><span class="line"><span class="string">    type Hero &#123;</span></span><br><span class="line"><span class="string">        name: String</span></span><br><span class="line"><span class="string">        age: Int</span></span><br><span class="line"><span class="string">        doSomething(thing: String): String</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    type Query &#123;</span></span><br><span class="line"><span class="string">        getSuperHero(heroName: String!): Hero</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span>)</span><br><span class="line"><span class="keyword">const</span> root = &#123;</span><br><span class="line">    <span class="attr">getSuperHero</span>: <span class="function">(<span class="params">&#123;heroName&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 这里的操作 实际开发中常常用在请求数据库</span></span><br><span class="line">        <span class="keyword">const</span> name = heroName</span><br><span class="line">        <span class="keyword">const</span> age = <span class="number">46</span></span><br><span class="line">        <span class="keyword">const</span> doSomething = <span class="function">(<span class="params">&#123;thing&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">`I&#x27;m <span class="subst">$&#123;name&#125;</span>, I&#x27;m <span class="subst">$&#123;thing&#125;</span> now`</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> &#123; name, age, doSomething &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line">app.use(<span class="string">&#x27;/graphql&#x27;</span>, graphqlHTTP(&#123;</span><br><span class="line">    schema, <span class="attr">rootValue</span>: root, <span class="attr">graphiql</span>: <span class="literal">true</span></span><br><span class="line">&#125;))</span><br><span class="line"><span class="comment">// 公开文件夹 使用户访问静态资源</span></span><br><span class="line">app.use(express.static(<span class="string">&#x27;public&#x27;</span>))</span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>
<p>这样我们就给前端页面提供一个可以访问静态资源的功能。   </p>
<p>这里还需要在根目录创建一个 <strong>public</strong> 文件夹，并在文件夹中添加 <code>index.html</code> 文件，此时的目录结构：   </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">|-node_modules</span><br><span class="line">|-public</span><br><span class="line">|---index.html</span><br><span class="line">|-index.js</span><br><span class="line">|-package.json</span><br></pre></td></tr></table></figure>

<h3 id="2-前端页面请求"><a href="#2-前端页面请求" class="headerlink" title="2. 前端页面请求"></a>2. 前端页面请求</h3><p>然后给 <code>index.html</code> 添加按钮和事件绑定：    </p>
<p>这里的变量 <code>query</code> 是个<strong>字符串类型</strong>，定义查询条件，在条件 <code>GetSuperHero</code> 中的参数，需要用 <code>$</code> 符号来标识，并在实际查询 <code>getSuperHero</code> 中，作为参数的参数类型设置进来。    </p>
<p>然后定义变量 <code>variables</code> ，指定属性的值，之后通过 <code>fetch</code> 发起请求：   </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;getData()&quot;</span>&gt;</span>获取数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> query = <span class="string">`</span></span></span><br><span class="line"><span class="string"><span class="javascript">        query GetSuperHero($heroName: String, $thing: String)&#123;</span></span></span><br><span class="line"><span class="string"><span class="javascript">            getSuperHero(heroName: $heroName)&#123;</span></span></span><br><span class="line"><span class="string"><span class="javascript">                name</span></span></span><br><span class="line"><span class="string"><span class="javascript">                    age</span></span></span><br><span class="line"><span class="string"><span class="javascript">                    doSomething(thing: $thing)</span></span></span><br><span class="line"><span class="string"><span class="javascript">            &#125;</span></span></span><br><span class="line"><span class="string"><span class="javascript">        &#125;</span></span></span><br><span class="line"><span class="string"><span class="javascript">    `</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">// 如果不需要其他参数 至少要传一个参数 否则会报错</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">// const query = `</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">//     query GetSuperHero($heroName: String)&#123;</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">//         getSuperHero(heroName: $heroName)&#123;</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">//              name</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">//         &#125;</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">//     &#125;</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">// `    </span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> variables = &#123;<span class="attr">heroName</span>: <span class="string">&#x27;钢铁侠&#x27;</span>, <span class="attr">thing</span>: <span class="string">&#x27;watching TV&#x27;</span>&#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    fetch(<span class="string">&#x27;./graphql&#x27;</span>, &#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="attr">headers</span>: &#123;</span></span><br><span class="line"><span class="javascript">            <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span></span><br><span class="line"><span class="javascript">        &#125;,</span></span><br><span class="line"><span class="javascript">        <span class="attr">body</span>: <span class="built_in">JSON</span>.stringify(&#123;</span></span><br><span class="line"><span class="javascript">            query, variables</span></span><br><span class="line"><span class="javascript">        &#125;)</span></span><br><span class="line"><span class="javascript">    &#125;)</span></span><br><span class="line"><span class="javascript">    .then(<span class="function"><span class="params">res</span> =&gt;</span> res.json())</span></span><br><span class="line"><span class="javascript">    .then(<span class="function"><span class="params">json</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(json)</span></span><br><span class="line"><span class="javascript">    &#125;)</span></span><br><span class="line"><span class="javascript">&#125;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>当我们写完以后，点击 <strong>获取数据</strong> 就会在控制台打印下面的数据：    </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;data&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;getSuperHero&quot;</span>:&#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>:<span class="string">&quot;钢铁侠&quot;</span>,</span><br><span class="line">            <span class="string">&quot;age&quot;</span>:<span class="number">46</span>,</span><br><span class="line">            <span class="string">&quot;doSomething&quot;</span>: <span class="string">&quot;I&#x27;m 钢铁侠, I&#x27;m watching TV now&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-注意点"><a href="#3-注意点" class="headerlink" title="3. 注意点"></a>3. 注意点</h3><ul>
<li>请求中的 <code>query</code> 参数需要对照好有 <code>$</code> 符号的变量。   </li>
</ul>
<p>查询语句 <code>query GetSuperHero($heroName: String)</code> 里参数 <code>$heroName</code> 中的 <code>heroName</code> ；<br>查询语句 <code>getSuperHero(heroName: $heroName)</code>  里类型 <code>$heroName</code> 中的 <code>heroName</code> ；<br>变量 <code>variables</code> 中的 <code>heroName</code> 属性；   </p>
<p><strong>这三个名称需要一样</strong>。   </p>
<ul>
<li>请求中需要将数据<strong>序列化操作</strong>。   </li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">body: <span class="built_in">JSON</span>.stringify(&#123; query, variables &#125;)</span><br></pre></td></tr></table></figure>

<h2 id="六、使用Mutations修改数据"><a href="#六、使用Mutations修改数据" class="headerlink" title="六、使用Mutations修改数据"></a>六、使用Mutations修改数据</h2><h3 id="1-Mutation-使用"><a href="#1-Mutation-使用" class="headerlink" title="1. Mutation 使用"></a>1. Mutation 使用</h3><p>根据前面的学习，我们知道，要做查询操作，需要使用 <code>Query</code> 来声明:    </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">type Query &#123;</span><br><span class="line">    queryHero(heroName: <span class="built_in">String</span>): <span class="built_in">String</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当我们要做<strong>修改操作</strong>，需要用到的是 <code>Mutation</code> :   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">type Mutation &#123;</span><br><span class="line">    createHero(heroName: <span class="built_in">String</span>): <span class="built_in">String</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果 <code>Mutation</code> 中字段的形参是<strong>自定义类型</strong>，则类型需要用 <code>input</code> 标识：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> schema = buildSchema(<span class="string">`</span></span><br><span class="line"><span class="string">    # 输入类型 用 input 标识</span></span><br><span class="line"><span class="string">    input HeroInput &#123;</span></span><br><span class="line"><span class="string">        name: String</span></span><br><span class="line"><span class="string">        age: Int</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    # 查询类型</span></span><br><span class="line"><span class="string">    type Hero &#123;</span></span><br><span class="line"><span class="string">        name: String</span></span><br><span class="line"><span class="string">        age: Int</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    type Mutation &#123;</span></span><br><span class="line"><span class="string">        createHero(heroName: String): Hero</span></span><br><span class="line"><span class="string">        updateHero(heroName: String, hero: HeroInput): Hero</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span>)</span><br></pre></td></tr></table></figure>
<p>注意下：这里需要至少定义一个 <code>Query</code> 不然<code> GraphiQL</code> 会不显示查询：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">type Query &#123;</span><br><span class="line">    <span class="attr">hero</span>: [Hero]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-Mutation-使用案例"><a href="#2-Mutation-使用案例" class="headerlink" title="2. Mutation 使用案例"></a>2. Mutation 使用案例</h3><p>先创建一个 <code>schema</code> ，内容为上一步【1. Mutation 使用】中定义的内容，这里不重复写。<br>然后模拟创建一个本地数据库 <code>localDb</code>， 用于模拟存放添加的超级英雄数据:    </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> localDb = &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>接下来声明 <code>root</code> 实现 <code>schema</code> 中的字段方法：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> root = &#123;</span><br><span class="line">    <span class="function"><span class="title">hero</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 这里需要转成数组 因为前面定义了返回值是  [Hero]  类型</span></span><br><span class="line">        <span class="keyword">let</span> arr = []</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">const</span> key <span class="keyword">in</span> localDb)&#123;</span><br><span class="line">            arr.push(localDb[key])</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> arr</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">createHero</span>(<span class="params">&#123; input &#125;</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 相当于数据库的添加操作</span></span><br><span class="line">        localDb[input.name] = input</span><br><span class="line">        <span class="keyword">return</span> localDb[input.name]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">updateHero</span>(<span class="params">&#123; id, input &#125;</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 相当于数据库的更新操作</span></span><br><span class="line">        <span class="keyword">const</span> update = <span class="built_in">Object</span>.assign(&#123;&#125;, localDb[id], input)</span><br><span class="line">        localDb[id] = update</span><br><span class="line">        <span class="keyword">return</span> update</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后配置 <code>graphqlHTTP</code> 方法和启动服务器，这里就不多重复咯。    </p>
<p>最终代码：    </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...省略其他</span></span><br><span class="line"><span class="keyword">const</span> schema = buildSchema(<span class="string">`</span></span><br><span class="line"><span class="string">    # 输入类型 用 input 标识</span></span><br><span class="line"><span class="string">    input HeroInput &#123;</span></span><br><span class="line"><span class="string">        name: String</span></span><br><span class="line"><span class="string">        age: Int</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    # 查询类型</span></span><br><span class="line"><span class="string">    type Hero &#123;</span></span><br><span class="line"><span class="string">        name: String</span></span><br><span class="line"><span class="string">        age: Int</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    type Mutation &#123;</span></span><br><span class="line"><span class="string">        createHero(input: HeroInput): Hero </span></span><br><span class="line"><span class="string">        updateHero(id: ID!, input: HeroInput): Hero</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    # 需要至少定义一个 Query 不要GraphiQL会不显示查询</span></span><br><span class="line"><span class="string">    type Query &#123;</span></span><br><span class="line"><span class="string">        hero: [Hero]</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> localDb = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> root = &#123;</span><br><span class="line">    <span class="function"><span class="title">hero</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 这里需要转成数组 因为前面定义了返回值是  [Hero]  类型</span></span><br><span class="line">        <span class="keyword">let</span> arr = []</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">const</span> key <span class="keyword">in</span> localDb)&#123;</span><br><span class="line">            arr.push(localDb[key])</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> arr</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">createHero</span>(<span class="params">&#123; input &#125;</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 相当于数据库的添加操作</span></span><br><span class="line">        localDb[input.name] = input</span><br><span class="line">        <span class="keyword">return</span> localDb[input.name]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">updateHero</span>(<span class="params">&#123; id, input &#125;</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 相当于数据库的更新操作</span></span><br><span class="line">        <span class="keyword">const</span> update = <span class="built_in">Object</span>.assign(&#123;&#125;, localDb[id], input)</span><br><span class="line">        localDb[id] = update</span><br><span class="line">        <span class="keyword">return</span> update</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//...省略其他</span></span><br></pre></td></tr></table></figure>

<p>现在我们可以启动服务器，在 <code>GraphiQL</code> 上测试下效果了。    </p>
<p>我们是使用 <code>mutation</code> 的 <code>createHero</code> 字段添加两条数据：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mutation &#123;</span><br><span class="line">    <span class="function"><span class="title">createHero</span>(<span class="params">input: &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">        name: <span class="string">&quot;钢铁侠&quot;</span></span></span></span><br><span class="line"><span class="params"><span class="function">        age: <span class="number">40</span></span></span></span><br><span class="line"><span class="params"><span class="function">    &#125;</span>)</span>&#123;</span><br><span class="line">        name</span><br><span class="line">        age</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mutation &#123;</span><br><span class="line">    <span class="function"><span class="title">createHero</span>(<span class="params">input: &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">        name: <span class="string">&quot;美国队长&quot;</span></span></span></span><br><span class="line"><span class="params"><span class="function">        age: <span class="number">41</span></span></span></span><br><span class="line"><span class="params"><span class="function">    &#125;</span>)</span>&#123;</span><br><span class="line">        name</span><br><span class="line">        age</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后使用 <code>query</code> 的 <code>hero</code> 字段查询添加的结果：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">query &#123;</span><br><span class="line">    hero &#123;</span><br><span class="line">        name</span><br><span class="line">        age</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样我们就获取到刚才的添加结果：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;hero&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;钢铁侠&quot;</span>,</span><br><span class="line">                <span class="string">&quot;age&quot;</span>: <span class="number">40</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;美国队长&quot;</span>,</span><br><span class="line">                <span class="string">&quot;age&quot;</span>: <span class="number">41</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后我们开始更新数据，使用 <code>mutation</code> 的 <code>updateHero</code> 字段将 <strong>美国队长</strong> 的 <code>age</code> 值修改为 18：    </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mutation &#123;</span><br><span class="line">    <span class="function"><span class="title">updateHero</span>(<span class="params">id: <span class="string">&quot;美国队长&quot;</span>, input: &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">        age: <span class="number">18</span></span></span></span><br><span class="line"><span class="params"><span class="function">    &#125;</span>)</span>&#123;</span><br><span class="line">        age</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再使用 <code>query</code> 的 <code>hero</code> 字段查询下新的数据，会发现 <strong>美国队长</strong> 的 <code>age</code> 值已经更新为 18：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;hero&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;钢铁侠&quot;</span>,</span><br><span class="line">                <span class="string">&quot;age&quot;</span>: <span class="number">40</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;美国队长&quot;</span>,</span><br><span class="line">                <span class="string">&quot;age&quot;</span>: <span class="number">18</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="七、认证和中间件"><a href="#七、认证和中间件" class="headerlink" title="七、认证和中间件"></a>七、认证和中间件</h2><p>我们知道，修改数据的接口不能让所有人随意访问，所以需要添加权限认证，让有权限的人才可以访问。<br>在 <code>express</code> 中，可以很简单的使用<strong>中间件</strong>来将请求进行拦截，将没有权限的请求过滤并返回错误提示。</p>
<p>中间件实际上是一个函数，在接口执行之前，先拦截请求，再决定我们是否接着往下走，还是返回错误提示。   </p>
<p>这在【六、使用Mutations修改数据】的最终代码上，在添加这个中间件：    </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//... 省略其他</span></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"><span class="keyword">const</span> middleWare = <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 这里是简单模拟权限</span></span><br><span class="line">    <span class="comment">// 实际开发中 更多的是和后端进行 token 交换来判断权限</span></span><br><span class="line">    <span class="keyword">if</span>(req.url.indexOf(<span class="string">&#x27;/graphql&#x27;</span>) !== -<span class="number">1</span> &amp;&amp; req.headers.cookie.indexOf(<span class="string">&#x27;auth&#x27;</span>) === -<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="comment">// 向客户端返回一个错误信息</span></span><br><span class="line">        res.send(<span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">            <span class="attr">err</span>: <span class="string">&#x27;暂无权限&#x27;</span></span><br><span class="line">        &#125;))</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    next() <span class="comment">// 正常下一步</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 注册中间件</span></span><br><span class="line">app.use(middleWare)</span><br><span class="line"></span><br><span class="line"><span class="comment">//... 省略其他</span></span><br></pre></td></tr></table></figure>

<p>这里的权限判断，只是简单模拟，实际开发中，更多的是和后端进行 <code>token</code> 交换来判断权限（或者其他形式）。<br>我们重启服务器，打开 <code>http://localhost:3000/graphql</code> ，发现页面提示错误了，因为 <code>cookies</code> 中没有含有 <code>auth</code> 字符串。    </p>
<p>如果这里提示 <code>TypeError: Cannot read property &#39;indexOf&#39; of undefined</code> ，可以先不用管，因为浏览器中没有 <code>cookies</code> 的原因，其实前面的权限判断逻辑需要根据具体业务场景判断。   </p>
<p>为了方便测试，我们在 chrome 浏览器控制台的 <code>application</code> 下，手动设置一个含有 <code>auth</code> 字符串的一个 <code>cookies</code> ，只是测试使用哦。   </p>
<p>设置完成后，我们就能正常进入页面。    </p>
<h2 id="八、ConstructingTypes"><a href="#八、ConstructingTypes" class="headerlink" title="八、ConstructingTypes"></a>八、ConstructingTypes</h2><p>在前面的介绍中，我们要创建一个 <code>schema</code> 都是使用 <code>buildSchema</code> 方法来定义，但我们也可以使用另外一种定义方式。<br>就是这里要学习使用的构造函数 <code>graphql.GraphQLObjectType</code> 定义，它有这么几个优点和缺点：    </p>
<ul>
<li><strong>优点</strong>：报错提醒更直观，结构更清晰，更便于维护。   </li>
<li><strong>缺点</strong>：代码量上升。   </li>
</ul>
<h3 id="1-定义type（类型）"><a href="#1-定义type（类型）" class="headerlink" title="1. 定义type（类型）"></a>1. 定义type（类型）</h3><p>这里先将前面定义的 <code>Hero</code> 类型进行改造：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> graphql = <span class="built_in">require</span>(<span class="string">&#x27;graphql&#x27;</span>) <span class="comment">// 需要引入</span></span><br><span class="line"><span class="keyword">const</span> HeroType = <span class="keyword">new</span> graphql.GraphQLObjectType(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Hero&#x27;</span>,</span><br><span class="line">    <span class="attr">fields</span>: &#123;</span><br><span class="line">        <span class="attr">name</span>:&#123; <span class="attr">type</span>: graphql.GraphQLString &#125;,</span><br><span class="line">        <span class="attr">age</span>:&#123; <span class="attr">type</span>: graphql.GraphQLInt &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="http://images.pingan8787.com/graphql_6.png" alt="graphql6">   </p>
<p>两者区别在于：    </p>
<table>
<thead>
<tr>
<th align="center">区别</th>
<th align="center"><code>buildSchema</code></th>
<th align="center"><code>graphql.GraphQLObjectType</code></th>
</tr>
</thead>
<tbody><tr>
<td align="center">参数类型</td>
<td align="center">字符串</td>
<td align="center">对象</td>
</tr>
<tr>
<td align="center">类名</td>
<td align="center">跟在 <code>type</code> 字符后面，这里是 <code>type Hero</code></td>
<td align="center">在参数对象的 <code>name</code> 属性上</td>
</tr>
<tr>
<td align="center">属性定义</td>
<td align="center">定义在类型后，<strong>键值对</strong>形式</td>
<td align="center">定义在参数对象 <code>fields</code> 属性中，值为对象，每个属性名为键名，值也是对象，其中 <code>type</code> 属性的值为 <code>graphql</code> 中的属性，下面会补充</td>
</tr>
</tbody></table>
<p>补充：<br><code>fields</code> 属性中的子属性的类型通常有：    </p>
<ul>
<li><code>graphql.GraphQLString</code>  </li>
<li><code>graphql.GraphQLInt</code></li>
<li><code>graphql.GraphQLBoolean</code><br>….</li>
</ul>
<p>即在 <code>GraphQL</code>后面跟上基本类型名称。    </p>
<h3 id="2-定义query（查询）"><a href="#2-定义query（查询）" class="headerlink" title="2. 定义query（查询）"></a>2. 定义query（查询）</h3><p>定义查询的时候，跟之前类似，可以参照下面对比图理解，这里比较不同的是，多了个 <code>resolve</code> 的方法，这个方法是用来执行处理查询的逻辑，其实就是之前的 <code>root</code> 中的方法。    </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> QueryType = <span class="keyword">new</span> graphql.GraphQLObjectType(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Query&#x27;</span>,</span><br><span class="line">    <span class="attr">fields</span>: &#123;</span><br><span class="line">        <span class="comment">// 一个个查询方法</span></span><br><span class="line">        <span class="attr">getSuperHero</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: HeroType,</span><br><span class="line">            <span class="attr">args</span>: &#123;</span><br><span class="line">                <span class="attr">heroName</span>: &#123; <span class="attr">type</span>: graphql.GraphQLString &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 方法实现 查询的处理函数</span></span><br><span class="line">            <span class="attr">resolve</span>: <span class="function"><span class="keyword">function</span>(<span class="params">_, &#123; heroName &#125;</span>)</span>&#123;</span><br><span class="line">                <span class="keyword">const</span> name = heroName</span><br><span class="line">                <span class="keyword">const</span> age = <span class="number">18</span></span><br><span class="line">                <span class="keyword">return</span> &#123; name, age &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="http://images.pingan8787.com/graphql_8.png" alt="graphql8">   </p>
<h3 id="3-创建-schema"><a href="#3-创建-schema" class="headerlink" title="3. 创建 schema"></a>3. 创建 schema</h3><p>创建的时候只需实例化并且将参数传入即可：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step3 构造 schema</span></span><br><span class="line"><span class="keyword">const</span> schema = <span class="keyword">new</span> graphql.GraphQLSchema(&#123; <span class="attr">query</span>: QueryType&#125;)</span><br></pre></td></tr></table></figure>

<p>最后使用也是和前面一样：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">&#x27;/graphql&#x27;</span>, graphqlHTTP(&#123;</span><br><span class="line">    schema,</span><br><span class="line">    <span class="attr">graphiql</span>: <span class="literal">true</span></span><br><span class="line">&#125;))</span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>


<h2 id="九、与数据库结合实战"><a href="#九、与数据库结合实战" class="headerlink" title="九、与数据库结合实战"></a>九、与数据库结合实战</h2><p>我们试着使用前面所学的内容，开发一个简单的实践项目：<br>通过 <code>GraphiQL</code> 页面，往 <code>Mongodb</code> 中插入和更新数据，主要用到【六、使用Mutations修改数据】章节的操作。    </p>
<h3 id="1-搭建并启动本地-Mongodb-数据库"><a href="#1-搭建并启动本地-Mongodb-数据库" class="headerlink" title="1. 搭建并启动本地 Mongodb 数据库"></a>1. 搭建并启动本地 Mongodb 数据库</h3><p>首先我们可以到 <a target="_blank" rel="noopener" href="https://www.mongodb.com/download-center">Mongodb 官网</a> 选择对应平台和版本下载安装。    </p>
<blockquote>
<p>下载安装步骤，可以参考 <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43288085/article/details/83187440">mongoDB下载、安装和配置</a>，这里就不多介绍哟~~   </p>
</blockquote>
<p>安装完成后，我们打开两个终端，分别执行下面两行命令：   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 终端1  启动数据库</span><br><span class="line">mongod --dbpath c:\leo\app\mongodb\data\db</span><br><span class="line"></span><br><span class="line">// 终端2  进入数据库命令行操作模式</span><br><span class="line">mongo</span><br></pre></td></tr></table></figure>

<h3 id="2-连接数据库，创建-Schema-和-Model"><a href="#2-连接数据库，创建-Schema-和-Model" class="headerlink" title="2. 连接数据库，创建 Schema 和 Model"></a>2. 连接数据库，创建 Schema 和 Model</h3><p>首先我们新建一个文件 <code>db.js</code> ，并 <code>npm install mongoose</code> 安装 <code>mongoose</code> ，然后写入下面代码，实现<strong>连接数据库</strong>：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; buildSchema &#125; = <span class="built_in">require</span>(<span class="string">&#x27;graphql&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> graphqlHTTP = <span class="built_in">require</span>(<span class="string">&#x27;express-graphql&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> DB_PATH = <span class="string">&#x27;mongodb://127.0.0.1:27017/hero_table&#x27;</span></span><br><span class="line"><span class="keyword">const</span> connect = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 连接数据库</span></span><br><span class="line">    mongoose.connect(DB_PATH)</span><br><span class="line">    <span class="comment">// 连接断开</span></span><br><span class="line">    mongoose.connection.on(<span class="string">&#x27;disconnected&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        mongoose.connect(DB_PATH)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 连接失败</span></span><br><span class="line">    mongoose.connection.on(<span class="string">&#x27;error&#x27;</span>, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(err)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 连接成功</span></span><br><span class="line">    mongoose.connection.on(<span class="string">&#x27;connected&#x27;</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;Connected to MongoDB connected&#x27;</span>, DB_PATH)</span><br><span class="line">    &#125;)  </span><br><span class="line">&#125;</span><br><span class="line">connect()</span><br></pre></td></tr></table></figure>

<p>然后创建 <code>Schema</code> 和 <code>Model</code>：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> HeroSchema = <span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="built_in">Number</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">let</span> HeroModel = mongoose.model(<span class="string">&#x27;hero&#x27;</span>,HeroSchema, <span class="string">&#x27;hero_table&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="3-声明查询语句"><a href="#3-声明查询语句" class="headerlink" title="3. 声明查询语句"></a>3. 声明查询语句</h3><p>这一步，还是先使用【六、使用Mutations修改数据】章节的操作逻辑，也就是先用<strong>字符串创建查询</strong>，而不使用 <code>GraphQLObjectType</code> 创建：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> schema = buildSchema(<span class="string">`</span></span><br><span class="line"><span class="string">    # 输入类型 用 input 标识</span></span><br><span class="line"><span class="string">    input HeroInput &#123;</span></span><br><span class="line"><span class="string">        name: String</span></span><br><span class="line"><span class="string">        age: Int</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    # 查询类型</span></span><br><span class="line"><span class="string">    type Hero &#123;</span></span><br><span class="line"><span class="string">        name: String</span></span><br><span class="line"><span class="string">        age: Int</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    type Mutation &#123;</span></span><br><span class="line"><span class="string">        createHero(input: HeroInput): Hero </span></span><br><span class="line"><span class="string">        updateHero(hero: String!, input: HeroInput): Hero</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    # 需要至少定义一个 Query 不要GraphiQL会不显示查询</span></span><br><span class="line"><span class="string">    type Query &#123;</span></span><br><span class="line"><span class="string">        hero: [Hero]</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span>)</span><br></pre></td></tr></table></figure>
<p><strong>这边案例有稍作修改</strong>   </p>
<h3 id="4-实现添加数据和更新数据的逻辑"><a href="#4-实现添加数据和更新数据的逻辑" class="headerlink" title="4. 实现添加数据和更新数据的逻辑"></a>4. 实现添加数据和更新数据的逻辑</h3><p>这边处理添加数据和更新数据的逻辑，就要修改之前声明的 <code>root</code> 的操作内容了：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> root = &#123;</span><br><span class="line">    <span class="function"><span class="title">hero</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>( <span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            HeroModel.find(<span class="function">(<span class="params">err, res</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(err) &#123;</span><br><span class="line">                    reject(err)</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                &#125;</span><br><span class="line">                resolve(res)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">createHero</span>(<span class="params">&#123; input &#125;</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 实例化一个Model</span></span><br><span class="line">        <span class="keyword">const</span> &#123; name, age &#125; = input</span><br><span class="line">        <span class="keyword">const</span> params = <span class="keyword">new</span> HeroModel(&#123; name, age &#125;)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>( <span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            params.save(<span class="function">(<span class="params">err, res</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(err) &#123;</span><br><span class="line">                    reject(err)</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                &#125;</span><br><span class="line">                resolve(res)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">updateHero</span>(<span class="params">&#123; hero, input &#125;</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; age &#125; = input</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span> (<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            HeroModel.update(&#123;<span class="attr">name</span>: hero&#125;, &#123;age&#125;, <span class="function">(<span class="params">err, res</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(err) &#123;</span><br><span class="line">                    reject(err)</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                &#125;</span><br><span class="line">                resolve(res)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-模拟测试"><a href="#5-模拟测试" class="headerlink" title="5. 模拟测试"></a>5. 模拟测试</h3><p>最后我们在 <code>GraphiQL</code> 页面上模拟测试一下，首先添加两个英雄，钢铁侠和美国队长，并设置他们的 <code>age / name</code> 属性：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mutation &#123;</span><br><span class="line">    <span class="function"><span class="title">createHero</span>(<span class="params">input: &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">        name: <span class="string">&quot;钢铁侠&quot;</span></span></span></span><br><span class="line"><span class="params"><span class="function">        age: <span class="number">40</span></span></span></span><br><span class="line"><span class="params"><span class="function">    &#125;</span>)</span>&#123;</span><br><span class="line">        name</span><br><span class="line">        age</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mutation &#123;</span><br><span class="line">    <span class="function"><span class="title">createHero</span>(<span class="params">input: &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">        name: <span class="string">&quot;美国队长&quot;</span></span></span></span><br><span class="line"><span class="params"><span class="function">        age: <span class="number">20</span></span></span></span><br><span class="line"><span class="params"><span class="function">    &#125;</span>)</span>&#123;</span><br><span class="line">        name</span><br><span class="line">        age</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>页面和接口没有报错，说明我们添加成功，数据库中也有这两条数据了：   </p>
<p><img src="http://images.pingan8787.com/graphql_10.png" alt="graphql10">     </p>
<p>在测试下查询：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">query &#123;</span><br><span class="line">    hero &#123;</span><br><span class="line">        name</span><br><span class="line">        age</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://images.pingan8787.com/graphql_11.png" alt="graphql11">   </p>
<p>查询也正常，接下来测试下更新，将美国队长的 <code>age</code> 修改为 60：      </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mutation &#123;</span><br><span class="line">    <span class="function"><span class="title">updateHero</span>(<span class="params">hero: <span class="string">&quot;美国队长&quot;</span>, input: &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">        age: <span class="number">60</span></span></span></span><br><span class="line"><span class="params"><span class="function">    &#125;</span>)</span>&#123;</span><br><span class="line">        age</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://images.pingan8787.com/graphql_12.png" alt="graphql12">   </p>
<p>到这一步，我们也算是将这个练习做完了。    </p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li><p><code>GraphQL</code> 是一种 <strong>API 的查询语言</strong>，是 REST API 的替代品。 </p>
</li>
<li><p><code>GraphQL</code> 可以使用一个请求，获取所有想要的数据。    </p>
</li>
<li><p>创建查询的方式有两种：使用 <code>buildSchema</code> 或者 <code>GraphQLObjectType</code>。   </p>
</li>
<li><p>查询操作用 <code>Query</code>，修改操作用 <code>Mutations</code>。   </p>
</li>
<li><p>查询类型用 <code>type</code> ，输入类型用 <code>input</code>。  </p>
</li>
</ul>
<p>其实 <code>GraphQL</code> 还是很简单好用的呢~~~</p>
<hr>
<blockquote>
<p>本文首发在 <a target="_blank" rel="noopener" href="http://www.pingan8787.com/">pingan8787个人博客</a>，如需转载请保留个人介绍</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/05/10/160-%E3%80%90GraphQL%E3%80%91GraphQL%E7%9C%9F%E9%A6%99%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/" data-id="ckts3ejy400m04d9kb7an3nb1" data-title="160-【GraphQL】GraphQL真香入门教程" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GraphQL/" rel="tag">GraphQL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-159-【算法】每周一练之数据结构与算法（Set）" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/05/06/159-%E3%80%90%E7%AE%97%E6%B3%95%E3%80%91%E6%AF%8F%E5%91%A8%E4%B8%80%E7%BB%83%E4%B9%8B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%EF%BC%88Set%EF%BC%89/" class="article-date">
  <time class="dt-published" datetime="2019-05-06T13:02:44.000Z" itemprop="datePublished">2019-05-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/05/06/159-%E3%80%90%E7%AE%97%E6%B3%95%E3%80%91%E6%AF%8F%E5%91%A8%E4%B8%80%E7%BB%83%E4%B9%8B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%EF%BC%88Set%EF%BC%89/">159-【算法】每周一练之数据结构与算法（Set）</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <hr>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#x70;&#105;&#x6e;&#103;&#97;&#x6e;&#x38;&#55;&#x38;&#x37;&#64;&#x71;&#113;&#x2e;&#x63;&#x6f;&#x6d;">&#x70;&#105;&#x6e;&#103;&#97;&#x6e;&#x38;&#55;&#x38;&#x37;&#64;&#x71;&#113;&#x2e;&#x63;&#x6f;&#x6d;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>微信公众号</td>
<td>前端自习课</td>
</tr>
</tbody></table>
<p><img src="http://images.pingan8787.com/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E5%B0%81%E9%9D%A2.png" alt="封面"></p>
<p>这是第四周的练习题，五一放假结束，该收拾好状态啦。    </p>
<p>下面是之前分享的链接：   </p>
<ul>
<li>1.<a target="_blank" rel="noopener" href="https://juejin.im/post/5cb2df0c5188251aca7340a0">每周一练 之 数据结构与算法（Stack）</a>   </li>
<li>2.<a target="_blank" rel="noopener" href="https://juejin.im/post/5cbdbb1af265da036d79bb35">每周一练 之 数据结构与算法（LinkedList）</a>   </li>
<li>3.<a target="_blank" rel="noopener" href="https://juejin.im/post/5cc3cbaaf265da03a85ac7f8">每周一练 之 数据结构与算法（Queue）</a>   </li>
</ul>
<blockquote>
<p>欢迎关注我的 <a target="_blank" rel="noopener" href="https://github.com/pingan8787">个人主页</a> &amp;&amp;  <a target="_blank" rel="noopener" href="http://www.pingan8787.com/">个人博客</a> &amp;&amp; <a target="_blank" rel="noopener" href="http://js.pingan8787.com/">个人知识库</a> &amp;&amp; 微信公众号“前端自习课”</p>
</blockquote>
<p><strong>本周练习内容：数据结构与算法 —— Set</strong>   </p>
<p>这些都是数据结构与算法，一部分方法是团队其他成员实现的，一部分我自己做的，有什么其他实现方法或错误，欢迎各位大佬指点，感谢。   </p>
<h2 id="一、集合是什么？与它相关数学概念有哪些"><a href="#一、集合是什么？与它相关数学概念有哪些" class="headerlink" title="一、集合是什么？与它相关数学概念有哪些"></a>一、集合是什么？与它相关数学概念有哪些</h2><hr>
<p>解题：<br><strong>1.集合定义：</strong><br><strong>集合（Set）</strong>是一种包含不同元素的数据结构。集合中的元素称为<strong>成员</strong>，集合最重要的两个特点：  </p>
<ul>
<li>集合中的成员是无序；</li>
<li>集合中不存在相同成员；</li>
</ul>
<p>即：无序且唯一。</p>
<p><strong>2.集合相关的数学概念：</strong><br>集合的概念，如数学中一个由大于或等于0的整数组成的自然数集合， <code>N = &#123; 0, 1, 2, ...&#125;</code>。<br>还有如<strong>空集</strong>，表示不包含任何元素的集合。<br>并且也有并集，交集，差集等操作。    </p>
<h2 id="二、请实现一个集合，并实现以下方法"><a href="#二、请实现一个集合，并实现以下方法" class="headerlink" title="二、请实现一个集合，并实现以下方法"></a>二、请实现一个集合，并实现以下方法</h2><p><code>add(value)</code>：向集合添加一个新的项。<br><code>delete(value)</code>：从集合移除一个值。<br><code>has(value)</code>：如果值在集合中，返回 true，否则返回 false。<br><code>clear()</code>：移除集合中的所有项。<br><code>size()</code>：返回集合所包含元素的数量。与数组的 length 属性类似。<br><code>values()</code>：返回一个包含集合中所有值的数组。   </p>
<hr>
<p>解题：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sets</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.items = &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">has</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// return value in this.items</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.items.hasOwnProperty(value)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">add</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">this</span>.has(value)) &#123;</span><br><span class="line">            <span class="built_in">this</span>.items[value] = value</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">delete</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">this</span>.has(value))&#123;</span><br><span class="line">            <span class="keyword">delete</span> <span class="built_in">this</span>.items[value]</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">clear</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.items = &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">size</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> values = <span class="built_in">this</span>.values()</span><br><span class="line">        <span class="keyword">return</span> values.length</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">values</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Object</span>.keys(<span class="built_in">this</span>.items)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三、请实现集合的并集、交集、差集、子集操作"><a href="#三、请实现集合的并集、交集、差集、子集操作" class="headerlink" title="三、请实现集合的并集、交集、差集、子集操作"></a>三、请实现集合的并集、交集、差集、子集操作</h2><ul>
<li><strong>并集（union）</strong>：对于给定的两个集合，返回一个包含两个集合中所有元素的新集合。   </li>
<li><strong>交集（intersection）</strong>：对于给定的两个集合，返回一个包含两个集合中共用元素的新集合。   </li>
<li><strong>差集（difference）</strong>：对于给定的两个集合，返回一个包含所有存在于第一个集合且不存在于第二个集合的元素的新集合。   </li>
<li><strong>子集（subset）</strong>：验证一个给定集合是否是另一个集合的子集。   </li>
</ul>
<hr>
<p>解题：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * union 并集</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> </span>otherSet 其他集合</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Sets.prototype.union = <span class="function"><span class="keyword">function</span>(<span class="params">otherSet</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="keyword">new</span> Sets(),</span><br><span class="line">        current = <span class="built_in">this</span>.values(),</span><br><span class="line">        other = otherSet.values()</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; current.length; i++)&#123;</span><br><span class="line">        result.add(current[i])</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; other.length; i++)&#123;</span><br><span class="line">        result.add(other[i])</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * intersection 交集</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> </span>otherSet 其他集合</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Sets.prototype.intersection = <span class="function"><span class="keyword">function</span>(<span class="params">otherSet</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="keyword">new</span> Sets(),</span><br><span class="line">        current = <span class="built_in">this</span>.values()</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; current.length; i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(otherSet.has(current[i]))&#123;</span><br><span class="line">            result.add(current[i])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * difference 差集</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> </span>otherSet 其他集合</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Sets.prototype.difference = <span class="function"><span class="keyword">function</span>(<span class="params">otherSet</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="keyword">new</span> Sets(),</span><br><span class="line">        current = <span class="built_in">this</span>.values()</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; current.length; i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!otherSet.has(current[i]))&#123;</span><br><span class="line">            result.add(current[i])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * subset 子集</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> </span>otherSet 其他集合</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Sets.prototype.subset = <span class="function"><span class="keyword">function</span>(<span class="params">otherSet</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="keyword">new</span> Sets(),</span><br><span class="line">        current = <span class="built_in">this</span>.values()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">this</span>.size() &gt; otherSet.size()) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; current.length; i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!otherSet.has(current[i]))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="四、给定两个数组，编写一个-intersection-函数来计算它们的交集"><a href="#四、给定两个数组，编写一个-intersection-函数来计算它们的交集" class="headerlink" title="四、给定两个数组，编写一个 intersection() 函数来计算它们的交集"></a>四、给定两个数组，编写一个 intersection() 函数来计算它们的交集</h2><p>使用示例如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nums1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>];</span><br><span class="line"><span class="keyword">const</span> nums2 = [<span class="number">2</span>, <span class="number">2</span>];</span><br><span class="line"><span class="keyword">const</span> nums3 = [<span class="number">4</span>, <span class="number">9</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">const</span> nums4 = [<span class="number">9</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">intersection(nums1, nums2); <span class="comment">// [2]</span></span><br><span class="line">intersection(nums3, nums4); <span class="comment">// [9, 4]</span></span><br></pre></td></tr></table></figure>

<p><strong>提示：输出结果中的每个元素是唯一的，可以不考虑输出结果的顺序。</strong>   </p>
<hr>
<p>解题：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">intersection</span>(<span class="params">arr1, arr2</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">Array</span>.isArray(arr1) || !<span class="built_in">Array</span>.isArray(arr2)) <span class="keyword">return</span> []</span><br><span class="line">    <span class="keyword">let</span> create = <span class="function"><span class="keyword">function</span>(<span class="params">arr</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> sets = <span class="keyword">new</span> Sets()</span><br><span class="line">        arr.map(<span class="function"><span class="params">item</span> =&gt;</span> sets.add(item))</span><br><span class="line">        <span class="keyword">return</span> sets</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> Sets1 = create(arr1)</span><br><span class="line">    <span class="keyword">let</span> Sets2 = create(arr2)</span><br><span class="line">    <span class="keyword">let</span> result = Sets1.intersection(Sets2)</span><br><span class="line">    <span class="keyword">return</span>  result.values()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="五、给定一组不含重复元素的整数数组-nums，返回该数组所有可能的子集"><a href="#五、给定一组不含重复元素的整数数组-nums，返回该数组所有可能的子集" class="headerlink" title="五、给定一组不含重复元素的整数数组 nums，返回该数组所有可能的子集"></a>五、给定一组不含重复元素的整数数组 nums，返回该数组所有可能的子集</h2><p>使用示例如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nums = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">subsets(nums);</span><br><span class="line"><span class="comment">// 输出以下结果：</span></span><br><span class="line">[</span><br><span class="line">  [<span class="number">3</span>],</span><br><span class="line">  [<span class="number">1</span>],</span><br><span class="line">  [<span class="number">2</span>],</span><br><span class="line">  [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">  [<span class="number">1</span>, <span class="number">3</span>],</span><br><span class="line">  [<span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">  [<span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">  []</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>来源：<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/subsets/">leetcode 78.集合</a>   </p>
<hr>
<p>解题：   </p>
<p><strong>目前网络上的最优解：</strong>   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">subsets</span>(<span class="params">nums</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!nums || !<span class="built_in">Array</span>.isArray(nums)) <span class="keyword">return</span> []</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">diff</span> (<span class="params">num, vec</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> tmp = vec.slice(<span class="number">0</span>)</span><br><span class="line">        result.push(tmp)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = num; i &lt; len; i++) &#123;</span><br><span class="line">            vec.push(nums[i])</span><br><span class="line">            diff(i + <span class="number">1</span>, vec)</span><br><span class="line">            vec.splice(-<span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> len = nums.length</span><br><span class="line">    <span class="keyword">let</span> arr = [], result = []</span><br><span class="line">    diff(<span class="number">0</span>, arr)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>穷举法：</strong>   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">subsets</span>(<span class="params">nums</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!nums || !<span class="built_in">Array</span>.isArray(nums)) <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> result = [[]],</span><br><span class="line">        len = nums.length</span><br><span class="line">    <span class="keyword">if</span>(len === <span class="number">0</span>) <span class="keyword">return</span> result </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; len; i++)&#123;</span><br><span class="line">        <span class="keyword">let</span> l = result.length</span><br><span class="line">        <span class="keyword">let</span> num = nums[i]</span><br><span class="line">        <span class="keyword">let</span> array = [num]</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; l; j++)&#123;</span><br><span class="line">            <span class="keyword">let</span> tmparray = result[j].concat(array)</span><br><span class="line">            result.push(tmparray)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="下周预告"><a href="#下周预告" class="headerlink" title="下周预告"></a>下周预告</h2><p>下周将练习<strong>Dictionary 和 HashTable</strong> 的题目。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/05/06/159-%E3%80%90%E7%AE%97%E6%B3%95%E3%80%91%E6%AF%8F%E5%91%A8%E4%B8%80%E7%BB%83%E4%B9%8B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%EF%BC%88Set%EF%BC%89/" data-id="ckts3ejtf003o4d9khgfsgupv" data-title="159-【算法】每周一练之数据结构与算法（Set）" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-158-【算法】每周一练之数据结构与算法（Queue）" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/04/27/158-%E3%80%90%E7%AE%97%E6%B3%95%E3%80%91%E6%AF%8F%E5%91%A8%E4%B8%80%E7%BB%83%E4%B9%8B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%EF%BC%88Queue%EF%BC%89/" class="article-date">
  <time class="dt-published" datetime="2019-04-27T03:34:46.000Z" itemprop="datePublished">2019-04-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/04/27/158-%E3%80%90%E7%AE%97%E6%B3%95%E3%80%91%E6%AF%8F%E5%91%A8%E4%B8%80%E7%BB%83%E4%B9%8B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%EF%BC%88Queue%EF%BC%89/">158-【算法】每周一练之数据结构与算法（Queue）</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <hr>
<table>
<thead>
<tr>
<th>Author</th>
<th>王平安</th>
</tr>
</thead>
<tbody><tr>
<td>E-mail</td>
<td><a href="mailto:&#112;&#x69;&#110;&#x67;&#x61;&#110;&#56;&#x37;&#56;&#x37;&#64;&#x71;&#x71;&#46;&#99;&#x6f;&#109;">&#112;&#x69;&#110;&#x67;&#x61;&#110;&#56;&#x37;&#56;&#x37;&#64;&#x71;&#x71;&#46;&#99;&#x6f;&#109;</a></td>
</tr>
<tr>
<td>博  客</td>
<td><a target="_blank" rel="noopener" href="http://www.pingan8787.com/">www.pingan8787.com</a></td>
</tr>
<tr>
<td>微  信</td>
<td>pingan8787</td>
</tr>
<tr>
<td>每日文章推荐</td>
<td><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo_Reading/issues">https://github.com/pingan8787/Leo_Reading/issues</a></td>
</tr>
<tr>
<td>微信公众号</td>
<td>前端自习课</td>
</tr>
</tbody></table>
<p><img src="http://images.pingan8787.com/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E5%B0%81%E9%9D%A2.png" alt="封面"></p>
<p>这是第二周的练习题，这里补充下咯，五一节马上就要到了，自己的计划先安排上了，开发一个有趣的玩意儿。    </p>
<p>下面是之前分享的链接：   </p>
<ul>
<li>1.<a target="_blank" rel="noopener" href="https://juejin.im/post/5cb2df0c5188251aca7340a0">每周一练 之 数据结构与算法（Stack）</a>   </li>
<li>2.<a target="_blank" rel="noopener" href="https://juejin.im/post/5cbdbb1af265da036d79bb35">每周一练 之 数据结构与算法（LinkedList）</a>   </li>
</ul>
<blockquote>
<p>欢迎关注我的 <a target="_blank" rel="noopener" href="https://github.com/pingan8787">个人主页</a> &amp;&amp;  <a target="_blank" rel="noopener" href="http://www.pingan8787.com/">个人博客</a> &amp;&amp; <a target="_blank" rel="noopener" href="http://js.pingan8787.com/">个人知识库</a> &amp;&amp; 微信公众号“前端自习课”</p>
</blockquote>
<p><strong>本周练习内容：数据结构与算法 —— Queue</strong>   </p>
<p>这些都是数据结构与算法，一部分方法是团队其他成员实现的，一部分我自己做的，有什么其他实现方法或错误，欢迎各位大佬指点，感谢。   </p>
<h2 id="一、队列有什么特点，生活中有什么例子"><a href="#一、队列有什么特点，生活中有什么例子" class="headerlink" title="一、队列有什么特点，生活中有什么例子?"></a>一、队列有什么特点，生活中有什么例子?</h2><hr>
<p>解题：<br><strong>1.概念介绍</strong>   </p>
<blockquote>
<p>队列，又称为伫列（queue），是先进先出（FIFO, First-In-First-Out）的线性表。在具体应用中通常用链表或者数组来实现。队列只允许在后端（称为rear）进行插入操作，在前端（称为front）进行删除操作。  ——《维基百科》</p>
</blockquote>
<p>队列特点：<strong>先进先出</strong>操作。<br>生活中的案例：常见的排队，在电影院也好，排队结账也是，排在第一位的人会先接受服务。     </p>
<p><strong>2.与堆栈区别</strong><br>队列的操作方式和堆栈类似，唯一的区别在于<strong>队列只允许新数据在后端进行添加。</strong></p>
<h2 id="二、请实现一个队列，并实现以下方法："><a href="#二、请实现一个队列，并实现以下方法：" class="headerlink" title="二、请实现一个队列，并实现以下方法："></a>二、请实现一个队列，并实现以下方法：</h2><ul>
<li><code>enqueue(element)</code>：向队列尾部添加一个新的项。  </li>
<li><code>dequeue()</code>：移除队列的第一项，并返回被移除的元素。  </li>
<li><code>front()</code>：返回队列中第一个元素 —— 最先被添加，也将是最先被移除的元素。队列不做任何变动 (不移除元素，只返回元素信息 —— 与 <code>Stack</code> 类的 <code>peek</code> 方法类似)。  </li>
<li><code>tail()</code>：返回队列中的最后一个元素，队列不做任何变动。  </li>
<li><code>isEmpty()</code>：如果栈没有任何元素就返回 <code>true</code>，否则返回 <code>false</code>。  </li>
<li><code>size()</code>：返回队列包含的的元素个数，与数组的 <code>length</code> 属性类似。  </li>
<li><code>print()</code>：打印队列中的元素。  </li>
</ul>
<p><strong>提示：Web 端优先使用 ES6 以上的语法实现。</strong>   </p>
<hr>
<p>解题：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 2. 实现一个队列</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Queue</span> </span>&#123;</span><br><span class="line">    <span class="title">constructor</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="built_in">this</span>.items = []</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// enqueue(element)：向队列尾部添加一个新的项。</span></span><br><span class="line">    <span class="function"><span class="title">enqueue</span>(<span class="params"> element </span>)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.items.push(element)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// dequeue()：移除队列的第一项，并返回被移除的元素。</span></span><br><span class="line">    dequeue ()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.items.shift()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// front()：返回队列中第一个元素 —— 最先被添加，也将是最先被移除的元素。队列不做任何变动 (不移除元素，只返回元素信息 —— 与 Stack 类的 peek 方法类似)。</span></span><br><span class="line">    front ()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.items[<span class="number">0</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// tail()：返回队列中的最后一个元素，队列不做任何变动。</span></span><br><span class="line">    tail ()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.items[<span class="built_in">this</span>.items.length]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// isEmpty()：如果栈没有任何元素就返回 true，否则返回 false。</span></span><br><span class="line">    isEmpty ()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.items.length === <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// size()：返回队列包含的的元素个数，与数组的 length 属性类似。</span></span><br><span class="line">    size ()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.items.length</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// print()：打印队列中的元素。</span></span><br><span class="line">    print ()&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>.items.toString())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="三、使用队列计算斐波那契数列的第-n-项。"><a href="#三、使用队列计算斐波那契数列的第-n-项。" class="headerlink" title="三、使用队列计算斐波那契数列的第 n 项。"></a>三、使用队列计算斐波那契数列的第 n 项。</h2><p>斐波那契数列（Fibonacci sequence），又称黄金分割数列、因数学家列昂纳多·斐波那契（Leonardoda Fibonacci）以兔子繁殖为例子而引入，故又称为“兔子数列”，指的是这样一个数列：    </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233，377，610...</span><br></pre></td></tr></table></figure>

<p>在数学上，斐波那契数列以如下被以递推的方法定义：<strong>F(1)=1，F(2)=1, F(n)=F(n-1)+F(n-2)（n&gt;=3，n∈N*）</strong>，即<strong>前两项固定为 1</strong>，<strong>后面的项为前两项之和</strong>，依次向后。在现代物理、准晶体结构、化学等领域，斐波纳契数列都有直接的应用。    </p>
<p>使用示例如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fibonacci(<span class="number">5</span>); --&gt; <span class="number">5</span></span><br><span class="line">fibonacci(<span class="number">9</span>); --&gt; <span class="number">34</span></span><br><span class="line">fibonacci(<span class="number">14</span>); --&gt; <span class="number">377</span></span><br></pre></td></tr></table></figure>

<hr>
<p>解题：   </p>
<p><strong>解题方法1：</strong>   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 3. 使用队列计算斐波那契数列的第 n 项。</span></span><br><span class="line"><span class="comment"> * 前两项固定为 1，后面的项为前两项之和，依次向后。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>num </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fibonacci</span> (<span class="params">num</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">isNaN</span>(num) || num &lt; <span class="number">0</span> || num === <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="comment">// // 1. 直接</span></span><br><span class="line">    <span class="comment">// let n1 = 1, n2 = 1, sum</span></span><br><span class="line">    <span class="comment">// for(let i = 3; i &lt;= num; i++)&#123;</span></span><br><span class="line">    <span class="comment">//     sum = n1 + n2</span></span><br><span class="line">    <span class="comment">//     n1 = n2</span></span><br><span class="line">    <span class="comment">//     n2 = sum</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">// // 2. 队列 考虑小于等于2</span></span><br><span class="line">    <span class="comment">// let arr = [], sum</span></span><br><span class="line">    <span class="comment">// num === 1 &amp;&amp; (arr = [1])</span></span><br><span class="line">    <span class="comment">// num &gt;= 2 &amp;&amp; (arr = [1, 1])</span></span><br><span class="line">    <span class="comment">// for(let i = 3; i &lt;= num; i ++)&#123;</span></span><br><span class="line">    <span class="comment">//     sum = arr[i-2] + arr[i-3]</span></span><br><span class="line">    <span class="comment">//     arr.push(sum)</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">// // 3.队列 进出队列</span></span><br><span class="line">    <span class="keyword">let</span> queue = [], sum;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">1</span>; i &lt;= num; i ++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(i &lt;=<span class="number">2</span> )&#123;</span><br><span class="line">            queue.push(<span class="number">1</span>)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            sum = queue[<span class="number">0</span>] + queue[<span class="number">1</span>]</span><br><span class="line">            queue.push(sum)</span><br><span class="line">            queue.shift()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解题方法2：</strong>   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fibonacci</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> queue = <span class="keyword">new</span> Queue();</span><br><span class="line">    queue.enqueue(<span class="number">1</span>);</span><br><span class="line">    queue.enqueue(<span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(index &lt; n - <span class="number">2</span>) &#123;</span><br><span class="line">        index += <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// 出队列一个元素</span></span><br><span class="line">        <span class="keyword">const</span> delItem = queue.dequeue();</span><br><span class="line">        <span class="comment">// 获取头部值</span></span><br><span class="line">        <span class="keyword">const</span> headItem = queue.front();</span><br><span class="line">        <span class="keyword">const</span> nextItem = delItem + headItem;</span><br><span class="line">        queue.enqueue(nextItem);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> queue.tail();  </span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(fibonacci(<span class="number">9</span>)); <span class="comment">// 34</span></span><br></pre></td></tr></table></figure>


<h2 id="四、实现优先队列-PriorityQueue。"><a href="#四、实现优先队列-PriorityQueue。" class="headerlink" title="四、实现优先队列 PriorityQueue。"></a>四、实现优先队列 PriorityQueue。</h2><p>现实中优先队列的例子很多，比如机场登机的顺序，头等舱和商务舱乘客优先级高于经济舱乘客。又如在银行中办理业务时，VIP 客户的优先级高于普通客户。要实现一个优先队列，有两种方式：</p>
<ol>
<li>设置优先级，然后在正确的位置添加元素。   </li>
<li>用入列操作添加元素，然后按照优先级移除它们。  </li>
</ol>
<p><strong>本题要求使用第一种方式来实现优先队列，数值越小优先级越高，若优先级相同时，先入队的元素，排在前面。</strong></p>
<p>使用示例如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> priorityQueue = <span class="keyword">new</span> PriorityQueue();</span><br><span class="line">priorityQueue.enqueue(<span class="string">&quot;leo&quot;</span>, <span class="number">2</span>);</span><br><span class="line">priorityQueue.enqueue(<span class="string">&quot;pingan&quot;</span>, <span class="number">1</span>);</span><br><span class="line">priorityQueue.enqueue(<span class="string">&quot;robin&quot;</span>, <span class="number">1</span>);</span><br><span class="line">priorityQueue.print();</span><br><span class="line"><span class="comment">// pingan - 1</span></span><br><span class="line"><span class="comment">// robin - 1</span></span><br><span class="line"><span class="comment">// leo - 2</span></span><br></pre></td></tr></table></figure>

<hr>
<p>解题：   </p>
<p><strong>解题方法1：</strong>   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PriorityQueue</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>._items = [];</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="title">enqueue</span>(<span class="params">element, priority</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> queueElement = &#123;</span><br><span class="line">            element</span><br><span class="line">            priority</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.isEmpty()) &#123;</span><br><span class="line">        <span class="built_in">this</span>._items.push(queueElement);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> added = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.size(); i++) &#123;</span><br><span class="line">          <span class="keyword">if</span> (queueElement.priority &lt; <span class="built_in">this</span>._items[i].priority) &#123;</span><br><span class="line">            <span class="built_in">this</span>.items.splice(i, <span class="number">0</span>, queueElement);</span><br><span class="line">            added = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">break</span> ;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">if</span> (!added) &#123;</span><br><span class="line">          <span class="built_in">this</span>._items.push(queueElement);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">print</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> strArr = [];</span><br><span class="line">      strArr = <span class="built_in">this</span>._items.map(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;item.element&#125;</span>-&gt;<span class="subst">$&#123;item.priority&#125;</span>`</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">    </span><br><span class="line">      <span class="built_in">console</span>.log(strArr.toString()); </span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解题方法2：</strong>   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 4. 实现优先队列</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PriorityQueue</span> </span>&#123;</span><br><span class="line">    <span class="title">constructor</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="built_in">this</span>.items = []</span><br><span class="line">    &#125;</span><br><span class="line">    enqueue (element, priority)&#123;</span><br><span class="line">        <span class="keyword">let</span> ele = &#123;element, priority&#125;</span><br><span class="line">        <span class="keyword">let</span> isAdded = <span class="literal">false</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.items.length; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(ele.priority &lt; <span class="built_in">this</span>.items[i].priority)&#123;</span><br><span class="line">                <span class="built_in">this</span>.items.splice(i, <span class="number">0</span>, ele)</span><br><span class="line">                isAdded = <span class="literal">true</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        !isAdded &amp;&amp; <span class="built_in">this</span>.items.push(ele)</span><br><span class="line">    &#125;</span><br><span class="line">    print ()&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.items.length; i++)&#123;</span><br><span class="line">            <span class="keyword">let</span> &#123;element, priority&#125; = <span class="built_in">this</span>.items[i]</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;element&#125;</span> - <span class="subst">$&#123;priority&#125;</span>`</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> leo = <span class="keyword">new</span> PriorityQueue()</span><br><span class="line">leo.enqueue(<span class="string">&quot;leo&quot;</span>, <span class="number">2</span>);</span><br><span class="line">leo.enqueue(<span class="string">&quot;leo1&quot;</span>, <span class="number">1</span>);</span><br><span class="line">leo.enqueue(<span class="string">&quot;leo2&quot;</span>, <span class="number">1</span>);</span><br><span class="line"><span class="built_in">console</span>.log(leo)</span><br></pre></td></tr></table></figure>

<h2 id="五、用队列实现栈。"><a href="#五、用队列实现栈。" class="headerlink" title="五、用队列实现栈。"></a>五、用队列实现栈。</h2><p>利用两个队列实现栈，栈的特点是后进先出，可以让元素入队 <code>q1</code>，留下队尾元素让其他元素出队，暂存到 <code>q2</code> 中，再让 <code>q1</code> 中剩下的元素出队，即最后进的最先出来。    </p>
<p><strong>提示：入栈和出栈都在 q1 中完成，q2 只作为临时中转空间。</strong></p>
<hr>
<p>解题：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 5. 队列实现栈</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Myqueue</span> </span>&#123;</span><br><span class="line">    <span class="title">constructor</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="built_in">this</span>.items = []</span><br><span class="line">    &#125;</span><br><span class="line">    enqueue (element)&#123;</span><br><span class="line">        <span class="built_in">this</span>.items.push(element)</span><br><span class="line">    &#125;</span><br><span class="line">    dequeue ()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.items.shift()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mystack</span> </span>&#123;</span><br><span class="line">    <span class="title">constructor</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="built_in">this</span>.q1 = <span class="keyword">new</span> myQueue()</span><br><span class="line">        <span class="built_in">this</span>.q2 = <span class="keyword">new</span> myQueue()</span><br><span class="line">    &#125;</span><br><span class="line">    push (element)&#123;</span><br><span class="line">        <span class="built_in">this</span>.q1.enqueue(element)</span><br><span class="line">        <span class="built_in">this</span>.q2.items = []</span><br><span class="line">        <span class="keyword">let</span> len = <span class="built_in">this</span>.q1.items.length</span><br><span class="line">        <span class="keyword">while</span>(len &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="built_in">this</span>.q2.enqueue(<span class="built_in">this</span>.q1.items[len-<span class="number">1</span>])</span><br><span class="line">            len --</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    pop ()&#123;</span><br><span class="line">        <span class="keyword">let</span> result = <span class="built_in">this</span>.q2.dequeue()</span><br><span class="line">        <span class="keyword">let</span> len = <span class="built_in">this</span>.q2.items.length</span><br><span class="line">        <span class="built_in">this</span>.q1.items = []</span><br><span class="line">        <span class="keyword">while</span>(len &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="built_in">this</span>.q1.enqueue(<span class="built_in">this</span>.q2.items[len-<span class="number">1</span>])</span><br><span class="line">            len --</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line">    print ()&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>.q1.items.toString())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>这里也可以直接使用第二题定义的Queue来实现：</strong>   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QueueStack</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.queue = <span class="keyword">new</span> Queue();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">push</span>(<span class="params">item</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.queue.enqueue(item);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">pop</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 向队列末尾追加 队列长度-1 次，后弹出队列头部</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; <span class="built_in">this</span>.queue.size(); i += <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="built_in">this</span>.queue.enqueue(<span class="built_in">this</span>.queue.dequeue());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.queue.dequeue();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">peek</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.queue.tail();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="下周预告"><a href="#下周预告" class="headerlink" title="下周预告"></a>下周预告</h2><p>下周将练习<strong>集合（Set）</strong> 的题目，五一要到咯，也要好好做自己一个项目了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/04/27/158-%E3%80%90%E7%AE%97%E6%B3%95%E3%80%91%E6%AF%8F%E5%91%A8%E4%B8%80%E7%BB%83%E4%B9%8B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%EF%BC%88Queue%EF%BC%89/" data-id="ckts3ejte003l4d9k7a8khb4q" data-title="158-【算法】每周一练之数据结构与算法（Queue）" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/6/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><a class="extend next" rel="next" href="/page/8/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Angular/" rel="tag">Angular</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/" rel="tag">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS%E5%8A%A8%E7%94%BB/" rel="tag">CSS动画</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Chrome/" rel="tag">Chrome</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES6-ES7-ES8/" rel="tag">ES6/ES7/ES8</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Eslint/" rel="tag">Eslint</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Express/" rel="tag">Express</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GraphQL/" rel="tag">GraphQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/H5/" rel="tag">H5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML/" rel="tag">HTML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/" rel="tag">HTTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP%E5%8D%8F%E8%AE%AE/" rel="tag">HTTP协议</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hybrid/" rel="tag">Hybrid</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NPM/" rel="tag">NPM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nodejs/" rel="tag">Nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Numpy/" rel="tag">Numpy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/" rel="tag">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tensorflow/" rel="tag">Tensorflow</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TyeScript/" rel="tag">TyeScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TypeScript/" rel="tag">TypeScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vuejs/" rel="tag">Vuejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebSocket/" rel="tag">WebSocket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Webpack/" rel="tag">Webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/demo/" rel="tag">demo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" rel="tag">中间件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" rel="tag">人工智能</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/" rel="tag">全栈开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">前端开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E6%8E%A2%E7%B4%A2/" rel="tag">前端探索</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E7%9F%A5%E4%B9%8E%E7%B3%BB%E5%88%97/" rel="tag">前端知乎系列</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B8%B8%E7%94%A8%E6%8A%80%E6%9C%AF/" rel="tag">常用技术</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BE%AE%E5%89%8D%E7%AB%AF/" rel="tag">微前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%BB%E7%BB%93/" rel="tag">总结</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/" rel="tag">构建工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" rel="tag">正则表达式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BA%90%E7%A0%81/" rel="tag">源码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BA%90%E7%A0%81%E7%B2%BE%E8%AF%BB/" rel="tag">源码精读</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%83%AD%E9%97%A8/" rel="tag">热门</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%94%9F%E6%B4%BB%E6%9D%82%E8%AE%B0/" rel="tag">生活杂记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/" rel="tag">编译原理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/" rel="tag">网络请求</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag">读书笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%87%8D%E6%B8%A9%E5%9F%BA%E7%A1%80/" rel="tag">重温基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" rel="tag">面试题</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Angular/" style="font-size: 11.88px;">Angular</a> <a href="/tags/CSS/" style="font-size: 18.13px;">CSS</a> <a href="/tags/CSS%E5%8A%A8%E7%94%BB/" style="font-size: 12.5px;">CSS动画</a> <a href="/tags/Chrome/" style="font-size: 10px;">Chrome</a> <a href="/tags/ES6-ES7-ES8/" style="font-size: 10.63px;">ES6/ES7/ES8</a> <a href="/tags/Eslint/" style="font-size: 10px;">Eslint</a> <a href="/tags/Express/" style="font-size: 10px;">Express</a> <a href="/tags/GraphQL/" style="font-size: 10px;">GraphQL</a> <a href="/tags/H5/" style="font-size: 10px;">H5</a> <a href="/tags/HTML/" style="font-size: 10px;">HTML</a> <a href="/tags/HTTP/" style="font-size: 11.88px;">HTTP</a> <a href="/tags/HTTP%E5%8D%8F%E8%AE%AE/" style="font-size: 11.25px;">HTTP协议</a> <a href="/tags/Hybrid/" style="font-size: 10.63px;">Hybrid</a> <a href="/tags/JavaScript/" style="font-size: 19.38px;">JavaScript</a> <a href="/tags/NPM/" style="font-size: 10px;">NPM</a> <a href="/tags/Nodejs/" style="font-size: 11.25px;">Nodejs</a> <a href="/tags/Numpy/" style="font-size: 10.63px;">Numpy</a> <a href="/tags/Python/" style="font-size: 17.5px;">Python</a> <a href="/tags/React/" style="font-size: 12.5px;">React</a> <a href="/tags/Tensorflow/" style="font-size: 10.63px;">Tensorflow</a> <a href="/tags/TyeScript/" style="font-size: 10px;">TyeScript</a> <a href="/tags/TypeScript/" style="font-size: 11.25px;">TypeScript</a> <a href="/tags/Vuejs/" style="font-size: 14.38px;">Vuejs</a> <a href="/tags/WebSocket/" style="font-size: 10px;">WebSocket</a> <a href="/tags/Webpack/" style="font-size: 15.63px;">Webpack</a> <a href="/tags/demo/" style="font-size: 10.63px;">demo</a> <a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 10px;">中间件</a> <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" style="font-size: 16.25px;">人工智能</a> <a href="/tags/%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/" style="font-size: 11.25px;">全栈开发</a> <a href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" style="font-size: 20px;">前端开发</a> <a href="/tags/%E5%89%8D%E7%AB%AF%E6%8E%A2%E7%B4%A2/" style="font-size: 11.25px;">前端探索</a> <a href="/tags/%E5%89%8D%E7%AB%AF%E7%9F%A5%E4%B9%8E%E7%B3%BB%E5%88%97/" style="font-size: 10.63px;">前端知乎系列</a> <a href="/tags/%E5%8E%9F%E5%88%9B/" style="font-size: 18.75px;">原创</a> <a href="/tags/%E5%B8%B8%E7%94%A8%E6%8A%80%E6%9C%AF/" style="font-size: 10.63px;">常用技术</a> <a href="/tags/%E5%BE%AE%E5%89%8D%E7%AB%AF/" style="font-size: 10px;">微前端</a> <a href="/tags/%E6%80%BB%E7%BB%93/" style="font-size: 13.75px;">总结</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 10px;">数据结构</a> <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" style="font-size: 15px;">机器学习</a> <a href="/tags/%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/" style="font-size: 10.63px;">构建工具</a> <a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 10.63px;">正则表达式</a> <a href="/tags/%E6%BA%90%E7%A0%81/" style="font-size: 10px;">源码</a> <a href="/tags/%E6%BA%90%E7%A0%81%E7%B2%BE%E8%AF%BB/" style="font-size: 10px;">源码精读</a> <a href="/tags/%E7%83%AD%E9%97%A8/" style="font-size: 10px;">热门</a> <a href="/tags/%E7%94%9F%E6%B4%BB%E6%9D%82%E8%AE%B0/" style="font-size: 10px;">生活杂记</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 13.13px;">算法</a> <a href="/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/" style="font-size: 10px;">编译原理</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/" style="font-size: 10px;">网络请求</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 15px;">设计模式</a> <a href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" style="font-size: 14.38px;">读书笔记</a> <a href="/tags/%E9%87%8D%E6%B8%A9%E5%9F%BA%E7%A1%80/" style="font-size: 16.88px;">重温基础</a> <a href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" style="font-size: 10px;">面试题</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/07/28/227-%E3%80%90%E6%80%BB%E7%BB%93%E3%80%91%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E5%9C%A8%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%BD%BF%E7%94%A8SVG%E5%AD%97%E4%BD%93%E5%9B%BE%E6%A0%87/">227-【总结】如何优雅的在微信小程序使用SVG字体图标</a>
          </li>
        
          <li>
            <a href="/2021/07/28/226-%E3%80%90HTTP%E3%80%91%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E7%AE%A1%E7%90%86HTTP%E8%AF%B7%E6%B1%82%E5%92%8C%E5%93%8D%E5%BA%94%E6%8B%A6%E6%88%AA%E5%99%A8%EF%BC%9F/">226-【HTTP】如何优雅的管理HTTP请求和响应拦截器？</a>
          </li>
        
          <li>
            <a href="/2021/07/28/225-%E3%80%90Vue%E3%80%91%E4%BB%8E%E6%89%8B%E5%86%99Vue3%E7%9A%84Reactivity%E5%BC%80%E5%A7%8B%E6%B7%B1%E5%85%A5Vue3%E6%BA%90%E7%A0%81/">225-【Vue】从手写Vue3的Reactivity开始深入Vue3源码</a>
          </li>
        
          <li>
            <a href="/2021/05/30/224-%E3%80%90Chrome%E3%80%915%E4%B8%AAChrome%E8%B0%83%E8%AF%95%E6%B7%B7%E5%90%88%E5%BA%94%E7%94%A8%E7%9A%84%E6%8A%80%E5%B7%A7/">224-【Chrome】5个Chrome调试混合应用的技巧</a>
          </li>
        
          <li>
            <a href="/2021/03/19/223-%E3%80%90%E5%89%8D%E7%AB%AF%E6%8E%A2%E7%B4%A2%E3%80%91%E6%8E%A2%E7%B4%A2Snabbdom%E6%A8%A1%E5%9D%97%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/">223-【前端探索】探索Snabbdom模块系统原理</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>