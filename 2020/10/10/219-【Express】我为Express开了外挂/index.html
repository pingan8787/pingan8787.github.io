<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author"><meta name="description" content="ç‹å¹³å®‰ä¸ªäººåšå®¢,pingan8787,å‰ç«¯å¼€å‘,äººå·¥æ™ºèƒ½,AI,æ·±åº¦å­¦ä¹ ,å‰ç«¯æ¡†æ¶vue,angular,react,nodejs,python,numpy,pandas,anaconda,Tensorflow,é«˜ç­‰æ•°å­¦,æ¦‚ç‡è®º,ç»Ÿè®¡å­¦ç¥ç»ç½‘ç»œ,"><title>219-ã€Expressã€‘æˆ‘ä¸ºExpresså¼€äº†å¤–æŒ‚ Â· pingan8787</title><meta name="description" content="æœ¬é¡¹ç›®æºç åœ°å€ï¼šhttps://github.com/pingan8787/Leo-JavaScript/blob/master/Cute-Gist/LearnSource/OvernightDemo/

éšç€ Nodejs åœ¨å‰ç«¯æ¶‰åŠé¢†åŸŸè¶Šæ¥è¶Šå¹¿ï¼Œä¹Ÿè¶Šæ¥è¶Šæˆç†Ÿï¼Œç›¸ä¿¡å¾ˆå¤šæœ‹å‹å·²ç»å°è¯•æˆ–ä½¿ç”¨è¿‡ Nod"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script type="text/javascript" src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js"></script><script type="text/javascript" src="https://hm.baidu.com/hm.js?de7c89214c05d551ef3ec12341cd0b9e"></script><meta name="generator" content="Hexo 5.4.0"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;border-radius:15px;"><h3 title=""><a href="/">pingan8787</a></h3></div></div><ul class="my_tages_ul clearfix"><li class="my_tages_li next pagbuttons"><a class="btn" target="_blank" rel="noopener" href="http://www.pingan8787.com/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/"> å‰ç«¯å¼€å‘</a></li><li class="my_tages_li next pagbuttons"><a class="btn btn" target="_blank" rel="noopener" href="http://www.pingan8787.com/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/"> äººå·¥æ™ºèƒ½</a></li><li class="my_tages_li next pagbuttons"><a class="btn btn" target="_blank" rel="noopener" href="http://www.pingan8787.com/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/"> æ·±åº¦å­¦ä¹ </a></li></ul><ul class="my_icon"><li class="my_icon_li"><a target="_blank" rel="noopener" href="https://github.com/pingan8787" title="github"><img src="http://images.pingan8787.com/assets/icon_26_github.png" alt="github"></a></li><li class="my_icon_li"><a target="_blank" rel="noopener" href="https://www.yuque.com/wangpingan/cute-frontend" title="è¯­é›€"><img src="http://images.pingan8787.com/assets/icon_26_yuque.png" alt="è¯­é›€"></a></li><li class="my_icon_li"><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/cute-javascript" title="çŸ¥ä¹"><img src="http://images.pingan8787.com/icon_zhihu.png" alt="çŸ¥ä¹"></a></li><li class="my_icon_li"><a target="_blank" rel="noopener" href="https://juejin.im/user/586fc337a22b9d0058807d53/posts" title="æ˜é‡‘"><img src="http://images.pingan8787.com/icon_juejin.png" alt="æ˜é‡‘"></a></li><li class="my_icon_li"><a target="_blank" rel="noopener" href="https://segmentfault.com/blog/pingan8787" title="æ€å¦"><img src="http://images.pingan8787.com/icon_sf.png" alt="æ€å¦"></a></li><li class="my_icon_li"><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_36380426" title="CSDN"><img src="http://images.pingan8787.com/icon_csdn.png" alt="CSDN"></a></li><li class="my_icon_li"><a target="_blank" rel="noopener" href="https://www.jianshu.com/u/2ec5d94afd60" title="ç®€ä¹¦"><img src="http://images.pingan8787.com/icon_jianshu.png" alt="ç®€ä¹¦"></a></li></ul><div style="text-align:center;"><wb:follow-button uid="1689651205" type="red_1" style="margin-top:10px;width:67px;height:24px;display: inline-block;"></wb:follow-button></div><ul class="social-links"></ul><div class="footer"><a target="_blank" href="/"><span>åšå®¢ä½œè€…ï¼š</span></a><a href="https://github.com/pingan8787" target="_blank"> pingan8787ï¼ˆleoï¼‰</a><div class="by_farbox"> <a href="https://beian.miit.gov.cn/" target="_blank">å¤‡æ¡ˆç¼–å·ï¼šé—½ICPå¤‡17012095å·-1</a></div></div></div><s></s><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">é¦–é¡µ</a></li><li><a href="/leo">å…³äºLeo</a></li><li><a href="/production">ä½œå“</a></li><li><a href="/Catalog">ç›®å½•</a></li><li><a href="http://js.pingan8787.com" target="_blank">Cute-JavaScript</a></li><li><a href="https://github.com/pingan8787" target="_blank">Github</a></li></div><!--.information//.back_btn
  //li
    //if is_post()
      //a.fa.fa-chevron-left(onclick="window.history.go(-1)") 
    //else
      //a.fa.fa-chevron-left(onclick="window.history.go(-1)",style="display:none;") 
//.avatar
//  img(src= url_for('images/logo@2x.png'))--></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>219-ã€Expressã€‘æˆ‘ä¸ºExpresså¼€äº†å¤–æŒ‚</a></h3></div><div class="post-content"><blockquote>
<p>æœ¬é¡¹ç›®æºç åœ°å€ï¼š<br><a target="_blank" rel="noopener" href="https://github.com/pingan8787/Leo-JavaScript/blob/master/Cute-Gist/LearnSource/OvernightDemo/">https://github.com/pingan8787/Leo-JavaScript/blob/master/Cute-Gist/LearnSource/OvernightDemo/</a></p>
</blockquote>
<p>éšç€ Nodejs åœ¨å‰ç«¯æ¶‰åŠé¢†åŸŸè¶Šæ¥è¶Šå¹¿ï¼Œä¹Ÿè¶Šæ¥è¶Šæˆç†Ÿï¼Œç›¸ä¿¡å¾ˆå¤šæœ‹å‹å·²ç»å°è¯•æˆ–ä½¿ç”¨è¿‡ Nodejs å¼€å‘æœåŠ¡ç«¯é¡¹ç›®äº†ã€‚<br>æœ¬æ–‡æˆ‘å°†å’Œå¤§å®¶ä¸€èµ·å›é¡¾ Expressï¼Œç„¶åä»‹ç»ä¸€ä¸ªè¶…çº§å¤–æŒ‚â€”â€”<strong>OvernightJS</strong>ï¼Œå®ƒå¼ºå¤§çš„åœ°æ–¹åœ¨äºï¼Œå®ƒå°†ä¸º Express è·¯ç”±æä¾› TypeScript è£…é¥°å™¨æ”¯æŒï¼Œä½¿å¾—æˆ‘ä»¬å¼€å‘è·¯ç”±æ›´åŠ ç®€å•ï¼Œä»£ç å¤ç”¨æ€§æ›´å¥½ã€‚<br>è¿™é‡Œä¹Ÿå¸Œæœ›å¸®åŠ©å¤§å®¶å¯¹ TypeScript çš„è£…é¥°å™¨æœ‰æ›´æ·±äº†è§£ã€‚</p>
<p>æ¥ä¸‹æ¥è·Ÿæœ¬æ–‡ä¸»è§’ Leo ä¸€èµ·æ¥çœ‹çœ‹è¿™ä¸ªå¤–æŒ‚å§~</p>
<h1 id="ä¸€ã€èƒŒæ™¯ä»‹ç»"><a href="#ä¸€ã€èƒŒæ™¯ä»‹ç»" class="headerlink" title="ä¸€ã€èƒŒæ™¯ä»‹ç»"></a>ä¸€ã€èƒŒæ™¯ä»‹ç»</h1><p>æœ€è¿‘ Leo æ‰“ç®—ä½¿ç”¨ <a target="_blank" rel="noopener" href="http://expressjs.com/">Express</a> æ¥å¼€å§‹é‡æ„è‡ªå·±åšå®¢çš„æœåŠ¡ç«¯é¡¹ç›®ï¼Œç»è¿‡è®¤çœŸç ”ç©¶å’Œè®¾è®¡ï¼Œå¹¶ç¡®å®šå®Œæ–¹æ¡ˆï¼ŒLeo å¼€å§‹ä¸‹æ‰‹å•¦ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> express, &#123; Application, Request, Response &#125; <span class="keyword">from</span> <span class="string">&#x27;express&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app: Application = express();</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req: Request, res: Response</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&#x27;Hello World!&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function">()=&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Example app listening on port 3000!&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ tsconfig.json é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;target&quot;</span>: <span class="string">&quot;es6&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;module&quot;</span>: <span class="string">&quot;commonjs&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;strict&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">		<span class="attr">&quot;esModuleInterop&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;experimentalDecorators&quot;</span>: <span class="literal">true</span>, <span class="comment">// å¼€å¯è£…é¥°å™¨</span></span><br><span class="line">    <span class="attr">&quot;emitDecoratorMetadata&quot;</span>: <span class="literal">true</span>,  <span class="comment">// å¼€å¯å…ƒç¼–ç¨‹</span></span><br><span class="line">    <span class="attr">&quot;skipLibCheck&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;forceConsistentCasingInFileNames&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŸºæœ¬ä»£ç å†™å®Œï¼Œæµ‹è¯•èƒ½ä¸èƒ½è·‘èµ·æ¥ã€‚<br>Leo åœ¨å‘½ä»¤è¡Œä½¿ç”¨ <code>ts-node</code>Â å‘½ä»¤è¡Œæ‰§è¡Œã€‚ï¼ˆ<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/ts-node">ts-node</a> ç”¨æ¥ç›´æ¥è¿è¡Œ ts æ–‡ä»¶ï¼Œè¯¦ç»†ä»‹ç»è¯·æŸ¥çœ‹æ–‡æ¡£ï¼Œè¿™é‡Œä¸ç»†è®²å’¯ï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ts-node app.ts</span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ°å‘½ä»¤è¡Œè¾“å‡ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Example app listening on port 3000!</span><br></pre></td></tr></table></figure>
<p>æœåŠ¡è·‘èµ·æ¥äº†ï¼Œå¿ƒæƒ…æ„‰å¿«ã€‚<br>æ¥ä¸‹æ¥ Leo ä½¿ç”¨ Express çš„è·¯ç”±æ–¹æ³•å†™äº†å…¶ä»–æ¥å£ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.ts</span></span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/article&#x27;</span>, <span class="function">(<span class="params">req: Request, res: Response</span>) =&gt;</span> &#123;res.send(<span class="string">&#x27;Hello get!&#x27;</span>)&#125;);</span><br><span class="line">app.post(<span class="string">&#x27;/article&#x27;</span>, <span class="function">(<span class="params">req: Request, res: Response</span>) =&gt;</span> &#123;res.send(<span class="string">&#x27;Hello post!&#x27;</span>)&#125;);</span><br><span class="line">app.put(<span class="string">&#x27;/article&#x27;</span>, <span class="function">(<span class="params">req: Request, res: Response</span>) =&gt;</span> &#123;res.send(<span class="string">&#x27;Hello put!&#x27;</span>)&#125;);</span><br><span class="line">app.delete(<span class="string">&#x27;/article&#x27;</span>, <span class="function">(<span class="params">req: Request, res: Response</span>) =&gt;</span> &#123;res.send(<span class="string">&#x27;Hello delete!&#x27;</span>)&#125;);</span><br><span class="line">app.get(<span class="string">&#x27;/article/list&#x27;</span>, <span class="function">(<span class="params">req: Request, res: Response</span>) =&gt;</span> &#123;res.send(<span class="string">&#x27;Hello article/list!&#x27;</span>)&#125;);</span><br><span class="line"><span class="comment">// ... ç­‰ç­‰å…¶ä»–æ¥å£</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Express è·¯ç”±æ–¹æ³•æ´¾ç”Ÿè‡ª HTTP æ–¹æ³•ä¹‹ä¸€ï¼Œé™„åŠ åˆ° express ç±»çš„å®ä¾‹ã€‚ æ”¯æŒå¯¹åº”äº HTTP æ–¹æ³•çš„ä»¥ä¸‹è·¯ç”±æ–¹æ³•ï¼šgetã€postã€putã€headã€deleteã€optionsç­‰ç­‰ã€‚</p>
</blockquote>
<p>åŒäº‹ Robin çœ‹äº†çœ‹ä»£ç ï¼Œé—®åˆ°ï¼š<br><img src="http://images.pingan8787.com/JavaScript-Base/Learn-Overnight-Source/Overnight-Learn-1.png" alt="Overnight-Learn-1.png"></p>
<p>éšç€æ¥å£è¶Šå†™è¶Šå¤šï¼Œä»£ç ä¸å…å‡ºç°å¤æ‚å’Œå†—ä½™çš„æƒ…å†µï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒLeo å¼•å…¥ Express çš„ <code>Router()</code>Â ï¼Œæ¥åˆ›å»º<strong>å¯å®‰è£…çš„æ¨¡å—åŒ–è·¯ç”±å¤„ç†ç¨‹åº</strong>ã€‚Router å®ä¾‹æ˜¯<strong>å®Œæ•´çš„ä¸­é—´ä»¶</strong>å’Œ<strong>è·¯ç”±ç³»ç»Ÿ</strong>ã€‚å› æ­¤ï¼Œå¸¸å¸¸å°†å…¶ç§°ä¸ºâ€œ<strong>å¾®å‹åº”ç”¨ç¨‹åº</strong>â€ã€‚</p>
<p>Leo æ–°å»ºæ–‡ä»¶ <code>app.router.ts</code>Â ï¼Œé‡æ–°å®ç°ä¸Šé¢æ¥å£ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.router.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> express, &#123; Router, Request, Response &#125; <span class="keyword">from</span> <span class="string">&#x27;express&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> router: Router = express.Router();</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req: Request, res: Response</span>) =&gt;</span> &#123;res.send(<span class="string">&#x27;Hello get!&#x27;</span>)&#125;);</span><br><span class="line">router.post(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req: Request, res: Response</span>) =&gt;</span> &#123;res.send(<span class="string">&#x27;Hello post!&#x27;</span>)&#125;);</span><br><span class="line">router.put(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req: Request, res: Response</span>) =&gt;</span> &#123;res.send(<span class="string">&#x27;Hello put!&#x27;</span>)&#125;);</span><br><span class="line">router.delete(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req: Request, res: Response</span>) =&gt;</span> &#123;res.send(<span class="string">&#x27;Hello delete!&#x27;</span>)&#125;);</span><br><span class="line">router.get(<span class="string">&#x27;/user&#x27;</span>, <span class="function">(<span class="params">req: Request, res: Response</span>) =&gt;</span> &#123;res.send(<span class="string">&#x27;Hello api/user!&#x27;</span>)&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br></pre></td></tr></table></figure>
<p>æ¥ç€åœ¨ app.ts ä¸­ä½¿ç”¨ï¼Œç”±äº<a target="_blank" rel="noopener" href="http://expressjs.com/zh-cn/4x/api.html#router"><code>express.Router()</code> </a>æ˜¯ä¸ªä¸­é—´ä»¶ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ <code>app.use()</code>Â æ¥ä½¿ç”¨ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.ts</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ é™¤åŸæ¥è·¯ç”±å£°æ˜</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&quot;../controller/app.router&quot;</span>;</span><br><span class="line">app.use(<span class="string">&#x27;/api&#x27;</span>, router);</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œ <code>app.use</code>Â ç¬¬ä¸€ä¸ªå‚æ•° <code>/api</code>Â è¡¨ç¤ºè¿™ä¸€ç»„è·¯ç”±å¯¹è±¡çš„æ ¹è·¯å¾„ï¼Œç¬¬äºŒä¸ªå‚æ•° <code>router</code>Â è¡¨ç¤ºä¸€ç»„è·¯ç”±å¯¹è±¡ã€‚ </p>
<p>äºæ˜¯å°±å®ç°äº†ä¸‹é¢ API æ¥å£ï¼š</p>
<ul>
<li><code>/api</code></li>
<li><code>/api/user</code></li>
</ul>
<p>ç¡®å®šæ‰€æœ‰æ¥å£æ­£å¸¸è¿è¡Œåï¼ŒLeo ç¢ç£¨ç€ï¼Œæ—¢ç„¶ Express æ¯ä¸ªè·¯ç”±éƒ½æ˜¯ç”±<strong>è·¯ç”±åç§°</strong>å’Œ<strong>è·¯ç”±å¤„ç†æ–¹æ³•</strong>ç»„æˆï¼Œé‚£ä¸ºä»€ä¹ˆä¸èƒ½ç»™ Express åŠ ä¸ªå¤–æŒ‚ï¼Ÿä¸ºæ¯ä¸ªè·¯ç”±æ·»åŠ è£…é¥°å™¨æ¥è£…é¥°ã€‚<br>å¹¸è¿çš„æ˜¯ï¼Œå·²ç»æœ‰å¤§ä½¬å®ç°è¿™ä¸ªå¤–æŒ‚äº†ï¼Œå®ƒå°±æ˜¯ä»Šå¤©ä¸»è§’â€”â€”<a target="_blank" rel="noopener" href="https://github.com/seanpmaxwell/overnight">OvernightJS</a>ã€‚<br>ä¸‹é¢ä¸€èµ·çœ‹çœ‹è¿™ä¸ªå¾ˆæ£’çš„ OvernightJS å§ã€‚</p>
<h1 id="äºŒã€åŸºç¡€çŸ¥è¯†ä»‹ç»"><a href="#äºŒã€åŸºç¡€çŸ¥è¯†ä»‹ç»" class="headerlink" title="äºŒã€åŸºç¡€çŸ¥è¯†ä»‹ç»"></a>äºŒã€åŸºç¡€çŸ¥è¯†ä»‹ç»</h1><p><img src="http://images.pingan8787.com/JavaScript-Base/Learn-Overnight-Source/Overnight-Learn-2.png" alt="Overnight-Learn-2.png"><br>åœ¨å¼€å§‹ä»‹ç» Overnight ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå›é¡¾ä¸‹â€œè£…é¥°å™¨â€å’Œâ€œReflectâ€ï¼š</p>
<h2 id="1-è£…é¥°å™¨"><a href="#1-è£…é¥°å™¨" class="headerlink" title="1. è£…é¥°å™¨"></a>1. è£…é¥°å™¨</h2><h3 id="1-1-ä»€ä¹ˆæ˜¯è£…é¥°å™¨ï¼Ÿ"><a href="#1-1-ä»€ä¹ˆæ˜¯è£…é¥°å™¨ï¼Ÿ" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯è£…é¥°å™¨ï¼Ÿ"></a>1.1 ä»€ä¹ˆæ˜¯è£…é¥°å™¨ï¼Ÿ</h3><p>TypeScript ä¸­ï¼Œè£…é¥°å™¨ï¼ˆDecoratorsï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„å£°æ˜ï¼Œå®ƒèƒ½å¤Ÿè¢«é™„åŠ åˆ°ç±»å£°æ˜ã€æ–¹æ³•ã€è®¿é—®ç¬¦ã€å±æ€§æˆ–å‚æ•°ä¸Šï¼Œ<strong>æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸ªå‡½æ•°</strong>ã€‚<br>è£…é¥°å™¨ä¸ºæˆ‘ä»¬åœ¨ç±»çš„å£°æ˜åŠæˆå‘˜ä¸Šé€šè¿‡<strong>å…ƒç¼–ç¨‹è¯­æ³•</strong>æ·»åŠ æ ‡æ³¨æä¾›äº†ä¸€ç§æ–¹å¼ã€‚</p>
<p>éœ€è¦è®°ä½è¿™å‡ ç‚¹ï¼š</p>
<ul>
<li>è£…é¥°å™¨æ˜¯ä¸€ä¸ªå£°æ˜ï¼ˆè¡¨è¾¾å¼ï¼‰ï¼›</li>
<li>è¯¥è¡¨è¾¾å¼è¢«æ‰§è¡Œåï¼Œ<strong>è¿”å›ä¸€ä¸ªå‡½æ•°</strong>ï¼›</li>
<li>å‡½æ•°çš„å…¥å‚åˆ†åˆ«ä¸º <code>target</code>ã€<code>name</code> å’Œ <code>descriptor</code>ï¼›</li>
<li>æ‰§è¡Œè¯¥å‡½æ•°åï¼Œå¯èƒ½è¿”å› <code>descriptor</code> å¯¹è±¡ï¼Œç”¨äºé…ç½® <code>target</code> å¯¹è±¡ï¼›</li>
</ul>
<p>æ›´å¤šè£…é¥°å™¨è¯¦ç»†ä»‹ç»ï¼Œè¯·é˜…è¯»æ–‡æ¡£<a target="_blank" rel="noopener" href="https://www.tslang.cn/docs/handbook/decorators.html">ã€ŠTypeScript è£…é¥°å™¨ã€‹</a>ã€‚</p>
<h3 id="1-2-è£…é¥°å™¨åˆ†ç±»"><a href="#1-2-è£…é¥°å™¨åˆ†ç±»" class="headerlink" title="1.2 è£…é¥°å™¨åˆ†ç±»"></a>1.2 è£…é¥°å™¨åˆ†ç±»</h3><p>è£…é¥°å™¨ä¸€èˆ¬åŒ…æ‹¬ï¼š</p>
<ul>
<li>ç±»è£…é¥°å™¨ï¼ˆClass decoratorsï¼‰ï¼›</li>
<li>å±æ€§è£…é¥°å™¨ï¼ˆProperty decoratorsï¼‰ï¼›</li>
<li>æ–¹æ³•è£…é¥°å™¨ï¼ˆMethod decoratorsï¼‰ï¼›</li>
<li>å‚æ•°è£…é¥°å™¨ï¼ˆParameter decoratorsï¼‰ï¼›</li>
</ul>
<h3 id="1-3-ç¤ºä¾‹ä»£ç "><a href="#1-3-ç¤ºä¾‹ä»£ç " class="headerlink" title="1.3 ç¤ºä¾‹ä»£ç "></a>1.3 ç¤ºä¾‹ä»£ç </h3><p>è¿™é‡Œä»¥ç±»è£…é¥°å™¨ï¼ˆClass decoratorsï¼‰ä¸ºä¾‹ï¼Œä»‹ç»å¦‚ä½•ä½¿ç”¨è£…é¥°å™¨ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyDecorators</span>(<span class="params">target: <span class="built_in">Function</span></span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">  target.prototype.say = <span class="function"><span class="keyword">function</span> (<span class="params"></span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;Hello å‰ç«¯è‡ªä¹ è¯¾!&quot;</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@MyDecorators</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LeoClass</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line">  <span class="function"><span class="title">say</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="string">&quot;Hello Leo&quot;</span>)&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> leo = <span class="keyword">new</span> LeoClass();</span><br><span class="line">leo.say(); </span><br><span class="line"><span class="comment">// &#x27;Hello Leo!&#x27;;</span></span><br></pre></td></tr></table></figure>

<h3 id="1-4-ç¼–è¯‘ç»“æœ"><a href="#1-4-ç¼–è¯‘ç»“æœ" class="headerlink" title="1.4 ç¼–è¯‘ç»“æœ"></a>1.4 ç¼–è¯‘ç»“æœ</h3><p>è£…é¥°å™¨å®é™…ä¸Šéå¸¸ç®€å•ï¼Œç¼–è¯‘å‡ºæ¥ä»¥åï¼Œåªæ˜¯ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬æ¥ç€çœ‹ã€‚<br>è¿™é‡Œä»¥ã€Š1.3 ç¤ºä¾‹ä»£ç ã€‹ä¸ºä¾‹ï¼Œçœ‹çœ‹å®ƒçš„ç¼–è¯‘ç»“æœï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> __decorate = (<span class="built_in">this</span> &amp;&amp; <span class="built_in">this</span>.__decorate) || <span class="function"><span class="keyword">function</span> (<span class="params">decorators, target, key, desc</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> c = <span class="built_in">arguments</span>.length, r = c &lt; <span class="number">3</span> ? target : desc === <span class="literal">null</span> ? desc = <span class="built_in">Object</span>.getOwnPropertyDescriptor(target, key) : desc, d;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">Reflect</span> === <span class="string">&quot;object&quot;</span> &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">Reflect</span>.decorate === <span class="string">&quot;function&quot;</span>) r = <span class="built_in">Reflect</span>.decorate(decorators, target, key, desc);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">for</span> (<span class="keyword">var</span> i = decorators.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) <span class="keyword">if</span> (d = decorators[i]) r = (c &lt; <span class="number">3</span> ? d(r) : c &gt; <span class="number">3</span> ? d(target, key, r) : d(target, key)) || r;</span><br><span class="line">    <span class="keyword">return</span> c &gt; <span class="number">3</span> &amp;&amp; r &amp;&amp; <span class="built_in">Object</span>.defineProperty(target, key, r), r;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> __metadata = (<span class="built_in">this</span> &amp;&amp; <span class="built_in">this</span>.__metadata) || <span class="function"><span class="keyword">function</span> (<span class="params">k, v</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">Reflect</span> === <span class="string">&quot;object&quot;</span> &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">Reflect</span>.metadata === <span class="string">&quot;function&quot;</span>) <span class="keyword">return</span> <span class="built_in">Reflect</span>.metadata(k, v);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyDecorators</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">    target.prototype.say = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;Hello å‰ç«¯è‡ªä¹ è¯¾!&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> LeoClass = <span class="class"><span class="keyword">class</span> <span class="title">LeoClass</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123; &#125;</span><br><span class="line">    <span class="function"><span class="title">say</span>(<span class="params"></span>)</span> &#123; <span class="built_in">console</span>.log(<span class="string">&quot;Hello Leo&quot;</span>); &#125;</span><br><span class="line">&#125;;</span><br><span class="line">LeoClass = __decorate([</span><br><span class="line">    MyDecorators,</span><br><span class="line">    __metadata(<span class="string">&quot;design:paramtypes&quot;</span>, [])</span><br><span class="line">], LeoClass);</span><br><span class="line"><span class="keyword">let</span> leo = <span class="keyword">new</span> LeoClass();</span><br><span class="line">leo.say();</span><br><span class="line"><span class="comment">// &#x27;Hello Leo!&#x27;;</span></span><br></pre></td></tr></table></figure>
<p>å…¶å®å°±æ˜¯ <code>__decorate</code>Â å‡½æ•°å•¦ï¼Œå…·ä½“å¤§å®¶å¯ä»¥è‡ªè¡Œç»†çœ‹å’¯~<br>ä»ç¼–è¯‘å JS ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œ<strong>è£…é¥°å™¨æ˜¯åœ¨æ¨¡å—å¯¼å…¥æ—¶ä¾¿æ‰§è¡Œçš„</strong>ã€‚å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LeoClass = __decorate([</span><br><span class="line">    MyDecorators,</span><br><span class="line">    __metadata(<span class="string">&quot;design:paramtypes&quot;</span>, [])</span><br><span class="line">], LeoClass);</span><br></pre></td></tr></table></figure>



<h3 id="1-5-å°ç»“"><a href="#1-5-å°ç»“" class="headerlink" title="1.5 å°ç»“"></a>1.5 å°ç»“</h3><p>æ¥ä¸‹æ¥é€šè¿‡ä¸‹å›¾æ¥å›é¡¾è£…é¥°å™¨çš„çŸ¥è¯†ã€‚<br><img src="http://images.pingan8787.com/JavaScript-Base/Learn-Overnight-Source/Decorator-Introduce.png" alt="Decorator-Introduce.png"></p>
<h2 id="2-Reflect-Metadata-API"><a href="#2-Reflect-Metadata-API" class="headerlink" title="2. Reflect Metadata API"></a>2. Reflect Metadata API</h2><h3 id="2-1-ä»€ä¹ˆæ˜¯-Reflect-ï¼Ÿ"><a href="#2-1-ä»€ä¹ˆæ˜¯-Reflect-ï¼Ÿ" class="headerlink" title="2.1 ä»€ä¹ˆæ˜¯ Reflect ï¼Ÿ"></a>2.1 ä»€ä¹ˆæ˜¯ Reflect ï¼Ÿ</h3><p>Reflectï¼ˆå³åå°„ï¼‰æ˜¯ ES6 æ–°å¢çš„ä¸€ä¸ª<strong>å†…ç½®å¯¹è±¡</strong>ï¼Œå®ƒæä¾›ç”¨æ¥<strong>æ‹¦æˆªå’Œæ“ä½œ</strong> JavaScript å¯¹è±¡çš„ APIã€‚å¹¶ä¸” <strong>Reflect çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•éƒ½æ˜¯é™æ€çš„</strong>ï¼Œå°±åƒ Math å¯¹è±¡ï¼ˆ <code>Math.random()</code>Â ç­‰ï¼‰ã€‚</p>
<p>æ›´å¤š Reflect è¯¦ç»†ä»‹ç»ï¼Œè¯·é˜…è¯»æ–‡æ¡£<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect">ã€ŠMDN Reflectã€‹</a>ã€‚</p>
<h3 id="2-2-ä¸ºä»€ä¹ˆå‡ºç°-Reflectï¼Ÿ"><a href="#2-2-ä¸ºä»€ä¹ˆå‡ºç°-Reflectï¼Ÿ" class="headerlink" title="2.2 ä¸ºä»€ä¹ˆå‡ºç° Reflectï¼Ÿ"></a>2.2 ä¸ºä»€ä¹ˆå‡ºç° Reflectï¼Ÿ</h3><p>å…¶æ ¸å¿ƒç›®çš„ï¼Œæ˜¯ä¸ºäº†ä¿æŒ JS çš„ç®€å•ï¼Œè®©æˆ‘ä»¬å¯ä»¥ä¸ç”¨å†™å¾ˆå¤šä»£ç ï¼Œè¿™é‡Œä¸¾ä¸ªæ —å­ğŸŒ°ï¼Œçœ‹çœ‹æœ‰ä½¿ç”¨ Reflect å’Œæ²¡ä½¿ç”¨æœ‰ä»€ä¹ˆåŒºåˆ«ï¼š<br>å½“å¯¹è±¡é‡Œæœ‰ <code>Symbol</code> æ—¶ï¼Œå¦‚ä½•éå†å¯¹è±¡çš„ <code>keys</code>ï¼Ÿ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> s = <span class="built_in">Symbol</span>(<span class="string">&#x27;foo&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> k = <span class="string">&#x27;bar&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> o = &#123; [s]: <span class="number">1</span>, [k]: <span class="number">1</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ²¡æœ‰ä½¿ç”¨ Reflect</span></span><br><span class="line"><span class="keyword">const</span> keys = <span class="built_in">Object</span>.getOwnPropertyNames(o).concat(<span class="built_in">Object</span>.getOwnPropertySymbols(o));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ Reflect</span></span><br><span class="line"><span class="built_in">Reflect</span>.ownKeys(o);</span><br></pre></td></tr></table></figure>
<p>è¿™çœ‹èµ·æ¥æ˜¯ä¸æ˜¯ç®€å•å¤šäº†ï¼Ÿ</p>
<p>æ›´å¤š <code>Reflect</code> è¯¦ç»†ä»‹ç»ï¼Œè¯·é˜…è¯»æ–‡æ¡£<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect">ã€ŠMDN Reflectã€‹</a>ã€‚</p>
<h3 id="2-3-ä»€ä¹ˆæ˜¯-Reflect-Metadata"><a href="#2-3-ä»€ä¹ˆæ˜¯-Reflect-Metadata" class="headerlink" title="2.3 ä»€ä¹ˆæ˜¯ Reflect Metadata"></a>2.3 ä»€ä¹ˆæ˜¯ Reflect Metadata</h3><p>Reflect Metadata æ˜¯ ES7 çš„ä¸€ä¸ªææ¡ˆï¼Œå®ƒä¸»è¦ç”¨æ¥<strong>åœ¨å£°æ˜çš„æ—¶æ·»åŠ å’Œè¯»å–å…ƒæ•°æ®</strong>ã€‚TypeScript åœ¨ 1.5+ çš„ç‰ˆæœ¬å·²ç»æ”¯æŒå®ƒï¼Œä½ åªéœ€è¦ï¼š</p>
<ul>
<li><code>npm i reflect-metadata --save</code>ã€‚</li>
<li>åœ¨ <code>tsconfig.json</code> é‡Œé…ç½® <code>emitDecoratorMetadata</code> é€‰é¡¹ã€‚</li>
</ul>
<p>Reflect Metadata å¯ä»¥å½“åšè£…é¥°å™¨ä½¿ç”¨ï¼Œæœ‰ä¸¤ä¸ª APIï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>Reflect.metadata()</code>Â API <strong>æ·»åŠ å…ƒæ•°æ®</strong>ï¼›</li>
<li>ä½¿ç”¨ <code>Reflect.getMetadata()</code>Â API <strong>è¯»å–å…ƒæ•°æ®</strong>ã€‚<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">Reflect</span>.metadata(<span class="string">&#x27;inClass&#x27;</span>, <span class="string">&#x27;A&#x27;</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LearnReflect</span> </span>&#123;</span><br><span class="line">  @<span class="built_in">Reflect</span>.metadata(<span class="string">&#x27;inMethod&#x27;</span>, <span class="string">&#x27;B&#x27;</span>)</span><br><span class="line">  public hello(): string &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello world&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Reflect</span>.getMetadata(<span class="string">&#x27;inClass&#x27;</span>, LearnReflect)); <span class="comment">// &#x27;A&#x27;</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Reflect</span>.getMetadata(<span class="string">&#x27;inMethod&#x27;</span>, <span class="keyword">new</span> LearnReflect(), <span class="string">&#x27;hello&#x27;</span>)); <span class="comment">// &#x27;B&#x27;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>å½“ç„¶ <code>Reflect</code>Â æä¾›å¾ˆå¤šå…¶ä»– APIï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;reflect-metadata&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰å¯¹è±¡æˆ–å±æ€§çš„å…ƒæ•°æ®</span></span><br><span class="line"><span class="built_in">Reflect</span>.defineMetadata(metadataKey, metadataValue, target);</span><br><span class="line"><span class="built_in">Reflect</span>.defineMetadata(metadataKey, metadataValue, target, propertyKey);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ£€æŸ¥å¯¹è±¡æˆ–å±æ€§çš„åŸå‹é“¾ä¸Šæ˜¯å¦å­˜åœ¨å…ƒæ•°æ®é”®</span></span><br><span class="line"><span class="keyword">let</span> result = <span class="built_in">Reflect</span>.hasMetadata(metadataKey, target);</span><br><span class="line"><span class="keyword">let</span> result = <span class="built_in">Reflect</span>.hasMetadata(metadataKey, target, propertyKey);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ£€æŸ¥å¯¹è±¡æˆ–å±æ€§æ˜¯å¦å­˜åœ¨è‡ªå·±çš„å…ƒæ•°æ®é”®</span></span><br><span class="line"><span class="keyword">let</span> result = <span class="built_in">Reflect</span>.hasMetadata(metadataKey, target);</span><br><span class="line"><span class="keyword">let</span> result = <span class="built_in">Reflect</span>.hasMetadata(metadataKey, target, propertyKey);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å¯¹è±¡æˆ–å±æ€§åŸå‹é“¾ä¸Šå…ƒæ•°æ®é”®çš„å…ƒæ•°æ®å€¼</span></span><br><span class="line"><span class="keyword">let</span> result = <span class="built_in">Reflect</span>.getMetadata(metadataKey, target);</span><br><span class="line"><span class="keyword">let</span> result = <span class="built_in">Reflect</span>.getMetadata(metadataKey, target, propertyKey);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å¯¹è±¡æˆ–å±æ€§çš„è‡ªå·±çš„å…ƒæ•°æ®é”®çš„å…ƒæ•°æ®å€¼</span></span><br><span class="line"><span class="keyword">let</span> result = <span class="built_in">Reflect</span>.getOwnMetadata(metadataKey, target);</span><br><span class="line"><span class="keyword">let</span> result = <span class="built_in">Reflect</span>.getOwnMetadata(metadataKey, target, propertyKey);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å¯¹è±¡æˆ–å±æ€§åŸå‹é“¾ä¸Šçš„æ‰€æœ‰å…ƒæ•°æ®é”®</span></span><br><span class="line"><span class="keyword">let</span> result = <span class="built_in">Reflect</span>.getMetadataKeys(target);</span><br><span class="line"><span class="keyword">let</span> result = <span class="built_in">Reflect</span>.getMetadataKeys(target, propertyKey);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å¯¹è±¡æˆ–å±æ€§çš„æ‰€æœ‰è‡ªå·±çš„å…ƒæ•°æ®é”®</span></span><br><span class="line"><span class="keyword">let</span> result = <span class="built_in">Reflect</span>.getOwnMetadataKeys(target);</span><br><span class="line"><span class="keyword">let</span> result = <span class="built_in">Reflect</span>.getOwnMetadataKeys(target, propertyKey);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»å¯¹è±¡æˆ–å±æ€§ä¸­åˆ é™¤å…ƒæ•°æ®</span></span><br><span class="line"><span class="keyword">let</span> result = <span class="built_in">Reflect</span>.deleteMetadata(metadataKey, target);</span><br><span class="line"><span class="keyword">let</span> result = <span class="built_in">Reflect</span>.deleteMetadata(metadataKey, target, propertyKey);</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡è£…é¥°å™¨å°†å…ƒæ•°æ®åº”ç”¨äºæ„é€ å‡½æ•°</span></span><br><span class="line"><span class="meta">@Reflect</span>.metadata(metadataKey, metadataValue)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</span><br><span class="line">  <span class="comment">// é€šè¿‡è£…é¥°å™¨å°†å…ƒæ•°æ®åº”ç”¨äºæ–¹æ³•(å±æ€§)</span></span><br><span class="line">  <span class="meta">@Reflect</span>.metadata(metadataKey, metadataValue)</span><br><span class="line">  <span class="function"><span class="title">method</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>éœ€è¦è®°å¾—é…ç½® tsconfig.jsonï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;target&quot;</span>: <span class="string">&quot;es5&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;lib&quot;</span>: [<span class="string">&quot;es6&quot;</span>, <span class="string">&quot;dom&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;types&quot;</span>: [<span class="string">&quot;reflect-metadata&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;module&quot;</span>: <span class="string">&quot;commonjs&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;moduleResolution&quot;</span>: <span class="string">&quot;node&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;experimentalDecorators&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;emitDecoratorMetadata&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ Overnight ä¸­ä¸»è¦ä½¿ç”¨æœ‰ä¸¤ä¸ª APIï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>Reflect.defineMetadata()</code> API <strong>æ·»åŠ å…ƒæ•°æ®</strong>ï¼›</li>
<li>ä½¿ç”¨ <code>Reflect.getOwnMetadata()</code> API <strong>è¯»å–å…ƒæ•°æ®</strong>ã€‚</li>
</ul>
<p>ä¸‹é¢ä»¥ Overnight ä¸­ç±»è£…é¥°å™¨ï¼ˆCommon Classï¼‰æ¥ä»‹ç»è¿™ä¸¤ä¸ª API ä½¿ç”¨è¿‡ç¨‹ï¼š<br><img src="http://images.pingan8787.com/JavaScript-Base/Learn-Overnight-Source/Reflect-Metadata-Use.png" alt="Reflect-Metadata-Use.png"></p>
<h3 id="2-4-å°ç»“"><a href="#2-4-å°ç»“" class="headerlink" title="2.4 å°ç»“"></a>2.4 å°ç»“</h3><p>è¿™é‡Œå›é¡¾ä¸‹ Relect Metadata çš„çŸ¥è¯†ï¼š<br><img src="http://images.pingan8787.com/JavaScript-Base/Learn-Overnight-Source/Reflect-Metadata-Introduce.png" alt="Reflect-Metadata-Introduce.png"><br>ç†è§£æ¸…æ¥šå‰é¢ä¸¤ä¸ªçŸ¥è¯†ç‚¹åï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å¼€å§‹çœ‹çœ‹ Overnightã€‚</p>
<h1 id="ä¸‰ã€Overnight-è¯¦è§£"><a href="#ä¸‰ã€Overnight-è¯¦è§£" class="headerlink" title="ä¸‰ã€Overnight è¯¦è§£"></a>ä¸‰ã€Overnight è¯¦è§£</h1><h2 id="1-æ¦‚å¿µä»‹ç»"><a href="#1-æ¦‚å¿µä»‹ç»" class="headerlink" title="1. æ¦‚å¿µä»‹ç»"></a>1. æ¦‚å¿µä»‹ç»</h2><p><a target="_blank" rel="noopener" href="https://github.com/seanpmaxwell/overnight"><strong>OvernightJS</strong></a>** ä¸»è¦æ˜¯ä¸º Express è·¯ç”±æä¾› TypeScript è£…é¥°å™¨æ”¯æŒï¼Œé€šè¿‡è£…é¥°å™¨æ¥ç®¡ç†è·¯ç”±**ã€‚<br>æ˜¯ä¸æ˜¯æŠ½è±¡äº†ç‚¹ï¼Ÿé‚£çœ‹çœ‹ä¸‹é¢è¿™æ®µä»£ç å§ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span>(<span class="string">&#x27;api/posts&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">PostController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">&#x27;:id&#x27;</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="title">get</span>(<span class="params">req: Request, res: Response</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šé¢ä»£ç æ‰€ç¤ºï¼ŒOvernightJS å°±æ˜¯è¿™æ ·ä½¿ç”¨ï¼Œç®€å•ï¼Œæ˜äº†ã€‚<br>å¦å¤– OvernightJS å…±æä¾›äº†ä¸‰ä¸ªåº“ï¼š</p>
<ul>
<li>OvernightJS/coreï¼šæ ¸å¿ƒåº“ï¼›</li>
<li>OvernightJS/loggerï¼šæ—¥å¿—è®°å½•å·¥å…·åº“ï¼›</li>
<li>OvernightJS/jwtï¼š<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/86937325">JWT</a> åº“ï¼›</li>
</ul>
<p>æ¥ä¸‹æ¥ä¸»è¦ä»‹ç» OvernightJS/core æ ¸å¿ƒåº“ï¼Œå…¶ä»–ä¸¤ä¸ªæœ‰å…´è¶£å¯ä»¥è‡ªå·±çœ‹å“ˆï¼Œä¸¾ä¸€åä¸‰ï¼Œå…¶å®æ ¸å¿ƒä¸€æ ·çš„ã€‚</p>
<h2 id="2-OvernightJS-core-å¿«é€Ÿä¸Šæ‰‹"><a href="#2-OvernightJS-core-å¿«é€Ÿä¸Šæ‰‹" class="headerlink" title="2. OvernightJS/core å¿«é€Ÿä¸Šæ‰‹"></a>2. OvernightJS/core å¿«é€Ÿä¸Šæ‰‹</h2><h3 id="2-1-å®‰è£…-OvernightJS-core"><a href="#2-1-å®‰è£…-OvernightJS-core" class="headerlink" title="2.1 å®‰è£… OvernightJS/core"></a>2.1 å®‰è£… OvernightJS/core</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save @overnightjs/core express </span><br><span class="line">$ npm install --save-dev @types/express</span><br></pre></td></tr></table></figure>

<h3 id="2-2-OvernightJS-core-ç¤ºä¾‹ä»£ç "><a href="#2-2-OvernightJS-core-ç¤ºä¾‹ä»£ç " class="headerlink" title="2.2 OvernightJS/core ç¤ºä¾‹ä»£ç "></a>2.2 OvernightJS/core ç¤ºä¾‹ä»£ç </h3><p>é¦–å…ˆä»‹ç»ä¸‹æˆ‘ä»¬ç¤ºä¾‹ä»£ç éœ€è¦å®ç°çš„åŠŸèƒ½ï¼š</p>
<ol>
<li><code>UserController</code> ç±»ï¼Œè´Ÿè´£ç®¡ç†<strong>ä¸šåŠ¡é€»è¾‘</strong>çš„æ§åˆ¶å™¨ï¼›</li>
<li><code>ServerController</code> ç±»ï¼Œè´Ÿè´£ç®¡ç†<strong>æœåŠ¡é€»è¾‘</strong>çš„æ§åˆ¶å™¨ï¼›</li>
<li>æ‰§è¡ŒæœåŠ¡å¯åŠ¨ï¼›</li>
</ol>
<p><strong>ç¬¬ä¸€æ­¥</strong>ï¼Œå¯¼å…¥éœ€è¦çš„ä¾èµ–ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Controller, Get, Server &#125; <span class="keyword">from</span> <span class="string">&#x27;@overnightjs/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Request, Response &#125; <span class="keyword">from</span> <span class="string">&#x27;express&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> bodyParser <span class="keyword">from</span> <span class="string">&#x27;body-parser&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">3000</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ç¬¬äºŒæ­¥</strong>ï¼Œå®ç° <code>UserController</code> ç±»ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span>(<span class="string">&#x27;/users&#x27;</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">&#x27;/:id&#x27;</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="title">get</span>(<span class="params">req: Request, res: Response</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> res.send(<span class="string">`hello, your id is:<span class="subst">$&#123;req.params.id&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">&#x27;/list&#x27;</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="title">getList</span>(<span class="params">req: Request, res: Response</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> res.send([</span><br><span class="line">          &#123;<span class="attr">name</span>: <span class="string">&quot;leo&quot;</span>, <span class="attr">age</span>: <span class="number">17</span>&#125;,</span><br><span class="line">          &#123;<span class="attr">name</span>: <span class="string">&quot;robin&quot;</span>, <span class="attr">age</span>: <span class="number">19</span>&#125;</span><br><span class="line">        ])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨å£°æ˜ <code>UserController</code> ç±»æ—¶ï¼Œä½¿ç”¨ OvernightJS/core çš„ <code>@Controller</code> è£…é¥°å™¨ï¼Œä½¿ç”¨ <code>&quot;/users&quot;</code> è·¯å¾„ä½œä¸ºå‚æ•°ï¼Œä½œç”¨æ˜¯ä¸ºå½“å‰è·¯ç”±æ§åˆ¶å™¨æŒ‡å®šä¸€ä¸ªè·¯ç”±åœ°å€ï¼Œå¯ä»¥ç†è§£ä¸ºè¿™ç»„è·¯ç”±çš„â€œæ ¹è·¯å¾„â€ï¼Œè¯¥ç±»ä¸­å®ç°çš„æ‰€æœ‰æ¥å£è·¯å¾„ï¼Œéƒ½ä¼šä»¥è¯¥â€œæ ¹è·¯å¾„â€ä¸ºåŸºç¡€ã€‚<br>ç„¶ååœ¨<code>UserController</code> ç±»ä¸­ï¼Œé€šè¿‡ OvernightJS/core æä¾› <code>@Get</code>Â è£…é¥°å™¨ï¼Œåˆ†åˆ«ä½¿ç”¨ <code>&quot;/:id&quot;</code>Â å’Œ <code>&quot;/list&quot;</code>Â è·¯å¾„ä½œä¸ºå‚æ•°ï¼Œç»‘å®šè·¯ç”±ã€‚</p>
<p>æœ€ç»ˆ <code>UserController</code> ç±»å®ç°çš„è·¯ç”±åœ°å€åŒ…æ‹¬ï¼š</p>
<ul>
<li><code>/user/:id</code></li>
<li><code>/users/list</code></li>
</ul>
<p><strong>ç¬¬ä¸‰æ­¥</strong>ï¼Œå®ç° <code>ServerController</code> ç±»ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ServerController</span> <span class="keyword">extends</span> <span class="title">Server</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="built_in">this</span>.app.use(bodyParser.json());</span><br><span class="line">        <span class="built_in">super</span>.addControllers(<span class="keyword">new</span> UserController());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> start(port?: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.app.listen(port, <span class="function">() =&gt;</span> &#123;<span class="built_in">console</span>.log(<span class="string">&#x27;å¯åŠ¨æˆåŠŸï¼Œç«¯å£å·ï¼š&#x27;</span>,port)&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>ServerController</code> ç±»ç»§æ‰¿  OvernightJS/core æä¾›çš„ <code>Server</code>Â ç±»ï¼Œé€šè¿‡åœ¨æ„é€ å‡½æ•°ä¸­è°ƒç”¨ <code>super.addControllers(new UserController())</code>Â æ¥å®ç°å°†å‰é¢å£°æ˜å¥½çš„è·¯ç”±æ§åˆ¶å™¨ç±»ï¼Œæ·»åŠ åˆ°OvernightJS/core ç»Ÿä¸€ç®¡ç†çš„æ§åˆ¶å™¨æ•°ç»„ä¸­ã€‚<br>å¦å¤–åœ¨è¯¥ç±»ä¸­ï¼Œæˆ‘ä»¬è¿˜å£°æ˜ <code>start</code>Â æ–¹æ³•ï¼Œç”¨æ¥å¯åŠ¨æœåŠ¡å™¨ã€‚</p>
<p><strong>ç¬¬å››æ­¥</strong>ï¼Œå®ç°å¯åŠ¨æœåŠ¡å™¨é€»è¾‘ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> server = <span class="keyword">new</span> ServerController();</span><br><span class="line">server.start(port);</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå¯åŠ¨æœåŠ¡å™¨å°±ç›¸å½“ç®€å•å’¯~~</p>
<p>Â æ•´ä¸ªå®ç°ç¤ºä¾‹ä»£ç çš„æµç¨‹å¦‚ä¸‹ï¼š<br>å£°æ˜äº†ä¸¤ä¸ªç±»ï¼š <code>UserController</code> å’Œ <code>ServerController</code> ï¼Œåˆ†åˆ«ä¸º<strong>ä¸šåŠ¡é€»è¾‘çš„æ§åˆ¶å™¨</strong>å’Œ<strong>æœåŠ¡é€»è¾‘çš„æ§åˆ¶å™¨</strong>ï¼Œæœ€ååœ¨ä¸»å…¥å£ä¸­å»å®ä¾‹åŒ–ï¼Œå¹¶æ‰§è¡Œå®ä¾‹åŒ–ç»“æœçš„ <code>start</code> æ–¹æ³•å¯åŠ¨æœåŠ¡ã€‚<br>Â <br>æœ€åå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Controller, Get, Server &#125; <span class="keyword">from</span> <span class="string">&#x27;@overnightjs/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Request, Response &#125; <span class="keyword">from</span> <span class="string">&#x27;express&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> bodyParser <span class="keyword">from</span> <span class="string">&#x27;body-parser&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">3000</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">&#x27;:id&#x27;</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="title">get</span>(<span class="params">req: Request, res: Response</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> res.send(<span class="string">`hello, your id is:<span class="subst">$&#123;req.params.id&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">&#x27;list&#x27;</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="title">get</span>(<span class="params">req: Request, res: Response</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> res.send([</span><br><span class="line">          &#123;<span class="attr">name</span>: <span class="string">&quot;leo&quot;</span>, <span class="attr">age</span>: <span class="number">17</span>&#125;,</span><br><span class="line">          &#123;<span class="attr">name</span>: <span class="string">&quot;robin&quot;</span>, <span class="attr">age</span>: <span class="number">19</span>&#125;</span><br><span class="line">        ])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ServerController</span> <span class="keyword">extends</span> <span class="title">Server</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="built_in">this</span>.app.use(bodyParser.json());</span><br><span class="line">        <span class="built_in">super</span>.addControllers(<span class="keyword">new</span> UserController());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> start(port?: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.app.listen(port, <span class="function">() =&gt;</span> &#123;<span class="built_in">console</span>.log(<span class="string">&#x27;å¯åŠ¨æˆåŠŸï¼Œç«¯å£å·ï¼š&#x27;</span>,port)&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = <span class="keyword">new</span> ServerController();</span><br><span class="line">server.start(port);</span><br></pre></td></tr></table></figure>
<p>Â </p>
<h2 id="3-OvernightJS-core-è£…é¥°å™¨åˆ†æ"><a href="#3-OvernightJS-core-è£…é¥°å™¨åˆ†æ" class="headerlink" title="3. OvernightJS/core è£…é¥°å™¨åˆ†æ"></a>3. OvernightJS/core è£…é¥°å™¨åˆ†æ</h2><p>åœ¨é˜…è¯»æºç è¿‡ç¨‹ä¸­ï¼Œæˆ‘å°† OvernightJS/core ä¸­æ‰€æœ‰çš„è£…é¥°å™¨æŒ‰ç…§<strong>æºç ç›®å½•ç»“æ„ç»´åº¦</strong>åšäº†åˆ†ç±»ï¼Œç»“æœå¦‚ä¸‹ï¼š<br><img src="http://images.pingan8787.com/JavaScript-Base/Learn-Overnight-Source/Overnight-Decorators-Classify.png" alt="Overnight-Decorators-Classify.png"><br>é€šè¿‡ä¸Šå›¾å¯ä»¥æ¸…æ™°çœ‹å‡ºï¼ŒOvernightJS/core ä¸ºæˆ‘ä»¬æä¾›äº†å››ä¸ªå¤§ç±»çš„è£…é¥°å™¨ï¼Œå…·ä½“çš„ä½¿ç”¨æ–¹å¼ï¼Œè¿˜è¯·çœ‹çœ‹å®˜ç½‘æ–‡æ¡£å•¦~</p>
<h2 id="4-OvernightJS-core-æ¶æ„åˆ†æ"><a href="#4-OvernightJS-core-æ¶æ„åˆ†æ" class="headerlink" title="4. OvernightJS/core æ¶æ„åˆ†æ"></a>4. OvernightJS/core æ¶æ„åˆ†æ</h2><p>OvernightJS/core ç»“æ„è®¾è®¡ä¸Šè¿˜æ˜¯æ¯”è¾ƒç®€å•ï¼Œå¤§è‡´å¦‚ä¸‹æ¶æ„ï¼š<br><img src="http://images.pingan8787.com/JavaScript-Base/Learn-Overnight-Source/Overnight-Design.png" alt="Overnight-Design.png"><br>åœ¨ OvernightJS/core ä¸­ï¼Œä¸»è¦æä¾›ä¸¤ä¸ªå¤§ç±»ï¼š <code>Server</code>Â ç±»å’Œ  <code>Decorators</code>Â ç›¸å…³æ–¹æ³•ã€‚<br>å…¶ä¸­ <code>Server</code> ç±»ä¸­çš„ <code>addConterllers</code>Â æ–¹æ³•æ˜¯å…³é”®ï¼Œä¸‹ä¸€èŠ‚å°†è¯¦ç»†ä»‹ç»ã€‚å“ˆå“ˆ</p>
<h2 id="5-OvernightJS-core-ä¸-Express-å…³è”"><a href="#5-OvernightJS-core-ä¸-Express-å…³è”" class="headerlink" title="5. OvernightJS/core ä¸ Express å…³è”"></a>5. OvernightJS/core ä¸ Express å…³è”</h2><p>å›é¡¾ä¸‹ Express ï¼Œæˆ‘ä»¬ç»å¸¸é€šè¿‡ <code>app.use(path, route)</code>Â æ¥å®šä¹‰ä¸€ä¸ªæ¥å£ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.use(path, route);</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆåœ¨ OvernightJS ä¸­å‘¢ï¼Ÿï¼Ÿ<br>å‰ä¸€å°èŠ‚æåˆ°çš„<code>addConterllers</code> æ–¹æ³•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿï¼Ÿ</p>
<p>Â å…¶å® OvernightJS æœ¬è´¨ä¸Šæ˜¯é€šè¿‡è°ƒç”¨ <code>addConterllers()</code> æ–¹æ³•æ¥å’Œ Express åšå…³è”ã€‚<br>å¯ä»¥ç†è§£ä¸º <strong>OvernightJS ä¸ Express ä¹‹é—´çš„æ¡¥æ¢</strong>ï¼Œå®ƒå°† OvernightJS/core å®šä¹‰å¥½çš„è·¯ç”±æ§åˆ¶å™¨ä½œä¸ºå‚æ•°ï¼Œé€šè¿‡ Express çš„ <code>use</code> æ–¹æ³•ï¼Œå°†è·¯ç”±æ·»åŠ çš„ Express ä¸­ï¼Œå®ç° Express è·¯ç”±æ³¨å†Œã€‚</p>
<p>Â æˆ‘ä»¬çœ‹ä¸‹æºç ä¸­<code>addControllers</code> æ–¹æ³•åšäº†ä»€ä¹ˆäº‹æƒ…ï¼š  </p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// core/lib/Server.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> addControllers(</span><br><span class="line">    controllers: Controller | Controller[],</span><br><span class="line">    routerLib?: RouterLib,</span><br><span class="line">    globalMiddleware?: RequestHandler,</span><br><span class="line">): <span class="built_in">void</span> &#123;</span><br><span class="line">    controllers = (controllers <span class="keyword">instanceof</span> <span class="built_in">Array</span>) ? controllers : [controllers];</span><br><span class="line">    <span class="keyword">const</span> routerLibrary: RouterLib = routerLib || Router;</span><br><span class="line">    controllers.forEach(<span class="function">(<span class="params">controller: Controller</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (controller) &#123;</span><br><span class="line">            <span class="keyword">const</span> routerAndPath: IRouterAndPath | <span class="literal">null</span> = <span class="built_in">this</span>.getRouter(routerLibrary, controller);</span><br><span class="line">            <span class="keyword">if</span> (routerAndPath) &#123;</span><br><span class="line">                <span class="keyword">if</span> (globalMiddleware) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.app.use(routerAndPath.basePath, globalMiddleware, routerAndPath.router);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="built_in">this</span>.app.use(routerAndPath.basePath, routerAndPath.router);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ç®€åŒ–ä¸‹ä¸Šé¢ä»£ç ï¼Œä¿ç•™æ ¸å¿ƒåŠŸèƒ½çš„æºç ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> addControllers(</span><br><span class="line">    controllers: Controller | Controller[],</span><br><span class="line">    routerLib?: RouterLib,</span><br><span class="line">    globalMiddleware?: RequestHandler,</span><br><span class="line">): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="comment">// ... çœç•¥å…¶ä»–ä»£ç </span></span><br><span class="line">    controllers = (controllers <span class="keyword">instanceof</span> <span class="built_in">Array</span>) ? controllers : [controllers];</span><br><span class="line">    controllers.forEach(<span class="function">(<span class="params">controller: Controller</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.app.use(routerAndPath.basePath, routerAndPath.router);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢ä»£ç å¯ä»¥çœ‹å‡ºï¼Œ <code>addControllers</code>Â æ–¹æ³•æ”¯æŒä¼ å…¥å•ä¸ª controller æˆ–ä¸€ä¸ªæ•°ç»„çš„ controllerï¼Œæ–¹æ³•å†…é€šè¿‡ <code>forEach</code>Â éå†æ¯ä¸ªæ§åˆ¶å™¨ï¼Œå¹¶å°† <code>path</code>Â å’Œ <code>router</code>Â ä½œä¸ºå‚æ•°ä¼ å…¥ <code>app.use</code>Â æ–¹æ³•ä¸­ï¼Œå®ç° Express çš„è·¯ç”±æ³¨å†Œã€‚</p>
<h1 id="å››ã€Overnight-VS-Express"><a href="#å››ã€Overnight-VS-Express" class="headerlink" title="å››ã€Overnight VS Express"></a>å››ã€Overnight VS Express</h1><p>ä»å‰é¢æ¦‚å¿µä»‹ç»ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“ï¼šOvernightJS ä¸»è¦æ˜¯ä¸º Express è·¯ç”±æä¾› TypeScript è£…é¥°å™¨æ”¯æŒï¼Œé€šè¿‡è£…é¥°å™¨æ¥ç®¡ç†è·¯ç”±ã€‚</p>
<p>é‚£ä¹ˆ<strong>ä½¿ç”¨ OvernightJS è·Ÿæ²¡æœ‰ä½¿ç”¨æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</strong><br>ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«é€šè¿‡ OvernightJS å’Œ Express å®ç°ç›¸åŒåŠŸèƒ½ï¼ŒåŠŸèƒ½åŒ…æ‹¬ï¼šæœ¬åœ°å¯åŠ¨ 4000 ç«¯å£ï¼Œæ”¯æŒ <code>api/users/:id</code>Â æ¥å£ã€‚</p>
<h2 id="1-OvernightJS-å®ç°"><a href="#1-OvernightJS-å®ç°" class="headerlink" title="1. OvernightJS å®ç°"></a>1. OvernightJS å®ç°</h2><p>é¦–å…ˆå®ç°å…¥å£æ–‡ä»¶ï¼Œå…¶ä¸­é€šè¿‡å®ä¾‹åŒ– <code>ServerController</code> ç±»ï¼Œå¹¶æ‰§è¡Œå®ä¾‹åŒ–ç»“æ„çš„ <code>start</code>Â æ–¹æ³•æ¥å¯åŠ¨æœåŠ¡ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// customApp.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ServerController <span class="keyword">from</span> <span class="string">&quot;../controller/custom.server.controller&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">4000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = <span class="keyword">new</span> ServerController();</span><br><span class="line">server.start(port);</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ tsconfig.json é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;target&quot;</span>: <span class="string">&quot;es6&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;module&quot;</span>: <span class="string">&quot;commonjs&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;strict&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;esModuleInterop&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;experimentalDecorators&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;skipLibCheck&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;forceConsistentCasingInFileNames&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¤§è‡´è¿‡ç¨‹å¦‚ä¸Šé¢ä»£ç ï¼Œæ¥ä¸‹æ¥è¦å¼€å§‹å®ç°å…·ä½“çš„ <code>ServerController</code>Â  ç±»ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// controller/custom.server.controller.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; Server &#125; <span class="keyword">from</span> <span class="string">&quot;@overnightjs/core&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> RouterController <span class="keyword">from</span> <span class="string">&quot;./custom.router.controller&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ServerController</span> <span class="keyword">extends</span> <span class="title">Server</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="built_in">super</span>.addControllers(<span class="keyword">new</span> RouterController());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> start(port?: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.app.listen(port, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;å¯åŠ¨æˆåŠŸï¼Œç«¯å£å·ï¼š&#x27;</span>,port)&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ServerController;</span><br></pre></td></tr></table></figure>
<p>Â <br>æœ€åå®ç° <code>RouterController</code>Â  ç±»ï¼Œè¯¥ API ä¸‹çš„è·¯ç”±æ–¹æ³•ï¼Œéƒ½å®šä¹‰åœ¨è¿™ä¸ªç±»ä¸­ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// controller/custom.router.controller.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Request, Response &#125; <span class="keyword">from</span> <span class="string">&#x27;express&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Controller, Get, Put &#125; <span class="keyword">from</span> <span class="string">&#x27;@overnightjs/core&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">&quot;api/users&quot;</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RouterController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">&quot;:id&quot;</span>)</span><br><span class="line">    <span class="keyword">private</span> get(req:Request, <span class="attr">res</span>:Response): <span class="built_in">any</span>&#123;</span><br><span class="line">        res.send(<span class="string">&quot;hello leo!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> RouterController;</span><br></pre></td></tr></table></figure>
<p>Â </p>
<h2 id="2-Express-å®ç°"><a href="#2-Express-å®ç°" class="headerlink" title="2. Express å®ç°"></a>2. Express å®ç°</h2><p>è·Ÿå‰é¢ä¸€ä¸‹ï¼Œè¿™é‡Œä¹Ÿæ˜¯å…ˆå®ç°å…¥å£æ–‡ä»¶ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ServerController <span class="keyword">from</span> <span class="string">&quot;../controller/server.controller&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">4000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = <span class="keyword">new</span> ServerController();</span><br><span class="line">server.start(port);</span><br></pre></td></tr></table></figure>
<p>ç„¶åå®ç°å…·ä½“çš„ <code>ServerController</code>Â  ç±»ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// controller/server.controller/.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> express, &#123; Application &#125; <span class="keyword">from</span> <span class="string">&#x27;express&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> RouterController <span class="keyword">from</span> <span class="string">&quot;./router.controller&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ServerController</span> </span>&#123;</span><br><span class="line">    <span class="attr">app</span>: Application = express();</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span>&#123;<span class="built_in">this</span>.addControllers()&#125;;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="title">addControllers</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> Router = <span class="keyword">new</span> RouterController().getController();</span><br><span class="line">        <span class="built_in">this</span>.app.use(<span class="string">&#x27;/api/users&#x27;</span>, Router);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> start(port?: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.app.listen(port, <span class="function">() =&gt;</span> &#123;<span class="built_in">console</span>.log(<span class="string">&#x27;å¯åŠ¨æˆåŠŸï¼Œç«¯å£å·ï¼š&#x27;</span>,port)&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ServerController;</span><br></pre></td></tr></table></figure>
<p>Â <br>æœ€åå®ç° <code>RouterController</code>Â  ç±»ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// controller/router.controller.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> express, &#123; Router, Application, Request, Response, NextFunction &#125; <span class="keyword">from</span> <span class="string">&quot;express&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RouterController</span> </span>&#123;</span><br><span class="line">    <span class="attr">router</span>: Router = express.Router();</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123; <span class="built_in">this</span>.addControllers()&#125;;</span><br><span class="line">    <span class="keyword">public</span> getController = (): <span class="function"><span class="params">Router</span> =&gt;</span> <span class="built_in">this</span>.router;</span><br><span class="line">    <span class="keyword">public</span> addControllers(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.router.get(<span class="string">&quot;/:id&quot;</span>, <span class="built_in">this</span>.get);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> get (req: Request, <span class="attr">res</span>: Response, <span class="attr">next</span>: NextFunction)&#123;</span><br><span class="line">        res.send(<span class="string">&quot;hello leo!&quot;</span>)</span><br><span class="line">        next();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> RouterController;</span><br></pre></td></tr></table></figure>
<p>Â </p>
<h2 id="3-ä¸¤è€…æ¯”è¾ƒ"><a href="#3-ä¸¤è€…æ¯”è¾ƒ" class="headerlink" title="3. ä¸¤è€…æ¯”è¾ƒ"></a>3. ä¸¤è€…æ¯”è¾ƒ</h2><p>ç›¸ä¿¡çœ‹åˆ°è¿™é‡Œçš„æœ‹å‹ï¼Œå¯¹å‰é¢ä¸¤ç§å®ç°æ–¹æ³•å¤§è‡´äº†è§£äº†ï¼Œæ¥ä¸‹æ¥é€šè¿‡ä¸€å¼ å›¾ï¼Œæ¥çœ‹çœ‹æ€»ç»“ä¸¤è€…å®ç°çš„åŒºåˆ«å§ã€‚<br><img src="http://images.pingan8787.com/JavaScript-Base/Learn-Overnight-Source/Overnight-VS-Express.png" alt="Overnight-VS-Express.png"></p>
<h1 id="äº”ã€æ€»ç»“"><a href="#äº”ã€æ€»ç»“" class="headerlink" title="äº”ã€æ€»ç»“"></a>äº”ã€æ€»ç»“</h1><p>æœ¬æ–‡ä¸»è¦ä»‹ç» OvernightJS ä¸ Express è·¯ç”±åŠŸèƒ½çš„åŸºæœ¬ä½¿ç”¨ï¼Œç„¶ååˆ†åˆ«ç”¨ä¸¤è€…å®ç°ç›¸åŒçš„è·¯ç”±åŠŸèƒ½ï¼Œå¯¹æ¯”å¾—å‡º OvernightJS çš„ä¼˜ç‚¹ï¼Œæ¨èä½¿ç”¨ Express + TypeScript çš„æœ‹å‹å¯ä»¥å°è¯•ä½¿ç”¨ OvernightJS å’¯~</p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2020-10-10</span><i class="fa fa-tag"></i><a class="tag" href="/tags/å‰ç«¯å¼€å‘/" title="å‰ç«¯å¼€å‘">å‰ç«¯å¼€å‘ </a><a class="tag" href="/tags/åŸåˆ›/" title="åŸåˆ›">åŸåˆ› </a><a class="tag" href="/tags/Nodejs/" title="Nodejs">Nodejs </a><a class="tag" href="/tags/è®¾è®¡æ¨¡å¼/" title="è®¾è®¡æ¨¡å¼">è®¾è®¡æ¨¡å¼ </a><a class="tag" href="/tags/Express/" title="Express">Express </a></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,https://pingan8787.github.io/2020/10/10/219-ã€Expressã€‘æˆ‘ä¸ºExpresså¼€äº†å¤–æŒ‚/,pingan8787,219-ã€Expressã€‘æˆ‘ä¸ºExpresså¼€äº†å¤–æŒ‚,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2020/12/24/220-%E3%80%90%E6%80%BB%E7%BB%93%E3%80%9121%E5%BC%A0%E5%9B%BE%E6%80%BB%E7%BB%93%E6%88%91%E7%9A%842020%E5%B9%B4/" title="220-ã€æ€»ç»“ã€‘21å¼ å›¾æ€»ç»“æˆ‘çš„2020å¹´">ä¸Šä¸€ç¯‡</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2020/09/22/218-%E3%80%90%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E3%80%91TypeScript%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%8F%91%E5%B8%83-%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F/" title="218-ã€è®¾è®¡æ¨¡å¼ã€‘TypeScriptè®¾è®¡æ¨¡å¼ä¹‹å‘å¸ƒ-è®¢é˜…æ¨¡å¼">ä¸‹ä¸€ç¯‡</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>