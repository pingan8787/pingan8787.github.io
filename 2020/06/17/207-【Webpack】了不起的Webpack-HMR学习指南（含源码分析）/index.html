<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author"><meta name="description" content="ç‹å¹³å®‰ä¸ªäººåšå®¢,pingan8787,å‰ç«¯å¼€å‘,äººå·¥æ™ºèƒ½,AI,æ·±åº¦å­¦ä¹ ,å‰ç«¯æ¡†æ¶vue,angular,react,nodejs,python,numpy,pandas,anaconda,Tensorflow,é«˜ç­‰æ•°å­¦,æ¦‚ç‡è®º,ç»Ÿè®¡å­¦ç¥ç»ç½‘ç»œ,"><title>207-ã€Webpackã€‘äº†ä¸èµ·çš„ Webpack HMR å­¦ä¹ æŒ‡å—ï¼ˆå«æºç åˆ†æï¼‰ Â· pingan8787</title><meta name="description" content="å­¦ä¹ æ—¶é—´ï¼š2020.06.14å­¦ä¹ ç« èŠ‚ï¼šã€ŠWebpack HMR åŸç†è§£æã€‹
ä¸€ã€HMR ä»‹ç»Hot Module Replacementï¼ˆä»¥ä¸‹ç®€ç§°ï¼šHMR æ¨¡å—çƒ­æ›¿æ¢ï¼‰æ˜¯ Webpack æä¾›çš„ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„åŠŸèƒ½ï¼Œå®ƒå…è®¸åœ¨ JavaScript è¿è¡Œæ—¶æ›´æ–°å„ç§æ¨¡å—ï¼Œè€Œæ— éœ€å®Œå…¨åˆ·æ–°ã€‚

Hot Mo"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script type="text/javascript" src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js"></script><script type="text/javascript" src="https://hm.baidu.com/hm.js?de7c89214c05d551ef3ec12341cd0b9e"></script><meta name="generator" content="Hexo 5.4.0"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;border-radius:15px;"><h3 title=""><a href="/">pingan8787</a></h3></div></div><ul class="my_tages_ul clearfix"><li class="my_tages_li next pagbuttons"><a class="btn" target="_blank" rel="noopener" href="http://www.pingan8787.com/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/"> å‰ç«¯å¼€å‘</a></li><li class="my_tages_li next pagbuttons"><a class="btn btn" target="_blank" rel="noopener" href="http://www.pingan8787.com/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/"> äººå·¥æ™ºèƒ½</a></li><li class="my_tages_li next pagbuttons"><a class="btn btn" target="_blank" rel="noopener" href="http://www.pingan8787.com/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/"> æ·±åº¦å­¦ä¹ </a></li></ul><ul class="my_icon"><li class="my_icon_li"><a target="_blank" rel="noopener" href="https://github.com/pingan8787" title="github"><img src="http://images.pingan8787.com/assets/icon_26_github.png" alt="github"></a></li><li class="my_icon_li"><a target="_blank" rel="noopener" href="https://www.yuque.com/wangpingan/cute-frontend" title="è¯­é›€"><img src="http://images.pingan8787.com/assets/icon_26_yuque.png" alt="è¯­é›€"></a></li><li class="my_icon_li"><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/cute-javascript" title="çŸ¥ä¹"><img src="http://images.pingan8787.com/icon_zhihu.png" alt="çŸ¥ä¹"></a></li><li class="my_icon_li"><a target="_blank" rel="noopener" href="https://juejin.im/user/586fc337a22b9d0058807d53/posts" title="æ˜é‡‘"><img src="http://images.pingan8787.com/icon_juejin.png" alt="æ˜é‡‘"></a></li><li class="my_icon_li"><a target="_blank" rel="noopener" href="https://segmentfault.com/blog/pingan8787" title="æ€å¦"><img src="http://images.pingan8787.com/icon_sf.png" alt="æ€å¦"></a></li><li class="my_icon_li"><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_36380426" title="CSDN"><img src="http://images.pingan8787.com/icon_csdn.png" alt="CSDN"></a></li><li class="my_icon_li"><a target="_blank" rel="noopener" href="https://www.jianshu.com/u/2ec5d94afd60" title="ç®€ä¹¦"><img src="http://images.pingan8787.com/icon_jianshu.png" alt="ç®€ä¹¦"></a></li></ul><div style="text-align:center;"><wb:follow-button uid="1689651205" type="red_1" style="margin-top:10px;width:67px;height:24px;display: inline-block;"></wb:follow-button></div><ul class="social-links"></ul><div class="footer"><a target="_blank" href="/"><span>åšå®¢ä½œè€…ï¼š</span></a><a href="https://github.com/pingan8787" target="_blank"> pingan8787ï¼ˆleoï¼‰</a><div class="by_farbox"> <a href="https://beian.miit.gov.cn/" target="_blank">å¤‡æ¡ˆç¼–å·ï¼šé—½ICPå¤‡17012095å·-1</a></div></div></div><s></s><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">é¦–é¡µ</a></li><li><a href="/leo">å…³äºLeo</a></li><li><a href="/production">ä½œå“</a></li><li><a href="/Catalog">ç›®å½•</a></li><li><a href="http://js.pingan8787.com" target="_blank">Cute-JavaScript</a></li><li><a href="https://github.com/pingan8787" target="_blank">Github</a></li></div><!--.information//.back_btn
  //li
    //if is_post()
      //a.fa.fa-chevron-left(onclick="window.history.go(-1)") 
    //else
      //a.fa.fa-chevron-left(onclick="window.history.go(-1)",style="display:none;") 
//.avatar
//  img(src= url_for('images/logo@2x.png'))--></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>207-ã€Webpackã€‘äº†ä¸èµ·çš„ Webpack HMR å­¦ä¹ æŒ‡å—ï¼ˆå«æºç åˆ†æï¼‰</a></h3></div><div class="post-content"><p>å­¦ä¹ æ—¶é—´ï¼š2020.06.14<br />å­¦ä¹ ç« èŠ‚ï¼š<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/30669007">ã€ŠWebpack HMR åŸç†è§£æã€‹</a><br /><img src="http://images.pingan8787.com/Webpack-HMR/Webpack-HMR-Xmind.png" alt="äº†ä¸èµ·çš„ Webpack HMR å­¦ä¹ æŒ‡å—.png"></p>
<h1 id="ä¸€ã€HMR-ä»‹ç»"><a href="#ä¸€ã€HMR-ä»‹ç»" class="headerlink" title="ä¸€ã€HMR ä»‹ç»"></a>ä¸€ã€HMR ä»‹ç»</h1><p>Hot Module Replacementï¼ˆä»¥ä¸‹ç®€ç§°ï¼šHMR æ¨¡å—çƒ­æ›¿æ¢ï¼‰æ˜¯ Webpack æä¾›çš„ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„åŠŸèƒ½ï¼Œ<strong>å®ƒå…è®¸åœ¨ JavaScript è¿è¡Œæ—¶æ›´æ–°å„ç§æ¨¡å—ï¼Œè€Œæ— éœ€å®Œå…¨åˆ·æ–°</strong>ã€‚</p>
<blockquote>
<p>Hot Module Replacement (or HMR) is one of the most useful features offered by webpack. It allows all kinds of modules to be updated at runtime without the need for a full refresh.<br>â€“ã€ŠHot Module Replacementã€‹</p>
</blockquote>
<p>å½“æˆ‘ä»¬ä¿®æ”¹ä»£ç å¹¶ä¿å­˜åï¼ŒWebpack å°†å¯¹ä»£ç é‡æ–°æ‰“åŒ…ï¼ŒHMR ä¼šåœ¨åº”ç”¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­æ›¿æ¢ã€æ·»åŠ æˆ–åˆ é™¤æ¨¡å—ï¼Œè€Œæ— éœ€é‡æ–°åŠ è½½æ•´ä¸ªé¡µé¢ã€‚<br />HMR ä¸»è¦é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼Œæ¥æ˜¾è‘—åŠ å¿«å¼€å‘é€Ÿåº¦ï¼š</p>
<ul>
<li>ä¿ç•™åœ¨å®Œå…¨é‡æ–°åŠ è½½é¡µé¢æ—¶ä¸¢å¤±çš„åº”ç”¨ç¨‹åºçŠ¶æ€ï¼›</li>
<li>åªæ›´æ–°å˜æ›´å†…å®¹ï¼Œä»¥èŠ‚çœå®è´µçš„å¼€å‘æ—¶é—´ï¼›</li>
<li>è°ƒæ•´æ ·å¼æ›´åŠ å¿«é€Ÿ - å‡ ä¹ç›¸å½“äºåœ¨æµè§ˆå™¨è°ƒè¯•å™¨ä¸­æ›´æ”¹æ ·å¼ã€‚</li>
</ul>
<p><strong>éœ€è¦æ³¨æ„</strong>ï¼šHMR ä¸é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œè¿™æ„å‘³ç€å®ƒåº”å½“åªåœ¨å¼€å‘ç¯å¢ƒä½¿ç”¨ã€‚<br /></p>
<h1 id="äºŒã€HMR-ä½¿ç”¨æ–¹å¼"><a href="#äºŒã€HMR-ä½¿ç”¨æ–¹å¼" class="headerlink" title="äºŒã€HMR ä½¿ç”¨æ–¹å¼"></a>äºŒã€HMR ä½¿ç”¨æ–¹å¼</h1><p>åœ¨ Webpack ä¸­å¯ç”¨ HMR åŠŸèƒ½æ¯”è¾ƒç®€å•ï¼š</p>
<h2 id="1-æ–¹å¼ä¸€ï¼šä½¿ç”¨-devServer"><a href="#1-æ–¹å¼ä¸€ï¼šä½¿ç”¨-devServer" class="headerlink" title="1. æ–¹å¼ä¸€ï¼šä½¿ç”¨ devServer"></a>1. æ–¹å¼ä¸€ï¼šä½¿ç”¨ devServer</h2><h3 id="1-1-è®¾ç½®-devServer-é€‰é¡¹"><a href="#1-1-è®¾ç½®-devServer-é€‰é¡¹" class="headerlink" title="1.1 è®¾ç½® devServer é€‰é¡¹"></a>1.1 è®¾ç½® devServer é€‰é¡¹</h3><p>åªéœ€è¦åœ¨ <code>webpack.config.js</code>Â ä¸­æ·»åŠ  <code>devServer</code>Â é€‰é¡¹ï¼Œå¹¶è®¾ç½® <code>hot</code>Â å€¼ä¸º <code>true</code>Â ï¼Œå¹¶ä½¿ç”¨<code>HotModuleReplacementPlugin</code>Â å’Œ <code>NamedModulesPlugin</code> ï¼ˆå¯é€‰ï¼‰ä¸¤ä¸ª Plugins ï¼š</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// webpack.config.js</span><br><span class="line"></span><br><span class="line">const path = require(&#x27;path&#x27;)</span><br><span class="line">const webpack = require(&#x27;webpack&#x27;)</span><br><span class="line">module.exports = &#123;</span><br><span class="line">	entry: &#x27;./index.js&#x27;,</span><br><span class="line">	output: &#123;</span><br><span class="line">		filename: &#x27;bundle.js&#x27;,</span><br><span class="line">		path: path.join(__dirname, &#x27;/&#x27;)</span><br><span class="line">	&#125;,</span><br><span class="line"><span class="addition">+	devServer: &#123;</span></span><br><span class="line"><span class="addition">+		hot: true,   // å¯åŠ¨æ¨¡å—çƒ­æ›´æ–° HMR</span></span><br><span class="line"><span class="addition">+   open: true,  // å¼€å¯è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨é¡µé¢</span></span><br><span class="line"><span class="addition">+	&#125;,</span></span><br><span class="line">  plugins: [</span><br><span class="line"><span class="addition">+   new webpack.NamedModulesPlugin(),</span></span><br><span class="line"><span class="addition">+   new webpack.HotModuleReplacementPlugin()</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-2-æ·»åŠ -scripts"><a href="#1-2-æ·»åŠ -scripts" class="headerlink" title="1.2 æ·»åŠ  scripts"></a>1.2 æ·»åŠ  scripts</h3><p>ç„¶ååœ¨ <code>package.json</code>Â ä¸­ä¸º <code>scripts</code>Â å‘½ä»¤å³å¯ï¼š</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// package.json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  // ...</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line"><span class="addition">+    &quot;start&quot;: &quot;webpack-dev-server&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-æ–¹å¼äºŒã€ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°"><a href="#2-æ–¹å¼äºŒã€ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°" class="headerlink" title="2. æ–¹å¼äºŒã€ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°"></a>2. æ–¹å¼äºŒã€ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°</h2><p>å¦ä¸€ç§æ˜¯é€šè¿‡æ·»åŠ  <code>--hot</code>Â å‚æ•°æ¥å®ç°ã€‚æ·»åŠ  <code>--hot</code>Â å‚æ•°åï¼ŒdevServer ä¼šå‘Šè¯‰ Webpack è‡ªåŠ¨å¼•å…¥ <code>HotModuleReplacementPlugin</code> ï¼Œè€Œä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å¼•å…¥ã€‚<br />å¦å¤–å¸¸å¸¸ä¹Ÿæ­é… <code>--open</code>Â æ¥è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨åˆ°é¡µé¢ã€‚<br />è¿™é‡Œç§»é™¤æ‰å‰é¢æ·»åŠ çš„ä¸¤ä¸ª Plugins ï¼š</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// webpack.config.js</span><br><span class="line"></span><br><span class="line">const path = require(&#x27;path&#x27;)</span><br><span class="line">const webpack = require(&#x27;webpack&#x27;)</span><br><span class="line">module.exports = &#123;</span><br><span class="line">	// ...</span><br><span class="line"><span class="deletion">- plugins: [</span></span><br><span class="line"><span class="deletion">-   new webpack.NamedModulesPlugin(),</span></span><br><span class="line"><span class="deletion">-   new webpack.HotModuleReplacementPlugin()</span></span><br><span class="line"><span class="deletion">- ]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åä¿®æ”¹ <code>package.json</code>Â æ–‡ä»¶ä¸­çš„ <code>scripts</code>Â é…ç½®ï¼š</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// package.json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  // ...</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line"><span class="deletion">-    &quot;start&quot;: &quot;webpack-dev-server&quot;</span></span><br><span class="line"><span class="addition">+    &quot;start&quot;: &quot;webpack-dev-server --hot --open&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-ç®€å•ç¤ºä¾‹"><a href="#3-ç®€å•ç¤ºä¾‹" class="headerlink" title="3. ç®€å•ç¤ºä¾‹"></a>3. ç®€å•ç¤ºä¾‹</h2><p>åŸºäºä¸Šè¿°é…ç½®ï¼Œæˆ‘ä»¬ç®€å•å®ç°ä¸€ä¸ªåœºæ™¯ï¼š <code>index.js</code>Â æ–‡ä»¶ä¸­å¯¼å…¥ <code>hello.js</code>Â æ¨¡å—ï¼Œå½“ <code>hello.js</code>Â æ¨¡å—å‘ç”Ÿå˜åŒ–æ—¶ï¼Œ <code>index.js</code>Â å°†æ›´æ–°æ¨¡å—ã€‚<br><br />æ¨¡å—ä»£ç å¦‚ä¸‹å®ç°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hello.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; <span class="string">&#x27;hi leo!&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> hello <span class="keyword">from</span> <span class="string">&#x27;./hello.js&#x27;</span></span><br><span class="line"><span class="keyword">const</span> div = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">div.innerHTML = hello();</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.body.appendChild(div);</span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨ <code>index.html</code>Â ä¸­å¯¼å…¥æ‰“åŒ…åçš„ JS æ–‡ä»¶ï¼Œå¹¶æ‰§è¡Œ <code>npm start</code>Â è¿è¡Œé¡¹ç›®ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span>&gt;</span>äº†ä¸èµ·çš„ Webpack HMR å­¦ä¹ æŒ‡å—<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;bundle.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="4-å®ç°ç›‘å¬æ›´æ–°"><a href="#4-å®ç°ç›‘å¬æ›´æ–°" class="headerlink" title="4. å®ç°ç›‘å¬æ›´æ–°"></a>4. å®ç°ç›‘å¬æ›´æ–°</h2><p>å½“æˆ‘ä»¬é€šè¿‡ <code>HotModuleReplacementPlugin</code>Â  æ’ä»¶å¯ç”¨äº† HMRï¼Œåˆ™å®ƒçš„æ¥å£å°†è¢«æš´éœ²åœ¨å…¨å±€ <code>module.hot</code>Â  å±æ€§ä¸‹é¢ã€‚é€šå¸¸ï¼Œå¯ä»¥å…ˆæ£€æŸ¥è¿™ä¸ªæ¥å£æ˜¯å¦å¯è®¿é—®ï¼Œç„¶åå†å¼€å§‹ä½¿ç”¨å®ƒã€‚<br />ä¸¾ä¸ªä¾‹å­ï¼Œä½ å¯ä»¥è¿™æ · <code>accept</code>Â  ä¸€ä¸ªæ›´æ–°çš„æ¨¡å—ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">  <span class="built_in">module</span>.hot.accept(<span class="string">&#x27;./library.js&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨æ›´æ–°è¿‡çš„ library æ¨¡å—æ‰§è¡ŒæŸäº›æ“ä½œ...</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…³äº <code>module.hot</code>Â æ›´å¤š API ï¼Œå¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£<a target="_blank" rel="noopener" href="https://webpack.js.org/api/hot-module-replacement/">ã€ŠHot Module Replacement APIã€‹</a>Â ã€‚<br><br />å›åˆ°ä¸Šé¢ç¤ºä¾‹ï¼Œæˆ‘ä»¬æµ‹è¯•æ›´æ–°æ¨¡å—çš„åŠŸèƒ½ã€‚<br />è¿™æ—¶æˆ‘ä»¬ä¿®æ”¹ <code>index.js</code>Â ä»£ç ï¼Œæ¥ç›‘å¬ <code>hello.js</code>Â æ¨¡å—ä¸­çš„æ›´æ–°ï¼š</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import hello from &#x27;./hello.js&#x27;;</span><br><span class="line">const div = document.createElement(&#x27;div&#x27;);</span><br><span class="line">div.innerHTML = hello();</span><br><span class="line">document.body.appendChild(div);</span><br><span class="line"></span><br><span class="line"><span class="addition">+ if (module.hot) &#123;</span></span><br><span class="line"><span class="addition">+   module.hot.accept(&#x27;./hello.js&#x27;, function() &#123;</span></span><br><span class="line"><span class="addition">+     console.log(&#x27;ç°åœ¨åœ¨æ›´æ–° hello æ¨¡å—äº†~&#x27;);</span></span><br><span class="line"><span class="addition">+     div.innerHTML = hello();</span></span><br><span class="line"><span class="addition">+   &#125;)</span></span><br><span class="line"><span class="addition">+ &#125;</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åä¿®æ”¹ <code>hello.js</code>Â æ–‡ä»¶å†…å®¹ï¼Œæµ‹è¯•æ•ˆæœï¼š</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">- export default () =&gt; &#x27;hi leo!&#x27;;</span></span><br><span class="line"><span class="addition">+ export default () =&gt; &#x27;hi leo! hello world&#x27;;</span></span><br></pre></td></tr></table></figure>
<p>å½“æˆ‘ä»¬ä¿å­˜ä»£ç æ—¶ï¼Œæ§åˆ¶å°è¾“å‡º <code>&quot;ç°åœ¨åœ¨æ›´æ–° helloæ¨¡å—äº†~&quot;</code>Â ï¼Œå¹¶ä¸”é¡µé¢ä¸­ <code>&quot;hi leo!&quot;</code>Â ä¹Ÿæ›´æ–°ä¸º <code>&quot;hi leo! hello world&quot;</code>Â ï¼Œè¯æ˜æˆ‘ä»¬ç›‘å¬åˆ°æ–‡ä»¶æ›´æ–°äº†ã€‚<br /><img src="http://images.pingan8787.com/Webpack-HMR/Webpack-HMR-demo1.png" alt="image.png"><br /><br><br />ç®€å• Webpack HMR ä½¿ç”¨æ–¹å¼å°±ä»‹ç»åˆ°è¿™ï¼Œæ›´å¤šä»‹ç»ï¼Œè¿˜è¯·é˜…è¯»å®˜æ–¹æ–‡æ¡£<a target="_blank" rel="noopener" href="https://webpack.js.org/guides/hot-module-replacement/">ã€ŠHot Module Replacementã€‹</a>ã€‚<br /></p>
<h2 id="5-devServer-å¸¸ç”¨é…ç½®å’ŒæŠ€å·§"><a href="#5-devServer-å¸¸ç”¨é…ç½®å’ŒæŠ€å·§" class="headerlink" title="5. devServer å¸¸ç”¨é…ç½®å’ŒæŠ€å·§"></a>5. devServer å¸¸ç”¨é…ç½®å’ŒæŠ€å·§</h2><h3 id="5-1-å¸¸ç”¨é…ç½®"><a href="#5-1-å¸¸ç”¨é…ç½®" class="headerlink" title="5.1 å¸¸ç”¨é…ç½®"></a>5.1 å¸¸ç”¨é…ç½®</h3><p>æ ¹æ®ç›®å½•ç»“æ„çš„ä¸åŒï¼Œ<code>contentBase</code>ã€<code>openPage</code> å‚æ•°è¦é…ç½®åˆé€‚çš„å€¼ï¼Œå¦åˆ™è¿è¡Œæ—¶åº”è¯¥ä¸ä¼šç«‹åˆ»è®¿é—®åˆ°ä½ çš„é¦–é¡µã€‚ åŒæ—¶è¦æ³¨æ„ä½ çš„ <code>publicPath</code>ï¼Œé™æ€èµ„æºæ‰“åŒ…åç”Ÿæˆçš„è·¯å¾„æ˜¯ä¸€ä¸ªéœ€è¦æ€è€ƒçš„ç‚¹ï¼Œå–å†³äºä½ çš„ç›®å½•ç»“æ„ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">devServer: &#123;</span><br><span class="line">  <span class="attr">contentBase</span>: path.join(__dirname, <span class="string">&#x27;static&#x27;</span>),    <span class="comment">// å‘Šè¯‰æœåŠ¡å™¨ä»å“ªé‡Œæä¾›å†…å®¹(é»˜è®¤å½“å‰å·¥ä½œç›®å½•)</span></span><br><span class="line">  <span class="attr">openPage</span>: <span class="string">&#x27;views/index.html&#x27;</span>,  <span class="comment">// æŒ‡å®šé»˜è®¤å¯åŠ¨æµè§ˆå™¨æ—¶æ‰“å¼€çš„é¡µé¢</span></span><br><span class="line">  <span class="attr">index</span>: <span class="string">&#x27;views/index.html&#x27;</span>,  <span class="comment">// æŒ‡å®šé¦–é¡µä½ç½®</span></span><br><span class="line">  <span class="attr">watchContentBase</span>: <span class="literal">true</span>, <span class="comment">// contentBaseä¸‹æ–‡ä»¶å˜åŠ¨å°†reloadé¡µé¢(é»˜è®¤false)</span></span><br><span class="line">  <span class="attr">host</span>: <span class="string">&#x27;localhost&#x27;</span>, <span class="comment">// é»˜è®¤localhost,æƒ³å¤–éƒ¨å¯è®¿é—®ç”¨&#x27;0.0.0.0&#x27;</span></span><br><span class="line">  <span class="attr">port</span>: <span class="number">8080</span>, <span class="comment">// é»˜è®¤8080</span></span><br><span class="line">  <span class="attr">inline</span>: <span class="literal">true</span>, <span class="comment">// å¯ä»¥ç›‘æ§jså˜åŒ–</span></span><br><span class="line">  <span class="attr">hot</span>: <span class="literal">true</span>, <span class="comment">// çƒ­å¯åŠ¨</span></span><br><span class="line">  <span class="attr">open</span>: <span class="literal">true</span>, <span class="comment">// å¯åŠ¨æ—¶è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ï¼ˆæŒ‡å®šæ‰“å¼€chromeï¼Œopen: &#x27;Google Chrome&#x27;ï¼‰</span></span><br><span class="line">  <span class="attr">compress</span>: <span class="literal">true</span>, <span class="comment">// ä¸€åˆ‡æœåŠ¡éƒ½å¯ç”¨gzip å‹ç¼©</span></span><br><span class="line">  <span class="attr">disableHostCheck</span>: <span class="literal">true</span>, <span class="comment">// trueï¼šä¸è¿›è¡Œhostæ£€æŸ¥</span></span><br><span class="line">  <span class="attr">quiet</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">https</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">clientLogLevel</span>: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">  <span class="attr">stats</span>: &#123; <span class="comment">// è®¾ç½®æ§åˆ¶å°çš„æç¤ºä¿¡æ¯</span></span><br><span class="line">    <span class="attr">chunks</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">children</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">modules</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">entrypoints</span>: <span class="literal">false</span>, <span class="comment">// æ˜¯å¦è¾“å‡ºå…¥å£ä¿¡æ¯</span></span><br><span class="line">    <span class="attr">warnings</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">performance</span>: <span class="literal">false</span>, <span class="comment">// æ˜¯å¦è¾“å‡ºwebpackå»ºè®®ï¼ˆå¦‚æ–‡ä»¶ä½“ç§¯å¤§å°ï¼‰</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">historyApiFallback</span>: &#123;</span><br><span class="line">    <span class="attr">disableDotRule</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">watchOptions</span>: &#123;</span><br><span class="line">    <span class="attr">ignored</span>: <span class="regexp">/node_modules/</span>, <span class="comment">// ç•¥è¿‡node_modulesç›®å½•</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">proxy</span>: &#123; <span class="comment">// æ¥å£ä»£ç†ï¼ˆè¿™æ®µé…ç½®æ›´æ¨èï¼šå†™åˆ°package.jsonï¼Œå†å¼•å…¥åˆ°è¿™é‡Œï¼‰</span></span><br><span class="line">    <span class="string">&quot;/api-dev&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;target&quot;</span>: <span class="string">&quot;http://api.test.xxx.com&quot;</span>,</span><br><span class="line">      <span class="string">&quot;secure&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;changeOrigin&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;pathRewrite&quot;</span>: &#123; <span class="comment">// å°†urlä¸Šçš„æŸæ®µé‡å†™ï¼ˆä¾‹å¦‚æ­¤å¤„æ˜¯å°† api-dev æ›¿æ¢æˆäº†ç©ºï¼‰</span></span><br><span class="line">        <span class="string">&quot;^/api-dev&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">before</span>(<span class="params">app</span>)</span> &#123; &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-2-æŠ€å·§1ï¼šæ–‡ä»¶å½¢å¼è¾“å‡º-dev-server-ä»£ç "><a href="#5-2-æŠ€å·§1ï¼šæ–‡ä»¶å½¢å¼è¾“å‡º-dev-server-ä»£ç " class="headerlink" title="5.2 æŠ€å·§1ï¼šæ–‡ä»¶å½¢å¼è¾“å‡º dev-server ä»£ç "></a>5.2 æŠ€å·§1ï¼šæ–‡ä»¶å½¢å¼è¾“å‡º dev-server ä»£ç </h3><p>dev-server è¾“å‡ºçš„ä»£ç é€šå¸¸åœ¨å†…å­˜ä¸­ï¼Œä½†ä¹Ÿå¯ä»¥å†™å…¥ç¡¬ç›˜ï¼Œäº§å‡ºå®ä½“æ–‡ä»¶ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">devServer:&#123;</span><br><span class="line">  <span class="attr">writeToDisk</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šå¸¸å¯ä»¥ç”¨äºä»£ç†æ˜ å°„æ–‡ä»¶è°ƒè¯•ï¼Œç¼–è¯‘æ—¶ä¼šäº§å‡ºè®¸å¤šå¸¦ hash çš„ js æ–‡ä»¶ï¼Œä¸å¸¦ hash çš„æ–‡ä»¶åŒæ ·ä¹Ÿæ˜¯<strong>å®æ—¶ç¼–è¯‘çš„</strong>ã€‚</p>
<h3 id="5-3-æŠ€å·§2ï¼šé»˜è®¤ä½¿ç”¨æœ¬åœ°-IP-å¯åŠ¨æœåŠ¡"><a href="#5-3-æŠ€å·§2ï¼šé»˜è®¤ä½¿ç”¨æœ¬åœ°-IP-å¯åŠ¨æœåŠ¡" class="headerlink" title="5.3 æŠ€å·§2ï¼šé»˜è®¤ä½¿ç”¨æœ¬åœ° IP å¯åŠ¨æœåŠ¡"></a>5.3 æŠ€å·§2ï¼šé»˜è®¤ä½¿ç”¨æœ¬åœ° IP å¯åŠ¨æœåŠ¡</h3><p>æœ‰çš„æ—¶å€™ï¼Œå¯åŠ¨æœåŠ¡æ—¶ï¼Œæƒ³è¦é»˜è®¤ä½¿ç”¨æœ¬åœ°çš„ ip åœ°å€æ‰“å¼€ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">devServer:&#123;</span><br><span class="line">  <span class="attr">disableHostCheck</span>: <span class="literal">true</span>, <span class="comment">// trueï¼šä¸è¿›è¡Œhostæ£€æŸ¥</span></span><br><span class="line">  <span class="comment">// useLocalIp: true, // å»ºè®®ä¸åœ¨è¿™é‡Œé…ç½®</span></span><br><span class="line">  <span class="comment">// host: &#x27;0.0.0.0&#x27;, // å»ºè®®ä¸åœ¨è¿™é‡Œé…ç½®</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŒæ—¶è¿˜éœ€è¦å°† host é…ç½®ä¸ºÂ <code>0.0.0.0</code>ï¼Œè¿™ä¸ªé…ç½®å»ºè®®åœ¨ scripts å‘½ä»¤ä¸­è¿½åŠ ï¼Œè€Œéåœ¨é…ç½®ä¸­å†™æ­»ï¼Œå¦åˆ™å°†æ¥ä¸æƒ³è¦è¿™ç§æ–¹å¼å¾€å›æ”¹æŠ˜è…¾ï¼Œå–å·§ä¸€ç‚¹ï¼Œé…ä¸ªæ–°å‘½ä»¤ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;dev-ip&quot;</span>: <span class="string">&quot;yarn run dev --host 0.0.0.0 --useLocalIp&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="5-4-æŠ€å·§3ï¼šæŒ‡å®šå¯åŠ¨çš„è°ƒè¯•åŸŸå"><a href="#5-4-æŠ€å·§3ï¼šæŒ‡å®šå¯åŠ¨çš„è°ƒè¯•åŸŸå" class="headerlink" title="5.4 æŠ€å·§3ï¼šæŒ‡å®šå¯åŠ¨çš„è°ƒè¯•åŸŸå"></a>5.4 æŠ€å·§3ï¼šæŒ‡å®šå¯åŠ¨çš„è°ƒè¯•åŸŸå</h3><p>æœ‰æ—¶å¯åŠ¨çš„æ—¶å€™å¸Œæœ›æ˜¯æŒ‡å®šçš„è°ƒè¯•åŸŸåï¼Œä¾‹å¦‚ï¼š<code>local.test.baidu.com</code>ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">devServer:&#123;</span><br><span class="line">  <span class="attr">open</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">public</span>: <span class="string">&#x27;local.test.baidu.com:8080&#x27;</span>, <span class="comment">// éœ€è¦å¸¦ä¸Šç«¯å£</span></span><br><span class="line">  <span class="attr">port</span>: <span class="number">8080</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŒæ—¶éœ€è¦å°†Â <code>127.0.0.1</code>Â ä¿®æ”¹ä¸ºæŒ‡å®šçš„ hostï¼Œå¯ä»¥å€ŸåŠ© iHost ç­‰å·¥å…·å»ä¿®æ”¹ï¼Œå„ä¸ªå·¥å…·å¤§åŒå°å¼‚ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> local.test.baidu.com</span><br></pre></td></tr></table></figure>
<p>æœåŠ¡å¯åŠ¨åå°†è‡ªåŠ¨æ‰“å¼€Â <code>local.test.baidu.com:8080</code>Â è®¿é—®<br /></p>
<h3 id="5-5-æŠ€å·§4ï¼šå¯åŠ¨-gzip-å‹ç¼©"><a href="#5-5-æŠ€å·§4ï¼šå¯åŠ¨-gzip-å‹ç¼©" class="headerlink" title="5.5 æŠ€å·§4ï¼šå¯åŠ¨ gzip å‹ç¼©"></a>5.5 æŠ€å·§4ï¼šå¯åŠ¨ gzip å‹ç¼©</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">devServer:&#123;</span><br><span class="line">  <span class="attr">compress</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="ä¸‰ã€HMR-åŸºæœ¬åŸç†ä»‹ç»"><a href="#ä¸‰ã€HMR-åŸºæœ¬åŸç†ä»‹ç»" class="headerlink" title="ä¸‰ã€HMR åŸºæœ¬åŸç†ä»‹ç»"></a>ä¸‰ã€HMR åŸºæœ¬åŸç†ä»‹ç»</h1><p>ä»å‰é¢ä»‹ç»ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“ï¼šHMR ä¸»è¦åŠŸèƒ½æ˜¯ä¼š<strong>åœ¨åº”ç”¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­æ›¿æ¢ã€æ·»åŠ æˆ–åˆ é™¤æ¨¡å—ï¼Œè€Œæ— éœ€é‡æ–°åŠ è½½æ•´ä¸ªé¡µé¢</strong>ã€‚<br />é‚£ä¹ˆï¼ŒWebpack ç¼–è¯‘æºç æ‰€äº§ç”Ÿçš„æ–‡ä»¶å˜åŒ–åœ¨ç¼–è¯‘æ—¶ï¼Œæ›¿æ¢æ¨¡å—å®ç°åœ¨è¿è¡Œæ—¶ï¼Œä¸¤è€…å¦‚ä½•è”ç³»èµ·æ¥ï¼Ÿ<br /><br><br />å¸¦ç€è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å…ˆç®€å•çœ‹ä¸‹ HMR æ ¸å¿ƒå·¥ä½œæµç¨‹ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š</p>
<p><img src="http://images.pingan8787.com/Webpack-HMR/Webpack-HMR-Simple-Process.png" alt="HMR å·¥ä½œæµç¨‹å›¾.png"></p>
<p>æ¥ä¸‹æ¥å¼€å§‹ HMR å·¥ä½œæµç¨‹åˆ†æï¼š</p>
<ol>
<li>å½“ Webpackï¼ˆWatchmanï¼‰ ç›‘å¬åˆ°é¡¹ç›®ä¸­çš„æ–‡ä»¶/æ¨¡å—ä»£ç å‘ç”Ÿå˜åŒ–åï¼Œå°†å˜åŒ–é€šçŸ¥ Webpack ä¸­çš„æ„å»ºå·¥å…·ï¼ˆPackagerï¼‰å³ HMR Pluginï¼›</li>
<li>ç„¶åç»è¿‡ HMR Plugin å¤„ç†åï¼Œå°†ç»“æœå‘é€åˆ°åº”ç”¨ç¨‹åºï¼ˆApplicationï¼‰çš„è¿è¡Œæ—¶æ¡†æ¶ï¼ˆHMR Runtimeï¼‰ï¼›</li>
<li>æœ€åç”± HMR Runtime å°†è¿™äº›å‘ç”Ÿå˜åŒ–çš„æ–‡ä»¶/æ¨¡å—æ›´æ–°ï¼ˆæ–°å¢/åˆ é™¤æˆ–æ›¿æ¢ï¼‰åˆ°æ¨¡å—ç³»ç»Ÿä¸­ã€‚</li>
</ol>
<p>å…¶ä¸­ï¼ŒHMR Runtime æ˜¯æ„å»ºå·¥å…·åœ¨ç¼–è¯‘æ—¶æ³¨å…¥çš„ï¼Œé€šè¿‡ç»Ÿä¸€çš„ Module ID å°†ç¼–è¯‘æ—¶çš„æ–‡ä»¶ä¸è¿è¡Œæ—¶çš„æ¨¡å—å¯¹åº”èµ·æ¥ï¼Œå¹¶ä¸”å¯¹å¤–æä¾›ä¸€ç³»åˆ— API ä¾›åº”ç”¨å±‚æ¡†æ¶ï¼ˆå¦‚ Reactï¼‰è°ƒç”¨ã€‚</p>
<p>ğŸ’–<strong>æ³¨æ„</strong>ğŸ’–ï¼šå»ºè®®å…ˆç†è§£ä¸Šé¢è¿™å¼ å›¾çš„å¤§è‡´æµç¨‹ï¼Œåœ¨è¿›è¡Œåç»­é˜…è¯»ã€‚æ”¾å¿ƒï¼Œæˆ‘ç­‰ç€å¤§å®¶~<a target="_blank" rel="noopener" href="https://emojipedia.org/people/">ğŸ˜ƒ</a><br /></p>
<h1 id="å››ã€HMR-å®Œæ•´åŸç†å’Œæºç åˆ†æ"><a href="#å››ã€HMR-å®Œæ•´åŸç†å’Œæºç åˆ†æ" class="headerlink" title="å››ã€HMR å®Œæ•´åŸç†å’Œæºç åˆ†æ"></a>å››ã€HMR å®Œæ•´åŸç†å’Œæºç åˆ†æ</h1><p>é€šè¿‡ä¸Šä¸€èŠ‚å†…å®¹ï¼Œæˆ‘ä»¬å¤§æ¦‚çŸ¥é“ HMR ç®€å•å·¥ä½œæµç¨‹ï¼Œé‚£ä¹ˆæˆ–è®¸ä½ ç°åœ¨å¯èƒ½è¿˜æœ‰å¾ˆå¤šç–‘æƒ‘ï¼šæ–‡ä»¶æ›´æ–°æ˜¯ä»€ä¹ˆé€šçŸ¥ HMR Pluginï¼ŸHMR Plugin æ€ä¹ˆå‘é€æ›´æ–°åˆ° HMR Runtimeï¼Ÿç­‰ç­‰é—®é¢˜ã€‚</p>
<p>é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹è¯¦ç»†ç»“åˆæºç åˆ†ææ•´ä¸ª HMR æ¨¡å—çƒ­æ›´æ–°æµç¨‹ï¼Œé¦–å…ˆè¿˜æ˜¯å…ˆçœ‹æµç¨‹å›¾ï¼Œå¯ä»¥å…ˆä¸äº†è§£å›¾ä¸­æ–¹æ³•åç§°ï¼ˆçº¢è‰²å­—ä½“é»„è‰²èƒŒæ™¯è‰²éƒ¨åˆ†ï¼‰ï¼š</p>
<p><img src="http://images.pingan8787.com/Webpack-HMR/Webpack-HMR-Source-Process.png" alt="Webpack HMR.png"></p>
<p>ä¸Šå›¾å±•ç¤ºäº†ä»æˆ‘ä»¬ä¿®æ”¹ä»£ç ï¼Œåˆ°æ¨¡å—çƒ­æ›´æ–°å®Œæˆçš„ä¸€ä¸ª HMR å®Œæ•´å·¥ä½œæµç¨‹ï¼Œå›¾ä¸­å·²ç”¨çº¢è‰²é˜¿æ‹‰ä¼¯æ•°å­—ç¬¦å·å°†æµç¨‹æ ‡è¯†å‡ºæ¥ã€‚</p>
<p>è¦äº†è§£ä¸Šé¢å·¥ä½œåŸç†ï¼Œæˆ‘ä»¬å…ˆç†è§£å›¾ä¸­è¿™å‡ ä¸ªåç§°æ¦‚å¿µï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/webpack/webpack-dev-server"><strong>Webpack-dev-server</strong></a>Â ï¼šä¸€ä¸ªæœåŠ¡å™¨æ’ä»¶ï¼Œç›¸å½“äº express æœåŠ¡å™¨ï¼Œå¯åŠ¨ä¸€ä¸ª Web æœåŠ¡ï¼Œåªé€‚ç”¨äºå¼€å‘ç¯å¢ƒï¼›</li>
<li><a target="_blank" rel="noopener" href="https://github.com/webpack/webpack-dev-middleware"><strong>Webpack-dev-middleware</strong></a>Â ï¼šä¸€ä¸ª <strong>Webpack-dev-server</strong> çš„ä¸­é—´ä»¶ï¼Œä½œç”¨ç®€å•æ€»ç»“ä¸ºï¼šé€šè¿‡watch modeï¼Œç›‘å¬èµ„æºçš„å˜æ›´ï¼Œç„¶åè‡ªåŠ¨æ‰“åŒ…ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://github.com/webpack-contrib/webpack-hot-middleware"><strong>Webpack-hot-middleware</strong></a>Â ï¼šç»“åˆ Webpack-dev-middleware ä½¿ç”¨çš„ä¸­é—´ä»¶ï¼Œå®ƒå¯ä»¥å®ç°æµè§ˆå™¨çš„æ— åˆ·æ–°æ›´æ–°ï¼Œä¹Ÿå°±æ˜¯ HMRï¼›</li>
</ul>
<p><img src="http://images.pingan8787.com/Webpack-HMR/face1.gif"></p>
<p>ä¸‹é¢ä¸€èµ·å­¦ä¹  HMR æ•´ä¸ªå·¥ä½œåŸç†å§ï¼š</p>
<h2 id="1-ç›‘æ§ä»£ç å˜åŒ–ï¼Œé‡æ–°ç¼–è¯‘æ‰“åŒ…"><a href="#1-ç›‘æ§ä»£ç å˜åŒ–ï¼Œé‡æ–°ç¼–è¯‘æ‰“åŒ…" class="headerlink" title="1.ç›‘æ§ä»£ç å˜åŒ–ï¼Œé‡æ–°ç¼–è¯‘æ‰“åŒ…"></a>1.ç›‘æ§ä»£ç å˜åŒ–ï¼Œé‡æ–°ç¼–è¯‘æ‰“åŒ…</h2><p>é¦–å…ˆæ ¹æ® devServer é…ç½®ï¼Œä½¿ç”¨ <code>npm start</code> å°†å¯åŠ¨ Webpack-dev-server å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨å¹¶è¿›å…¥ Webpack çš„ watch æ¨¡å¼ï¼Œç„¶ååˆå§‹åŒ– Webpack-dev-middleware ï¼Œåœ¨ Webpack-dev-middleware ä¸­é€šè¿‡è°ƒç”¨ <code>startWatch()</code>Â æ–¹æ³•å¯¹æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œ watchï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack-dev-server\bin\webpack-dev-server.js</span></span><br><span class="line"><span class="comment">// 1.å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨ Line 386</span></span><br><span class="line">server = <span class="keyword">new</span> Server(compiler, options);</span><br><span class="line"></span><br><span class="line"><span class="comment">// webpack-dev-server\lib\Server.js</span></span><br><span class="line"><span class="comment">// 2.åˆå§‹åŒ– Webpack-dev-middleware Line 109</span></span><br><span class="line"><span class="built_in">this</span>.middleware = webpackDevMiddleware(compiler, <span class="built_in">Object</span>.assign(&#123;&#125;, options, wdmOptions));</span><br><span class="line"></span><br><span class="line"><span class="comment">// webpack-dev-middleware\lib\Shared.js</span></span><br><span class="line"><span class="comment">// 3.å¼€å§‹ watch æ–‡ä»¶ç³»ç»Ÿ Line 171</span></span><br><span class="line">startWatch: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="comment">//...</span></span><br><span class="line">	<span class="comment">// start watching</span></span><br><span class="line">	<span class="keyword">if</span>(!options.lazy) &#123;</span><br><span class="line">		<span class="keyword">var</span> watching = compiler.watch(options.watchOptions, share.handleCompilerCallback);</span><br><span class="line">		context.watching = watching;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line">share.startWatch();</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>
<p>å½“ <code>startWatch()</code> æ–¹æ³•æ‰§è¡Œåï¼Œä¾¿è¿›å…¥ watch æ¨¡å¼ï¼Œè‹¥å‘ç°æ–‡ä»¶ä¸­ä»£ç å‘ç”Ÿä¿®æ”¹ï¼Œåˆ™æ ¹æ®é…ç½®æ–‡ä»¶<strong>å¯¹æ¨¡å—é‡æ–°ç¼–è¯‘æ‰“åŒ…</strong>ã€‚</p>
<h2 id="2-ä¿å­˜ç¼–è¯‘ç»“æœ"><a href="#2-ä¿å­˜ç¼–è¯‘ç»“æœ" class="headerlink" title="2.ä¿å­˜ç¼–è¯‘ç»“æœ"></a>2.ä¿å­˜ç¼–è¯‘ç»“æœ</h2><p>Webpack ä¸  Webpack-dev-middleware äº¤äº’ï¼ŒWebpack-dev-middleware è°ƒç”¨ Webpack çš„ API å¯¹ä»£ç å˜åŒ–è¿›è¡Œç›‘æ§ï¼Œå¹¶é€šçŸ¥ Webpack å°†é‡æ–°ç¼–è¯‘çš„ä»£ç é€šè¿‡ JavaScript å¯¹è±¡<strong>ä¿å­˜åœ¨å†…å­˜ä¸­</strong>ã€‚</p>
<p>æˆ‘ä»¬ä¼šå‘ç°ï¼Œåœ¨ <code>output.path</code> æŒ‡å®šçš„ <code>dist</code>Â ç›®å½•å¹¶æ²¡æœ‰ä¿å­˜ç¼–è¯‘ç»“æœçš„æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ</p>
<p>å…¶å®ï¼Œ Webpack å°†ç¼–è¯‘ç»“æœä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå› ä¸º<strong>è®¿é—®å†…å­˜ä¸­çš„ä»£ç æ¯”è®¿é—®æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶å¿«</strong>ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ä»£ç å†™å…¥æ–‡ä»¶çš„å¼€é”€ã€‚</p>
<p>Webpack èƒ½å°†ä»£ç ä¿å­˜åˆ°å†…å­˜ä¸­ï¼Œéœ€è¦å½’åŠŸäº Webpack-dev-middleware çš„ <code>memory-fs</code> ä¾èµ–åº“ï¼Œå®ƒå°†åŸæœ¬ <code>outputFileSystem</code>Â  æ›¿æ¢æˆäº† <code>MemoryFileSystem</code>Â  çš„å®ä¾‹ï¼Œä¾¿å®ç°ä»£ç è¾“å‡ºåˆ°å†…å­˜ä¸­ã€‚å…¶ä¸­éƒ¨åˆ†æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack-dev-middleware\lib\Shared.js Line 108</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// store our files in memory</span></span><br><span class="line"><span class="keyword">var</span> fs;</span><br><span class="line"><span class="keyword">var</span> isMemoryFs = !compiler.compilers &amp;&amp; </span><br><span class="line">    compiler.outputFileSystem <span class="keyword">instanceof</span> MemoryFileSystem;</span><br><span class="line"><span class="keyword">if</span>(isMemoryFs) &#123;</span><br><span class="line">	fs = compiler.outputFileSystem;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	fs = compiler.outputFileSystem = <span class="keyword">new</span> MemoryFileSystem();</span><br><span class="line">&#125;</span><br><span class="line">context.fs = fs;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä»£ç å…ˆåˆ¤æ–­ <code>fileSystem</code> æ˜¯å¦æ˜¯ <code>MemoryFileSystem</code> çš„å®ä¾‹ï¼Œè‹¥ä¸æ˜¯ï¼Œåˆ™ç”¨ <code>MemoryFileSystem</code> çš„å®ä¾‹æ›¿æ¢ compiler ä¹‹å‰çš„ <code>outputFileSystem</code>ã€‚è¿™æ · bundle.js æ–‡ä»¶ä»£ç å°±ä½œä¸ºä¸€ä¸ªç®€å• JavaScript å¯¹è±¡ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå½“æµè§ˆå™¨è¯·æ±‚ bundle.js æ–‡ä»¶æ—¶ï¼ŒdevServer å°±ç›´æ¥å»å†…å­˜ä¸­æ‰¾åˆ°ä¸Šé¢ä¿å­˜çš„ JavaScript å¯¹è±¡å¹¶è¿”å›ç»™æµè§ˆå™¨ç«¯ã€‚</p>
<h2 id="3-ç›‘æ§æ–‡ä»¶å˜åŒ–ï¼Œåˆ·æ–°æµè§ˆå™¨"><a href="#3-ç›‘æ§æ–‡ä»¶å˜åŒ–ï¼Œåˆ·æ–°æµè§ˆå™¨" class="headerlink" title="3.ç›‘æ§æ–‡ä»¶å˜åŒ–ï¼Œåˆ·æ–°æµè§ˆå™¨"></a>3.ç›‘æ§æ–‡ä»¶å˜åŒ–ï¼Œåˆ·æ–°æµè§ˆå™¨</h2><p>Webpack-dev-server å¼€å§‹ç›‘æ§æ–‡ä»¶å˜åŒ–ï¼Œä¸ç¬¬ 1 æ­¥ä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œå¹¶ä¸æ˜¯ç›‘æ§ä»£ç å˜åŒ–é‡æ–°ç¼–è¯‘æ‰“åŒ…ã€‚<br />å½“æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®äº† <a target="_blank" rel="noopener" href="https://webpack.js.org/configuration/dev-server/#devserver-watchcontentbase"><code>devServer.watchContentBase</code></a>Â ä¸º <code>true</code>Â ï¼ŒWebpack-dev-server ä¼šç›‘å¬é…ç½®æ–‡ä»¶å¤¹ä¸­é™æ€æ–‡ä»¶çš„å˜åŒ–ï¼Œå‘ç”Ÿå˜åŒ–æ—¶ï¼Œé€šçŸ¥æµè§ˆå™¨ç«¯å¯¹åº”ç”¨è¿›è¡Œ<strong>æµè§ˆå™¨åˆ·æ–°</strong>ï¼Œè¿™ä¸ HMR ä¸ä¸€æ ·ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack-dev-server\lib\Server.js</span></span><br><span class="line"><span class="comment">// 1. è¯»å–å‚æ•° Line 385</span></span><br><span class="line"><span class="keyword">if</span> (options.watchContentBase) &#123; defaultFeatures.push(<span class="string">&#x27;watchContentBase&#x27;</span>); &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. å®šä¹‰ _watch æ–¹æ³• Line 697</span></span><br><span class="line">Server.prototype._watch = <span class="function"><span class="keyword">function</span> (<span class="params">watchPath</span>) </span>&#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">const</span> watcher = chokidar.watch(watchPath, options).on(<span class="string">&#x27;change&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.sockWrite(<span class="built_in">this</span>.sockets, <span class="string">&#x27;content-changed&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">this</span>.contentBaseWatchers.push(watcher);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. æ‰§è¡Œ _watch() ç›‘å¬æ–‡ä»¶å˜åŒ– Line 339</span></span><br><span class="line">watchContentBase: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/^(https?:)?\/\//</span>.test(contentBase) || <span class="keyword">typeof</span> contentBase === <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;Watching remote files is not supported.&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(contentBase)) &#123;</span><br><span class="line">        contentBase.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>._watch(item);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>._watch(contentBase);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-å»ºç«‹-WSï¼ŒåŒæ­¥ç¼–è¯‘é˜¶æ®µçŠ¶æ€"><a href="#4-å»ºç«‹-WSï¼ŒåŒæ­¥ç¼–è¯‘é˜¶æ®µçŠ¶æ€" class="headerlink" title="4.å»ºç«‹ WSï¼ŒåŒæ­¥ç¼–è¯‘é˜¶æ®µçŠ¶æ€"></a>4.å»ºç«‹ WSï¼ŒåŒæ­¥ç¼–è¯‘é˜¶æ®µçŠ¶æ€</h2><p>è¿™ä¸€æ­¥éƒ½æ˜¯ Webpack-dev-server ä¸­å¤„ç†ï¼Œä¸»è¦é€šè¿‡ <a target="_blank" rel="noopener" href="https://github.com/sockjs/sockjs-client">sockjs</a>ï¼ˆWebpack-dev-server çš„ä¾èµ–ï¼‰ï¼Œåœ¨ Webpack-dev-server çš„æµè§ˆå™¨ç«¯ï¼ˆClientï¼‰å’ŒæœåŠ¡å™¨ç«¯ï¼ˆWebpack-dev-middlewareï¼‰ä¹‹é—´<strong>å»ºç«‹ WebSocket é•¿è¿æ¥</strong>ã€‚</p>
<p>ç„¶åå°† Webpack ç¼–è¯‘æ‰“åŒ…çš„å„ä¸ªé˜¶æ®µçŠ¶æ€ä¿¡æ¯åŒæ­¥åˆ°æµè§ˆå™¨ç«¯ã€‚å…¶ä¸­æœ‰ä¸¤ä¸ªé‡è¦æ­¥éª¤ï¼š</p>
<ul>
<li>å‘é€çŠ¶æ€</li>
</ul>
<p>Webpack-dev-server é€šè¿‡ Webpack API ç›‘å¬ compile çš„ <code>done</code>Â äº‹ä»¶ï¼Œå½“ compile å®Œæˆåï¼ŒWebpack-dev-server é€šè¿‡ <code>_sendStats</code>Â æ–¹æ³•å°†ç¼–è¯‘åæ–°æ¨¡å—çš„ hash å€¼ç”¨ socket å‘é€ç»™æµè§ˆå™¨ç«¯ã€‚</p>
<ul>
<li>ä¿å­˜çŠ¶æ€</li>
</ul>
<p>æµè§ˆå™¨ç«¯å°†<code>_sendStats</code> å‘é€è¿‡æ¥çš„ <code>hash</code>Â ä¿å­˜ä¸‹æ¥ï¼Œ<strong>å®ƒå°†ä¼šç”¨åˆ°åæ¨¡å—çƒ­æ›´æ–°</strong>ã€‚<br><img src="http://images.pingan8787.com/Webpack-HMR/Webpack-HMR-WS1.png" alt="image.png"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack-dev-server\lib\Server.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. å®šä¹‰ _sendStats æ–¹æ³• Line 685</span></span><br><span class="line"><span class="comment">// send stats to a socket or multiple sockets</span></span><br><span class="line">Server.prototype._sendStats = <span class="function"><span class="keyword">function</span> (<span class="params">sockets, stats, force</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="built_in">this</span>.sockWrite(sockets, <span class="string">&#x27;hash&#x27;</span>, stats.hash);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. ç›‘å¬ done äº‹ä»¶ Line 86</span></span><br><span class="line">compiler.plugin(<span class="string">&#x27;done&#x27;</span>, <span class="function">(<span class="params">stats</span>) =&gt;</span> &#123;</span><br><span class="line">  	<span class="comment">// å°†æœ€æ–°æ‰“åŒ…æ–‡ä»¶çš„ hash å€¼ï¼ˆstats.hashï¼‰ä½œä¸ºå‚æ•°ä¼ å…¥ _sendStats()</span></span><br><span class="line">    <span class="built_in">this</span>._sendStats(<span class="built_in">this</span>.sockets, stats.toJson(clientStats));</span><br><span class="line">    <span class="built_in">this</span>._stats = stats;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// webpack-dev-server\client\index.js</span></span><br><span class="line"><span class="comment">// 3. ä¿å­˜ hash å€¼ Line 74</span></span><br><span class="line"><span class="keyword">var</span> onSocketMsg = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">hash</span>: <span class="function"><span class="keyword">function</span> <span class="title">hash</span>(<span class="params">_hash</span>) </span>&#123;</span><br><span class="line">    currentHash = _hash;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line">socket(socketUrl, onSocketMsg);</span><br></pre></td></tr></table></figure>
<h2 id="5-æµè§ˆå™¨ç«¯å‘å¸ƒæ¶ˆæ¯"><a href="#5-æµè§ˆå™¨ç«¯å‘å¸ƒæ¶ˆæ¯" class="headerlink" title="5.æµè§ˆå™¨ç«¯å‘å¸ƒæ¶ˆæ¯"></a>5.æµè§ˆå™¨ç«¯å‘å¸ƒæ¶ˆæ¯</h2><p>å½“ <code>hash</code> æ¶ˆæ¯å‘é€å®Œæˆåï¼Œsocket è¿˜ä¼šå‘é€ä¸€æ¡ <code>ok</code>Â çš„æ¶ˆæ¯å‘ŠçŸ¥ Webpack-dev-serverï¼Œç”±äºå®¢æˆ·ç«¯ï¼ˆClientï¼‰å¹¶ä¸è¯·æ±‚çƒ­æ›´æ–°ä»£ç ï¼Œä¹Ÿä¸æ‰§è¡Œçƒ­æ›´æ–°æ¨¡å—æ“ä½œï¼Œå› æ­¤é€šè¿‡ <code>emit</code>Â ä¸€ä¸ª <code>&quot;webpackHotUpdate&quot;</code>Â æ¶ˆæ¯ï¼Œå°†å·¥ä½œè½¬äº¤å› Webpackã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack-dev-server\client\index.js</span></span><br><span class="line"><span class="comment">// 1. å¤„ç† ok æ¶ˆæ¯ Line 135</span></span><br><span class="line"><span class="keyword">var</span> onSocketMsg = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">ok</span>: <span class="function"><span class="keyword">function</span> <span class="title">ok</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      sendMsg(<span class="string">&#x27;Ok&#x27;</span>);</span><br><span class="line">      <span class="keyword">if</span> (useWarningOverlay || useErrorOverlay) overlay.clear();</span><br><span class="line">      <span class="keyword">if</span> (initial) <span class="keyword">return</span> initial = <span class="literal">false</span>; <span class="comment">// eslint-disable-line no-return-assign</span></span><br><span class="line">      reloadApp();</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. å¤„ç†åˆ·æ–° APP Line 218</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reloadApp</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">if</span> (_hot) &#123;</span><br><span class="line">    <span class="comment">// åŠ¨æ€åŠ è½½ emitter</span></span><br><span class="line">    <span class="keyword">var</span> hotEmitter = <span class="built_in">require</span>(<span class="string">&#x27;webpack/hot/emitter&#x27;</span>);</span><br><span class="line">    hotEmitter.emit(<span class="string">&#x27;webpackHotUpdate&#x27;</span>, currentHash);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> self !== <span class="string">&#x27;undefined&#x27;</span> &amp;&amp; self.window) &#123;</span><br><span class="line">      <span class="comment">// broadcast update to window</span></span><br><span class="line">      self.postMessage(<span class="string">&#x27;webpackHotUpdate&#x27;</span> + currentHash, <span class="string">&#x27;*&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="6-ä¼ é€’-hash-åˆ°-HMR"><a href="#6-ä¼ é€’-hash-åˆ°-HMR" class="headerlink" title="6.ä¼ é€’ hash åˆ° HMR"></a>6.ä¼ é€’ hash åˆ° HMR</h2><p>Webpack/hot/dev-server ç›‘å¬æµè§ˆå™¨ç«¯ <code>webpackHotUpdate</code> æ¶ˆæ¯ï¼Œå°†æ–°æ¨¡å— hash å€¼ä¼ åˆ°å®¢æˆ·ç«¯ HMR æ ¸å¿ƒä¸­æ¢çš„ HotModuleReplacement.runtime ï¼Œå¹¶è°ƒç”¨ <code>check</code>Â æ–¹æ³•æ£€æµ‹æ›´æ–°ï¼Œ<strong>åˆ¤æ–­æ˜¯æµè§ˆå™¨åˆ·æ–°è¿˜æ˜¯æ¨¡å—çƒ­æ›´æ–°</strong>ã€‚<br>å¦‚æœæ˜¯æµè§ˆå™¨åˆ·æ–°çš„è¯ï¼Œåˆ™æ²¡æœ‰åç»­æ­¥éª¤å’¯~~</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack\hot\dev-server.js</span></span><br><span class="line"><span class="comment">// 1.ç›‘å¬ webpackHotUpdate Line 42</span></span><br><span class="line"><span class="keyword">var</span> hotEmitter = <span class="built_in">require</span>(<span class="string">&quot;./emitter&quot;</span>);</span><br><span class="line">hotEmitter.on(<span class="string">&quot;webpackHotUpdate&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">currentHash</span>) </span>&#123;</span><br><span class="line">    lastHash = currentHash;</span><br><span class="line">    <span class="keyword">if</span>(!upToDate() &amp;&amp; <span class="built_in">module</span>.hot.status() === <span class="string">&quot;idle&quot;</span>) &#123;</span><br><span class="line">        log(<span class="string">&quot;info&quot;</span>, <span class="string">&quot;[HMR] Checking for updates on the server...&quot;</span>);</span><br><span class="line">        check();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> check = <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">module</span>.hot.check(<span class="literal">true</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">updatedModules</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!updatedModules) &#123;</span><br><span class="line">         	  <span class="comment">// ...</span></span><br><span class="line">						<span class="built_in">window</span>.location.reload();<span class="comment">// æµè§ˆå™¨åˆ·æ–°</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!upToDate()) &#123;</span><br><span class="line">            check();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123; <span class="comment">/*...*/</span>&#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// webpack\lib\HotModuleReplacement.runtime.js</span></span><br><span class="line"><span class="comment">// 3.è°ƒç”¨ HotModuleReplacement.runtime å®šä¹‰çš„ check æ–¹æ³• Line 167</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hotCheck</span>(<span class="params">apply</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(hotStatus !== <span class="string">&quot;idle&quot;</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;check() is only allowed in idle status&quot;</span>);</span><br><span class="line">    hotApplyOnUpdate = apply;</span><br><span class="line">    hotSetStatus(<span class="string">&quot;check&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> hotDownloadManifest(hotRequestTimeout).then(<span class="function"><span class="keyword">function</span>(<span class="params">update</span>) </span>&#123;</span><br><span class="line">				<span class="comment">//...</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-æ£€æµ‹æ˜¯å¦å­˜åœ¨æ›´æ–°"><a href="#7-æ£€æµ‹æ˜¯å¦å­˜åœ¨æ›´æ–°" class="headerlink" title="7.æ£€æµ‹æ˜¯å¦å­˜åœ¨æ›´æ–°"></a>7.æ£€æµ‹æ˜¯å¦å­˜åœ¨æ›´æ–°</h2><p>å½“ HotModuleReplacement.runtime è°ƒç”¨ <code>check</code> æ–¹æ³•æ—¶ï¼Œä¼šè°ƒç”¨ JsonpMainTemplate.runtime ä¸­çš„Â <code>hotDownloadUpdateChunk</code>Â ï¼ˆè·å–æœ€æ–°æ¨¡å—ä»£ç ï¼‰å’ŒÂ <code>hotDownloadManifest</code>Â ï¼ˆè·å–æ˜¯å¦æœ‰æ›´æ–°æ–‡ä»¶ï¼‰ä¸¤ä¸ªæ–¹æ³•ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•çš„æºç ï¼Œåœ¨ä¸‹ä¸€æ­¥å±•å¼€ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack\lib\HotModuleReplacement.runtime.js</span></span><br><span class="line"><span class="comment">// 1.è°ƒç”¨ HotModuleReplacement.runtime å®šä¹‰ hotDownloadUpdateChunk æ–¹æ³• Line 171</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hotCheck</span>(<span class="params">apply</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(hotStatus !== <span class="string">&quot;idle&quot;</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;check() is only allowed in idle status&quot;</span>);</span><br><span class="line">    hotApplyOnUpdate = apply;</span><br><span class="line">    hotSetStatus(<span class="string">&quot;check&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> hotDownloadManifest(hotRequestTimeout).then(<span class="function"><span class="keyword">function</span>(<span class="params">update</span>) </span>&#123;</span><br><span class="line">				<span class="comment">//...</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="comment">// hotEnsureUpdateChunk æ–¹æ³•ä¸­ä¼šè°ƒç”¨ hotDownloadUpdateChunk</span></span><br><span class="line">          hotEnsureUpdateChunk(chunkId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ <code>hotEnsureUpdateChunk</code> æ–¹æ³•ä¸­ä¼šè°ƒç”¨ <code>hotDownloadUpdateChunk</code> ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack\lib\HotModuleReplacement.runtime.js Line 215</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">hotEnsureUpdateChunk</span>(<span class="params">chunkId</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!hotAvailableFilesMap[chunkId]) &#123;</span><br><span class="line">			hotWaitingFilesMap[chunkId] = <span class="literal">true</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			hotRequestedFilesMap[chunkId] = <span class="literal">true</span>;</span><br><span class="line">			hotWaitingFiles++;</span><br><span class="line">			hotDownloadUpdateChunk(chunkId);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h2 id="8-è¯·æ±‚æ›´æ–°æœ€æ–°æ–‡ä»¶åˆ—è¡¨"><a href="#8-è¯·æ±‚æ›´æ–°æœ€æ–°æ–‡ä»¶åˆ—è¡¨" class="headerlink" title="8.è¯·æ±‚æ›´æ–°æœ€æ–°æ–‡ä»¶åˆ—è¡¨"></a>8.è¯·æ±‚æ›´æ–°æœ€æ–°æ–‡ä»¶åˆ—è¡¨</h2><p>åœ¨è°ƒç”¨ <code>check</code> æ–¹æ³•æ—¶ï¼Œä¼šå…ˆè°ƒç”¨ JsonpMainTemplate.runtime ä¸­çš„ <code>hotDownloadManifest</code>Â æ–¹æ³•ï¼Œ é€šè¿‡å‘æœåŠ¡ç«¯<strong>å‘èµ· AJAX è¯·æ±‚è·å–æ˜¯å¦æœ‰æ›´æ–°æ–‡ä»¶</strong>ï¼Œå¦‚æœæœ‰çš„è¯å°† <code>mainfest</code>Â è¿”å›ç»™æµè§ˆå™¨ç«¯ã€‚<br><img src="http://images.pingan8787.com/Webpack-HMR/Webpack-HMR-WS2.png" alt="image.png"><br>è¿™è¾¹æ¶‰åŠä¸€äº›åŸç”Ÿ <code>XMLHttpRequest</code>ï¼Œå°±ä¸å…¨éƒ¨è´´å‡ºäº†~</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack\lib\JsonpMainTemplate.runtime.js</span></span><br><span class="line"><span class="comment">// hotDownloadManifest å®šä¹‰ Line 22</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hotDownloadManifest</span>(<span class="params">requestTimeout</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> request = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">            <span class="keyword">var</span> requestPath = $require$.p + $hotMainFilename$;</span><br><span class="line">            request.open(<span class="string">&quot;GET&quot;</span>, requestPath, <span class="literal">true</span>);</span><br><span class="line">            request.timeout = requestTimeout;</span><br><span class="line">            request.send(<span class="literal">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span>(err) &#123;</span><br><span class="line">            <span class="keyword">return</span> reject(err);</span><br><span class="line">        &#125;</span><br><span class="line">        request.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="9-è¯·æ±‚æ›´æ–°æœ€æ–°æ¨¡å—ä»£ç "><a href="#9-è¯·æ±‚æ›´æ–°æœ€æ–°æ¨¡å—ä»£ç " class="headerlink" title="9.è¯·æ±‚æ›´æ–°æœ€æ–°æ¨¡å—ä»£ç "></a>9.è¯·æ±‚æ›´æ–°æœ€æ–°æ¨¡å—ä»£ç </h2><p>åœ¨  <code>hotDownloadManifest</code>Â æ–¹æ³•ä¸­ï¼Œè¿˜ä¼šæ‰§è¡Œ Â <code>hotDownloadUpdateChunk</code>Â æ–¹æ³•ï¼Œ<strong>é€šè¿‡ JSONP è¯·æ±‚æœ€æ–°çš„æ¨¡å—ä»£ç </strong>ï¼Œå¹¶å°†ä»£ç è¿”å›ç»™ HMR runtime ã€‚<br><strong><img src="http://images.pingan8787.com/Webpack-HMR/Webpack-HMR-WS3.png" alt="image.png"></strong></p>
<p>ç„¶å HMR runtime ä¼šå°†æ–°ä»£ç è¿›ä¸€æ­¥å¤„ç†ï¼Œ<strong>åˆ¤æ–­æ˜¯æµè§ˆå™¨åˆ·æ–°è¿˜æ˜¯æ¨¡å—çƒ­æ›´æ–°</strong>ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack\lib\JsonpMainTemplate.runtime.js</span></span><br><span class="line"><span class="comment">// hotDownloadManifest å®šä¹‰ Line 12</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hotDownloadUpdateChunk</span>(<span class="params">chunkId</span>) </span>&#123;</span><br><span class="line">		<span class="comment">// åˆ›å»º script æ ‡ç­¾ï¼Œå‘èµ· JSONP è¯·æ±‚</span></span><br><span class="line">    <span class="keyword">var</span> head = <span class="built_in">document</span>.getElementsByTagName(<span class="string">&quot;head&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">&quot;script&quot;</span>);</span><br><span class="line">    script.type = <span class="string">&quot;text/javascript&quot;</span>;</span><br><span class="line">    script.charset = <span class="string">&quot;utf-8&quot;</span>;</span><br><span class="line">    script.src = $require$.p + $hotChunkFilename$;</span><br><span class="line">    $crossOriginLoading$;</span><br><span class="line">    head.appendChild(script);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="10-æ›´æ–°æ¨¡å—å’Œä¾èµ–å¼•ç”¨"><a href="#10-æ›´æ–°æ¨¡å—å’Œä¾èµ–å¼•ç”¨" class="headerlink" title="10.æ›´æ–°æ¨¡å—å’Œä¾èµ–å¼•ç”¨"></a>10.æ›´æ–°æ¨¡å—å’Œä¾èµ–å¼•ç”¨</h2><p>è¿™ä¸€æ­¥æ˜¯æ•´ä¸ªæ¨¡å—çƒ­æ›´æ–°ï¼ˆHMRï¼‰çš„æ ¸å¿ƒæ­¥éª¤ï¼Œé€šè¿‡ HMR runtime çš„ <code>hotApply</code>Â æ–¹æ³•ï¼Œç§»é™¤è¿‡æœŸæ¨¡å—å’Œä»£ç ï¼Œå¹¶æ·»åŠ æ–°çš„æ¨¡å—å’Œä»£ç å®ç°çƒ­æ›´æ–°ã€‚</p>
<p>ä» <code>hotApply</code>Â æ–¹æ³•å¯ä»¥çœ‹å‡ºï¼Œæ¨¡å—çƒ­æ›¿æ¢ä¸»è¦åˆ†ä¸‰ä¸ªé˜¶æ®µï¼š</p>
<ol>
<li><p>æ‰¾å‡ºè¿‡æœŸæ¨¡å— <code>outdatedModules</code> å’Œè¿‡æœŸä¾èµ– <code>outdatedDependencies</code> ï¼›</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack\lib\HotModuleReplacement.runtime.js</span></span><br><span class="line"><span class="comment">// æ‰¾å‡º outdatedModules å’Œ outdatedDependencies Line 342</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hotApply</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">var</span> outdatedDependencies = &#123;&#125;;</span><br><span class="line">  <span class="keyword">var</span> outdatedModules = [];</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getAffectedStuff</span>(<span class="params">updateModuleId</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> outdatedModules = [updateModuleId];</span><br><span class="line">    <span class="keyword">var</span> outdatedDependencies = &#123;&#125;;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;accepted&quot;</span>,</span><br><span class="line">        <span class="attr">moduleId</span>: updateModuleId,</span><br><span class="line">        <span class="attr">outdatedModules</span>: outdatedModules,</span><br><span class="line">        <span class="attr">outdatedDependencies</span>: outdatedDependencies</span><br><span class="line">    &#125;;</span><br><span class="line">	&#125;;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">addAllToSet</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; b.length; i++) &#123;</span><br><span class="line">          <span class="keyword">var</span> item = b[i];</span><br><span class="line">          <span class="keyword">if</span> (a.indexOf(item) &lt; <span class="number">0</span>)</span><br><span class="line">              a.push(item);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> id <span class="keyword">in</span> hotUpdate) &#123;</span><br><span class="line">      <span class="keyword">if</span>(<span class="built_in">Object</span>.prototype.hasOwnProperty.call(hotUpdate, id)) &#123;</span><br><span class="line">          <span class="comment">// ... çœç•¥å¤šä½™ä»£ç </span></span><br><span class="line">          <span class="keyword">if</span>(hotUpdate[id]) &#123;</span><br><span class="line">              result = getAffectedStuff(moduleId);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span>(doApply) &#123;</span><br><span class="line">              <span class="keyword">for</span>(moduleId <span class="keyword">in</span> result.outdatedDependencies) &#123;</span><br><span class="line">                 <span class="comment">// æ·»åŠ åˆ° outdatedDependencies</span></span><br><span class="line">                  addAllToSet(outdatedDependencies[moduleId], result.outdatedDependencies[moduleId]);</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span>(doDispose) &#123;</span><br><span class="line">              <span class="comment">// æ·»åŠ åˆ° outdatedModules</span></span><br><span class="line">              addAllToSet(outdatedModules, [result.moduleId]);</span><br><span class="line">              appliedUpdate[moduleId] = warnUnexpectedRequire;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>ä»ç¼“å­˜ä¸­åˆ é™¤è¿‡æœŸæ¨¡å—ã€ä¾èµ–å’Œæ‰€æœ‰å­å…ƒç´ çš„å¼•ç”¨ï¼›</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack\lib\HotModuleReplacement.runtime.js</span></span><br><span class="line"><span class="comment">// ä»ç¼“å­˜ä¸­åˆ é™¤è¿‡æœŸæ¨¡å—ã€ä¾èµ–å’Œæ‰€æœ‰å­å…ƒç´ çš„å¼•ç”¨ Line 442</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hotApply</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> 		<span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">var</span> idx;</span><br><span class="line">    <span class="keyword">var</span> queue = outdatedModules.slice();</span><br><span class="line">    <span class="keyword">while</span>(queue.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        moduleId = queue.pop();</span><br><span class="line">        <span class="built_in">module</span> = installedModules[moduleId];</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="comment">// ç§»é™¤ç¼“å­˜ä¸­çš„æ¨¡å—</span></span><br><span class="line">        <span class="keyword">delete</span> installedModules[moduleId];</span><br><span class="line">        <span class="comment">// ç§»é™¤è¿‡æœŸä¾èµ–ä¸­ä¸éœ€è¦ä½¿ç”¨çš„å¤„ç†æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">delete</span> outdatedDependencies[moduleId];</span><br><span class="line">        <span class="comment">// ç§»é™¤æ‰€æœ‰å­å…ƒç´ çš„å¼•ç”¨</span></span><br><span class="line">        <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="built_in">module</span>.children.length; j++) &#123;</span><br><span class="line">            <span class="keyword">var</span> child = installedModules[<span class="built_in">module</span>.children[j]];</span><br><span class="line">            <span class="keyword">if</span>(!child) <span class="keyword">continue</span>;</span><br><span class="line">            idx = child.parents.indexOf(moduleId);</span><br><span class="line">            <span class="keyword">if</span>(idx &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                child.parents.splice(idx, <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line">		<span class="comment">// ä»æ¨¡å—å­ç»„ä»¶ä¸­åˆ é™¤è¿‡æ—¶çš„ä¾èµ–é¡¹</span></span><br><span class="line">		<span class="keyword">var</span> dependency;</span><br><span class="line">		<span class="keyword">var</span> moduleOutdatedDependencies;</span><br><span class="line">		<span class="keyword">for</span>(moduleId <span class="keyword">in</span> outdatedDependencies) &#123;</span><br><span class="line">			<span class="keyword">if</span>(<span class="built_in">Object</span>.prototype.hasOwnProperty.call(outdatedDependencies, moduleId)) &#123;</span><br><span class="line">				<span class="built_in">module</span> = installedModules[moduleId];</span><br><span class="line">				<span class="keyword">if</span>(<span class="built_in">module</span>) &#123;</span><br><span class="line">					moduleOutdatedDependencies = outdatedDependencies[moduleId];</span><br><span class="line">					<span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; moduleOutdatedDependencies.length; j++) &#123;</span><br><span class="line">						dependency = moduleOutdatedDependencies[j];</span><br><span class="line">						idx = <span class="built_in">module</span>.children.indexOf(dependency);</span><br><span class="line">						<span class="keyword">if</span>(idx &gt;= <span class="number">0</span>) <span class="built_in">module</span>.children.splice(idx, <span class="number">1</span>);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<ol start="3">
<li>å°†æ–°æ¨¡å—ä»£ç æ·»åŠ åˆ° modules ä¸­ï¼Œå½“ä¸‹æ¬¡è°ƒç”¨ <code>__webpack_require__</code>Â  (webpack é‡å†™çš„ <code>require</code>Â  æ–¹æ³•)æ–¹æ³•çš„æ—¶å€™ï¼Œå°±æ˜¯è·å–åˆ°äº†æ–°çš„æ¨¡å—ä»£ç äº†ã€‚<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack\lib\HotModuleReplacement.runtime.js</span></span><br><span class="line"><span class="comment">// å°†æ–°æ¨¡å—ä»£ç æ·»åŠ åˆ° modules ä¸­ Line 501</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hotApply</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> 		<span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">for</span>(moduleId <span class="keyword">in</span> appliedUpdate) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">Object</span>.prototype.hasOwnProperty.call(appliedUpdate, moduleId)) &#123;</span><br><span class="line">            modules[moduleId] = appliedUpdate[moduleId];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p><code>hotApply</code>Â æ–¹æ³•æ‰§è¡Œä¹‹åï¼Œæ–°ä»£ç å·²ç»æ›¿æ¢æ—§ä»£ç ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸šåŠ¡ä»£ç å¹¶ä¸çŸ¥é“è¿™äº›å˜åŒ–ï¼Œå› æ­¤éœ€è¦é€šè¿‡ <code>accept</code>äº‹ä»¶é€šçŸ¥åº”ç”¨å±‚ä½¿ç”¨æ–°çš„æ¨¡å—è¿›è¡Œâ€œå±€éƒ¨åˆ·æ–°â€ï¼Œæˆ‘ä»¬åœ¨ä¸šåŠ¡ä¸­æ˜¯è¿™ä¹ˆä½¿ç”¨ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">  <span class="built_in">module</span>.hot.accept(<span class="string">&#x27;./library.js&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨æ›´æ–°è¿‡çš„ library æ¨¡å—æ‰§è¡ŒæŸäº›æ“ä½œ...</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="11-çƒ­æ›´æ–°é”™è¯¯å¤„ç†"><a href="#11-çƒ­æ›´æ–°é”™è¯¯å¤„ç†" class="headerlink" title="11.çƒ­æ›´æ–°é”™è¯¯å¤„ç†"></a>11.çƒ­æ›´æ–°é”™è¯¯å¤„ç†</h2><p>åœ¨çƒ­æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œ<code>hotApply</code> è¿‡ç¨‹ä¸­å¯èƒ½å‡ºç° <code>abort</code> æˆ–è€… <code>fail</code> é”™è¯¯ï¼Œåˆ™çƒ­æ›´æ–°é€€å›åˆ°åˆ·æ–°æµè§ˆå™¨ï¼ˆBrowser Reloadï¼‰ï¼Œæ•´ä¸ªæ¨¡å—çƒ­æ›´æ–°å®Œæˆã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack\hot\dev-server.js Line 13</span></span><br><span class="line"><span class="built_in">module</span>.hot.check(<span class="literal">true</span>).then(<span class="function"><span class="keyword">function</span> (<span class="params">updatedModules</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!updatedModules) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">window</span>.location.reload();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> status = <span class="built_in">module</span>.hot.status();</span><br><span class="line">    <span class="keyword">if</span> ([<span class="string">&quot;abort&quot;</span>, <span class="string">&quot;fail&quot;</span>].indexOf(status) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">window</span>.location.reload();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="äº”ã€æ€»ç»“"><a href="#äº”ã€æ€»ç»“" class="headerlink" title="äº”ã€æ€»ç»“"></a>äº”ã€æ€»ç»“</h1><p>æœ¬æ–‡ä¸»è¦â€‹å’Œå¤§å®¶åˆ†äº« Webpack çš„ HMR ä½¿ç”¨å’Œå®ç°åŸç†åŠæºç åˆ†æï¼Œåœ¨æºç åˆ†æä¸­ï¼Œé€šè¿‡ä¸€å¼ â€œWebpack HMR å·¥ä½œåŸç†è§£æâ€å›¾è®©å¤§å®¶å¯¹ HMR æ•´ä¸ªå·¥ä½œæµç¨‹æœ‰æ‰€äº†è§£ï¼ŒHMR æœ¬èº«æºç å†…å®¹è¾ƒå¤šï¼Œè®¸å¤šç»†èŠ‚ä¹‹å¤„æœ¬æ–‡æ²¡æœ‰å®Œæ•´å†™å‡ºï¼Œéœ€è¦å„ä½è¯»è€…è‡ªå·±æ…¢æ…¢é˜…è¯»å’Œç†è§£æºç ã€‚</p>
<h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><p>1.å®˜æ–¹æ–‡æ¡£<a target="_blank" rel="noopener" href="https://webpack.js.org/guides/hot-module-replacement/">ã€ŠHot Module Replacementã€‹</a><br />2.<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/30669007">ã€ŠWebpack HMR åŸç†è§£æã€‹</a><br />3.<a href="www.ayqy.net/blog/hot-module-replacement/">ã€Šwebpack HMRã€‹</a>Â <br />4.<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000020293167">ã€Šé…ç½® dev-serverã€‹</a>Â </p>
<p><img src="http://images.pingan8787.com/2019_07_12guild_page.png" alt="bg"></p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2020-06-17</span><i class="fa fa-tag"></i><a class="tag" href="/tags/å‰ç«¯å¼€å‘/" title="å‰ç«¯å¼€å‘">å‰ç«¯å¼€å‘ </a><a class="tag" href="/tags/åŸåˆ›/" title="åŸåˆ›">åŸåˆ› </a><a class="tag" href="/tags/Webpack/" title="Webpack">Webpack </a><a class="tag" href="/tags/è¯»ä¹¦ç¬”è®°/" title="è¯»ä¹¦ç¬”è®°">è¯»ä¹¦ç¬”è®° </a></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,https://pingan8787.github.io/2020/06/17/207-ã€Webpackã€‘äº†ä¸èµ·çš„Webpack-HMRå­¦ä¹ æŒ‡å—ï¼ˆå«æºç åˆ†æï¼‰/,pingan8787,207-ã€Webpackã€‘äº†ä¸èµ·çš„ Webpack HMR å­¦ä¹ æŒ‡å—ï¼ˆå«æºç åˆ†æï¼‰,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2020/06/17/208-%E3%80%90TyeScript%E3%80%91%E4%BA%86%E4%B8%8D%E8%B5%B7%E7%9A%84tsconfig-json%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97/" title="208-ã€TyeScriptã€‘äº†ä¸èµ·çš„tsconfig.jsonå­¦ä¹ æŒ‡å—">ä¸Šä¸€ç¯‡</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2020/06/06/206-%E3%80%90%E8%AF%BB%E4%B9%A6%E3%80%91%E8%AF%BB%E3%80%8A%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84WeakMap%E3%80%8B%E6%80%BB%E7%BB%93/" title="206-ã€è¯»ä¹¦ã€‘è¯»ã€Šä½ ä¸çŸ¥é“çš„WeakMapã€‹æ€»ç»“">ä¸‹ä¸€ç¯‡</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>